(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors"],{"00a3":function(t,e){t.exports={enable(t){setTimeout(()=>{t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.enable()},0)},disable(t){setTimeout(()=>{t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()},0)}}},"0172":function(t,e,n){const r=n("53a8"),i=n("e133"),o=["mode","feature","mouse"];t.exports=function(t){const e={};let n=null,a={mode:null,feature:null,mouse:null},s={mode:null,feature:null,mouse:null};function l(t){s=r(s,t)}function c(){if(!t.container)return;const e=[],n=[];o.forEach(t=>{s[t]!==a[t]&&(e.push(`${t}-${a[t]}`),null!==s[t]&&n.push(`${t}-${s[t]}`))}),e.length>0&&t.container.classList.remove.apply(t.container.classList,e),n.length>0&&t.container.classList.add.apply(t.container.classList,n),a=r(a,s)}function u(t,e={}){const r=document.createElement("button");return r.className=`${i.classes.CONTROL_BUTTON} ${e.className}`,r.setAttribute("title",e.title),e.container.appendChild(r),r.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();const i=r.target;i!==n?(p(t),e.onActivate()):h()},!0),r}function h(){n&&(n.classList.remove(i.classes.ACTIVE_BUTTON),n=null)}function p(t){h();const r=e[t];r&&r&&"trash"!==t&&(r.classList.add(i.classes.ACTIVE_BUTTON),n=r)}function d(){const n=t.options.controls,r=document.createElement("div");return r.className=`${i.classes.CONTROL_GROUP} ${i.classes.CONTROL_BASE}`,n?(n[i.types.LINE]&&(e[i.types.LINE]=u(i.types.LINE,{container:r,className:i.classes.CONTROL_BUTTON_LINE,title:"LineString tool "+(t.options.keybindings&&"(l)"),onActivate:()=>t.events.changeMode(i.modes.DRAW_LINE_STRING)})),n[i.types.POLYGON]&&(e[i.types.POLYGON]=u(i.types.POLYGON,{container:r,className:i.classes.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(t.options.keybindings&&"(p)"),onActivate:()=>t.events.changeMode(i.modes.DRAW_POLYGON)})),n[i.types.POINT]&&(e[i.types.POINT]=u(i.types.POINT,{container:r,className:i.classes.CONTROL_BUTTON_POINT,title:"Marker tool "+(t.options.keybindings&&"(m)"),onActivate:()=>t.events.changeMode(i.modes.DRAW_POINT)})),n.trash&&(e.trash=u("trash",{container:r,className:i.classes.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{t.events.trash()}})),n.combine_features&&(e.combine_features=u("combineFeatures",{container:r,className:i.classes.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{t.events.combineFeatures()}})),n.uncombine_features&&(e.uncombine_features=u("uncombineFeatures",{container:r,className:i.classes.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{t.events.uncombineFeatures()}})),r):r}function f(){Object.keys(e).forEach(t=>{const n=e[t];n.parentNode&&n.parentNode.removeChild(n),delete e[t]})}return{setActiveButton:p,queueMapClasses:l,updateMapClasses:c,addButtons:d,removeButtons:f}}},"07de":function(t,e,n){const{noTarget:r,isOfMetaType:i,isInactiveFeature:o,isShiftDown:a}=n("2413"),s=n("d7df"),l=n("3b00"),c=n("00a3"),u=n("e133"),h=n("2413"),p=n("190f"),d=i(u.meta.VERTEX),f=i(u.meta.MIDPOINT);t.exports=function(t,e){const n=e.featureId,i=t.store.get(n);if(!i)throw new Error("You must provide a featureId to enter direct_select mode");if(i.type===u.geojsonTypes.POINT)throw new TypeError("direct_select mode doesn't handle point features");let m=e.startPos||null,g=!1,y=!1,v=e.coordPath?[e.coordPath]:[];const _=function(){t.map.fire(u.events.UPDATE,{action:u.updateActions.CHANGE_COORDINATES,features:t.store.getSelected().map(t=>t.toGeoJSON())})},x=()=>t.events.actionable({combineFeatures:!1,uncombineFeatures:!1,trash:v.length>0}),b=function(e){t.map.dragPan.disable(),y=!0,m=e.lngLat},w=function(){t.map.dragPan.enable(),g=!1,y=!1,m=null},M=function(t){b(t);const e=t.featureTarget.properties,n=v.indexOf(e.coord_path);a(t)||-1!==n?a(t)&&-1===n&&v.push(e.coord_path):v=[e.coord_path],i.changed()},E=function(t){b(t);const e=t.featureTarget.properties;i.addCoordinate(e.coord_path,e.lng,e.lat),_(),v=[e.coord_path]},S=function(t){0===v.length?b(t):w()},T=(e,n)=>{p(t.store.getSelected(),n),m=e.lngLat},A=(t,e)=>{const n=v.map(t=>i.getCoordinate(t)),r=n.map(t=>({type:u.geojsonTypes.FEATURE,properties:{},geometry:{type:u.geojsonTypes.POINT,coordinates:t}})),o=l(r,e);for(let a=0;a<n.length;a++){const t=n[a];i.updateCoordinate(v[a],t[0]+o.lng,t[1]+o.lat)}};return{start:function(){t.store.setSelected(n),c.disable(t),this.on("mousemove",h.true,e=>{const n=h.isActiveFeature(e),r=d(e),i=0===v.length;n&&i||r&&!i?t.ui.queueMapClasses({mouse:u.cursors.MOVE}):t.ui.queueMapClasses({mouse:u.cursors.NONE}),w(e)}),this.on("mouseout",()=>g,_),this.on("mousedown",d,M),this.on("mousedown",h.isActiveFeature,S),this.on("mousedown",f,E),this.on("drag",()=>y,t=>{g=!0,t.originalEvent.stopPropagation();const e={lng:t.lngLat.lng-m.lng,lat:t.lngLat.lat-m.lat};v.length>0?A(t,e):T(t,e),m=t.lngLat}),this.on("click",h.true,w),this.on("mouseup",h.true,()=>{g&&_(),w()}),this.on("click",r,()=>{t.events.changeMode(u.modes.SIMPLE_SELECT)}),this.on("click",o,()=>{t.events.changeMode(u.modes.SIMPLE_SELECT)}),this.on("click",h.isActiveFeature,()=>{v=[],i.changed()})},stop:function(){c.enable(t)},render:function(e,r){n===e.properties.id?(e.properties.active=u.activeStates.ACTIVE,r(e),s(e,{map:t.map,midpoints:!0,selectedPaths:v}).forEach(r)):(e.properties.active=u.activeStates.INACTIVE,r(e)),x()},trash:function(){v.sort().reverse().forEach(t=>i.removeCoordinate(t)),t.map.fire(u.events.UPDATE,{action:u.updateActions.CHANGE_COORDINATES,features:t.store.getSelected().map(t=>t.toGeoJSON())}),v=[],x(),!1===i.isValid()&&(t.store.delete([n]),t.events.changeMode(u.modes.SIMPLE_SELECT,{}))}}}},"0d02":function(t,e,n){const r=n("93b5"),i=n("4338"),o=n("a4f5"),a=n("cae9");function s(t){t=r._validate(t,o.prototype._defaults.sphere);let e=new THREE.SphereBufferGeometry(t.radius,t.sides,t.sides),n=i(t),s=new THREE.Mesh(e,n);return new a({obj:s,units:t.units,anchor:t.anchor,adjustment:t.adjustment,bbox:t.bbox,tooltip:t.tooltip,raycasted:t.raycasted})}t.exports=s},"0eee":function(t,e){function n(){if(!(this instanceof n))return new n;this._bbox=[1/0,1/0,-1/0,-1/0],this._valid=!1}t.exports=n,n.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},n.prototype.union=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},n.prototype.bbox=function(){return this._valid?this._bbox:null},n.prototype.contains=function(t){return this._valid?this._bbox[0]<=t[0]&&this._bbox[1]<=t[1]&&this._bbox[2]>=t[0]&&this._bbox[3]>=t[1]:null},n.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null}},"125a":function(t,e,n){t.exports={Threebox:n("8949"),THREE:n("7bc4")}},"12ec":function(t,e,n){const r=n("a53c"),i=n("e133"),o=n("55b1"),a={MultiPoint:n("8309"),MultiLineString:n("5330"),MultiPolygon:n("95f0")},s=(t,e,n,r,i)=>{const o=n.split("."),a=parseInt(o[0],10),s=o[1]?o.slice(1).join("."):null;return t[a][e](s,r,i)},l=function(t,e){if(r.call(this,t,e),delete this.coordinates,this.model=a[e.geometry.type],void 0===this.model)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};l.prototype=Object.create(r.prototype),l.prototype._coordinatesToFeatures=function(t){const e=this.model.bind(this);return t.map(t=>new e(this.ctx,{id:o(),type:i.geojsonTypes.FEATURE,properties:{},geometry:{coordinates:t,type:this.type.replace("Multi","")}}))},l.prototype.isValid=function(){return this.features.every(t=>t.isValid())},l.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},l.prototype.getCoordinate=function(t){return s(this.features,"getCoordinate",t)},l.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(t=>t.type===i.geojsonTypes.POLYGON?t.getCoordinates():t.coordinates)))},l.prototype.updateCoordinate=function(t,e,n){s(this.features,"updateCoordinate",t,e,n),this.changed()},l.prototype.addCoordinate=function(t,e,n){s(this.features,"addCoordinate",t,e,n),this.changed()},l.prototype.removeCoordinate=function(t){s(this.features,"removeCoordinate",t),this.changed()},l.prototype.getFeatures=function(){return this.features},t.exports=l},"137c":function(t,e,n){const r=n("7bc4"),i=n("93b5"),o=n("a4f5");function a(t){t=i._validate(t,o.prototype._defaults.line);var e=i.lnglatsToWorld(t.geometry),n=i.normalizeVertices(e),s=i.flattenVectors(n.vertices),l=new r.LineGeometry;l.setPositions(s);let c=new r.LineMaterial({color:t.color,linewidth:t.width,dashed:!1,opacity:t.opacity});return c.resolution.set(window.innerWidth,window.innerHeight),c.isMaterial=!0,c.transparent=!0,c.depthWrite=!1,a=new r.Line2(l,c),a.position.copy(n.position),a.computeLineDistances(),a}t.exports=a,r.LineSegmentsGeometry=function(){r.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry";var t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new r.Float32BufferAttribute(t,3)),this.setAttribute("uv",new r.Float32BufferAttribute(e,2))},r.LineSegmentsGeometry.prototype=Object.assign(Object.create(r.InstancedBufferGeometry.prototype),{constructor:r.LineSegmentsGeometry,isLineSegmentsGeometry:!0,applyMatrix4:function(t){var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new r.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new r.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new r.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new r.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new r.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new r.InterleavedBufferAttribute(n,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new r.WireframeGeometry(t.geometry)),this},fromLineSegments:function(t){var e=t.geometry;if(!e.isGeometry)return e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this;console.error("THREE.LineSegmentsGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},computeBoundingBox:function(){var t=new r.Box3;return function(){null===this.boundingBox&&(this.boundingBox=new r.Box3);var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;void 0!==e&&void 0!==n&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(n),this.boundingBox.union(t))}}(),computeBoundingSphere:function(){var t=new r.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new r.Sphere),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==e&&void 0!==n){var i=this.boundingSphere.center;this.boundingBox.getCenter(i);for(var o=0,a=0,s=e.count;a<s;a++)t.fromBufferAttribute(e,a),o=Math.max(o,i.distanceToSquared(t)),t.fromBufferAttribute(n,a),o=Math.max(o,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},applyMatrix:function(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}}),r.LineGeometry=function(){r.LineSegmentsGeometry.call(this),this.type="LineGeometry"},r.LineGeometry.prototype=Object.assign(Object.create(r.LineSegmentsGeometry.prototype),{constructor:r.LineGeometry,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return r.LineSegmentsGeometry.prototype.setPositions.call(this,n),this},setColors:function(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return r.LineSegmentsGeometry.prototype.setColors.call(this,n),this},fromLine:function(t){var e=t.geometry;if(!e.isGeometry)return e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this;console.error("THREE.LineGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},copy:function(){return this}}),r.WireframeGeometry2=function(t){r.LineSegmentsGeometry.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new r.WireframeGeometry(t))},r.WireframeGeometry2.prototype=Object.assign(Object.create(r.LineSegmentsGeometry.prototype),{constructor:r.WireframeGeometry2,isWireframeGeometry2:!0}),r.UniformsLib.line={linewidth:{value:1},resolution:{value:new r.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1},opacity:{value:1}},r.ShaderLib["line"]={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"},r.LineMaterial=function(t){r.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:r.UniformsUtils.clone(r.ShaderLib["line"].uniforms),vertexShader:r.ShaderLib["line"].vertexShader,fragmentShader:r.ShaderLib["line"].fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)},r.LineMaterial.prototype=Object.create(r.ShaderMaterial.prototype),r.LineMaterial.prototype.constructor=r.LineMaterial,r.LineMaterial.prototype.isLineMaterial=!0,r.LineSegments2=function(t,e){void 0===t&&(t=new r.LineSegmentsGeometry),void 0===e&&(e=new r.LineMaterial({color:16777215*Math.random()})),r.Mesh.call(this,t,e),this.type="LineSegments2"},r.LineSegments2.prototype=Object.assign(Object.create(r.Mesh.prototype),{constructor:r.LineSegments2,isLineSegments2:!0,computeLineDistances:function(){var t=new r.Vector3,e=new r.Vector3;return function(){for(var n=this.geometry,i=n.attributes.instanceStart,o=n.attributes.instanceEnd,a=new Float32Array(2*i.data.count),s=0,l=0,c=i.data.count;s<c;s++,l+=2)t.fromBufferAttribute(i,s),e.fromBufferAttribute(o,s),a[l]=0===l?0:a[l-1],a[l+1]=a[l]+t.distanceTo(e);var u=new r.InstancedInterleavedBuffer(a,2,1);return n.setAttribute("instanceDistanceStart",new r.InterleavedBufferAttribute(u,1,0)),n.setAttribute("instanceDistanceEnd",new r.InterleavedBufferAttribute(u,1,1)),this}}(),raycast:function(){var t=new r.Vector4,e=new r.Vector4,n=new r.Vector4,i=new r.Vector3,o=new r.Matrix4,a=new r.Line3,s=new r.Vector3;return function(l,c){null===l.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var u=void 0!==l.params.Line2&&l.params.Line2.threshold||0,h=l.ray,p=l.camera,d=p.projectionMatrix,f=this.geometry,m=this.material,g=m.resolution,y=m.linewidth+u,v=f.attributes.instanceStart,_=f.attributes.instanceEnd,x=-p.near;h.at(1,n),n.w=1,n.applyMatrix4(p.matrixWorldInverse),n.applyMatrix4(d),n.multiplyScalar(1/n.w),n.x*=g.x/2,n.y*=g.y/2,n.z=0,i.copy(n);var b=this.matrixWorld;o.multiplyMatrices(p.matrixWorldInverse,b);for(var w=0,M=v.count;w<M;w++){t.fromBufferAttribute(v,w),e.fromBufferAttribute(_,w),t.w=1,e.w=1,t.applyMatrix4(o),e.applyMatrix4(o);var E=t.z>x&&e.z>x;if(!E){if(t.z>x){const n=t.z-e.z,r=(t.z-x)/n;t.lerp(e,r)}else if(e.z>x){const n=e.z-t.z,r=(e.z-x)/n;e.lerp(t,r)}t.applyMatrix4(d),e.applyMatrix4(d),t.multiplyScalar(1/t.w),e.multiplyScalar(1/e.w),t.x*=g.x/2,t.y*=g.y/2,e.x*=g.x/2,e.y*=g.y/2,a.start.copy(t),a.start.z=0,a.end.copy(e),a.end.z=0;var S=a.closestPointToPointParameter(i,!0);a.at(S,s);var T=r.MathUtils.lerp(t.z,e.z,S),A=T>=-1&&T<=1,C=i.distanceTo(s)<.5*y;if(A&&C){a.start.fromBufferAttribute(v,w),a.end.fromBufferAttribute(_,w),a.start.applyMatrix4(b),a.end.applyMatrix4(b);var L=new r.Vector3,I=new r.Vector3;h.distanceSqToSegment(a.start,a.end,I,L),c.push({point:I,pointOnLine:L,distance:h.origin.distanceTo(I),object:this,face:null,faceIndex:w,uv:null,uv2:null})}}}}}()}),r.Line2=function(t,e){void 0===t&&(t=new r.LineGeometry),void 0===e&&(e=new r.LineMaterial({color:16777215*Math.random()})),r.LineSegments2.call(this,t,e),this.type="Line2"},r.Line2.prototype=Object.assign(Object.create(r.LineSegments2.prototype),{constructor:r.Line2,isLine2:!0}),r.Wireframe=function(t,e){r.Mesh.call(this),this.type="Wireframe",this.geometry=void 0!==t?t:new r.LineSegmentsGeometry,this.material=void 0!==e?e:new r.LineMaterial({color:16777215*Math.random()})},r.Wireframe.prototype=Object.assign(Object.create(r.Mesh.prototype),{constructor:r.Wireframe,isWireframe:!0,computeLineDistances:function(){var t=new r.Vector3,e=new r.Vector3;return function(){for(var n=this.geometry,i=n.attributes.instanceStart,o=n.attributes.instanceEnd,a=new Float32Array(2*i.data.count),s=0,l=0,c=i.data.count;s<c;s++,l+=2)t.fromBufferAttribute(i,s),e.fromBufferAttribute(o,s),a[l]=0===l?0:a[l-1],a[l+1]=a[l]+t.distanceTo(e);var u=new r.InstancedInterleavedBuffer(a,2,1);return n.setAttribute("instanceDistanceStart",new r.InterleavedBufferAttribute(u,1,0)),n.setAttribute("instanceDistanceEnd",new r.InterleavedBufferAttribute(u,1,1)),this}}()})},"182d":function(t,e){function n(){}n.prototype={Coords:function(t){if(t.constructor===Array)if(t.length<2)console.error("Coords length must be at least 2");else{for(const e of t)if(e.constructor!==Number)return void console.error("Coords values must be numbers");if(!(Math.abs(t[1])>90))return t;console.error("Latitude must be between -90 and 90")}else console.error("Coords must be an array")},Line:function(t){var e=this;if(t.constructor===Array){for(const n of t)if(!e.Coords(n))return void console.error("Each coordinate in a line must be a valid Coords type");return t}console.error("Line must be an array")},Rotation:function(t){if(t.constructor===Number)t={z:t};else{if(t.constructor!==Object)return void console.error("Rotation must be an object or a number");for(const e of Object.keys(t)){if(!["x","y","z"].includes(e))return void console.error("Rotation parameters must be x, y, or z");if(t[e].constructor!==Number)return void console.error("Individual rotation values must be numbers")}}return t},Scale:function(t){if(t.constructor===Number)t={x:t,y:t,z:t};else{if(t.constructor!==Object)return void console.error("Scale must be an object or a number");for(const e of Object.keys(t)){if(!["x","y","z"].includes(e))return void console.error("Scale parameters must be x, y, or z");if(t[e].constructor!==Number)return void console.error("Individual scale values must be numbers")}}return t}},t.exports=n},"190f":function(t,e,n){const r=n("3b00"),i=n("e133");t.exports=function(t,e){const n=r(t.map(t=>t.toGeoJSON()),e);t.forEach(t=>{const e=t.getCoordinates(),r=t=>{const e={lng:t[0]+n.lng,lat:t[1]+n.lat};return[e.lng,e.lat]},o=t=>t.map(t=>r(t)),a=t=>t.map(t=>o(t));let s;t.type===i.geojsonTypes.POINT?s=r(e):t.type===i.geojsonTypes.LINE_STRING||t.type===i.geojsonTypes.MULTI_POINT?s=e.map(r):t.type===i.geojsonTypes.POLYGON||t.type===i.geojsonTypes.MULTI_LINE_STRING?s=e.map(o):t.type===i.geojsonTypes.MULTI_POLYGON&&(s=e.map(a)),t.incomingCoords(s)})}},2093:function(t,e){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */var n={},r=void 0,i=n;function o(t,e){var n,o=t.split("."),a=i;!(o[0]in a)&&a.execScript&&a.execScript("var "+o[0]);for(;o.length&&(n=o.shift());)o.length||e===r?a=a[n]?a[n]:a[n]={}:a[n]=e}var a="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function s(t){var e,n,r,i,o,s,l,c,u,h,p=t.length,d=0,f=Number.POSITIVE_INFINITY;for(c=0;c<p;++c)t[c]>d&&(d=t[c]),t[c]<f&&(f=t[c]);for(e=1<<d,n=new(a?Uint32Array:Array)(e),r=1,i=0,o=2;r<=d;){for(c=0;c<p;++c)if(t[c]===r){for(s=0,l=i,u=0;u<r;++u)s=s<<1|1&l,l>>=1;for(h=r<<16|c,u=s;u<e;u+=o)n[u]=h;++i}++r,i<<=1,o<<=1}return[n,d,f]}function l(t,e){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=a?new Uint8Array(t):t,this.m=!1,this.i=u,this.r=!1,!e&&(e={})||(e.index&&(this.a=e.index),e.bufferSize&&(this.h=e.bufferSize),e.bufferType&&(this.i=e.bufferType),e.resize&&(this.r=e.resize)),this.i){case c:this.b=32768,this.c=new(a?Uint8Array:Array)(32768+this.h+258);break;case u:this.b=0,this.c=new(a?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var c=0,u=1,h={t:c,s:u};l.prototype.k=function(){for(;!this.m;){var t=I(this,3);switch(1&t&&(this.m=!0),t>>>=1,t){case 0:var e=this.input,n=this.a,i=this.c,o=this.b,l=e.length,h=r,p=r,d=i.length,f=r;if(this.d=this.f=0,n+1>=l)throw Error("invalid uncompressed block header: LEN");if(h=e[n++]|e[n++]<<8,n+1>=l)throw Error("invalid uncompressed block header: NLEN");if(p=e[n++]|e[n++]<<8,h===~p)throw Error("invalid uncompressed block header: length verify");if(n+h>e.length)throw Error("input buffer is broken");switch(this.i){case c:for(;o+h>i.length;){if(f=d-o,h-=f,a)i.set(e.subarray(n,n+f),o),o+=f,n+=f;else for(;f--;)i[o++]=e[n++];this.b=o,i=this.e(),o=this.b}break;case u:for(;o+h>i.length;)i=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(a)i.set(e.subarray(n,n+h),o),o+=h,n+=h;else for(;h--;)i[o++]=e[n++];this.a=n,this.b=o,this.c=i;break;case 1:this.j(A,L);break;case 2:var g=I(this,5)+257,y=I(this,5)+1,v=I(this,4)+4,_=new(a?Uint8Array:Array)(m.length),x=r,b=r,w=r,M=r,E=r,S=r,T=r,C=r,R=r;for(C=0;C<v;++C)_[m[C]]=I(this,3);if(!a)for(C=v,v=_.length;C<v;++C)_[m[C]]=0;for(x=s(_),M=new(a?Uint8Array:Array)(g+y),C=0,R=g+y;C<R;)switch(E=P(this,x),E){case 16:for(T=3+I(this,2);T--;)M[C++]=S;break;case 17:for(T=3+I(this,3);T--;)M[C++]=0;S=0;break;case 18:for(T=11+I(this,7);T--;)M[C++]=0;S=0;break;default:S=M[C++]=E}b=s(a?M.subarray(0,g):M.slice(0,g)),w=s(a?M.subarray(g):M.slice(g)),this.j(b,w);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var p,d,f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],m=a?new Uint16Array(f):f,g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],y=a?new Uint16Array(g):g,v=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],_=a?new Uint8Array(v):v,x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],b=a?new Uint16Array(x):x,w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=a?new Uint8Array(w):w,E=new(a?Uint8Array:Array)(288);for(p=0,d=E.length;p<d;++p)E[p]=143>=p?8:255>=p?9:279>=p?7:8;var S,T,A=s(E),C=new(a?Uint8Array:Array)(30);for(S=0,T=C.length;S<T;++S)C[S]=5;var L=s(C);function I(t,e){for(var n,r=t.f,i=t.d,o=t.input,a=t.a,s=o.length;i<e;){if(a>=s)throw Error("input buffer is broken");r|=o[a++]<<i,i+=8}return n=r&(1<<e)-1,t.f=r>>>e,t.d=i-e,t.a=a,n}function P(t,e){for(var n,r,i=t.f,o=t.d,a=t.input,s=t.a,l=a.length,c=e[0],u=e[1];o<u&&!(s>=l);)i|=a[s++]<<o,o+=8;if(n=c[i&(1<<u)-1],r=n>>>16,r>o)throw Error("invalid code length: "+r);return t.f=i>>r,t.d=o-r,t.a=s,65535&n}function R(t,e){var n,r;switch(this.input=t,this.a=0,!e&&(e={})||(e.index&&(this.a=e.index),e.verify&&(this.A=e.verify)),n=t[this.a++],r=t[this.a++],15&n){case O:this.method=O;break;default:throw Error("unsupported compression method")}if(0!==((n<<8)+r)%31)throw Error("invalid fcheck flag:"+((n<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new l(t,{index:this.a,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}l.prototype.j=function(t,e){var n=this.c,r=this.b;this.o=t;for(var i,o,a,s,l=n.length-258;256!==(i=P(this,t));)if(256>i)r>=l&&(this.b=r,n=this.e(),r=this.b),n[r++]=i;else for(o=i-257,s=y[o],0<_[o]&&(s+=I(this,_[o])),i=P(this,e),a=b[i],0<M[i]&&(a+=I(this,M[i])),r>=l&&(this.b=r,n=this.e(),r=this.b);s--;)n[r]=n[r++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},l.prototype.w=function(t,e){var n=this.c,r=this.b;this.o=t;for(var i,o,a,s,l=n.length;256!==(i=P(this,t));)if(256>i)r>=l&&(n=this.e(),l=n.length),n[r++]=i;else for(o=i-257,s=y[o],0<_[o]&&(s+=I(this,_[o])),i=P(this,e),a=b[i],0<M[i]&&(a+=I(this,M[i])),r+s>l&&(n=this.e(),l=n.length);s--;)n[r]=n[r++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},l.prototype.e=function(){var t,e,n=new(a?Uint8Array:Array)(this.b-32768),r=this.b-32768,i=this.c;if(a)n.set(i.subarray(32768,n.length));else for(t=0,e=n.length;t<e;++t)n[t]=i[t+32768];if(this.g.push(n),this.l+=n.length,a)i.set(i.subarray(r,r+32768));else for(t=0;32768>t;++t)i[t]=i[r+t];return this.b=32768,i},l.prototype.z=function(t){var e,n,r,i,o=this.input.length/this.a+1|0,s=this.input,l=this.c;return t&&("number"===typeof t.p&&(o=t.p),"number"===typeof t.u&&(o+=t.u)),2>o?(n=(s.length-this.a)/this.o[2],i=n/2*258|0,r=i<l.length?l.length+i:l.length<<1):r=l.length*o,a?(e=new Uint8Array(r),e.set(l)):e=l,this.c=e},l.prototype.n=function(){var t,e,n,r,i,o=0,s=this.c,l=this.g,c=new(a?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return a?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(e=0,n=l.length;e<n;++e)for(t=l[e],r=0,i=t.length;r<i;++r)c[o++]=t[r];for(e=32768,n=this.b;e<n;++e)c[o++]=s[e];return this.g=[],this.buffer=c},l.prototype.v=function(){var t,e=this.b;return a?this.r?(t=new Uint8Array(e),t.set(this.c.subarray(0,e))):t=this.c.subarray(0,e):(this.c.length>e&&(this.c.length=e),t=this.c),this.buffer=t},R.prototype.k=function(){var t,e,n=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){e=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var r=t;if("string"===typeof r){var i,o,a=r.split("");for(i=0,o=a.length;i<o;i++)a[i]=(255&a[i].charCodeAt(0))>>>0;r=a}for(var s,l=1,c=0,u=r.length,h=0;0<u;){s=1024<u?1024:u,u-=s;do{l+=r[h++],c+=l}while(--s);l%=65521,c%=65521}if(e!==(c<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return t};var O=8;o("Zlib.Inflate",R),o("Zlib.Inflate.prototype.decompress",R.prototype.k);var D,N,k,F,z={ADAPTIVE:h.s,BLOCK:h.t};if(Object.keys)D=Object.keys(z);else for(N in D=[],k=0,z)D[k++]=N;for(k=0,F=D.length;k<F;++k)N=D[k],o("Zlib.Inflate.BufferType."+N,z[N]);var B=n.Zlib;t.exports=B},2413:function(t,e,n){const r=n("e133");t.exports={isOfMetaType:function(t){return function(e){const n=e.featureTarget;return!!n&&(!!n.properties&&n.properties.meta===t)}},isShiftMousedown:function(t){return!!t.originalEvent&&(!!t.originalEvent.shiftKey&&0===t.originalEvent.button)},isActiveFeature:function(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&(t.featureTarget.properties.active===r.activeStates.ACTIVE&&t.featureTarget.properties.meta===r.meta.FEATURE))},isInactiveFeature:function(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&(t.featureTarget.properties.active===r.activeStates.INACTIVE&&t.featureTarget.properties.meta===r.meta.FEATURE))},noTarget:function(t){return void 0===t.featureTarget},isFeature:function(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&t.featureTarget.properties.meta===r.meta.FEATURE)},isVertex:function(t){const e=t.featureTarget;return!!e&&(!!e.properties&&e.properties.meta===r.meta.VERTEX)},isShiftDown:function(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey},isEscapeKey:function(t){return 27===t.keyCode},isEnterKey:function(t){return 13===t.keyCode},true:function(){return!0}}},2466:function(t,e){t.exports=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}]},2788:function(t,e,n){const r=n("7bc4");r.CSS2DObject=function(t){r.Object3D.call(this),this.element=t||document.createElement("div"),this.element.style.position="absolute",this.alwaysVisible=!1,Object.defineProperty(this,"layer",{get(){return this.parent&&this.parent.parent?this.parent.parent.layer:null}}),this.dispose=function(){this.remove(),this.element=null},this.remove=function(){this.element instanceof Element&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)},this.addEventListener("removed",(function(){this.remove()}))},r.CSS2DObject.prototype=Object.assign(Object.create(r.Object3D.prototype),{constructor:r.CSS2DObject,copy:function(t,e){return r.Object3D.prototype.copy.call(this,t,e),this.element=t.element.cloneNode(!0),this}}),r.CSS2DRenderer=function(){var t,e,n,i,o=this,a=new r.Vector3,s=new r.Matrix4,l=new r.Matrix4,c={objects:new WeakMap,list:new Map};this.cacheList=c.list;var u=document.createElement("div");u.style.overflow="hidden",this.domElement=u,this.getSize=function(){return{width:t,height:e}},this.setSize=function(r,o){t=r,e=o,n=t/2,i=e/2,u.style.width=r+"px",u.style.height=o+"px"},this.renderObject=function(t,e,s){if(t instanceof r.CSS2DObject)if(t.visible){t.onBeforeRender(o,e,s),a.setFromMatrixPosition(t.matrixWorld),a.applyMatrix4(l);var p=t.element,d="translate(-50%,-50%) translate("+(a.x*n+n)+"px,"+(-a.y*i+i)+"px)";p.style.WebkitTransform=d,p.style.MozTransform=d,p.style.oTransform=d,p.style.transform=d,p.style.display=t.visible&&a.z>=-1&&a.z<=1?"":"none";var f={distanceToCameraSquared:h(s,t)};c.objects.set({key:t.uuid},f),c.list.set(t.uuid,t),p.parentNode!==u&&u.appendChild(p),t.onAfterRender(o,e,s)}else c.objects.delete({key:t.uuid}),c.list.delete(t.uuid),t.remove();for(var m=0,g=t.children.length;m<g;m++)this.renderObject(t.children[m],e,s)};var h=function(){var t=new r.Vector3,e=new r.Vector3;return function(n,r){return t.setFromMatrixPosition(n.matrixWorld),e.setFromMatrixPosition(r.matrixWorld),t.distanceToSquared(e)}}(),p=function(t){var e=[];return t.traverse((function(t){t instanceof r.CSS2DObject&&e.push(t)})),e},d=function(t){for(var e=p(t).sort((function(t,e){let n=c.objects.get({key:t.uuid}),r=c.objects.get({key:e.uuid});if(n&&r){var i=n.distanceToCameraSquared,o=r.distanceToCameraSquared;return i-o}})),n=e.length,r=0,i=e.length;r<i;r++)e[r].element.style.zIndex=n-r};this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),s.copy(e.matrixWorldInverse),l.multiplyMatrices(e.projectionMatrix,s),this.renderObject(t,t,e),d(t)}},t.exports={CSS2DRenderer:r.CSS2DRenderer,CSS2DObject:r.CSS2DObject}},2877:function(t,e,n){"use strict";function r(t,e,n,r,i,o,a,s){var l,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),r&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),a?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},c._ssrRegister=l):i&&(l=s?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(t,e){return l.call(e),u(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}n.d(e,"a",(function(){return r}))},"2b0e":function(t,e,n){"use strict";(function(t){
/*!
 * Vue.js v2.6.14
 * (c) 2014-2021 Evan You
 * Released under the MIT License.
 */
var n=Object.freeze({});function r(t){return void 0===t||null===t}function i(t){return void 0!==t&&null!==t}function o(t){return!0===t}function a(t){return!1===t}function s(t){return"string"===typeof t||"number"===typeof t||"symbol"===typeof t||"boolean"===typeof t}function l(t){return null!==t&&"object"===typeof t}var c=Object.prototype.toString;function u(t){return"[object Object]"===c.call(t)}function h(t){return"[object RegExp]"===c.call(t)}function p(t){var e=parseFloat(String(t));return e>=0&&Math.floor(e)===e&&isFinite(t)}function d(t){return i(t)&&"function"===typeof t.then&&"function"===typeof t.catch}function f(t){return null==t?"":Array.isArray(t)||u(t)&&t.toString===c?JSON.stringify(t,null,2):String(t)}function m(t){var e=parseFloat(t);return isNaN(e)?t:e}function g(t,e){for(var n=Object.create(null),r=t.split(","),i=0;i<r.length;i++)n[r[i]]=!0;return e?function(t){return n[t.toLowerCase()]}:function(t){return n[t]}}g("slot,component",!0);var y=g("key,ref,slot,slot-scope,is");function v(t,e){if(t.length){var n=t.indexOf(e);if(n>-1)return t.splice(n,1)}}var _=Object.prototype.hasOwnProperty;function x(t,e){return _.call(t,e)}function b(t){var e=Object.create(null);return function(n){var r=e[n];return r||(e[n]=t(n))}}var w=/-(\w)/g,M=b((function(t){return t.replace(w,(function(t,e){return e?e.toUpperCase():""}))})),E=b((function(t){return t.charAt(0).toUpperCase()+t.slice(1)})),S=/\B([A-Z])/g,T=b((function(t){return t.replace(S,"-$1").toLowerCase()}));function A(t,e){function n(n){var r=arguments.length;return r?r>1?t.apply(e,arguments):t.call(e,n):t.call(e)}return n._length=t.length,n}function C(t,e){return t.bind(e)}var L=Function.prototype.bind?C:A;function I(t,e){e=e||0;var n=t.length-e,r=new Array(n);while(n--)r[n]=t[n+e];return r}function P(t,e){for(var n in e)t[n]=e[n];return t}function R(t){for(var e={},n=0;n<t.length;n++)t[n]&&P(e,t[n]);return e}function O(t,e,n){}var D=function(t,e,n){return!1},N=function(t){return t};function k(t,e){if(t===e)return!0;var n=l(t),r=l(e);if(!n||!r)return!n&&!r&&String(t)===String(e);try{var i=Array.isArray(t),o=Array.isArray(e);if(i&&o)return t.length===e.length&&t.every((function(t,n){return k(t,e[n])}));if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(i||o)return!1;var a=Object.keys(t),s=Object.keys(e);return a.length===s.length&&a.every((function(n){return k(t[n],e[n])}))}catch(c){return!1}}function F(t,e){for(var n=0;n<t.length;n++)if(k(t[n],e))return n;return-1}function z(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}}var B="data-server-rendered",U=["component","directive","filter"],j=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],G={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:D,isReservedAttr:D,isUnknownElement:D,getTagNamespace:O,parsePlatformTagName:N,mustUseProp:D,async:!0,_lifecycleHooks:j},V=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function H(t){var e=(t+"").charCodeAt(0);return 36===e||95===e}function W(t,e,n,r){Object.defineProperty(t,e,{value:n,enumerable:!!r,writable:!0,configurable:!0})}var q=new RegExp("[^"+V.source+".$_\\d]");function X(t){if(!q.test(t)){var e=t.split(".");return function(t){for(var n=0;n<e.length;n++){if(!t)return;t=t[e[n]]}return t}}}var Z,Y="__proto__"in{},$="undefined"!==typeof window,J="undefined"!==typeof WXEnvironment&&!!WXEnvironment.platform,K=J&&WXEnvironment.platform.toLowerCase(),Q=$&&window.navigator.userAgent.toLowerCase(),tt=Q&&/msie|trident/.test(Q),et=Q&&Q.indexOf("msie 9.0")>0,nt=Q&&Q.indexOf("edge/")>0,rt=(Q&&Q.indexOf("android"),Q&&/iphone|ipad|ipod|ios/.test(Q)||"ios"===K),it=(Q&&/chrome\/\d+/.test(Q),Q&&/phantomjs/.test(Q),Q&&Q.match(/firefox\/(\d+)/)),ot={}.watch,at=!1;if($)try{var st={};Object.defineProperty(st,"passive",{get:function(){at=!0}}),window.addEventListener("test-passive",null,st)}catch(Ea){}var lt=function(){return void 0===Z&&(Z=!$&&!J&&"undefined"!==typeof t&&(t["process"]&&"server"===t["process"].env.VUE_ENV)),Z},ct=$&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function ut(t){return"function"===typeof t&&/native code/.test(t.toString())}var ht,pt="undefined"!==typeof Symbol&&ut(Symbol)&&"undefined"!==typeof Reflect&&ut(Reflect.ownKeys);ht="undefined"!==typeof Set&&ut(Set)?Set:function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(t){return!0===this.set[t]},t.prototype.add=function(t){this.set[t]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var dt=O,ft=0,mt=function(){this.id=ft++,this.subs=[]};mt.prototype.addSub=function(t){this.subs.push(t)},mt.prototype.removeSub=function(t){v(this.subs,t)},mt.prototype.depend=function(){mt.target&&mt.target.addDep(this)},mt.prototype.notify=function(){var t=this.subs.slice();for(var e=0,n=t.length;e<n;e++)t[e].update()},mt.target=null;var gt=[];function yt(t){gt.push(t),mt.target=t}function vt(){gt.pop(),mt.target=gt[gt.length-1]}var _t=function(t,e,n,r,i,o,a,s){this.tag=t,this.data=e,this.children=n,this.text=r,this.elm=i,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=a,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=s,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},xt={child:{configurable:!0}};xt.child.get=function(){return this.componentInstance},Object.defineProperties(_t.prototype,xt);var bt=function(t){void 0===t&&(t="");var e=new _t;return e.text=t,e.isComment=!0,e};function wt(t){return new _t(void 0,void 0,void 0,String(t))}function Mt(t){var e=new _t(t.tag,t.data,t.children&&t.children.slice(),t.text,t.elm,t.context,t.componentOptions,t.asyncFactory);return e.ns=t.ns,e.isStatic=t.isStatic,e.key=t.key,e.isComment=t.isComment,e.fnContext=t.fnContext,e.fnOptions=t.fnOptions,e.fnScopeId=t.fnScopeId,e.asyncMeta=t.asyncMeta,e.isCloned=!0,e}var Et=Array.prototype,St=Object.create(Et),Tt=["push","pop","shift","unshift","splice","sort","reverse"];Tt.forEach((function(t){var e=Et[t];W(St,t,(function(){var n=[],r=arguments.length;while(r--)n[r]=arguments[r];var i,o=e.apply(this,n),a=this.__ob__;switch(t){case"push":case"unshift":i=n;break;case"splice":i=n.slice(2);break}return i&&a.observeArray(i),a.dep.notify(),o}))}));var At=Object.getOwnPropertyNames(St),Ct=!0;function Lt(t){Ct=t}var It=function(t){this.value=t,this.dep=new mt,this.vmCount=0,W(t,"__ob__",this),Array.isArray(t)?(Y?Pt(t,St):Rt(t,St,At),this.observeArray(t)):this.walk(t)};function Pt(t,e){t.__proto__=e}function Rt(t,e,n){for(var r=0,i=n.length;r<i;r++){var o=n[r];W(t,o,e[o])}}function Ot(t,e){var n;if(l(t)&&!(t instanceof _t))return x(t,"__ob__")&&t.__ob__ instanceof It?n=t.__ob__:Ct&&!lt()&&(Array.isArray(t)||u(t))&&Object.isExtensible(t)&&!t._isVue&&(n=new It(t)),e&&n&&n.vmCount++,n}function Dt(t,e,n,r,i){var o=new mt,a=Object.getOwnPropertyDescriptor(t,e);if(!a||!1!==a.configurable){var s=a&&a.get,l=a&&a.set;s&&!l||2!==arguments.length||(n=t[e]);var c=!i&&Ot(n);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){var e=s?s.call(t):n;return mt.target&&(o.depend(),c&&(c.dep.depend(),Array.isArray(e)&&Ft(e))),e},set:function(e){var r=s?s.call(t):n;e===r||e!==e&&r!==r||s&&!l||(l?l.call(t,e):n=e,c=!i&&Ot(e),o.notify())}})}}function Nt(t,e,n){if(Array.isArray(t)&&p(e))return t.length=Math.max(t.length,e),t.splice(e,1,n),n;if(e in t&&!(e in Object.prototype))return t[e]=n,n;var r=t.__ob__;return t._isVue||r&&r.vmCount?n:r?(Dt(r.value,e,n),r.dep.notify(),n):(t[e]=n,n)}function kt(t,e){if(Array.isArray(t)&&p(e))t.splice(e,1);else{var n=t.__ob__;t._isVue||n&&n.vmCount||x(t,e)&&(delete t[e],n&&n.dep.notify())}}function Ft(t){for(var e=void 0,n=0,r=t.length;n<r;n++)e=t[n],e&&e.__ob__&&e.__ob__.dep.depend(),Array.isArray(e)&&Ft(e)}It.prototype.walk=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)Dt(t,e[n])},It.prototype.observeArray=function(t){for(var e=0,n=t.length;e<n;e++)Ot(t[e])};var zt=G.optionMergeStrategies;function Bt(t,e){if(!e)return t;for(var n,r,i,o=pt?Reflect.ownKeys(e):Object.keys(e),a=0;a<o.length;a++)n=o[a],"__ob__"!==n&&(r=t[n],i=e[n],x(t,n)?r!==i&&u(r)&&u(i)&&Bt(r,i):Nt(t,n,i));return t}function Ut(t,e,n){return n?function(){var r="function"===typeof e?e.call(n,n):e,i="function"===typeof t?t.call(n,n):t;return r?Bt(r,i):i}:e?t?function(){return Bt("function"===typeof e?e.call(this,this):e,"function"===typeof t?t.call(this,this):t)}:e:t}function jt(t,e){var n=e?t?t.concat(e):Array.isArray(e)?e:[e]:t;return n?Gt(n):n}function Gt(t){for(var e=[],n=0;n<t.length;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e}function Vt(t,e,n,r){var i=Object.create(t||null);return e?P(i,e):i}zt.data=function(t,e,n){return n?Ut(t,e,n):e&&"function"!==typeof e?t:Ut(t,e)},j.forEach((function(t){zt[t]=jt})),U.forEach((function(t){zt[t+"s"]=Vt})),zt.watch=function(t,e,n,r){if(t===ot&&(t=void 0),e===ot&&(e=void 0),!e)return Object.create(t||null);if(!t)return e;var i={};for(var o in P(i,t),e){var a=i[o],s=e[o];a&&!Array.isArray(a)&&(a=[a]),i[o]=a?a.concat(s):Array.isArray(s)?s:[s]}return i},zt.props=zt.methods=zt.inject=zt.computed=function(t,e,n,r){if(!t)return e;var i=Object.create(null);return P(i,t),e&&P(i,e),i},zt.provide=Ut;var Ht=function(t,e){return void 0===e?t:e};function Wt(t,e){var n=t.props;if(n){var r,i,o,a={};if(Array.isArray(n)){r=n.length;while(r--)i=n[r],"string"===typeof i&&(o=M(i),a[o]={type:null})}else if(u(n))for(var s in n)i=n[s],o=M(s),a[o]=u(i)?i:{type:i};else 0;t.props=a}}function qt(t,e){var n=t.inject;if(n){var r=t.inject={};if(Array.isArray(n))for(var i=0;i<n.length;i++)r[n[i]]={from:n[i]};else if(u(n))for(var o in n){var a=n[o];r[o]=u(a)?P({from:o},a):{from:a}}else 0}}function Xt(t){var e=t.directives;if(e)for(var n in e){var r=e[n];"function"===typeof r&&(e[n]={bind:r,update:r})}}function Zt(t,e,n){if("function"===typeof e&&(e=e.options),Wt(e,n),qt(e,n),Xt(e),!e._base&&(e.extends&&(t=Zt(t,e.extends,n)),e.mixins))for(var r=0,i=e.mixins.length;r<i;r++)t=Zt(t,e.mixins[r],n);var o,a={};for(o in t)s(o);for(o in e)x(t,o)||s(o);function s(r){var i=zt[r]||Ht;a[r]=i(t[r],e[r],n,r)}return a}function Yt(t,e,n,r){if("string"===typeof n){var i=t[e];if(x(i,n))return i[n];var o=M(n);if(x(i,o))return i[o];var a=E(o);if(x(i,a))return i[a];var s=i[n]||i[o]||i[a];return s}}function $t(t,e,n,r){var i=e[t],o=!x(n,t),a=n[t],s=ee(Boolean,i.type);if(s>-1)if(o&&!x(i,"default"))a=!1;else if(""===a||a===T(t)){var l=ee(String,i.type);(l<0||s<l)&&(a=!0)}if(void 0===a){a=Jt(r,i,t);var c=Ct;Lt(!0),Ot(a),Lt(c)}return a}function Jt(t,e,n){if(x(e,"default")){var r=e.default;return t&&t.$options.propsData&&void 0===t.$options.propsData[n]&&void 0!==t._props[n]?t._props[n]:"function"===typeof r&&"Function"!==Qt(e.type)?r.call(t):r}}var Kt=/^\s*function (\w+)/;function Qt(t){var e=t&&t.toString().match(Kt);return e?e[1]:""}function te(t,e){return Qt(t)===Qt(e)}function ee(t,e){if(!Array.isArray(e))return te(e,t)?0:-1;for(var n=0,r=e.length;n<r;n++)if(te(e[n],t))return n;return-1}function ne(t,e,n){yt();try{if(e){var r=e;while(r=r.$parent){var i=r.$options.errorCaptured;if(i)for(var o=0;o<i.length;o++)try{var a=!1===i[o].call(r,t,e,n);if(a)return}catch(Ea){ie(Ea,r,"errorCaptured hook")}}}ie(t,e,n)}finally{vt()}}function re(t,e,n,r,i){var o;try{o=n?t.apply(e,n):t.call(e),o&&!o._isVue&&d(o)&&!o._handled&&(o.catch((function(t){return ne(t,r,i+" (Promise/async)")})),o._handled=!0)}catch(Ea){ne(Ea,r,i)}return o}function ie(t,e,n){if(G.errorHandler)try{return G.errorHandler.call(null,t,e,n)}catch(Ea){Ea!==t&&oe(Ea,null,"config.errorHandler")}oe(t,e,n)}function oe(t,e,n){if(!$&&!J||"undefined"===typeof console)throw t;console.error(t)}var ae,se=!1,le=[],ce=!1;function ue(){ce=!1;var t=le.slice(0);le.length=0;for(var e=0;e<t.length;e++)t[e]()}if("undefined"!==typeof Promise&&ut(Promise)){var he=Promise.resolve();ae=function(){he.then(ue),rt&&setTimeout(O)},se=!0}else if(tt||"undefined"===typeof MutationObserver||!ut(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())ae="undefined"!==typeof setImmediate&&ut(setImmediate)?function(){setImmediate(ue)}:function(){setTimeout(ue,0)};else{var pe=1,de=new MutationObserver(ue),fe=document.createTextNode(String(pe));de.observe(fe,{characterData:!0}),ae=function(){pe=(pe+1)%2,fe.data=String(pe)},se=!0}function me(t,e){var n;if(le.push((function(){if(t)try{t.call(e)}catch(Ea){ne(Ea,e,"nextTick")}else n&&n(e)})),ce||(ce=!0,ae()),!t&&"undefined"!==typeof Promise)return new Promise((function(t){n=t}))}var ge=new ht;function ye(t){ve(t,ge),ge.clear()}function ve(t,e){var n,r,i=Array.isArray(t);if(!(!i&&!l(t)||Object.isFrozen(t)||t instanceof _t)){if(t.__ob__){var o=t.__ob__.dep.id;if(e.has(o))return;e.add(o)}if(i){n=t.length;while(n--)ve(t[n],e)}else{r=Object.keys(t),n=r.length;while(n--)ve(t[r[n]],e)}}}var _e=b((function(t){var e="&"===t.charAt(0);t=e?t.slice(1):t;var n="~"===t.charAt(0);t=n?t.slice(1):t;var r="!"===t.charAt(0);return t=r?t.slice(1):t,{name:t,once:n,capture:r,passive:e}}));function xe(t,e){function n(){var t=arguments,r=n.fns;if(!Array.isArray(r))return re(r,null,arguments,e,"v-on handler");for(var i=r.slice(),o=0;o<i.length;o++)re(i[o],null,t,e,"v-on handler")}return n.fns=t,n}function be(t,e,n,i,a,s){var l,c,u,h;for(l in t)c=t[l],u=e[l],h=_e(l),r(c)||(r(u)?(r(c.fns)&&(c=t[l]=xe(c,s)),o(h.once)&&(c=t[l]=a(h.name,c,h.capture)),n(h.name,c,h.capture,h.passive,h.params)):c!==u&&(u.fns=c,t[l]=u));for(l in e)r(t[l])&&(h=_e(l),i(h.name,e[l],h.capture))}function we(t,e,n){var a;t instanceof _t&&(t=t.data.hook||(t.data.hook={}));var s=t[e];function l(){n.apply(this,arguments),v(a.fns,l)}r(s)?a=xe([l]):i(s.fns)&&o(s.merged)?(a=s,a.fns.push(l)):a=xe([s,l]),a.merged=!0,t[e]=a}function Me(t,e,n){var o=e.options.props;if(!r(o)){var a={},s=t.attrs,l=t.props;if(i(s)||i(l))for(var c in o){var u=T(c);Ee(a,l,c,u,!0)||Ee(a,s,c,u,!1)}return a}}function Ee(t,e,n,r,o){if(i(e)){if(x(e,n))return t[n]=e[n],o||delete e[n],!0;if(x(e,r))return t[n]=e[r],o||delete e[r],!0}return!1}function Se(t){for(var e=0;e<t.length;e++)if(Array.isArray(t[e]))return Array.prototype.concat.apply([],t);return t}function Te(t){return s(t)?[wt(t)]:Array.isArray(t)?Ce(t):void 0}function Ae(t){return i(t)&&i(t.text)&&a(t.isComment)}function Ce(t,e){var n,a,l,c,u=[];for(n=0;n<t.length;n++)a=t[n],r(a)||"boolean"===typeof a||(l=u.length-1,c=u[l],Array.isArray(a)?a.length>0&&(a=Ce(a,(e||"")+"_"+n),Ae(a[0])&&Ae(c)&&(u[l]=wt(c.text+a[0].text),a.shift()),u.push.apply(u,a)):s(a)?Ae(c)?u[l]=wt(c.text+a):""!==a&&u.push(wt(a)):Ae(a)&&Ae(c)?u[l]=wt(c.text+a.text):(o(t._isVList)&&i(a.tag)&&r(a.key)&&i(e)&&(a.key="__vlist"+e+"_"+n+"__"),u.push(a)));return u}function Le(t){var e=t.$options.provide;e&&(t._provided="function"===typeof e?e.call(t):e)}function Ie(t){var e=Pe(t.$options.inject,t);e&&(Lt(!1),Object.keys(e).forEach((function(n){Dt(t,n,e[n])})),Lt(!0))}function Pe(t,e){if(t){for(var n=Object.create(null),r=pt?Reflect.ownKeys(t):Object.keys(t),i=0;i<r.length;i++){var o=r[i];if("__ob__"!==o){var a=t[o].from,s=e;while(s){if(s._provided&&x(s._provided,a)){n[o]=s._provided[a];break}s=s.$parent}if(!s)if("default"in t[o]){var l=t[o].default;n[o]="function"===typeof l?l.call(e):l}else 0}}return n}}function Re(t,e){if(!t||!t.length)return{};for(var n={},r=0,i=t.length;r<i;r++){var o=t[r],a=o.data;if(a&&a.attrs&&a.attrs.slot&&delete a.attrs.slot,o.context!==e&&o.fnContext!==e||!a||null==a.slot)(n.default||(n.default=[])).push(o);else{var s=a.slot,l=n[s]||(n[s]=[]);"template"===o.tag?l.push.apply(l,o.children||[]):l.push(o)}}for(var c in n)n[c].every(Oe)&&delete n[c];return n}function Oe(t){return t.isComment&&!t.asyncFactory||" "===t.text}function De(t){return t.isComment&&t.asyncFactory}function Ne(t,e,r){var i,o=Object.keys(e).length>0,a=t?!!t.$stable:!o,s=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(a&&r&&r!==n&&s===r.$key&&!o&&!r.$hasNormal)return r;for(var l in i={},t)t[l]&&"$"!==l[0]&&(i[l]=ke(e,l,t[l]))}else i={};for(var c in e)c in i||(i[c]=Fe(e,c));return t&&Object.isExtensible(t)&&(t._normalized=i),W(i,"$stable",a),W(i,"$key",s),W(i,"$hasNormal",o),i}function ke(t,e,n){var r=function(){var t=arguments.length?n.apply(null,arguments):n({});t=t&&"object"===typeof t&&!Array.isArray(t)?[t]:Te(t);var e=t&&t[0];return t&&(!e||1===t.length&&e.isComment&&!De(e))?void 0:t};return n.proxy&&Object.defineProperty(t,e,{get:r,enumerable:!0,configurable:!0}),r}function Fe(t,e){return function(){return t[e]}}function ze(t,e){var n,r,o,a,s;if(Array.isArray(t)||"string"===typeof t)for(n=new Array(t.length),r=0,o=t.length;r<o;r++)n[r]=e(t[r],r);else if("number"===typeof t)for(n=new Array(t),r=0;r<t;r++)n[r]=e(r+1,r);else if(l(t))if(pt&&t[Symbol.iterator]){n=[];var c=t[Symbol.iterator](),u=c.next();while(!u.done)n.push(e(u.value,n.length)),u=c.next()}else for(a=Object.keys(t),n=new Array(a.length),r=0,o=a.length;r<o;r++)s=a[r],n[r]=e(t[s],s,r);return i(n)||(n=[]),n._isVList=!0,n}function Be(t,e,n,r){var i,o=this.$scopedSlots[t];o?(n=n||{},r&&(n=P(P({},r),n)),i=o(n)||("function"===typeof e?e():e)):i=this.$slots[t]||("function"===typeof e?e():e);var a=n&&n.slot;return a?this.$createElement("template",{slot:a},i):i}function Ue(t){return Yt(this.$options,"filters",t,!0)||N}function je(t,e){return Array.isArray(t)?-1===t.indexOf(e):t!==e}function Ge(t,e,n,r,i){var o=G.keyCodes[e]||n;return i&&r&&!G.keyCodes[e]?je(i,r):o?je(o,t):r?T(r)!==e:void 0===t}function Ve(t,e,n,r,i){if(n)if(l(n)){var o;Array.isArray(n)&&(n=R(n));var a=function(a){if("class"===a||"style"===a||y(a))o=t;else{var s=t.attrs&&t.attrs.type;o=r||G.mustUseProp(e,s,a)?t.domProps||(t.domProps={}):t.attrs||(t.attrs={})}var l=M(a),c=T(a);if(!(l in o)&&!(c in o)&&(o[a]=n[a],i)){var u=t.on||(t.on={});u["update:"+a]=function(t){n[a]=t}}};for(var s in n)a(s)}else;return t}function He(t,e){var n=this._staticTrees||(this._staticTrees=[]),r=n[t];return r&&!e||(r=n[t]=this.$options.staticRenderFns[t].call(this._renderProxy,null,this),qe(r,"__static__"+t,!1)),r}function We(t,e,n){return qe(t,"__once__"+e+(n?"_"+n:""),!0),t}function qe(t,e,n){if(Array.isArray(t))for(var r=0;r<t.length;r++)t[r]&&"string"!==typeof t[r]&&Xe(t[r],e+"_"+r,n);else Xe(t,e,n)}function Xe(t,e,n){t.isStatic=!0,t.key=e,t.isOnce=n}function Ze(t,e){if(e)if(u(e)){var n=t.on=t.on?P({},t.on):{};for(var r in e){var i=n[r],o=e[r];n[r]=i?[].concat(i,o):o}}else;return t}function Ye(t,e,n,r){e=e||{$stable:!n};for(var i=0;i<t.length;i++){var o=t[i];Array.isArray(o)?Ye(o,e,n):o&&(o.proxy&&(o.fn.proxy=!0),e[o.key]=o.fn)}return r&&(e.$key=r),e}function $e(t,e){for(var n=0;n<e.length;n+=2){var r=e[n];"string"===typeof r&&r&&(t[e[n]]=e[n+1])}return t}function Je(t,e){return"string"===typeof t?e+t:t}function Ke(t){t._o=We,t._n=m,t._s=f,t._l=ze,t._t=Be,t._q=k,t._i=F,t._m=He,t._f=Ue,t._k=Ge,t._b=Ve,t._v=wt,t._e=bt,t._u=Ye,t._g=Ze,t._d=$e,t._p=Je}function Qe(t,e,r,i,a){var s,l=this,c=a.options;x(i,"_uid")?(s=Object.create(i),s._original=i):(s=i,i=i._original);var u=o(c._compiled),h=!u;this.data=t,this.props=e,this.children=r,this.parent=i,this.listeners=t.on||n,this.injections=Pe(c.inject,i),this.slots=function(){return l.$slots||Ne(t.scopedSlots,l.$slots=Re(r,i)),l.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return Ne(t.scopedSlots,this.slots())}}),u&&(this.$options=c,this.$slots=this.slots(),this.$scopedSlots=Ne(t.scopedSlots,this.$slots)),c._scopeId?this._c=function(t,e,n,r){var o=dn(s,t,e,n,r,h);return o&&!Array.isArray(o)&&(o.fnScopeId=c._scopeId,o.fnContext=i),o}:this._c=function(t,e,n,r){return dn(s,t,e,n,r,h)}}function tn(t,e,r,o,a){var s=t.options,l={},c=s.props;if(i(c))for(var u in c)l[u]=$t(u,c,e||n);else i(r.attrs)&&nn(l,r.attrs),i(r.props)&&nn(l,r.props);var h=new Qe(r,l,a,o,t),p=s.render.call(null,h._c,h);if(p instanceof _t)return en(p,r,h.parent,s,h);if(Array.isArray(p)){for(var d=Te(p)||[],f=new Array(d.length),m=0;m<d.length;m++)f[m]=en(d[m],r,h.parent,s,h);return f}}function en(t,e,n,r,i){var o=Mt(t);return o.fnContext=n,o.fnOptions=r,e.slot&&((o.data||(o.data={})).slot=e.slot),o}function nn(t,e){for(var n in e)t[M(n)]=e[n]}Ke(Qe.prototype);var rn={init:function(t,e){if(t.componentInstance&&!t.componentInstance._isDestroyed&&t.data.keepAlive){var n=t;rn.prepatch(n,n)}else{var r=t.componentInstance=sn(t,Pn);r.$mount(e?t.elm:void 0,e)}},prepatch:function(t,e){var n=e.componentOptions,r=e.componentInstance=t.componentInstance;kn(r,n.propsData,n.listeners,e,n.children)},insert:function(t){var e=t.context,n=t.componentInstance;n._isMounted||(n._isMounted=!0,Un(n,"mounted")),t.data.keepAlive&&(e._isMounted?Qn(n):zn(n,!0))},destroy:function(t){var e=t.componentInstance;e._isDestroyed||(t.data.keepAlive?Bn(e,!0):e.$destroy())}},on=Object.keys(rn);function an(t,e,n,a,s){if(!r(t)){var c=n.$options._base;if(l(t)&&(t=c.extend(t)),"function"===typeof t){var u;if(r(t.cid)&&(u=t,t=Mn(u,c),void 0===t))return wn(u,e,n,a,s);e=e||{},wr(t),i(e.model)&&un(t.options,e);var h=Me(e,t,s);if(o(t.options.functional))return tn(t,h,e,n,a);var p=e.on;if(e.on=e.nativeOn,o(t.options.abstract)){var d=e.slot;e={},d&&(e.slot=d)}ln(e);var f=t.options.name||s,m=new _t("vue-component-"+t.cid+(f?"-"+f:""),e,void 0,void 0,void 0,n,{Ctor:t,propsData:h,listeners:p,tag:s,children:a},u);return m}}}function sn(t,e){var n={_isComponent:!0,_parentVnode:t,parent:e},r=t.data.inlineTemplate;return i(r)&&(n.render=r.render,n.staticRenderFns=r.staticRenderFns),new t.componentOptions.Ctor(n)}function ln(t){for(var e=t.hook||(t.hook={}),n=0;n<on.length;n++){var r=on[n],i=e[r],o=rn[r];i===o||i&&i._merged||(e[r]=i?cn(o,i):o)}}function cn(t,e){var n=function(n,r){t(n,r),e(n,r)};return n._merged=!0,n}function un(t,e){var n=t.model&&t.model.prop||"value",r=t.model&&t.model.event||"input";(e.attrs||(e.attrs={}))[n]=e.model.value;var o=e.on||(e.on={}),a=o[r],s=e.model.callback;i(a)?(Array.isArray(a)?-1===a.indexOf(s):a!==s)&&(o[r]=[s].concat(a)):o[r]=s}var hn=1,pn=2;function dn(t,e,n,r,i,a){return(Array.isArray(n)||s(n))&&(i=r,r=n,n=void 0),o(a)&&(i=pn),fn(t,e,n,r,i)}function fn(t,e,n,r,o){if(i(n)&&i(n.__ob__))return bt();if(i(n)&&i(n.is)&&(e=n.is),!e)return bt();var a,s,l;(Array.isArray(r)&&"function"===typeof r[0]&&(n=n||{},n.scopedSlots={default:r[0]},r.length=0),o===pn?r=Te(r):o===hn&&(r=Se(r)),"string"===typeof e)?(s=t.$vnode&&t.$vnode.ns||G.getTagNamespace(e),a=G.isReservedTag(e)?new _t(G.parsePlatformTagName(e),n,r,void 0,void 0,t):n&&n.pre||!i(l=Yt(t.$options,"components",e))?new _t(e,n,r,void 0,void 0,t):an(l,n,t,r,e)):a=an(e,n,t,r);return Array.isArray(a)?a:i(a)?(i(s)&&mn(a,s),i(n)&&gn(n),a):bt()}function mn(t,e,n){if(t.ns=e,"foreignObject"===t.tag&&(e=void 0,n=!0),i(t.children))for(var a=0,s=t.children.length;a<s;a++){var l=t.children[a];i(l.tag)&&(r(l.ns)||o(n)&&"svg"!==l.tag)&&mn(l,e,n)}}function gn(t){l(t.style)&&ye(t.style),l(t.class)&&ye(t.class)}function yn(t){t._vnode=null,t._staticTrees=null;var e=t.$options,r=t.$vnode=e._parentVnode,i=r&&r.context;t.$slots=Re(e._renderChildren,i),t.$scopedSlots=n,t._c=function(e,n,r,i){return dn(t,e,n,r,i,!1)},t.$createElement=function(e,n,r,i){return dn(t,e,n,r,i,!0)};var o=r&&r.data;Dt(t,"$attrs",o&&o.attrs||n,null,!0),Dt(t,"$listeners",e._parentListeners||n,null,!0)}var vn,_n=null;function xn(t){Ke(t.prototype),t.prototype.$nextTick=function(t){return me(t,this)},t.prototype._render=function(){var t,e=this,n=e.$options,r=n.render,i=n._parentVnode;i&&(e.$scopedSlots=Ne(i.data.scopedSlots,e.$slots,e.$scopedSlots)),e.$vnode=i;try{_n=e,t=r.call(e._renderProxy,e.$createElement)}catch(Ea){ne(Ea,e,"render"),t=e._vnode}finally{_n=null}return Array.isArray(t)&&1===t.length&&(t=t[0]),t instanceof _t||(t=bt()),t.parent=i,t}}function bn(t,e){return(t.__esModule||pt&&"Module"===t[Symbol.toStringTag])&&(t=t.default),l(t)?e.extend(t):t}function wn(t,e,n,r,i){var o=bt();return o.asyncFactory=t,o.asyncMeta={data:e,context:n,children:r,tag:i},o}function Mn(t,e){if(o(t.error)&&i(t.errorComp))return t.errorComp;if(i(t.resolved))return t.resolved;var n=_n;if(n&&i(t.owners)&&-1===t.owners.indexOf(n)&&t.owners.push(n),o(t.loading)&&i(t.loadingComp))return t.loadingComp;if(n&&!i(t.owners)){var a=t.owners=[n],s=!0,c=null,u=null;n.$on("hook:destroyed",(function(){return v(a,n)}));var h=function(t){for(var e=0,n=a.length;e<n;e++)a[e].$forceUpdate();t&&(a.length=0,null!==c&&(clearTimeout(c),c=null),null!==u&&(clearTimeout(u),u=null))},p=z((function(n){t.resolved=bn(n,e),s?a.length=0:h(!0)})),f=z((function(e){i(t.errorComp)&&(t.error=!0,h(!0))})),m=t(p,f);return l(m)&&(d(m)?r(t.resolved)&&m.then(p,f):d(m.component)&&(m.component.then(p,f),i(m.error)&&(t.errorComp=bn(m.error,e)),i(m.loading)&&(t.loadingComp=bn(m.loading,e),0===m.delay?t.loading=!0:c=setTimeout((function(){c=null,r(t.resolved)&&r(t.error)&&(t.loading=!0,h(!1))}),m.delay||200)),i(m.timeout)&&(u=setTimeout((function(){u=null,r(t.resolved)&&f(null)}),m.timeout)))),s=!1,t.loading?t.loadingComp:t.resolved}}function En(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var n=t[e];if(i(n)&&(i(n.componentOptions)||De(n)))return n}}function Sn(t){t._events=Object.create(null),t._hasHookEvent=!1;var e=t.$options._parentListeners;e&&Ln(t,e)}function Tn(t,e){vn.$on(t,e)}function An(t,e){vn.$off(t,e)}function Cn(t,e){var n=vn;return function r(){var i=e.apply(null,arguments);null!==i&&n.$off(t,r)}}function Ln(t,e,n){vn=t,be(e,n||{},Tn,An,Cn,t),vn=void 0}function In(t){var e=/^hook:/;t.prototype.$on=function(t,n){var r=this;if(Array.isArray(t))for(var i=0,o=t.length;i<o;i++)r.$on(t[i],n);else(r._events[t]||(r._events[t]=[])).push(n),e.test(t)&&(r._hasHookEvent=!0);return r},t.prototype.$once=function(t,e){var n=this;function r(){n.$off(t,r),e.apply(n,arguments)}return r.fn=e,n.$on(t,r),n},t.prototype.$off=function(t,e){var n=this;if(!arguments.length)return n._events=Object.create(null),n;if(Array.isArray(t)){for(var r=0,i=t.length;r<i;r++)n.$off(t[r],e);return n}var o,a=n._events[t];if(!a)return n;if(!e)return n._events[t]=null,n;var s=a.length;while(s--)if(o=a[s],o===e||o.fn===e){a.splice(s,1);break}return n},t.prototype.$emit=function(t){var e=this,n=e._events[t];if(n){n=n.length>1?I(n):n;for(var r=I(arguments,1),i='event handler for "'+t+'"',o=0,a=n.length;o<a;o++)re(n[o],e,r,e,i)}return e}}var Pn=null;function Rn(t){var e=Pn;return Pn=t,function(){Pn=e}}function On(t){var e=t.$options,n=e.parent;if(n&&!e.abstract){while(n.$options.abstract&&n.$parent)n=n.$parent;n.$children.push(t)}t.$parent=n,t.$root=n?n.$root:t,t.$children=[],t.$refs={},t._watcher=null,t._inactive=null,t._directInactive=!1,t._isMounted=!1,t._isDestroyed=!1,t._isBeingDestroyed=!1}function Dn(t){t.prototype._update=function(t,e){var n=this,r=n.$el,i=n._vnode,o=Rn(n);n._vnode=t,n.$el=i?n.__patch__(i,t):n.__patch__(n.$el,t,e,!1),o(),r&&(r.__vue__=null),n.$el&&(n.$el.__vue__=n),n.$vnode&&n.$parent&&n.$vnode===n.$parent._vnode&&(n.$parent.$el=n.$el)},t.prototype.$forceUpdate=function(){var t=this;t._watcher&&t._watcher.update()},t.prototype.$destroy=function(){var t=this;if(!t._isBeingDestroyed){Un(t,"beforeDestroy"),t._isBeingDestroyed=!0;var e=t.$parent;!e||e._isBeingDestroyed||t.$options.abstract||v(e.$children,t),t._watcher&&t._watcher.teardown();var n=t._watchers.length;while(n--)t._watchers[n].teardown();t._data.__ob__&&t._data.__ob__.vmCount--,t._isDestroyed=!0,t.__patch__(t._vnode,null),Un(t,"destroyed"),t.$off(),t.$el&&(t.$el.__vue__=null),t.$vnode&&(t.$vnode.parent=null)}}}function Nn(t,e,n){var r;return t.$el=e,t.$options.render||(t.$options.render=bt),Un(t,"beforeMount"),r=function(){t._update(t._render(),n)},new rr(t,r,O,{before:function(){t._isMounted&&!t._isDestroyed&&Un(t,"beforeUpdate")}},!0),n=!1,null==t.$vnode&&(t._isMounted=!0,Un(t,"mounted")),t}function kn(t,e,r,i,o){var a=i.data.scopedSlots,s=t.$scopedSlots,l=!!(a&&!a.$stable||s!==n&&!s.$stable||a&&t.$scopedSlots.$key!==a.$key||!a&&t.$scopedSlots.$key),c=!!(o||t.$options._renderChildren||l);if(t.$options._parentVnode=i,t.$vnode=i,t._vnode&&(t._vnode.parent=i),t.$options._renderChildren=o,t.$attrs=i.data.attrs||n,t.$listeners=r||n,e&&t.$options.props){Lt(!1);for(var u=t._props,h=t.$options._propKeys||[],p=0;p<h.length;p++){var d=h[p],f=t.$options.props;u[d]=$t(d,f,e,t)}Lt(!0),t.$options.propsData=e}r=r||n;var m=t.$options._parentListeners;t.$options._parentListeners=r,Ln(t,r,m),c&&(t.$slots=Re(o,i.context),t.$forceUpdate())}function Fn(t){while(t&&(t=t.$parent))if(t._inactive)return!0;return!1}function zn(t,e){if(e){if(t._directInactive=!1,Fn(t))return}else if(t._directInactive)return;if(t._inactive||null===t._inactive){t._inactive=!1;for(var n=0;n<t.$children.length;n++)zn(t.$children[n]);Un(t,"activated")}}function Bn(t,e){if((!e||(t._directInactive=!0,!Fn(t)))&&!t._inactive){t._inactive=!0;for(var n=0;n<t.$children.length;n++)Bn(t.$children[n]);Un(t,"deactivated")}}function Un(t,e){yt();var n=t.$options[e],r=e+" hook";if(n)for(var i=0,o=n.length;i<o;i++)re(n[i],t,null,t,r);t._hasHookEvent&&t.$emit("hook:"+e),vt()}var jn=[],Gn=[],Vn={},Hn=!1,Wn=!1,qn=0;function Xn(){qn=jn.length=Gn.length=0,Vn={},Hn=Wn=!1}var Zn=0,Yn=Date.now;if($&&!tt){var $n=window.performance;$n&&"function"===typeof $n.now&&Yn()>document.createEvent("Event").timeStamp&&(Yn=function(){return $n.now()})}function Jn(){var t,e;for(Zn=Yn(),Wn=!0,jn.sort((function(t,e){return t.id-e.id})),qn=0;qn<jn.length;qn++)t=jn[qn],t.before&&t.before(),e=t.id,Vn[e]=null,t.run();var n=Gn.slice(),r=jn.slice();Xn(),tr(n),Kn(r),ct&&G.devtools&&ct.emit("flush")}function Kn(t){var e=t.length;while(e--){var n=t[e],r=n.vm;r._watcher===n&&r._isMounted&&!r._isDestroyed&&Un(r,"updated")}}function Qn(t){t._inactive=!1,Gn.push(t)}function tr(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,zn(t[e],!0)}function er(t){var e=t.id;if(null==Vn[e]){if(Vn[e]=!0,Wn){var n=jn.length-1;while(n>qn&&jn[n].id>t.id)n--;jn.splice(n+1,0,t)}else jn.push(t);Hn||(Hn=!0,me(Jn))}}var nr=0,rr=function(t,e,n,r,i){this.vm=t,i&&(t._watcher=this),t._watchers.push(this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync,this.before=r.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++nr,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new ht,this.newDepIds=new ht,this.expression="","function"===typeof e?this.getter=e:(this.getter=X(e),this.getter||(this.getter=O)),this.value=this.lazy?void 0:this.get()};rr.prototype.get=function(){var t;yt(this);var e=this.vm;try{t=this.getter.call(e,e)}catch(Ea){if(!this.user)throw Ea;ne(Ea,e,'getter for watcher "'+this.expression+'"')}finally{this.deep&&ye(t),vt(),this.cleanupDeps()}return t},rr.prototype.addDep=function(t){var e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))},rr.prototype.cleanupDeps=function(){var t=this.deps.length;while(t--){var e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},rr.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():er(this)},rr.prototype.run=function(){if(this.active){var t=this.get();if(t!==this.value||l(t)||this.deep){var e=this.value;if(this.value=t,this.user){var n='callback for watcher "'+this.expression+'"';re(this.cb,this.vm,[t,e],this.vm,n)}else this.cb.call(this.vm,t,e)}}},rr.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},rr.prototype.depend=function(){var t=this.deps.length;while(t--)this.deps[t].depend()},rr.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||v(this.vm._watchers,this);var t=this.deps.length;while(t--)this.deps[t].removeSub(this);this.active=!1}};var ir={enumerable:!0,configurable:!0,get:O,set:O};function or(t,e,n){ir.get=function(){return this[e][n]},ir.set=function(t){this[e][n]=t},Object.defineProperty(t,n,ir)}function ar(t){t._watchers=[];var e=t.$options;e.props&&sr(t,e.props),e.methods&&mr(t,e.methods),e.data?lr(t):Ot(t._data={},!0),e.computed&&hr(t,e.computed),e.watch&&e.watch!==ot&&gr(t,e.watch)}function sr(t,e){var n=t.$options.propsData||{},r=t._props={},i=t.$options._propKeys=[],o=!t.$parent;o||Lt(!1);var a=function(o){i.push(o);var a=$t(o,e,n,t);Dt(r,o,a),o in t||or(t,"_props",o)};for(var s in e)a(s);Lt(!0)}function lr(t){var e=t.$options.data;e=t._data="function"===typeof e?cr(e,t):e||{},u(e)||(e={});var n=Object.keys(e),r=t.$options.props,i=(t.$options.methods,n.length);while(i--){var o=n[i];0,r&&x(r,o)||H(o)||or(t,"_data",o)}Ot(e,!0)}function cr(t,e){yt();try{return t.call(e,e)}catch(Ea){return ne(Ea,e,"data()"),{}}finally{vt()}}var ur={lazy:!0};function hr(t,e){var n=t._computedWatchers=Object.create(null),r=lt();for(var i in e){var o=e[i],a="function"===typeof o?o:o.get;0,r||(n[i]=new rr(t,a||O,O,ur)),i in t||pr(t,i,o)}}function pr(t,e,n){var r=!lt();"function"===typeof n?(ir.get=r?dr(e):fr(n),ir.set=O):(ir.get=n.get?r&&!1!==n.cache?dr(e):fr(n.get):O,ir.set=n.set||O),Object.defineProperty(t,e,ir)}function dr(t){return function(){var e=this._computedWatchers&&this._computedWatchers[t];if(e)return e.dirty&&e.evaluate(),mt.target&&e.depend(),e.value}}function fr(t){return function(){return t.call(this,this)}}function mr(t,e){t.$options.props;for(var n in e)t[n]="function"!==typeof e[n]?O:L(e[n],t)}function gr(t,e){for(var n in e){var r=e[n];if(Array.isArray(r))for(var i=0;i<r.length;i++)yr(t,n,r[i]);else yr(t,n,r)}}function yr(t,e,n,r){return u(n)&&(r=n,n=n.handler),"string"===typeof n&&(n=t[n]),t.$watch(e,n,r)}function vr(t){var e={get:function(){return this._data}},n={get:function(){return this._props}};Object.defineProperty(t.prototype,"$data",e),Object.defineProperty(t.prototype,"$props",n),t.prototype.$set=Nt,t.prototype.$delete=kt,t.prototype.$watch=function(t,e,n){var r=this;if(u(e))return yr(r,t,e,n);n=n||{},n.user=!0;var i=new rr(r,t,e,n);if(n.immediate){var o='callback for immediate watcher "'+i.expression+'"';yt(),re(e,r,[i.value],r,o),vt()}return function(){i.teardown()}}}var _r=0;function xr(t){t.prototype._init=function(t){var e=this;e._uid=_r++,e._isVue=!0,t&&t._isComponent?br(e,t):e.$options=Zt(wr(e.constructor),t||{},e),e._renderProxy=e,e._self=e,On(e),Sn(e),yn(e),Un(e,"beforeCreate"),Ie(e),ar(e),Le(e),Un(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}function br(t,e){var n=t.$options=Object.create(t.constructor.options),r=e._parentVnode;n.parent=e.parent,n._parentVnode=r;var i=r.componentOptions;n.propsData=i.propsData,n._parentListeners=i.listeners,n._renderChildren=i.children,n._componentTag=i.tag,e.render&&(n.render=e.render,n.staticRenderFns=e.staticRenderFns)}function wr(t){var e=t.options;if(t.super){var n=wr(t.super),r=t.superOptions;if(n!==r){t.superOptions=n;var i=Mr(t);i&&P(t.extendOptions,i),e=t.options=Zt(n,t.extendOptions),e.name&&(e.components[e.name]=t)}}return e}function Mr(t){var e,n=t.options,r=t.sealedOptions;for(var i in n)n[i]!==r[i]&&(e||(e={}),e[i]=n[i]);return e}function Er(t){this._init(t)}function Sr(t){t.use=function(t){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(t)>-1)return this;var n=I(arguments,1);return n.unshift(this),"function"===typeof t.install?t.install.apply(t,n):"function"===typeof t&&t.apply(null,n),e.push(t),this}}function Tr(t){t.mixin=function(t){return this.options=Zt(this.options,t),this}}function Ar(t){t.cid=0;var e=1;t.extend=function(t){t=t||{};var n=this,r=n.cid,i=t._Ctor||(t._Ctor={});if(i[r])return i[r];var o=t.name||n.options.name;var a=function(t){this._init(t)};return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.cid=e++,a.options=Zt(n.options,t),a["super"]=n,a.options.props&&Cr(a),a.options.computed&&Lr(a),a.extend=n.extend,a.mixin=n.mixin,a.use=n.use,U.forEach((function(t){a[t]=n[t]})),o&&(a.options.components[o]=a),a.superOptions=n.options,a.extendOptions=t,a.sealedOptions=P({},a.options),i[r]=a,a}}function Cr(t){var e=t.options.props;for(var n in e)or(t.prototype,"_props",n)}function Lr(t){var e=t.options.computed;for(var n in e)pr(t.prototype,n,e[n])}function Ir(t){U.forEach((function(e){t[e]=function(t,n){return n?("component"===e&&u(n)&&(n.name=n.name||t,n=this.options._base.extend(n)),"directive"===e&&"function"===typeof n&&(n={bind:n,update:n}),this.options[e+"s"][t]=n,n):this.options[e+"s"][t]}}))}function Pr(t){return t&&(t.Ctor.options.name||t.tag)}function Rr(t,e){return Array.isArray(t)?t.indexOf(e)>-1:"string"===typeof t?t.split(",").indexOf(e)>-1:!!h(t)&&t.test(e)}function Or(t,e){var n=t.cache,r=t.keys,i=t._vnode;for(var o in n){var a=n[o];if(a){var s=a.name;s&&!e(s)&&Dr(n,o,r,i)}}}function Dr(t,e,n,r){var i=t[e];!i||r&&i.tag===r.tag||i.componentInstance.$destroy(),t[e]=null,v(n,e)}xr(Er),vr(Er),In(Er),Dn(Er),xn(Er);var Nr=[String,RegExp,Array],kr={name:"keep-alive",abstract:!0,props:{include:Nr,exclude:Nr,max:[String,Number]},methods:{cacheVNode:function(){var t=this,e=t.cache,n=t.keys,r=t.vnodeToCache,i=t.keyToCache;if(r){var o=r.tag,a=r.componentInstance,s=r.componentOptions;e[i]={name:Pr(s),tag:o,componentInstance:a},n.push(i),this.max&&n.length>parseInt(this.max)&&Dr(e,n[0],n,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var t in this.cache)Dr(this.cache,t,this.keys)},mounted:function(){var t=this;this.cacheVNode(),this.$watch("include",(function(e){Or(t,(function(t){return Rr(e,t)}))})),this.$watch("exclude",(function(e){Or(t,(function(t){return!Rr(e,t)}))}))},updated:function(){this.cacheVNode()},render:function(){var t=this.$slots.default,e=En(t),n=e&&e.componentOptions;if(n){var r=Pr(n),i=this,o=i.include,a=i.exclude;if(o&&(!r||!Rr(o,r))||a&&r&&Rr(a,r))return e;var s=this,l=s.cache,c=s.keys,u=null==e.key?n.Ctor.cid+(n.tag?"::"+n.tag:""):e.key;l[u]?(e.componentInstance=l[u].componentInstance,v(c,u),c.push(u)):(this.vnodeToCache=e,this.keyToCache=u),e.data.keepAlive=!0}return e||t&&t[0]}},Fr={KeepAlive:kr};function zr(t){var e={get:function(){return G}};Object.defineProperty(t,"config",e),t.util={warn:dt,extend:P,mergeOptions:Zt,defineReactive:Dt},t.set=Nt,t.delete=kt,t.nextTick=me,t.observable=function(t){return Ot(t),t},t.options=Object.create(null),U.forEach((function(e){t.options[e+"s"]=Object.create(null)})),t.options._base=t,P(t.options.components,Fr),Sr(t),Tr(t),Ar(t),Ir(t)}zr(Er),Object.defineProperty(Er.prototype,"$isServer",{get:lt}),Object.defineProperty(Er.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Er,"FunctionalRenderContext",{value:Qe}),Er.version="2.6.14";var Br=g("style,class"),Ur=g("input,textarea,option,select,progress"),jr=function(t,e,n){return"value"===n&&Ur(t)&&"button"!==e||"selected"===n&&"option"===t||"checked"===n&&"input"===t||"muted"===n&&"video"===t},Gr=g("contenteditable,draggable,spellcheck"),Vr=g("events,caret,typing,plaintext-only"),Hr=function(t,e){return Yr(e)||"false"===e?"false":"contenteditable"===t&&Vr(e)?e:"true"},Wr=g("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),qr="http://www.w3.org/1999/xlink",Xr=function(t){return":"===t.charAt(5)&&"xlink"===t.slice(0,5)},Zr=function(t){return Xr(t)?t.slice(6,t.length):""},Yr=function(t){return null==t||!1===t};function $r(t){var e=t.data,n=t,r=t;while(i(r.componentInstance))r=r.componentInstance._vnode,r&&r.data&&(e=Jr(r.data,e));while(i(n=n.parent))n&&n.data&&(e=Jr(e,n.data));return Kr(e.staticClass,e.class)}function Jr(t,e){return{staticClass:Qr(t.staticClass,e.staticClass),class:i(t.class)?[t.class,e.class]:e.class}}function Kr(t,e){return i(t)||i(e)?Qr(t,ti(e)):""}function Qr(t,e){return t?e?t+" "+e:t:e||""}function ti(t){return Array.isArray(t)?ei(t):l(t)?ni(t):"string"===typeof t?t:""}function ei(t){for(var e,n="",r=0,o=t.length;r<o;r++)i(e=ti(t[r]))&&""!==e&&(n&&(n+=" "),n+=e);return n}function ni(t){var e="";for(var n in t)t[n]&&(e&&(e+=" "),e+=n);return e}var ri={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},ii=g("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),oi=g("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),ai=function(t){return ii(t)||oi(t)};function si(t){return oi(t)?"svg":"math"===t?"math":void 0}var li=Object.create(null);function ci(t){if(!$)return!0;if(ai(t))return!1;if(t=t.toLowerCase(),null!=li[t])return li[t];var e=document.createElement(t);return t.indexOf("-")>-1?li[t]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:li[t]=/HTMLUnknownElement/.test(e.toString())}var ui=g("text,number,password,search,email,tel,url");function hi(t){if("string"===typeof t){var e=document.querySelector(t);return e||document.createElement("div")}return t}function pi(t,e){var n=document.createElement(t);return"select"!==t||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n}function di(t,e){return document.createElementNS(ri[t],e)}function fi(t){return document.createTextNode(t)}function mi(t){return document.createComment(t)}function gi(t,e,n){t.insertBefore(e,n)}function yi(t,e){t.removeChild(e)}function vi(t,e){t.appendChild(e)}function _i(t){return t.parentNode}function xi(t){return t.nextSibling}function bi(t){return t.tagName}function wi(t,e){t.textContent=e}function Mi(t,e){t.setAttribute(e,"")}var Ei=Object.freeze({createElement:pi,createElementNS:di,createTextNode:fi,createComment:mi,insertBefore:gi,removeChild:yi,appendChild:vi,parentNode:_i,nextSibling:xi,tagName:bi,setTextContent:wi,setStyleScope:Mi}),Si={create:function(t,e){Ti(e)},update:function(t,e){t.data.ref!==e.data.ref&&(Ti(t,!0),Ti(e))},destroy:function(t){Ti(t,!0)}};function Ti(t,e){var n=t.data.ref;if(i(n)){var r=t.context,o=t.componentInstance||t.elm,a=r.$refs;e?Array.isArray(a[n])?v(a[n],o):a[n]===o&&(a[n]=void 0):t.data.refInFor?Array.isArray(a[n])?a[n].indexOf(o)<0&&a[n].push(o):a[n]=[o]:a[n]=o}}var Ai=new _t("",{},[]),Ci=["create","activate","update","remove","destroy"];function Li(t,e){return t.key===e.key&&t.asyncFactory===e.asyncFactory&&(t.tag===e.tag&&t.isComment===e.isComment&&i(t.data)===i(e.data)&&Ii(t,e)||o(t.isAsyncPlaceholder)&&r(e.asyncFactory.error))}function Ii(t,e){if("input"!==t.tag)return!0;var n,r=i(n=t.data)&&i(n=n.attrs)&&n.type,o=i(n=e.data)&&i(n=n.attrs)&&n.type;return r===o||ui(r)&&ui(o)}function Pi(t,e,n){var r,o,a={};for(r=e;r<=n;++r)o=t[r].key,i(o)&&(a[o]=r);return a}function Ri(t){var e,n,a={},l=t.modules,c=t.nodeOps;for(e=0;e<Ci.length;++e)for(a[Ci[e]]=[],n=0;n<l.length;++n)i(l[n][Ci[e]])&&a[Ci[e]].push(l[n][Ci[e]]);function u(t){return new _t(c.tagName(t).toLowerCase(),{},[],void 0,t)}function h(t,e){function n(){0===--n.listeners&&p(t)}return n.listeners=e,n}function p(t){var e=c.parentNode(t);i(e)&&c.removeChild(e,t)}function d(t,e,n,r,a,s,l){if(i(t.elm)&&i(s)&&(t=s[l]=Mt(t)),t.isRootInsert=!a,!f(t,e,n,r)){var u=t.data,h=t.children,p=t.tag;i(p)?(t.elm=t.ns?c.createElementNS(t.ns,p):c.createElement(p,t),w(t),_(t,h,e),i(u)&&b(t,e),v(n,t.elm,r)):o(t.isComment)?(t.elm=c.createComment(t.text),v(n,t.elm,r)):(t.elm=c.createTextNode(t.text),v(n,t.elm,r))}}function f(t,e,n,r){var a=t.data;if(i(a)){var s=i(t.componentInstance)&&a.keepAlive;if(i(a=a.hook)&&i(a=a.init)&&a(t,!1),i(t.componentInstance))return m(t,e),v(n,t.elm,r),o(s)&&y(t,e,n,r),!0}}function m(t,e){i(t.data.pendingInsert)&&(e.push.apply(e,t.data.pendingInsert),t.data.pendingInsert=null),t.elm=t.componentInstance.$el,x(t)?(b(t,e),w(t)):(Ti(t),e.push(t))}function y(t,e,n,r){var o,s=t;while(s.componentInstance)if(s=s.componentInstance._vnode,i(o=s.data)&&i(o=o.transition)){for(o=0;o<a.activate.length;++o)a.activate[o](Ai,s);e.push(s);break}v(n,t.elm,r)}function v(t,e,n){i(t)&&(i(n)?c.parentNode(n)===t&&c.insertBefore(t,e,n):c.appendChild(t,e))}function _(t,e,n){if(Array.isArray(e)){0;for(var r=0;r<e.length;++r)d(e[r],n,t.elm,null,!0,e,r)}else s(t.text)&&c.appendChild(t.elm,c.createTextNode(String(t.text)))}function x(t){while(t.componentInstance)t=t.componentInstance._vnode;return i(t.tag)}function b(t,n){for(var r=0;r<a.create.length;++r)a.create[r](Ai,t);e=t.data.hook,i(e)&&(i(e.create)&&e.create(Ai,t),i(e.insert)&&n.push(t))}function w(t){var e;if(i(e=t.fnScopeId))c.setStyleScope(t.elm,e);else{var n=t;while(n)i(e=n.context)&&i(e=e.$options._scopeId)&&c.setStyleScope(t.elm,e),n=n.parent}i(e=Pn)&&e!==t.context&&e!==t.fnContext&&i(e=e.$options._scopeId)&&c.setStyleScope(t.elm,e)}function M(t,e,n,r,i,o){for(;r<=i;++r)d(n[r],o,t,e,!1,n,r)}function E(t){var e,n,r=t.data;if(i(r))for(i(e=r.hook)&&i(e=e.destroy)&&e(t),e=0;e<a.destroy.length;++e)a.destroy[e](t);if(i(e=t.children))for(n=0;n<t.children.length;++n)E(t.children[n])}function S(t,e,n){for(;e<=n;++e){var r=t[e];i(r)&&(i(r.tag)?(T(r),E(r)):p(r.elm))}}function T(t,e){if(i(e)||i(t.data)){var n,r=a.remove.length+1;for(i(e)?e.listeners+=r:e=h(t.elm,r),i(n=t.componentInstance)&&i(n=n._vnode)&&i(n.data)&&T(n,e),n=0;n<a.remove.length;++n)a.remove[n](t,e);i(n=t.data.hook)&&i(n=n.remove)?n(t,e):e()}else p(t.elm)}function A(t,e,n,o,a){var s,l,u,h,p=0,f=0,m=e.length-1,g=e[0],y=e[m],v=n.length-1,_=n[0],x=n[v],b=!a;while(p<=m&&f<=v)r(g)?g=e[++p]:r(y)?y=e[--m]:Li(g,_)?(L(g,_,o,n,f),g=e[++p],_=n[++f]):Li(y,x)?(L(y,x,o,n,v),y=e[--m],x=n[--v]):Li(g,x)?(L(g,x,o,n,v),b&&c.insertBefore(t,g.elm,c.nextSibling(y.elm)),g=e[++p],x=n[--v]):Li(y,_)?(L(y,_,o,n,f),b&&c.insertBefore(t,y.elm,g.elm),y=e[--m],_=n[++f]):(r(s)&&(s=Pi(e,p,m)),l=i(_.key)?s[_.key]:C(_,e,p,m),r(l)?d(_,o,t,g.elm,!1,n,f):(u=e[l],Li(u,_)?(L(u,_,o,n,f),e[l]=void 0,b&&c.insertBefore(t,u.elm,g.elm)):d(_,o,t,g.elm,!1,n,f)),_=n[++f]);p>m?(h=r(n[v+1])?null:n[v+1].elm,M(t,h,n,f,v,o)):f>v&&S(e,p,m)}function C(t,e,n,r){for(var o=n;o<r;o++){var a=e[o];if(i(a)&&Li(t,a))return o}}function L(t,e,n,s,l,u){if(t!==e){i(e.elm)&&i(s)&&(e=s[l]=Mt(e));var h=e.elm=t.elm;if(o(t.isAsyncPlaceholder))i(e.asyncFactory.resolved)?R(t.elm,e,n):e.isAsyncPlaceholder=!0;else if(o(e.isStatic)&&o(t.isStatic)&&e.key===t.key&&(o(e.isCloned)||o(e.isOnce)))e.componentInstance=t.componentInstance;else{var p,d=e.data;i(d)&&i(p=d.hook)&&i(p=p.prepatch)&&p(t,e);var f=t.children,m=e.children;if(i(d)&&x(e)){for(p=0;p<a.update.length;++p)a.update[p](t,e);i(p=d.hook)&&i(p=p.update)&&p(t,e)}r(e.text)?i(f)&&i(m)?f!==m&&A(h,f,m,n,u):i(m)?(i(t.text)&&c.setTextContent(h,""),M(h,null,m,0,m.length-1,n)):i(f)?S(f,0,f.length-1):i(t.text)&&c.setTextContent(h,""):t.text!==e.text&&c.setTextContent(h,e.text),i(d)&&i(p=d.hook)&&i(p=p.postpatch)&&p(t,e)}}}function I(t,e,n){if(o(n)&&i(t.parent))t.parent.data.pendingInsert=e;else for(var r=0;r<e.length;++r)e[r].data.hook.insert(e[r])}var P=g("attrs,class,staticClass,staticStyle,key");function R(t,e,n,r){var a,s=e.tag,l=e.data,c=e.children;if(r=r||l&&l.pre,e.elm=t,o(e.isComment)&&i(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(i(l)&&(i(a=l.hook)&&i(a=a.init)&&a(e,!0),i(a=e.componentInstance)))return m(e,n),!0;if(i(s)){if(i(c))if(t.hasChildNodes())if(i(a=l)&&i(a=a.domProps)&&i(a=a.innerHTML)){if(a!==t.innerHTML)return!1}else{for(var u=!0,h=t.firstChild,p=0;p<c.length;p++){if(!h||!R(h,c[p],n,r)){u=!1;break}h=h.nextSibling}if(!u||h)return!1}else _(e,c,n);if(i(l)){var d=!1;for(var f in l)if(!P(f)){d=!0,b(e,n);break}!d&&l["class"]&&ye(l["class"])}}else t.data!==e.text&&(t.data=e.text);return!0}return function(t,e,n,s){if(!r(e)){var l=!1,h=[];if(r(t))l=!0,d(e,h);else{var p=i(t.nodeType);if(!p&&Li(t,e))L(t,e,h,null,null,s);else{if(p){if(1===t.nodeType&&t.hasAttribute(B)&&(t.removeAttribute(B),n=!0),o(n)&&R(t,e,h))return I(e,h,!0),t;t=u(t)}var f=t.elm,m=c.parentNode(f);if(d(e,h,f._leaveCb?null:m,c.nextSibling(f)),i(e.parent)){var g=e.parent,y=x(e);while(g){for(var v=0;v<a.destroy.length;++v)a.destroy[v](g);if(g.elm=e.elm,y){for(var _=0;_<a.create.length;++_)a.create[_](Ai,g);var b=g.data.hook.insert;if(b.merged)for(var w=1;w<b.fns.length;w++)b.fns[w]()}else Ti(g);g=g.parent}}i(m)?S([t],0,0):i(t.tag)&&E(t)}}return I(e,h,l),e.elm}i(t)&&E(t)}}var Oi={create:Di,update:Di,destroy:function(t){Di(t,Ai)}};function Di(t,e){(t.data.directives||e.data.directives)&&Ni(t,e)}function Ni(t,e){var n,r,i,o=t===Ai,a=e===Ai,s=Fi(t.data.directives,t.context),l=Fi(e.data.directives,e.context),c=[],u=[];for(n in l)r=s[n],i=l[n],r?(i.oldValue=r.value,i.oldArg=r.arg,Bi(i,"update",e,t),i.def&&i.def.componentUpdated&&u.push(i)):(Bi(i,"bind",e,t),i.def&&i.def.inserted&&c.push(i));if(c.length){var h=function(){for(var n=0;n<c.length;n++)Bi(c[n],"inserted",e,t)};o?we(e,"insert",h):h()}if(u.length&&we(e,"postpatch",(function(){for(var n=0;n<u.length;n++)Bi(u[n],"componentUpdated",e,t)})),!o)for(n in s)l[n]||Bi(s[n],"unbind",t,t,a)}var ki=Object.create(null);function Fi(t,e){var n,r,i=Object.create(null);if(!t)return i;for(n=0;n<t.length;n++)r=t[n],r.modifiers||(r.modifiers=ki),i[zi(r)]=r,r.def=Yt(e.$options,"directives",r.name,!0);return i}function zi(t){return t.rawName||t.name+"."+Object.keys(t.modifiers||{}).join(".")}function Bi(t,e,n,r,i){var o=t.def&&t.def[e];if(o)try{o(n.elm,t,n,r,i)}catch(Ea){ne(Ea,n.context,"directive "+t.name+" "+e+" hook")}}var Ui=[Si,Oi];function ji(t,e){var n=e.componentOptions;if((!i(n)||!1!==n.Ctor.options.inheritAttrs)&&(!r(t.data.attrs)||!r(e.data.attrs))){var o,a,s,l=e.elm,c=t.data.attrs||{},u=e.data.attrs||{};for(o in i(u.__ob__)&&(u=e.data.attrs=P({},u)),u)a=u[o],s=c[o],s!==a&&Gi(l,o,a,e.data.pre);for(o in(tt||nt)&&u.value!==c.value&&Gi(l,"value",u.value),c)r(u[o])&&(Xr(o)?l.removeAttributeNS(qr,Zr(o)):Gr(o)||l.removeAttribute(o))}}function Gi(t,e,n,r){r||t.tagName.indexOf("-")>-1?Vi(t,e,n):Wr(e)?Yr(n)?t.removeAttribute(e):(n="allowfullscreen"===e&&"EMBED"===t.tagName?"true":e,t.setAttribute(e,n)):Gr(e)?t.setAttribute(e,Hr(e,n)):Xr(e)?Yr(n)?t.removeAttributeNS(qr,Zr(e)):t.setAttributeNS(qr,e,n):Vi(t,e,n)}function Vi(t,e,n){if(Yr(n))t.removeAttribute(e);else{if(tt&&!et&&"TEXTAREA"===t.tagName&&"placeholder"===e&&""!==n&&!t.__ieph){var r=function(e){e.stopImmediatePropagation(),t.removeEventListener("input",r)};t.addEventListener("input",r),t.__ieph=!0}t.setAttribute(e,n)}}var Hi={create:ji,update:ji};function Wi(t,e){var n=e.elm,o=e.data,a=t.data;if(!(r(o.staticClass)&&r(o.class)&&(r(a)||r(a.staticClass)&&r(a.class)))){var s=$r(e),l=n._transitionClasses;i(l)&&(s=Qr(s,ti(l))),s!==n._prevClass&&(n.setAttribute("class",s),n._prevClass=s)}}var qi,Xi={create:Wi,update:Wi},Zi="__r",Yi="__c";function $i(t){if(i(t[Zi])){var e=tt?"change":"input";t[e]=[].concat(t[Zi],t[e]||[]),delete t[Zi]}i(t[Yi])&&(t.change=[].concat(t[Yi],t.change||[]),delete t[Yi])}function Ji(t,e,n){var r=qi;return function i(){var o=e.apply(null,arguments);null!==o&&to(t,i,n,r)}}var Ki=se&&!(it&&Number(it[1])<=53);function Qi(t,e,n,r){if(Ki){var i=Zn,o=e;e=o._wrapper=function(t){if(t.target===t.currentTarget||t.timeStamp>=i||t.timeStamp<=0||t.target.ownerDocument!==document)return o.apply(this,arguments)}}qi.addEventListener(t,e,at?{capture:n,passive:r}:n)}function to(t,e,n,r){(r||qi).removeEventListener(t,e._wrapper||e,n)}function eo(t,e){if(!r(t.data.on)||!r(e.data.on)){var n=e.data.on||{},i=t.data.on||{};qi=e.elm,$i(n),be(n,i,Qi,to,Ji,e.context),qi=void 0}}var no,ro={create:eo,update:eo};function io(t,e){if(!r(t.data.domProps)||!r(e.data.domProps)){var n,o,a=e.elm,s=t.data.domProps||{},l=e.data.domProps||{};for(n in i(l.__ob__)&&(l=e.data.domProps=P({},l)),s)n in l||(a[n]="");for(n in l){if(o=l[n],"textContent"===n||"innerHTML"===n){if(e.children&&(e.children.length=0),o===s[n])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===n&&"PROGRESS"!==a.tagName){a._value=o;var c=r(o)?"":String(o);oo(a,c)&&(a.value=c)}else if("innerHTML"===n&&oi(a.tagName)&&r(a.innerHTML)){no=no||document.createElement("div"),no.innerHTML="<svg>"+o+"</svg>";var u=no.firstChild;while(a.firstChild)a.removeChild(a.firstChild);while(u.firstChild)a.appendChild(u.firstChild)}else if(o!==s[n])try{a[n]=o}catch(Ea){}}}}function oo(t,e){return!t.composing&&("OPTION"===t.tagName||ao(t,e)||so(t,e))}function ao(t,e){var n=!0;try{n=document.activeElement!==t}catch(Ea){}return n&&t.value!==e}function so(t,e){var n=t.value,r=t._vModifiers;if(i(r)){if(r.number)return m(n)!==m(e);if(r.trim)return n.trim()!==e.trim()}return n!==e}var lo={create:io,update:io},co=b((function(t){var e={},n=/;(?![^(]*\))/g,r=/:(.+)/;return t.split(n).forEach((function(t){if(t){var n=t.split(r);n.length>1&&(e[n[0].trim()]=n[1].trim())}})),e}));function uo(t){var e=ho(t.style);return t.staticStyle?P(t.staticStyle,e):e}function ho(t){return Array.isArray(t)?R(t):"string"===typeof t?co(t):t}function po(t,e){var n,r={};if(e){var i=t;while(i.componentInstance)i=i.componentInstance._vnode,i&&i.data&&(n=uo(i.data))&&P(r,n)}(n=uo(t.data))&&P(r,n);var o=t;while(o=o.parent)o.data&&(n=uo(o.data))&&P(r,n);return r}var fo,mo=/^--/,go=/\s*!important$/,yo=function(t,e,n){if(mo.test(e))t.style.setProperty(e,n);else if(go.test(n))t.style.setProperty(T(e),n.replace(go,""),"important");else{var r=_o(e);if(Array.isArray(n))for(var i=0,o=n.length;i<o;i++)t.style[r]=n[i];else t.style[r]=n}},vo=["Webkit","Moz","ms"],_o=b((function(t){if(fo=fo||document.createElement("div").style,t=M(t),"filter"!==t&&t in fo)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),n=0;n<vo.length;n++){var r=vo[n]+e;if(r in fo)return r}}));function xo(t,e){var n=e.data,o=t.data;if(!(r(n.staticStyle)&&r(n.style)&&r(o.staticStyle)&&r(o.style))){var a,s,l=e.elm,c=o.staticStyle,u=o.normalizedStyle||o.style||{},h=c||u,p=ho(e.data.style)||{};e.data.normalizedStyle=i(p.__ob__)?P({},p):p;var d=po(e,!0);for(s in h)r(d[s])&&yo(l,s,"");for(s in d)a=d[s],a!==h[s]&&yo(l,s,null==a?"":a)}}var bo={create:xo,update:xo},wo=/\s+/;function Mo(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(wo).forEach((function(e){return t.classList.add(e)})):t.classList.add(e);else{var n=" "+(t.getAttribute("class")||"")+" ";n.indexOf(" "+e+" ")<0&&t.setAttribute("class",(n+e).trim())}}function Eo(t,e){if(e&&(e=e.trim()))if(t.classList)e.indexOf(" ")>-1?e.split(wo).forEach((function(e){return t.classList.remove(e)})):t.classList.remove(e),t.classList.length||t.removeAttribute("class");else{var n=" "+(t.getAttribute("class")||"")+" ",r=" "+e+" ";while(n.indexOf(r)>=0)n=n.replace(r," ");n=n.trim(),n?t.setAttribute("class",n):t.removeAttribute("class")}}function So(t){if(t){if("object"===typeof t){var e={};return!1!==t.css&&P(e,To(t.name||"v")),P(e,t),e}return"string"===typeof t?To(t):void 0}}var To=b((function(t){return{enterClass:t+"-enter",enterToClass:t+"-enter-to",enterActiveClass:t+"-enter-active",leaveClass:t+"-leave",leaveToClass:t+"-leave-to",leaveActiveClass:t+"-leave-active"}})),Ao=$&&!et,Co="transition",Lo="animation",Io="transition",Po="transitionend",Ro="animation",Oo="animationend";Ao&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Io="WebkitTransition",Po="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Ro="WebkitAnimation",Oo="webkitAnimationEnd"));var Do=$?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(t){return t()};function No(t){Do((function(){Do(t)}))}function ko(t,e){var n=t._transitionClasses||(t._transitionClasses=[]);n.indexOf(e)<0&&(n.push(e),Mo(t,e))}function Fo(t,e){t._transitionClasses&&v(t._transitionClasses,e),Eo(t,e)}function zo(t,e,n){var r=Uo(t,e),i=r.type,o=r.timeout,a=r.propCount;if(!i)return n();var s=i===Co?Po:Oo,l=0,c=function(){t.removeEventListener(s,u),n()},u=function(e){e.target===t&&++l>=a&&c()};setTimeout((function(){l<a&&c()}),o+1),t.addEventListener(s,u)}var Bo=/\b(transform|all)(,|$)/;function Uo(t,e){var n,r=window.getComputedStyle(t),i=(r[Io+"Delay"]||"").split(", "),o=(r[Io+"Duration"]||"").split(", "),a=jo(i,o),s=(r[Ro+"Delay"]||"").split(", "),l=(r[Ro+"Duration"]||"").split(", "),c=jo(s,l),u=0,h=0;e===Co?a>0&&(n=Co,u=a,h=o.length):e===Lo?c>0&&(n=Lo,u=c,h=l.length):(u=Math.max(a,c),n=u>0?a>c?Co:Lo:null,h=n?n===Co?o.length:l.length:0);var p=n===Co&&Bo.test(r[Io+"Property"]);return{type:n,timeout:u,propCount:h,hasTransform:p}}function jo(t,e){while(t.length<e.length)t=t.concat(t);return Math.max.apply(null,e.map((function(e,n){return Go(e)+Go(t[n])})))}function Go(t){return 1e3*Number(t.slice(0,-1).replace(",","."))}function Vo(t,e){var n=t.elm;i(n._leaveCb)&&(n._leaveCb.cancelled=!0,n._leaveCb());var o=So(t.data.transition);if(!r(o)&&!i(n._enterCb)&&1===n.nodeType){var a=o.css,s=o.type,c=o.enterClass,u=o.enterToClass,h=o.enterActiveClass,p=o.appearClass,d=o.appearToClass,f=o.appearActiveClass,g=o.beforeEnter,y=o.enter,v=o.afterEnter,_=o.enterCancelled,x=o.beforeAppear,b=o.appear,w=o.afterAppear,M=o.appearCancelled,E=o.duration,S=Pn,T=Pn.$vnode;while(T&&T.parent)S=T.context,T=T.parent;var A=!S._isMounted||!t.isRootInsert;if(!A||b||""===b){var C=A&&p?p:c,L=A&&f?f:h,I=A&&d?d:u,P=A&&x||g,R=A&&"function"===typeof b?b:y,O=A&&w||v,D=A&&M||_,N=m(l(E)?E.enter:E);0;var k=!1!==a&&!et,F=qo(R),B=n._enterCb=z((function(){k&&(Fo(n,I),Fo(n,L)),B.cancelled?(k&&Fo(n,C),D&&D(n)):O&&O(n),n._enterCb=null}));t.data.show||we(t,"insert",(function(){var e=n.parentNode,r=e&&e._pending&&e._pending[t.key];r&&r.tag===t.tag&&r.elm._leaveCb&&r.elm._leaveCb(),R&&R(n,B)})),P&&P(n),k&&(ko(n,C),ko(n,L),No((function(){Fo(n,C),B.cancelled||(ko(n,I),F||(Wo(N)?setTimeout(B,N):zo(n,s,B)))}))),t.data.show&&(e&&e(),R&&R(n,B)),k||F||B()}}}function Ho(t,e){var n=t.elm;i(n._enterCb)&&(n._enterCb.cancelled=!0,n._enterCb());var o=So(t.data.transition);if(r(o)||1!==n.nodeType)return e();if(!i(n._leaveCb)){var a=o.css,s=o.type,c=o.leaveClass,u=o.leaveToClass,h=o.leaveActiveClass,p=o.beforeLeave,d=o.leave,f=o.afterLeave,g=o.leaveCancelled,y=o.delayLeave,v=o.duration,_=!1!==a&&!et,x=qo(d),b=m(l(v)?v.leave:v);0;var w=n._leaveCb=z((function(){n.parentNode&&n.parentNode._pending&&(n.parentNode._pending[t.key]=null),_&&(Fo(n,u),Fo(n,h)),w.cancelled?(_&&Fo(n,c),g&&g(n)):(e(),f&&f(n)),n._leaveCb=null}));y?y(M):M()}function M(){w.cancelled||(!t.data.show&&n.parentNode&&((n.parentNode._pending||(n.parentNode._pending={}))[t.key]=t),p&&p(n),_&&(ko(n,c),ko(n,h),No((function(){Fo(n,c),w.cancelled||(ko(n,u),x||(Wo(b)?setTimeout(w,b):zo(n,s,w)))}))),d&&d(n,w),_||x||w())}}function Wo(t){return"number"===typeof t&&!isNaN(t)}function qo(t){if(r(t))return!1;var e=t.fns;return i(e)?qo(Array.isArray(e)?e[0]:e):(t._length||t.length)>1}function Xo(t,e){!0!==e.data.show&&Vo(e)}var Zo=$?{create:Xo,activate:Xo,remove:function(t,e){!0!==t.data.show?Ho(t,e):e()}}:{},Yo=[Hi,Xi,ro,lo,bo,Zo],$o=Yo.concat(Ui),Jo=Ri({nodeOps:Ei,modules:$o});et&&document.addEventListener("selectionchange",(function(){var t=document.activeElement;t&&t.vmodel&&oa(t,"input")}));var Ko={inserted:function(t,e,n,r){"select"===n.tag?(r.elm&&!r.elm._vOptions?we(n,"postpatch",(function(){Ko.componentUpdated(t,e,n)})):Qo(t,e,n.context),t._vOptions=[].map.call(t.options,na)):("textarea"===n.tag||ui(t.type))&&(t._vModifiers=e.modifiers,e.modifiers.lazy||(t.addEventListener("compositionstart",ra),t.addEventListener("compositionend",ia),t.addEventListener("change",ia),et&&(t.vmodel=!0)))},componentUpdated:function(t,e,n){if("select"===n.tag){Qo(t,e,n.context);var r=t._vOptions,i=t._vOptions=[].map.call(t.options,na);if(i.some((function(t,e){return!k(t,r[e])}))){var o=t.multiple?e.value.some((function(t){return ea(t,i)})):e.value!==e.oldValue&&ea(e.value,i);o&&oa(t,"change")}}}};function Qo(t,e,n){ta(t,e,n),(tt||nt)&&setTimeout((function(){ta(t,e,n)}),0)}function ta(t,e,n){var r=e.value,i=t.multiple;if(!i||Array.isArray(r)){for(var o,a,s=0,l=t.options.length;s<l;s++)if(a=t.options[s],i)o=F(r,na(a))>-1,a.selected!==o&&(a.selected=o);else if(k(na(a),r))return void(t.selectedIndex!==s&&(t.selectedIndex=s));i||(t.selectedIndex=-1)}}function ea(t,e){return e.every((function(e){return!k(e,t)}))}function na(t){return"_value"in t?t._value:t.value}function ra(t){t.target.composing=!0}function ia(t){t.target.composing&&(t.target.composing=!1,oa(t.target,"input"))}function oa(t,e){var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),t.dispatchEvent(n)}function aa(t){return!t.componentInstance||t.data&&t.data.transition?t:aa(t.componentInstance._vnode)}var sa={bind:function(t,e,n){var r=e.value;n=aa(n);var i=n.data&&n.data.transition,o=t.__vOriginalDisplay="none"===t.style.display?"":t.style.display;r&&i?(n.data.show=!0,Vo(n,(function(){t.style.display=o}))):t.style.display=r?o:"none"},update:function(t,e,n){var r=e.value,i=e.oldValue;if(!r!==!i){n=aa(n);var o=n.data&&n.data.transition;o?(n.data.show=!0,r?Vo(n,(function(){t.style.display=t.__vOriginalDisplay})):Ho(n,(function(){t.style.display="none"}))):t.style.display=r?t.__vOriginalDisplay:"none"}},unbind:function(t,e,n,r,i){i||(t.style.display=t.__vOriginalDisplay)}},la={model:Ko,show:sa},ca={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function ua(t){var e=t&&t.componentOptions;return e&&e.Ctor.options.abstract?ua(En(e.children)):t}function ha(t){var e={},n=t.$options;for(var r in n.propsData)e[r]=t[r];var i=n._parentListeners;for(var o in i)e[M(o)]=i[o];return e}function pa(t,e){if(/\d-keep-alive$/.test(e.tag))return t("keep-alive",{props:e.componentOptions.propsData})}function da(t){while(t=t.parent)if(t.data.transition)return!0}function fa(t,e){return e.key===t.key&&e.tag===t.tag}var ma=function(t){return t.tag||De(t)},ga=function(t){return"show"===t.name},ya={name:"transition",props:ca,abstract:!0,render:function(t){var e=this,n=this.$slots.default;if(n&&(n=n.filter(ma),n.length)){0;var r=this.mode;0;var i=n[0];if(da(this.$vnode))return i;var o=ua(i);if(!o)return i;if(this._leaving)return pa(t,i);var a="__transition-"+this._uid+"-";o.key=null==o.key?o.isComment?a+"comment":a+o.tag:s(o.key)?0===String(o.key).indexOf(a)?o.key:a+o.key:o.key;var l=(o.data||(o.data={})).transition=ha(this),c=this._vnode,u=ua(c);if(o.data.directives&&o.data.directives.some(ga)&&(o.data.show=!0),u&&u.data&&!fa(o,u)&&!De(u)&&(!u.componentInstance||!u.componentInstance._vnode.isComment)){var h=u.data.transition=P({},l);if("out-in"===r)return this._leaving=!0,we(h,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),pa(t,i);if("in-out"===r){if(De(o))return c;var p,d=function(){p()};we(l,"afterEnter",d),we(l,"enterCancelled",d),we(h,"delayLeave",(function(t){p=t}))}}return i}}},va=P({tag:String,moveClass:String},ca);delete va.mode;var _a={props:va,beforeMount:function(){var t=this,e=this._update;this._update=function(n,r){var i=Rn(t);t.__patch__(t._vnode,t.kept,!1,!0),t._vnode=t.kept,i(),e.call(t,n,r)}},render:function(t){for(var e=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),r=this.prevChildren=this.children,i=this.$slots.default||[],o=this.children=[],a=ha(this),s=0;s<i.length;s++){var l=i[s];if(l.tag)if(null!=l.key&&0!==String(l.key).indexOf("__vlist"))o.push(l),n[l.key]=l,(l.data||(l.data={})).transition=a;else;}if(r){for(var c=[],u=[],h=0;h<r.length;h++){var p=r[h];p.data.transition=a,p.data.pos=p.elm.getBoundingClientRect(),n[p.key]?c.push(p):u.push(p)}this.kept=t(e,null,c),this.removed=u}return t(e,null,o)},updated:function(){var t=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";t.length&&this.hasMove(t[0].elm,e)&&(t.forEach(xa),t.forEach(ba),t.forEach(wa),this._reflow=document.body.offsetHeight,t.forEach((function(t){if(t.data.moved){var n=t.elm,r=n.style;ko(n,e),r.transform=r.WebkitTransform=r.transitionDuration="",n.addEventListener(Po,n._moveCb=function t(r){r&&r.target!==n||r&&!/transform$/.test(r.propertyName)||(n.removeEventListener(Po,t),n._moveCb=null,Fo(n,e))})}})))},methods:{hasMove:function(t,e){if(!Ao)return!1;if(this._hasMove)return this._hasMove;var n=t.cloneNode();t._transitionClasses&&t._transitionClasses.forEach((function(t){Eo(n,t)})),Mo(n,e),n.style.display="none",this.$el.appendChild(n);var r=Uo(n);return this.$el.removeChild(n),this._hasMove=r.hasTransform}}};function xa(t){t.elm._moveCb&&t.elm._moveCb(),t.elm._enterCb&&t.elm._enterCb()}function ba(t){t.data.newPos=t.elm.getBoundingClientRect()}function wa(t){var e=t.data.pos,n=t.data.newPos,r=e.left-n.left,i=e.top-n.top;if(r||i){t.data.moved=!0;var o=t.elm.style;o.transform=o.WebkitTransform="translate("+r+"px,"+i+"px)",o.transitionDuration="0s"}}var Ma={Transition:ya,TransitionGroup:_a};Er.config.mustUseProp=jr,Er.config.isReservedTag=ai,Er.config.isReservedAttr=Br,Er.config.getTagNamespace=si,Er.config.isUnknownElement=ci,P(Er.options.directives,la),P(Er.options.components,Ma),Er.prototype.__patch__=$?Jo:O,Er.prototype.$mount=function(t,e){return t=t&&$?hi(t):void 0,Nn(this,t,e)},$&&setTimeout((function(){G.devtools&&ct&&ct.emit("init",Er)}),0),e["a"]=Er}).call(this,n("c8ba"))},"2f62":function(t,e,n){"use strict";(function(t){
/*!
 * vuex v3.6.2
 * (c) 2021 Evan You
 * @license MIT
 */
function n(t){var e=Number(t.version.split(".")[0]);if(e>=2)t.mixin({beforeCreate:r});else{var n=t.prototype._init;t.prototype._init=function(t){void 0===t&&(t={}),t.init=t.init?[r].concat(t.init):r,n.call(this,t)}}function r(){var t=this.$options;t.store?this.$store="function"===typeof t.store?t.store():t.store:t.parent&&t.parent.$store&&(this.$store=t.parent.$store)}}var r="undefined"!==typeof window?window:"undefined"!==typeof t?t:{},i=r.__VUE_DEVTOOLS_GLOBAL_HOOK__;function o(t){i&&(t._devtoolHook=i,i.emit("vuex:init",t),i.on("vuex:travel-to-state",(function(e){t.replaceState(e)})),t.subscribe((function(t,e){i.emit("vuex:mutation",t,e)}),{prepend:!0}),t.subscribeAction((function(t,e){i.emit("vuex:action",t,e)}),{prepend:!0}))}function a(t,e){return t.filter(e)[0]}function s(t,e){if(void 0===e&&(e=[]),null===t||"object"!==typeof t)return t;var n=a(e,(function(e){return e.original===t}));if(n)return n.copy;var r=Array.isArray(t)?[]:{};return e.push({original:t,copy:r}),Object.keys(t).forEach((function(n){r[n]=s(t[n],e)})),r}function l(t,e){Object.keys(t).forEach((function(n){return e(t[n],n)}))}function c(t){return null!==t&&"object"===typeof t}function u(t){return t&&"function"===typeof t.then}function h(t,e){return function(){return t(e)}}var p=function(t,e){this.runtime=e,this._children=Object.create(null),this._rawModule=t;var n=t.state;this.state=("function"===typeof n?n():n)||{}},d={namespaced:{configurable:!0}};d.namespaced.get=function(){return!!this._rawModule.namespaced},p.prototype.addChild=function(t,e){this._children[t]=e},p.prototype.removeChild=function(t){delete this._children[t]},p.prototype.getChild=function(t){return this._children[t]},p.prototype.hasChild=function(t){return t in this._children},p.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)},p.prototype.forEachChild=function(t){l(this._children,t)},p.prototype.forEachGetter=function(t){this._rawModule.getters&&l(this._rawModule.getters,t)},p.prototype.forEachAction=function(t){this._rawModule.actions&&l(this._rawModule.actions,t)},p.prototype.forEachMutation=function(t){this._rawModule.mutations&&l(this._rawModule.mutations,t)},Object.defineProperties(p.prototype,d);var f=function(t){this.register([],t,!1)};function m(t,e,n){if(e.update(n),n.modules)for(var r in n.modules){if(!e.getChild(r))return void 0;m(t.concat(r),e.getChild(r),n.modules[r])}}f.prototype.get=function(t){return t.reduce((function(t,e){return t.getChild(e)}),this.root)},f.prototype.getNamespace=function(t){var e=this.root;return t.reduce((function(t,n){return e=e.getChild(n),t+(e.namespaced?n+"/":"")}),"")},f.prototype.update=function(t){m([],this.root,t)},f.prototype.register=function(t,e,n){var r=this;void 0===n&&(n=!0);var i=new p(e,n);if(0===t.length)this.root=i;else{var o=this.get(t.slice(0,-1));o.addChild(t[t.length-1],i)}e.modules&&l(e.modules,(function(e,i){r.register(t.concat(i),e,n)}))},f.prototype.unregister=function(t){var e=this.get(t.slice(0,-1)),n=t[t.length-1],r=e.getChild(n);r&&r.runtime&&e.removeChild(n)},f.prototype.isRegistered=function(t){var e=this.get(t.slice(0,-1)),n=t[t.length-1];return!!e&&e.hasChild(n)};var g;var y=function(t){var e=this;void 0===t&&(t={}),!g&&"undefined"!==typeof window&&window.Vue&&P(window.Vue);var n=t.plugins;void 0===n&&(n=[]);var r=t.strict;void 0===r&&(r=!1),this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new f(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._watcherVM=new g,this._makeLocalGettersCache=Object.create(null);var i=this,a=this,s=a.dispatch,l=a.commit;this.dispatch=function(t,e){return s.call(i,t,e)},this.commit=function(t,e,n){return l.call(i,t,e,n)},this.strict=r;var c=this._modules.root.state;w(this,c,[],this._modules.root),b(this,c),n.forEach((function(t){return t(e)}));var u=void 0!==t.devtools?t.devtools:g.config.devtools;u&&o(this)},v={state:{configurable:!0}};function _(t,e,n){return e.indexOf(t)<0&&(n&&n.prepend?e.unshift(t):e.push(t)),function(){var n=e.indexOf(t);n>-1&&e.splice(n,1)}}function x(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var n=t.state;w(t,n,[],t._modules.root,!0),b(t,n,e)}function b(t,e,n){var r=t._vm;t.getters={},t._makeLocalGettersCache=Object.create(null);var i=t._wrappedGetters,o={};l(i,(function(e,n){o[n]=h(e,t),Object.defineProperty(t.getters,n,{get:function(){return t._vm[n]},enumerable:!0})}));var a=g.config.silent;g.config.silent=!0,t._vm=new g({data:{$$state:e},computed:o}),g.config.silent=a,t.strict&&C(t),r&&(n&&t._withCommit((function(){r._data.$$state=null})),g.nextTick((function(){return r.$destroy()})))}function w(t,e,n,r,i){var o=!n.length,a=t._modules.getNamespace(n);if(r.namespaced&&(t._modulesNamespaceMap[a],t._modulesNamespaceMap[a]=r),!o&&!i){var s=L(e,n.slice(0,-1)),l=n[n.length-1];t._withCommit((function(){g.set(s,l,r.state)}))}var c=r.context=M(t,a,n);r.forEachMutation((function(e,n){var r=a+n;S(t,r,e,c)})),r.forEachAction((function(e,n){var r=e.root?n:a+n,i=e.handler||e;T(t,r,i,c)})),r.forEachGetter((function(e,n){var r=a+n;A(t,r,e,c)})),r.forEachChild((function(r,o){w(t,e,n.concat(o),r,i)}))}function M(t,e,n){var r=""===e,i={dispatch:r?t.dispatch:function(n,r,i){var o=I(n,r,i),a=o.payload,s=o.options,l=o.type;return s&&s.root||(l=e+l),t.dispatch(l,a)},commit:r?t.commit:function(n,r,i){var o=I(n,r,i),a=o.payload,s=o.options,l=o.type;s&&s.root||(l=e+l),t.commit(l,a,s)}};return Object.defineProperties(i,{getters:{get:r?function(){return t.getters}:function(){return E(t,e)}},state:{get:function(){return L(t.state,n)}}}),i}function E(t,e){if(!t._makeLocalGettersCache[e]){var n={},r=e.length;Object.keys(t.getters).forEach((function(i){if(i.slice(0,r)===e){var o=i.slice(r);Object.defineProperty(n,o,{get:function(){return t.getters[i]},enumerable:!0})}})),t._makeLocalGettersCache[e]=n}return t._makeLocalGettersCache[e]}function S(t,e,n,r){var i=t._mutations[e]||(t._mutations[e]=[]);i.push((function(e){n.call(t,r.state,e)}))}function T(t,e,n,r){var i=t._actions[e]||(t._actions[e]=[]);i.push((function(e){var i=n.call(t,{dispatch:r.dispatch,commit:r.commit,getters:r.getters,state:r.state,rootGetters:t.getters,rootState:t.state},e);return u(i)||(i=Promise.resolve(i)),t._devtoolHook?i.catch((function(e){throw t._devtoolHook.emit("vuex:error",e),e})):i}))}function A(t,e,n,r){t._wrappedGetters[e]||(t._wrappedGetters[e]=function(t){return n(r.state,r.getters,t.state,t.getters)})}function C(t){t._vm.$watch((function(){return this._data.$$state}),(function(){0}),{deep:!0,sync:!0})}function L(t,e){return e.reduce((function(t,e){return t[e]}),t)}function I(t,e,n){return c(t)&&t.type&&(n=e,e=t,t=t.type),{type:t,payload:e,options:n}}function P(t){g&&t===g||(g=t,n(g))}v.state.get=function(){return this._vm._data.$$state},v.state.set=function(t){0},y.prototype.commit=function(t,e,n){var r=this,i=I(t,e,n),o=i.type,a=i.payload,s=(i.options,{type:o,payload:a}),l=this._mutations[o];l&&(this._withCommit((function(){l.forEach((function(t){t(a)}))})),this._subscribers.slice().forEach((function(t){return t(s,r.state)})))},y.prototype.dispatch=function(t,e){var n=this,r=I(t,e),i=r.type,o=r.payload,a={type:i,payload:o},s=this._actions[i];if(s){try{this._actionSubscribers.slice().filter((function(t){return t.before})).forEach((function(t){return t.before(a,n.state)}))}catch(c){0}var l=s.length>1?Promise.all(s.map((function(t){return t(o)}))):s[0](o);return new Promise((function(t,e){l.then((function(e){try{n._actionSubscribers.filter((function(t){return t.after})).forEach((function(t){return t.after(a,n.state)}))}catch(c){0}t(e)}),(function(t){try{n._actionSubscribers.filter((function(t){return t.error})).forEach((function(e){return e.error(a,n.state,t)}))}catch(c){0}e(t)}))}))}},y.prototype.subscribe=function(t,e){return _(t,this._subscribers,e)},y.prototype.subscribeAction=function(t,e){var n="function"===typeof t?{before:t}:t;return _(n,this._actionSubscribers,e)},y.prototype.watch=function(t,e,n){var r=this;return this._watcherVM.$watch((function(){return t(r.state,r.getters)}),e,n)},y.prototype.replaceState=function(t){var e=this;this._withCommit((function(){e._vm._data.$$state=t}))},y.prototype.registerModule=function(t,e,n){void 0===n&&(n={}),"string"===typeof t&&(t=[t]),this._modules.register(t,e),w(this,this.state,t,this._modules.get(t),n.preserveState),b(this,this.state)},y.prototype.unregisterModule=function(t){var e=this;"string"===typeof t&&(t=[t]),this._modules.unregister(t),this._withCommit((function(){var n=L(e.state,t.slice(0,-1));g.delete(n,t[t.length-1])})),x(this)},y.prototype.hasModule=function(t){return"string"===typeof t&&(t=[t]),this._modules.isRegistered(t)},y.prototype.hotUpdate=function(t){this._modules.update(t),x(this,!0)},y.prototype._withCommit=function(t){var e=this._committing;this._committing=!0,t(),this._committing=e},Object.defineProperties(y.prototype,v);var R=B((function(t,e){var n={};return F(e).forEach((function(e){var r=e.key,i=e.val;n[r]=function(){var e=this.$store.state,n=this.$store.getters;if(t){var r=U(this.$store,"mapState",t);if(!r)return;e=r.context.state,n=r.context.getters}return"function"===typeof i?i.call(this,e,n):e[i]},n[r].vuex=!0})),n})),O=B((function(t,e){var n={};return F(e).forEach((function(e){var r=e.key,i=e.val;n[r]=function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];var r=this.$store.commit;if(t){var o=U(this.$store,"mapMutations",t);if(!o)return;r=o.context.commit}return"function"===typeof i?i.apply(this,[r].concat(e)):r.apply(this.$store,[i].concat(e))}})),n})),D=B((function(t,e){var n={};return F(e).forEach((function(e){var r=e.key,i=e.val;i=t+i,n[r]=function(){if(!t||U(this.$store,"mapGetters",t))return this.$store.getters[i]},n[r].vuex=!0})),n})),N=B((function(t,e){var n={};return F(e).forEach((function(e){var r=e.key,i=e.val;n[r]=function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];var r=this.$store.dispatch;if(t){var o=U(this.$store,"mapActions",t);if(!o)return;r=o.context.dispatch}return"function"===typeof i?i.apply(this,[r].concat(e)):r.apply(this.$store,[i].concat(e))}})),n})),k=function(t){return{mapState:R.bind(null,t),mapGetters:D.bind(null,t),mapMutations:O.bind(null,t),mapActions:N.bind(null,t)}};function F(t){return z(t)?Array.isArray(t)?t.map((function(t){return{key:t,val:t}})):Object.keys(t).map((function(e){return{key:e,val:t[e]}})):[]}function z(t){return Array.isArray(t)||c(t)}function B(t){return function(e,n){return"string"!==typeof e?(n=e,e=""):"/"!==e.charAt(e.length-1)&&(e+="/"),t(e,n)}}function U(t,e,n){var r=t._modulesNamespaceMap[n];return r}function j(t){void 0===t&&(t={});var e=t.collapsed;void 0===e&&(e=!0);var n=t.filter;void 0===n&&(n=function(t,e,n){return!0});var r=t.transformer;void 0===r&&(r=function(t){return t});var i=t.mutationTransformer;void 0===i&&(i=function(t){return t});var o=t.actionFilter;void 0===o&&(o=function(t,e){return!0});var a=t.actionTransformer;void 0===a&&(a=function(t){return t});var l=t.logMutations;void 0===l&&(l=!0);var c=t.logActions;void 0===c&&(c=!0);var u=t.logger;return void 0===u&&(u=console),function(t){var h=s(t.state);"undefined"!==typeof u&&(l&&t.subscribe((function(t,o){var a=s(o);if(n(t,h,a)){var l=H(),c=i(t),p="mutation "+t.type+l;G(u,p,e),u.log("%c prev state","color: #9E9E9E; font-weight: bold",r(h)),u.log("%c mutation","color: #03A9F4; font-weight: bold",c),u.log("%c next state","color: #4CAF50; font-weight: bold",r(a)),V(u)}h=a})),c&&t.subscribeAction((function(t,n){if(o(t,n)){var r=H(),i=a(t),s="action "+t.type+r;G(u,s,e),u.log("%c action","color: #03A9F4; font-weight: bold",i),V(u)}})))}}function G(t,e,n){var r=n?t.groupCollapsed:t.group;try{r.call(t,e)}catch(i){t.log(e)}}function V(t){try{t.groupEnd()}catch(e){t.log(" log end ")}}function H(){var t=new Date;return" @ "+q(t.getHours(),2)+":"+q(t.getMinutes(),2)+":"+q(t.getSeconds(),2)+"."+q(t.getMilliseconds(),3)}function W(t,e){return new Array(e+1).join(t)}function q(t,e){return W("0",e-t.toString().length)+t}var X={Store:y,install:P,version:"3.6.2",mapState:R,mapMutations:O,mapGetters:D,mapActions:N,createNamespacedHelpers:k,createLogger:j};e["a"]=X}).call(this,n("c8ba"))},"300a":function(t,e){t.exports=function(t,e){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}},3562:function(t,e){function n(t,e,n){let r,i;function o(){r=!1,i&&(a.apply(n,i),i=!1)}function a(){r?i=arguments:(r=!0,t.apply(n,arguments),setTimeout(o,e))}return a}t.exports=n},3680:function(t,e,n){const r=n("a454"),i=n("baed"),o=n("4f43"),a=n("e133"),s=function(t,e){t=i(t);const n={options:t};e=o(n,e),n.api=e;const s=r(n);return e.onAdd=s.onAdd,e.onRemove=s.onRemove,e.types=a.types,e.options=t,e};t.exports=function(t){s(t,this)}},"39c8":function(t,e,n){const r=n("e133");t.exports=function(){const t=this,e=t.ctx.map&&void 0!==t.ctx.map.getSource(r.sources.HOT);if(!e)return c();const n=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:n});let i=[],o=[];t.isDirty?o=t.getAllIds():(i=t.getChangedIds().filter(e=>void 0!==t.get(e)),o=t.sources.hot.filter(e=>e.properties.id&&-1===i.indexOf(e.properties.id)&&void 0!==t.get(e.properties.id)).map(t=>t.properties.id)),t.sources.hot=[];const a=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(t=>{const e=t.properties.id||t.properties.parent;return-1===i.indexOf(e)});const s=a!==t.sources.cold.length||o.length>0;function l(e,r){const i=t.get(e),o=i.internal(n);t.ctx.events.currentModeRender(o,e=>{t.sources[r].push(e)})}if(i.forEach(t=>l(t,"hot")),o.forEach(t=>l(t,"cold")),s&&t.ctx.map.getSource(r.sources.COLD).setData({type:r.geojsonTypes.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(r.sources.HOT).setData({type:r.geojsonTypes.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(r.events.SELECTION_CHANGE,{features:t.getSelected().map(t=>t.toGeoJSON())}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){const e=t._deletedFeaturesToEmit.map(t=>t.toGeoJSON());t._deletedFeaturesToEmit=[],t.ctx.map.fire(r.events.DELETE,{features:e})}function c(){t.isDirty=!1,t.clearChangedIds()}t.ctx.map.fire(r.events.RENDER,{}),c()}},"3a0e":function(t,e){t.exports=r;var n={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function r(t){if(!t||!t.type)return null;var e=n[t.type];return e?"geometry"===e?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]}:"feature"===e?{type:"FeatureCollection",features:[t]}:"featurecollection"===e?t:void 0:null}},"3b00":function(t,e,n){const r=n("52db"),i=n("e133"),{LAT_MIN:o,LAT_MAX:a,LAT_RENDERED_MIN:s,LAT_RENDERED_MAX:l,LNG_MIN:c,LNG_MAX:u}=i;t.exports=function(t,e){let n=o,i=a,h=o,p=a,d=u,f=c;t.forEach(t=>{const e=r(t),o=e[1],a=e[3],s=e[0],l=e[2];o>n&&(n=o),a<i&&(i=a),a>h&&(h=a),o<p&&(p=o),s<d&&(d=s),l>f&&(f=l)});const m=e;return n+m.lat>l&&(m.lat=l-n),h+m.lat>a&&(m.lat=a-h),i+m.lat<s&&(m.lat=s-i),p+m.lat<o&&(m.lat=o-p),d+m.lng<=c&&(m.lng+=360*Math.ceil(Math.abs(m.lng)/360)),f+m.lng>=u&&(m.lng-=360*Math.ceil(Math.abs(m.lng)/360)),m}},"3cd1":function(t,e,n){const r=n("6aea"),i=n("e133");t.exports=function(t,e){const n=r(t,null,e),o={mouse:i.cursors.NONE};return n[0]&&(o.mouse=n[0].properties.active===i.activeStates.ACTIVE?i.cursors.MOVE:i.cursors.POINTER,o.feature=n[0].properties.meta),-1!==e.events.currentModeName().indexOf("draw")&&(o.mouse=i.cursors.ADD),e.ui.queueMapClasses(o),e.ui.updateMapClasses(),n[0]}},"3e8f":function(t,e){},"40da":function(t,e){t.exports=r;var n={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function r(t){if(!t||!t.type)return null;var e=n[t.type];return e?"geometry"===e?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]}:"feature"===e?{type:"FeatureCollection",features:[t]}:"featurecollection"===e?t:void 0:null}},4338:function(t,e,n){var r=n("93b5"),i=n("7bc4"),o={material:"MeshBasicMaterial",color:"black",opacity:1};function a(t){var e;function n(){return new i[o.material]({color:o.color})}return t?(t=r._validate(t,o),e=t.material&&t.material.isMaterial?t.material:t.material||t.color||t.opacity?new i[t.material]({color:t.color,transparent:t.opacity<1}):n(),e.opacity=t.opacity):e=n(),e}t.exports=a},4362:function(t,e,n){e.nextTick=function(t){var e=Array.prototype.slice.call(arguments);e.shift(),setTimeout((function(){t.apply(null,e)}),0)},e.platform=e.arch=e.execPath=e.title="browser",e.pid=1,e.browser=!0,e.env={},e.argv=[],e.binding=function(t){throw new Error("No such module. (Possibly not yet loaded)")},function(){var t,r="/";e.cwd=function(){return r},e.chdir=function(e){t||(t=n("df7c")),r=t.resolve(e,r)}}(),e.exit=e.kill=e.umask=e.dlopen=e.uptime=e.memoryUsage=e.uvCounters=function(){},e.features={}},"4ab9":function(t,e,n){const r=n("a4f5"),i=n("93b5"),o=n("7bc4"),a=n("cae9");function s(t){t=i._validate(t,r.prototype._defaults.extrusion);let e=s.prototype.buildShape(t.coordinates),n=s.prototype.buildGeometry(e,t.geometryOptions),l=new o.Mesh(n,t.materials);return t.obj=l,new a(t)}s.prototype={buildShape:function(t){if(t[0]instanceof(o.Vector2||o.Vector3))return new o.Shape(t);let e=new o.Shape;for(let n=0;n<t.length;n++)0===n?e=new o.Shape(this.buildPoints(t[0],t[0])):e.holes.push(new o.Path(this.buildPoints(t[n],t[0])));return e},buildPoints:function(t,e){const n=[];let r=i.projectToWorld([e[0][0],e[0][1],0]);for(let a=0;a<t.length;a++){let e=i.projectToWorld([t[a][0],t[a][1],0]);n.push(new o.Vector2(i.toDecimal(e.x-r.x,9),i.toDecimal(e.y-r.y,9)))}return n},buildGeometry:function(t,e){let n=new o.ExtrudeBufferGeometry(t,e);return n.computeBoundingBox(),n}},t.exports=s},"4f43":function(t,e,n){const r=n("5da1"),i=n("40da"),o=n("55b1"),a=n("6aea"),s=n("f159"),l=n("c413"),c=n("e133"),u=n("6403"),h={Polygon:n("95f0"),LineString:n("5330"),Point:n("8309"),MultiPolygon:n("12ec"),MultiLineString:n("12ec"),MultiPoint:n("12ec")};t.exports=function(t,e){return e.modes=c.modes,e.getFeatureIdsAt=function(e){const n=a({point:e},null,t);return n.map(t=>t.properties.id)},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:c.geojsonTypes.FEATURE_COLLECTION,features:t.store.getSelectedIds().map(e=>t.store.get(e)).map(t=>t.toGeoJSON())}},e.set=function(n){if(void 0===n.type||n.type!==c.geojsonTypes.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");const r=t.store.createRenderBatch();let i=t.store.getAllIds().slice();const o=e.add(n),a=new u(o);return i=i.filter(t=>!a.has(t)),i.length&&e.delete(i),r(),o},e.add=function(e){const n=l.hint(e,{precisionWarning:!1}).filter(t=>"message"!==t.level);if(n.length)throw new Error(n[0].message);const a=JSON.parse(JSON.stringify(i(e))),s=a.features.map(e=>{if(e.id=e.id||o(),null===e.geometry)throw new Error("Invalid geometry: null");if(void 0===t.store.get(e.id)||t.store.get(e.id).type!==e.geometry.type){const n=h[e.geometry.type];if(void 0===n)throw new Error(`Invalid geometry type: ${e.geometry.type}.`);const r=new n(t,e);t.store.add(r)}else{const n=t.store.get(e.id);n.properties=e.properties,r(n.getCoordinates(),e.geometry.coordinates)||n.incomingCoords(e.geometry.coordinates)}return e.id});return t.store.render(),s},e.get=function(e){const n=t.store.get(e);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:c.geojsonTypes.FEATURE_COLLECTION,features:t.store.getAll().map(t=>t.toGeoJSON())}},e.delete=function(n){return t.store.delete(n,{silent:!0}),e.getMode()!==c.modes.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(c.modes.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===c.modes.DIRECT_SELECT?t.events.changeMode(c.modes.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(n,r={}){return n===c.modes.SIMPLE_SELECT&&e.getMode()===c.modes.SIMPLE_SELECT?(s(r.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(r.featureIds,{silent:!0}),t.store.render()),e):(n===c.modes.DIRECT_SELECT&&e.getMode()===c.modes.DIRECT_SELECT&&r.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(n,r,{silent:!0}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(n,r,i){return t.store.setFeatureProperty(n,r,i),e},e}},"52db":function(t,e,n){var r=n("95ed"),i=n("786a"),o=n("0eee");function a(t){for(var e=o(),n=r(t),i=0;i<n.length;i++)e.include(n[i]);return e}t.exports=function(t){return a(t).bbox()},t.exports.polygon=function(t){return a(t).polygon()},t.exports.bboxify=function(t){return i(t).map((function(t){t&&"string"===typeof t.type&&(t.bbox=a(t).bbox(),this.update(t))}))}},5330:function(t,e,n){const r=n("a53c"),i=function(t,e){r.call(this,t,e)};i.prototype=Object.create(r.prototype),i.prototype.isValid=function(){return this.coordinates.length>1},i.prototype.addCoordinate=function(t,e,n){this.changed();const r=parseInt(t,10);this.coordinates.splice(r,0,[e,n])},i.prototype.getCoordinate=function(t){const e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},i.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},i.prototype.updateCoordinate=function(t,e,n){const r=parseInt(t,10);this.coordinates[r]=[e,n],this.changed()},t.exports=i},"53a8":function(t,e){t.exports=r;var n=Object.prototype.hasOwnProperty;function r(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var i in r)n.call(r,i)&&(t[i]=r[i])}return t}},5502:function(t,e,n){const r=n("2788");function i(t){this.map=t,this.renderer=new r.CSS2DRenderer,this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.id="labelCanvas",this.renderer.domElement.style.top=0,this.renderer.domElement.style.zIndex="0",this.map.getCanvasContainer().appendChild(this.renderer.domElement),this.scene,this.camera,this.dispose=function(){this.map.getCanvasContainer().removeChild(this.renderer.domElement),this.renderer.domElement.remove(),this.renderer={}},this.setSize=function(t,e){this.renderer.setSize(t,e)},this.map.on("resize",function(){this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight)}.bind(this)),this.state={reset:function(){}},this.render=async function(t,e){return this.scene=t,this.camera=e,new Promise(n=>{n(this.renderer.render(t,e))})},this.toggleLabels=async function(t,e){return new Promise(n=>{n(this.setVisibility(t,e,this.scene,this.camera,this.renderer))})},this.setVisibility=function(t,e,n,r,i){var o=this.renderer.cacheList;o.forEach((function(o){o.visible!=e&&o.layer===t&&(e&&o.alwaysVisible||!e)&&(o.visible=e,i.renderObject(o,n,r))}))}}t.exports=i},"55b1":function(t,e){var n=t.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var r=Math.log(Math.pow(2,t))/Math.log(e),i=2;r===1/0;i*=2)r=Math.log(Math.pow(2,t/i))/Math.log(e)*i;var o=r-Math.floor(r),a="";for(i=0;i<Math.floor(r);i++){var s=Math.floor(Math.random()*e).toString(e);a=s+a}if(o){var l=Math.pow(e,o);s=Math.floor(Math.random()*l).toString(e);a=s+a}var c=parseInt(a,e);return c!==1/0&&c>=Math.pow(2,t)?n(t,e):a};n.rack=function(t,e,r){var i=function(i){var a=0;do{if(a++>10){if(!r)throw new Error("too many ID collisions, use more bits");t+=r}var s=n(t,e)}while(Object.hasOwnProperty.call(o,s));return o[s]=i,s},o=i.hats={};return i.get=function(t){return i.hats[t]},i.set=function(t,e){return i.hats[t]=e,i},i.bits=t||128,i.base=e||16,i}},5734:function(t,e,n){n("cd37");class r{constructor(t,e){this.id=t.layerId,this.type="custom",this.renderingMode="3d",this.opacity=.5,this.buildingsLayerId=t.buildingsLayerId,this.minAltitude=t.minAltitude||.1,this.tb=e}onAdd(t,e){this.map=t;const n="\n\t\t\tuniform mat4 u_matrix;\n\t\t\tuniform float u_height_factor;\n\t\t\tuniform float u_altitude;\n\t\t\tuniform float u_azimuth;\n\t\t\tattribute vec2 a_pos;\n\t\t\tattribute vec4 a_normal_ed;\n\t\t\tattribute lowp vec2 a_base;\n\t\t\tattribute lowp vec2 a_height;\n\t\t\tvoid main() {\n\t\t\t\tfloat base = max(0.0, a_base.x);\n\t\t\t\tfloat height = max(0.0, a_height.x);\n\t\t\t\tfloat t = mod(a_normal_ed.x, 2.0);\n\t\t\t\tvec4 pos = vec4(a_pos, t > 0.0 ? height : base, 1);\n\t\t\t\tfloat len = pos.z * u_height_factor / tan(u_altitude);\n\t\t\t\tpos.x += cos(u_azimuth) * len;\n\t\t\t\tpos.y += sin(u_azimuth) * len;\n\t\t\t\tpos.z = 0.0;\n\t\t\t\tgl_Position = u_matrix * pos;\n\t\t\t}\n\t\t\t",r="\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 0.7);\n\t\t\t}\n\t\t\t",i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,n),e.compileShader(i);const o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,r),e.compileShader(o),this.program=e.createProgram(),e.attachShader(this.program,i),e.attachShader(this.program,o),e.linkProgram(this.program),e.validateProgram(this.program),this.uMatrix=e.getUniformLocation(this.program,"u_matrix"),this.uHeightFactor=e.getUniformLocation(this.program,"u_height_factor"),this.uAltitude=e.getUniformLocation(this.program,"u_altitude"),this.uAzimuth=e.getUniformLocation(this.program,"u_azimuth"),this.aPos=e.getAttribLocation(this.program,"a_pos"),this.aNormal=e.getAttribLocation(this.program,"a_normal_ed"),this.aBase=e.getAttribLocation(this.program,"a_base"),this.aHeight=e.getAttribLocation(this.program,"a_height")}render(t,e){t.useProgram(this.program);const n=this.map.style.sourceCaches["composite"],r=n.getVisibleCoordinates().reverse(),i=this.map.getLayer(this.buildingsLayerId),o=this.map.painter.context,{lng:a,lat:s}=this.map.getCenter(),l=this.tb.getSunPosition(this.tb.lightDateTime,[a,s]);t.uniform1f(this.uAltitude,l.altitude>this.minAltitude?l.altitude:0),t.uniform1f(this.uAzimuth,l.azimuth+3*Math.PI/2),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);t.getExtension("EXT_blend_minmax");t.disable(t.DEPTH_TEST);for(const c of r){const e=n.getTile(c),r=e.getBucket(i);if(!r)continue;const[a,s]=r.programConfigurations.programConfigurations[this.buildingsLayerId]._buffers;t.uniformMatrix4fv(this.uMatrix,!1,c.posMatrix),t.uniform1f(this.uHeightFactor,Math.pow(2,c.overscaledZ)/e.tileSize/8);for(const n of r.segments.get()){const e=o.currentNumAttributes||0,i=2;for(let n=i;n<e;n++)t.disableVertexAttribArray(n);const l=n.vertexOffset||0;t.enableVertexAttribArray(this.aPos),t.enableVertexAttribArray(this.aNormal),t.enableVertexAttribArray(this.aHeight),t.enableVertexAttribArray(this.aBase),r.layoutVertexBuffer.bind(),t.vertexAttribPointer(this.aPos,2,t.SHORT,!1,12,12*l),t.vertexAttribPointer(this.aNormal,4,t.SHORT,!1,12,4+12*l),a.bind(),t.vertexAttribPointer(this.aHeight,1,t.FLOAT,!1,4,4*l),s.bind(),t.vertexAttribPointer(this.aBase,1,t.FLOAT,!1,4,4*l),r.indexBuffer.bind(),o.currentNumAttributes=i,t.drawElements(t.TRIANGLES,3*n.primitiveLength,t.UNSIGNED_SHORT,3*n.primitiveOffset*2)}}}}t.exports=r},"595b":function(t,e,n){(function(t){!function(t,n){n(e)}(0,(function(e){"use strict";var n=6371008.8,r={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*n,kilometers:6371.0088,kilometres:6371.0088,meters:n,metres:n,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:n/1852,radians:1,yards:6967335.223679999},i={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/n,yards:1.0936133},o={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function a(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function s(t,e,n){switch(t){case"Point":return l(e).geometry;case"LineString":return p(e).geometry;case"Polygon":return u(e).geometry;case"MultiPoint":return g(e).geometry;case"MultiLineString":return m(e).geometry;case"MultiPolygon":return y(e).geometry;default:throw new Error(t+" is invalid")}}function l(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!C(t[0])||!C(t[1]))throw new Error("coordinates must contain numbers");return a({type:"Point",coordinates:t},e,n)}function c(t,e,n){return void 0===n&&(n={}),f(t.map((function(t){return l(t,e)})),n)}function u(t,e,n){void 0===n&&(n={});for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return a({type:"Polygon",coordinates:t},e,n)}function h(t,e,n){return void 0===n&&(n={}),f(t.map((function(t){return u(t,e)})),n)}function p(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return a({type:"LineString",coordinates:t},e,n)}function d(t,e,n){return void 0===n&&(n={}),f(t.map((function(t){return p(t,e)})),n)}function f(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function m(t,e,n){return void 0===n&&(n={}),a({type:"MultiLineString",coordinates:t},e,n)}function g(t,e,n){return void 0===n&&(n={}),a({type:"MultiPoint",coordinates:t},e,n)}function y(t,e,n){return void 0===n&&(n={}),a({type:"MultiPolygon",coordinates:t},e,n)}function v(t,e,n){return void 0===n&&(n={}),a({type:"GeometryCollection",geometries:t},e,n)}function _(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function x(t,e){void 0===e&&(e="kilometers");var n=r[e];if(!n)throw new Error(e+" units is invalid");return t*n}function b(t,e){void 0===e&&(e="kilometers");var n=r[e];if(!n)throw new Error(e+" units is invalid");return t/n}function w(t,e){return E(b(t,e))}function M(t){var e=t%360;return e<0&&(e+=360),e}function E(t){return t%(2*Math.PI)*180/Math.PI}function S(t){return t%360*Math.PI/180}function T(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return x(b(t,e),n)}function A(t,e,n){if(void 0===e&&(e="meters"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var r=o[e];if(!r)throw new Error("invalid original units");var i=o[n];if(!i)throw new Error("invalid final units");return t/r*i}function C(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function L(t){return!!t&&t.constructor===Object}function I(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!C(t))throw new Error("bbox must only contain numbers")}))}function P(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}var R=Object.freeze({__proto__:null,earthRadius:n,factors:r,unitsFactors:i,areaFactors:o,feature:a,geometry:s,point:l,points:c,polygon:u,polygons:h,lineString:p,lineStrings:d,featureCollection:f,multiLineString:m,multiPoint:g,multiPolygon:y,geometryCollection:v,round:_,radiansToLength:x,lengthToRadians:b,lengthToDegrees:w,bearingToAzimuth:M,radiansToDegrees:E,degreesToRadians:S,convertLength:T,convertArea:A,isNumber:C,isObject:L,validateBBox:I,validateId:P});function O(t,e,n){if(null!==t)for(var r,i,o,a,s,l,c,u,h=0,p=0,d=t.type,f="FeatureCollection"===d,m="Feature"===d,g=f?t.features.length:1,y=0;y<g;y++){s=(u=!!(c=f?t.features[y].geometry:m?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<s;v++){var _=0,x=0;if(null!==(a=u?c.geometries[v]:c)){l=a.coordinates;var b=a.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(l,p,y,_,x))return!1;p++,_++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===e(l[r],p,y,_,x))return!1;p++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-h;i++){if(!1===e(l[r][i],p,y,_,x))return!1;p++}"MultiLineString"===b&&_++,"Polygon"===b&&x++}"Polygon"===b&&_++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(x=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-h;o++){if(!1===e(l[r][i][o],p,y,_,x))return!1;p++}x++}_++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===O(a.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function D(t,e,n,r){var i=n;return O(t,(function(t,r,o,a,s){i=0===r&&void 0===n?t:e(i,t,r,o,a,s)}),r),i}function N(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function k(t,e,n){var r=n;return N(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r}function F(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function z(t,e,n){var r=n;return F(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r}function B(t){var e=[];return O(t,(function(t){e.push(t)})),e}function U(t,e){var n,r,i,o,a,s,l,c,u,h,p=0,d="FeatureCollection"===t.type,f="Feature"===t.type,m=d?t.features.length:1;for(n=0;n<m;n++){for(s=d?t.features[n].geometry:f?t.geometry:t,c=d?t.features[n].properties:f?t.properties:{},u=d?t.features[n].bbox:f?t.bbox:void 0,h=d?t.features[n].id:f?t.id:void 0,a=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=l?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,c,u,h))return!1;p++}}function j(t,e,n){var r=n;return U(t,(function(t,i,o,a,s){r=0===i&&void 0===n?t:e(r,t,i,o,a,s)})),r}function G(t,e){U(t,(function(t,n,r,i,o){var s,l=null===t?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==e(a(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(l){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var c=0;c<t.coordinates.length;c++){var u=t.coordinates[c];if(!1===e(a({type:s,coordinates:u},r),n,c))return!1}}))}function V(t,e,n){var r=n;return G(t,(function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)})),r}function H(t,e){G(t,(function(t,n,r){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,s=0,l=0,c=0;return!1!==O(t,(function(o,u,h,d,f){if(void 0===a||n>s||d>l||f>c)return a=o,s=n,l=d,c=f,void(i=0);var m=p([a,o],t.properties);if(!1===e(m,n,r,f,i))return!1;i++,a=o}))&&void 0}}}))}function W(t,e,n){var r=n,i=!1;return H(t,(function(t,o,a,s,l){r=!1===i&&void 0===n?t:e(r,t,o,a,s,l),i=!0})),r}function q(t,e){if(!t)throw new Error("geojson is required");G(t,(function(t,n,r){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":if(!1===e(t,n,r,0,0))return!1;break;case"Polygon":for(var a=0;a<o.length;a++)if(!1===e(p(o[a],t.properties),n,r,a))return!1}}}))}function X(t,e,n){var r=n;return q(t,(function(t,i,o,a){r=0===i&&void 0===n?t:e(r,t,i,o,a)})),r}function Z(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),s=s||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":s=s||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=l.length+a-1),p([l[a],l[a+1]],s,e);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a-1),p([l[o][a],l[o][a+1]],s,e);case"MultiLineString":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a-1),p([l[i][a],l[i][a+1]],s,e);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),a<0&&(a=l[i][o].length-a-1),p([l[i][o][a],l[i][o][a+1]],s,e)}throw new Error("geojson is invalid")}function Y(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),s=s||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":s=s||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var c=n.coordinates;switch(n.type){case"Point":return l(c,s,e);case"MultiPoint":return i<0&&(i=c.length+i),l(c[i],s,e);case"LineString":return a<0&&(a=c.length+a),l(c[a],s,e);case"Polygon":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a),l(c[o][a],s,e);case"MultiLineString":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a),l(c[i][a],s,e);case"MultiPolygon":return i<0&&(i=c.length+i),o<0&&(o=c[i].length+o),a<0&&(a=c[i][o].length-a),l(c[i][o][a],s,e)}throw new Error("geojson is invalid")}var $=Object.freeze({__proto__:null,coordAll:B,coordEach:O,coordReduce:D,featureEach:F,featureReduce:z,findPoint:Y,findSegment:Z,flattenEach:G,flattenReduce:V,geomEach:U,geomReduce:j,lineEach:q,lineReduce:X,propEach:N,propReduce:k,segmentEach:H,segmentReduce:W});function J(t){var e=[1/0,1/0,-1/0,-1/0];return O(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function K(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Q(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function tt(t){if(t.length>1&&C(t[0])&&C(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return tt(t[0]);throw new Error("coordinates must only contain numbers")}function et(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}function nt(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}function rt(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+n+", FeatureCollection required");for(var r=0,i=t.features;r<i.length;r++){var o=i[r];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!o.geometry||o.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+o.geometry.type)}}function it(t){return"Feature"===t.type?t.geometry:t}function ot(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}J.default=J;var at=Object.freeze({__proto__:null,getCoord:K,getCoords:Q,containsNumber:tt,geojsonType:et,featureOf:nt,collectionOf:rt,getGeom:it,getType:ot}),st=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;
/*
    object-assign
    (c) Sindre Sorhus
    @license MIT
    */function ut(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var ht=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,r,i=ut(t),o=1;o<arguments.length;o++){for(var a in n=Object(arguments[o]))lt.call(n,a)&&(i[a]=n[a]);if(st){r=st(n);for(var s=0;s<r.length;s++)ct.call(n,r[s])&&(i[r[s]]=n[r[s]])}}return i},pt={successCallback:null,verbose:!1},dt={};
/**
     * @license GNU Affero General Public License.
     * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
     * v. 1.2.0
     * https://github.com/RaumZeit/MarchingSquares.js
     *
     * MarchingSquaresJS is free software: you can redistribute it and/or modify
     * it under the terms of the GNU Affero General Public License as published by
     * the Free Software Foundation, either version 3 of the License, or
     * (at your option) any later version.
     *
     * MarchingSquaresJS is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     * GNU Affero General Public License for more details.
     *
     * As additional permission under GNU Affero General Public License version 3
     * section 7, third-party projects (personal or commercial) may distribute,
     * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
     * requirement that said third-party project for that reason alone becomes
     * subject to any requirement of the GNU Affero General Public License version 3.
     * Any modifications to MarchingSquaresJS, however, must be shared with the public
     * and made available.
     *
     * In summary this:
     * - allows you to use MarchingSquaresJS at no cost
     * - allows you to use MarchingSquaresJS for both personal and commercial purposes
     * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
     *   license as long as this license notice is included
     * - enables you to keep the source code of your program that uses MarchingSquaresJS
     *   undisclosed
     * - forces you to share any modifications you have made to MarchingSquaresJS,
     *   e.g. bug-fixes
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
     */function ft(t,e,n){n=n||{};for(var r=Object.keys(pt),i=0;i<r.length;i++){var o=r[i],a=n[o];a=null!=a?a:pt[o],dt[o]=a}dt.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var s=function(t){var e=[],n=0,r=1e-7;return t.cells.forEach((function(i,o){i.forEach((function(i,a){if(void 0!==i&&5!==(d=i).cval&&10!==d.cval&&!gt(i)){var s=function(t,e,n){var r,i,o=t.length,a=[],s=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],l=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],c=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"],u=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],h=t[e][n],p=h.cval,d=c[p],f=vt(h,d);a.push([n+f[0],e+f[1]]),d=u[p],f=vt(h,d),a.push([n+f[0],e+f[1]]),yt(h);for(var m=n+s[p],g=e+l[p],y=p;m>=0&&g>=0&&g<o&&(m!=n||g!=e)&&void 0!==(h=t[g][m]);){if(0===(p=h.cval)||15===p)return{path:a,info:"mergeable"};d=u[p],r=s[p],i=l[p],5!==p&&10!==p||(5===p?h.flipped?-1===l[y]?(d="left",r=-1,i=0):(d="right",r=1,i=0):-1===s[y]&&(d="bottom",r=0,i=-1):10===p&&(h.flipped?-1===s[y]?(d="top",r=0,i=1):(d="bottom",r=0,i=-1):1===l[y]&&(d="left",r=-1,i=0))),f=vt(h,d),a.push([m+f[0],g+f[1]]),yt(h),m+=r,g+=i,y=p}return{path:a,info:"closed"}}(t.cells,o,a),l=!1;if("mergeable"===s.info)for(var c=s.path[s.path.length-1][0],u=s.path[s.path.length-1][1],h=n-1;h>=0;h--)if(Math.abs(e[h][0][0]-c)<=r&&Math.abs(e[h][0][1]-u)<=r){for(var p=s.path.length-2;p>=0;--p)e[h].unshift(s.path[p]);l=!0;break}l||(e[n++]=s.path)}var d}))})),e}(function(t,e){for(var n=t.length-1,r=t[0].length-1,i={rows:n,cols:r,cells:[]},o=0;o<n;++o){i.cells[o]=[];for(var a=0;a<r;++a){var s=0,l=t[o+1][a],c=t[o+1][a+1],u=t[o][a+1],h=t[o][a];if(!(isNaN(l)||isNaN(c)||isNaN(u)||isNaN(h))){s|=l>=e?8:0,s|=c>=e?4:0,s|=u>=e?2:0;var p,d,f,m,g=!1;if(5===(s|=h>=e?1:0)||10===s){var y=(l+c+u+h)/4;5===s&&y<e?(s=10,g=!0):10===s&&y<e&&(s=5,g=!0)}0!==s&&15!==s&&(p=d=f=m=.5,1===s?(f=1-mt(e,l,h),d=1-mt(e,u,h)):2===s?(d=mt(e,h,u),m=1-mt(e,c,u)):3===s?(f=1-mt(e,l,h),m=1-mt(e,c,u)):4===s?(p=mt(e,l,c),m=mt(e,u,c)):5===s?(p=mt(e,l,c),m=mt(e,u,c),d=1-mt(e,u,h),f=1-mt(e,l,h)):6===s?(d=mt(e,h,u),p=mt(e,l,c)):7===s?(f=1-mt(e,l,h),p=mt(e,l,c)):8===s?(f=mt(e,h,l),p=1-mt(e,c,l)):9===s?(d=1-mt(e,u,h),p=1-mt(e,c,l)):10===s?(p=1-mt(e,c,l),m=1-mt(e,c,u),d=mt(e,h,u),f=mt(e,h,l)):11===s?(p=1-mt(e,c,l),m=1-mt(e,c,u)):12===s?(f=mt(e,h,l),m=mt(e,u,c)):13===s?(d=1-mt(e,u,h),m=mt(e,u,c)):14===s?(f=mt(e,h,l),d=mt(e,h,u)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+s),i.cells[o][a]={cval:s,flipped:g,top:p,right:m,bottom:d,left:f})}}}return i}(t,e));return"function"==typeof dt.successCallback&&dt.successCallback(s),s}function mt(t,e,n){return(t-e)/(n-e)}function gt(t){return 0===t.cval||15===t.cval}function yt(t){gt(t)||5===t.cval||10===t.cval||(t.cval=15)}function vt(t,e){return"top"===e?[t.top,1]:"bottom"===e?[t.bottom,0]:"right"===e?[1,t.right]:"left"===e?[0,t.left]:void 0}function _t(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n=e.zProperty||"elevation",r=e.flip,i=e.flags;rt(t,"Point","input must contain Points");for(var o=function(t,e){var n={};return F(t,(function(t){var e=Q(t)[1];n[e]||(n[e]=[]),n[e].push(t)})),Object.keys(n).map((function(t){return n[t].sort((function(t,e){return Q(t)[0]-Q(e)[0]}))})).sort((function(t,n){return e?Q(t[0])[1]-Q(n[0])[1]:Q(n[0])[1]-Q(t[0])[1]}))}(t,r),a=[],s=0;s<o.length;s++){for(var l=o[s],c=[],u=0;u<l.length;u++){var h=l[u];h.properties[n]?c.push(h.properties[n]):c.push(0),!0===i&&(h.properties.matrixPosition=[s,u])}a.push(c)}return a}var xt=wt,bt=wt;function wt(t,e,n,r,i){Mt(t,e,n||0,r||t.length-1,i||St)}function Mt(t,e,n,r,i){for(;r>n;){if(r-n>600){var o=r-n+1,a=e-n+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);Mt(t,e,Math.max(n,Math.floor(e-a*l/o+c)),Math.min(r,Math.floor(e+(o-a)*l/o+c)),i)}var u=t[e],h=n,p=r;for(Et(t,n,e),i(t[r],u)>0&&Et(t,n,r);h<p;){for(Et(t,h,p),h++,p--;i(t[h],u)<0;)h++;for(;i(t[p],u)>0;)p--}0===i(t[n],u)?Et(t,n,p):Et(t,++p,r),p<=e&&(n=p+1),e<=p&&(r=p-1)}}function Et(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function St(t,e){return t<e?-1:t>e?1:0}xt.default=bt;var Tt=Ct,At=Ct;function Ct(t,e){if(!(this instanceof Ct))return new Ct(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function Lt(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function It(t,e){Pt(t,0,t.children.length,e,t)}function Pt(t,e,n,r,i){i||(i=Bt(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<n;a++)o=t.children[a],Rt(i,t.leaf?r(o):o);return i}function Rt(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Ot(t,e){return t.minX-e.minX}function Dt(t,e){return t.minY-e.minY}function Nt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function kt(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Ft(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function zt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Bt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ut(t,e,n,r,i){for(var o,a=[e,n];a.length;)(n=a.pop())-(e=a.pop())<=r||(o=e+Math.ceil((n-e)/r/2)*r,xt(t,o,e,n,i),a.push(e,o,o,n))}function jt(t){var e={exports:{}};return t(e,e.exports),e.exports}Ct.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!zt(t,e))return n;for(var i,o,a,s,l=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],zt(t,s=e.leaf?r(a):a)&&(e.leaf?n.push(a):Ft(t,s)?this._all(a,n):l.push(a));e=l.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!zt(t,e))return!1;for(var r,i,o,a,s=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],zt(t,a=e.leaf?n(o):o)){if(e.leaf||Ft(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=Bt([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,o,a=this.data,s=this.toBBox(t),l=[],c=[];a||l.length;){if(a||(a=l.pop(),r=l[l.length-1],n=c.pop(),o=!0),a.leaf&&-1!==(i=Lt(t,a.children,e)))return a.children.splice(i,1),l.push(a),this._condense(l),this;o||a.leaf||!Ft(a,s)?r?(n++,a=r.children[n],o=!1):a=null:(l.push(a),c.push(n),n=0,r=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:Ot,compareMinY:Dt,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,a=this._maxEntries;if(o<=a)return It(i=Bt(t.slice(e,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),(i=Bt([])).leaf=!1,i.height=r;var s,l,c,u,h=Math.ceil(o/a),p=h*Math.ceil(Math.sqrt(a));for(Ut(t,e,n,p,this.compareMinX),s=e;s<=n;s+=p)for(Ut(t,s,c=Math.min(s+p-1,n),h,this.compareMinY),l=s;l<=c;l+=h)u=Math.min(l+h-1,c),i.children.push(this._build(t,l,u,r-1));return It(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,a,s,l,c,u,h,p,d;r.push(e),!e.leaf&&r.length-1!==n;){for(u=h=1/0,i=0,o=e.children.length;i<o;i++)l=Nt(a=e.children[i]),p=t,d=a,(c=(Math.max(d.maxX,p.maxX)-Math.min(d.minX,p.minX))*(Math.max(d.maxY,p.maxY)-Math.min(d.minY,p.minY))-l)<h?(h=c,u=l<u?l:u,s=a):c===h&&l<u&&(u=l,s=a);e=s||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),Rt(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),a=Bt(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,It(n,this.toBBox),It(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(n,a)},_splitRoot:function(t,e){this.data=Bt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,It(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,a,s,l,c,u,h,p,d,f,m,g;for(l=c=1/0,r=e;r<=n-e;r++)i=Pt(t,0,r,this.toBBox),o=Pt(t,r,n,this.toBBox),h=i,p=o,d=void 0,f=void 0,m=void 0,g=void 0,d=Math.max(h.minX,p.minX),f=Math.max(h.minY,p.minY),m=Math.min(h.maxX,p.maxX),g=Math.min(h.maxY,p.maxY),a=Math.max(0,m-d)*Math.max(0,g-f),s=Nt(i)+Nt(o),a<l?(l=a,u=r,c=s<c?s:c):a===l&&s<c&&(c=s,u=r);return u},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:Ot,i=t.leaf?this.compareMinY:Dt;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,a=this.toBBox,s=Pt(t,0,e,a),l=Pt(t,n-e,n,a),c=kt(s)+kt(l);for(i=e;i<n-e;i++)o=t.children[i],Rt(s,t.leaf?a(o):o),c+=kt(s);for(i=n-e-1;i>=e;i--)o=t.children[i],Rt(l,t.leaf?a(o):o),c+=kt(l);return c},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)Rt(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():It(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},Tt.default=At;var Gt=function(t,e,n){var r=t*e,i=Vt*t,o=i-(i-t),a=t-o,s=Vt*e,l=s-(s-e),c=e-l,u=a*c-(r-o*l-a*l-o*c);return n?(n[0]=u,n[1]=r,n):[u,r]},Vt=+(Math.pow(2,27)+1),Ht=function(t,e){var n=0|t.length,r=0|e.length;if(1===n&&1===r)return function(t,e){var n=t+e,r=n-t,i=t-(n-r)+(e-r);return i?[i,n]:[n]}(t[0],e[0]);var i,o,a=new Array(n+r),s=0,l=0,c=0,u=Math.abs,h=t[l],p=u(h),d=e[c],f=u(d);p<f?(o=h,(l+=1)<n&&(h=t[l],p=u(h))):(o=d,(c+=1)<r&&(d=e[c],f=u(d))),l<n&&p<f||c>=r?(i=h,(l+=1)<n&&(h=t[l],p=u(h))):(i=d,(c+=1)<r&&(d=e[c],f=u(d)));for(var m,g,y=i+o,v=y-i,_=o-v,x=_,b=y;l<n&&c<r;)p<f?(i=h,(l+=1)<n&&(h=t[l],p=u(h))):(i=d,(c+=1)<r&&(d=e[c],f=u(d))),(_=(o=x)-(v=(y=i+o)-i))&&(a[s++]=_),x=b-((m=b+y)-(g=m-b))+(y-g),b=m;for(;l<n;)(_=(o=x)-(v=(y=(i=h)+o)-i))&&(a[s++]=_),x=b-((m=b+y)-(g=m-b))+(y-g),b=m,(l+=1)<n&&(h=t[l]);for(;c<r;)(_=(o=x)-(v=(y=(i=d)+o)-i))&&(a[s++]=_),x=b-((m=b+y)-(g=m-b))+(y-g),b=m,(c+=1)<r&&(d=e[c]);return x&&(a[s++]=x),b&&(a[s++]=b),s||(a[s++]=0),a.length=s,a},Wt=function(t,e,n){var r=t+e,i=r-t,o=e-i,a=t-(r-i);return n?(n[0]=a+o,n[1]=r,n):[a+o,r]},qt=function(t,e){var n=t.length;if(1===n){var r=Gt(t[0],e);return r[0]?r:[r[1]]}var i=new Array(2*n),o=[.1,.1],a=[.1,.1],s=0;Gt(t[0],e,o),o[0]&&(i[s++]=o[0]);for(var l=1;l<n;++l){Gt(t[l],e,a);var c=o[1];Wt(c,a[0],o),o[0]&&(i[s++]=o[0]);var u=a[1],h=o[1],p=u+h,d=h-(p-u);o[1]=p,d&&(i[s++]=d)}return o[1]&&(i[s++]=o[1]),0===s&&(i[s++]=0),i.length=s,i},Xt=function(t,e){var n=0|t.length,r=0|e.length;if(1===n&&1===r)return function(t,e){var n=t+e,r=n-t,i=t-(n-r)+(e-r);return i?[i,n]:[n]}(t[0],-e[0]);var i,o,a=new Array(n+r),s=0,l=0,c=0,u=Math.abs,h=t[l],p=u(h),d=-e[c],f=u(d);p<f?(o=h,(l+=1)<n&&(h=t[l],p=u(h))):(o=d,(c+=1)<r&&(d=-e[c],f=u(d))),l<n&&p<f||c>=r?(i=h,(l+=1)<n&&(h=t[l],p=u(h))):(i=d,(c+=1)<r&&(d=-e[c],f=u(d)));for(var m,g,y=i+o,v=y-i,_=o-v,x=_,b=y;l<n&&c<r;)p<f?(i=h,(l+=1)<n&&(h=t[l],p=u(h))):(i=d,(c+=1)<r&&(d=-e[c],f=u(d))),(_=(o=x)-(v=(y=i+o)-i))&&(a[s++]=_),x=b-((m=b+y)-(g=m-b))+(y-g),b=m;for(;l<n;)(_=(o=x)-(v=(y=(i=h)+o)-i))&&(a[s++]=_),x=b-((m=b+y)-(g=m-b))+(y-g),b=m,(l+=1)<n&&(h=t[l]);for(;c<r;)(_=(o=x)-(v=(y=(i=d)+o)-i))&&(a[s++]=_),x=b-((m=b+y)-(g=m-b))+(y-g),b=m,(c+=1)<r&&(d=-e[c]);return x&&(a[s++]=x),b&&(a[s++]=b),s||(a[s++]=0),a.length=s,a},Zt=jt((function(t){function e(t,e){for(var n=new Array(t.length-1),r=1;r<t.length;++r)for(var i=n[r-1]=new Array(t.length-1),o=0,a=0;o<t.length;++o)o!==e&&(i[a++]=t[r][o]);return n}function n(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",n(t.slice(0,e)),",",n(t.slice(e)),")"].join("")}function r(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var i=[],o=0;o<t.length;++o)i.push(["scale(",n(r(e(t,o))),",",(a=o,1&a?"-":""),t[0][o],")"].join(""));return i;var a}function i(t){for(var i=[],o=[],a=function(t){for(var e=new Array(t),n=0;n<t;++n){e[n]=new Array(t);for(var r=0;r<t;++r)e[n][r]=["m",r,"[",t-n-1,"]"].join("")}return e}(t),s=[],l=0;l<t;++l)0==(1&l)?i.push.apply(i,r(e(a,l))):o.push.apply(o,r(e(a,l))),s.push("m"+l);var c=n(i),u=n(o),h="orientation"+t+"Exact",p=["function ",h,"(",s.join(),"){var p=",c,",n=",u,",d=sub(p,n);return d[d.length-1];};return ",h].join("");return new Function("sum","prod","scale","sub",p)(Ht,Gt,qt,Xt)}var o=i(3),a=i(4),s=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,n){var r,i=(t[1]-n[1])*(e[0]-n[0]),a=(t[0]-n[0])*(e[1]-n[1]),s=i-a;if(i>0){if(a<=0)return s;r=i+a}else{if(!(i<0))return s;if(a>=0)return s;r=-(i+a)}var l=33306690738754716e-32*r;return s>=l||s<=-l?s:o(t,e,n)},function(t,e,n,r){var i=t[0]-r[0],o=e[0]-r[0],s=n[0]-r[0],l=t[1]-r[1],c=e[1]-r[1],u=n[1]-r[1],h=t[2]-r[2],p=e[2]-r[2],d=n[2]-r[2],f=o*u,m=s*c,g=s*l,y=i*u,v=i*c,_=o*l,x=h*(f-m)+p*(g-y)+d*(v-_),b=7771561172376103e-31*((Math.abs(f)+Math.abs(m))*Math.abs(h)+(Math.abs(g)+Math.abs(y))*Math.abs(p)+(Math.abs(v)+Math.abs(_))*Math.abs(d));return x>b||-x>b?x:a(t,e,n,r)}];function l(t){var e=s[t.length];return e||(e=s[t.length]=i(t.length)),e.apply(void 0,t)}!function(){for(;s.length<=5;)s.push(i(s.length));for(var e=[],n=["slow"],r=0;r<=5;++r)e.push("a"+r),n.push("o"+r);var o=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(r=2;r<=5;++r)o.push("case ",r,":return o",r,"(",e.slice(0,r).join(),");");o.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),n.push(o.join(""));var a=Function.apply(void 0,n);for(t.exports=a.apply(void 0,[l].concat(s)),r=0;r<=5;++r)t.exports[r]=s[r]}()})),Yt=function(t){var e=t.length;if(e<3){for(var n=new Array(e),r=0;r<e;++r)n[r]=r;return 2===e&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]?[0]:n}var i=new Array(e);for(r=0;r<e;++r)i[r]=r;i.sort((function(e,n){var r=t[e][0]-t[n][0];return r||t[e][1]-t[n][1]}));var o=[i[0],i[1]],a=[i[0],i[1]];for(r=2;r<e;++r){for(var s=i[r],l=t[s],c=o.length;c>1&&$t(t[o[c-2]],t[o[c-1]],l)<=0;)c-=1,o.pop();for(o.push(s),c=a.length;c>1&&$t(t[a[c-2]],t[a[c-1]],l)>=0;)c-=1,a.pop();a.push(s)}n=new Array(a.length+o.length-2);for(var u=0,h=(r=0,o.length);r<h;++r)n[u++]=o[r];for(var p=a.length-2;p>0;--p)n[u++]=a[p];return n},$t=Zt[3],Jt=Qt,Kt=Qt;function Qt(t,e){if(!(this instanceof Qt))return new Qt(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||te,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function te(t,e){return t<e?-1:t>e?1:0}Qt.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),a=o+1,s=e[o];if(a<this.length&&n(e[a],s)<0&&(o=a,s=e[a]),n(s,i)>=0)break;e[t]=s,t=o}e[t]=i}},Jt.default=Kt;var ee=function(t,e){for(var n=t[0],r=t[1],i=!1,o=0,a=e.length-1;o<e.length;a=o++){var s=e[o][0],l=e[o][1],c=e[a][0],u=e[a][1];l>r!=u>r&&n<(c-s)*(r-l)/(u-l)+s&&(i=!i)}return i},ne=Zt[3],re=oe,ie=oe;function oe(t,e,n){e=Math.max(0,void 0===e?2:e),n=n||0;for(var r,i=function(t){for(var e=t[0],n=t[0],r=t[0],i=t[0],o=0;o<t.length;o++){var a=t[o];a[0]<e[0]&&(e=a),a[0]>r[0]&&(r=a),a[1]<n[1]&&(n=a),a[1]>i[1]&&(i=a)}var s=[e,n,r,i],l=s.slice();for(o=0;o<t.length;o++)ee(t[o],s)||l.push(t[o]);var c=Yt(l),u=[];for(o=0;o<c.length;o++)u.push(l[c[o]]);return u}(t),o=Tt(16,["[0]","[1]","[0]","[1]"]).load(t),a=[],s=0;s<i.length;s++){var l=i[s];o.remove(l),r=pe(l,r),a.push(r)}var c=Tt(16);for(s=0;s<a.length;s++)c.insert(he(a[s]));for(var u=e*e,h=n*n;a.length;){var p=a.shift(),d=p.p,f=p.next.p,m=de(d,f);if(!(m<h)){var g=m/u;(l=ae(o,p.prev.p,d,f,p.next.next.p,g,c))&&Math.min(de(l,d),de(l,f))<=g&&(a.push(p),a.push(pe(l,p)),o.remove(l),c.remove(p),c.insert(he(p)),c.insert(he(p.next)))}}p=r;var y=[];do{y.push(p.p),p=p.next}while(p!==r);return y.push(p.p),y}function ae(t,e,n,r,i,o,a){for(var s=new Jt(null,se),l=t.data;l;){for(var c=0;c<l.children.length;c++){var u=l.children[c],h=l.leaf?fe(u,n,r):le(n,r,u);h>o||s.push({node:u,dist:h})}for(;s.length&&!s.peek().node.children;){var p=s.pop(),d=p.node,f=fe(d,e,n),m=fe(d,r,i);if(p.dist<f&&p.dist<m&&ue(n,d,a)&&ue(r,d,a))return d}(l=s.pop())&&(l=l.node)}return null}function se(t,e){return t.dist-e.dist}function le(t,e,n){if(ce(t,n)||ce(e,n))return 0;var r=me(t[0],t[1],e[0],e[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=me(t[0],t[1],e[0],e[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var o=me(t[0],t[1],e[0],e[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var a=me(t[0],t[1],e[0],e[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===a?0:Math.min(r,i,o,a)}function ce(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function ue(t,e,n){for(var r,i,o,a,s=Math.min(t[0],e[0]),l=Math.min(t[1],e[1]),c=Math.max(t[0],e[0]),u=Math.max(t[1],e[1]),h=n.search({minX:s,minY:l,maxX:c,maxY:u}),p=0;p<h.length;p++)if(r=h[p].p,i=h[p].next.p,o=t,r!==(a=e)&&i!==o&&ne(r,i,o)>0!=ne(r,i,a)>0&&ne(o,a,r)>0!=ne(o,a,i)>0)return!1;return!0}function he(t){var e=t.p,n=t.next.p;return t.minX=Math.min(e[0],n[0]),t.minY=Math.min(e[1],n[1]),t.maxX=Math.max(e[0],n[0]),t.maxY=Math.max(e[1],n[1]),t}function pe(t,e){var n={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function de(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function fe(t,e,n){var r=e[0],i=e[1],o=n[0]-r,a=n[1]-i;if(0!==o||0!==a){var s=((t[0]-r)*o+(t[1]-i)*a)/(o*o+a*a);s>1?(r=n[0],i=n[1]):s>0&&(r+=o*s,i+=a*s)}return(o=t[0]-r)*o+(a=t[1]-i)*a}function me(t,e,n,r,i,o,a,s){var l,c,u,h,p=n-t,d=r-e,f=a-i,m=s-o,g=t-i,y=e-o,v=p*p+d*d,_=p*f+d*m,x=f*f+m*m,b=p*g+d*y,w=f*g+m*y,M=v*x-_*_,E=M,S=M;0===M?(c=0,E=1,h=w,S=x):(h=v*w-_*b,(c=_*w-x*b)<0?(c=0,h=w,S=x):c>E&&(c=E,h=w+_,S=x)),h<0?(h=0,-b<0?c=0:-b>v?c=E:(c=-b,E=v)):h>S&&(h=S,-b+_<0?c=0:-b+_>v?c=E:(c=-b+_,E=v));var T=(1-(u=0===h?0:h/S))*i+u*a-((1-(l=0===c?0:c/E))*t+l*n),A=(1-u)*o+u*s-((1-l)*e+l*r);return T*T+A*A}function ge(t,e){void 0===e&&(e={}),e.concavity=e.concavity||1/0;var n=[];if(O(t,(function(t){n.push([t[0],t[1]])})),!n.length)return null;var r=re(n,e.concavity);return r.length>3?u([r]):null}function ye(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=K(t),i=it(e),o=i.type,a=e.bbox,s=i.coordinates;if(a&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(r,a))return!1;"Polygon"===o&&(s=[s]);for(var l=!1,c=0;c<s.length&&!l;c++)if(ve(r,s[c][0],n.ignoreBoundary)){for(var u=!1,h=1;h<s[c].length&&!u;)ve(r,s[c][h],!n.ignoreBoundary)&&(u=!0),h++;u||(l=!0)}return l}function ve(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var a=e[i][0],s=e[i][1],l=e[o][0],c=e[o][1];if(t[1]*(a-l)+s*(l-t[0])+c*(t[0]-a)==0&&(a-t[0])*(l-t[0])<=0&&(s-t[1])*(c-t[1])<=0)return!n;s>t[1]!=c>t[1]&&t[0]<(l-a)*(t[1]-s)/(c-s)+a&&(r=!r)}return r}function _e(t,e){var n=[];return F(t,(function(t){var r=!1;if("Point"===t.geometry.type)U(e,(function(e){ye(t,e)&&(r=!0)})),r&&n.push(t);else{if("MultiPoint"!==t.geometry.type)throw new Error("Input geometry must be a Point or MultiPoint");var i=[];U(e,(function(e){O(t,(function(t){ye(t,e)&&(r=!0,i.push(t))}))})),r&&n.push(g(i))}})),f(n)}function xe(t,e,n){void 0===n&&(n={});var r=K(t),i=K(e),o=S(i[1]-r[1]),a=S(i[0]-r[0]),s=S(r[1]),l=S(i[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(l);return x(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}function be(t,e){var n=!1;return f(function(t){if(t.length<3)return[];t.sort(Me);for(var e,n,r,i,o,a,s=t.length-1,l=t[s].x,c=t[0].x,u=t[s].y,h=u,p=1e-12;s--;)t[s].y<u&&(u=t[s].y),t[s].y>h&&(h=t[s].y);var d,f=c-l,m=h-u,g=f>m?f:m,y=.5*(c+l),v=.5*(h+u),_=[new we({__sentinel:!0,x:y-20*g,y:v-g},{__sentinel:!0,x:y,y:v+20*g},{__sentinel:!0,x:y+20*g,y:v-g})],x=[],b=[];for(s=t.length;s--;){for(b.length=0,d=_.length;d--;)(f=t[s].x-_[d].x)>0&&f*f>_[d].r?(x.push(_[d]),_.splice(d,1)):f*f+(m=t[s].y-_[d].y)*m>_[d].r||(b.push(_[d].a,_[d].b,_[d].b,_[d].c,_[d].c,_[d].a),_.splice(d,1));for(Ee(b),d=b.length;d;)n=b[--d],e=b[--d],r=t[s],i=n.x-e.x,o=n.y-e.y,a=2*(i*(r.y-n.y)-o*(r.x-n.x)),Math.abs(a)>p&&_.push(new we(e,n,r))}for(Array.prototype.push.apply(x,_),s=x.length;s--;)(x[s].a.__sentinel||x[s].b.__sentinel||x[s].c.__sentinel)&&x.splice(s,1);return x}(t.features.map((function(t){var r={x:t.geometry.coordinates[0],y:t.geometry.coordinates[1]};return e?r.z=t.properties[e]:3===t.geometry.coordinates.length&&(n=!0,r.z=t.geometry.coordinates[2]),r}))).map((function(t){var e=[t.a.x,t.a.y],r=[t.b.x,t.b.y],i=[t.c.x,t.c.y],o={};return n?(e.push(t.a.z),r.push(t.b.z),i.push(t.c.z)):o={a:t.a.z,b:t.b.z,c:t.c.z},u([[e,r,i,e]],o)})))}re.default=ie;var we=function(t,e,n){this.a=t,this.b=e,this.c=n;var r,i,o=e.x-t.x,a=e.y-t.y,s=n.x-t.x,l=n.y-t.y,c=o*(t.x+e.x)+a*(t.y+e.y),u=s*(t.x+n.x)+l*(t.y+n.y),h=2*(o*(n.y-e.y)-a*(n.x-e.x));this.x=(l*c-a*u)/h,this.y=(o*u-s*c)/h,r=this.x-t.x,i=this.y-t.y,this.r=r*r+i*i};function Me(t,e){return e.x-t.x}function Ee(t){var e,n,r,i,o,a=t.length;t:for(;a;)for(n=t[--a],e=t[--a],r=a;r;)if(o=t[--r],e===(i=t[--r])&&n===o||e===o&&n===i){t.splice(a,2),t.splice(r,2),a-=2;continue t}}function Se(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Te(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}})),e.features=t.features.map((function(t){return Te(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Ce(t);default:throw new Error("unknown GeoJSON type")}}function Te(t){var e={type:"Feature"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}})),e.properties=Ae(t.properties),e.geometry=Ce(t.geometry),e}function Ae(t){var e={};return t?(Object.keys(t).forEach((function(n){var r=t[n];"object"==typeof r?null===r?e[n]=null:Array.isArray(r)?e[n]=r.map((function(t){return t})):e[n]=Ae(r):e[n]=r})),e):e}function Ce(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return Ce(t)})),e):(e.coordinates=Le(t.coordinates),e)}function Le(t){var e=t;return"object"!=typeof e[0]?e.slice():e.map((function(t){return Le(t)}))}function Ie(t,e){if(void 0===e&&(e={}),!L(e=e||{}))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=Se(t));var r=[],i=X(t,(function(t,e){var n=function(t,e){var n,r=t.geometry.coordinates,i=e.geometry.coordinates,o=Pe(r[0]),a=Pe(r[r.length-1]),s=Pe(i[0]),l=Pe(i[i.length-1]);if(o===l)n=i.concat(r.slice(1));else if(s===a)n=r.concat(i.slice(1));else if(o===s)n=r.slice(1).reverse().concat(i);else{if(a!==l)return null;n=r.concat(i.reverse().slice(1))}return p(n)}(t,e);return n||(r.push(t),e)}));return i&&r.push(i),r.length?1===r.length?r[0]:m(r.map((function(t){return t.coordinates}))):null}function Pe(t){return t[0].toString()+","+t[1].toString()}function Re(t){return t}function Oe(t,e){var n=function(t){if(null==t)return Re;var e,n,r=t.scale[0],i=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0);var l=2,c=t.length,u=new Array(c);for(u[0]=(e+=t[0])*r+o,u[1]=(n+=t[1])*i+a;l<c;)u[l]=t[l],++l;return u}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,a=i.length;o<a;++o)e.push(n(i[o],o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,a)}function o(t){return n(t)}function a(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(s)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=o(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(o);break;case"LineString":n=a(e.arcs);break;case"MultiLineString":n=e.arcs.map(a);break;case"Polygon":n=l(e.arcs);break;case"MultiPolygon":n=e.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(e)}function De(t,e){var n={},r={},i={},o=[],a=-1;function s(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),o.push(i)}}return e.forEach((function(n,r){var i,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++a],e[a]=n,e[r]=i)})),e.forEach((function(e){var n,o,a=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];return t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1],e<0?[n,i]:[i,n]}(e),s=a[0],l=a[1];if(n=i[s])if(delete i[n.end],n.push(e),n.end=l,o=r[l]){delete r[o.start];var c=o===n?n:n.concat(o);r[c.start=n.start]=i[c.end=o.end]=c}else r[n.start]=i[n.end]=n;else if(n=r[l])if(delete r[n.start],n.unshift(e),n.start=s,o=i[s]){delete i[o.end];var u=o===n?n:o.concat(n);r[u.start=o.start]=i[u.end=n.end]=u}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=s]=i[n.end=l]=n})),s(i,r),s(r,i),e.forEach((function(t){n[t<0?~t:t]||o.push([t])})),o}function Ne(t,e){var n={},r=[],i=[];function o(t){t.forEach((function(e){e.forEach((function(e){(n[e=e<0?~e:e]||(n[e]=[])).push(t)}))})),r.push(t)}function a(e){return function(t){for(var e,n=-1,r=t.length,i=t[r-1],o=0;++n<r;)e=i,i=t[n],o+=e[0]*i[1]-e[1]*i[0];return Math.abs(o)}(Oe(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach((function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":o(e.arcs);break;case"MultiPolygon":e.arcs.forEach(o)}})),r.forEach((function(t){if(!t._){var e=[],r=[t];for(t._=1,i.push(e);t=r.pop();)e.push(t),t.forEach((function(t){t.forEach((function(t){n[t<0?~t:t].forEach((function(t){t._||(t._=1,r.push(t))}))}))}))}})),r.forEach((function(t){delete t._})),{type:"MultiPolygon",arcs:i.map((function(e){var r,i=[];if(e.forEach((function(t){t.forEach((function(t){t.forEach((function(t){n[t<0?~t:t].length<2&&i.push(t)}))}))})),(r=(i=De(t,i)).length)>1)for(var o,s,l=1,c=a(i[0]);l<r;++l)(o=a(i[l]))>c&&(s=i[0],i[0]=i[l],i[l]=s,c=o);return i})).filter((function(t){return t.length>0}))}}var ke=Object.prototype.hasOwnProperty;function Fe(t,e,n,r,i,o){3===arguments.length&&(r=o=Array,i=null);for(var a=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),s=new o(t),l=t-1,c=0;c<t;++c)a[c]=i;function u(r,o){for(var c=e(r)&l,u=a[c],h=0;u!=i;){if(n(u,r))return s[c]=o;if(++h>=t)throw new Error("full hashmap");u=a[c=c+1&l]}return a[c]=r,s[c]=o,o}function h(r,o){for(var c=e(r)&l,u=a[c],h=0;u!=i;){if(n(u,r))return s[c];if(++h>=t)throw new Error("full hashmap");u=a[c=c+1&l]}return a[c]=r,s[c]=o,o}function p(r,o){for(var c=e(r)&l,u=a[c],h=0;u!=i;){if(n(u,r))return s[c];if(++h>=t)break;u=a[c=c+1&l]}return o}function d(){for(var t=[],e=0,n=a.length;e<n;++e){var r=a[e];r!=i&&t.push(r)}return t}return{set:u,maybeSet:h,get:p,keys:d}}function ze(t,e){return t[0]===e[0]&&t[1]===e[1]}var Be=new ArrayBuffer(16),Ue=new Float64Array(Be),je=new Uint32Array(Be);function Ge(t){Ue[0]=t[0],Ue[1]=t[1];var e=je[0]^je[1];return 2147483647&(e<<5^e>>7^je[2]^je[3])}function Ve(t){var e,n,r,i,o=t.coordinates,a=t.lines,s=t.rings,l=function(){for(var t=Fe(1.4*o.length,b,w,Int32Array,-1,Int32Array),e=new Int32Array(o.length),n=0,r=o.length;n<r;++n)e[n]=t.maybeSet(n,n);return e}(),c=new Int32Array(o.length),u=new Int32Array(o.length),h=new Int32Array(o.length),p=new Int8Array(o.length),d=0;for(e=0,n=o.length;e<n;++e)c[e]=u[e]=h[e]=-1;for(e=0,n=a.length;e<n;++e){var f=a[e],m=f[0],g=f[1];for(r=l[m],i=l[++m],++d,p[r]=1;++m<=g;)x(e,r,r=i,i=l[m]);++d,p[i]=1}for(e=0,n=o.length;e<n;++e)c[e]=-1;for(e=0,n=s.length;e<n;++e){var y=s[e],v=y[0]+1,_=y[1];for(x(e,l[_-1],r=l[v-1],i=l[v]);++v<=_;)x(e,r,r=i,i=l[v])}function x(t,e,n,r){if(c[n]!==t){c[n]=t;var i=u[n];if(i>=0){var o=h[n];i===e&&o===r||i===r&&o===e||(++d,p[n]=1)}else u[n]=e,h[n]=r}}function b(t){return Ge(o[t])}function w(t,e){return ze(o[t],o[e])}c=u=h=null;var M,E=function(t,e,n,r,i){3===arguments.length&&(r=Array,i=null);for(var o=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),a=t-1,s=0;s<t;++s)o[s]=i;function l(r){for(var s=e(r)&a,l=o[s],c=0;l!=i;){if(n(l,r))return!0;if(++c>=t)throw new Error("full hashset");l=o[s=s+1&a]}return o[s]=r,!0}function c(r){for(var s=e(r)&a,l=o[s],c=0;l!=i;){if(n(l,r))return!0;if(++c>=t)break;l=o[s=s+1&a]}return!1}function u(){for(var t=[],e=0,n=o.length;e<n;++e){var r=o[e];r!=i&&t.push(r)}return t}return{add:l,has:c,values:u}}(1.4*d,Ge,ze);for(e=0,n=o.length;e<n;++e)p[M=l[e]]&&E.add(o[M]);return E}function He(t,e,n,r){We(t,e,n),We(t,e,e+r),We(t,e+r,n)}function We(t,e,n){for(var r,i=e+(n---e>>1);e<i;++e,--n)r=t[e],t[e]=t[n],t[n]=r}function qe(t){var e,n,r={};for(e in t)r[e]=null==(n=t[e])?{type:null}:("FeatureCollection"===n.type?Xe:"Feature"===n.type?Ze:Ye)(n);return r}function Xe(t){var e={type:"GeometryCollection",geometries:t.features.map(Ze)};return null!=t.bbox&&(e.bbox=t.bbox),e}function Ze(t){var e,n=Ye(t.geometry);for(e in null!=t.id&&(n.id=t.id),null!=t.bbox&&(n.bbox=t.bbox),t.properties){n.properties=t.properties;break}return n}function Ye(t){if(null==t)return{type:null};var e="GeometryCollection"===t.type?{type:"GeometryCollection",geometries:t.geometries.map(Ye)}:"Point"===t.type||"MultiPoint"===t.type?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return null!=t.bbox&&(e.bbox=t.bbox),e}function $e(t,e){var n=function(t){var e=1/0,n=1/0,r=-1/0,i=-1/0;function o(t){null!=t&&ke.call(a,t.type)&&a[t.type](t)}var a={GeometryCollection:function(t){t.geometries.forEach(o)},Point:function(t){s(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(s)},LineString:function(t){l(t.arcs)},MultiLineString:function(t){t.arcs.forEach(l)},Polygon:function(t){t.arcs.forEach(l)},MultiPolygon:function(t){t.arcs.forEach(c)}};function s(t){var o=t[0],a=t[1];o<e&&(e=o),o>r&&(r=o),a<n&&(n=a),a>i&&(i=a)}function l(t){t.forEach(s)}function c(t){t.forEach(l)}for(var u in t)o(t[u]);return r>=e&&i>=n?[e,n,r,i]:void 0}(t=qe(t)),r=e>0&&n&&function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=o-r?(n-1)/(o-r):1,l=a-i?(n-1)/(a-i):1;function c(t){return[Math.round((t[0]-r)*s),Math.round((t[1]-i)*l)]}function u(t,e){for(var n,o,a,c,u,h=-1,p=0,d=t.length,f=new Array(d);++h<d;)n=t[h],c=Math.round((n[0]-r)*s),u=Math.round((n[1]-i)*l),c===o&&u===a||(f[p++]=[o=c,a=u]);for(f.length=p;p<e;)p=f.push([f[0][0],f[0][1]]);return f}function h(t){return u(t,2)}function p(t){return u(t,4)}function d(t){return t.map(p)}function f(t){null!=t&&ke.call(m,t.type)&&m[t.type](t)}var m={GeometryCollection:function(t){t.geometries.forEach(f)},Point:function(t){t.coordinates=c(t.coordinates)},MultiPoint:function(t){t.coordinates=t.coordinates.map(c)},LineString:function(t){t.arcs=h(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(h)},Polygon:function(t){t.arcs=d(t.arcs)},MultiPolygon:function(t){t.arcs=t.arcs.map(d)}};for(var g in t)f(t[g]);return{scale:[1/s,1/l],translate:[r,i]}}(t,n,e),i=function(t){var e,n,r,i,o=t.coordinates,a=t.lines,s=t.rings,l=a.length+s.length;for(delete t.lines,delete t.rings,r=0,i=a.length;r<i;++r)for(e=a[r];e=e.next;)++l;for(r=0,i=s.length;r<i;++r)for(n=s[r];n=n.next;)++l;var c=Fe(2*l*1.4,Ge,ze),u=t.arcs=[];for(r=0,i=a.length;r<i;++r){e=a[r];do{h(e)}while(e=e.next)}for(r=0,i=s.length;r<i;++r)if((n=s[r]).next)do{h(n)}while(n=n.next);else p(n);function h(t){var e,n,r,i,a,s,l,h;if(r=c.get(e=o[t[0]]))for(l=0,h=r.length;l<h;++l)if(d(i=r[l],t))return t[0]=i[0],void(t[1]=i[1]);if(a=c.get(n=o[t[1]]))for(l=0,h=a.length;l<h;++l)if(f(s=a[l],t))return t[1]=s[0],void(t[0]=s[1]);r?r.push(t):c.set(e,[t]),a?a.push(t):c.set(n,[t]),u.push(t)}function p(t){var e,n,r,i,a;if(n=c.get(o[t[0]]))for(i=0,a=n.length;i<a;++i){if(m(r=n[i],t))return t[0]=r[0],void(t[1]=r[1]);if(g(r,t))return t[0]=r[1],void(t[1]=r[0])}if(n=c.get(e=o[t[0]+y(t)]))for(i=0,a=n.length;i<a;++i){if(m(r=n[i],t))return t[0]=r[0],void(t[1]=r[1]);if(g(r,t))return t[0]=r[1],void(t[1]=r[0])}n?n.push(t):c.set(e,[t]),u.push(t)}function d(t,e){var n=t[0],r=e[0],i=t[1];if(n-i!=r-e[1])return!1;for(;n<=i;++n,++r)if(!ze(o[n],o[r]))return!1;return!0}function f(t,e){var n=t[0],r=e[0],i=t[1],a=e[1];if(n-i!=r-a)return!1;for(;n<=i;++n,--a)if(!ze(o[n],o[a]))return!1;return!0}function m(t,e){var n=t[0],r=e[0],i=t[1]-n;if(i!==e[1]-r)return!1;for(var a=y(t),s=y(e),l=0;l<i;++l)if(!ze(o[n+(l+a)%i],o[r+(l+s)%i]))return!1;return!0}function g(t,e){var n=t[0],r=e[0],i=t[1],a=e[1],s=i-n;if(s!==a-r)return!1;for(var l=y(t),c=s-y(e),u=0;u<s;++u)if(!ze(o[n+(u+l)%s],o[a-(u+c)%s]))return!1;return!0}function y(t){for(var e=t[0],n=t[1],r=e,i=r,a=o[r];++r<n;){var s=o[r];(s[0]<a[0]||s[0]===a[0]&&s[1]<a[1])&&(i=r,a=s)}return i-e}return t}(function(t){var e,n,r,i=Ve(t),o=t.coordinates,a=t.lines,s=t.rings;for(n=0,r=a.length;n<r;++n)for(var l=a[n],c=l[0],u=l[1];++c<u;)i.has(o[c])&&(e={0:c,1:l[1]},l[1]=c,l=l.next=e);for(n=0,r=s.length;n<r;++n)for(var h=s[n],p=h[0],d=p,f=h[1],m=i.has(o[p]);++d<f;)i.has(o[d])&&(m?(e={0:d,1:h[1]},h[1]=d,h=h.next=e):(He(o,p,f,f-d),o[f]=o[p],m=!0,d=p));return t}(function(t){var e=-1,n=[],r=[],i=[];function o(t){t&&ke.call(a,t.type)&&a[t.type](t)}var a={GeometryCollection:function(t){t.geometries.forEach(o)},LineString:function(t){t.arcs=s(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(s)},Polygon:function(t){t.arcs=t.arcs.map(l)},MultiPolygon:function(t){t.arcs=t.arcs.map(c)}};function s(t){for(var r=0,o=t.length;r<o;++r)i[++e]=t[r];var a={0:e-o+1,1:e};return n.push(a),a}function l(t){for(var n=0,o=t.length;n<o;++n)i[++e]=t[n];var a={0:e-o+1,1:e};return r.push(a),a}function c(t){return t.map(l)}for(var u in t)o(t[u]);return{type:"Topology",coordinates:i,lines:n,rings:r,objects:t}}(t))),o=i.coordinates,a=Fe(1.4*i.arcs.length,Je,Ke);function s(t){t&&ke.call(l,t.type)&&l[t.type](t)}t=i.objects,i.bbox=n,i.arcs=i.arcs.map((function(t,e){return a.set(t,e),o.slice(t[0],t[1]+1)})),delete i.coordinates,o=null;var l={GeometryCollection:function(t){t.geometries.forEach(s)},LineString:function(t){t.arcs=c(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(c)},Polygon:function(t){t.arcs=t.arcs.map(c)},MultiPolygon:function(t){t.arcs=t.arcs.map(u)}};function c(t){var e=[];do{var n=a.get(t);e.push(t[0]<t[1]?n:~n)}while(t=t.next);return e}function u(t){return t.map(c)}for(var h in t)s(t[h]);return r&&(i.transform=r,i.arcs=function(t){for(var e=-1,n=t.length;++e<n;){for(var r,i,o=t[e],a=0,s=1,l=o.length,c=o[0],u=c[0],h=c[1];++a<l;)r=(c=o[a])[0],i=c[1],r===u&&i===h||(o[s++]=[r-u,i-h],u=r,h=i);1===s&&(o[s++]=[0,0]),o.length=s}return t}(i.arcs)),i}function Je(t){var e,n=t[0],r=t[1];return r<n&&(e=n,n=r,r=e),n+31*r}function Ke(t,e){var n,r=t[0],i=t[1],o=e[0],a=e[1];return i<r&&(n=r,r=i,i=n),a<o&&(n=o,o=a,a=n),r===o&&i===a}function Qe(t,e){if(void 0===e&&(e={}),"FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==e.mutate&&void 0!==e.mutate||(t=Se(t));var n=[];G(t,(function(t){n.push(t.geometry)}));var r=$e({geoms:v(n).geometry});return function(t){return Oe(t,Ne.apply(this,arguments))}(r,r.objects.geoms.geometries)}function tn(t,e){if(void 0===e&&(e={}),!L(e=e||{}))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==ot(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=Se(t));var r=function(t){var e={};G(t,(function(t){e[t.geometry.type]=!0}));var n=Object.keys(e);return 1===n.length?n[0]:null}(t);if(!r)throw new Error("geojson must be homogenous");var i=t;switch(r){case"LineString":return Ie(i,e);case"Polygon":return Qe(i,e);default:throw new Error(r+" is not supported")}}function en(t,e){void 0===e&&(e={});var n="object"==typeof e?e.mutate:e;if(!t)throw new Error("geojson is required");var r=ot(t),i=[];switch(r){case"LineString":i=nn(t);break;case"MultiLineString":case"Polygon":Q(t).forEach((function(t){i.push(nn(t))}));break;case"MultiPolygon":Q(t).forEach((function(t){var e=[];t.forEach((function(t){e.push(nn(t))})),i.push(e)}));break;case"Point":return t;case"MultiPoint":var o={};Q(t).forEach((function(t){var e=t.join("-");Object.prototype.hasOwnProperty.call(o,e)||(i.push(t),o[e]=!0)}));break;default:throw new Error(r+" geometry not supported")}return t.coordinates?!0===n?(t.coordinates=i,t):{type:r,coordinates:i}:!0===n?(t.geometry.coordinates=i,t):a({type:r,coordinates:i},t.properties,{bbox:t.bbox,id:t.id})}function nn(t){var e=Q(t);if(2===e.length&&!rn(e[0],e[1]))return e;var n=[],r=e.length-1,i=n.length;n.push(e[0]);for(var o=1;o<r;o++){var a=n[n.length-1];e[o][0]===a[0]&&e[o][1]===a[1]||(n.push(e[o]),(i=n.length)>2&&on(n[i-3],n[i-1],n[i-2])&&n.splice(n.length-2,1))}if(n.push(e[e.length-1]),i=n.length,rn(e[0],e[e.length-1])&&i<4)throw new Error("invalid polygon");return on(n[i-3],n[i-1],n[i-2])&&n.splice(n.length-2,1),n}function rn(t,e){return t[0]===e[0]&&t[1]===e[1]}function on(t,e,n){var r=n[0],i=n[1],o=t[0],a=t[1],s=e[0],l=e[1],c=s-o,u=l-a;return 0===(r-o)*u-(i-a)*c&&(Math.abs(c)>=Math.abs(u)?c>0?o<=r&&r<=s:s<=r&&r<=o:u>0?a<=i&&i<=l:l<=i&&i<=a)}function an(t,e,n){var r=e.x,i=e.y,o=n.x-r,a=n.y-i;if(0!==o||0!==a){var s=((t.x-r)*o+(t.y-i)*a)/(o*o+a*a);s>1?(r=n.x,i=n.y):s>0&&(r+=o*s,i+=a*s)}return(o=t.x-r)*o+(a=t.y-i)*a}function sn(t,e,n,r,i){for(var o,a=r,s=e+1;s<n;s++){var l=an(t[s],t[e],t[n]);l>a&&(o=s,a=l)}a>r&&(o-e>1&&sn(t,e,o,r,i),i.push(t[o]),n-o>1&&sn(t,o,n,r,i))}function ln(t,e){var n=t.length-1,r=[t[0]];return sn(t,0,n,e,r),r.push(t[n]),r}function cn(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return ln(t=n?t:function(t,e){for(var n,r,i,o,a,s=t[0],l=[s],c=1,u=t.length;c<u;c++)n=t[c],i=s,o=void 0,a=void 0,o=(r=n).x-i.x,a=r.y-i.y,o*o+a*a>e&&(l.push(n),s=n);return s!==n&&l.push(n),l}(t,r),r)}function un(t,e,n){return cn(t.map((function(t){return{x:t[0],y:t[1],z:t[2]}})),e,n).map((function(t){return t.z?[t.x,t.y,t.z]:[t.x,t.y]}))}function hn(t,e,n){return t.map((function(t){var r=t.map((function(t){return{x:t[0],y:t[1]}}));if(r.length<4)throw new Error("invalid polygon");for(var i=cn(r,e,n).map((function(t){return[t.x,t.y]}));!pn(i);)i=cn(r,e-=.01*e,n).map((function(t){return[t.x,t.y]}));return i[i.length-1][0]===i[0][0]&&i[i.length-1][1]===i[0][1]||i.push(i[0]),i}))}function pn(t){return!(t.length<3)&&!(3===t.length&&t[2][0]===t[0][0]&&t[2][1]===t[0][1])}var dn=function(){function t(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var n=this.points[e],r=this.points[e+1];this.centers.push({x:(n.x+r.x)/2,y:(n.y+r.y)/2,z:(n.z+r.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),e=0;e<this.centers.length-1;e++){var i=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,a=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+a)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+a)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}return t.prototype.cacheSteps=function(t){var e=[],n=this.pos(0);e.push(0);for(var r=0;r<this.duration;r+=10){var i=this.pos(r);Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)+(i.z-n.z)*(i.z-n.z))>t&&(e.push(r),n=i)}return e},t.prototype.vector=function(t){var e=this.pos(t+10),n=this.pos(t-10);return{angle:180*Math.atan2(e.y-n.y,e.x-n.x)/3.14,speed:Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)+(n.z-e.z)*(n.z-e.z))}},t.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var n=e/this.duration;if(n>=1)return this.points[this.length-1];var r=Math.floor((this.points.length-1)*n);return function(t,e,n,r,i){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:i.x*o[0]+r.x*o[1]+n.x*o[2]+e.x*o[3],y:i.y*o[0]+r.y*o[1]+n.y*o[2]+e.y*o[3],z:i.z*o[0]+r.z*o[1]+n.z*o[2]+e.z*o[3]}}((this.length-1)*n-r,this.points[r],this.controls[r][1],this.controls[r+1][0],this.points[r+1])},t}();function fn(t,e){void 0===e&&(e={});for(var n=e.resolution||1e4,r=e.sharpness||.85,i=[],o=it(t).coordinates.map((function(t){return{x:t[0],y:t[1]}})),a=new dn({duration:n,points:o,sharpness:r}),s=function(t){var e=a.pos(t);Math.floor(t/100)%2==0&&i.push([e.x,e.y])},l=0;l<a.duration;l+=10)s(l);return s(a.duration),p(i,e.properties)}function mn(t,e){void 0===e&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r];return u([[a,[i,r],[i,o],[n,o],a]],e.properties,{bbox:t,id:e.id})}function gn(t){return mn(J(t))}function yn(t){var e=t[0],n=t[1],r=t[2],i=t[3];if(xe(t.slice(0,2),[r,n])>=xe(t.slice(0,2),[e,i])){var o=(n+i)/2;return[e,o-(r-e)/2,r,o+(r-e)/2]}var a=(e+r)/2;return[a-(i-n)/2,n,a+(i-n)/2,i]}function vn(t,e,n,r){void 0===r&&(r={});var i=K(t),o=S(i[0]),a=S(i[1]),s=S(n),c=b(e,r.units),u=Math.asin(Math.sin(a)*Math.cos(c)+Math.cos(a)*Math.sin(c)*Math.cos(s));return l([E(o+Math.atan2(Math.sin(s)*Math.sin(c)*Math.cos(a),Math.cos(c)-Math.sin(a)*Math.sin(u))),E(u)],r.properties)}function _n(t,e,n){void 0===n&&(n={});for(var r=n.steps||64,i=n.properties?n.properties:!Array.isArray(t)&&"Feature"===t.type&&t.properties?t.properties:{},o=[],a=0;a<r;a++)o.push(vn(t,e,-360*a/r,n).geometry.coordinates);return o.push(o[0]),u([o],i)}function xn(t,e,n){if(void 0===n&&(n={}),!0===n.final)return function(t,e){var n=xn(e,t);return(n+180)%360}(t,e);var r=K(t),i=K(e),o=S(r[0]),a=S(i[0]),s=S(r[1]),l=S(i[1]),c=Math.sin(a-o)*Math.cos(l),u=Math.cos(s)*Math.sin(l)-Math.sin(s)*Math.cos(l)*Math.cos(a-o);return E(Math.atan2(c,u))}function bn(t,e){void 0===e&&(e={});var n=J(t);return l([(n[0]+n[2])/2,(n[1]+n[3])/2],e.properties,e)}function wn(t,e){void 0===e&&(e={});var n=0,r=0,i=0;return O(t,(function(t){n+=t[0],r+=t[1],i++}),!0),l([n/i,r/i],e.properties)}function Mn(t){var e=[];return"FeatureCollection"===t.type?F(t,(function(t){O(t,(function(n){e.push(l(n,t.properties))}))})):O(t,(function(n){e.push(l(n,t.properties))})),f(e)}var En=Tn,Sn=Tn;function Tn(t,e,n){n=n||2;var r,i,o,a,s,l,c,u=e&&e.length,h=u?e[0]*n:t.length,p=An(t,0,h,n,!0),d=[];if(!p)return d;if(u&&(p=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=An(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(Fn(a));for(s.sort(Dn),i=0;i<s.length;i++)Nn(s[i],n),n=Cn(n,n.next);return n}(t,e,p,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var f=n;f<h;f+=n)(s=t[f])<r&&(r=s),(l=t[f+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-r,a-i))?1/c:0}return Ln(p,d,n,r,i,c),d}function An(t,e,n,r,i){var o,a;if(i===Zn(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Wn(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Wn(o,t[o],t[o+1],a);return a&&jn(a,a.next)&&(qn(a),a=a.next),a}function Cn(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!jn(r,r.next)&&0!==Un(r.prev,r,r.next))r=r.next;else{if(qn(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Ln(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=kn(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,l,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,o);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?Pn(t,r,i,o):In(t))e.push(s.i/n),e.push(t.i/n),e.push(l.i/n),qn(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?Ln(t=Rn(t,e,n),e,n,r,i,o,2):2===a&&On(t,e,n,r,i,o):Ln(Cn(t),e,n,r,i,o,1);break}}}function In(t){var e=t.prev,n=t,r=t.next;if(Un(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(zn(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Un(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Pn(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Un(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=kn(s,l,e,n,r),p=kn(c,u,e,n,r),d=t.prevZ,f=t.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&zn(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Un(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&zn(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Un(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&zn(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Un(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&zn(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Un(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Rn(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!jn(i,o)&&Gn(i,r,r.next,o)&&Vn(i,o)&&Vn(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),qn(r),qn(r.next),r=t=o),r=r.next}while(r!==t);return r}function On(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Bn(a,s)){var l=Hn(a,s);return a=Cn(a,a.next),l=Cn(l,l.next),Ln(a,e,n,r,i,o),void Ln(l,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function Dn(t,e){return t.x-e.x}function Nn(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n.prev;var l,c=n,u=n.x,h=n.y,p=1/0;for(r=n.next;r!==c;)i>=r.x&&r.x>=u&&i!==r.x&&zn(o<h?i:a,o,u,h,o<h?a:i,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(i-r.x))<p||l===p&&r.x>n.x)&&Vn(r,t)&&(n=r,p=l),r=r.next;return n}(t,e)){var n=Hn(e,t);Cn(n,n.next)}}function kn(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Fn(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function zn(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Bn(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Gn(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&Vn(t,e)&&Vn(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function Un(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function jn(t,e){return t.x===e.x&&t.y===e.y}function Gn(t,e,n,r){return!!(jn(t,e)&&jn(n,r)||jn(t,r)&&jn(n,e))||Un(t,e,n)>0!=Un(t,e,r)>0&&Un(n,r,t)>0!=Un(n,r,e)>0}function Vn(t,e){return Un(t.prev,t,t.next)<0?Un(t,e,t.next)>=0&&Un(t,t.prev,e)>=0:Un(t,e,t.prev)<0||Un(t,t.next,e)<0}function Hn(t,e){var n=new Xn(t.i,t.x,t.y),r=new Xn(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Wn(t,e,n,r){var i=new Xn(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function qn(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Xn(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zn(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function Yn(t){var e=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}(t),n=En(e.vertices,e.holes,2),r=[],i=[];n.forEach((function(t,r){var o=n[r];i.push([e.vertices[2*o],e.vertices[2*o+1]])}));for(var o=0;o<i.length;o+=3){var a=i.slice(o,o+3);a.push(i[o]),r.push(u([a]))}return r}function $n(t,e){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var n,r=1/0,i=0;return F(e,(function(e,n){var o=xe(t,e);o<r&&(i=n,r=o)})),(n=Se(e.features[i])).properties.featureIndex=i,n.properties.distanceToPoint=r,n}function Jn(t){if(!t)throw new Error("geojson is required");var e=[];return G(t,(function(t){!function(t,e){var n=[],r=t.geometry;if(null!==r){switch(r.type){case"Polygon":n=Q(r);break;case"LineString":n=[Q(r)]}n.forEach((function(n){(function(t,e){var n=[];return t.reduce((function(t,r){var i=p([t,r],e);return i.bbox=function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return[n<i?n:i,r<o?r:o,n>i?n:i,r>o?r:o]}(t,r),n.push(i),r})),n})(n,t.properties).forEach((function(t){t.id=e.length,e.push(t)}))}))}}(t,e)})),f(e)}Tn.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(Zn(t,0,o,n));if(i)for(var s=0,l=e.length;s<l;s++){var c=e[s]*n,u=s<l-1?e[s+1]*n:t.length;a-=Math.abs(Zn(t,c,u,n))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,d=r[s+1]*n,f=r[s+2]*n;h+=Math.abs((t[p]-t[f])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[f+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},Tn.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n},En.default=Sn;var Kn=jt((function(t,e){function n(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function r(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!d(t[0])||!d(t[1]))throw new Error("coordinates must contain numbers");return n({type:"Point",coordinates:t},e,r)}function i(t,e,r){void 0===r&&(r={});for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return n({type:"Polygon",coordinates:t},e,r)}function o(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return n({type:"LineString",coordinates:t},e,r)}function a(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function s(t,e,r){return void 0===r&&(r={}),n({type:"MultiLineString",coordinates:t},e,r)}function l(t,e,r){return void 0===r&&(r={}),n({type:"MultiPoint",coordinates:t},e,r)}function c(t,e,r){return void 0===r&&(r={}),n({type:"MultiPolygon",coordinates:t},e,r)}function u(t,n){void 0===n&&(n="kilometers");var r=e.factors[n];if(!r)throw new Error(n+" units is invalid");return t*r}function h(t,n){void 0===n&&(n="kilometers");var r=e.factors[n];if(!r)throw new Error(n+" units is invalid");return t/r}function p(t){return t%(2*Math.PI)*180/Math.PI}function d(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:1.0936*e.earthRadius},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=n,e.geometry=function(t,e,n){switch(t){case"Point":return r(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return i(e).geometry;case"MultiPoint":return l(e).geometry;case"MultiLineString":return s(e).geometry;case"MultiPolygon":return c(e).geometry;default:throw new Error(t+" is invalid")}},e.point=r,e.points=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return r(t,e)})),n)},e.polygon=i,e.polygons=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return i(t,e)})),n)},e.lineString=o,e.lineStrings=function(t,e,n){return void 0===n&&(n={}),a(t.map((function(t){return o(t,e)})),n)},e.featureCollection=a,e.multiLineString=s,e.multiPoint=l,e.multiPolygon=c,e.geometryCollection=function(t,e,r){return void 0===r&&(r={}),n({type:"GeometryCollection",geometries:t},e,r)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n},e.radiansToLength=u,e.lengthToRadians=h,e.lengthToDegrees=function(t,e){return p(h(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=p,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return u(h(t,e),n)},e.convertArea=function(t,n,r){if(void 0===n&&(n="meters"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("area must be a positive number");var i=e.areaFactors[n];if(!i)throw new Error("invalid original units");var o=e.areaFactors[r];if(!o)throw new Error("invalid final units");return t/i*o},e.isNumber=d,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!d(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}}));function Qn(t,e,n){if(null!==t)for(var r,i,o,a,s,l,c,u,h=0,p=0,d=t.type,f="FeatureCollection"===d,m="Feature"===d,g=f?t.features.length:1,y=0;y<g;y++){s=(u=!!(c=f?t.features[y].geometry:m?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<s;v++){var _=0,x=0;if(null!==(a=u?c.geometries[v]:c)){l=a.coordinates;var b=a.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(l,p,y,_,x))return!1;p++,_++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===e(l[r],p,y,_,x))return!1;p++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-h;i++){if(!1===e(l[r][i],p,y,_,x))return!1;p++}"MultiLineString"===b&&_++,"Polygon"===b&&x++}"Polygon"===b&&_++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(x=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-h;o++){if(!1===e(l[r][i][o],p,y,_,x))return!1;p++}x++}_++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===Qn(a.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function tr(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function er(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function nr(t,e){var n,r,i,o,a,s,l,c,u,h,p=0,d="FeatureCollection"===t.type,f="Feature"===t.type,m=d?t.features.length:1;for(n=0;n<m;n++){for(s=d?t.features[n].geometry:f?t.geometry:t,c=d?t.features[n].properties:f?t.properties:{},u=d?t.features[n].bbox:f?t.bbox:void 0,h=d?t.features[n].id:f?t.id:void 0,a=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=l?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,c,u,h))return!1;p++}}function rr(t,e){nr(t,(function(t,n,r,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(Kn.feature(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var l=0;l<t.coordinates.length;l++){var c={type:a,coordinates:t.coordinates[l]};if(!1===e(Kn.feature(c,r),n,l))return!1}}))}function ir(t,e){rr(t,(function(t,n,r){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,s=0,l=0,c=0;return!1!==Qn(t,(function(o,u,h,p,d){if(void 0===a||n>s||p>l||d>c)return a=o,s=n,l=p,c=d,void(i=0);var f=Kn.lineString([a,o],t.properties);if(!1===e(f,n,r,d,i))return!1;i++,a=o}))&&void 0}}}))}function or(t,e){if(!t)throw new Error("geojson is required");rr(t,(function(t,n,r){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":if(!1===e(t,n,r,0,0))return!1;break;case"Polygon":for(var a=0;a<o.length;a++)if(!1===e(Kn.lineString(o[a],t.properties),n,r,a))return!1}}}))}var ar=function(t){var e=[];return Qn(t,(function(t){e.push(t)})),e},sr=Qn,lr=function(t,e,n,r){var i=n;return Qn(t,(function(t,r,o,a,s){i=0===r&&void 0===n?t:e(i,t,r,o,a,s)}),r),i},cr=er,ur=function(t,e,n){var r=n;return er(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},hr=function(t,e){if(e=e||{},!Kn.isObject(e))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),s=s||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":s=s||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":return Kn.point(l,s,e);case"MultiPoint":return i<0&&(i=l.length+i),Kn.point(l[i],s,e);case"LineString":return a<0&&(a=l.length+a),Kn.point(l[a],s,e);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a),Kn.point(l[o][a],s,e);case"MultiLineString":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),Kn.point(l[i][a],s,e);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),a<0&&(a=l[i][o].length-a),Kn.point(l[i][o][a],s,e)}throw new Error("geojson is invalid")},pr=function(t,e){if(e=e||{},!Kn.isObject(e))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),s=s||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":s=s||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=l.length+a-1),Kn.lineString([l[a],l[a+1]],s,e);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a-1),Kn.lineString([l[o][a],l[o][a+1]],s,e);case"MultiLineString":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a-1),Kn.lineString([l[i][a],l[i][a+1]],s,e);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),a<0&&(a=l[i][o].length-a-1),Kn.lineString([l[i][o][a],l[i][o][a+1]],s,e)}throw new Error("geojson is invalid")},dr=rr,fr=function(t,e,n){var r=n;return rr(t,(function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)})),r},mr=nr,gr=function(t,e,n){var r=n;return nr(t,(function(t,i,o,a,s){r=0===i&&void 0===n?t:e(r,t,i,o,a,s)})),r},yr=or,vr=function(t,e,n){var r=n;return or(t,(function(t,i,o,a){r=0===i&&void 0===n?t:e(r,t,i,o,a)})),r},_r=tr,xr=function(t,e,n){var r=n;return tr(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},br=ir,wr=function(t,e,n){var r=n,i=!1;return ir(t,(function(t,o,a,s,l){r=!1===i&&void 0===n?t:e(r,t,o,a,s,l),i=!0})),r},Mr=Object.defineProperty({coordAll:ar,coordEach:sr,coordReduce:lr,featureEach:cr,featureReduce:ur,findPoint:hr,findSegment:pr,flattenEach:dr,flattenReduce:fr,geomEach:mr,geomReduce:gr,lineEach:yr,lineReduce:vr,propEach:_r,propReduce:xr,segmentEach:br,segmentReduce:wr},"__esModule",{value:!0});function Er(t){var e=[1/0,1/0,-1/0,-1/0];return Mr.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}Er.default=Er;var Sr=Er,Tr=Object.defineProperty({default:Sr},"__esModule",{value:!0}).default,Ar=Mr.featureEach,Cr=(Mr.coordEach,Kn.polygon,Kn.featureCollection);function Lr(t){var e=Tt(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Tr(t),Tt.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:Tr(t),e.push(t)})):Ar(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:Tr(t),e.push(t)})),Tt.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Tr(t),Tt.prototype.remove.call(this,t,e)},e.clear=function(){return Tt.prototype.clear.call(this)},e.search=function(t){var e=Tt.prototype.search.call(this,this.toBBox(t));return Cr(e)},e.collides=function(t){return Tt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Tt.prototype.all.call(this);return Cr(t)},e.toJSON=function(){return Tt.prototype.toJSON.call(this)},e.fromJSON=function(t){return Tt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=Tr(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=Tr(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}var Ir=Lr,Pr=Lr;function Rr(t,e){var n={},r=[];if("LineString"===t.type&&(t=a(t)),"LineString"===e.type&&(e=a(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var i=Or(t,e);return i&&r.push(i),f(r)}var o=Ir();return o.load(Jn(e)),F(Jn(t),(function(t){F(o.search(t),(function(e){var i=Or(t,e);if(i){var o=Q(i).join(",");n[o]||(n[o]=!0,r.push(i))}}))})),f(r)}function Or(t,e){var n=Q(t),r=Q(e);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],a=n[1][0],s=n[1][1],c=r[0][0],u=r[0][1],h=r[1][0],p=r[1][1],d=(p-u)*(a-i)-(h-c)*(s-o),f=(h-c)*(o-u)-(p-u)*(i-c),m=(a-i)*(o-u)-(s-o)*(i-c);if(0===d)return null;var g=f/d,y=m/d;return g>=0&&g<=1&&y>=0&&y<=1?l([i+g*(a-i),o+g*(s-o)]):null}function Dr(t,e,n){void 0===n&&(n={});var r=l([1/0,1/0],{dist:1/0}),i=0;return G(t,(function(t){for(var o=Q(t),a=0;a<o.length-1;a++){var s=l(o[a]);s.properties.dist=xe(e,s,n);var c=l(o[a+1]);c.properties.dist=xe(e,c,n);var u=xe(s,c,n),h=Math.max(s.properties.dist,c.properties.dist),d=xn(s,c),f=vn(e,h,d+90,n),m=vn(e,h,d-90,n),g=Rr(p([f.geometry.coordinates,m.geometry.coordinates]),p([s.geometry.coordinates,c.geometry.coordinates])),y=null;g.features.length>0&&((y=g.features[0]).properties.dist=xe(e,y,n),y.properties.location=i+xe(s,y,n)),s.properties.dist<r.properties.dist&&((r=s).properties.index=a,r.properties.location=i),c.properties.dist<r.properties.dist&&((r=c).properties.index=a+1,r.properties.location=i+u),y&&y.properties.dist<r.properties.dist&&((r=y).properties.index=a),i+=u}})),r}function Nr(t,e,r){void 0===r&&(r={});var i=K(t),o=K(e);return o[0]+=o[0]-i[0]>180?-360:i[0]-o[0]>180?360:0,T(function(t,e,r){var i=r=void 0===r?n:Number(r),o=t[1]*Math.PI/180,a=e[1]*Math.PI/180,s=a-o,l=Math.abs(e[0]-t[0])*Math.PI/180;l>Math.PI&&(l-=2*Math.PI);var c=Math.log(Math.tan(a/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),u=Math.abs(c)>1e-11?s/c:Math.cos(o);return Math.sqrt(s*s+u*u*l*l)*i}(i,o),"meters",r.units)}function kr(t,e,n){if(void 0===n&&(n={}),n.method||(n.method="geodesic"),n.units||(n.units="kilometers"),!t)throw new Error("pt is required");if(Array.isArray(t)?t=l(t):"Point"===t.type?t=a(t):nt(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=p(e):"LineString"===e.type?e=a(e):nt(e,"LineString","line");var r=1/0,i=t.geometry.coordinates;return H(e,(function(t){var e=t.geometry.coordinates[0],o=t.geometry.coordinates[1],a=function(t,e,n,r){var i=[n[0]-e[0],n[1]-e[1]],o=Fr([t[0]-e[0],t[1]-e[1]],i);if(o<=0)return zr(t,e,{method:r.method,units:"degrees"});var a=Fr(i,i);if(a<=o)return zr(t,n,{method:r.method,units:"degrees"});var s=o/a,l=[e[0]+s*i[0],e[1]+s*i[1]];return zr(t,l,{method:r.method,units:"degrees"})}(i,e,o,n);a<r&&(r=a)})),T(r,"degrees",n.units)}function Fr(t,e){return t[0]*e[0]+t[1]*e[1]}function zr(t,e,n){return"planar"===n.method?Nr(t,e,n):xe(t,e,n)}function Br(t,e,n,r,i,o,a,s){var l,c,u,h,p={x:null,y:null,onLine1:!1,onLine2:!1};return 0===(l=(s-o)*(n-t)-(a-i)*(r-e))?null!==p.x&&null!==p.y&&p:(h=(n-t)*(c=e-o)-(r-e)*(u=t-i),c=((a-i)*c-(s-o)*u)/l,u=h/l,p.x=t+c*(n-t),p.y=e+c*(r-e),c>=0&&c<=1&&(p.onLine1=!0),u>=0&&u<=1&&(p.onLine2=!0),!(!p.onLine1||!p.onLine2)&&[p.x,p.y])}function Ur(t){for(var e=function(t){return"FeatureCollection"!==t.type?"Feature"!==t.type?f([a(t)]):f([t]):t}(t),n=bn(e),r=!1,i=0;!r&&i<e.features.length;){var o,s=e.features[i].geometry,c=!1;if("Point"===s.type)n.geometry.coordinates[0]===s.coordinates[0]&&n.geometry.coordinates[1]===s.coordinates[1]&&(r=!0);else if("MultiPoint"===s.type){var u=!1;for(o=0;!u&&o<s.coordinates.length;)n.geometry.coordinates[0]===s.coordinates[o][0]&&n.geometry.coordinates[1]===s.coordinates[o][1]&&(r=!0,u=!0),o++}else if("LineString"===s.type)for(o=0;!c&&o<s.coordinates.length-1;)jr(n.geometry.coordinates[0],n.geometry.coordinates[1],s.coordinates[o][0],s.coordinates[o][1],s.coordinates[o+1][0],s.coordinates[o+1][1])&&(c=!0,r=!0),o++;else if("MultiLineString"===s.type)for(var h=0;h<s.coordinates.length;){c=!1,o=0;for(var p=s.coordinates[h];!c&&o<p.length-1;)jr(n.geometry.coordinates[0],n.geometry.coordinates[1],p[o][0],p[o][1],p[o+1][0],p[o+1][1])&&(c=!0,r=!0),o++;h++}else"Polygon"!==s.type&&"MultiPolygon"!==s.type||ye(n,s)&&(r=!0);i++}if(r)return n;var d=f([]);for(i=0;i<e.features.length;i++)d.features=d.features.concat(Mn(e.features[i]).features);return l($n(n,d).geometry.coordinates)}function jr(t,e,n,r,i,o){return Math.sqrt((i-n)*(i-n)+(o-r)*(o-r))===Math.sqrt((t-n)*(t-n)+(e-r)*(e-r))+Math.sqrt((i-t)*(i-t)+(o-e)*(o-e))}Ir.default=Pr;var Gr=6378137;function Vr(t){return j(t,(function(t,e){return t+function(t){var e,n=0;switch(t.type){case"Polygon":return Hr(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=Hr(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),0)}function Hr(t){var e=0;if(t&&t.length>0){e+=Math.abs(Wr(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(Wr(t[n]))}return e}function Wr(t){var e,n,r,i,o,a,s=0,l=t.length;if(l>2){for(a=0;a<l;a++)a===l-2?(r=l-2,i=l-1,o=0):a===l-1?(r=l-1,i=0,o=1):(r=a,i=a+1,o=a+2),e=t[r],n=t[i],s+=(qr(t[o][0])-qr(e[0]))*Math.sin(qr(n[1]));s=s*Gr*Gr/2}return s}function qr(t){return t*Math.PI/180}function Xr(t,e){return void 0===e&&(e={}),W(t,(function(t,n){var r=n.geometry.coordinates;return t+xe(r[0],r[1],e)}),0)}function Zr(t,e,n,r){if(!L(r=r||{}))throw new Error("options is invalid");var i,o=[];if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}for(var a,s,l,c=i.length,u=0,h=0;h<i.length&&!(e>=u&&h===i.length-1);h++){if(u>e&&0===o.length){if(!(a=e-u))return o.push(i[h]),p(o);s=xn(i[h],i[h-1])-180,l=vn(i[h],a,s,r),o.push(l.geometry.coordinates)}if(u>=n)return(a=n-u)?(s=xn(i[h],i[h-1])-180,l=vn(i[h],a,s,r),o.push(l.geometry.coordinates),p(o)):(o.push(i[h]),p(o));if(u>=e&&o.push(i[h]),h===i.length-1)return p(o);u+=xe(i[h],i[h+1],r)}if(u<e&&i.length===c)throw new Error("Start position is beyond line");var d=i[i.length-1];return p([d,d])}function Yr(t,e,n){void 0===n&&(n={});for(var r=K(t),i=Q(e),o=0;o<i.length-1;o++){var a=!1;if(n.ignoreEndVertices&&(0===o&&(a="start"),o===i.length-2&&(a="end"),0===o&&o+1===i.length-1&&(a="both")),$r(i[o],i[o+1],r,a,void 0===n.epsilon?null:n.epsilon))return!0}return!1}function $r(t,e,n,r,i){var o=n[0],a=n[1],s=t[0],l=t[1],c=e[0],u=e[1],h=c-s,p=u-l,d=(n[0]-s)*p-(n[1]-l)*h;if(null!==i){if(Math.abs(d)>i)return!1}else if(0!==d)return!1;return r?"start"===r?Math.abs(h)>=Math.abs(p)?h>0?s<o&&o<=c:c<=o&&o<s:p>0?l<a&&a<=u:u<=a&&a<l:"end"===r?Math.abs(h)>=Math.abs(p)?h>0?s<=o&&o<c:c<o&&o<=s:p>0?l<=a&&a<u:u<a&&a<=l:"both"===r&&(Math.abs(h)>=Math.abs(p)?h>0?s<o&&o<c:c<o&&o<s:p>0?l<a&&a<u:u<a&&a<l):Math.abs(h)>=Math.abs(p)?h>0?s<=o&&o<=c:c<=o&&o<=s:p>0?l<=a&&a<=u:u<=a&&a<=l}function Jr(t,e){var n=it(t),r=it(e),i=n.type,o=r.type;switch(i){case"Point":switch(o){case"MultiPoint":return function(t,e){var n,r=!1;for(n=0;n<e.coordinates.length;n++)if(Qr(e.coordinates[n],t.coordinates)){r=!0;break}return r}(n,r);case"LineString":return Yr(n,r,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return ye(n,r,{ignoreBoundary:!0});default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"MultiPoint":return function(t,e){for(var n=0;n<t.coordinates.length;n++){for(var r=!1,i=0;i<e.coordinates.length;i++)Qr(t.coordinates[n],e.coordinates[i])&&(r=!0);if(!r)return!1}return!0}(n,r);case"LineString":return function(t,e){for(var n=!1,r=0;r<t.coordinates.length;r++){if(!Yr(t.coordinates[r],e))return!1;n||(n=Yr(t.coordinates[r],e,{ignoreEndVertices:!0}))}return n}(n,r);case"Polygon":case"MultiPolygon":return function(t,e){for(var n=!0,r=!1,i=0;i<t.coordinates.length;i++){if(!(r=ye(t.coordinates[1],e))){n=!1;break}r=ye(t.coordinates[1],e,{ignoreBoundary:!0})}return n&&r}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"LineString":return function(t,e){for(var n=0;n<t.coordinates.length;n++)if(!Yr(t.coordinates[n],e))return!1;return!0}(n,r);case"Polygon":case"MultiPolygon":return function(t,e){var n=J(e),r=J(t);if(!Kr(n,r))return!1;for(var i=!1,o=0;o<t.coordinates.length-1;o++){if(!ye(t.coordinates[o],e))return!1;i||(i=ye(t.coordinates[o],e,{ignoreBoundary:!0})),i||(i=ye(ti(t.coordinates[o],t.coordinates[o+1]),e,{ignoreBoundary:!0}))}return i}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Polygon":case"MultiPolygon":return function(t,e){var n=J(t);if(!Kr(J(e),n))return!1;for(var r=0;r<t.coordinates[0].length;r++)if(!ye(t.coordinates[0][r],e))return!1;return!0}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function Kr(t,e){return!(t[0]>e[0])&&!(t[2]<e[2])&&!(t[1]>e[1])&&!(t[3]<e[3])}function Qr(t,e){return t[0]===e[0]&&t[1]===e[1]}function ti(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function ei(t,e,n){void 0===n&&(n={}),n.mask&&!n.units&&(n.units="kilometers");for(var r=[],i=t[0],o=t[1],a=t[2],s=t[3],c=e/xe([i,o],[a,o],n)*(a-i),u=e/xe([i,o],[i,s],n)*(s-o),h=a-i,p=s-o,d=Math.floor(h/c),m=(p-Math.floor(p/u)*u)/2,g=i+(h-d*c)/2;g<=a;){for(var y=o+m;y<=s;){var v=l([g,y],n.properties);n.mask?Jr(v,n.mask)&&r.push(v):r.push(v),y+=u}g+=c}return f(r)}function ni(t,e){void 0===e&&(e={});var n=e.precision,r=e.coordinates,i=e.mutate;if(n=null==n||isNaN(n)?6:n,r=null==r||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if("number"!=typeof n)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");!1!==i&&void 0!==i||(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,n);return O(t,(function(t){!function(t,e,n){t.length>n&&t.splice(n,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*e)/e}(t,o,r)})),t}function ri(t){if(!t)throw new Error("geojson is required");var e=[];return G(t,(function(t){e.push(t)})),f(e)}function ii(t,e,n){if("Polygon"!==t.geometry.type)throw new Error("The input feature must be a Polygon");void 0===n&&(n=1);var r=t.geometry.coordinates,i=[],o={};if(n){for(var a=[],s=0;s<r.length;s++)for(var l=0;l<r[s].length-1;l++)a.push(m(s,l));var c=Tt();c.load(a)}for(var u=0;u<r.length;u++)for(var h=0;h<r[u].length-1;h++)if(n)c.search(m(u,h)).forEach((function(t){var e=t.ring,n=t.edge;f(u,h,e,n)}));else for(var p=0;p<r.length;p++)for(var d=0;d<r[p].length-1;d++)f(u,h,p,d);return e||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i;function f(t,n,a,s){var l,c,u=r[t][n],h=r[t][n+1],p=r[a][s],d=r[a][s+1],f=function(t,e,n,r){if(oi(t,n)||oi(t,r)||oi(e,n)||oi(r,n))return null;var i=t[0],o=t[1],a=e[0],s=e[1],l=n[0],c=n[1],u=r[0],h=r[1],p=(i-a)*(c-h)-(o-s)*(l-u);return 0===p?null:[((i*s-o*a)*(l-u)-(i-a)*(l*h-c*u))/p,((i*s-o*a)*(c-h)-(o-s)*(l*h-c*u))/p]}(u,h,p,d);if(null!==f&&(l=h[0]!==u[0]?(f[0]-u[0])/(h[0]-u[0]):(f[1]-u[1])/(h[1]-u[1]),c=d[0]!==p[0]?(f[0]-p[0])/(d[0]-p[0]):(f[1]-p[1])/(d[1]-p[1]),!(l>=1||l<=0||c>=1||c<=0))){var m=f,g=!o[m];g&&(o[m]=!0),e?i.push(e(f,t,n,u,h,l,a,s,p,d,c,g)):i.push(f)}}function m(t,e){var n,i,o,a,s=r[t][e],l=r[t][e+1];return s[0]<l[0]?(n=s[0],i=l[0]):(n=l[0],i=s[0]),s[1]<l[1]?(o=s[1],a=l[1]):(o=l[1],a=s[1]),{minX:n,minY:o,maxX:i,maxY:a,ring:t,edge:e}}}function oi(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!oi(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}function ai(t){if("Feature"!=t.type)throw new Error("The input must a geojson object of type Feature");if(void 0===t.geometry||null==t.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=t.geometry.type)throw new Error("The input must be a geojson Polygon");for(var e=t.geometry.coordinates.length,n=[],r=0;r<e;r++){var i=t.geometry.coordinates[r];hi(i[0],i[i.length-1])||i.push(i[0]),n.push.apply(n,i.slice(0,i.length-1))}if(!function(t){for(var e={},n=1,r=0,i=t.length;r<i;++r){if(Object.prototype.hasOwnProperty.call(e,t[r])){n=0;break}e[t[r]]=1}return n}(n))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var o=n.length,a=ii(t,(function(t,e,n,r,i,o,a,s,l,c,u,h){return[t,e,n,r,i,o,a,s,l,c,u,h]})),s=a.length;if(0==s){var l=[];for(r=0;r<e;r++)l.push(u([t.geometry.coordinates[r]],{parent:-1,winding:ui(t.geometry.coordinates[r])}));var c=f(l);return z(),B(),c}var h=[],p=[];for(r=0;r<e;r++){h.push([]);for(var d=0;d<t.geometry.coordinates[r].length-1;d++)h[r].push([new si(t.geometry.coordinates[r][pi(d+1,t.geometry.coordinates[r].length-1)],1,[r,d],[r,pi(d+1,t.geometry.coordinates[r].length-1)],void 0)]),p.push(new li(t.geometry.coordinates[r][d],[r,pi(d-1,t.geometry.coordinates[r].length-1)],[r,d],void 0,void 0,!1,!0))}for(r=0;r<s;r++)h[a[r][1]][a[r][2]].push(new si(a[r][0],a[r][5],[a[r][1],a[r][2]],[a[r][6],a[r][7]],void 0)),a[r][11]&&p.push(new li(a[r][0],[a[r][1],a[r][2]],[a[r][6],a[r][7]],void 0,void 0,!0,!0));var m=p.length;for(r=0;r<h.length;r++)for(d=0;d<h[r].length;d++)h[r][d].sort((function(t,e){return t.param<e.param?-1:1}));var g=[];for(r=0;r<m;r++)g.push({minX:p[r].coord[0],minY:p[r].coord[1],maxX:p[r].coord[0],maxY:p[r].coord[1],index:r});var y=Tt();for(y.load(g),r=0;r<h.length;r++)for(d=0;d<h[r].length;d++)for(var v=0;v<h[r][d].length;v++){x=v==h[r][d].length-1?h[r][pi(d+1,t.geometry.coordinates[r].length-1)][0].coord:h[r][d][v+1].coord;var _=y.search({minX:x[0],minY:x[1],maxX:x[0],maxY:x[1]})[0];h[r][d][v].nxtIsectAlongEdgeIn=_.index}for(r=0;r<h.length;r++)for(d=0;d<h[r].length;d++)for(v=0;v<h[r][d].length;v++){var x=h[r][d][v].coord,b=(_=y.search({minX:x[0],minY:x[1],maxX:x[0],maxY:x[1]})[0]).index;b<o?p[b].nxtIsectAlongRingAndEdge2=h[r][d][v].nxtIsectAlongEdgeIn:hi(p[b].ringAndEdge1,h[r][d][v].ringAndEdgeIn)?p[b].nxtIsectAlongRingAndEdge1=h[r][d][v].nxtIsectAlongEdgeIn:p[b].nxtIsectAlongRingAndEdge2=h[r][d][v].nxtIsectAlongEdgeIn}var w=[];for(r=0,d=0;d<e;d++){var M=r;for(v=0;v<t.geometry.coordinates[d].length-1;v++)p[r].coord[0]<p[M].coord[0]&&(M=r),r++;var E=p[M].nxtIsectAlongRingAndEdge2;for(v=0;v<p.length;v++)if(p[v].nxtIsectAlongRingAndEdge1==M||p[v].nxtIsectAlongRingAndEdge2==M){var S=v;break}var T=ci([p[S].coord,p[M].coord,p[E].coord],!0)?1:-1;w.push({isect:M,parent:-1,winding:T})}for(w.sort((function(t,e){return p[t.isect].coord>p[e.isect].coord?-1:1})),l=[];w.length>0;){var A=w.pop(),C=A.isect,L=A.parent,I=A.winding,P=l.length,R=[p[C].coord],O=C;if(p[C].ringAndEdge1Walkable)var D=p[C].ringAndEdge1,N=p[C].nxtIsectAlongRingAndEdge1;else D=p[C].ringAndEdge2,N=p[C].nxtIsectAlongRingAndEdge2;for(;!hi(p[C].coord,p[N].coord);){R.push(p[N].coord);var k=void 0;for(r=0;r<w.length;r++)if(w[r].isect==N){k=r;break}if(null!=k&&w.splice(k,1),hi(D,p[N].ringAndEdge1)){if(D=p[N].ringAndEdge2,p[N].ringAndEdge2Walkable=!1,p[N].ringAndEdge1Walkable){var F={isect:N};ci([p[O].coord,p[N].coord,p[p[N].nxtIsectAlongRingAndEdge2].coord],1==I)?(F.parent=L,F.winding=-I):(F.parent=P,F.winding=I),w.push(F)}O=N,N=p[N].nxtIsectAlongRingAndEdge2}else D=p[N].ringAndEdge1,p[N].ringAndEdge1Walkable=!1,p[N].ringAndEdge2Walkable&&(F={isect:N},ci([p[O].coord,p[N].coord,p[p[N].nxtIsectAlongRingAndEdge1].coord],1==I)?(F.parent=L,F.winding=-I):(F.parent=P,F.winding=I),w.push(F)),O=N,N=p[N].nxtIsectAlongRingAndEdge1}R.push(p[N].coord),l.push(u([R],{index:P,parent:L,winding:I,netWinding:void 0}))}function z(){for(var t=[],e=0;e<c.features.length;e++)-1==c.features[e].properties.parent&&t.push(e);if(t.length>1)for(e=0;e<t.length;e++){for(var n=-1,r=0;r<c.features.length;r++)t[e]!=r&&ye(c.features[t[e]].geometry.coordinates[0][0],c.features[r],{ignoreBoundary:!0})&&Vr(c.features[r])<1/0&&(n=r);c.features[t[e]].properties.parent=n}}function B(){for(var t=0;t<c.features.length;t++)if(-1==c.features[t].properties.parent){var e=c.features[t].properties.winding;c.features[t].properties.netWinding=e,U(t,e)}}function U(t,e){for(var n=0;n<c.features.length;n++)if(c.features[n].properties.parent==t){var r=e+c.features[n].properties.winding;c.features[n].properties.netWinding=r,U(n,r)}}return c=f(l),z(),B(),c}var si=function(t,e,n,r,i){this.coord=t,this.param=e,this.ringAndEdgeIn=n,this.ringAndEdgeOut=r,this.nxtIsectAlongEdgeIn=i},li=function(t,e,n,r,i,o,a){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=n,this.nxtIsectAlongRingAndEdge1=r,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=a};function ci(t,e){if(void 0===e&&(e=!0),3!=t.length)throw new Error("This function requires an array of three points [x,y]");return(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0])>=0==e}function ui(t){for(var e=0,n=0;n<t.length-1;n++)t[n][0]<t[e][0]&&(e=n);if(ci([t[pi(e-1,t.length-1)],t[e],t[pi(e+1,t.length-1)]],!0))var r=1;else r=-1;return r}function hi(t,e){if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!hi(t[n],e[n]))return!1}else if(t[n]!=e[n])return!1;return!0}function pi(t,e){return(t%e+e)%e}var di=Math.PI/180,fi=180/Math.PI,mi=function(t,e){this.lon=t,this.lat=e,this.x=di*t,this.y=di*e};mi.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},mi.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new mi(e,t)};var gi=function(){this.coords=[],this.length=0};gi.prototype.move_to=function(t){this.length++,this.coords.push(t)};var yi=function(t){this.properties=t||{},this.geometries=[]};yi.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},yi.prototype.wkt=function(){for(var t="",e="LINESTRING(",n=function(t){e+=t[0]+" "+t[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),t+=e.substring(0,e.length-1)+")"}return t};var vi=function(t,e,n){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new mi(t.x,t.y),this.end=new mi(e.x,e.y),this.properties=n||{};var r=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};function _i(t,e){var n=[],r=Ir();return G(e,(function(e){if(n.forEach((function(t,e){t.id=e})),n.length){var i=r.search(e);if(i.features.length){var o=bi(e,i);n=n.filter((function(t){return t.id!==o.id})),r.remove(o),F(xi(o,e),(function(t){n.push(t),r.insert(t)}))}}else(n=xi(t,e).features).forEach((function(t){t.bbox||(t.bbox=yn(J(t)))})),r.load(f(n))})),f(n)}function xi(t,e){var n=[],r=Q(t)[0],i=Q(t)[t.geometry.coordinates.length-1];if(wi(r,K(e))||wi(i,K(e)))return f([t]);var o=Ir(),a=Jn(t);o.load(a);var s=o.search(e);if(!s.features.length)return f([t]);var l=bi(e,s),c=z(a,(function(t,r,i){var o=Q(r)[1],a=K(e);return i===l.id?(t.push(a),n.push(p(t)),wi(a,o)?[a]:[a,o]):(t.push(o),t)}),[r]);return c.length>1&&n.push(p(c)),f(n)}function bi(t,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var n,r=1/0;return F(e,(function(e){var i=Dr(e,t).properties.dist;i<r&&(n=e,r=i)})),n}function wi(t,e){return t[0]===e[0]&&t[1]===e[1]}function Mi(t,e,n,r,i){void 0===i&&(i={});var o=i.steps||64,a=Ei(n),s=Ei(r),l=Array.isArray(t)||"Feature"!==t.type?{}:t.properties;if(a===s)return p(_n(t,e,i).geometry.coordinates[0],l);for(var c=a,u=a<s?s:s+360,h=c,d=[],f=0;h<u;)d.push(vn(t,e,h,i).geometry.coordinates),h=c+360*++f/o;return h>u&&d.push(vn(t,e,u,i).geometry.coordinates),p(d,l)}function Ei(t){var e=t%360;return e<0&&(e+=360),e}function Si(t,e){void 0===e&&(e={});var n=it(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),n.type){case"Polygon":return Ti(n,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var n=it(t).coordinates,r=e.properties?e.properties:"Feature"===t.type?t.properties:{},i=[];return n.forEach((function(t){i.push(Ai(t,r))})),f(i)}(n,e);default:throw new Error("invalid poly")}}function Ti(t,e){return void 0===e&&(e={}),Ai(it(t).coordinates,e.properties?e.properties:"Feature"===t.type?t.properties:{})}function Ai(t,e){return t.length>1?m(t,e):p(t[0],e)}function Ci(t,e){var n,r,i;void 0===e&&(e={});var o=e.properties,a=null===(n=e.autoComplete)||void 0===n||n,s=null===(r=e.orderCoords)||void 0===r||r;switch(null!==(i=e.mutate)&&void 0!==i&&i||(t=Se(t)),t.type){case"FeatureCollection":var l=[];return t.features.forEach((function(t){l.push(Q(Li(t,{},a,s)))})),y(l,o);default:return Li(t,o,a,s)}}function Li(t,e,n,r){e=e||("Feature"===t.type?t.properties:{});var i=it(t),o=i.coordinates,a=i.type;if(!o.length)throw new Error("line must contain coordinates");switch(a){case"LineString":return n&&(o=Ii(o)),u([o],e);case"MultiLineString":var s=[],l=0;return o.forEach((function(t){if(n&&(t=Ii(t)),r){var e=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.abs(e-r)*Math.abs(n-i)}(J(p(t)));e>l?(s.unshift(t),l=e):s.push(t)}else s.push(t)})),u(s,e);default:throw new Error("geometry type "+a+" is not supported")}}function Ii(t){var e=t[0],n=e[0],r=e[1],i=t[t.length-1],o=i[0],a=i[1];return n===o&&r===a||t.push(e),t}function Pi(t,e){var n,r,i,o,a,s,l;for(r=1;r<=8;r*=2){for(n=[],o=!(Oi(i=t[t.length-1],e)&r),a=0;a<t.length;a++)(l=!(Oi(s=t[a],e)&r))!==o&&n.push(Ri(i,s,r,e)),l&&n.push(s),i=s,o=l;if(!(t=n).length)break}return n}function Ri(t,e,n,r){return 8&n?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:4&n?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:2&n?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:1&n?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function Oi(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function Di(t,e){for(var n=[],r=0,i=t;r<i.length;r++){var o=Pi(i[r],e);o.length>0&&(o[0][0]===o[o.length-1][0]&&o[0][1]===o[o.length-1][1]||o.push(o[0]),o.length>=4&&n.push(o))}return n}vi.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),n=Math.sin(t*this.g)/Math.sin(this.g),r=e*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+n*Math.sin(this.end.y),a=fi*Math.atan2(o,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[fi*Math.atan2(i,r),a]},vi.prototype.Arc=function(t,e){var n=[];if(!t||t<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(t-1),i=0;i<t;++i){var o=r*i,a=this.interpolate(o);n.push(a)}for(var s=!1,l=0,c=e&&e.offset?e.offset:10,u=180-c,h=-180+c,p=360-c,d=1;d<n.length;++d){var f=n[d-1][0],m=n[d][0],g=Math.abs(m-f);g>p&&(m>u&&f<h||f>u&&m<h)?s=!0:g>l&&(l=g)}var y=[];if(s&&l<c){var v=[];y.push(v);for(var _=0;_<n.length;++_){var x=parseFloat(n[_][0]);if(_>0&&Math.abs(x-n[_-1][0])>p){var b=parseFloat(n[_-1][0]),w=parseFloat(n[_-1][1]),M=parseFloat(n[_][0]),E=parseFloat(n[_][1]);if(b>-180&&b<h&&180===M&&_+1<n.length&&n[_-1][0]>-180&&n[_-1][0]<h){v.push([-180,n[_][1]]),_++,v.push([n[_][0],n[_][1]]);continue}if(b>u&&b<180&&-180===M&&_+1<n.length&&n[_-1][0]>u&&n[_-1][0]<180){v.push([180,n[_][1]]),_++,v.push([n[_][0],n[_][1]]);continue}if(b<h&&M>u){var S=b;b=M,M=S;var T=w;w=E,E=T}if(b>u&&M<h&&(M+=360),b<=180&&M>=180&&b<M){var A=(180-b)/(M-b),C=A*E+(1-A)*w;v.push([n[_-1][0]>u?180:-180,C]),(v=[]).push([n[_-1][0]>u?-180:180,C]),y.push(v)}else v=[],y.push(v);v.push([x,n[_][1]])}else v.push([n[_][0],n[_][1]])}}else{var L=[];y.push(L);for(var I=0;I<n.length;++I)L.push([n[I][0],n[I][1]])}for(var P=new yi(this.properties),R=0;R<y.length;++R){var O=new gi;P.geometries.push(O);for(var D=y[R],N=0;N<D.length;++N)O.move_to(D[N])}return P};var Ni=jt((function(t,e){function n(t){var e=[];for(var n in t)e.push(n);return e}(t.exports="function"==typeof Object.keys?Object.keys:n).shim=n})),ki=jt((function(t,e){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function i(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}(e=t.exports=n?r:i).supported=r,e.unsupported=i})),Fi=jt((function(t){var e=Array.prototype.slice,n=t.exports=function(t,o,a){return a||(a={}),t===o||(t instanceof Date&&o instanceof Date?t.getTime()===o.getTime():!t||!o||"object"!=typeof t&&"object"!=typeof o?a.strict?t===o:t==o:function(t,o,a){var s,l;if(r(t)||r(o))return!1;if(t.prototype!==o.prototype)return!1;if(ki(t))return!!ki(o)&&(t=e.call(t),o=e.call(o),n(t,o,a));if(i(t)){if(!i(o))return!1;if(t.length!==o.length)return!1;for(s=0;s<t.length;s++)if(t[s]!==o[s])return!1;return!0}try{var c=Ni(t),u=Ni(o)}catch(t){return!1}if(c.length!=u.length)return!1;for(c.sort(),u.sort(),s=c.length-1;s>=0;s--)if(c[s]!=u[s])return!1;for(s=c.length-1;s>=0;s--)if(l=c[s],!n(t[l],o[l],a))return!1;return typeof t==typeof o}(t,o,a))};function r(t){return null==t}function i(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&"function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0])}}));function zi(t,e,n){if(void 0===n&&(n={}),!L(n=n||{}))throw new Error("options is invalid");var r,i=n.tolerance||0,o=[],a=Ir(),s=Jn(t);return a.load(s),H(e,(function(t){var e=!1;t&&(F(a.search(t),(function(n){if(!1===e){var o=Q(t).sort(),a=Q(n).sort();Fi(o,a)||(0===i?Yr(o[0],n)&&Yr(o[1],n):Dr(n,o[0]).properties.dist<=i&&Dr(n,o[1]).properties.dist<=i)?(e=!0,r=r?Bi(r,t):t):(0===i?Yr(a[0],t)&&Yr(a[1],t):Dr(t,a[0]).properties.dist<=i&&Dr(t,a[1]).properties.dist<=i)&&(r=r?Bi(r,n):n)}})),!1===e&&r&&(o.push(r),r=void 0))})),r&&o.push(r),f(o)}function Bi(t,e){var n=Q(e),r=Q(t),i=r[0],o=r[r.length-1],a=t.geometry.coordinates;return Fi(n[0],i)?a.unshift(n[1]):Fi(n[0],o)?a.push(n[1]):Fi(n[1],i)?a.unshift(n[0]):Fi(n[1],o)&&a.push(n[0]),t}function Ui(t){var e=t%360;return e<0&&(e+=360),e}function ji(t,e,n){var r;return void 0===n&&(n={}),(r=n.final?Gi(K(e),K(t)):Gi(K(t),K(e)))>180?-(360-r):r}function Gi(t,e){var n=S(t[1]),r=S(e[1]),i=S(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(E(Math.atan2(i,o))+360)%360}function Vi(t,e,r,i){void 0===i&&(i={});var o=e<0,a=T(Math.abs(e),i.units,"meters");o&&(a=-Math.abs(a));var s=K(t),c=function(t,e,r,i){i=void 0===i?n:Number(i);var o=e/i,a=t[0]*Math.PI/180,s=S(t[1]),l=S(r),c=o*Math.cos(l),u=s+c;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var h=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),p=Math.abs(h)>1e-11?c/h:Math.cos(s),d=o*Math.sin(l)/p;return[(180*(a+d)/Math.PI+540)%360-180,180*u/Math.PI]}(s,a,r);return c[0]+=c[0]-s[0]>180?-360:s[0]-c[0]>180?360:0,l(c,i.properties)}function Hi(t,e,n,r,i,o){for(var a=0;a<t.length;a++){var s=t[a],l=t[a+1];a===t.length-1&&(l=t[0]),r=qi(s,l,e),n<=0&&r>0?qi(e,s,i)<0||(i=s):n>0&&r<=0&&(Wi(e,s,o)||(o=s)),n=r}return[i,o]}function Wi(t,e,n){return qi(t,e,n)>0}function qi(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])}function Xi(t){for(var e,n,r=Q(t),i=0,o=1;o<r.length;)e=n||r[0],i+=((n=r[o])[0]-e[0])*(n[1]+e[1]),o++;return i>0}function Zi(t,e){switch("Feature"===t.type?t.geometry.type:t.type){case"GeometryCollection":return U(t,(function(t){Zi(t,e)})),t;case"LineString":return Yi(Q(t),e),t;case"Polygon":return $i(Q(t),e),t;case"MultiLineString":return Q(t).forEach((function(t){Yi(t,e)})),t;case"MultiPolygon":return Q(t).forEach((function(t){$i(t,e)})),t;case"Point":case"MultiPoint":return t}}function Yi(t,e){Xi(t)===e&&t.reverse()}function $i(t,e){Xi(t[0])!==e&&t[0].reverse();for(var n=1;n<t.length;n++)Xi(t[n])===e&&t[n].reverse()}function Ji(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n=e.zProperty||"elevation",r=e.flip,i=e.flags;rt(t,"Point","input must contain Points");for(var o=function(t,e){var n={};return F(t,(function(t){var e=Q(t)[1];n[e]||(n[e]=[]),n[e].push(t)})),Object.keys(n).map((function(t){return n[t].sort((function(t,e){return Q(t)[0]-Q(e)[0]}))})).sort((function(t,n){return e?Q(t[0])[1]-Q(n[0])[1]:Q(n[0])[1]-Q(t[0])[1]}))}
/*!
     * @license GNU Affero General Public License.
     * Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
     * v. 1.2.0
     * https://github.com/RaumZeit/MarchingSquares.js
     *
     * MarchingSquaresJS is free software: you can redistribute it and/or modify
     * it under the terms of the GNU Affero General Public License as published by
     * the Free Software Foundation, either version 3 of the License, or
     * (at your option) any later version.
     *
     * MarchingSquaresJS is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
     * GNU Affero General Public License for more details.
     *
     * As additional permission under GNU Affero General Public License version 3
     * section 7, third-party projects (personal or commercial) may distribute,
     * include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
     * requirement that said third-party project for that reason alone becomes
     * subject to any requirement of the GNU Affero General Public License version 3.
     * Any modifications to MarchingSquaresJS, however, must be shared with the public
     * and made available.
     *
     * In summary this:
     * - allows you to use MarchingSquaresJS at no cost
     * - allows you to use MarchingSquaresJS for both personal and commercial purposes
     * - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
     *   license as long as this license notice is included
     * - enables you to keep the source code of your program that uses MarchingSquaresJS
     *   undisclosed
     * - forces you to share any modifications you have made to MarchingSquaresJS,
     *   e.g. bug-fixes
     *
     * You should have received a copy of the GNU Affero General Public License
     * along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
     */(t,r),a=[],s=0;s<o.length;s++){for(var l=o[s],c=[],u=0;u<l.length;u++){var h=l[u];h.properties[n]?c.push(h.properties[n]):c.push(0),!0===i&&(h.properties.matrixPosition=[s,u])}a.push(c)}return a}var Ki={successCallback:null,verbose:!1,polygons:!1},Qi={};function to(t,e,n,r){r=r||{};for(var i=Object.keys(Ki),o=0;o<i.length;o++){var a=i[o],s=r[a];s=null!=s?s:Ki[a],Qi[a]=s}Qi.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+e+":"+(e+n)+"]");var l,c=function(t,e,n){for(var r=t.length-1,i=t[0].length-1,o={rows:r,cols:i,cells:[]},a=e+Math.abs(n),s=0;s<r;++s){o.cells[s]=[];for(var l=0;l<i;++l){var c=0,u=t[s+1][l],h=t[s+1][l+1],p=t[s][l+1],d=t[s][l];if(!(isNaN(u)||isNaN(h)||isNaN(p)||isNaN(d))){c|=u<e?0:u>a?128:64,c|=h<e?0:h>a?32:16,c|=p<e?0:p>a?8:4;var f=+(c|=d<e?0:d>a?2:1),m=0;if(17===c||18===c||33===c||34===c||38===c||68===c||72===c||98===c||102===c||132===c||136===c||137===c||152===c||153===c){var g=(u+h+p+d)/4;m=g>a?2:g<e?0:1,34===c?1===m?c=35:0===m&&(c=136):136===c?1===m?(c=35,m=4):0===m&&(c=34):17===c?1===m?(c=155,m=4):0===m&&(c=153):68===c?1===m?(c=103,m=4):0===m&&(c=102):153===c?1===m&&(c=155):102===c?1===m&&(c=103):152===c?m<2&&(c=156,m=1):137===c?m<2&&(c=139,m=1):98===c?m<2&&(c=99,m=1):38===c?m<2&&(c=39,m=1):18===c?m>0?(c=156,m=4):c=152:33===c?m>0?(c=139,m=4):c=137:72===c?m>0?(c=99,m=4):c=98:132===c&&(m>0?(c=39,m=4):c=38)}if(0!=c&&170!=c){var y,v,_,x,b,w,M,E;y=v=_=x=b=w=M=E=.5;var S=[];1===c?(_=1-Wo(e,p,d),E=1-Wo(e,u,d),S.push(Bo[c])):169===c?(_=Wo(a,d,p),E=Wo(a,d,u),S.push(Bo[c])):4===c?(w=1-Wo(e,h,p),x=Wo(e,d,p),S.push(Fo[c])):166===c?(w=Wo(a,p,h),x=1-Wo(a,p,d),S.push(Fo[c])):16===c?(b=Wo(e,p,h),v=Wo(e,u,h),S.push(ko[c])):154===c?(b=1-Wo(a,h,p),v=1-Wo(a,h,u),S.push(ko[c])):64===c?(M=Wo(e,d,u),y=1-Wo(e,h,u),S.push(jo[c])):106===c?(M=1-Wo(a,u,d),y=Wo(a,u,h),S.push(jo[c])):168===c?(x=Wo(a,d,p),_=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),S.push(zo[c]),S.push(Bo[c])):2===c?(x=1-Wo(e,p,d),_=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),S.push(zo[c]),S.push(Bo[c])):162===c?(b=Wo(a,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),S.push(zo[c]),S.push(Bo[c])):8===c?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),S.push(ko[c]),S.push(Fo[c])):138===c?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),y=1-Wo(a,h,u),v=1-Wo(e,h,u),S.push(ko[c]),S.push(Fo[c])):32===c?(b=Wo(a,p,h),w=Wo(e,p,h),y=Wo(e,u,h),v=Wo(a,u,h),S.push(ko[c]),S.push(Fo[c])):42===c?(E=1-Wo(a,u,d),M=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h),S.push(Uo[c]),S.push(jo[c])):128===c&&(E=Wo(e,d,u),M=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u),S.push(Uo[c]),S.push(jo[c])),5===c?(w=1-Wo(e,h,p),E=1-Wo(e,u,d),S.push(Fo[c])):165===c?(w=Wo(a,p,h),E=Wo(a,d,u),S.push(Fo[c])):20===c?(x=Wo(e,d,p),v=Wo(e,u,h),S.push(zo[c])):150===c?(x=1-Wo(a,p,d),v=1-Wo(a,h,u),S.push(zo[c])):80===c?(b=Wo(e,p,h),M=Wo(e,d,u),S.push(ko[c])):90===c?(b=1-Wo(a,h,p),M=1-Wo(a,u,d),S.push(ko[c])):65===c?(_=1-Wo(e,p,d),y=1-Wo(e,h,u),S.push(Bo[c])):105===c?(_=Wo(a,d,p),y=Wo(a,u,h),S.push(Bo[c])):160===c?(b=Wo(a,p,h),w=Wo(e,p,h),E=Wo(e,d,u),M=Wo(a,d,u),S.push(ko[c]),S.push(Fo[c])):10===c?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),E=1-Wo(a,u,d),M=1-Wo(e,u,d),S.push(ko[c]),S.push(Fo[c])):130===c?(x=1-Wo(e,p,d),_=1-Wo(a,p,d),y=1-Wo(a,h,u),v=1-Wo(e,h,u),S.push(zo[c]),S.push(Bo[c])):40===c?(x=Wo(a,d,p),_=Wo(e,d,p),y=Wo(e,u,h),v=Wo(a,u,h),S.push(zo[c]),S.push(Bo[c])):101===c?(w=Wo(a,p,h),y=Wo(a,u,h),S.push(Fo[c])):69===c?(w=1-Wo(e,h,p),y=1-Wo(e,h,u),S.push(Fo[c])):149===c?(E=Wo(a,d,u),v=1-Wo(a,h,u),S.push(Uo[c])):21===c?(E=1-Wo(e,u,d),v=Wo(e,u,h),S.push(Uo[c])):86===c?(x=1-Wo(a,p,d),M=1-Wo(a,u,d),S.push(zo[c])):84===c?(x=Wo(e,d,p),M=Wo(e,d,u),S.push(zo[c])):89===c?(b=1-Wo(a,h,p),_=Wo(a,d,p),S.push(Bo[c])):81===c?(b=Wo(e,p,h),_=1-Wo(e,p,d),S.push(Bo[c])):96===c?(b=Wo(a,p,h),w=Wo(e,p,h),M=Wo(e,d,u),y=Wo(a,u,h),S.push(ko[c]),S.push(Fo[c])):74===c?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),M=1-Wo(a,u,d),y=1-Wo(e,h,u),S.push(ko[c]),S.push(Fo[c])):24===c?(b=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),v=Wo(e,u,h),S.push(ko[c]),S.push(Bo[c])):146===c?(b=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),v=1-Wo(a,h,u),S.push(ko[c]),S.push(Bo[c])):6===c?(w=1-Wo(e,h,p),x=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),S.push(Fo[c]),S.push(zo[c])):164===c?(w=Wo(a,p,h),x=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),S.push(Fo[c]),S.push(zo[c])):129===c?(_=1-Wo(e,p,d),E=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u),S.push(Bo[c]),S.push(Uo[c])):41===c?(_=Wo(a,d,p),E=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h),S.push(Bo[c]),S.push(Uo[c])):66===c?(x=1-Wo(e,p,d),_=1-Wo(a,p,d),M=1-Wo(a,u,d),y=1-Wo(e,h,u),S.push(zo[c]),S.push(Bo[c])):104===c?(x=Wo(a,d,p),_=Wo(e,d,p),M=Wo(e,d,u),y=Wo(a,u,h),S.push(Bo[c]),S.push(Go[c])):144===c?(b=Wo(e,p,h),E=Wo(e,d,u),M=Wo(a,d,u),v=1-Wo(a,h,u),S.push(ko[c]),S.push(jo[c])):26===c?(b=1-Wo(a,h,p),E=1-Wo(a,u,d),M=1-Wo(e,u,d),v=Wo(e,u,h),S.push(ko[c]),S.push(jo[c])):36===c?(w=Wo(a,p,h),x=Wo(e,d,p),y=Wo(e,u,h),v=Wo(a,u,h),S.push(Fo[c]),S.push(zo[c])):134===c?(w=1-Wo(e,h,p),x=1-Wo(a,p,d),y=1-Wo(a,h,u),v=1-Wo(e,h,u),S.push(Fo[c]),S.push(zo[c])):9===c?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),_=Wo(a,d,p),E=1-Wo(e,u,d),S.push(ko[c]),S.push(Fo[c])):161===c?(b=Wo(a,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),E=Wo(a,d,u),S.push(ko[c]),S.push(Fo[c])):37===c?(w=Wo(a,p,h),E=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h),S.push(Fo[c]),S.push(Uo[c])):133===c?(w=1-Wo(e,h,p),E=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u),S.push(Fo[c]),S.push(Uo[c])):148===c?(x=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),v=1-Wo(a,h,u),S.push(zo[c]),S.push(jo[c])):22===c?(x=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),v=Wo(e,u,h),S.push(zo[c]),S.push(jo[c])):82===c?(b=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),M=1-Wo(a,u,d),S.push(ko[c]),S.push(Bo[c])):88===c?(b=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),M=Wo(e,d,u),S.push(ko[c]),S.push(Bo[c])):73===c?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),_=Wo(a,d,p),y=1-Wo(e,h,u),S.push(ko[c]),S.push(Fo[c])):97===c?(b=Wo(a,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),y=Wo(a,u,h),S.push(ko[c]),S.push(Fo[c])):145===c?(b=Wo(e,p,h),_=1-Wo(e,p,d),E=Wo(a,d,u),v=1-Wo(a,h,u),S.push(ko[c]),S.push(Uo[c])):25===c?(b=1-Wo(a,h,p),_=Wo(a,d,p),E=1-Wo(e,u,d),v=Wo(e,u,h),S.push(ko[c]),S.push(Uo[c])):70===c?(w=1-Wo(e,h,p),x=1-Wo(a,p,d),M=1-Wo(a,u,d),y=1-Wo(e,h,u),S.push(Fo[c]),S.push(zo[c])):100===c?(w=Wo(a,p,h),x=Wo(e,d,p),M=Wo(e,d,u),y=Wo(a,u,h),S.push(Fo[c]),S.push(zo[c])):34===c?(0===m?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u)):(b=Wo(a,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h)),S.push(ko[c]),S.push(Fo[c]),S.push(Uo[c]),S.push(jo[c])):35===c?(4===m?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u)):(b=Wo(a,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h)),S.push(ko[c]),S.push(Fo[c]),S.push(Bo[c]),S.push(jo[c])):136===c?(0===m?(b=Wo(a,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h)):(b=1-Wo(e,h,p),w=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u)),S.push(ko[c]),S.push(Fo[c]),S.push(Uo[c]),S.push(jo[c])):153===c?(0===m?(b=Wo(e,p,h),_=1-Wo(e,p,d),E=1-Wo(e,u,d),v=Wo(e,u,h)):(b=1-Wo(a,h,p),_=Wo(a,d,p),E=Wo(a,d,u),v=1-Wo(a,h,u)),S.push(ko[c]),S.push(Bo[c])):102===c?(0===m?(w=1-Wo(e,h,p),x=Wo(e,d,p),M=Wo(e,d,u),y=1-Wo(e,h,u)):(w=Wo(a,p,h),x=1-Wo(a,p,d),M=1-Wo(a,u,d),y=Wo(a,u,h)),S.push(Fo[c]),S.push(jo[c])):155===c?(4===m?(b=Wo(e,p,h),_=1-Wo(e,p,d),E=1-Wo(e,u,d),v=Wo(e,u,h)):(b=1-Wo(a,h,p),_=Wo(a,d,p),E=Wo(a,d,u),v=1-Wo(a,h,u)),S.push(ko[c]),S.push(Uo[c])):103===c?(4===m?(w=1-Wo(e,h,p),x=Wo(e,d,p),M=Wo(e,d,u),y=1-Wo(e,h,u)):(w=Wo(a,p,h),x=1-Wo(a,p,d),M=1-Wo(a,u,d),y=Wo(a,u,h)),S.push(Fo[c]),S.push(zo[c])):152===c?(0===m?(b=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),v=Wo(e,u,h)):(b=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),v=1-Wo(a,h,u)),S.push(ko[c]),S.push(zo[c]),S.push(Bo[c])):156===c?(4===m?(b=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),v=Wo(e,u,h)):(b=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),v=1-Wo(a,h,u)),S.push(ko[c]),S.push(Bo[c]),S.push(jo[c])):137===c?(0===m?(b=Wo(a,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),E=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h)):(b=1-Wo(e,h,p),w=1-Wo(a,h,p),_=Wo(a,d,p),E=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u)),S.push(ko[c]),S.push(Fo[c]),S.push(Bo[c])):139===c?(4===m?(b=Wo(a,p,h),w=Wo(e,p,h),_=1-Wo(e,p,d),E=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h)):(b=1-Wo(e,h,p),w=1-Wo(a,h,p),_=Wo(a,d,p),E=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u)),S.push(ko[c]),S.push(Fo[c]),S.push(Uo[c])):98===c?(0===m?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),M=Wo(e,d,u),y=1-Wo(e,h,u)):(b=Wo(a,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),M=1-Wo(a,u,d),y=Wo(a,u,h)),S.push(ko[c]),S.push(Fo[c]),S.push(jo[c])):99===c?(4===m?(b=1-Wo(e,h,p),w=1-Wo(a,h,p),x=Wo(a,d,p),_=Wo(e,d,p),M=Wo(e,d,u),y=1-Wo(e,h,u)):(b=Wo(a,p,h),w=Wo(e,p,h),x=1-Wo(e,p,d),_=1-Wo(a,p,d),M=1-Wo(a,u,d),y=Wo(a,u,h)),S.push(ko[c]),S.push(Fo[c]),S.push(Bo[c])):38===c?(0===m?(w=1-Wo(e,h,p),x=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u)):(w=Wo(a,p,h),x=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h)),S.push(Fo[c]),S.push(Uo[c]),S.push(jo[c])):39===c?(4===m?(w=1-Wo(e,h,p),x=Wo(e,d,p),E=Wo(e,d,u),M=Wo(a,d,u),y=1-Wo(a,h,u),v=1-Wo(e,h,u)):(w=Wo(a,p,h),x=1-Wo(a,p,d),E=1-Wo(a,u,d),M=1-Wo(e,u,d),y=Wo(e,u,h),v=Wo(a,u,h)),S.push(Fo[c]),S.push(zo[c]),S.push(jo[c])):85===c&&(b=1,w=0,x=1,_=0,E=0,M=1,y=0,v=1),(y<0||y>1||v<0||v>1||b<0||b>1||x<0||x>1||E<0||E>1||M<0||M>1)&&console.log("MarchingSquaresJS-isoBands: "+c+" "+f+" "+u+","+h+","+p+","+d+" "+m+" "+y+" "+v+" "+b+" "+w+" "+x+" "+_+" "+E+" "+M),o.cells[s][l]={cval:c,cval_real:f,flipped:m,topleft:y,topright:v,righttop:b,rightbottom:w,bottomright:x,bottomleft:_,leftbottom:E,lefttop:M,edges:S}}}}}return o}(t,e,n);return Qi.polygons?(Qi.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),l=function(t){var e=[],n=0;return t.cells.forEach((function(t,r){t.forEach((function(t,i){if(void 0!==t){var o=Ho[t.cval](t);"object"==typeof o&&qo(o)?"object"==typeof o[0]&&qo(o[0])?"object"==typeof o[0][0]&&qo(o[0][0])?o.forEach((function(t){t.forEach((function(t){t[0]+=i,t[1]+=r})),e[n++]=t})):(o.forEach((function(t){t[0]+=i,t[1]+=r})),e[n++]=o):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}}))})),e}(c)):(Qi.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),l=function(t){for(var e=[],n=t.rows,r=t.cols,i=[],o=0;o<n;o++)for(var a=0;a<r;a++)if(void 0!==t.cells[o][a]&&t.cells[o][a].edges.length>0){var s=Zo(t.cells[o][a]),l=null,c=a,u=o;null!==s&&i.push([s.p[0]+c,s.p[1]+u]);do{if(null===(l=Yo(t.cells[u][c],s.x,s.y,s.o)))break;if(i.push([l.p[0]+c,l.p[1]+u]),c+=l.x,s=l,(u+=l.y)<0||u>=n||c<0||c>=r||void 0===t.cells[u][c]){var h=Xo(t,c-=l.x,u-=l.y,l.x,l.y,l.o);if(null===h)break;h.path.forEach((function(t){i.push(t)})),c=h.i,u=h.j,s=h}}while(void 0!==t.cells[u][c]&&t.cells[u][c].edges.length>0);e.push(i),i=[],t.cells[o][a].edges.length>0&&a--}return e}(c)),"function"==typeof Qi.successCallback&&Qi.successCallback(l),l}var eo=64,no=16,ro=[],io=[],oo=[],ao=[],so=[],lo=[],co=[],uo=[],ho=[],po=[],fo=[],mo=[],go=[],yo=[],vo=[],_o=[],xo=[],bo=[],wo=[],Mo=[],Eo=[],So=[],To=[],Ao=[];co[85]=po[85]=-1,uo[85]=fo[85]=0,ho[85]=mo[85]=1,wo[85]=So[85]=1,Mo[85]=To[85]=0,Eo[85]=Ao[85]=1,ro[85]=ao[85]=0,io[85]=so[85]=-1,oo[85]=vo[85]=0,_o[85]=go[85]=0,xo[85]=yo[85]=1,lo[85]=bo[85]=1,So[1]=So[169]=0,To[1]=To[169]=-1,Ao[1]=Ao[169]=0,go[1]=go[169]=-1,yo[1]=yo[169]=0,vo[1]=vo[169]=0,po[4]=po[166]=0,fo[4]=fo[166]=-1,mo[4]=mo[166]=1,_o[4]=_o[166]=1,xo[4]=xo[166]=0,bo[4]=bo[166]=0,co[16]=co[154]=0,uo[16]=uo[154]=1,ho[16]=ho[154]=1,ao[16]=ao[154]=1,so[16]=so[154]=0,lo[16]=lo[154]=1,wo[64]=wo[106]=0,Mo[64]=Mo[106]=1,Eo[64]=Eo[106]=0,ro[64]=ro[106]=-1,io[64]=io[106]=0,oo[64]=oo[106]=1,wo[2]=wo[168]=0,Mo[2]=Mo[168]=-1,Eo[2]=Eo[168]=1,So[2]=So[168]=0,To[2]=To[168]=-1,Ao[2]=Ao[168]=0,go[2]=go[168]=-1,yo[2]=yo[168]=0,vo[2]=vo[168]=0,_o[2]=_o[168]=-1,xo[2]=xo[168]=0,bo[2]=bo[168]=1,co[8]=co[162]=0,uo[8]=uo[162]=-1,ho[8]=ho[162]=0,po[8]=po[162]=0,fo[8]=fo[162]=-1,mo[8]=mo[162]=1,go[8]=go[162]=1,yo[8]=yo[162]=0,vo[8]=vo[162]=1,_o[8]=_o[162]=1,xo[8]=xo[162]=0,bo[8]=bo[162]=0,co[32]=co[138]=0,uo[32]=uo[138]=1,ho[32]=ho[138]=1,po[32]=po[138]=0,fo[32]=fo[138]=1,mo[32]=mo[138]=0,ro[32]=ro[138]=1,io[32]=io[138]=0,oo[32]=oo[138]=0,ao[32]=ao[138]=1,so[32]=so[138]=0,lo[32]=lo[138]=1,So[128]=So[42]=0,To[128]=To[42]=1,Ao[128]=Ao[42]=1,wo[128]=wo[42]=0,Mo[128]=Mo[42]=1,Eo[128]=Eo[42]=0,ro[128]=ro[42]=-1,io[128]=io[42]=0,oo[128]=oo[42]=1,ao[128]=ao[42]=-1,so[128]=so[42]=0,lo[128]=lo[42]=0,po[5]=po[165]=-1,fo[5]=fo[165]=0,mo[5]=mo[165]=0,So[5]=So[165]=1,To[5]=To[165]=0,Ao[5]=Ao[165]=0,_o[20]=_o[150]=0,xo[20]=xo[150]=1,bo[20]=bo[150]=1,ao[20]=ao[150]=0,so[20]=so[150]=-1,lo[20]=lo[150]=1,co[80]=co[90]=-1,uo[80]=uo[90]=0,ho[80]=ho[90]=1,wo[80]=wo[90]=1,Mo[80]=Mo[90]=0,Eo[80]=Eo[90]=1,go[65]=go[105]=0,yo[65]=yo[105]=1,vo[65]=vo[105]=0,ro[65]=ro[105]=0,io[65]=io[105]=-1,oo[65]=oo[105]=0,co[160]=co[10]=-1,uo[160]=uo[10]=0,ho[160]=ho[10]=1,po[160]=po[10]=-1,fo[160]=fo[10]=0,mo[160]=mo[10]=0,So[160]=So[10]=1,To[160]=To[10]=0,Ao[160]=Ao[10]=0,wo[160]=wo[10]=1,Mo[160]=Mo[10]=0,Eo[160]=Eo[10]=1,_o[130]=_o[40]=0,xo[130]=xo[40]=1,bo[130]=bo[40]=1,go[130]=go[40]=0,yo[130]=yo[40]=1,vo[130]=vo[40]=0,ro[130]=ro[40]=0,io[130]=io[40]=-1,oo[130]=oo[40]=0,ao[130]=ao[40]=0,so[130]=so[40]=-1,lo[130]=lo[40]=1,po[37]=po[133]=0,fo[37]=fo[133]=1,mo[37]=mo[133]=1,So[37]=So[133]=0,To[37]=To[133]=1,Ao[37]=Ao[133]=0,ro[37]=ro[133]=-1,io[37]=io[133]=0,oo[37]=oo[133]=0,ao[37]=ao[133]=1,so[37]=so[133]=0,lo[37]=lo[133]=0,_o[148]=_o[22]=-1,xo[148]=xo[22]=0,bo[148]=bo[22]=0,So[148]=So[22]=0,To[148]=To[22]=-1,Ao[148]=Ao[22]=1,wo[148]=wo[22]=0,Mo[148]=Mo[22]=1,Eo[148]=Eo[22]=1,ao[148]=ao[22]=-1,so[148]=so[22]=0,lo[148]=lo[22]=1,co[82]=co[88]=0,uo[82]=uo[88]=-1,ho[82]=ho[88]=1,_o[82]=_o[88]=1,xo[82]=xo[88]=0,bo[82]=bo[88]=1,go[82]=go[88]=-1,yo[82]=yo[88]=0,vo[82]=vo[88]=1,wo[82]=wo[88]=0,Mo[82]=Mo[88]=-1,Eo[82]=Eo[88]=0,co[73]=co[97]=0,uo[73]=uo[97]=1,ho[73]=ho[97]=0,po[73]=po[97]=0,fo[73]=fo[97]=-1,mo[73]=mo[97]=0,go[73]=go[97]=1,yo[73]=yo[97]=0,vo[73]=vo[97]=0,ro[73]=ro[97]=1,io[73]=io[97]=0,oo[73]=oo[97]=1,co[145]=co[25]=0,uo[145]=uo[25]=-1,ho[145]=ho[25]=0,go[145]=go[25]=1,yo[145]=yo[25]=0,vo[145]=vo[25]=1,So[145]=So[25]=0,To[145]=To[25]=1,Ao[145]=Ao[25]=1,ao[145]=ao[25]=-1,so[145]=so[25]=0,lo[145]=lo[25]=0,po[70]=po[100]=0,fo[70]=fo[100]=1,mo[70]=mo[100]=0,_o[70]=_o[100]=-1,xo[70]=xo[100]=0,bo[70]=bo[100]=1,wo[70]=wo[100]=0,Mo[70]=Mo[100]=-1,Eo[70]=Eo[100]=1,ro[70]=ro[100]=1,io[70]=io[100]=0,oo[70]=oo[100]=0,po[101]=po[69]=0,fo[101]=fo[69]=1,mo[101]=mo[69]=0,ro[101]=ro[69]=1,io[101]=io[69]=0,oo[101]=oo[69]=0,So[149]=So[21]=0,To[149]=To[21]=1,Ao[149]=Ao[21]=1,ao[149]=ao[21]=-1,so[149]=so[21]=0,lo[149]=lo[21]=0,_o[86]=_o[84]=-1,xo[86]=xo[84]=0,bo[86]=bo[84]=1,wo[86]=wo[84]=0,Mo[86]=Mo[84]=-1,Eo[86]=Eo[84]=1,co[89]=co[81]=0,uo[89]=uo[81]=-1,ho[89]=ho[81]=0,go[89]=go[81]=1,yo[89]=yo[81]=0,vo[89]=vo[81]=1,co[96]=co[74]=0,uo[96]=uo[74]=1,ho[96]=ho[74]=0,po[96]=po[74]=-1,fo[96]=fo[74]=0,mo[96]=mo[74]=1,wo[96]=wo[74]=1,Mo[96]=Mo[74]=0,Eo[96]=Eo[74]=0,ro[96]=ro[74]=1,io[96]=io[74]=0,oo[96]=oo[74]=1,co[24]=co[146]=0,uo[24]=uo[146]=-1,ho[24]=ho[146]=1,_o[24]=_o[146]=1,xo[24]=xo[146]=0,bo[24]=bo[146]=1,go[24]=go[146]=0,yo[24]=yo[146]=1,vo[24]=vo[146]=1,ao[24]=ao[146]=0,so[24]=so[146]=-1,lo[24]=lo[146]=0,po[6]=po[164]=-1,fo[6]=fo[164]=0,mo[6]=mo[164]=1,_o[6]=_o[164]=-1,xo[6]=xo[164]=0,bo[6]=bo[164]=0,So[6]=So[164]=0,To[6]=To[164]=-1,Ao[6]=Ao[164]=1,wo[6]=wo[164]=1,Mo[6]=Mo[164]=0,Eo[6]=Eo[164]=0,go[129]=go[41]=0,yo[129]=yo[41]=1,vo[129]=vo[41]=1,So[129]=So[41]=0,To[129]=To[41]=1,Ao[129]=Ao[41]=0,ro[129]=ro[41]=-1,io[129]=io[41]=0,oo[129]=oo[41]=0,ao[129]=ao[41]=0,so[129]=so[41]=-1,lo[129]=lo[41]=0,_o[66]=_o[104]=0,xo[66]=xo[104]=1,bo[66]=bo[104]=0,go[66]=go[104]=-1,yo[66]=yo[104]=0,vo[66]=vo[104]=1,wo[66]=wo[104]=0,Mo[66]=Mo[104]=-1,Eo[66]=Eo[104]=0,ro[66]=ro[104]=0,io[66]=io[104]=-1,oo[66]=oo[104]=1,co[144]=co[26]=-1,uo[144]=uo[26]=0,ho[144]=ho[26]=0,So[144]=So[26]=1,To[144]=To[26]=0,Ao[144]=Ao[26]=1,wo[144]=wo[26]=0,Mo[144]=Mo[26]=1,Eo[144]=Eo[26]=1,ao[144]=ao[26]=-1,so[144]=so[26]=0,lo[144]=lo[26]=1,po[36]=po[134]=0,fo[36]=fo[134]=1,mo[36]=mo[134]=1,_o[36]=_o[134]=0,xo[36]=xo[134]=1,bo[36]=bo[134]=0,ro[36]=ro[134]=0,io[36]=io[134]=-1,oo[36]=oo[134]=1,ao[36]=ao[134]=1,so[36]=so[134]=0,lo[36]=lo[134]=0,co[9]=co[161]=-1,uo[9]=uo[161]=0,ho[9]=ho[161]=0,po[9]=po[161]=0,fo[9]=fo[161]=-1,mo[9]=mo[161]=0,go[9]=go[161]=1,yo[9]=yo[161]=0,vo[9]=vo[161]=0,So[9]=So[161]=1,To[9]=To[161]=0,Ao[9]=Ao[161]=1,co[136]=0,uo[136]=1,ho[136]=1,po[136]=0,fo[136]=1,mo[136]=0,_o[136]=-1,xo[136]=0,bo[136]=1,go[136]=-1,yo[136]=0,vo[136]=0,So[136]=0,To[136]=-1,Ao[136]=0,wo[136]=0,Mo[136]=-1,Eo[136]=1,ro[136]=1,io[136]=0,oo[136]=0,ao[136]=1,so[136]=0,lo[136]=1,co[34]=0,uo[34]=-1,ho[34]=0,po[34]=0,fo[34]=-1,mo[34]=1,_o[34]=1,xo[34]=0,bo[34]=0,go[34]=1,yo[34]=0,vo[34]=1,So[34]=0,To[34]=1,Ao[34]=1,wo[34]=0,Mo[34]=1,Eo[34]=0,ro[34]=-1,io[34]=0,oo[34]=1,ao[34]=-1,so[34]=0,lo[34]=0,co[35]=0,uo[35]=1,ho[35]=1,po[35]=0,fo[35]=-1,mo[35]=1,_o[35]=1,xo[35]=0,bo[35]=0,go[35]=-1,yo[35]=0,vo[35]=0,So[35]=0,To[35]=-1,Ao[35]=0,wo[35]=0,Mo[35]=1,Eo[35]=0,ro[35]=-1,io[35]=0,oo[35]=1,ao[35]=1,so[35]=0,lo[35]=1,co[153]=0,uo[153]=1,ho[153]=1,go[153]=-1,yo[153]=0,vo[153]=0,So[153]=0,To[153]=-1,Ao[153]=0,ao[153]=1,so[153]=0,lo[153]=1,po[102]=0,fo[102]=-1,mo[102]=1,_o[102]=1,xo[102]=0,bo[102]=0,wo[102]=0,Mo[102]=1,Eo[102]=0,ro[102]=-1,io[102]=0,oo[102]=1,co[155]=0,uo[155]=-1,ho[155]=0,go[155]=1,yo[155]=0,vo[155]=1,So[155]=0,To[155]=1,Ao[155]=1,ao[155]=-1,so[155]=0,lo[155]=0,po[103]=0,fo[103]=1,mo[103]=0,_o[103]=-1,xo[103]=0,bo[103]=1,wo[103]=0,Mo[103]=-1,Eo[103]=1,ro[103]=1,io[103]=0,oo[103]=0,co[152]=0,uo[152]=1,ho[152]=1,_o[152]=-1,xo[152]=0,bo[152]=1,go[152]=-1,yo[152]=0,vo[152]=0,So[152]=0,To[152]=-1,Ao[152]=0,wo[152]=0,Mo[152]=-1,Eo[152]=1,ao[152]=1,so[152]=0,lo[152]=1,co[156]=0,uo[156]=-1,ho[156]=1,_o[156]=1,xo[156]=0,bo[156]=1,go[156]=-1,yo[156]=0,vo[156]=0,So[156]=0,To[156]=-1,Ao[156]=0,wo[156]=0,Mo[156]=1,Eo[156]=1,ao[156]=-1,so[156]=0,lo[156]=1,co[137]=0,uo[137]=1,ho[137]=1,po[137]=0,fo[137]=1,mo[137]=0,go[137]=-1,yo[137]=0,vo[137]=0,So[137]=0,To[137]=-1,Ao[137]=0,ro[137]=1,io[137]=0,oo[137]=0,ao[137]=1,so[137]=0,lo[137]=1,co[139]=0,uo[139]=1,ho[139]=1,po[139]=0,fo[139]=-1,mo[139]=0,go[139]=1,yo[139]=0,vo[139]=0,So[139]=0,To[139]=1,Ao[139]=0,ro[139]=-1,io[139]=0,oo[139]=0,ao[139]=1,so[139]=0,lo[139]=1,co[98]=0,uo[98]=-1,ho[98]=0,po[98]=0,fo[98]=-1,mo[98]=1,_o[98]=1,xo[98]=0,bo[98]=0,go[98]=1,yo[98]=0,vo[98]=1,wo[98]=0,Mo[98]=1,Eo[98]=0,ro[98]=-1,io[98]=0,oo[98]=1,co[99]=0,uo[99]=1,ho[99]=0,po[99]=0,fo[99]=-1,mo[99]=1,_o[99]=1,xo[99]=0,bo[99]=0,go[99]=-1,yo[99]=0,vo[99]=1,wo[99]=0,Mo[99]=-1,Eo[99]=0,ro[99]=1,io[99]=0,oo[99]=1,po[38]=0,fo[38]=-1,mo[38]=1,_o[38]=1,xo[38]=0,bo[38]=0,So[38]=0,To[38]=1,Ao[38]=1,wo[38]=0,Mo[38]=1,Eo[38]=0,ro[38]=-1,io[38]=0,oo[38]=1,ao[38]=-1,so[38]=0,lo[38]=0,po[39]=0,fo[39]=1,mo[39]=1,_o[39]=-1,xo[39]=0,bo[39]=0,So[39]=0,To[39]=-1,Ao[39]=1,wo[39]=0,Mo[39]=1,Eo[39]=0,ro[39]=-1,io[39]=0,oo[39]=1,ao[39]=1,so[39]=0,lo[39]=0;var Co=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Lo=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},Io=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},Po=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Ro=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},Oo=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},Do=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},No=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},ko=[],Fo=[],zo=[],Bo=[],Uo=[],jo=[],Go=[],Vo=[];Bo[1]=Uo[1]=18,Bo[169]=Uo[169]=18,zo[4]=Fo[4]=12,zo[166]=Fo[166]=12,ko[16]=Vo[16]=4,ko[154]=Vo[154]=4,jo[64]=Go[64]=22,jo[106]=Go[106]=22,zo[2]=jo[2]=17,Bo[2]=Uo[2]=18,zo[168]=jo[168]=17,Bo[168]=Uo[168]=18,ko[8]=Bo[8]=9,Fo[8]=zo[8]=12,ko[162]=Bo[162]=9,Fo[162]=zo[162]=12,ko[32]=Vo[32]=4,Fo[32]=Go[32]=1,ko[138]=Vo[138]=4,Fo[138]=Go[138]=1,Uo[128]=Vo[128]=21,jo[128]=Go[128]=22,Uo[42]=Vo[42]=21,jo[42]=Go[42]=22,Fo[5]=Uo[5]=14,Fo[165]=Uo[165]=14,zo[20]=Vo[20]=6,zo[150]=Vo[150]=6,ko[80]=jo[80]=11,ko[90]=jo[90]=11,Bo[65]=Go[65]=3,Bo[105]=Go[105]=3,ko[160]=jo[160]=11,Fo[160]=Uo[160]=14,ko[10]=jo[10]=11,Fo[10]=Uo[10]=14,zo[130]=Vo[130]=6,Bo[130]=Go[130]=3,zo[40]=Vo[40]=6,Bo[40]=Go[40]=3,Fo[101]=Go[101]=1,Fo[69]=Go[69]=1,Uo[149]=Vo[149]=21,Uo[21]=Vo[21]=21,zo[86]=jo[86]=17,zo[84]=jo[84]=17,ko[89]=Bo[89]=9,ko[81]=Bo[81]=9,ko[96]=Go[96]=0,Fo[96]=jo[96]=15,ko[74]=Go[74]=0,Fo[74]=jo[74]=15,ko[24]=zo[24]=8,Bo[24]=Vo[24]=7,ko[146]=zo[146]=8,Bo[146]=Vo[146]=7,Fo[6]=jo[6]=15,zo[6]=Uo[6]=16,Fo[164]=jo[164]=15,zo[164]=Uo[164]=16,Bo[129]=Vo[129]=7,Uo[129]=Go[129]=20,Bo[41]=Vo[41]=7,Uo[41]=Go[41]=20,zo[66]=Go[66]=2,Bo[66]=jo[66]=19,zo[104]=Go[104]=2,Bo[104]=jo[104]=19,ko[144]=Uo[144]=10,jo[144]=Vo[144]=23,ko[26]=Uo[26]=10,jo[26]=Vo[26]=23,Fo[36]=Vo[36]=5,zo[36]=Go[36]=2,Fo[134]=Vo[134]=5,zo[134]=Go[134]=2,ko[9]=Uo[9]=10,Fo[9]=Bo[9]=13,ko[161]=Uo[161]=10,Fo[161]=Bo[161]=13,Fo[37]=Vo[37]=5,Uo[37]=Go[37]=20,Fo[133]=Vo[133]=5,Uo[133]=Go[133]=20,zo[148]=Uo[148]=16,jo[148]=Vo[148]=23,zo[22]=Uo[22]=16,jo[22]=Vo[22]=23,ko[82]=zo[82]=8,Bo[82]=jo[82]=19,ko[88]=zo[88]=8,Bo[88]=jo[88]=19,ko[73]=Go[73]=0,Fo[73]=Bo[73]=13,ko[97]=Go[97]=0,Fo[97]=Bo[97]=13,ko[145]=Bo[145]=9,Uo[145]=Vo[145]=21,ko[25]=Bo[25]=9,Uo[25]=Vo[25]=21,Fo[70]=Go[70]=1,zo[70]=jo[70]=17,Fo[100]=Go[100]=1,zo[100]=jo[100]=17,ko[34]=Bo[34]=9,Fo[34]=zo[34]=12,Uo[34]=Vo[34]=21,jo[34]=Go[34]=22,ko[136]=Vo[136]=4,Fo[136]=Go[136]=1,zo[136]=jo[136]=17,Bo[136]=Uo[136]=18,ko[35]=Vo[35]=4,Fo[35]=zo[35]=12,Bo[35]=Uo[35]=18,jo[35]=Go[35]=22,ko[153]=Vo[153]=4,Bo[153]=Uo[153]=18,Fo[102]=zo[102]=12,jo[102]=Go[102]=22,ko[155]=Bo[155]=9,Uo[155]=Vo[155]=23,Fo[103]=Go[103]=1,zo[103]=jo[103]=17,ko[152]=Vo[152]=4,zo[152]=jo[152]=17,Bo[152]=Uo[152]=18,ko[156]=zo[156]=8,Bo[156]=Uo[156]=18,jo[156]=Vo[156]=23,ko[137]=Vo[137]=4,Fo[137]=Go[137]=1,Bo[137]=Uo[137]=18,ko[139]=Vo[139]=4,Fo[139]=Bo[139]=13,Uo[139]=Go[139]=20,ko[98]=Bo[98]=9,Fo[98]=zo[98]=12,jo[98]=Go[98]=22,ko[99]=Go[99]=0,Fo[99]=zo[99]=12,Bo[99]=jo[99]=19,Fo[38]=zo[38]=12,Uo[38]=Vo[38]=21,jo[38]=Go[38]=22,Fo[39]=Vo[39]=5,zo[39]=Uo[39]=16,jo[39]=Go[39]=22;var Ho=[];function Wo(t,e,n){return(t-e)/(n-e)}function qo(t){return t.constructor.toString().indexOf("Array")>-1}function Xo(t,e,n,r,i,o){for(var a=t.cells[n][e],s=a.cval_real,l=e+r,c=n+i,u=[],h=!1;!h;){if(void 0===t.cells[c]||void 0===t.cells[c][l])if(c-=i,l-=r,s=(a=t.cells[c][l]).cval_real,-1===i)if(0===o)if(1&s)u.push([l,c]),r=-1,i=0,o=0;else{if(!(4&s)){u.push([l+a.bottomright,c]),r=0,i=1,o=1,h=!0;break}u.push([l+1,c]),r=1,i=0,o=0}else{if(!(1&s)){if(4&s){u.push([l+a.bottomright,c]),r=0,i=1,o=1,h=!0;break}u.push([l+a.bottomleft,c]),r=0,i=1,o=0,h=!0;break}u.push([l,c]),r=-1,i=0,o=0}else if(1===i)if(0===o){if(!(s&no)){if(s&eo){u.push([l+a.topleft,c+1]),r=0,i=-1,o=0,h=!0;break}u.push([l+a.topright,c+1]),r=0,i=-1,o=1,h=!0;break}u.push([l+1,c+1]),r=1,i=0,o=1}else u.push([l+1,c+1]),r=1,i=0,o=1;else if(-1===r)if(0===o){if(!(s&eo)){if(1&s){u.push([l,c+a.leftbottom]),r=1,i=0,o=0,h=!0;break}u.push([l,c+a.lefttop]),r=1,i=0,o=1,h=!0;break}u.push([l,c+1]),r=0,i=1,o=0}else{if(!(s&eo)){console.log("MarchingSquaresJS-isoBands: wtf");break}u.push([l,c+1]),r=0,i=1,o=0}else{if(1!==r){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(4&s)){u.push([l+1,c+a.rightbottom]),r=-1,i=0,o=0,h=!0;break}u.push([l+1,c]),r=0,i=-1,o=1}else{if(!(4&s)){if(s&no){u.push([l+1,c+a.righttop]),r=-1,i=0,o=1;break}u.push([l+1,c+a.rightbottom]),r=-1,i=0,o=0,h=!0;break}u.push([l+1,c]),r=0,i=-1,o=1}}else if(s=(a=t.cells[c][l]).cval_real,-1===r)if(0===o)if(void 0!==t.cells[c-1]&&void 0!==t.cells[c-1][l])r=0,i=-1,o=1;else{if(!(1&s)){u.push([l+a.bottomright,c]),r=0,i=1,o=1,h=!0;break}u.push([l,c])}else{if(!(s&eo)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+l+","+c);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===r){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c+1]&&void 0!==t.cells[c+1][l])r=0,i=1,o=0;else{if(!(s&no)){u.push([l+a.topleft,c+1]),r=0,i=-1,o=0,h=!0;break}u.push([l+1,c+1]),r=1,i=0,o=1}}else if(-1===i){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c][l+1])r=1,i=0,o=1;else{if(!(4&s)){u.push([l+1,c+a.righttop]),r=-1,i=0,o=1,h=!0;break}u.push([l+1,c]),r=0,i=-1,o=1}}else{if(1!==i){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c][l-1])r=-1,i=0,o=0;else{if(!(s&eo)){u.push([l,c+a.leftbottom]),r=1,i=0,o=0,h=!0;break}u.push([l,c+1]),r=0,i=1,o=0}}if(c+=i,(l+=r)===e&&c===n)break}return{path:u,i:l,j:c,x:r,y:i,o:o}}function Zo(t){if(t.edges.length>0){var e=t.edges[t.edges.length-1],n=t.cval_real;switch(e){case 0:return n&no?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return 4&n?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return 1&n?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return n&no?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return 4&n?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return 1&n?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return 1&n?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return 1&n?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return n&eo?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return 1&n?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return 1&n?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return n&eo?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return 4&n?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return n&eo?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return 1&n?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return n&eo?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return n&eo?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return n&no?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return n&eo?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return n&no?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t)}}return null}function Yo(t,e,n,r){var i,o,a,s,l,c=t.cval;switch(e){case-1:switch(r){case 0:i=Fo[c],a=po[c],s=fo[c],l=mo[c];break;default:i=ko[c],a=co[c],s=uo[c],l=ho[c]}break;case 1:switch(r){case 0:i=Uo[c],a=So[c],s=To[c],l=Ao[c];break;default:i=jo[c],a=wo[c],s=Mo[c],l=Eo[c]}break;default:switch(n){case-1:switch(r){case 0:i=Go[c],a=ro[c],s=io[c],l=oo[c];break;default:i=Vo[c],a=ao[c],s=so[c],l=lo[c]}break;case 1:switch(r){case 0:i=Bo[c],a=go[c],s=yo[c],l=vo[c];break;default:i=zo[c],a=_o[c],s=xo[c],l=bo[c]}}}if(o=t.edges.indexOf(i),void 0===t.edges[o])return null;switch(function(t,e){delete t.edges[e];for(var n=e+1;n<t.edges.length;n++)t.edges[n-1]=t.edges[n];t.edges.pop()}(t,o),c=t.cval_real,i){case 0:c&no?(e=t.topleft,n=1):(e=1,n=t.righttop);break;case 1:4&c?(e=1,n=t.rightbottom):(e=t.topleft,n=1);break;case 2:4&c?(e=t.topleft,n=1):(e=t.bottomright,n=0);break;case 3:1&c?(e=t.bottomleft,n=0):(e=t.topleft,n=1);break;case 4:c&no?(e=t.topright,n=1):(e=1,n=t.righttop);break;case 5:4&c?(e=1,n=t.rightbottom):(e=t.topright,n=1);break;case 6:4&c?(e=t.topright,n=1):(e=t.bottomright,n=0);break;case 7:1&c?(e=t.bottomleft,n=0):(e=t.topright,n=1);break;case 8:4&c?(e=1,n=t.righttop):(e=t.bottomright,n=0);break;case 9:1&c?(e=t.bottomleft,n=0):(e=1,n=t.righttop);break;case 10:1&c?(e=1,n=t.righttop):(e=0,n=t.leftbottom);break;case 11:c&eo?(e=0,n=t.lefttop):(e=1,n=t.righttop);break;case 12:4&c?(e=1,n=t.rightbottom):(e=t.bottomright,n=0);break;case 13:1&c?(e=t.bottomleft,n=0):(e=1,n=t.rightbottom);break;case 14:1&c?(e=1,n=t.rightbottom):(e=0,n=t.leftbottom);break;case 15:c&eo?(e=0,n=t.lefttop):(e=1,n=t.rightbottom);break;case 16:4&c?(e=0,n=t.leftbottom):(e=t.bottomright,n=0);break;case 17:c&eo?(e=0,n=t.lefttop):(e=t.bottomright,n=0);break;case 18:1&c?(e=t.bottomleft,n=0):(e=0,n=t.leftbottom);break;case 19:c&eo?(e=0,n=t.lefttop):(e=t.bottomleft,n=0);break;case 20:c&eo?(e=0,n=t.leftbottom):(e=t.topleft,n=1);break;case 21:c&no?(e=t.topright,n=1):(e=0,n=t.leftbottom);break;case 22:c&eo?(e=0,n=t.lefttop):(e=t.topleft,n=1);break;case 23:c&no?(e=t.topright,n=1):(e=0,n=t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}return void 0!==e&&void 0!==n&&void 0!==a&&void 0!==s&&void 0!==l||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(e+" "+n+" "+a+" "+s+" "+l)),{p:[e,n],x:a,y:s,o:l}}function $o(t){var e=[],n=[];t.forEach((function(t){var r=Vr(u([t]));n.push(r),e.push({ring:t,area:r})})),n.sort((function(t,e){return e-t}));var r=[];return n.forEach((function(t){for(var n=0;n<e.length;n++)if(e[n].area===t){r.push(e[n].ring),e.splice(n,1);break}})),r}function Jo(t){for(var e=t.map((function(t){return{lrCoordinates:t,grouped:!1}})),n=[];!Qo(e);)for(var r=0;r<e.length;r++)if(!e[r].grouped){var i=[];i.push(e[r].lrCoordinates),e[r].grouped=!0;for(var o=u([e[r].lrCoordinates]),a=r+1;a<e.length;a++)e[a].grouped||Ko(u([e[a].lrCoordinates]),o)&&(i.push(e[a].lrCoordinates),e[a].grouped=!0);n.push(i)}return n}function Ko(t,e){for(var n=Mn(t),r=0;r<n.features.length;r++)if(!ye(n.features[r],e))return!1;return!0}function Qo(t){for(var e=0;e<t.length;e++)if(!1===t[e].grouped)return!1;return!0}function ta(t,e,n){if(!L(n=n||{}))throw new Error("options is invalid");var r=n.pivot,i=n.mutate;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("angle is required");return 0===e||(r||(r=wn(t)),!1!==i&&void 0!==i||(t=Se(t)),O(t,(function(t){var n=ji(r,t)+e,i=Nr(r,t),o=Q(Vi(r,i,n));t[0]=o[0],t[1]=o[1]}))),t}function ea(t,e,n){if(!L(n=n||{}))throw new Error("options is invalid");var r=n.origin,i=n.mutate;if(!t)throw new Error("geojson required");if("number"!=typeof e||0===e)throw new Error("invalid factor");var o=Array.isArray(r)||"object"==typeof r;return!0!==i&&(t=Se(t)),"FeatureCollection"!==t.type||o?na(t,e,r):(F(t,(function(n,i){t.features[i]=na(n,e,r)})),t)}function na(t,e,n){var r="Point"===ot(t);return n=function(t,e){if(null==e&&(e="centroid"),Array.isArray(e)||"object"==typeof e)return K(e);var n=t.bbox?t.bbox:J(t),r=n[0],i=n[1],o=n[2],a=n[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return l([r,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return l([o,i]);case"nw":case"northwest":case"westnorth":case"topleft":return l([r,a]);case"ne":case"northeast":case"eastnorth":case"topright":return l([o,a]);case"center":return bn(t);case void 0:case null:case"centroid":return wn(t);default:throw new Error("invalid origin")}}(t,n),1===e||r||O(t,(function(t){var r=Nr(n,t),i=ji(n,t),o=Q(Vi(n,r*e,i));t[0]=o[0],t[1]=o[1],3===t.length&&(t[2]*=e)})),t}function ra(t){var e=t[0],n=t[1];return[n[0]-e[0],n[1]-e[1]]}function ia(t,e){return t[0]*e[1]-e[0]*t[1]}function oa(t,e){return!function(t,e){return 0===ia(ra(t),ra(e))}(t,e)&&function(t,e){var n,r,i=t[0],o=ra(t),a=e[0],s=ra(e),l=ia(o,s);return function(t,e){return[t[0]+e[0],t[1]+e[1]]}(i,function(t,e){return[t*e[0],t*e[1]]}(ia((r=i,[(n=a)[0]-r[0],n[1]-r[1]]),s)/l,o))}(t,e)}function aa(t,e,n){var r=[],i=w(e,n),o=Q(t),a=[];return o.forEach((function(t,e){if(e!==o.length-1){var n=(c=t,u=o[e+1],h=i,p=Math.sqrt((c[0]-u[0])*(c[0]-u[0])+(c[1]-u[1])*(c[1]-u[1])),d=c[0]+h*(u[1]-c[1])/p,f=u[0]+h*(u[1]-c[1])/p,m=c[1]+h*(c[0]-u[0])/p,g=u[1]+h*(c[0]-u[0])/p,[[d,m],[f,g]]);if(r.push(n),e>0){var s=r[e-1],l=oa(n,s);!1!==l&&(s[1]=l,n[0]=l),a.push(s[0]),e===o.length-2&&(a.push(n[0]),a.push(n[1]))}2===o.length&&(a.push(n[0]),a.push(n[1]))}var c,u,h,p,d,f,m,g})),p(a,t.properties)}function sa(t,e,n){var r=e[0]-t[0],i=e[1]-t[1],o=n[0]-e[0];return function(t){return(t>0)-(t<0)||+t}(r*(n[1]-e[1])-o*i)}function la(t,e){return e.geometry.coordinates[0].every((function(e){return ye(l(e),t)}))}Ho[1]=Ho[169]=Co,Ho[4]=Ho[166]=Lo,Ho[16]=Ho[154]=Io,Ho[64]=Ho[106]=Po,Ho[168]=Ho[2]=Ro,Ho[162]=Ho[8]=Oo,Ho[138]=Ho[32]=Do,Ho[42]=Ho[128]=No,Ho[5]=Ho[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},Ho[20]=Ho[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},Ho[80]=Ho[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},Ho[65]=Ho[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Ho[160]=Ho[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},Ho[130]=Ho[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},Ho[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},Ho[101]=Ho[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},Ho[149]=Ho[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},Ho[86]=Ho[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},Ho[89]=Ho[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},Ho[96]=Ho[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},Ho[24]=Ho[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},Ho[6]=Ho[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},Ho[129]=Ho[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},Ho[66]=Ho[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Ho[144]=Ho[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Ho[36]=Ho[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},Ho[9]=Ho[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Ho[37]=Ho[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Ho[148]=Ho[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Ho[82]=Ho[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},Ho[73]=Ho[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Ho[145]=Ho[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Ho[70]=Ho[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Ho[34]=function(t){return[No(t),Oo(t)]},Ho[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Ho[136]=function(t){return[Do(t),Ro(t)]},Ho[153]=function(t){return[Io(t),Co(t)]},Ho[102]=function(t){return[Lo(t),Po(t)]},Ho[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Ho[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Ho[152]=function(t){return[Io(t),Ro(t)]},Ho[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Ho[137]=function(t){return[Do(t),Co(t)]},Ho[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Ho[98]=function(t){return[Oo(t),Po(t)]},Ho[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Ho[38]=function(t){return[Lo(t),No(t)]},Ho[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};var ca=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(t){return t.join(",")},t.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter((function(e){return e.from.id!==t.from.id}))},t.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter((function(e){return e.to.id!==t.to.id}))},t.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort((function(e,n){var r=e.to,i=n.to;if(r.coordinates[0]-t.coordinates[0]>=0&&i.coordinates[0]-t.coordinates[0]<0)return 1;if(r.coordinates[0]-t.coordinates[0]<0&&i.coordinates[0]-t.coordinates[0]>=0)return-1;if(r.coordinates[0]-t.coordinates[0]==0&&i.coordinates[0]-t.coordinates[0]==0)return r.coordinates[1]-t.coordinates[1]>=0||i.coordinates[1]-t.coordinates[1]>=0?r.coordinates[1]-i.coordinates[1]:i.coordinates[1]-r.coordinates[1];var o=sa(t.coordinates,r.coordinates,i.coordinates);return o<0?1:o>0?-1:Math.pow(r.coordinates[0]-t.coordinates[0],2)+Math.pow(r.coordinates[1]-t.coordinates[1],2)-(Math.pow(i.coordinates[0]-t.coordinates[0],2)+Math.pow(i.coordinates[1]-t.coordinates[1],2))})),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},t.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},t}(),ua=function(){function t(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return p([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(t){return sa(t.from.coordinates,t.to.coordinates,this.to.coordinates)},t}(),ha=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},t.prototype.get=function(t){return this.edges[t]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.edges.forEach(t)},t.prototype.map=function(t){return this.edges.map(t)},t.prototype.some=function(t){return this.edges.some(t)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var t=this,e=this.edges.reduce((function(e,n,r){return n.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=r),e}),0),n=(0===e?this.length:e)-1,r=(e+1)%this.length,i=sa(this.edges[n].from.coordinates,this.edges[e].from.coordinates,this.edges[r].from.coordinates);return 0===i?this.edges[n].from.coordinates[0]>this.edges[r].from.coordinates[0]:i>0},t.prototype.toMultiPoint=function(){return g(this.edges.map((function(t){return t.from.coordinates})))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map((function(t){return t.from.coordinates}));return t.push(this.edges[0].from.coordinates),this.polygon=u([t])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=gn(this.toPolygon())},t.findEdgeRingContaining=function(t,e){var n,r,i=t.getEnvelope();return e.forEach((function(e){var o,a,s,c,u,h,p=e.getEnvelope();if(r&&(n=r.getEnvelope()),a=i,s=(o=p).geometry.coordinates[0].map((function(t){return t[0]})),c=o.geometry.coordinates[0].map((function(t){return t[1]})),u=a.geometry.coordinates[0].map((function(t){return t[0]})),h=a.geometry.coordinates[0].map((function(t){return t[1]})),(Math.max.apply(null,s)!==Math.max.apply(null,u)||Math.max.apply(null,c)!==Math.max.apply(null,h)||Math.min.apply(null,s)!==Math.min.apply(null,u)||Math.min.apply(null,c)!==Math.min.apply(null,h))&&la(p,i)){for(var d=t.map((function(t){return t.from.coordinates})),f=void 0,m=function(t){e.some((function(e){return n=t,r=e.from.coordinates,n[0]===r[0]&&n[1]===r[1];var n,r}))||(f=t)},g=0,y=d;g<y.length;g++)m(y[g]);f&&e.inside(l(f))&&(r&&!la(n,p)||(r=e))}})),r},t.prototype.inside=function(t){return ye(t,this.toPolygon())},t}(),pa=function(){function t(){this.edges=[],this.nodes={}}return t.fromGeoJson=function(e){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var n=new t;return G(e,(function(t){nt(t,"LineString","Graph::fromGeoJson"),D(t,(function(t,e){if(t){var r=n.getNode(t),i=n.getNode(e);n.addEdge(r,i)}return e}))})),n},t.prototype.getNode=function(t){var e=ca.buildId(t),n=this.nodes[e];return n||(n=this.nodes[e]=new ca(t)),n},t.prototype.addEdge=function(t,e){var n=new ua(t,e),r=n.getSymetric();this.edges.push(n),this.edges.push(r)},t.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map((function(e){return t.nodes[e]})).forEach((function(e){return t._removeIfDangle(e)}))},t.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var n=t.getOuterEdges().map((function(t){return t.to}));this.removeNode(t),n.forEach((function(t){return e._removeIfDangle(t)}))}},t.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach((function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))}))},t.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach((function(t){return e._computeNextCWEdges(e.nodes[t])})):t.getOuterEdges().forEach((function(e,n){t.getOuterEdge((0===n?t.getOuterEdges().length:n)-1).symetric.next=e}))},t.prototype._computeNextCCWEdges=function(t,e){for(var n,r,i=t.getOuterEdges(),o=i.length-1;o>=0;--o){var a=i[o],s=a.symetric,l=void 0,c=void 0;a.label===e&&(l=a),s.label===e&&(c=s),l&&c&&(c&&(r=c),l&&(r&&(r.next=l,r=void 0),n||(n=l)))}r&&(r.next=n)},t.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach((function(n){if(!(n.label>=0)){t.push(n);var r=n;do{r.label=e,r=r.next}while(!n.isEqual(r));e++}})),t},t.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach((function(t){t.label=void 0})),this._findLabeledEdgeRings().forEach((function(e){t._findIntersectionNodes(e).forEach((function(n){t._computeNextCCWEdges(n,e.label)}))}));var e=[];return this.edges.forEach((function(n){n.ring||e.push(t._findEdgeRing(n))})),e},t.prototype._findIntersectionNodes=function(t){var e=[],n=t,r=function(){var r=0;n.from.getOuterEdges().forEach((function(e){e.label===t.label&&++r})),r>1&&e.push(n.from),n=n.next};do{r()}while(!t.isEqual(n));return e},t.prototype._findEdgeRing=function(t){var e=t,n=new ha;do{n.push(e),e.ring=n,e=e.next}while(!t.isEqual(e));return n},t.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach((function(t){return e.removeEdge(t)})),t.innerEdges.forEach((function(t){return e.removeEdge(t)})),delete this.nodes[t.id]},t.prototype.removeEdge=function(t){this.edges=this.edges.filter((function(e){return!e.isEqual(t)})),t.deleteEdge()},t}();function da(t,e){var n=!0;return G(t,(function(t){G(e,(function(e){if(!1===n)return!1;n=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return n=t.coordinates,r=e.coordinates,!(n[0]===r[0]&&n[1]===r[1]);case"LineString":return!fa(e,t);case"Polygon":return!ye(t,e)}break;case"LineString":switch(e.type){case"Point":return!fa(t,e);case"LineString":return!function(t,e){return Rr(t,e).features.length>0}(t,e);case"Polygon":return!ma(e,t)}break;case"Polygon":switch(e.type){case"Point":return!ye(e,t);case"LineString":return!ma(t,e);case"Polygon":return!function(t,e){for(var n=0,r=t.coordinates[0];n<r.length;n++)if(ye(r[n],e))return!0;for(var i=0,o=e.coordinates[0];i<o.length;i++)if(ye(o[i],t))return!0;return Rr(Si(t),Si(e)).features.length>0}(e,t)}}var n,r;return!1}(t.geometry,e.geometry)}))})),n}function fa(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(ga(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function ma(t,e){for(var n=0,r=e.coordinates;n<r.length;n++)if(ye(r[n],t))return!0;return Rr(e,Si(t)).features.length>0}function ga(t,e,n){var r=n[0]-t[0],i=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1];return 0==r*a-i*o&&(Math.abs(o)>=Math.abs(a)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1])}function ya(t,e){return!(t[0]>e[0])&&!(t[2]<e[2])&&!(t[1]>e[1])&&!(t[3]<e[3])}function va(t,e){return t[0]===e[0]&&t[1]===e[1]}function _a(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function xa(t,e){for(var n=!1,r=!1,i=t.coordinates.length,o=0;o<i&&!n&&!r;){for(var a=0;a<e.coordinates.length-1;a++){var s=!0;0!==a&&a!==e.coordinates.length-2||(s=!1),Ma(e.coordinates[a],e.coordinates[a+1],t.coordinates[o],s)?n=!0:r=!0}o++}return n&&r}function ba(t,e){return Rr(t,Ti(e)).features.length>0}function wa(t,e){for(var n=!1,r=!1,i=t.coordinates.length,o=0;o<i&&(!n||!r);o++)ye(l(t.coordinates[o]),e)?n=!0:r=!0;return r&&n}function Ma(t,e,n,r){var i=n[0]-t[0],o=n[1]-t[1],a=e[0]-t[0],s=e[1]-t[1];return 0==i*s-o*a&&(r?Math.abs(a)>=Math.abs(s)?a>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:s>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]:Math.abs(a)>=Math.abs(s)?a>0?t[0]<n[0]&&n[0]<e[0]:e[0]<n[0]&&n[0]<t[0]:s>0?t[1]<n[1]&&n[1]<e[1]:e[1]<n[1]&&n[1]<t[1])}var Ea=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:Aa};function Sa(t){return t.coordinates.map((function(e){return{type:t.type.replace("Multi",""),coordinates:e}}))}function Ta(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function Aa(t,e){return Fi(t,e,{strict:!0})}Ea.prototype.compare=function(t,e){if(t.type!==e.type||!Ta(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var n=this,r=Sa(t),i=Sa(e);return r.every((function(t){return this.some((function(e){return n.compare(t,e)}))}),i)}}return!1},Ea.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n].toFixed(this.precision)!==e[n].toFixed(this.precision))return!1;return!0},Ea.prototype.compareLine=function(t,e,n,r){if(!Ta(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!r||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var a=this.compareCoord(i[n],o[n]);return this.direction||a?this.comparePath(i,o):!!this.compareCoord(i[n],o[o.length-(1+n)])&&this.comparePath(i.slice().reverse(),o)}},Ea.prototype.fixStartIndex=function(t,e){for(var n,r=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){r=i;break}return r>=0&&(n=[].concat(t.slice(r,t.length),t.slice(1,r+1))),n},Ea.prototype.comparePath=function(t,e){var n=this;return t.every((function(t,e){return n.compareCoord(t,this[e])}),e)},Ea.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var n=t.coordinates.slice(1,t.coordinates.length),r=e.coordinates.slice(1,e.coordinates.length),i=this;return n.every((function(t){return this.some((function(e){return i.compareLine(t,e,1,!0)}))}),r)}return!1},Ea.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},Ea.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},Ea.prototype.removePseudo=function(t){return t};var Ca=Ea;function La(t,e){var n=!1;return G(t,(function(t){G(e,(function(e){if(!0===n)return!0;n=!da(t.geometry,e.geometry)}))})),n}var Ia=jt((function(t){function e(t,e,n,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,n,r)}e.prototype.run=function(t,e,n,r){this._init(t,e,n,r);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var a=this.clusters.length;this.clusters.push([]),this._addToCluster(i,a),this._expandCluster(a,o)}}return this.clusters},e.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},e.prototype._expandCluster=function(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(1!==this._visited[r]){this._visited[r]=1;var i=this._regionQuery(r);i.length>=this.minPts&&(e=this._mergeArrays(e,i))}1!==this._assigned[r]&&this._addToCluster(r,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],n=0;n<this._datasetLength;n++)this.distance(this.dataset[t],this.dataset[n])<this.epsilon&&e.push(n);return e},e.prototype._mergeArrays=function(t,e){for(var n=e.length,r=0;r<n;r++){var i=e[r];t.indexOf(i)<0&&t.push(i)}return t},e.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=e)})),Pa=jt((function(t){function e(t,e,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,n)}e.prototype.init=function(t,e,n){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==n&&(this.distance=n)},e.prototype.run=function(t,e){this.init(t,e);for(var n=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var a=new Array(u),s=0,l=0;l<u;l++)a[l]=0;for(var c=0;c<n;c++){var u=this.dataset[c].length;if(o===this.assignments[c]){for(l=0;l<u;l++)a[l]+=this.dataset[c][l];s++}}if(s>0){for(l=0;l<u;l++)a[l]/=s;this.centroids[o]=a}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,n=this.dataset.length-1;do{e=Math.round(Math.random()*n),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,n=this.dataset.length,r=0;r<n;r++)(t=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),n=0;n<this.assignments.length;n++)void 0===e[t=this.assignments[n]]&&(e[t]=[]),e[t].push(n);return e},e.prototype.argmin=function(t,e,n){for(var r,i=Number.MAX_VALUE,o=0,a=e.length,s=0;s<a;s++)(r=n(t,e[s]))<i&&(i=r,o=s);return o},e.prototype.distance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;){var i=t[r]-e[r];n+=i*i}return Math.sqrt(n)},t.exports&&(t.exports=e)})),Ra=jt((function(t){function e(t,e,n){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,n)}e.prototype.insert=function(t,e){for(var n=this._queue.length,r=n;r--;){var i=this._priorities[r];"desc"===this._sorting?e>i&&(n=r):e<i&&(n=r)}this._insertAt(t,e,n)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;)if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,n=this._queue.length;e<n;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,n){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var r=0;r<t.length;r++)this.insert(t[r],e[r])}n&&(this._sorting=n)},e.prototype._insertAt=function(t,e,n){this._queue.length===n?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(n,0,t),this._priorities.splice(n,0,e))},t.exports&&(t.exports=e)})),Oa=jt((function(t){if(t.exports)var e=Ra;function n(t,e,n,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,n,r)}n.prototype.run=function(t,n,r,i){this._init(t,n,r,i);for(var o=0,a=this.dataset.length;o<a;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var s=this.clusters.length-1;this._orderedList.push(o);var l=new e(null,null,"asc"),c=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,c,l),this._expandCluster(s,l))}return this.clusters},n.prototype.getReachabilityPlot=function(){for(var t=[],e=0,n=this._orderedList.length;e<n;e++){var r=this._orderedList[e],i=this._reachability[r];t.push([r,i])}return t},n.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},n.prototype._updateQueue=function(t,e,n){var r=this;this._coreDistance=this._distanceToCore(t),e.forEach((function(e){if(void 0===r._processed[e]){var i=r.distance(r.dataset[t],r.dataset[e]),o=Math.max(r._coreDistance,i);void 0===r._reachability[e]?(r._reachability[e]=o,n.insert(e,o)):o<r._reachability[e]&&(r._reachability[e]=o,n.remove(e),n.insert(e,o))}}))},n.prototype._expandCluster=function(t,e){for(var n=e.getElements(),r=0,i=n.length;r<i;r++){var o=n[r];if(void 0===this._processed[o]){var a=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,a,e),this._expandCluster(t,e))}}},n.prototype._distanceToCore=function(t){for(var e=this.epsilon,n=0;n<e;n++)if(this._regionQuery(t,n).length>=this.minPts)return n},n.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var n=[],r=0,i=this.dataset.length;r<i;r++)this.distance(this.dataset[t],this.dataset[r])<e&&n.push(r);return n},n.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=n)})),Da=jt((function(t){t.exports&&(t.exports={DBSCAN:Ia,KMEANS:Pa,OPTICS:Oa,PriorityQueue:Ra})})),Na=function(t,e,n){for(var r=t.length,i=0,o=0;o<r;o++){var a=(t[o]||0)-(e[o]||0);i+=a*a}return n?Math.sqrt(i):i},ka=Na,Fa=function(t,e,n){var r=Math.abs(t-e);return n?r:r*r},za=Na,Ba=function(t,e){for(var n={},r=[],i=e<<2,o=t.length,a=t[0].length>0;r.length<e&&i-- >0;){var s=t[Math.floor(Math.random()*o)],l=a?s.join("_"):""+s;n[l]||(n[l]=!0,r.push(s))}if(r.length<e)throw new Error("Error initializating clusters");return r},Ua=function(t,e){var n=t[0].length?ka:Fa,r=[],i=t.length,o=t[0].length>0,a=t[Math.floor(Math.random()*i)];for(o&&a.join("_"),r.push(a);r.length<e;){for(var s=[],l=r.length,c=0,u=[],h=0;h<i;h++){for(var p=1/0,d=0;d<l;d++){var f=n(t[h],r[d]);f<=p&&(p=f)}s[h]=p}for(var m=0;m<i;m++)c+=s[m];for(var g=0;g<i;g++)u[g]={i:g,v:t[g],pr:s[g]/c,cs:0};u.sort((function(t,e){return t.pr-e.pr})),u[0].cs=u[0].pr;for(var y=1;y<i;y++)u[y].cs=u[y-1].cs+u[y].pr;for(var v=Math.random(),_=0;_<i-1&&u[_++].cs<v;);r.push(u[_-1].v)}return r};function ja(t,e,n){n=n||[];for(var r=0;r<t;r++)n[r]=e;return n}var Ga=function(t,e,n,r){var i=[],o=[],a=[],s=[],l=!1,c=r||1e4,u=t.length,h=t[0].length,p=h>0,d=[];if(n)i="kmrand"==n?Ba(t,e):"kmpp"==n?Ua(t,e):n;else for(var f={};i.length<e;){var m=Math.floor(Math.random()*u);f[m]||(f[m]=!0,i.push(t[m]))}do{ja(e,0,d);for(var g=0;g<u;g++){for(var y=1/0,v=0,_=0;_<e;_++)(s=p?za(t[g],i[_]):Math.abs(t[g]-i[_]))<=y&&(y=s,v=_);a[g]=v,d[v]++}for(var x=[],b=(o=[],0);b<e;b++)x[b]=p?ja(h,0,x[b]):0,o[b]=i[b];if(p){for(var w=0;w<e;w++)i[w]=[];for(var M=0;M<u;M++)for(var E=x[a[M]],S=t[M],T=0;T<h;T++)E[T]+=S[T];l=!0;for(var A=0;A<e;A++){for(var C=i[A],L=x[A],I=o[A],P=d[A],R=0;R<h;R++)C[R]=L[R]/P||0;if(l)for(var O=0;O<h;O++)if(I[O]!=C[O]){l=!1;break}}}else{for(var D=0;D<u;D++)x[a[D]]+=t[D];for(var N=0;N<e;N++)i[N]=x[N]/d[N]||0;l=!0;for(var k=0;k<e;k++)if(o[k]!=i[k]){l=!1;break}}l=l||--c<=0}while(!l);return{it:1e4-c,k:e,idxs:a,centroids:i}};function Va(t,e){return M(ji(t[0],t[1]))===M(ji(e[0],e[1]))}function Ha(t,e){if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error("Invalid GeoJSON object for "+e)}function Wa(t){for(var e=t,n=[];e.parent;)n.unshift(e),e=e.parent;return n}var qa={search:function(t,e,n,r){t.cleanDirty();var i=(r=r||{}).heuristic||qa.heuristics.manhattan,o=r.closest||!1,a=new Ya((function(t){return t.f})),s=e;for(e.h=i(e,n),a.push(e);a.size()>0;){var l=a.pop();if(l===n)return Wa(l);l.closed=!0;for(var c=t.neighbors(l),u=0,h=c.length;u<h;++u){var p=c[u];if(!p.closed&&!p.isWall()){var d=l.g+p.getCost(l),f=p.visited;(!f||d<p.g)&&(p.visited=!0,p.parent=l,p.h=p.h||i(p,n),p.g=d,p.f=p.g+p.h,t.markDirty(p),o&&(p.h<s.h||p.h===s.h&&p.g<s.g)&&(s=p),f?a.rescoreElement(p):a.push(p))}}}return o?Wa(s):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var n=Math.sqrt(2),r=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return 1*(r+i)+(n-2)*Math.min(r,i)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function Xa(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var n=0;n<t.length;n++){this.grid[n]=[];for(var r=0,i=t[n];r<i.length;r++){var o=new Za(n,r,i[r]);this.grid[n][r]=o,this.nodes.push(o)}}this.init()}function Za(t,e,n){this.x=t,this.y=e,this.weight=n}function Ya(t){this.content=[],this.scoreFunction=t}function $a(t,e){for(var n=0;n<e.features.length;n++)if(ye(t,e.features[n]))return!0;return!1}function Ja(t){return function(){return t}}function Ka(t){return t[0]}function Qa(t){return t[1]}function ts(){this._=null}function es(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ns(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function rs(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function is(t){for(;t.L;)t=t.L;return t}function os(t,e,n,r){var i=[null,null],o=Ls.push(i)-1;return i.left=t,i.right=e,n&&ss(i,t,e,n),r&&ss(i,e,t,r),As[t.index].halfedges.push(o),As[e.index].halfedges.push(o),i}function as(t,e,n){var r=[e,n];return r.left=t,r}function ss(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function ls(t,e,n,r,i){var o,a=t[0],s=t[1],l=a[0],c=a[1],u=0,h=1,p=s[0]-l,d=s[1]-c;if(o=e-l,p||!(o>0)){if(o/=p,p<0){if(o<u)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>u&&(u=o)}if(o=r-l,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>u&&(u=o)}else if(p>0){if(o<u)return;o<h&&(h=o)}if(o=n-c,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<h&&(h=o)}else if(d>0){if(o>h)return;o>u&&(u=o)}if(o=i-c,d||!(o<0)){if(o/=d,d<0){if(o>h)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<h&&(h=o)}return!(u>0||h<1)||(u>0&&(t[0]=[l+u*p,c+u*d]),h<1&&(t[1]=[l+h*p,c+h*d]),!0)}}}}}function cs(t,e,n,r,i){var o=t[1];if(o)return!0;var a,s,l=t[0],c=t.left,u=t.right,h=c[0],p=c[1],d=u[0],f=u[1],m=(h+d)/2,g=(p+f)/2;if(f===p){if(m<e||m>=r)return;if(h>d){if(l){if(l[1]>=i)return}else l=[m,n];o=[m,i]}else{if(l){if(l[1]<n)return}else l=[m,i];o=[m,n]}}else if(s=g-(a=(h-d)/(f-p))*m,a<-1||a>1)if(h>d){if(l){if(l[1]>=i)return}else l=[(n-s)/a,n];o=[(i-s)/a,i]}else{if(l){if(l[1]<n)return}else l=[(i-s)/a,i];o=[(n-s)/a,n]}else if(p<f){if(l){if(l[0]>=r)return}else l=[e,a*e+s];o=[r,a*r+s]}else{if(l){if(l[0]<e)return}else l=[r,a*r+s];o=[e,a*e+s]}return t[0]=l,t[1]=o,!0}function us(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function hs(t,e){return e[+(e.left!==t.site)]}function ps(t,e){return e[+(e.left===t.site)]}Xa.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)qa.cleanNode(this.nodes[t])},Xa.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)qa.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},Xa.prototype.markDirty=function(t){this.dirtyNodes.push(t)},Xa.prototype.neighbors=function(t){var e=[],n=t.x,r=t.y,i=this.grid;return i[n-1]&&i[n-1][r]&&e.push(i[n-1][r]),i[n+1]&&i[n+1][r]&&e.push(i[n+1][r]),i[n]&&i[n][r-1]&&e.push(i[n][r-1]),i[n]&&i[n][r+1]&&e.push(i[n][r+1]),this.diagonal&&(i[n-1]&&i[n-1][r-1]&&e.push(i[n-1][r-1]),i[n+1]&&i[n+1][r-1]&&e.push(i[n+1][r-1]),i[n-1]&&i[n-1][r+1]&&e.push(i[n-1][r+1]),i[n+1]&&i[n+1][r+1]&&e.push(i[n+1][r+1])),e},Xa.prototype.toString=function(){for(var t,e,n,r,i=[],o=this.grid,a=0,s=o.length;a<s;a++){for(t=[],n=0,r=(e=o[a]).length;n<r;n++)t.push(e[n].weight);i.push(t.join(" "))}return i.join("\n")},Za.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Za.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},Za.prototype.isWall=function(){return 0===this.weight},Ya.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var n=(t+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},bubbleUp:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var i,o=t+1<<1,a=o-1,s=null;if(a<e){var l=this.content[a];(i=this.scoreFunction(l))<r&&(s=a)}if(o<e){var c=this.content[o];this.scoreFunction(c)<(null===s?r:i)&&(s=o)}if(null===s)break;this.content[t]=this.content[s],this.content[s]=n,t=s}}},ts.prototype={constructor:ts,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=is(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(ns(this,n),n=(t=n).U),n.C=!1,r.C=!0,rs(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(rs(this,n),n=(t=n).U),n.C=!1,r.C=!0,ns(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,a=t.R;if(n=o?a?is(a):o:a,i?i.L===t?i.L=n:i.R=n:this._=n,o&&a?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=a,a.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,ns(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,rs(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,ns(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,rs(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ns(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,rs(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var ds,fs=[];function ms(){es(this),this.x=this.y=this.arc=this.site=this.cy=null}function gs(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var a=i[0],s=i[1],l=r[0]-a,c=r[1]-s,u=o[0]-a,h=o[1]-s,p=2*(l*h-c*u);if(!(p>=-Ps)){var d=l*l+c*c,f=u*u+h*h,m=(h*d-c*f)/p,g=(l*f-u*d)/p,y=fs.pop()||new ms;y.arc=t,y.site=i,y.x=m+a,y.y=(y.cy=g+s)+Math.sqrt(m*m+g*g),t.circle=y;for(var v=null,_=Cs._;_;)if(y.y<_.y||y.y===_.y&&y.x<=_.x){if(!_.L){v=_.P;break}_=_.L}else{if(!_.R){v=_;break}_=_.R}Cs.insert(v,y),v||(ds=y)}}}}function ys(t){var e=t.circle;e&&(e.P||(ds=e.N),Cs.remove(e),fs.push(e),es(e),t.circle=null)}var vs=[];function _s(){es(this),this.edge=this.site=this.circle=null}function xs(t){var e=vs.pop()||new _s;return e.site=t,e}function bs(t){ys(t),Ts.remove(t),vs.push(t),es(t)}function ws(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,a=t.N,s=[t];bs(t);for(var l=o;l.circle&&Math.abs(n-l.circle.x)<Is&&Math.abs(r-l.circle.cy)<Is;)o=l.P,s.unshift(l),bs(l),l=o;s.unshift(l),ys(l);for(var c=a;c.circle&&Math.abs(n-c.circle.x)<Is&&Math.abs(r-c.circle.cy)<Is;)a=c.N,s.push(c),bs(c),c=a;s.push(c),ys(c);var u,h=s.length;for(u=1;u<h;++u)c=s[u],l=s[u-1],ss(c.edge,l.site,c.site,i);l=s[0],(c=s[h-1]).edge=os(l.site,c.site,null,i),gs(l),gs(c)}function Ms(t){for(var e,n,r,i,o=t[0],a=t[1],s=Ts._;s;)if((r=Es(s,a)-o)>Is)s=s.L;else{if(!((i=o-Ss(s,a))>Is)){r>-Is?(e=s.P,n=s):i>-Is?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}!function(t){As[t.index]={site:t,halfedges:[]}}(t);var l=xs(t);if(Ts.insert(e,l),e||n){if(e===n)return ys(e),n=xs(e.site),Ts.insert(l,n),l.edge=n.edge=os(e.site,l.site),gs(e),void gs(n);if(n){ys(e),ys(n);var c=e.site,u=c[0],h=c[1],p=t[0]-u,d=t[1]-h,f=n.site,m=f[0]-u,g=f[1]-h,y=2*(p*g-d*m),v=p*p+d*d,_=m*m+g*g,x=[(g*v-d*_)/y+u,(p*_-m*v)/y+h];ss(n.edge,c,f,x),l.edge=os(c,t,null,x),n.edge=os(t,f,null,x),gs(e),gs(n)}else l.edge=os(e.site,l.site)}}function Es(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var a=t.P;if(!a)return-1/0;var s=(n=a.site)[0],l=n[1],c=l-e;if(!c)return s;var u=s-r,h=1/o-1/c,p=u/c;return h?(-p+Math.sqrt(p*p-2*h*(u*u/(-2*c)-l+c/2+i-o/2)))/h+r:(r+s)/2}function Ss(t,e){var n=t.N;if(n)return Es(n,e);var r=t.site;return r[1]===e?r[0]:1/0}var Ts,As,Cs,Ls,Is=1e-6,Ps=1e-12;function Rs(t,e){return e[1]-t[1]||e[0]-t[0]}function Os(t,e){var n,r,i,o=t.sort(Rs).pop();for(Ls=[],As=new Array(t.length),Ts=new ts,Cs=new ts;;)if(i=ds,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(Ms(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;ws(i.arc)}if(function(){for(var t,e,n,r,i=0,o=As.length;i<o;++i)if((t=As[i])&&(r=(e=t.halfedges).length)){var a=new Array(r),s=new Array(r);for(n=0;n<r;++n)a[n]=n,s[n]=us(t,Ls[e[n]]);for(a.sort((function(t,e){return s[e]-s[t]})),n=0;n<r;++n)s[n]=e[a[n]];for(n=0;n<r;++n)e[n]=s[n]}}(),e){var a=+e[0][0],s=+e[0][1],l=+e[1][0],c=+e[1][1];!function(t,e,n,r){for(var i,o=Ls.length;o--;)cs(i=Ls[o],t,e,n,r)&&ls(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>Is||Math.abs(i[0][1]-i[1][1])>Is)||delete Ls[o]}(a,s,l,c),function(t,e,n,r){var i,o,a,s,l,c,u,h,p,d,f,m,g=As.length,y=!0;for(i=0;i<g;++i)if(o=As[i]){for(a=o.site,s=(l=o.halfedges).length;s--;)Ls[l[s]]||l.splice(s,1);for(s=0,c=l.length;s<c;)f=(d=ps(o,Ls[l[s]]))[0],m=d[1],h=(u=hs(o,Ls[l[++s%c]]))[0],p=u[1],(Math.abs(f-h)>Is||Math.abs(m-p)>Is)&&(l.splice(s,0,Ls.push(as(a,d,Math.abs(f-t)<Is&&r-m>Is?[t,Math.abs(h-t)<Is?p:r]:Math.abs(m-r)<Is&&n-f>Is?[Math.abs(p-r)<Is?h:n,r]:Math.abs(f-n)<Is&&m-e>Is?[n,Math.abs(h-n)<Is?p:e]:Math.abs(m-e)<Is&&f-t>Is?[Math.abs(p-e)<Is?h:t,e]:null))-1),++c);c&&(y=!1)}if(y){var v,_,x,b=1/0;for(i=0,y=null;i<g;++i)(o=As[i])&&(x=(v=(a=o.site)[0]-t)*v+(_=a[1]-e)*_)<b&&(b=x,y=o);if(y){var w=[t,e],M=[t,r],E=[n,r],S=[n,e];y.halfedges.push(Ls.push(as(a=y.site,w,M))-1,Ls.push(as(a,M,E))-1,Ls.push(as(a,E,S))-1,Ls.push(as(a,S,w))-1)}}for(i=0;i<g;++i)(o=As[i])&&(o.halfedges.length||delete As[i])}(a,s,l,c)}this.edges=Ls,this.cells=As,Ts=Cs=Ls=As=null}function Ds(t){return(t=t.slice()).push(t[0]),u([t])}function Ns(t,e,n,r){var i=(r=r||{}).steps||64,o=r.units||"kilometers",a=r.angle||0,s=r.pivot||t,l=r.properties||t.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!n)throw new Error("ySemiAxis is required");if(!L(r))throw new Error("options must be an object");if(!C(i))throw new Error("steps must be a number");if(!C(a))throw new Error("angle must be a number");var c=K(t);if("degrees"===o)var h=S(a);else e=Vi(t,e,90,{units:o}),n=Vi(t,n,0,{units:o}),e=K(e)[0]-c[0],n=K(n)[1]-c[1];for(var p=[],d=0;d<i;d+=1){var f=-360*d/i,m=e*n/Math.sqrt(Math.pow(n,2)+Math.pow(e,2)*Math.pow(ks(f),2)),g=e*n/Math.sqrt(Math.pow(e,2)+Math.pow(n,2)/Math.pow(ks(f),2));if(f<-90&&f>=-270&&(m=-m),f<-180&&f>=-360&&(g=-g),"degrees"===o){var y=m*Math.cos(h)+g*Math.sin(h),v=g*Math.cos(h)-m*Math.sin(h);m=y,g=v}p.push([m+c[0],g+c[1]])}return p.push(p[0]),"degrees"===o?u([p],l):ta(u([p],l),a,{pivot:s})}function ks(t){var e=t*Math.PI/180;return Math.tan(e)}function Fs(t,e){void 0===e&&(e={});var n=0,r=0,i=0;return U(t,(function(t,o,a){var s=e.weight?null==a?void 0:a[e.weight]:void 0;if(!C(s=null==s?1:s))throw new Error("weight value must be a number for feature index "+o);(s=Number(s))>0&&O(t,(function(t){n+=t[0]*s,r+=t[1]*s,i+=s}))})),l([n/i,r/i],e.properties,e)}function zs(t,e,n,r,i){var o=r.tolerance||.001,a=0,s=0,c=0,u=0;if(F(n,(function(e){var n,r=null===(n=e.properties)||void 0===n?void 0:n.weight,i=null==r?1:r;if(!C(i=Number(i)))throw new Error("weight value must be a number");if(i>0){u+=1;var o=i*xe(e,t);0===o&&(o=1);var l=i/o;a+=e.geometry.coordinates[0]*l,s+=e.geometry.coordinates[1]*l,c+=l}})),u<1)throw new Error("no features to measure");var h=a/c,p=s/c;return 1===u||0===i||Math.abs(h-e[0])<o&&Math.abs(p-e[1])<o?l([h,p],{medianCandidates:r.medianCandidates}):(r.medianCandidates.push([h,p]),zs([h,p],t,n,r,i-1))}function Bs(t,e){return{x:t[0]-e[0],y:t[1]-e[1]}}function Us(t,e){var n=0,r=0;O(t,(function(i,o,a,s,l){l>n&&(n=l,r=o,e.push([]));var c=o-r,u=t.coordinates[l][c+1],h=i[0],p=i[1],d=u[0],f=u[1];e[l].push([.75*h+.25*d,.75*p+.25*f]),e[l].push([.25*h+.75*d,.25*p+.75*f])}),!0),e.forEach((function(t){t.push(t[0])}))}function js(t,e){var n=0,r=0,i=0;O(t,(function(o,a,s,l,c){l>i&&(i=l,r=a,e.push([[]])),c>n&&(n=c,r=a,e[l].push([]));var u=a-r,h=t.coordinates[l][c][u+1],p=o[0],d=o[1],f=h[0],m=h[1];e[l][c].push([.75*p+.25*f,.75*d+.25*m]),e[l][c].push([.25*p+.75*f,.25*d+.75*m])}),!0),e.forEach((function(t){t.forEach((function(t){t.push(t[0])}))}))}function Gs(t,e,n){void 0===n&&(n=2);var r=K(t),i=K(e),o=r[0]-i[0],a=r[1]-i[1];return 1===n?Math.abs(o)+Math.abs(a):Math.pow(Math.pow(o,n)+Math.pow(a,n),1/n)}function Vs(t,e){var n=(e=e||{}).threshold||1e4,r=e.p||2,i=e.binary||!1,o=e.alpha||-1,a=e.standardization||!1,s=[];F(t,(function(t){s.push(wn(t))}));for(var l=[],c=0;c<s.length;c++)l[c]=[];for(c=0;c<s.length;c++)for(var u=c;u<s.length;u++){c===u&&(l[c][u]=0);var h=Gs(s[c],s[u],r);l[c][u]=h,l[u][c]=h}for(c=0;c<s.length;c++)for(u=0;u<s.length;u++)0!==(h=l[c][u])&&(l[c][u]=i?h<=n?1:0:h<=n?Math.pow(h,o):0);if(a)for(c=0;c<s.length;c++){var p=l[c].reduce((function(t,e){return t+e}),0);for(u=0;u<s.length;u++)l[c][u]=l[c][u]/p}return l}function Hs(t){for(var e=0,n=0,r=t;n<r.length;n++)e+=r[n];return e/t.length}function Ws(t,e){return void 0===e&&(e={}),Xs(t,"mercator",e)}function qs(t,e){return void 0===e&&(e={}),Xs(t,"wgs84",e)}function Xs(t,e,n){void 0===n&&(n={});var r=(n=n||{}).mutate;if(!t)throw new Error("geojson is required");return Array.isArray(t)&&C(t[0])?t="mercator"===e?Zs(t):Ys(t):(!0!==r&&(t=Se(t)),O(t,(function(t){var n="mercator"===e?Zs(t):Ys(t);t[0]=n[0],t[1]=n[1]}))),t}function Zs(t){var e=Math.PI/180,n=6378137,r=20037508.342789244,i=[n*(Math.abs(t[0])<=180?t[0]:t[0]-360*function(t){return t<0?-1:t>0?1:0}(t[0]))*e,n*Math.log(Math.tan(.25*Math.PI+.5*t[1]*e))];return i[0]>r&&(i[0]=r),i[0]<-r&&(i[0]=-r),i[1]>r&&(i[1]=r),i[1]<-r&&(i[1]=-r),i}function Ys(t){var e=180/Math.PI,n=6378137;return[t[0]*e/n,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/n)))*e]}Os.prototype={constructor:Os,polygons:function(){var t=this.edges;return this.cells.map((function(e){var n=e.halfedges.map((function(n){return hs(e,t[n])}));return n.data=e.site.data,n}))},triangles:function(){var t=[],e=this.edges;return this.cells.forEach((function(n,r){if(o=(i=n.halfedges).length)for(var i,o,a,s,l,c,u=n.site,h=-1,p=e[i[o-1]],d=p.left===u?p.right:p.left;++h<o;)a=d,d=(p=e[i[h]]).left===u?p.right:p.left,a&&d&&r<a.index&&r<d.index&&(l=a,c=d,((s=u)[0]-c[0])*(l[1]-s[1])-(s[0]-l[0])*(c[1]-s[1])<0)&&t.push([u.data,a.data,d.data])})),t},links:function(){return this.edges.filter((function(t){return t.right})).map((function(t){return{source:t.left.data,target:t.right.data}}))},find:function(t,e,n){for(var r,i,o=this,a=o._found||0,s=o.cells.length;!(i=o.cells[a]);)if(++a>=s)return null;var l=t-i.site[0],c=e-i.site[1],u=l*l+c*c;do{i=o.cells[r=a],a=null,i.halfedges.forEach((function(n){var r=o.edges[n],s=r.left;if(s!==i.site&&s||(s=r.right)){var l=t-s[0],c=e-s[1],h=l*l+c*c;h<u&&(u=h,a=s.index)}}))}while(null!==a);return o._found=r,null==n||u<=n*n?i.site:null}};var $s=Object.freeze({__proto__:null,toMercator:Ws,toWgs84:qs}),Js=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};function Ks(t){return Array.isArray(t)?rl(t):t&&t.bbox?rl(t.bbox):[360*nl(),180*nl()]}function Qs(t,e){void 0===e&&(e={}),null==t&&(t=1);for(var n=[],r=0;r<t;r++)n.push(l(Ks(e.bbox)));return f(n)}function tl(t,e){void 0===e&&(e={}),null==t&&(t=1),C(e.num_vertices)&&void 0!==e.num_vertices||(e.num_vertices=10),C(e.max_radial_length)&&void 0!==e.max_radial_length||(e.max_radial_length=10);for(var n=[],r=function(t){var r,i=[],o=Js(Array(e.num_vertices+1)).map(Math.random);o.forEach((function(t,e,n){n[e]=e>0?t+n[e-1]:t})),o.forEach((function(t){t=2*t*Math.PI/o[o.length-1];var n=Math.random();i.push([n*(e.max_radial_length||10)*Math.sin(t),n*(e.max_radial_length||10)*Math.cos(t)])})),i[i.length-1]=i[0],i=i.map((r=Ks(e.bbox),function(t){return[t[0]+r[0],t[1]+r[1]]})),n.push(u([i]))},i=0;i<t;i++)r();return f(n)}function el(t,e){if(void 0===e&&(e={}),!L(e=e||{}))throw new Error("options is invalid");var n=e.bbox,r=e.num_vertices,i=e.max_length,o=e.max_rotation;null==t&&(t=1),(!C(r)||void 0===r||r<2)&&(r=10),C(i)&&void 0!==i||(i=1e-4),C(o)&&void 0!==o||(o=Math.PI/8);for(var a=[],s=0;s<t;s++){for(var l=[Ks(n)],c=0;c<r-1;c++){var u=(0===c?2*Math.random()*Math.PI:Math.tan((l[c][1]-l[c-1][1])/(l[c][0]-l[c-1][0])))+(Math.random()-.5)*o*2,h=Math.random()*i;l.push([l[c][0]+h*Math.cos(u),l[c][1]+h*Math.sin(u)])}a.push(p(l))}return f(a)}function nl(){return Math.random()-.5}function rl(t){return[Math.random()*(t[2]-t[0])+t[0],Math.random()*(t[3]-t[1])+t[1]]}var il=Object.freeze({__proto__:null,randomPosition:Ks,randomPoint:Qs,randomPolygon:tl,randomLineString:el});function ol(t,e){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(null==e)throw new Error("filter is required");var n=[];return F(t,(function(t){cl(t.properties,e)&&n.push(t)})),f(n)}function al(t,e,n){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(null==e)throw new Error("property is required");for(var r=ll(t,e),i=Object.keys(r),o=0;o<i.length;o++){for(var a=i[o],s=r[a],l=[],c=0;c<s.length;c++)l.push(t.features[s[c]]);n(f(l),a,o)}}function sl(t,e,n,r){var i=r;return al(t,e,(function(t,e,o){i=0===o&&void 0===r?t:n(i,t,e,o)})),i}function ll(t,e){var n={};return F(t,(function(t,r){var i=t.properties||{};if(Object.prototype.hasOwnProperty.call(i,String(e))){var o=i[e];Object.prototype.hasOwnProperty.call(n,o)?n[o].push(r):n[o]=[r]}})),n}function cl(t,e){if(void 0===t)return!1;var n=typeof e;if("number"===n||"string"===n)return Object.prototype.hasOwnProperty.call(t,e);if(Array.isArray(e)){for(var r=0;r<e.length;r++)if(!cl(t,e[r]))return!1;return!0}return ul(t,e)}function ul(t,e){for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];if(t[i]!==e[i])return!1}return!0}function hl(t,e){if(!e)return{};if(!e.length)return{};for(var n={},r=0;r<e.length;r++){var i=e[r];Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n}var pl=Object.freeze({__proto__:null,getCluster:ol,clusterEach:al,clusterReduce:sl,createBins:ll,applyFilter:cl,propertiesContainsFilter:ul,filterProperties:hl}),dl=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null
/**
     * splaytree v3.1.0
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */};function fl(t,e){return t>e?1:t<e?-1:0}function ml(t,e,n){for(var r=new dl(null,null),i=r,o=r;;){var a=n(t,e.key);if(a<0){if(null===e.left)break;if(n(t,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,null===(e=s).left)break}o.left=e,o=e,e=e.left}else{if(!(a>0))break;if(null===e.right)break;if(n(t,e.right.key)>0&&(s=e.right,e.right=s.left,s.left=e,null===(e=s).right))break;i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function gl(t,e,n,r){var i=new dl(t,e);if(null===n)return i.left=i.right=null,i;var o=r(t,(n=ml(t,n,r)).key);return o<0?(i.left=n.left,i.right=n,n.left=null):o>=0&&(i.right=n.right,i.left=n,n.right=null),i}function yl(t,e,n){var r=null,i=null;if(e){var o=n((e=ml(t,e,n)).key,t);0===o?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function vl(t,e,n,r,i){if(t){r(e+(n?" ":" ")+i(t)+"\n");var o=e+(n?"    ":"   ");t.left&&vl(t.left,o,!1,r,i),t.right&&vl(t.right,o,!0,r,i)}}var _l=function(){function t(t){void 0===t&&(t=fl),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=gl(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var n=new dl(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var r=this._comparator,i=ml(t,this._root,r),o=r(t,i.key);return 0===o?this._root=i:(o<0?(n.left=i.left,n.right=i,i.left=null):o>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,n){var r;return null===e?null:0===n(t,(e=ml(t,e,n)).key)?(null===e.left?r=e.right:(r=ml(t,e.left,n)).right=e.right,this._size--,r):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=ml(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=ml(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this},t.prototype.range=function(t,e,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,e)>0)break;if(o(a.key,t)>=0&&n.call(r,a))return this;a=a.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,n=!1,r=0,i=[];!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},t.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n},t.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){for(var e=t,n=[],r=!1,i=new dl(null,null),o=i;!r;)e?(n.push(e),e=e.left):n.length>0?e=(e=o=o.next=n.pop()).right:r=!0;return o.next=null,i.next}(this._root)},t.prototype.load=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!1);var r=t.length,i=this._comparator;if(n&&wl(t,e,0,r-1,i),null===this._root)this._root=xl(t,e,0,r),this._size=r;else{var o=function(t,e,n){for(var r=new dl(null,null),i=r,o=t,a=e;null!==o&&null!==a;)n(o.key,a.key)<0?(i.next=o,o=o.next):(i.next=a,a=a.next),i=i.next;return null!==o?i.next=o:null!==a&&(i.next=a),r.next}(this.toList(),function(t,e){for(var n=new dl(null,null),r=n,i=0;i<t.length;i++)r=r.next=new dl(t[i],e[i]);return r.next=null,n.next}(t,e),i);r=this._size+r,this._root=bl({head:o},0,r)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return vl(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,n){var r=this._comparator,i=yl(t,this._root,r),o=i.left,a=i.right;r(t,e)<0?a=gl(e,n,a,r):o=gl(e,n,o,r),this._root=function(t,e,n){return null===e?t:(null===t||((e=ml(t.key,e,n)).left=t),e)}(o,a,r)},t.prototype.split=function(t){return yl(t,this._root,this._comparator)},t}();function xl(t,e,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),a=t[o],s=e[o],l=new dl(a,s);return l.left=xl(t,e,n,o),l.right=xl(t,e,o+1,r),l}return null}function bl(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=bl(t,e,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=bl(t,i+1,n),a}return null}function wl(t,e,n,r,i){if(!(n>=r)){for(var o=t[n+r>>1],a=n-1,s=r+1;;){do{a++}while(i(t[a],o)<0);do{s--}while(i(t[s],o)>0);if(a>=s)break;var l=t[a];t[a]=t[s],t[s]=l,l=e[a],e[a]=e[s],e[s]=l}wl(t,e,n,s,i),wl(t,e,s+1,r,i)}}function Ml(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function El(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Sl(t,e,n){return e&&El(t.prototype,e),n&&El(t,n),t}var Tl=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},Al=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},Cl=Number.EPSILON;void 0===Cl&&(Cl=Math.pow(2,-52));var Ll=Cl*Cl,Il=function(t,e){if(-Cl<t&&t<Cl&&-Cl<e&&e<Cl)return 0;var n=t-e;return n*n<Ll*t*e?0:t<e?-1:1},Pl=function(){function t(){Ml(this,t),this.reset()}return Sl(t,[{key:"reset",value:function(){this.xRounder=new Rl,this.yRounder=new Rl}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),Rl=function(){function t(){Ml(this,t),this.tree=new _l,this.round(0)}return Sl(t,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===Il(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===Il(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),t}(),Ol=new Pl,Dl=function(t,e){return t.x*e.y-t.y*e.x},Nl=function(t,e){return t.x*e.x+t.y*e.y},kl=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=Dl(r,i);return Il(o,0)},Fl=function(t){return Math.sqrt(Nl(t,t))},zl=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return Nl(i,r)/Fl(i)/Fl(r)},Bl=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},Ul=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},jl=function(){function t(e,n){Ml(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return Sl(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:Vl.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),Sl(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i,o,a,s,l,c=r.otherSE;n.set(r,{sine:(i=e.point,o=t.point,a=c.point,s={x:o.x-i.x,y:o.y-i.y},l={x:a.x-i.x,y:a.y-i.y},Dl(l,s)/Fl(l)/Fl(s)),cosine:zl(e.point,t.point,c.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,a=i.cosine,s=n.get(e),l=s.sine,c=s.cosine;return o>=0&&l>=0?a<c?1:a>c?-1:0:o<0&&l<0?a<c?-1:a>c?1:0:l<o?-1:l>o?1:0}}}]),t}(),Gl=0,Vl=function(){function t(e,n,r,i){Ml(this,t),this.id=++Gl,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return Sl(t,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=t.leftSE.point.y,s=e.leftSE.point.y,l=t.rightSE.point.y,c=e.rightSE.point.y;if(n<r){if(s<a&&s<l)return 1;if(s>a&&s>l)return-1;var u=t.comparePoint(e.leftSE.point);if(u<0)return 1;if(u>0)return-1;var h=e.comparePoint(t.rightSE.point);return 0!==h?h:-1}if(n>r){if(a<s&&a<c)return-1;if(a>s&&a>c)return 1;var p=e.comparePoint(t.leftSE.point);if(0!==p)return p;var d=t.comparePoint(e.rightSE.point);return d<0?1:d>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var f=e.comparePoint(t.rightSE.point);if(0!==f)return f}if(i>o){var m=t.comparePoint(e.rightSE.point);if(m<0)return 1;if(m>0)return-1}if(i!==o){var g=l-a,y=i-n,v=c-s,_=o-r;if(g>y&&v<_)return 1;if(g<y&&v>_)return-1}return i>o?1:i<o||l<c?-1:l>c?1:t.id<e.id?-1:t.id>e.id?1:0}}]),Sl(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var a=(t.x-e.x)/r.x,s=e.y+a*r.y;return t.y===s?0:t.y<s?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=Al(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,s=t.rightSE.point,l=Tl(e,a)&&0===this.comparePoint(a),c=Tl(n,i)&&0===t.comparePoint(i),u=Tl(e,s)&&0===this.comparePoint(s),h=Tl(n,o)&&0===t.comparePoint(o);if(c&&l)return h&&!u?o:!h&&u?s:null;if(c)return u&&i.x===s.x&&i.y===s.y?null:i;if(l)return h&&o.x===a.x&&o.y===a.y?null:a;if(h&&u)return null;if(h)return o;if(u)return s;var p=function(t,e,n,r){if(0===e.x)return Ul(n,r,t.x);if(0===r.x)return Ul(t,e,n.x);if(0===e.y)return Bl(n,r,t.y);if(0===r.y)return Bl(t,e,n.y);var i=Dl(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},a=Dl(o,e)/i,s=Dl(o,r)/i;return{x:(t.x+s*e.x+(n.x+a*r.x))/2,y:(t.y+s*e.y+(n.y+a*r.y))/2}}(i,this.vector(),a,t.vector());return null===p?null:Tl(r,p)?Ol.round(p.x,p.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new jl(e,!0),o=new jl(e,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new t(i,a,this.rings.slice(),this.windings.slice());return jl.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),jl.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,l=r.rings.length;s<l;s++){var c=r.rings[s],u=r.windings[s],h=n.rings.indexOf(c);-1===h?(n.rings.push(c),n.windings.push(u)):n.windings[h]+=u}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],l=e.indexOf(a);-1===l?(e.push(a),n.push(s)):n[l]+=s}for(var c=[],u=[],h=0,p=e.length;h<p;h++)if(0!==n[h]){var d=e[h],f=d.poly;if(-1===u.indexOf(f))if(d.isExterior)c.push(f);else{-1===u.indexOf(f)&&u.push(f);var m=c.indexOf(d.poly);-1!==m&&c.splice(m,1)}}for(var g=0,y=c.length;g<y;g++){var v=c[g].multiPoly;-1===r.indexOf(v)&&r.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Ql.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===Ql.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(t.length-e.length);this._isInResult=a%2==1;break;case"difference":var s=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=s(t)!==s(e);break;default:throw new Error("Unrecognized operation type found ".concat(Ql.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,a,s=jl.comparePoints(e,n);if(s<0)i=e,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,a=-1}return new t(new jl(i,!0),new jl(o,!1),[r],[a])}}]),t}(),Hl=function(){function t(e,n,r){if(Ml(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=Ol.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,a=1,s=e.length;a<s;a++){if("number"!=typeof e[a][0]||"number"!=typeof e[a][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ol.round(e[a][0],e[a][1]);l.x===o.x&&l.y===o.y||(this.segments.push(Vl.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}i.x===o.x&&i.y===o.y||this.segments.push(Vl.fromRing(o,i,this))}return Sl(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),t}(),Wl=function(){function t(e,n){if(Ml(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Hl(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new Hl(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return Sl(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),ql=function(){function t(e,n){if(Ml(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new Wl(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return Sl(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),Xl=function(){function t(e){Ml(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return Sl(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,l=o.rightSE,c=[s],u=s.point,h=[];a=s,s=l,c.push(s),s.point!==u;)for(;;){var p=s.getAvailableLinkedEvents();if(0===p.length){var d=c[0].point,f=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(d.x,",")+" ".concat(d.y,"]. Last matching segment found ends at")+" [".concat(f.x,", ").concat(f.y,"]."))}if(1===p.length){l=p[0].otherSE;break}for(var m=null,g=0,y=h.length;g<y;g++)if(h[g].point===s.point){m=g;break}if(null===m){h.push({index:c.length,point:s.point});var v=s.getLeftmostComparator(a);l=p.sort(v)[0].otherSE;break}var _=h.splice(m)[0],x=c.splice(_.index);x.unshift(x[0].otherSE),n.push(new t(x.reverse()))}n.push(new t(c))}}return n}}]),Sl(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==kl(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var a=e[0],s=e[1];0===kl(a,t,s)&&e.shift(),e.push(e[0]);for(var l=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:e.length-1,u=this.isExteriorRing()?e.length:-1,h=[],p=c;p!=u;p+=l)h.push([e[p].x,e[p].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];jl.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),Zl=function(){function t(e){Ml(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Sl(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),t}(),Yl=function(){function t(e){Ml(this,t),this.rings=e,this.polys=this._composePolys(e)}return Sl(t,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new Zl(i));else{var o=i.enclosingRing();o.poly||e.push(new Zl(o)),o.poly.addInterior(i)}}return e}}]),t}(),$l=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Vl.compare;Ml(this,t),this.queue=e,this.tree=new _l(n),this.segments=[]}return Sl(t,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(t.isLeft){var l=null;if(a){var c=a.getIntersection(e);if(null!==c&&(e.isAnEndpoint(c)||(l=c),!a.isAnEndpoint(c)))for(var u=this._splitSafely(a,c),h=0,p=u.length;h<p;h++)n.push(u[h])}var d=null;if(s){var f=s.getIntersection(e);if(null!==f&&(e.isAnEndpoint(f)||(d=f),!s.isAnEndpoint(f)))for(var m=this._splitSafely(s,f),g=0,y=m.length;g<y;g++)n.push(m[g])}if(null!==l||null!==d){var v=null;v=null===l?d:null===d||jl.comparePoints(l,d)<=0?l:d,this.queue.remove(e.rightSE),n.push(e.rightSE);for(var _=e.split(v),x=0,b=_.length;x<b;x++)n.push(_[x])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=a)}else{if(a&&s){var w=a.getIntersection(s);if(null!==w){if(!a.isAnEndpoint(w))for(var M=this._splitSafely(a,w),E=0,S=M.length;E<S;E++)n.push(M[E]);if(!s.isAnEndpoint(w))for(var T=this._splitSafely(s,w),A=0,C=T.length;A<C;A++)n.push(T[A])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),t}(),Jl="undefined"!=typeof t&&Object({NODE_ENV:"production",BASE_URL:"/site-divider/"}).POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Kl="undefined"!=typeof t&&Object({NODE_ENV:"production",BASE_URL:"/site-divider/"}).POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ql=new(function(){function t(){Ml(this,t)}return Sl(t,[{key:"run",value:function(t,e,n){Ql.type=t,Ol.reset();for(var r=[new ql(e,!0)],i=0,o=n.length;i<o;i++)r.push(new ql(n[i],!1));if(Ql.numMultiPolys=r.length,"difference"===Ql.type)for(var a=r[0],s=1;s<r.length;)null!==Al(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===Ql.type)for(var l=0,c=r.length;l<c;l++)for(var u=r[l],h=l+1,p=r.length;h<p;h++)if(null===Al(u.bbox,r[h].bbox))return[];for(var d=new _l(jl.compare),f=0,m=r.length;f<m;f++)for(var g=r[f].getSweepEvents(),y=0,v=g.length;y<v;y++)if(d.insert(g[y]),d.size>Jl)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var _=new $l(d),x=d.size,b=d.pop();b;){var w=b.key;if(d.size===x){var M=w.segment;throw new Error("Unable to pop() ".concat(w.isLeft?"left":"right"," SweepEvent ")+"[".concat(w.point.x,", ").concat(w.point.y,"] from segment #").concat(M.id," ")+"[".concat(M.leftSE.point.x,", ").concat(M.leftSE.point.y,"] -> ")+"[".concat(M.rightSE.point.x,", ").concat(M.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>Jl)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(_.segments.length>Kl)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var E=_.process(w),S=0,T=E.length;S<T;S++){var A=E[S];void 0===A.consumedBy&&d.insert(A)}x=d.size,b=d.pop()}Ol.reset();var C=Xl.factory(_.segments);return new Yl(C).getGeom()}}]),t}()),tc={union:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ql.run("union",t,n)},intersection:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ql.run("intersection",t,n)},xor:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ql.run("xor",t,n)},difference:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Ql.run("difference",t,n)}};"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var ec=function(){};ec.prototype.interfaces_=function(){return[]},ec.prototype.getClass=function(){return ec},ec.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var nc=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),rc=function(){},ic={MAX_VALUE:{configurable:!0}};rc.isNaN=function(t){return Number.isNaN(t)},rc.doubleToLongBits=function(t){return t},rc.longBitsToDouble=function(t){return t},rc.isInfinite=function(t){return!Number.isFinite(t)},ic.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(rc,ic);var oc=function(){},ac=function(){},sc=function(){};function lc(){}var cc=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},uc={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};cc.prototype.setOrdinate=function(t,e){switch(t){case cc.X:this.x=e;break;case cc.Y:this.y=e;break;case cc.Z:this.z=e;break;default:throw new nc("Invalid ordinate index: "+t)}},cc.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!ec.equalsWithTolerance(this.x,e.x,n)&&!!ec.equalsWithTolerance(this.y,e.y,n)}},cc.prototype.getOrdinate=function(t){switch(t){case cc.X:return this.x;case cc.Y:return this.y;case cc.Z:return this.z}throw new nc("Invalid ordinate index: "+t)},cc.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||rc.isNaN(this.z))&&rc.isNaN(t.z)},cc.prototype.equals=function(t){return t instanceof cc&&this.equals2D(t)},cc.prototype.equalInZ=function(t,e){return ec.equalsWithTolerance(this.z,t.z,e)},cc.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},cc.prototype.clone=function(){},cc.prototype.copy=function(){return new cc(this)},cc.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},cc.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)},cc.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},cc.prototype.hashCode=function(){var t=17;return 37*(t=37*t+cc.hashCode(this.x))+cc.hashCode(this.y)},cc.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},cc.prototype.interfaces_=function(){return[oc,ac,lc]},cc.prototype.getClass=function(){return cc},cc.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=rc.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}},uc.DimensionalComparator.get=function(){return hc},uc.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},uc.NULL_ORDINATE.get=function(){return rc.NaN},uc.X.get=function(){return 0},uc.Y.get=function(){return 1},uc.Z.get=function(){return 2},Object.defineProperties(cc,uc);var hc=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new nc("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};hc.prototype.compare=function(t,e){var n=t,r=e,i=hc.compare(n.x,r.x);if(0!==i)return i;var o=hc.compare(n.y,r.y);return 0!==o?o:this._dimensionsToTest<=2?0:hc.compare(n.z,r.z)},hc.prototype.interfaces_=function(){return[sc]},hc.prototype.getClass=function(){return hc},hc.compare=function(t,e){return t<e?-1:t>e?1:rc.isNaN(t)?rc.isNaN(e)?0:-1:rc.isNaN(e)?1:0};var pc=function(){};pc.prototype.create=function(){},pc.prototype.interfaces_=function(){return[]},pc.prototype.getClass=function(){return pc};var dc=function(){},fc={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};dc.prototype.interfaces_=function(){return[]},dc.prototype.getClass=function(){return dc},dc.toLocationSymbol=function(t){switch(t){case dc.EXTERIOR:return"e";case dc.BOUNDARY:return"b";case dc.INTERIOR:return"i";case dc.NONE:return"-"}throw new nc("Unknown location value: "+t)},fc.INTERIOR.get=function(){return 0},fc.BOUNDARY.get=function(){return 1},fc.EXTERIOR.get=function(){return 2},fc.NONE.get=function(){return-1},Object.defineProperties(dc,fc);var mc=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},gc=function(){},yc={LOG_10:{configurable:!0}};gc.prototype.interfaces_=function(){return[]},gc.prototype.getClass=function(){return gc},gc.log10=function(t){var e=Math.log(t);return rc.isInfinite(e)||rc.isNaN(e)?e:e/gc.LOG_10},gc.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i},gc.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],o=arguments[2];return r<i?i:r>o?o:r}},gc.wrap=function(t,e){return t<0?e- -t%e:t%e},gc.max=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=t;return e>r&&(r=e),n>r&&(r=n),r}if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],l=i;return o>l&&(l=o),a>l&&(l=a),s>l&&(l=s),l}},gc.average=function(t,e){return(t+e)/2},yc.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(gc,yc);var vc=function(t){this.str=t};vc.prototype.append=function(t){this.str+=t},vc.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},vc.prototype.toString=function(t){return this.str};var _c=function(t){this.value=t};_c.prototype.intValue=function(){return this.value},_c.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},_c.isNaN=function(t){return Number.isNaN(t)};var xc=function(){};xc.isWhitespace=function(t){return t<=32&&t>=0||127===t},xc.toUpperCase=function(t){return t.toUpperCase()};var bc=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var r=arguments[0];t.call(this,t.parse(r))}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.init(i,o)}},wc={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};bc.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},bc.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=bc.magnitude(n._hi),i=bc.TEN.pow(r);(n=n.divide(i)).gt(bc.TEN)?(n=n.divide(bc.TEN),r+=1):n.lt(bc.ONE)&&(n=n.multiply(bc.TEN),r-=1);for(var o=r+1,a=new vc,s=bc.MAX_PRINT_DIGITS-1,l=0;l<=s;l++){t&&l===o&&a.append(".");var c=Math.trunc(n._hi);if(c<0)break;var u=!1,h=0;c>9?(u=!0,h="9"):h="0"+c,a.append(h),n=n.subtract(bc.valueOf(c)).multiply(bc.TEN),u&&n.selfAdd(bc.TEN);var p=!0,d=bc.magnitude(n._hi);if(d<0&&Math.abs(d)>=s-l&&(p=!1),!p)break}return e[0]=r,a.toString()},bc.prototype.sqr=function(){return this.multiply(this)},bc.prototype.doubleValue=function(){return this._hi+this._lo},bc.prototype.subtract=function(){if(arguments[0]instanceof bc){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},bc.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},bc.prototype.isZero=function(){return 0===this._hi&&0===this._lo},bc.prototype.selfSubtract=function(){if(arguments[0]instanceof bc){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},bc.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},bc.prototype.min=function(t){return this.le(t)?this:t},bc.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof bc){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,a=null,s=null,l=null,c=null,u=null,h=null;return l=this._hi/n,h=(i=(c=bc.SPLIT*l)-(i=c-l))*(a=(h=bc.SPLIT*n)-(a=h-n))-(u=l*n)+i*(s=n-a)+(o=l-i)*a+o*s,h=l+(c=(this._hi-u-h+this._lo-l*r)/n),this._hi=h,this._lo=l-h+c,this}},bc.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},bc.prototype.divide=function(){if(arguments[0]instanceof bc){var t=arguments[0],e=null,n=null,r=null,i=null,o=null,a=null,s=null,l=null;n=(o=this._hi/t._hi)-(e=(a=bc.SPLIT*o)-(e=a-o)),l=e*(r=(l=bc.SPLIT*t._hi)-(r=l-t._hi))-(s=o*t._hi)+e*(i=t._hi-r)+n*r+n*i;var c=l=o+(a=(this._hi-s-l+this._lo-o*t._lo)/t._hi),u=o-l+a;return new bc(c,u)}if("number"==typeof arguments[0]){var h=arguments[0];return rc.isNaN(h)?bc.createNaN():bc.copy(this).selfDivide(h,0)}},bc.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},bc.prototype.pow=function(t){if(0===t)return bc.valueOf(1);var e=new bc(this),n=bc.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&n.selfMultiply(e),(r/=2)>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n},bc.prototype.ceil=function(){if(this.isNaN())return bc.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new bc(t,e)},bc.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},bc.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},bc.prototype.setValue=function(){if(arguments[0]instanceof bc){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},bc.prototype.max=function(t){return this.ge(t)?this:t},bc.prototype.sqrt=function(){if(this.isZero())return bc.valueOf(0);if(this.isNegative())return bc.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=bc.valueOf(e),r=this.subtract(n.sqr())._hi*(.5*t);return n.add(r)},bc.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof bc){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],n=null,r=null,i=null,o=null,a=null,s=null;return o=(i=this._hi+e)-(a=i-this._hi),r=(s=(o=e-a+(this._hi-o))+this._lo)+(i-(n=i+s)),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(2===arguments.length){var l=arguments[0],c=arguments[1],u=null,h=null,p=null,d=null,f=null,m=null,g=null;d=this._hi+l,h=this._lo+c,f=d-(m=d-this._hi),p=h-(g=h-this._lo);var y=(u=d+(m=(f=l-m+(this._hi-f))+h))+(m=(p=c-g+(this._lo-p))+(m+(d-u))),v=m+(u-y);return this._hi=y,this._lo=v,this}},bc.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof bc){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,a=null,s=null,l=null,c=null;i=(l=bc.SPLIT*this._hi)-this._hi,c=bc.SPLIT*n,i=l-i,o=this._hi-i,a=c-n;var u=(l=this._hi*n)+(c=i*(a=c-a)-l+i*(s=n-a)+o*a+o*s+(this._hi*r+this._lo*n)),h=c+(i=l-u);return this._hi=u,this._lo=h,this}},bc.prototype.selfSqr=function(){return this.selfMultiply(this)},bc.prototype.floor=function(){if(this.isNaN())return bc.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new bc(t,e)},bc.prototype.negate=function(){return this.isNaN()?this:new bc(-this._hi,-this._lo)},bc.prototype.clone=function(){},bc.prototype.multiply=function(){if(arguments[0]instanceof bc){var t=arguments[0];return t.isNaN()?bc.createNaN():bc.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return rc.isNaN(e)?bc.createNaN():bc.copy(this).selfMultiply(e,0)}},bc.prototype.isNaN=function(){return rc.isNaN(this._hi)},bc.prototype.intValue=function(){return Math.trunc(this._hi)},bc.prototype.toString=function(){var t=bc.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},bc.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if("."===n.charAt(0))i="0"+n;else if(r<0)i="0."+bc.stringOfChar("0",-r)+n;else if(-1===n.indexOf(".")){var o=r-n.length;i=n+bc.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+i:i},bc.prototype.reciprocal=function(){var t,e,n,r,i=null,o=null,a=null,s=null;t=(n=1/this._hi)-(i=(a=bc.SPLIT*n)-(i=a-n)),o=(s=bc.SPLIT*this._hi)-this._hi;var l=n+(a=(1-(r=n*this._hi)-(s=i*(o=s-o)-r+i*(e=this._hi-o)+t*o+t*e)-n*this._lo)/this._hi);return new bc(l,n-l+a)},bc.prototype.toSciNotation=function(){if(this.isZero())return bc.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=bc.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var o=n.charAt(0)+"."+i;return this.isNegative()?"-"+o+r:o+r},bc.prototype.abs=function(){return this.isNaN()?bc.NaN:this.isNegative()?this.negate():new bc(this)},bc.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},bc.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},bc.prototype.add=function(){if(arguments[0]instanceof bc){var t=arguments[0];return bc.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return bc.copy(this).selfAdd(e)}},bc.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof bc){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}},bc.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},bc.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},bc.prototype.trunc=function(){return this.isNaN()?bc.NaN:this.isPositive()?this.floor():this.ceil()},bc.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},bc.prototype.interfaces_=function(){return[lc,oc,ac]},bc.prototype.getClass=function(){return bc},bc.sqr=function(t){return bc.valueOf(t).selfMultiply(t)},bc.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return bc.parse(t)}if("number"==typeof arguments[0]){var e=arguments[0];return new bc(e)}},bc.sqrt=function(t){return bc.valueOf(t).sqrt()},bc.parse=function(t){for(var e=0,n=t.length;xc.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(r=!0))}for(var o=new bc,a=0,s=0,l=0;!(e>=n);){var c=t.charAt(e);if(e++,xc.isDigit(c)){var u=c-"0";o.selfMultiply(bc.TEN),o.selfAdd(u),a++}else{if("."!==c){if("e"===c||"E"===c){var h=t.substring(e);try{l=_c.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}throw new Error("Unexpected character '"+c+"' at position "+e+" in string "+t)}s=a}}var p=o,d=a-s-l;if(0===d)p=o;else if(d>0){var f=bc.TEN.pow(d);p=o.divide(f)}else if(d<0){var m=bc.TEN.pow(-d);p=o.multiply(m)}return r?p.negate():p},bc.createNaN=function(){return new bc(rc.NaN,rc.NaN)},bc.copy=function(t){return new bc(t)},bc.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=e&&(r+=1),r},bc.stringOfChar=function(t,e){for(var n=new vc,r=0;r<e;r++)n.append(t);return n.toString()},wc.PI.get=function(){return new bc(3.141592653589793,12246467991473532e-32)},wc.TWO_PI.get=function(){return new bc(6.283185307179586,24492935982947064e-32)},wc.PI_2.get=function(){return new bc(1.5707963267948966,6123233995736766e-32)},wc.E.get=function(){return new bc(2.718281828459045,14456468917292502e-32)},wc.NaN.get=function(){return new bc(rc.NaN,rc.NaN)},wc.EPS.get=function(){return 123259516440783e-46},wc.SPLIT.get=function(){return 134217729},wc.MAX_PRINT_DIGITS.get=function(){return 32},wc.TEN.get=function(){return bc.valueOf(10)},wc.ONE.get=function(){return bc.valueOf(1)},wc.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},wc.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(bc,wc);var Mc=function(){},Ec={DP_SAFE_EPSILON:{configurable:!0}};Mc.prototype.interfaces_=function(){return[]},Mc.prototype.getClass=function(){return Mc},Mc.orientationIndex=function(t,e,n){var r=Mc.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=bc.valueOf(e.x).selfAdd(-t.x),o=bc.valueOf(e.y).selfAdd(-t.y),a=bc.valueOf(n.x).selfAdd(-e.x),s=bc.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(s).selfSubtract(o.selfMultiply(a)).signum()},Mc.signOfDet2x2=function(t,e,n,r){return t.multiply(r).selfSubtract(e.multiply(n)).signum()},Mc.intersection=function(t,e,n,r){var i=bc.valueOf(r.y).selfSubtract(n.y).selfMultiply(bc.valueOf(e.x).selfSubtract(t.x)),o=bc.valueOf(r.x).selfSubtract(n.x).selfMultiply(bc.valueOf(e.y).selfSubtract(t.y)),a=i.subtract(o),s=bc.valueOf(r.x).selfSubtract(n.x).selfMultiply(bc.valueOf(t.y).selfSubtract(n.y)),l=bc.valueOf(r.y).selfSubtract(n.y).selfMultiply(bc.valueOf(t.x).selfSubtract(n.x)),c=s.subtract(l).selfDivide(a).doubleValue(),u=bc.valueOf(t.x).selfAdd(bc.valueOf(e.x).selfSubtract(t.x).selfMultiply(c)).doubleValue(),h=bc.valueOf(e.x).selfSubtract(t.x).selfMultiply(bc.valueOf(t.y).selfSubtract(n.y)),p=bc.valueOf(e.y).selfSubtract(t.y).selfMultiply(bc.valueOf(t.x).selfSubtract(n.x)),d=h.subtract(p).selfDivide(a).doubleValue(),f=bc.valueOf(n.y).selfAdd(bc.valueOf(r.y).selfSubtract(n.y).selfMultiply(d)).doubleValue();return new cc(u,f)},Mc.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),a=i-o;if(i>0){if(o<=0)return Mc.signum(a);r=i+o}else{if(!(i<0))return Mc.signum(a);if(o>=0)return Mc.signum(a);r=-i-o}var s=Mc.DP_SAFE_EPSILON*r;return a>=s||-a>=s?Mc.signum(a):2},Mc.signum=function(t){return t>0?1:t<0?-1:0},Ec.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Mc,Ec);var Sc=function(){},Tc={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Tc.X.get=function(){return 0},Tc.Y.get=function(){return 1},Tc.Z.get=function(){return 2},Tc.M.get=function(){return 3},Sc.prototype.setOrdinate=function(t,e,n){},Sc.prototype.size=function(){},Sc.prototype.getOrdinate=function(t,e){},Sc.prototype.getCoordinate=function(){},Sc.prototype.getCoordinateCopy=function(t){},Sc.prototype.getDimension=function(){},Sc.prototype.getX=function(t){},Sc.prototype.clone=function(){},Sc.prototype.expandEnvelope=function(t){},Sc.prototype.copy=function(){},Sc.prototype.getY=function(t){},Sc.prototype.toCoordinateArray=function(){},Sc.prototype.interfaces_=function(){return[ac]},Sc.prototype.getClass=function(){return Sc},Object.defineProperties(Sc,Tc);var Ac=function(){},Cc=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ac),Lc=function(){};Lc.arraycopy=function(t,e,n,r,i){for(var o=0,a=e;a<e+i;a++)n[r+o]=t[a],o++},Lc.getProperty=function(t){return{"line.separator":"\n"}[t]};var Ic=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof cc&&arguments[1]instanceof cc){var a=arguments[0],s=arguments[1];this.x=a.y-s.y,this.y=s.x-a.x,this.w=a.x*s.y-s.x*a.y}}else if(3===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2];this.x=l,this.y=c,this.w=u}else if(4===arguments.length){var h=arguments[0],p=arguments[1],d=arguments[2],f=arguments[3],m=h.y-p.y,g=p.x-h.x,y=h.x*p.y-p.x*h.y,v=d.y-f.y,_=f.x-d.x,x=d.x*f.y-f.x*d.y;this.x=g*x-_*y,this.y=v*y-m*x,this.w=m*_-v*g}};Ic.prototype.getY=function(){var t=this.y/this.w;if(rc.isNaN(t)||rc.isInfinite(t))throw new Cc;return t},Ic.prototype.getX=function(){var t=this.x/this.w;if(rc.isNaN(t)||rc.isInfinite(t))throw new Cc;return t},Ic.prototype.getCoordinate=function(){var t=new cc;return t.x=this.getX(),t.y=this.getY(),t},Ic.prototype.interfaces_=function(){return[]},Ic.prototype.getClass=function(){return Ic},Ic.intersection=function(t,e,n,r){var i=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,s=n.y-r.y,l=r.x-n.x,c=n.x*r.y-r.x*n.y,u=i*l-s*o,h=(o*c-l*a)/u,p=(s*a-i*c)/u;if(rc.isNaN(h)||rc.isInfinite(h)||rc.isNaN(p)||rc.isInfinite(p))throw new Cc;return new cc(h,p)};var Pc=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof cc){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(4===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2],l=arguments[3];this.init(o,a,s,l)}},Rc={serialVersionUID:{configurable:!0}};Pc.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Pc.prototype.equals=function(t){if(!(t instanceof Pc))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},Pc.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Pc;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new Pc(e,r,n,i)},Pc.prototype.isNull=function(){return this._maxx<this._minx},Pc.prototype.getMaxX=function(){return this._maxx},Pc.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof cc){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof Pc){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}},Pc.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Pc){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof cc){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}},Pc.prototype.getMinY=function(){return this._miny},Pc.prototype.getMinX=function(){return this._minx},Pc.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof cc){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Pc){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},Pc.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},Pc.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},Pc.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},Pc.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},Pc.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},Pc.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},Pc.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},Pc.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},Pc.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},Pc.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Pc){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof cc){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.covers(n,r)}},Pc.prototype.centre=function(){return this.isNull()?null:new cc((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Pc.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof cc){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Pc){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),a<s?(this._miny=a,this._maxy=s):(this._miny=s,this._maxy=a)}},Pc.prototype.getMaxY=function(){return this._maxy},Pc.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},Pc.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+cc.hashCode(this._minx))+cc.hashCode(this._maxx))+cc.hashCode(this._miny))+cc.hashCode(this._maxy)},Pc.prototype.interfaces_=function(){return[oc,lc]},Pc.prototype.getClass=function(){return Pc},Pc.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=Math.min(o.x,a.x),l=Math.max(o.x,a.x),c=Math.min(r.x,i.x),u=Math.max(r.x,i.x);return!(c>l)&&!(u<s)&&(s=Math.min(o.y,a.y),l=Math.max(o.y,a.y),c=Math.min(r.y,i.y),u=Math.max(r.y,i.y),!(c>l)&&!(u<s))}},Rc.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Pc,Rc);var Oc={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Dc=function(t){this.geometryFactory=t||new _h};Dc.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=Oc.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((i=Oc.emptyTypeStr.exec(t))[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],kc[n]&&(e=kc[n].apply(this,[r]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Dc.prototype.write=function(t){return this.extractGeometry(t)},Dc.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Nc[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+Nc[e].apply(this,[t])+")"};var Nc={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Nc.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Nc.point.apply(this,[t._geometries[n]])+")");return e.join(",")},linestring:function(t){for(var e=[],n=0,r=t._points._coordinates.length;n<r;++n)e.push(Nc.coordinate.apply(this,[t._points._coordinates[n]]));return e.join(",")},linearring:function(t){for(var e=[],n=0,r=t._points._coordinates.length;n<r;++n)e.push(Nc.coordinate.apply(this,[t._points._coordinates[n]]));return e.join(",")},multilinestring:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Nc.linestring.apply(this,[t._geometries[n]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+Nc.linestring.apply(this,[t._shell])+")");for(var n=0,r=t._holes.length;n<r;++n)e.push("("+Nc.linestring.apply(this,[t._holes[n]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Nc.polygon.apply(this,[t._geometries[n]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push(this.extractGeometry(t._geometries[n]));return e.join(",")}},kc={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(Oc.spaces);return this.geometryFactory.createPoint(new cc(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPoint();for(var n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Oc.trimParens,"$1"),r.push(kc.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(r)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(Oc.spaces),r.push(new cc(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(r)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(Oc.spaces),r.push(new cc(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiLineString();for(var n=t.trim().split(Oc.parenComma),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Oc.trimParens,"$1"),r.push(kc.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(r)},polygon:function(t){var e,n,r;if(void 0===t)return this.geometryFactory.createPolygon();for(var i,o=t.trim().split(Oc.parenComma),a=[],s=0,l=o.length;s<l;++s)e=o[s].replace(Oc.trimParens,"$1"),n=kc.linestring.apply(this,[e]),r=this.geometryFactory.createLinearRing(n._points),0===s?i=r:a.push(r);return this.geometryFactory.createPolygon(i,a)},multipolygon:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var n=t.trim().split(Oc.doubleParenComma),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Oc.trimParens,"$1"),r.push(kc.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],r=0,i=e.length;r<i;++r)n.push(this.read(e[r]));return this.geometryFactory.createGeometryCollection(n)}},Fc=function(t){this.parser=new Dc(t)};Fc.prototype.write=function(t){return this.parser.write(t)},Fc.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var zc=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Bc=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(zc),Uc=function(){};Uc.prototype.interfaces_=function(){return[]},Uc.prototype.getClass=function(){return Uc},Uc.shouldNeverReachHere=function(){if(0===arguments.length)Uc.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new Bc("Should never reach here"+(null!==t?": "+t:""))}},Uc.isTrue=function(){var t;if(1===arguments.length)Uc.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new Bc:new Bc(t)},Uc.equals=function(){var t,e,n;if(2===arguments.length)Uc.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],n=arguments[2],!(e=arguments[1]).equals(t)))throw new Bc("Expected "+t+" but encountered "+e+(null!==n?": "+n:""))};var jc=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new cc,this._intPt[1]=new cc,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Gc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};jc.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},jc.prototype.getTopologySummary=function(){var t=new vc;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},jc.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)},jc.prototype.getIntersectionNum=function(){return this._result},jc.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},jc.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},jc.prototype.setPrecisionModel=function(t){this._precisionModel=t},jc.prototype.isInteriorIntersection=function(){var t=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],n=0;n<this._result;n++)if(!t._intPt[n].equals2D(t._inputLines[e][0])&&!t._intPt[n].equals2D(t._inputLines[e][1]))return!0;return!1}},jc.prototype.getIntersection=function(t){return this._intPt[t]},jc.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},jc.prototype.hasIntersection=function(){return this._result!==jc.NO_INTERSECTION},jc.prototype.getEdgeDistance=function(t,e){return jc.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},jc.prototype.isCollinear=function(){return this._result===jc.COLLINEAR_INTERSECTION},jc.prototype.toString=function(){return Fc.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Fc.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},jc.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},jc.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},jc.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},jc.prototype.interfaces_=function(){return[]},jc.prototype.getClass=function(){return jc},jc.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))o=r>i?r:i;else{var a=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);0!==(o=r>i?a:s)||t.equals(e)||(o=Math.max(a,s))}return Uc.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},jc.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=Math.sqrt(r*r+i*i);return Uc.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},Gc.DONT_INTERSECT.get=function(){return 0},Gc.DO_INTERSECT.get=function(){return 1},Gc.COLLINEAR.get=function(){return 2},Gc.NO_INTERSECTION.get=function(){return 0},Gc.POINT_INTERSECTION.get=function(){return 1},Gc.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(jc,Gc);var Vc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new Pc(this._inputLines[0][0],this._inputLines[0][1]),n=new Pc(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&n.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2];if(this._isProper=!1,Pc.intersects(n,r,e)&&0===qc.orientationIndex(n,r,e)&&0===qc.orientationIndex(r,n,e))return this._isProper=!0,(e.equals(n)||e.equals(r))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,n,r,i){i.x=this.smallestInAbsValue(t.x,e.x,n.x,r.x),i.y=this.smallestInAbsValue(t.y,e.y,n.y,r.y),t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.safeHCoordinateIntersection=function(t,n,r,i){var o=null;try{o=Ic.intersection(t,n,r,i)}catch(s){if(!(s instanceof Cc))throw s;o=e.nearestEndpoint(t,n,r,i)}return o},e.prototype.intersection=function(t,n,r,i){var o=this.intersectionWithNormalization(t,n,r,i);return this.isInSegmentEnvelopes(o)||(o=new cc(e.nearestEndpoint(t,n,r,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,n,r){var i=t,o=Math.abs(i);return Math.abs(e)<o&&(i=e,o=Math.abs(e)),Math.abs(n)<o&&(i=n,o=Math.abs(n)),Math.abs(r)<o&&(i=r),i},e.prototype.checkDD=function(t,e,n,r,i){var o=Mc.intersection(t,e,n,r),a=this.isInSegmentEnvelopes(o);Lc.out.println("DD in env = "+a+"  --------------------- "+o),i.distance(o)>1e-4&&Lc.out.println("Distance = "+i.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,n,r){var i=new cc(t),o=new cc(e),a=new cc(n),s=new cc(r),l=new cc;this.normalizeToEnvCentre(i,o,a,s,l);var c=this.safeHCoordinateIntersection(i,o,a,s);return c.x+=l.x,c.y+=l.y,c},e.prototype.computeCollinearIntersection=function(e,n,r,i){var o=Pc.intersects(e,n,r),a=Pc.intersects(e,n,i),s=Pc.intersects(r,i,e),l=Pc.intersects(r,i,n);return o&&a?(this._intPt[0]=r,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):s&&l?(this._intPt[0]=e,this._intPt[1]=n,t.COLLINEAR_INTERSECTION):o&&s?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||a||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&l?(this._intPt[0]=r,this._intPt[1]=n,!r.equals(n)||a||s?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):a&&s?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):a&&l?(this._intPt[0]=i,this._intPt[1]=n,!i.equals(n)||o||s?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,n,r,i){var o=t.x<e.x?t.x:e.x,a=t.y<e.y?t.y:e.y,s=t.x>e.x?t.x:e.x,l=t.y>e.y?t.y:e.y,c=n.x<r.x?n.x:r.x,u=n.y<r.y?n.y:r.y,h=n.x>r.x?n.x:r.x,p=n.y>r.y?n.y:r.y,d=((o>c?o:c)+(s<h?s:h))/2,f=((a>u?a:u)+(l<p?l:p))/2;i.x=d,i.y=f,t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.computeIntersect=function(e,n,r,i){if(this._isProper=!1,!Pc.intersects(e,n,r,i))return t.NO_INTERSECTION;var o=qc.orientationIndex(e,n,r),a=qc.orientationIndex(e,n,i);if(o>0&&a>0||o<0&&a<0)return t.NO_INTERSECTION;var s=qc.orientationIndex(r,i,e),l=qc.orientationIndex(r,i,n);return s>0&&l>0||s<0&&l<0?t.NO_INTERSECTION:0===o&&0===a&&0===s&&0===l?this.computeCollinearIntersection(e,n,r,i):(0===o||0===a||0===s||0===l?(this._isProper=!1,e.equals2D(r)||e.equals2D(i)?this._intPt[0]=e:n.equals2D(r)||n.equals2D(i)?this._intPt[0]=n:0===o?this._intPt[0]=new cc(r):0===a?this._intPt[0]=new cc(i):0===s?this._intPt[0]=new cc(e):0===l&&(this._intPt[0]=new cc(n))):(this._isProper=!0,this._intPt[0]=this.intersection(e,n,r,i)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,n,r){var i=t,o=qc.distancePointLine(t,n,r),a=qc.distancePointLine(e,n,r);return a<o&&(o=a,i=e),(a=qc.distancePointLine(n,t,e))<o&&(o=a,i=n),(a=qc.distancePointLine(r,t,e))<o&&(o=a,i=r),i},e}(jc),Hc=function(){};Hc.prototype.interfaces_=function(){return[]},Hc.prototype.getClass=function(){return Hc},Hc.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=n.x-e.x,a=n.y-e.y;return Hc.signOfDet2x2(r,i,o,a)},Hc.signOfDet2x2=function(t,e,n,r){var i=null,o=null,a=null;if(i=1,0===t||0===r)return 0===e||0===n?0:e>0?n>0?-i:i:n>0?i:-i;if(0===e||0===n)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,o=t,t=n,n=o,o=e,e=r,r=o):e<=-r?(i=-i,n=-n,r=-r):(o=t,t=-n,n=o,o=e,e=-r,r=o):r>0?-e<=r?(i=-i,t=-t,e=-e):(o=-t,t=n,n=o,o=-e,e=r,r=o):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,o=-t,t=-n,n=o,o=-e,e=-r,r=o),t>0){if(!(n>0))return i;if(!(t<=n))return i}else{if(n>0)return-i;if(!(t>=n))return-i;i=-i,t=-t,n=-n}for(;;){if((r-=(a=Math.floor(n/t))*e)<0)return-i;if(r>e)return i;if(t>(n-=a*t)+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(0===r)return 0===n?0:-i;if(0===n)return i;if((e-=(a=Math.floor(t/n))*r)<0)return i;if(e>r)return-i;if(n>(t-=a*n)+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(0===e)return 0===t?0:i;if(0===t)return-i}};var Wc=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};Wc.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,a=e.x-this._p.x,s=e.y-this._p.y,l=Hc.signOfDet2x2(i,o,a,s);if(0===l)return this._isPointOnSegment=!0,null;s<o&&(l=-l),l>0&&this._crossingCount++}},Wc.prototype.isPointInPolygon=function(){return this.getLocation()!==dc.EXTERIOR},Wc.prototype.getLocation=function(){return this._isPointOnSegment?dc.BOUNDARY:this._crossingCount%2==1?dc.INTERIOR:dc.EXTERIOR},Wc.prototype.isOnSegment=function(){return this._isPointOnSegment},Wc.prototype.interfaces_=function(){return[]},Wc.prototype.getClass=function(){return Wc},Wc.locatePointInRing=function(){if(arguments[0]instanceof cc&&mc(arguments[1],Sc)){for(var t=arguments[0],e=arguments[1],n=new Wc(t),r=new cc,i=new cc,o=1;o<e.size();o++)if(e.getCoordinate(o,r),e.getCoordinate(o-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof cc&&arguments[1]instanceof Array){for(var a=arguments[0],s=arguments[1],l=new Wc(a),c=1;c<s.length;c++){var u=s[c],h=s[c-1];if(l.countSegment(u,h),l.isOnSegment())return l.getLocation()}return l.getLocation()}};var qc=function(){},Xc={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};qc.prototype.interfaces_=function(){return[]},qc.prototype.getClass=function(){return qc},qc.orientationIndex=function(t,e,n){return Mc.orientationIndex(t,e,n)},qc.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,o=t[r+1].y,a=t[r-1].y;e+=i*(a-o)}return e/2}if(mc(arguments[0],Sc)){var s=arguments[0],l=s.size();if(l<3)return 0;var c=new cc,u=new cc,h=new cc;s.getCoordinate(0,u),s.getCoordinate(1,h);var p=u.x;h.x-=p;for(var d=0,f=1;f<l-1;f++)c.y=u.y,u.x=h.x,u.y=h.y,s.getCoordinate(f+1,h),h.x-=p,d+=u.x*(c.y-h.y);return d/2}},qc.distanceLineLine=function(t,e,n,r){if(t.equals(e))return qc.distancePointLine(t,n,r);if(n.equals(r))return qc.distancePointLine(r,t,e);var i=!1;if(Pc.intersects(t,e,n,r)){var o=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(0===o)i=!0;else{var a=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),s=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/o,l=a/o;(l<0||l>1||s<0||s>1)&&(i=!0)}}else i=!0;return i?gc.min(qc.distancePointLine(t,n,r),qc.distancePointLine(e,n,r),qc.distancePointLine(n,t,e),qc.distancePointLine(r,t,e)):0},qc.isPointInRing=function(t,e){return qc.locatePointInRing(t,e)!==dc.EXTERIOR},qc.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new cc;t.getCoordinate(0,r);for(var i=r.x,o=r.y,a=1;a<e;a++){t.getCoordinate(a,r);var s=r.x,l=r.y,c=s-i,u=l-o;n+=Math.sqrt(c*c+u*u),i=s,o=l}return n},qc.isCCW=function(t){var e=t.length-1;if(e<3)throw new nc("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var o=t[i];o.y>n.y&&(n=o,r=i)}var a=r;do{(a-=1)<0&&(a=e)}while(t[a].equals2D(n)&&a!==r);var s=r;do{s=(s+1)%e}while(t[s].equals2D(n)&&s!==r);var l=t[a],c=t[s];if(l.equals2D(n)||c.equals2D(n)||l.equals2D(c))return!1;var u=qc.computeOrientation(l,n,c),h=!1;return h=0===u?l.x>c.x:u>0,h},qc.locatePointInRing=function(t,e){return Wc.locatePointInRing(t,e)},qc.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)},qc.computeOrientation=function(t,e,n){return qc.orientationIndex(t,e,n)},qc.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new nc("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=qc.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];if(a.x===s.x&&a.y===s.y)return o.distance(a);var l=(s.x-a.x)*(s.x-a.x)+(s.y-a.y)*(s.y-a.y),c=((o.x-a.x)*(s.x-a.x)+(o.y-a.y)*(s.y-a.y))/l;if(c<=0)return o.distance(a);if(c>=1)return o.distance(s);var u=((a.y-o.y)*(s.x-a.x)-(a.x-o.x)*(s.y-a.y))/l;return Math.abs(u)*Math.sqrt(l)}},qc.isOnLine=function(t,e){for(var n=new Vc,r=1;r<e.length;r++){var i=e[r-1],o=e[r];if(n.computeIntersection(t,i,o),n.hasIntersection())return!0}return!1},Xc.CLOCKWISE.get=function(){return-1},Xc.RIGHT.get=function(){return qc.CLOCKWISE},Xc.COUNTERCLOCKWISE.get=function(){return 1},Xc.LEFT.get=function(){return qc.COUNTERCLOCKWISE},Xc.COLLINEAR.get=function(){return 0},Xc.STRAIGHT.get=function(){return qc.COLLINEAR},Object.defineProperties(qc,Xc);var Zc=function(){};Zc.prototype.filter=function(t){},Zc.prototype.interfaces_=function(){return[]},Zc.prototype.getClass=function(){return Zc};var Yc=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},$c={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Yc.prototype.isGeometryCollection=function(){return this.getSortIndex()===Yc.SORTINDEX_GEOMETRYCOLLECTION},Yc.prototype.getFactory=function(){return this._factory},Yc.prototype.getGeometryN=function(t){return this},Yc.prototype.getArea=function(){return 0},Yc.prototype.isRectangle=function(){return!1},Yc.prototype.equals=function(){if(arguments[0]instanceof Yc){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof Yc))return!1;var n=e;return this.equalsExact(n)}},Yc.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},Yc.prototype.geometryChanged=function(){this.apply(Yc.geometryChangedFilter)},Yc.prototype.geometryChangedAction=function(){this._envelope=null},Yc.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},Yc.prototype.getLength=function(){return 0},Yc.prototype.getNumGeometries=function(){return 1},Yc.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}},Yc.prototype.getUserData=function(){return this._userData},Yc.prototype.getSRID=function(){return this._SRID},Yc.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Yc.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===Yc.SORTINDEX_GEOMETRYCOLLECTION)throw new nc("This method does not support GeometryCollection arguments")},Yc.prototype.equal=function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},Yc.prototype.norm=function(){var t=this.copy();return t.normalize(),t},Yc.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},Yc.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new Pc(this._envelope)},Yc.prototype.setSRID=function(t){this._SRID=t},Yc.prototype.setUserData=function(t){this._userData=t},Yc.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),o=r.next(),a=i.compareTo(o);if(0!==a)return a}return n.hasNext()?1:r.hasNext()?-1:0},Yc.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Yc.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Yc.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Yc.SORTINDEX_MULTIPOINT||this.getSortIndex()===Yc.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Yc.SORTINDEX_MULTIPOLYGON},Yc.prototype.interfaces_=function(){return[ac,oc,lc]},Yc.prototype.getClass=function(){return Yc},Yc.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},Yc.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},$c.serialVersionUID.get=function(){return 0x799ea46522854c00},$c.SORTINDEX_POINT.get=function(){return 0},$c.SORTINDEX_MULTIPOINT.get=function(){return 1},$c.SORTINDEX_LINESTRING.get=function(){return 2},$c.SORTINDEX_LINEARRING.get=function(){return 3},$c.SORTINDEX_MULTILINESTRING.get=function(){return 4},$c.SORTINDEX_POLYGON.get=function(){return 5},$c.SORTINDEX_MULTIPOLYGON.get=function(){return 6},$c.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},$c.geometryChangedFilter.get=function(){return Jc},Object.defineProperties(Yc,$c);var Jc=function(){};Jc.interfaces_=function(){return[Zc]},Jc.filter=function(t){t.geometryChangedAction()};var Kc=function(){};Kc.prototype.filter=function(t){},Kc.prototype.interfaces_=function(){return[]},Kc.prototype.getClass=function(){return Kc};var Qc=function(){},tu={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Qc.prototype.isInBoundary=function(t){},Qc.prototype.interfaces_=function(){return[]},Qc.prototype.getClass=function(){return Qc},tu.Mod2BoundaryNodeRule.get=function(){return eu},tu.EndPointBoundaryNodeRule.get=function(){return nu},tu.MultiValentEndPointBoundaryNodeRule.get=function(){return ru},tu.MonoValentEndPointBoundaryNodeRule.get=function(){return iu},tu.MOD2_BOUNDARY_RULE.get=function(){return new eu},tu.ENDPOINT_BOUNDARY_RULE.get=function(){return new nu},tu.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ru},tu.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new iu},tu.OGC_SFS_BOUNDARY_RULE.get=function(){return Qc.MOD2_BOUNDARY_RULE},Object.defineProperties(Qc,tu);var eu=function(){};eu.prototype.isInBoundary=function(t){return t%2==1},eu.prototype.interfaces_=function(){return[Qc]},eu.prototype.getClass=function(){return eu};var nu=function(){};nu.prototype.isInBoundary=function(t){return t>0},nu.prototype.interfaces_=function(){return[Qc]},nu.prototype.getClass=function(){return nu};var ru=function(){};ru.prototype.isInBoundary=function(t){return t>1},ru.prototype.interfaces_=function(){return[Qc]},ru.prototype.getClass=function(){return ru};var iu=function(){};iu.prototype.isInBoundary=function(t){return 1===t},iu.prototype.interfaces_=function(){return[Qc]},iu.prototype.getClass=function(){return iu};var ou=function(){};function au(t){this.message=t||""}ou.prototype.add=function(){},ou.prototype.addAll=function(){},ou.prototype.isEmpty=function(){},ou.prototype.iterator=function(){},ou.prototype.size=function(){},ou.prototype.toArray=function(){},ou.prototype.remove=function(){},au.prototype=new Error,au.prototype.name="IndexOutOfBoundsException";var su=function(){};su.prototype.hasNext=function(){},su.prototype.next=function(){},su.prototype.remove=function(){};var lu=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(ou);function cu(t){this.message=t||""}cu.prototype=new Error,cu.prototype.name="NoSuchElementException";var uu=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof ou&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,ou]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},e.prototype.iterator=function(){return new hu(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new au;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,n=0,r=this.array_.length;n<r;n++)if(this.array_[n]===t){this.array_.splice(n,1),e=!0;break}return e},e}(lu),hu=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new cu;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(su),pu=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.ensureCapacity(n.length),this.add(n,r)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){var e=this;if(2===arguments.length){for(var n=arguments[0],r=arguments[1],i=!1,o=n.iterator();o.hasNext();)e.add(o.next(),r),i=!0;return i}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),n=0;n<this.size();n++)e.add(n,this.get(n).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var e=this;if(1===arguments.length){var n=arguments[0];t.prototype.add.call(this,n)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var r=arguments[0],i=arguments[1];return this.add(r,i,!0),!0}if(arguments[0]instanceof cc&&"boolean"==typeof arguments[1]){var o=arguments[0],a=arguments[1];if(!a&&this.size()>=1){var s=this.get(this.size()-1);if(s.equals2D(o))return null}t.prototype.add.call(this,o)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var l=arguments[0],c=arguments[1];return this.add(l,c),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var u=arguments[0],h=arguments[1],p=arguments[2];if(p)for(var d=0;d<u.length;d++)e.add(u[d],h);else for(var f=u.length-1;f>=0;f--)e.add(u[f],h);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof cc){var m=arguments[0],g=arguments[1],y=arguments[2];if(!y){var v=this.size();if(v>0){if(m>0){var _=this.get(m-1);if(_.equals2D(g))return null}if(m<v){var x=this.get(m);if(x.equals2D(g))return null}}}t.prototype.add.call(this,m,g)}}else if(4===arguments.length){var b=arguments[0],w=arguments[1],M=arguments[2],E=arguments[3],S=1;M>E&&(S=-1);for(var T=M;T!==E;T+=S)e.add(b[T],w);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new cc(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(uu),du=function(){},fu={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};fu.ForwardComparator.get=function(){return mu},fu.BidirectionalComparator.get=function(){return gu},fu.coordArrayType.get=function(){return new Array(0).fill(null)},du.prototype.interfaces_=function(){return[]},du.prototype.getClass=function(){return du},du.isRing=function(t){return!(t.length<4)&&!!t[0].equals2D(t[t.length-1])},du.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(du.indexOf(r,e)<0)return r}return null},du.scroll=function(t,e){var n=du.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);Lc.arraycopy(t,n,r,0,t.length-n),Lc.arraycopy(t,0,r,t.length-n,n),Lc.arraycopy(r,0,t,0,t.length)},du.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(r===i)return!0;if(null===r||null===i)return!1;if(r.length!==i.length)return!1;for(var a=0;a<r.length;a++)if(0!==o.compare(r[a],i[a]))return!1;return!0}},du.intersection=function(t,e){for(var n=new pu,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()},du.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},du.removeRepeatedPoints=function(t){return du.hasRepeatedPoints(t)?new pu(t,!1).toCoordinateArray():t},du.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}},du.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var r=new Array(e).fill(null);if(0===e)return r;for(var i=0,o=0;o<t.length;o++)null!==t[o]&&(r[i++]=t[o]);return r},du.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new cc(t[n]);return e}if(5===arguments.length)for(var r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=arguments[4],l=0;l<s;l++)o[a+l]=new cc(r[i+l])},du.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(0!==r.compareTo(i))return!1}return!0},du.envelope=function(t){for(var e=new Pc,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},du.toCoordinateArray=function(t){return t.toArray(du.coordArrayType)},du.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},du.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},du.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(0!==r)return r}return 1},du.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(0!==r)return r;n++}return n<e.length?-1:n<t.length?1:0},du.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e},du.extract=function(t,e,n){e=gc.clamp(e,0,t.length);var r=(n=gc.clamp(n,-1,t.length))-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(0===r)return i;for(var o=0,a=e;a<=n;a++)i[o++]=t[a];return i},Object.defineProperties(du,fu);var mu=function(){};mu.prototype.compare=function(t,e){return du.compare(t,e)},mu.prototype.interfaces_=function(){return[sc]},mu.prototype.getClass=function(){return mu};var gu=function(){};gu.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;var i=du.compare(n,r);return du.isEqualReversed(n,r)?0:i},gu.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;for(var i=du.increasingDirection(n),o=du.increasingDirection(r),a=i>0?0:n.length-1,s=o>0?0:n.length-1,l=0;l<n.length;l++){var c=n[a].compareTo(r[s]);if(0!==c)return c;a+=i,s+=o}return 0},gu.prototype.interfaces_=function(){return[sc]},gu.prototype.getClass=function(){return gu};var yu=function(){};yu.prototype.get=function(){},yu.prototype.put=function(){},yu.prototype.size=function(){},yu.prototype.values=function(){},yu.prototype.entrySet=function(){};var vu=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(yu);function _u(t){this.message=t||""}function xu(){}_u.prototype=new Error,_u.prototype.name="OperationNotSupported",xu.prototype=new ou,xu.prototype.contains=function(){};var bu=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof ou&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new wu(this)},e}(xu),wu=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new cu;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new _u},e}(su);function Mu(t){return null===t?0:t.color}function Eu(t){return null===t?null:t.parent}function Su(t,e){null!==t&&(t.color=e)}function Tu(t){return null===t?null:t.left}function Au(t){return null===t?null:t.right}function Cu(){this.root_=null,this.size_=0}Cu.prototype=new vu,Cu.prototype.get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null},Cu.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,r,i=this.root_;do{if(n=i,(r=t.compareTo(i.key))<0)i=i.left;else{if(!(r>0)){var o=i.value;return i.value=e,o}i=i.right}}while(null!==i);var a={key:t,left:null,right:null,value:e,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?n.left=a:n.right=a,this.fixAfterInsertion(a),this.size_++,null},Cu.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(Eu(t)===Tu(Eu(Eu(t)))){var n=Au(Eu(Eu(t)));1===Mu(n)?(Su(Eu(t),0),Su(n,0),Su(Eu(Eu(t)),1),t=Eu(Eu(t))):(t===Au(Eu(t))&&(t=Eu(t),e.rotateLeft(t)),Su(Eu(t),0),Su(Eu(Eu(t)),1),e.rotateRight(Eu(Eu(t))))}else{var r=Tu(Eu(Eu(t)));1===Mu(r)?(Su(Eu(t),0),Su(r,0),Su(Eu(Eu(t)),1),t=Eu(Eu(t))):(t===Tu(Eu(t))&&(t=Eu(t),e.rotateRight(t)),Su(Eu(t),0),Su(Eu(Eu(t)),1),e.rotateLeft(Eu(Eu(t))))}this.root_.color=0},Cu.prototype.values=function(){var t=new uu,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=Cu.successor(e));)t.add(e.value);return t},Cu.prototype.entrySet=function(){var t=new bu,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=Cu.successor(e));)t.add(e);return t},Cu.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},Cu.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},Cu.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},Cu.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var n=t.parent,r=t;null!==n&&r===n.right;)r=n,n=n.parent;return n},Cu.prototype.size=function(){return this.size_};var Lu=function(){};function Iu(){}function Pu(){this.array_=[],arguments[0]instanceof ou&&this.addAll(arguments[0])}Lu.prototype.interfaces_=function(){return[]},Lu.prototype.getClass=function(){return Lu},Iu.prototype=new xu,Pu.prototype=new Iu,Pu.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},Pu.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,n=this.array_.length;e<n;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},Pu.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},Pu.prototype.remove=function(t){throw new _u},Pu.prototype.size=function(){return this.array_.length},Pu.prototype.isEmpty=function(){return 0===this.array_.length},Pu.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},Pu.prototype.iterator=function(){return new Ru(this)};var Ru=function(t){this.treeSet_=t,this.position_=0};Ru.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new cu;return this.treeSet_.array_[this.position_++]},Ru.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Ru.prototype.remove=function(){throw new _u};var Ou=function(){};Ou.sort=function(){var t,e,n,r,i=arguments[0];if(1===arguments.length)r=function(t,e){return t.compareTo(e)},i.sort(r);else if(2===arguments.length)n=arguments[1],r=function(t,e){return n.compare(t,e)},i.sort(r);else if(3===arguments.length){(e=i.slice(arguments[1],arguments[2])).sort();var o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length));for(i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])}else if(4===arguments.length)for(e=i.slice(arguments[1],arguments[2]),n=arguments[3],r=function(t,e){return n.compare(t,e)},e.sort(r),o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length)),i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])},Ou.asList=function(t){for(var e=new uu,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var Du=function(){},Nu={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Nu.P.get=function(){return 0},Nu.L.get=function(){return 1},Nu.A.get=function(){return 2},Nu.FALSE.get=function(){return-1},Nu.TRUE.get=function(){return-2},Nu.DONTCARE.get=function(){return-3},Nu.SYM_FALSE.get=function(){return"F"},Nu.SYM_TRUE.get=function(){return"T"},Nu.SYM_DONTCARE.get=function(){return"*"},Nu.SYM_P.get=function(){return"0"},Nu.SYM_L.get=function(){return"1"},Nu.SYM_A.get=function(){return"2"},Du.prototype.interfaces_=function(){return[]},Du.prototype.getClass=function(){return Du},Du.toDimensionSymbol=function(t){switch(t){case Du.FALSE:return Du.SYM_FALSE;case Du.TRUE:return Du.SYM_TRUE;case Du.DONTCARE:return Du.SYM_DONTCARE;case Du.P:return Du.SYM_P;case Du.L:return Du.SYM_L;case Du.A:return Du.SYM_A}throw new nc("Unknown dimension value: "+t)},Du.toDimensionValue=function(t){switch(xc.toUpperCase(t)){case Du.SYM_FALSE:return Du.FALSE;case Du.SYM_TRUE:return Du.TRUE;case Du.SYM_DONTCARE:return Du.DONTCARE;case Du.SYM_P:return Du.P;case Du.SYM_L:return Du.L;case Du.SYM_A:return Du.A}throw new nc("Unknown dimension symbol: "+t)},Object.defineProperties(Du,Nu);var ku=function(){};ku.prototype.filter=function(t){},ku.prototype.interfaces_=function(){return[]},ku.prototype.getClass=function(){return ku};var Fu=function(){};Fu.prototype.filter=function(t,e){},Fu.prototype.isDone=function(){},Fu.prototype.isGeometryChanged=function(){},Fu.prototype.interfaces_=function(){return[]},Fu.prototype.getClass=function(){return Fu};var zu=function(t){function e(e,n){if(t.call(this,n),this._geometries=e||[],t.hasNullElements(this._geometries))throw new nc("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new Pc,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this._geometries.length;n++)for(var r=this._geometries[n].getCoordinates(),i=0;i<r.length;i++)t[++e]=r[i];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n;if(this._geometries.length!==i._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!e._geometries[o].equalsExact(i._geometries[o],r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();Ou.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=Du.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=Du.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=new Pu(Ou.asList(this._geometries)),r=new Pu(Ou.asList(e._geometries));return this.compare(n,r)}if(2===arguments.length){for(var i=arguments[0],o=arguments[1],a=i,s=this.getNumGeometries(),l=a.getNumGeometries(),c=0;c<s&&c<l;){var u=t.getGeometryN(c),h=a.getGeometryN(c),p=u.compareToSameClass(h,o);if(0!==p)return p;c++}return c<s?1:c<l?-1:0}},e.prototype.apply=function(){var t=this;if(mc(arguments[0],Kc))for(var e=arguments[0],n=0;n<this._geometries.length;n++)t._geometries[n].apply(e);else if(mc(arguments[0],Fu)){var r=arguments[0];if(0===this._geometries.length)return null;for(var i=0;i<this._geometries.length&&(t._geometries[i].apply(r),!r.isDone());i++);r.isGeometryChanged()&&this.geometryChanged()}else if(mc(arguments[0],ku)){var o=arguments[0];o.filter(this);for(var a=0;a<this._geometries.length;a++)t._geometries[a].apply(o)}else if(mc(arguments[0],Zc)){var s=arguments[0];s.filter(this);for(var l=0;l<this._geometries.length;l++)t._geometries[l].apply(s)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Uc.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var n=0;n<this._geometries.length;n++)e._geometries[n]=this._geometries[n].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,n),e}(Yc),Bu=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Yc.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Du.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[t-1-n]=this._geometries[n].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Uu(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Lu]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,n),e}(zu),Uu=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=Qc.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};Uu.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Uu.prototype.getBoundary=function(){return this._geom instanceof Ju?this.boundaryLineString(this._geom):this._geom instanceof Bu?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Uu.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Uu.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Uu.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new uu;this._endpointMap=new Cu;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);0!==i.getNumPoints()&&(e.addEndpoint(i.getCoordinateN(0)),e.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var o=this._endpointMap.entrySet().iterator();o.hasNext();){var a=o.next(),s=a.getValue().count;e._bnRule.isInBoundary(s)&&n.add(a.getKey())}return du.toCoordinateArray(n)},Uu.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new ju,this._endpointMap.put(t,e)),e.count++},Uu.prototype.interfaces_=function(){return[]},Uu.prototype.getClass=function(){return Uu},Uu.getBoundary=function(){if(1===arguments.length){var t=arguments[0],e=new Uu(t);return e.getBoundary()}if(2===arguments.length){var n=arguments[0],r=arguments[1],i=new Uu(n,r);return i.getBoundary()}};var ju=function(){this.count=null};function Gu(){}function Vu(){}ju.prototype.interfaces_=function(){return[]},ju.prototype.getClass=function(){return ju};var Hu=function(){};function Wu(){}function qu(){}function Xu(){}var Zu=function(){},Yu={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Zu.prototype.interfaces_=function(){return[]},Zu.prototype.getClass=function(){return Zu},Zu.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)},Zu.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new Wu,n=new Gu(e);return t.printStackTrace(n),e.toString()}if(2===arguments.length){for(var r=arguments[0],i=arguments[1],o="",a=new Vu(Zu.getStackTrace(r)),s=new Xu(a),l=0;l<i;l++)try{o+=s.readLine()+Zu.NEWLINE}catch(t){if(!(t instanceof qu))throw t;Uc.shouldNeverReachHere()}return o}},Zu.split=function(t,e){for(var n=e.length,r=new uu,i=""+t,o=i.indexOf(e);o>=0;){var a=i.substring(0,o);r.add(a),o=(i=i.substring(o+n)).indexOf(e)}i.length>0&&r.add(i);for(var s=new Array(r.size()).fill(null),l=0;l<s.length;l++)s[l]=r.get(l);return s},Zu.toString=function(){if(1===arguments.length){var t=arguments[0];return Zu.SIMPLE_ORDINATE_FORMAT.format(t)}},Zu.spaces=function(t){return Zu.chars(" ",t)},Yu.NEWLINE.get=function(){return Lc.getProperty("line.separator")},Yu.SIMPLE_ORDINATE_FORMAT.get=function(){return new Hu("0.#")},Object.defineProperties(Zu,Yu);var $u=function(){};$u.prototype.interfaces_=function(){return[]},$u.prototype.getClass=function(){return $u},$u.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),o=0;o<i;o++)n.setOrdinate(r,o,t.getOrdinate(e,o))},$u.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,Sc.X)===t.getOrdinate(e-1,Sc.X)&&t.getOrdinate(0,Sc.Y)===t.getOrdinate(e-1,Sc.Y)},$u.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var r=Math.min(t.getDimension(),e.getDimension()),i=0;i<n;i++)for(var o=0;o<r;o++){var a=t.getOrdinate(i,o),s=e.getOrdinate(i,o);if(t.getOrdinate(i,o)!==e.getOrdinate(i,o)&&(!rc.isNaN(a)||!rc.isNaN(s)))return!1}return!0},$u.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if($u.copy(e,0,r,0,i),i>0)for(var o=i;o<n;o++)$u.copy(e,i-1,r,o,1);return r},$u.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)$u.swap(t,r,e-r)},$u.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}},$u.copy=function(t,e,n,r,i){for(var o=0;o<i;o++)$u.copyCoord(t,e+o,n,r+o)},$u.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),r=new vc;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var o=0;o<n;o++)o>0&&r.append(","),r.append(Zu.toString(t.getOrdinate(i,o)))}return r.append(")"),r.toString()}},$u.ensureValidRing=function(t,e){var n=e.size();return 0===n?e:n<=3?$u.createClosedRing(t,e,4):e.getOrdinate(0,Sc.X)===e.getOrdinate(n-1,Sc.X)&&e.getOrdinate(0,Sc.Y)===e.getOrdinate(n-1,Sc.Y)?e:$u.createClosedRing(t,e,n+1)},$u.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();$u.copy(e,0,r,0,i);for(var o=i;o<n;o++)$u.copy(e,0,r,o,1);return r};var Ju=function(t){function e(e,n){t.call(this,n),this._points=null,this.init(e)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Pc:this._points.expandEnvelope(new Pc)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n;if(this._points.size()!==i._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!e.equal(e._points.getCoordinate(o),i._points.getCoordinate(o),r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=this,e=0;e<Math.trunc(this._points.size()/2);e++){var n=t._points.size()-1-e;if(!t._points.getCoordinate(e).equals(t._points.getCoordinate(n)))return t._points.getCoordinate(e).compareTo(t._points.getCoordinate(n))>0&&$u.reverse(t._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Du.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return qc.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return $u.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=e,r=0,i=0;r<this._points.size()&&i<n._points.size();){var o=t._points.getCoordinate(r).compareTo(n._points.getCoordinate(i));if(0!==o)return o;r++,i++}return r<this._points.size()?1:i<n._points.size()?-1:0}if(2===arguments.length){var a=arguments[0],s=arguments[1],l=a;return s.compare(this._points,l._points)}},e.prototype.apply=function(){var t=this;if(mc(arguments[0],Kc))for(var e=arguments[0],n=0;n<this._points.size();n++)e.filter(t._points.getCoordinate(n));else if(mc(arguments[0],Fu)){var r=arguments[0];if(0===this._points.size())return null;for(var i=0;i<this._points.size()&&(r.filter(t._points,i),!r.isDone());i++);r.isGeometryChanged()&&this.geometryChanged()}else if(mc(arguments[0],ku)){var o=arguments[0];o.filter(this)}else if(mc(arguments[0],Zc)){var a=arguments[0];a.filter(this)}},e.prototype.getBoundary=function(){return new Uu(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new nc("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Lu]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(Yc),Ku=function(){};Ku.prototype.interfaces_=function(){return[]},Ku.prototype.getClass=function(){return Ku};var Qu=function(t){function e(e,n){t.call(this,n),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Pc;var t=new Pc;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),n))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Du.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var n=arguments[0],r=arguments[1],i=n;return r.compare(this._coordinates,i._coordinates)}},e.prototype.apply=function(){if(mc(arguments[0],Kc)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(mc(arguments[0],Fu)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else if(mc(arguments[0],ku)){var n=arguments[0];n.filter(this)}else if(mc(arguments[0],Zc)){var r=arguments[0];r.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),Uc.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Ku]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,n),e}(Yc),th=function(){};th.prototype.interfaces_=function(){return[]},th.prototype.getClass=function(){return th};var eh=function(t){function e(e,n,r){if(t.call(this,r),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===n&&(n=[]),t.hasNullElements(n))throw new nc("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(n))throw new nc("shell is empty but holes are not");this._shell=e,this._holes=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this._shell.getCoordinates(),r=0;r<n.length;r++)t[++e]=n[r];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),a=0;a<o.length;a++)t[++e]=o[a];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(qc.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(qc.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){var r=t.getX(n);if(r!==e.getMinX()&&r!==e.getMaxX())return!1;var i=t.getY(n);if(i!==e.getMinY()&&i!==e.getMaxY())return!1}for(var o=t.getX(0),a=t.getY(0),s=1;s<=4;s++){var l=t.getX(s),c=t.getY(s);if(l!==o===(c!==a))return!1;o=l,a=c}return!0},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var n=arguments[0],r=arguments[1];if(!this.isEquivalentClass(n))return!1;var i=n,o=this._shell,a=i._shell;if(!o.equalsExact(a,r))return!1;if(this._holes.length!==i._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!e._holes[s].equalsExact(i._holes[s],r))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var t=this;if(0===arguments.length){this.normalize(this._shell,!0);for(var e=0;e<this._holes.length;e++)t.normalize(t._holes[e],!1);Ou.sort(this._holes)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];if(n.isEmpty())return null;var i=new Array(n.getCoordinates().length-1).fill(null);Lc.arraycopy(n.getCoordinates(),0,i,0,i.length);var o=du.minCoordinate(n.getCoordinates());du.scroll(i,o),Lc.arraycopy(i,0,n.getCoordinates(),0,i.length),n.getCoordinates()[i.length]=i[0],qc.isCCW(n.getCoordinates())===r&&du.reverse(n.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=this._shell,r=e._shell;return n.compareToSameClass(r)}if(2===arguments.length){var i=arguments[0],o=arguments[1],a=i,s=this._shell,l=a._shell,c=s.compareToSameClass(l,o);if(0!==c)return c;for(var u=this.getNumInteriorRing(),h=a.getNumInteriorRing(),p=0;p<u&&p<h;){var d=t.getInteriorRingN(p),f=a.getInteriorRingN(p),m=d.compareToSameClass(f,o);if(0!==m)return m;p++}return p<u?1:p<h?-1:0}},e.prototype.apply=function(t){var e=this;if(mc(t,Kc)){this._shell.apply(t);for(var n=0;n<this._holes.length;n++)e._holes[n].apply(t)}else if(mc(t,Fu)){if(this._shell.apply(t),!t.isDone())for(var r=0;r<this._holes.length&&(e._holes[r].apply(t),!t.isDone());r++);t.isGeometryChanged()&&this.geometryChanged()}else if(mc(t,ku))t.filter(this);else if(mc(t,Zc)){t.filter(this),this._shell.apply(t);for(var i=0;i<this._holes.length;i++)e._holes[i].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var n=0;n<this._holes.length;n++)e._holes[n]=this._holes[n].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),n=new Array(this._holes.length).fill(null),r=0;r<n.length;r++)n[r]=this._holes[r].copy();return new e(t,n,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[th]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(Yc),nh=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Yc.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Du.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Ku]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,n),e}(zu),rh=function(t){function e(e,n){e instanceof cc&&n instanceof _h&&(e=n.getCoordinateSequenceFactory().create(e)),t.call(this,e,n),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Yc.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Du.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return $u.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new nc("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new nc("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(Ju),ih=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Yc.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new uu,e=0;e<this._geometries.length;e++)for(var n=this._geometries[e].getBoundary(),r=0;r<n.getNumGeometries();r++)t.add(n.getGeometryN(r));var i=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(i))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[th]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(zu),oh=function(t){this._factory=t||null,this._isUserDataCopied=!1},ah={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};oh.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},oh.prototype.edit=function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n},oh.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof zu?this.editGeometryCollection(t,e):t instanceof eh?this.editPolygon(t,e):t instanceof Qu||t instanceof Ju?e.edit(t,this._factory):(Uc.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},oh.prototype.editGeometryCollection=function(t,e){for(var n=e.edit(t,this._factory),r=new uu,i=0;i<n.getNumGeometries();i++){var o=this.edit(n.getGeometryN(i),e);null===o||o.isEmpty()||r.add(o)}return n.getClass()===nh?this._factory.createMultiPoint(r.toArray([])):n.getClass()===Bu?this._factory.createMultiLineString(r.toArray([])):n.getClass()===ih?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},oh.prototype.editPolygon=function(t,e){var n=e.edit(t,this._factory);if(null===n&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var r=this.edit(n.getExteriorRing(),e);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var i=new uu,o=0;o<n.getNumInteriorRing();o++){var a=this.edit(n.getInteriorRingN(o),e);null===a||a.isEmpty()||i.add(a)}return this._factory.createPolygon(r,i.toArray([]))},oh.prototype.interfaces_=function(){return[]},oh.prototype.getClass=function(){return oh},oh.GeometryEditorOperation=function(){},ah.NoOpGeometryOperation.get=function(){return sh},ah.CoordinateOperation.get=function(){return lh},ah.CoordinateSequenceOperation.get=function(){return ch},Object.defineProperties(oh,ah);var sh=function(){};sh.prototype.edit=function(t,e){return t},sh.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},sh.prototype.getClass=function(){return sh};var lh=function(){};lh.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return null===n?t:t instanceof rh?e.createLinearRing(n):t instanceof Ju?e.createLineString(n):t instanceof Qu?n.length>0?e.createPoint(n[0]):e.createPoint():t},lh.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},lh.prototype.getClass=function(){return lh};var ch=function(){};ch.prototype.edit=function(t,e){return t instanceof rh?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Ju?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Qu?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},ch.prototype.interfaces_=function(){return[oh.GeometryEditorOperation]},ch.prototype.getClass=function(){return ch};var uh=function(){var t=this;if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)t._coordinates[n]=new cc}else if(mc(arguments[0],Sc)){var r=arguments[0];if(null===r)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)t._coordinates[i]=r.getCoordinateCopy(i)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],a=arguments[1];this._coordinates=o,this._dimension=a,null===o&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],l=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=l;for(var c=0;c<s;c++)t._coordinates[c]=new cc}},hh={serialVersionUID:{configurable:!0}};uh.prototype.setOrdinate=function(t,e,n){switch(e){case Sc.X:this._coordinates[t].x=n;break;case Sc.Y:this._coordinates[t].y=n;break;case Sc.Z:this._coordinates[t].z=n;break;default:throw new nc("invalid ordinateIndex")}},uh.prototype.size=function(){return this._coordinates.length},uh.prototype.getOrdinate=function(t,e){switch(e){case Sc.X:return this._coordinates[t].x;case Sc.Y:return this._coordinates[t].y;case Sc.Z:return this._coordinates[t].z}return rc.NaN},uh.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}},uh.prototype.getCoordinateCopy=function(t){return new cc(this._coordinates[t])},uh.prototype.getDimension=function(){return this._dimension},uh.prototype.getX=function(t){return this._coordinates[t].x},uh.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new uh(t,this._dimension)},uh.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},uh.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new uh(t,this._dimension)},uh.prototype.toString=function(){if(this._coordinates.length>0){var t=new vc(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},uh.prototype.getY=function(t){return this._coordinates[t].y},uh.prototype.toCoordinateArray=function(){return this._coordinates},uh.prototype.interfaces_=function(){return[Sc,lc]},uh.prototype.getClass=function(){return uh},hh.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(uh,hh);var ph=function(){},dh={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ph.prototype.readResolve=function(){return ph.instance()},ph.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new uh(t)}if(mc(arguments[0],Sc)){var e=arguments[0];return new uh(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new uh(n):new uh(n,r)}},ph.prototype.interfaces_=function(){return[pc,lc]},ph.prototype.getClass=function(){return ph},ph.instance=function(){return ph.instanceObject},dh.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},dh.instanceObject.get=function(){return new ph},Object.defineProperties(ph,dh);var fh=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new uu,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},e.prototype.entrySet=function(){var t=new bu;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(yu),mh=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof yh){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},gh={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};mh.prototype.equals=function(t){if(!(t instanceof mh))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},mh.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new _c(n).compareTo(new _c(r))},mh.prototype.getScale=function(){return this._scale},mh.prototype.isFloating=function(){return this._modelType===mh.FLOATING||this._modelType===mh.FLOATING_SINGLE},mh.prototype.getType=function(){return this._modelType},mh.prototype.toString=function(){var t="UNKNOWN";return this._modelType===mh.FLOATING?t="Floating":this._modelType===mh.FLOATING_SINGLE?t="Floating-Single":this._modelType===mh.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},mh.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return rc.isNaN(t)||this._modelType===mh.FLOATING_SINGLE?t:this._modelType===mh.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof cc){var e=arguments[0];if(this._modelType===mh.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},mh.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===mh.FLOATING?t=16:this._modelType===mh.FLOATING_SINGLE?t=6:this._modelType===mh.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},mh.prototype.setScale=function(t){this._scale=Math.abs(t)},mh.prototype.interfaces_=function(){return[lc,oc]},mh.prototype.getClass=function(){return mh},mh.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},gh.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},gh.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(mh,gh);var yh=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},vh={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};yh.prototype.readResolve=function(){return yh.nameToTypeMap.get(this._name)},yh.prototype.toString=function(){return this._name},yh.prototype.interfaces_=function(){return[lc]},yh.prototype.getClass=function(){return yh},vh.serialVersionUID.get=function(){return-552860263173159e4},vh.nameToTypeMap.get=function(){return new fh},Object.defineProperties(yh,vh),mh.Type=yh,mh.FIXED=new yh("FIXED"),mh.FLOATING=new yh("FLOATING"),mh.FLOATING_SINGLE=new yh("FLOATING SINGLE");var _h=function t(){this._precisionModel=new mh,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?mc(arguments[0],pc)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof mh&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},xh={serialVersionUID:{configurable:!0}};_h.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new cc(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new cc(t.getMinX(),t.getMinY()),new cc(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new cc(t.getMinX(),t.getMinY()),new cc(t.getMinX(),t.getMaxY()),new cc(t.getMaxX(),t.getMaxY()),new cc(t.getMaxX(),t.getMinY()),new cc(t.getMinX(),t.getMinY())]),null)},_h.prototype.createLineString=function(t){return t?t instanceof Array?new Ju(this.getCoordinateSequenceFactory().create(t),this):mc(t,Sc)?new Ju(t,this):void 0:new Ju(this.getCoordinateSequenceFactory().create([]),this)},_h.prototype.createMultiLineString=function(){if(0===arguments.length)return new Bu(null,this);if(1===arguments.length){var t=arguments[0];return new Bu(t,this)}},_h.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var o=i.next(),a=o.getClass();null===e&&(e=a),a!==e&&(n=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===e)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(_h.toGeometryArray(t));var s=t.iterator().next();if(t.size()>1){if(s instanceof eh)return this.createMultiPolygon(_h.toPolygonArray(t));if(s instanceof Ju)return this.createMultiLineString(_h.toLineStringArray(t));if(s instanceof Qu)return this.createMultiPoint(_h.toPointArray(t));Uc.shouldNeverReachHere("Unhandled class: "+s.getClass().getName())}return s},_h.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},_h.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof cc){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(mc(arguments[0],Sc)){var e=arguments[0];return new Qu(e,this)}}},_h.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},_h.prototype.createPolygon=function(){if(0===arguments.length)return new eh(null,null,this);if(1===arguments.length){if(mc(arguments[0],Sc)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof rh){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];return new eh(r,i,this)}},_h.prototype.getSRID=function(){return this._SRID},_h.prototype.createGeometryCollection=function(){if(0===arguments.length)return new zu(null,this);if(1===arguments.length){var t=arguments[0];return new zu(t,this)}},_h.prototype.createGeometry=function(t){return new oh(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},_h.prototype.getPrecisionModel=function(){return this._precisionModel},_h.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(mc(arguments[0],Sc)){var e=arguments[0];return new rh(e,this)}}},_h.prototype.createMultiPolygon=function(){if(0===arguments.length)return new ih(null,this);if(1===arguments.length){var t=arguments[0];return new ih(t,this)}},_h.prototype.createMultiPoint=function(){var t=this;if(0===arguments.length)return new nh(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new nh(e,this)}if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(null!==n?this.getCoordinateSequenceFactory().create(n):null)}if(mc(arguments[0],Sc)){var r=arguments[0];if(null===r)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(r.size()).fill(null),o=0;o<r.size();o++){var a=t.getCoordinateSequenceFactory().create(1,r.getDimension());$u.copy(r,o,a,0,1),i[o]=t.createPoint(a)}return this.createMultiPoint(i)}}},_h.prototype.interfaces_=function(){return[lc]},_h.prototype.getClass=function(){return _h},_h.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.getDefaultCoordinateSequenceFactory=function(){return ph.instance()},_h.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},xh.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(_h,xh);var bh=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],wh=function(t){this.geometryFactory=t||new _h};wh.prototype.read=function(t){var e,n=(e="string"==typeof t?JSON.parse(t):t).type;if(!Mh[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==bh.indexOf(n)?Mh[n].apply(this,[e.coordinates]):"GeometryCollection"===n?Mh[n].apply(this,[e.geometries]):Mh[n].apply(this,[e])},wh.prototype.write=function(t){var e=t.getGeometryType();if(!Eh[e])throw new Error("Geometry is not supported");return Eh[e].apply(this,[t])};var Mh={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!Mh[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=Mh.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new cc(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new cc(t[0],t[1]),new cc(t[2],t[1]),new cc(t[2],t[3]),new cc(t[0],t[3]),new cc(t[0],t[1])])},Point:function(t){var e=new cc(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Mh.Point.apply(this,[t[n]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=Mh.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Mh.LineString.apply(this,[t[n]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=Mh.coordinates.apply(this,[t[0]]),n=this.geometryFactory.createLinearRing(e),r=[],i=1;i<t.length;++i){var o=t[i],a=Mh.coordinates.apply(this,[o]),s=this.geometryFactory.createLinearRing(a);r.push(s)}return this.geometryFactory.createPolygon(n,r)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(Mh.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(this.read(r))}return this.geometryFactory.createGeometryCollection(e)}},Eh={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:Eh.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=Eh.Point.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),r=0;r<n.length;++r){var i=n[r];e.push(Eh.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=Eh.LineString.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=Eh.LineString.apply(this,[t._shell]);e.push(n.coordinates);for(var r=0;r<t._holes.length;++r){var i=t._holes[r],o=Eh.LineString.apply(this,[i]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=Eh.Polygon.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=r.getGeometryType();e.push(Eh[i].apply(this,[r]))}return{type:"GeometryCollection",geometries:e}}},Sh=function(t){this.geometryFactory=t||new _h,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new wh(this.geometryFactory)};Sh.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===mh.FIXED&&this.reducePrecision(e),e},Sh.prototype.reducePrecision=function(t){var e,n;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,n=t.points.length;e<n;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,n=t.geometries.length;e<n;e++)this.reducePrecision(t.geometries[e])};var Th=function(){this.parser=new wh(this.geometryFactory)};Th.prototype.write=function(t){return this.parser.write(t)};var Ah=function(){},Ch={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function Lh(t){this.message=t||""}function Ih(){this.array_=[]}Ah.prototype.interfaces_=function(){return[]},Ah.prototype.getClass=function(){return Ah},Ah.opposite=function(t){return t===Ah.LEFT?Ah.RIGHT:t===Ah.RIGHT?Ah.LEFT:t},Ch.ON.get=function(){return 0},Ch.LEFT.get=function(){return 1},Ch.RIGHT.get=function(){return 2},Object.defineProperties(Ah,Ch),Lh.prototype=new Error,Lh.prototype.name="EmptyStackException",Ih.prototype=new lu,Ih.prototype.add=function(t){return this.array_.push(t),!0},Ih.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},Ih.prototype.push=function(t){return this.array_.push(t),t},Ih.prototype.pop=function(t){if(0===this.array_.length)throw new Lh;return this.array_.pop()},Ih.prototype.peek=function(){if(0===this.array_.length)throw new Lh;return this.array_[this.array_.length-1]},Ih.prototype.empty=function(){return 0===this.array_.length},Ih.prototype.isEmpty=function(){return this.empty()},Ih.prototype.search=function(t){return this.array_.indexOf(t)},Ih.prototype.size=function(){return this.array_.length},Ih.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t};var Ph=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ph.prototype.getCoordinate=function(){return this._minCoord},Ph.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n},Ph.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();Uc.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=qc.computeOrientation(this._minCoord,n,e),i=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===qc.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===qc.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)},Ph.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge().getCoordinates();if(e<0||e+1>=n.length)return-1;if(n[e].y===n[e+1].y)return-1;var r=Ah.LEFT;return n[e].y<n[e+1].y&&(r=Ah.RIGHT),r},Ph.prototype.getEdge=function(){return this._orientedDe},Ph.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(null===e._minCoord||n[r].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=r,e._minCoord=n[r])},Ph.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Ph.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}Uc.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ah.LEFT&&(this._orientedDe=this._minDe.getSym())},Ph.prototype.interfaces_=function(){return[]},Ph.prototype.getClass=function(){return Ph};var Rh=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new cc(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(zc),Oh=function(){this.array_=[]};Oh.prototype.addLast=function(t){this.array_.push(t)},Oh.prototype.removeFirst=function(){return this.array_.shift()},Oh.prototype.isEmpty=function(){return 0===this.array_.length};var Dh=function(){this._finder=null,this._dirEdgeList=new uu,this._nodes=new uu,this._rightMostCoord=null,this._env=null,this._finder=new Ph};Dh.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},Dh.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Dh.prototype.computeNodeDepth=function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();){var r=n.next();if(r.isVisited()||r.getSym().isVisited()){e=r;break}}if(null===e)throw new Rh("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var i=t.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},Dh.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Ah.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Dh.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Dh.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Ah.RIGHT)>=1&&e.getDepth(Ah.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Dh.prototype.computeDepths=function(t){var e=new bu,n=new Oh,r=t.getNode();for(n.addLast(r),e.add(r),t.setVisited(!0);!n.isEmpty();){var i=n.removeFirst();e.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var a=o.next().getSym();if(!a.isVisited()){var s=a.getNode();e.contains(s)||(n.addLast(s),e.add(s))}}}},Dh.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},Dh.prototype.getEnvelope=function(){if(null===this._env){for(var t=new Pc,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next().getEdge().getCoordinates(),r=0;r<n.length-1;r++)t.expandToInclude(n[r]);this._env=t}return this._env},Dh.prototype.addReachable=function(t){var e=new Ih;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}},Dh.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Ah.LEFT,t.getDepth(Ah.RIGHT)),e.setDepth(Ah.RIGHT,t.getDepth(Ah.LEFT))},Dh.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var r=n.next();this._dirEdgeList.add(r);var i=r.getSym().getNode();i.isVisited()||e.push(i)}},Dh.prototype.getNodes=function(){return this._nodes},Dh.prototype.getDirectedEdges=function(){return this._dirEdgeList},Dh.prototype.interfaces_=function(){return[oc]},Dh.prototype.getClass=function(){return Dh};var Nh=function t(){var e=this;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[Ah.ON]=r}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),null!==i)for(var o=0;o<this.location.length;o++)e.location[o]=i.location[o]}}else if(3===arguments.length){var a=arguments[0],s=arguments[1],l=arguments[2];this.init(3),this.location[Ah.ON]=a,this.location[Ah.LEFT]=s,this.location[Ah.RIGHT]=l}};Nh.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Nh.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==dc.NONE)return!1;return!0},Nh.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===dc.NONE&&(this.location[e]=t)},Nh.prototype.isLine=function(){return 1===this.location.length},Nh.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Ah.ON]=this.location[Ah.ON],e[Ah.LEFT]=dc.NONE,e[Ah.RIGHT]=dc.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===dc.NONE&&n<t.location.length&&(this.location[n]=t.location[n])},Nh.prototype.getLocations=function(){return this.location},Nh.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Ah.LEFT];this.location[Ah.LEFT]=this.location[Ah.RIGHT],this.location[Ah.RIGHT]=t},Nh.prototype.toString=function(){var t=new vc;return this.location.length>1&&t.append(dc.toLocationSymbol(this.location[Ah.LEFT])),t.append(dc.toLocationSymbol(this.location[Ah.ON])),this.location.length>1&&t.append(dc.toLocationSymbol(this.location[Ah.RIGHT])),t.toString()},Nh.prototype.setLocations=function(t,e,n){this.location[Ah.ON]=t,this.location[Ah.LEFT]=e,this.location[Ah.RIGHT]=n},Nh.prototype.get=function(t){return t<this.location.length?this.location[t]:dc.NONE},Nh.prototype.isArea=function(){return this.location.length>1},Nh.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===dc.NONE)return!0;return!1},Nh.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Ah.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}},Nh.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(dc.NONE)},Nh.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Nh.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Nh.prototype.interfaces_=function(){return[]},Nh.prototype.getClass=function(){return Nh};var kh=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Nh(e),this.elt[1]=new Nh(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Nh(n.elt[0]),this.elt[1]=new Nh(n.elt[1])}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.elt[0]=new Nh(dc.NONE),this.elt[1]=new Nh(dc.NONE),this.elt[r].setLocation(i)}else if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];this.elt[0]=new Nh(o,a,s),this.elt[1]=new Nh(o,a,s)}else if(4===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2],h=arguments[3];this.elt[0]=new Nh(dc.NONE,dc.NONE,dc.NONE),this.elt[1]=new Nh(dc.NONE,dc.NONE,dc.NONE),this.elt[l].setLocations(c,u,h)}};kh.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},kh.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},kh.prototype.isNull=function(t){return this.elt[t].isNull()},kh.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}},kh.prototype.isLine=function(t){return this.elt[t].isLine()},kh.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)null===e.elt[n]&&null!==t.elt[n]?e.elt[n]=new Nh(t.elt[n]):e.elt[n].merge(t.elt[n])},kh.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},kh.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Ah.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}},kh.prototype.toString=function(){var t=new vc;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},kh.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},kh.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},kh.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Ah.ON,e)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}},kh.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},kh.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},kh.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Nh(this.elt[t].location[0]))},kh.prototype.interfaces_=function(){return[]},kh.prototype.getClass=function(){return kh},kh.toLineLabel=function(t){for(var e=new kh(dc.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var Fh=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new uu,this._pts=new uu,this._label=new kh(dc.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new uu,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Fh.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=qc.isCCW(this._ring.getCoordinates())},Fh.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Fh.prototype.computePoints=function(t){var e=this;this._startDe=t;var n=t,r=!0;do{if(null===n)throw new Rh("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new Rh("Directed Edge visited twice during ring-building at "+n.getCoordinate());e._edges.add(n);var i=n.getLabel();Uc.isTrue(i.isArea()),e.mergeLabel(i),e.addPoints(n.getEdge(),n.isForward(),r),r=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this._startDe)},Fh.prototype.getLinearRing=function(){return this._ring},Fh.prototype.getCoordinate=function(t){return this._pts.get(t)},Fh.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode().getEdges().getOutgoingDegree(t);n>t._maxNodeDegree&&(t._maxNodeDegree=n),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},Fh.prototype.addPoints=function(t,e,n){var r=t.getCoordinates();if(e){var i=1;n&&(i=0);for(var o=i;o<r.length;o++)this._pts.add(r[o])}else{var a=r.length-2;n&&(a=r.length-1);for(var s=a;s>=0;s--)this._pts.add(r[s])}},Fh.prototype.isHole=function(){return this._isHole},Fh.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},Fh.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!qc.isPointInRing(t,e.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(t))return!1;return!0},Fh.prototype.addHole=function(t){this._holes.add(t)},Fh.prototype.isShell=function(){return null===this._shell},Fh.prototype.getLabel=function(){return this._label},Fh.prototype.getEdges=function(){return this._edges},Fh.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Fh.prototype.getShell=function(){return this._shell},Fh.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=e.getLocation(n,Ah.RIGHT);if(r===dc.NONE)return null;if(this._label.getLocation(n)===dc.NONE)return this._label.setLocation(n,r),null}},Fh.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},Fh.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)e[n]=this._holes.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},Fh.prototype.interfaces_=function(){return[]},Fh.prototype.getClass=function(){return Fh};var zh=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Fh),Bh=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new uu,e=this._startDe;do{if(null===e.getMinEdgeRing()){var n=new zh(e,this._geometryFactory);t.add(n)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Fh),Uh=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Uh.prototype.setVisited=function(t){this._isVisited=t},Uh.prototype.setInResult=function(t){this._isInResult=t},Uh.prototype.isCovered=function(){return this._isCovered},Uh.prototype.isCoveredSet=function(){return this._isCoveredSet},Uh.prototype.setLabel=function(t){this._label=t},Uh.prototype.getLabel=function(){return this._label},Uh.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Uh.prototype.updateIM=function(t){Uc.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Uh.prototype.isInResult=function(){return this._isInResult},Uh.prototype.isVisited=function(){return this._isVisited},Uh.prototype.interfaces_=function(){return[]},Uh.prototype.getClass=function(){return Uh};var jh=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],n=arguments[1];this._coord=e,this._edges=n,this._label=new kh(0,dc.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var n=dc.NONE;if(n=this._label.getLocation(e),!t.isNull(e)){var r=t.getLocation(e);n!==dc.BOUNDARY&&(n=r)}return n},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],n=arguments[1];null===this._label?this._label=new kh(e,n):this._label.setLocation(e,n)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var t=this;if(arguments[0]instanceof e){var n=arguments[0];this.mergeLabel(n._label)}else if(arguments[0]instanceof kh)for(var r=arguments[0],i=0;i<2;i++){var o=t.computeMergedLocation(r,i),a=t._label.getLocation(i);a===dc.NONE&&t._label.setLocation(i,o)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=dc.NONE;null!==this._label&&(e=this._label.getLocation(t));var n=null;switch(e){case dc.BOUNDARY:n=dc.INTERIOR;break;case dc.INTERIOR:default:n=dc.BOUNDARY}this._label.setLocation(t,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Uh),Gh=function(){this.nodeMap=new Cu,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Gh.prototype.find=function(t){return this.nodeMap.get(t)},Gh.prototype.addNode=function(){if(arguments[0]instanceof cc){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof jh){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return null===r?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}},Gh.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},Gh.prototype.iterator=function(){return this.nodeMap.values().iterator()},Gh.prototype.values=function(){return this.nodeMap.values()},Gh.prototype.getBoundaryNodes=function(t){for(var e=new uu,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===dc.BOUNDARY&&e.add(r)}return e},Gh.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Gh.prototype.interfaces_=function(){return[]},Gh.prototype.getClass=function(){return Gh};var Vh=function(){},Hh={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Vh.prototype.interfaces_=function(){return[]},Vh.prototype.getClass=function(){return Vh},Vh.isNorthern=function(t){return t===Vh.NE||t===Vh.NW},Vh.isOpposite=function(t,e){return t!==e&&2===(t-e+4)%4},Vh.commonHalfPlane=function(t,e){if(t===e)return t;if(2===(t-e+4)%4)return-1;var n=t<e?t:e;return 0===n&&3===(t>e?t:e)?3:n},Vh.isInHalfPlane=function(t,e){return e===Vh.SE?t===Vh.SE||t===Vh.SW:t===e||t===e+1},Vh.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new nc("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Vh.NE:Vh.SE:e>=0?Vh.NW:Vh.SW}if(arguments[0]instanceof cc&&arguments[1]instanceof cc){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new nc("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Vh.NE:Vh.SE:r.y>=n.y?Vh.NW:Vh.SW}},Hh.NE.get=function(){return 0},Hh.NW.get=function(){return 1},Hh.SW.get=function(){return 2},Hh.SE.get=function(){return 3},Object.defineProperties(Vh,Hh);var Wh=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=null;this._edge=e,this.init(n,r),this._label=i}else if(4===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2],l=arguments[3];this._edge=o,this.init(a,s),this._label=l}};Wh.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:qc.computeOrientation(t._p0,t._p1,this._p1)},Wh.prototype.getDy=function(){return this._dy},Wh.prototype.getCoordinate=function(){return this._p0},Wh.prototype.setNode=function(t){this._node=t},Wh.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},Wh.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},Wh.prototype.getDirectedCoordinate=function(){return this._p1},Wh.prototype.getDx=function(){return this._dx},Wh.prototype.getLabel=function(){return this._label},Wh.prototype.getEdge=function(){return this._edge},Wh.prototype.getQuadrant=function(){return this._quadrant},Wh.prototype.getNode=function(){return this._node},Wh.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},Wh.prototype.computeLabel=function(t){},Wh.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Vh.quadrant(this._dx,this._dy),Uc.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Wh.prototype.interfaces_=function(){return[oc]},Wh.prototype.getClass=function(){return Wh};var qh=function(t){function e(){var e=arguments[0],n=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var r=e.getNumPoints()-1;this.init(e.getCoordinate(r),e.getCoordinate(r-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new kh(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Rh("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=this,e=!0,n=0;n<2;n++)t._label.isArea(n)&&t._label.getLocation(n,Ah.LEFT)===dc.INTERIOR&&t._label.getLocation(n,Ah.RIGHT)===dc.INTERIOR||(e=!1);return e},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Ah.LEFT]+"/"+this._depth[Ah.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,dc.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,dc.EXTERIOR);return t&&e&&n},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var r=1;t===Ah.LEFT&&(r=-1);var i=Ah.opposite(t),o=e+n*r;this.setDepth(t,e),this.setDepth(i,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===dc.EXTERIOR&&e===dc.INTERIOR?1:t===dc.INTERIOR&&e===dc.EXTERIOR?-1:0},e}(Wh),Xh=function(){};Xh.prototype.createNode=function(t){return new jh(t,null)},Xh.prototype.interfaces_=function(){return[]},Xh.prototype.getClass=function(){return Xh};var Zh=function(){if(this._edges=new uu,this._nodes=null,this._edgeEndList=new uu,0===arguments.length)this._nodes=new Gh(new Xh);else if(1===arguments.length){var t=arguments[0];this._nodes=new Gh(t)}};Zh.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var n=this._edges.get(e);n.print(t),n.eiList.print(t)}},Zh.prototype.find=function(t){return this._nodes.find(t)},Zh.prototype.addNode=function(){if(arguments[0]instanceof jh){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof cc){var e=arguments[0];return this._nodes.addNode(e)}},Zh.prototype.getNodeIterator=function(){return this._nodes.iterator()},Zh.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},Zh.prototype.debugPrintln=function(t){Lc.out.println(t)},Zh.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(null===n)return!1;var r=n.getLabel();return null!==r&&r.getLocation(t)===dc.BOUNDARY},Zh.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},Zh.prototype.matchInSameDirection=function(t,e,n,r){return!!t.equals(n)&&qc.computeOrientation(t,e,r)===qc.COLLINEAR&&Vh.quadrant(t,e)===Vh.quadrant(n,r)},Zh.prototype.getEdgeEnds=function(){return this._edgeEndList},Zh.prototype.debugPrint=function(t){Lc.out.print(t)},Zh.prototype.getEdgeIterator=function(){return this._edges.iterator()},Zh.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),o=i.getCoordinates();if(n.matchInSameDirection(t,e,o[0],o[1]))return i;if(n.matchInSameDirection(t,e,o[o.length-1],o[o.length-2]))return i}return null},Zh.prototype.insertEdge=function(t){this._edges.add(t)},Zh.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},Zh.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();e._edges.add(r);var i=new qh(r,!0),o=new qh(r,!1);i.setSym(o),o.setSym(i),e.add(i),e.add(o)}},Zh.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Zh.prototype.getNodes=function(){return this._nodes.values()},Zh.prototype.findEdge=function(t,e){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(t.equals(i[0])&&e.equals(i[1]))return r}return null},Zh.prototype.interfaces_=function(){return[]},Zh.prototype.getClass=function(){return Zh},Zh.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var Yh=function(){this._geometryFactory=null,this._shellList=new uu;var t=arguments[0];this._geometryFactory=t};Yh.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}},Yh.prototype.computePolygons=function(t){for(var e=new uu,n=t.iterator();n.hasNext();){var r=n.next().toPolygon(this._geometryFactory);e.add(r)}return e},Yh.prototype.placeFreeHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();if(null===r.getShell()){var i=this.findEdgeRingContaining(r,t);if(null===i)throw new Rh("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(i)}}},Yh.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=new uu,i=t.iterator();i.hasNext();){var o=i.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var a=o.buildMinimalRings(),s=this.findShell(a);null!==s?(this.placePolygonHoles(s,a),e.add(s)):n.addAll(a)}else r.add(o)}return r},Yh.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},Yh.prototype.buildMaximalEdgeRings=function(t){for(var e=new uu,n=t.iterator();n.hasNext();){var r=n.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var i=new Bh(r,this._geometryFactory);e.add(i),i.setInResult()}}return e},Yh.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}},Yh.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Yh.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),o=null,a=null,s=e.iterator();s.hasNext();){var l=s.next(),c=l.getLinearRing(),u=c.getEnvelopeInternal();null!==o&&(a=o.getLinearRing().getEnvelopeInternal());var h=!1;u.contains(r)&&qc.isPointInRing(i,c.getCoordinates())&&(h=!0),h&&(null===o||a.contains(u))&&(o=l)}return o},Yh.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return Uc.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n},Yh.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Zh.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new uu,o=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(o,this._shellList,i),this.placeFreeHoles(this._shellList,i)}},Yh.prototype.interfaces_=function(){return[]},Yh.prototype.getClass=function(){return Yh};var $h=function(){};$h.prototype.getBounds=function(){},$h.prototype.interfaces_=function(){return[]},$h.prototype.getClass=function(){return $h};var Jh=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Jh.prototype.getItem=function(){return this._item},Jh.prototype.getBounds=function(){return this._bounds},Jh.prototype.interfaces_=function(){return[$h,lc]},Jh.prototype.getClass=function(){return Jh};var Kh=function(){this._size=null,this._items=null,this._size=0,this._items=new uu,this._items.add(null)};Kh.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Kh.prototype.size=function(){return this._size},Kh.prototype.reorder=function(t){for(var e=this,n=null,r=this._items.get(t);2*t<=this._size&&((n=2*t)!==e._size&&e._items.get(n+1).compareTo(e._items.get(n))<0&&n++,e._items.get(n).compareTo(r)<0);t=n)e._items.set(t,e._items.get(n));this._items.set(t,r)},Kh.prototype.clear=function(){this._size=0,this._items.clear()},Kh.prototype.isEmpty=function(){return 0===this._size},Kh.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},Kh.prototype.interfaces_=function(){return[]},Kh.prototype.getClass=function(){return Kh};var Qh=function(){};Qh.prototype.visitItem=function(t){},Qh.prototype.interfaces_=function(){return[]},Qh.prototype.getClass=function(){return Qh};var tp=function(){};tp.prototype.insert=function(t,e){},tp.prototype.remove=function(t,e){},tp.prototype.query=function(){},tp.prototype.interfaces_=function(){return[]},tp.prototype.getClass=function(){return tp};var ep=function(){if(this._childBoundables=new uu,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},np={serialVersionUID:{configurable:!0}};ep.prototype.getLevel=function(){return this._level},ep.prototype.size=function(){return this._childBoundables.size()},ep.prototype.getChildBoundables=function(){return this._childBoundables},ep.prototype.addChildBoundable=function(t){Uc.isTrue(null===this._bounds),this._childBoundables.add(t)},ep.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},ep.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},ep.prototype.interfaces_=function(){return[$h,lc]},ep.prototype.getClass=function(){return ep},np.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(ep,np);var rp=function(){};rp.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},rp.min=function(t){return rp.sort(t),t.get(0)},rp.sort=function(t,e){var n=t.toArray();e?Ou.sort(n,e):Ou.sort(n);for(var r=t.iterator(),i=0,o=n.length;i<o;i++)r.next(),r.set(n[i])},rp.singletonList=function(t){var e=new uu;return e.add(t),e};var ip=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};ip.prototype.expandToQueue=function(t,e){var n=ip.isComposite(this._boundable1),r=ip.isComposite(this._boundable2);if(n&&r)return ip.area(this._boundable1)>ip.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new nc("neither boundable is composite")},ip.prototype.isLeaves=function(){return!(ip.isComposite(this._boundable1)||ip.isComposite(this._boundable2))},ip.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},ip.prototype.expand=function(t,e,n,r){for(var i=t.getChildBoundables().iterator();i.hasNext();){var o=i.next(),a=new ip(o,e,this._itemDistance);a.getDistance()<r&&n.add(a)}},ip.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},ip.prototype.getDistance=function(){return this._distance},ip.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ip.prototype.interfaces_=function(){return[oc]},ip.prototype.getClass=function(){return ip},ip.area=function(t){return t.getBounds().getArea()},ip.isComposite=function(t){return t instanceof ep};var op=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new uu,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var n=arguments[0];Uc.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},ap={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};op.prototype.getNodeCapacity=function(){return this._nodeCapacity},op.prototype.lastNode=function(t){return t.get(t.size()-1)},op.prototype.size=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof ep?n+=t.size(i):i instanceof Jh&&(n+=1)}return n}},op.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Jh&&i.getItem()===e&&(n=i)}return null!==n&&(t.getChildBoundables().remove(n),!0)},op.prototype.itemsTree=function(){var t=this;if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new uu:e}if(1===arguments.length){for(var n=arguments[0],r=new uu,i=n.getChildBoundables().iterator();i.hasNext();){var o=i.next();if(o instanceof ep){var a=t.itemsTree(o);null!==a&&r.add(a)}else o instanceof Jh?r.add(o.getItem()):Uc.shouldNeverReachHere()}return r.size()<=0?null:r}},op.prototype.insert=function(t,e){Uc.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Jh(t,e))},op.prototype.boundablesAtLevel=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=new uu;return this.boundablesAtLevel(e,this._root,n),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(Uc.isTrue(r>-2),i.getLevel()===r)return o.add(i),null;for(var a=i.getChildBoundables().iterator();a.hasNext();){var s=a.next();s instanceof ep?t.boundablesAtLevel(r,s,o):(Uc.isTrue(s instanceof Jh),-1===r&&o.add(s))}return null}},op.prototype.query=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.build();var n=new uu;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,n),n}if(2===arguments.length){var r=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,i)}else if(3===arguments.length)if(mc(arguments[2],Qh)&&arguments[0]instanceof Object&&arguments[1]instanceof ep)for(var o=arguments[0],a=arguments[1],s=arguments[2],l=a.getChildBoundables(),c=0;c<l.size();c++){var u=l.get(c);t.getIntersectsOp().intersects(u.getBounds(),o)&&(u instanceof ep?t.query(o,u,s):u instanceof Jh?s.visitItem(u.getItem()):Uc.shouldNeverReachHere())}else if(mc(arguments[2],lu)&&arguments[0]instanceof Object&&arguments[1]instanceof ep)for(var h=arguments[0],p=arguments[1],d=arguments[2],f=p.getChildBoundables(),m=0;m<f.size();m++){var g=f.get(m);t.getIntersectsOp().intersects(g.getBounds(),h)&&(g instanceof ep?t.query(h,g,d):g instanceof Jh?d.add(g.getItem()):Uc.shouldNeverReachHere())}},op.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},op.prototype.getRoot=function(){return this.build(),this._root},op.prototype.remove=function(){var t=this;if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,n)}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],a=this.removeItem(i,o);if(a)return!0;for(var s=null,l=i.getChildBoundables().iterator();l.hasNext();){var c=l.next();if(t.getIntersectsOp().intersects(c.getBounds(),r)&&c instanceof ep&&(a=t.remove(r,c,o))){s=c;break}}return null!==s&&s.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(s),a}},op.prototype.createHigherLevels=function(t,e){Uc.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},op.prototype.depth=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof ep){var o=t.depth(i);o>n&&(n=o)}}return n+1}},op.prototype.createParentBoundables=function(t,e){var n=this;Uc.isTrue(!t.isEmpty());var r=new uu;r.add(this.createNode(e));var i=new uu(t);rp.sort(i,this.getComparator());for(var o=i.iterator();o.hasNext();){var a=o.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(e)),n.lastNode(r).addChildBoundable(a)}return r},op.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},op.prototype.interfaces_=function(){return[lc]},op.prototype.getClass=function(){return op},op.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},ap.IntersectsOp.get=function(){return sp},ap.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},ap.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(op,ap);var sp=function(){},lp=function(){};lp.prototype.distance=function(t,e){},lp.prototype.interfaces_=function(){return[]},lp.prototype.getClass=function(){return lp};var cp=function(t){function e(n){n=n||e.DEFAULT_NODE_CAPACITY,t.call(this,n)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(t,e){Uc.isTrue(t.length>0);for(var n=new uu,r=0;r<t.length;r++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[r],e));return n},e.prototype.createNode=function(t){return new up(t)},e.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],n=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,n)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),r=new Array(e).fill(null),i=t.iterator(),o=0;o<e;o++){r[o]=new uu;for(var a=0;i.hasNext()&&a<n;){var s=i.next();r[o].add(s),a++}}return r},e.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var n=arguments[0],r=arguments[1];t.prototype.query.call(this,n,r)}else if(3===arguments.length)if(mc(arguments[2],Qh)&&arguments[0]instanceof Object&&arguments[1]instanceof ep){var i=arguments[0],o=arguments[1],a=arguments[2];t.prototype.query.call(this,i,o,a)}else if(mc(arguments[2],lu)&&arguments[0]instanceof Object&&arguments[1]instanceof ep){var s=arguments[0],l=arguments[1],c=arguments[2];t.prototype.query.call(this,s,l,c)}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(e,n){return t.prototype.createParentBoundables.call(this,e,n)},e.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return t.prototype.remove.call(this,e,n)}return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(t,n){Uc.isTrue(!t.isEmpty());var r=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new uu(t);rp.sort(i,e.xComparator);var o=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(o,n)},e.prototype.nearestNeighbour=function(){if(1===arguments.length){if(mc(arguments[0],lp)){var t=arguments[0],n=new ip(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(n)}if(arguments[0]instanceof ip){var r=arguments[0];return this.nearestNeighbour(r,rc.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof e&&mc(arguments[1],lp)){var i=arguments[0],o=arguments[1],a=new ip(this.getRoot(),i.getRoot(),o);return this.nearestNeighbour(a)}if(arguments[0]instanceof ip&&"number"==typeof arguments[1]){var s=arguments[0],l=arguments[1],c=l,u=null,h=new Kh;for(h.add(s);!h.isEmpty()&&c>0;){var p=h.poll(),d=p.getDistance();if(d>=c)break;p.isLeaves()?(c=d,u=p):p.expandToQueue(h,c)}return[u.getBoundable(0).getItem(),u.getBoundable(1).getItem()]}}else if(3===arguments.length){var f=arguments[0],m=arguments[1],g=arguments[2],y=new Jh(f,m),v=new ip(this.getRoot(),y,g);return this.nearestNeighbour(v)[0]}},e.prototype.interfaces_=function(){return[tp,lc]},e.prototype.getClass=function(){return e},e.centreX=function(t){return e.avg(t.getMinX(),t.getMaxX())},e.avg=function(t,e){return(t+e)/2},e.centreY=function(t){return e.avg(t.getMinY(),t.getMaxY())},n.STRtreeNode.get=function(){return up},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[sc]},compare:function(n,r){return t.compareDoubles(e.centreX(n.getBounds()),e.centreX(r.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[sc]},compare:function(n,r){return t.compareDoubles(e.centreY(n.getBounds()),e.centreY(r.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(op),up=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new Pc(n.getBounds()):t.expandToInclude(n.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ep),hp=function(){};hp.prototype.interfaces_=function(){return[]},hp.prototype.getClass=function(){return hp},hp.relativeSign=function(t,e){return t<e?-1:t>e?1:0},hp.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=hp.relativeSign(e.x,n.x),i=hp.relativeSign(e.y,n.y);switch(t){case 0:return hp.compareValue(r,i);case 1:return hp.compareValue(i,r);case 2:return hp.compareValue(i,-r);case 3:return hp.compareValue(-r,i);case 4:return hp.compareValue(-r,-i);case 5:return hp.compareValue(-i,-r);case 6:return hp.compareValue(-i,r);case 7:return hp.compareValue(r,-i)}return Uc.shouldNeverReachHere("invalid octant value"),0},hp.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var pp=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new cc(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};pp.prototype.getCoordinate=function(){return this.coord},pp.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},pp.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:hp.compare(this._segmentOctant,this.coord,e.coord)},pp.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},pp.prototype.isInterior=function(){return this._isInterior},pp.prototype.interfaces_=function(){return[oc]},pp.prototype.getClass=function(){return pp};var dp=function(){this._nodeMap=new Cu,this._edge=null;var t=arguments[0];this._edge=t};dp.prototype.getSplitCoordinates=function(){var t=new pu;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next();this.addEdgeCoordinates(n,r,t),n=r}return t.toCoordinateArray()},dp.prototype.addCollapsedNodes=function(){var t=new uu;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this._edge.getCoordinate(n),n)}},dp.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},dp.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var n=this._edge.getCoordinate(e),r=this._edge.getCoordinate(e+2);n.equals2D(r)&&t.add(new _c(e+1))}},dp.prototype.addEdgeCoordinates=function(t,e,n){var r=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(r);n.add(new cc(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)n.add(this._edge.getCoordinate(o));i&&n.add(new cc(e.coord))},dp.prototype.iterator=function(){return this._nodeMap.values().iterator()},dp.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next(),i=this.createSplitEdge(n,r);t.add(i),n=r}},dp.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,1===r&&(n[0]=t.segmentIndex+1,!0)},dp.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();this.findCollapseIndex(r,i,e)&&t.add(new _c(e[0])),r=i}},dp.prototype.getEdge=function(){return this._edge},dp.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},dp.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,r=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),a=0;o[a++]=new cc(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this._edge.getCoordinate(s);return i&&(o[a]=new cc(e.coord)),new yp(o,this._edge.getData())},dp.prototype.add=function(t,e){var n=new pp(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return null!==r?(Uc.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)},dp.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0).getCoordinate(0);if(!n.equals2D(e[0]))throw new zc("bad split edge start point at "+n);var r=t.get(t.size()-1).getCoordinates(),i=r[r.length-1];if(!i.equals2D(e[e.length-1]))throw new zc("bad split edge end point at "+i)},dp.prototype.interfaces_=function(){return[]},dp.prototype.getClass=function(){return dp};var fp=function(){};fp.prototype.interfaces_=function(){return[]},fp.prototype.getClass=function(){return fp},fp.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new nc("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}if(arguments[0]instanceof cc&&arguments[1]instanceof cc){var i=arguments[0],o=arguments[1],a=o.x-i.x,s=o.y-i.y;if(0===a&&0===s)throw new nc("Cannot compute the octant for two identical points "+i);return fp.octant(a,s)}};var mp=function(){};mp.prototype.getCoordinates=function(){},mp.prototype.size=function(){},mp.prototype.getCoordinate=function(t){},mp.prototype.isClosed=function(){},mp.prototype.setData=function(t){},mp.prototype.getData=function(){},mp.prototype.interfaces_=function(){return[]},mp.prototype.getClass=function(){return mp};var gp=function(){};gp.prototype.addIntersection=function(t,e){},gp.prototype.interfaces_=function(){return[mp]},gp.prototype.getClass=function(){return gp};var yp=function(){this._nodeList=new dp(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};yp.prototype.getCoordinates=function(){return this._pts},yp.prototype.size=function(){return this._pts.length},yp.prototype.getCoordinate=function(t){return this._pts[t]},yp.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},yp.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},yp.prototype.setData=function(t){this._data=t},yp.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:fp.octant(t,e)},yp.prototype.getData=function(){return this._data},yp.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[3],o=new cc(n.getIntersection(i));this.addIntersection(o,r)}},yp.prototype.toString=function(){return Fc.toLineString(new uh(this._pts))},yp.prototype.getNodeList=function(){return this._nodeList},yp.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}return this._nodeList.add(t,n)},yp.prototype.addIntersections=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,n,r)},yp.prototype.interfaces_=function(){return[gp]},yp.prototype.getClass=function(){return yp},yp.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new uu;return yp.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var o=i.next();o.getNodeList().addSplitEdges(r)}};var vp=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new cc,this.p1=new cc;else if(1===arguments.length){var t=arguments[0];this.p0=new cc(t.p0),this.p1=new cc(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new cc(e,n),this.p1=new cc(r,i)}},_p={serialVersionUID:{configurable:!0}};vp.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},vp.prototype.orientationIndex=function(){if(arguments[0]instanceof vp){var t=arguments[0],e=qc.orientationIndex(this.p0,this.p1,t.p0),n=qc.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}if(arguments[0]instanceof cc){var r=arguments[0];return qc.orientationIndex(this.p0,this.p1,r)}},vp.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},vp.prototype.isVertical=function(){return this.p0.x===this.p1.x},vp.prototype.equals=function(t){if(!(t instanceof vp))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},vp.prototype.intersection=function(t){var e=new Vc;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},vp.prototype.project=function(){if(arguments[0]instanceof cc){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new cc(t);var e=this.projectionFactor(t),n=new cc;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof vp){var r=arguments[0],i=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(i>=1&&o>=1)return null;if(i<=0&&o<=0)return null;var a=this.project(r.p0);i<0&&(a=this.p0),i>1&&(a=this.p1);var s=this.project(r.p1);return o<0&&(s=this.p0),o>1&&(s=this.p1),new vp(a,s)}},vp.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},vp.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},vp.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},vp.prototype.distancePerpendicular=function(t){return qc.distancePointLinePerpendicular(t,this.p0,this.p1)},vp.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},vp.prototype.midPoint=function(){return vp.midPoint(this.p0,this.p1)},vp.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;return r<=0?rc.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r},vp.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),r=rc.MAX_VALUE,i=null,o=this.closestPoint(t.p0);r=o.distance(t.p0),n[0]=o,n[1]=t.p0;var a=this.closestPoint(t.p1);(i=a.distance(t.p1))<r&&(r=i,n[0]=a,n[1]=t.p1);var s=t.closestPoint(this.p0);(i=s.distance(this.p0))<r&&(r=i,n[0]=this.p0,n[1]=s);var l=t.closestPoint(this.p1);return(i=l.distance(this.p1))<r&&(r=i,n[0]=this.p1,n[1]=l),n},vp.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},vp.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},vp.prototype.getLength=function(){return this.p0.distance(this.p1)},vp.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},vp.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},vp.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},vp.prototype.lineIntersection=function(t){try{return Ic.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof Cc))throw t}return null},vp.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},vp.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,a=Math.sqrt(i*i+o*o),s=0,l=0;if(0!==e){if(a<=0)throw new Error("Cannot compute offset from zero-length line segment");s=e*i/a,l=e*o/a}return new cc(n-l,r+s)},vp.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},vp.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||rc.isNaN(e))&&(e=1),e},vp.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},vp.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},vp.prototype.distance=function(){if(arguments[0]instanceof vp){var t=arguments[0];return qc.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof cc){var e=arguments[0];return qc.distancePointLine(e,this.p0,this.p1)}},vp.prototype.pointAlong=function(t){var e=new cc;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},vp.prototype.hashCode=function(){var t=rc.doubleToLongBits(this.p0.x);t^=31*rc.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=rc.doubleToLongBits(this.p1.x);return n^=31*rc.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)},vp.prototype.interfaces_=function(){return[oc,lc]},vp.prototype.getClass=function(){return vp},vp.midPoint=function(t,e){return new cc((t.x+e.x)/2,(t.y+e.y)/2)},_p.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(vp,_p);var xp=function(){this.tempEnv1=new Pc,this.tempEnv2=new Pc,this._overlapSeg1=new vp,this._overlapSeg2=new vp};xp.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},xp.prototype.interfaces_=function(){return[]},xp.prototype.getClass=function(){return xp};var bp=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};bp.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},bp.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],o=this._pts[n];if(r.tempEnv1.init(i,o),n-e==1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var a=Math.trunc((e+n)/2);e<a&&this.computeSelect(t,e,a,r),a<n&&this.computeSelect(t,a,n,r)},bp.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,n=this._start;n<=this._end;n++)t[e++]=this._pts[n];return t},bp.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},bp.prototype.setId=function(t){this._id=t},bp.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},bp.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new Pc(t,e)}return this._env},bp.prototype.getEndIndex=function(){return this._end},bp.prototype.getStartIndex=function(){return this._start},bp.prototype.getContext=function(){return this._context},bp.prototype.getId=function(){return this._id},bp.prototype.computeOverlapsInternal=function(t,e,n,r,i,o){var a=this._pts[t],s=this._pts[e],l=n._pts[r],c=n._pts[i];if(e-t==1&&i-r==1)return o.overlap(this,t,n,r),null;if(o.tempEnv1.init(a,s),o.tempEnv2.init(l,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var u=Math.trunc((t+e)/2),h=Math.trunc((r+i)/2);t<u&&(r<h&&this.computeOverlapsInternal(t,u,n,r,h,o),h<i&&this.computeOverlapsInternal(t,u,n,h,i,o)),u<e&&(r<h&&this.computeOverlapsInternal(u,e,n,r,h,o),h<i&&this.computeOverlapsInternal(u,e,n,h,i,o))},bp.prototype.interfaces_=function(){return[]},bp.prototype.getClass=function(){return bp};var wp=function(){};wp.prototype.interfaces_=function(){return[]},wp.prototype.getClass=function(){return wp},wp.getChainStartIndices=function(t){var e=0,n=new uu;n.add(new _c(e));do{var r=wp.findChainEnd(t,e);n.add(new _c(r)),e=r}while(e<t.length-1);return wp.toIntArray(n)},wp.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=Vh.quadrant(t[n],t[n+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])&&Vh.quadrant(t[i-1],t[i])!==r)break;i++}return i-1},wp.getChains=function(){if(1===arguments.length){var t=arguments[0];return wp.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],r=new uu,i=wp.getChainStartIndices(e),o=0;o<i.length-1;o++){var a=new bp(e,i[o],i[o+1],n);r.add(a)}return r}},wp.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Mp=function(){};Mp.prototype.computeNodes=function(t){},Mp.prototype.getNodedSubstrings=function(){},Mp.prototype.interfaces_=function(){return[]},Mp.prototype.getClass=function(){return Mp};var Ep=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};Ep.prototype.setSegmentIntersector=function(t){this._segInt=t},Ep.prototype.interfaces_=function(){return[Mp]},Ep.prototype.getClass=function(){return Ep};var Sp=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new uu,this._index=new cp,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return yp.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=this,n=wp.getChains(t.getCoordinates(),t).iterator();n.hasNext();){var r=n.next();r.setId(e._idCounter++),e._index.insert(r.getEnvelope(),r),e._monoChains.add(r)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=this,e=new Tp(this._segInt),n=this._monoChains.iterator();n.hasNext();)for(var r=n.next(),i=t._index.query(r.getEnvelope()).iterator();i.hasNext();){var o=i.next();if(o.getId()>r.getId()&&(r.computeOverlaps(o,e),t._nOverlaps++),t._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return Tp},Object.defineProperties(e,n),e}(Ep),Tp=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3],o=e.getContext(),a=r.getContext();this._si.processIntersections(o,n,a,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(xp),Ap=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(a),this.setMitreLimit(s)}},Cp={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Ap.prototype.getEndCapStyle=function(){return this._endCapStyle},Ap.prototype.isSingleSided=function(){return this._isSingleSided},Ap.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=Ap.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Ap.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Ap.JOIN_ROUND&&(this._quadrantSegments=Ap.DEFAULT_QUADRANT_SEGMENTS)},Ap.prototype.getJoinStyle=function(){return this._joinStyle},Ap.prototype.setJoinStyle=function(t){this._joinStyle=t},Ap.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},Ap.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Ap.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Ap.prototype.setEndCapStyle=function(t){this._endCapStyle=t},Ap.prototype.getMitreLimit=function(){return this._mitreLimit},Ap.prototype.setMitreLimit=function(t){this._mitreLimit=t},Ap.prototype.setSingleSided=function(t){this._isSingleSided=t},Ap.prototype.interfaces_=function(){return[]},Ap.prototype.getClass=function(){return Ap},Ap.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Cp.CAP_ROUND.get=function(){return 1},Cp.CAP_FLAT.get=function(){return 2},Cp.CAP_SQUARE.get=function(){return 3},Cp.JOIN_ROUND.get=function(){return 1},Cp.JOIN_MITRE.get=function(){return 2},Cp.JOIN_BEVEL.get=function(){return 3},Cp.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Cp.DEFAULT_MITRE_LIMIT.get=function(){return 5},Cp.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Ap,Cp);var Lp=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=qc.COUNTERCLOCKWISE,this._inputLine=t||null},Ip={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Lp.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],o=this._inputLine[e],a=this._inputLine[n];return!!this.isConcave(i,o,a)&&!!this.isShallow(i,o,a,r)&&this.isShallowSampled(i,o,t,n,r)},Lp.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n),i=!1;r<this._inputLine.length;){var o=!1;t.isDeletable(e,n,r,t._distanceTol)&&(t._isDeleted[n]=Lp.DELETE,o=!0,i=!0),e=o?r:n,n=t.findNextNonDeletedIndex(e),r=t.findNextNonDeletedIndex(n)}return i},Lp.prototype.isShallowConcavity=function(t,e,n,r){return qc.computeOrientation(t,e,n)===this._angleOrientation&&qc.distancePointLine(e,t,n)<r},Lp.prototype.isShallowSampled=function(t,e,n,r,i){var o=Math.trunc((r-n)/Lp.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var a=n;a<r;a+=o)if(!this.isShallow(t,e,this._inputLine[a],i))return!1;return!0},Lp.prototype.isConcave=function(t,e,n){var r=qc.computeOrientation(t,e,n)===this._angleOrientation;return r},Lp.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=qc.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Lp.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Lp.DELETE;)e++;return e},Lp.prototype.isShallow=function(t,e,n,r){return qc.distancePointLine(e,t,n)<r},Lp.prototype.collapseLine=function(){for(var t=new pu,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Lp.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Lp.prototype.interfaces_=function(){return[]},Lp.prototype.getClass=function(){return Lp},Lp.simplify=function(t,e){return new Lp(t).simplify(e)},Ip.INIT.get=function(){return 0},Ip.DELETE.get=function(){return 1},Ip.KEEP.get=function(){return 1},Ip.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Lp,Ip);var Pp=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new uu},Rp={COORDINATE_ARRAY_TYPE:{configurable:!0}};Pp.prototype.getCoordinates=function(){return this._ptList.toArray(Pp.COORDINATE_ARRAY_TYPE)},Pp.prototype.setPrecisionModel=function(t){this._precisionModel=t},Pp.prototype.addPt=function(t){var e=new cc(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},Pp.prototype.revere=function(){},Pp.prototype.addPts=function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(var r=t.length-1;r>=0;r--)this.addPt(t[r])},Pp.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},Pp.prototype.toString=function(){return(new _h).createLineString(this.getCoordinates()).toString()},Pp.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new cc(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},Pp.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},Pp.prototype.interfaces_=function(){return[]},Pp.prototype.getClass=function(){return Pp},Rp.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Pp,Rp);var Op=function(){},Dp={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Op.prototype.interfaces_=function(){return[]},Op.prototype.getClass=function(){return Op},Op.toDegrees=function(t){return 180*t/Math.PI},Op.normalize=function(t){for(;t>Math.PI;)t-=Op.PI_TIMES_2;for(;t<=-Math.PI;)t+=Op.PI_TIMES_2;return t},Op.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}},Op.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)>0},Op.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)<0},Op.interiorAngle=function(t,e,n){var r=Op.angle(e,t),i=Op.angle(e,n);return Math.abs(i-r)},Op.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Op.PI_TIMES_2;t>=Op.PI_TIMES_2&&(t=0)}else{for(;t>=Op.PI_TIMES_2;)t-=Op.PI_TIMES_2;t<0&&(t=0)}return t},Op.angleBetween=function(t,e,n){var r=Op.angle(e,t),i=Op.angle(e,n);return Op.diff(r,i)},Op.diff=function(t,e){var n=null;return(n=t<e?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},Op.toRadians=function(t){return t*Math.PI/180},Op.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Op.COUNTERCLOCKWISE:n<0?Op.CLOCKWISE:Op.NONE},Op.angleBetweenOriented=function(t,e,n){var r=Op.angle(e,t),i=Op.angle(e,n)-r;return i<=-Math.PI?i+Op.PI_TIMES_2:i>Math.PI?i-Op.PI_TIMES_2:i},Dp.PI_TIMES_2.get=function(){return 2*Math.PI},Dp.PI_OVER_2.get=function(){return Math.PI/2},Dp.PI_OVER_4.get=function(){return Math.PI/4},Dp.COUNTERCLOCKWISE.get=function(){return qc.COUNTERCLOCKWISE},Dp.CLOCKWISE.get=function(){return qc.CLOCKWISE},Dp.NONE.get=function(){return qc.COLLINEAR},Object.defineProperties(Op,Dp);var Np=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new vp,this._seg1=new vp,this._offset0=new vp,this._offset1=new vp,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new Vc,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Ap.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},kp={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Np.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=qc.computeOrientation(this._s0,this._s1,this._s2),r=n===qc.CLOCKWISE&&this._side===Ah.LEFT||n===qc.COUNTERCLOCKWISE&&this._side===Ah.RIGHT;0===n?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},Np.prototype.addLineEndCap=function(t,e){var n=new vp(t,e),r=new vp;this.computeOffsetSegment(n,Ah.LEFT,this._distance,r);var i=new vp;this.computeOffsetSegment(n,Ah.RIGHT,this._distance,i);var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o);switch(this._bufParams.getEndCapStyle()){case Ap.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,s+Math.PI/2,s-Math.PI/2,qc.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Ap.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case Ap.CAP_SQUARE:var l=new cc;l.x=Math.abs(this._distance)*Math.cos(s),l.y=Math.abs(this._distance)*Math.sin(s);var c=new cc(r.p1.x+l.x,r.p1.y+l.y),u=new cc(i.p1.x+l.x,i.p1.y+l.y);this._segList.addPt(c),this._segList.addPt(u)}},Np.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Np.prototype.addMitreJoin=function(t,e,n,r){var i=!0,o=null;try{o=Ic.intersection(e.p0,e.p1,n.p0,n.p1),(r<=0?1:o.distance(t)/Math.abs(r))>this._bufParams.getMitreLimit()&&(i=!1)}catch(t){if(!(t instanceof Cc))throw t;o=new cc(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())},Np.prototype.addFilletCorner=function(t,e,n,r,i){var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o),l=n.x-t.x,c=n.y-t.y,u=Math.atan2(c,l);r===qc.CLOCKWISE?s<=u&&(s+=2*Math.PI):s>=u&&(s-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,s,u,r,i),this._segList.addPt(n)},Np.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Np.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Ap.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Ap.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Np.prototype.createSquare=function(t){this._segList.addPt(new cc(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new cc(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new cc(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new cc(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Np.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Np.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Np.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Np.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},Np.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,o=Op.angle(i,this._seg0.p0),a=Op.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,s=Op.normalize(o+a),l=Op.normalize(s+Math.PI),c=r*n,u=n-c*Math.abs(Math.sin(a)),h=i.x+c*Math.cos(l),p=i.y+c*Math.sin(l),d=new cc(h,p),f=new vp(i,d),m=f.pointAlongOffset(1,u),g=f.pointAlongOffset(1,-u);this._side===Ah.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},Np.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===Ah.LEFT?1:-1,o=t.p1.x-t.p0.x,a=t.p1.y-t.p0.y,s=Math.sqrt(o*o+a*a),l=i*n*o/s,c=i*n*a/s;r.p0.x=t.p0.x-c,r.p0.y=t.p0.y+l,r.p1.x=t.p1.x-c,r.p1.y=t.p1.y+l},Np.prototype.addFilletArc=function(t,e,n,r,i){var o=r===qc.CLOCKWISE?-1:1,a=Math.abs(e-n),s=Math.trunc(a/this._filletAngleQuantum+.5);if(s<1)return null;for(var l=a/s,c=0,u=new cc;c<a;){var h=e+o*c;u.x=t.x+i*Math.cos(h),u.y=t.y+i*Math.sin(h),this._segList.addPt(u),c+=l}},Np.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Np.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new cc((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new cc((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Np.prototype.createCircle=function(t){var e=new cc(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Np.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Np.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Pp,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Np.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Np.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Ap.JOIN_BEVEL||this._bufParams.getJoinStyle()===Ap.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,qc.CLOCKWISE,this._distance))},Np.prototype.closeRing=function(){this._segList.closeRing()},Np.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Np.prototype.interfaces_=function(){return[]},Np.prototype.getClass=function(){return Np},kp.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},kp.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},kp.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},kp.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Np,kp);var Fp=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Fp.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var o=i.getCoordinates();return n&&du.reverse(o),o},Fp.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=Lp.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Ah.LEFT),n.addFirstSegment();for(var a=o-2;a>=0;a--)n.addNextSegment(i[a],!0)}else{n.addSegments(t,!1);var s=Lp.simplify(t,r),l=s.length-1;n.initSideSegments(s[0],s[1],Ah.LEFT),n.addFirstSegment();for(var c=2;c<=l;c++)n.addNextSegment(s[c],!0)}n.addLastSegment(),n.closeRing()},Fp.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===Ah.RIGHT&&(r=-r);var i=Lp.simplify(t,r),o=i.length-1;n.initSideSegments(i[o-1],i[0],e);for(var a=1;a<=o;a++){var s=1!==a;n.addNextSegment(i[a],s)}n.closeRing()},Fp.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=Lp.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],Ah.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(r[o],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var a=Lp.simplify(t,-n),s=a.length-1;e.initSideSegments(a[s],a[s-1],Ah.LEFT);for(var l=s-2;l>=0;l--)e.addNextSegment(a[l],!0);e.addLastSegment(),e.addLineEndCap(a[1],a[0]),e.closeRing()},Fp.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Ap.CAP_ROUND:e.createCircle(t);break;case Ap.CAP_SQUARE:e.createSquare(t)}},Fp.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);return r.getCoordinates()},Fp.prototype.getBufferParameters=function(){return this._bufParams},Fp.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Fp.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return Fp.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()},Fp.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=Lp.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Ah.LEFT),n.addFirstSegment();for(var a=o-2;a>=0;a--)n.addNextSegment(i[a],!0)}else{var s=Lp.simplify(t,r),l=s.length-1;n.initSideSegments(s[0],s[1],Ah.LEFT),n.addFirstSegment();for(var c=2;c<=l;c++)n.addNextSegment(s[c],!0)}n.addLastSegment()},Fp.prototype.getSegGen=function(t){return new Np(this._precisionModel,this._bufParams,t)},Fp.prototype.interfaces_=function(){return[]},Fp.prototype.getClass=function(){return Fp},Fp.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new cc(t[n]);return e};var zp=function(){this._subgraphs=null,this._seg=new vp,this._cga=new qc;var t=arguments[0];this._subgraphs=t},Bp={DepthSegment:{configurable:!0}};zp.prototype.findStabbedSegments=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=new uu,r=this._subgraphs.iterator();r.hasNext();){var i=r.next(),o=i.getEnvelope();e.y<o.getMinY()||e.y>o.getMaxY()||t.findStabbedSegments(e,i.getDirectedEdges(),n)}return n}if(3===arguments.length)if(mc(arguments[2],lu)&&arguments[0]instanceof cc&&arguments[1]instanceof qh)for(var a=arguments[0],s=arguments[1],l=arguments[2],c=s.getEdge().getCoordinates(),u=0;u<c.length-1;u++){t._seg.p0=c[u],t._seg.p1=c[u+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var h=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(h<a.x)&&!(t._seg.isHorizontal()||a.y<t._seg.p0.y||a.y>t._seg.p1.y||qc.computeOrientation(t._seg.p0,t._seg.p1,a)===qc.RIGHT)){var p=s.getDepth(Ah.LEFT);t._seg.p0.equals(c[u])||(p=s.getDepth(Ah.RIGHT));var d=new Up(t._seg,p);l.add(d)}}else if(mc(arguments[2],lu)&&arguments[0]instanceof cc&&mc(arguments[1],lu))for(var f=arguments[0],m=arguments[1],g=arguments[2],y=m.iterator();y.hasNext();){var v=y.next();v.isForward()&&t.findStabbedSegments(f,v,g)}},zp.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:rp.min(e)._leftDepth},zp.prototype.interfaces_=function(){return[]},zp.prototype.getClass=function(){return zp},Bp.DepthSegment.get=function(){return Up},Object.defineProperties(zp,Bp);var Up=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new vp(t),this._leftDepth=e};Up.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==n||0!==(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(e._upwardSeg)},Up.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},Up.prototype.toString=function(){return this._upwardSeg.toString()},Up.prototype.interfaces_=function(){return[oc]},Up.prototype.getClass=function(){return Up};var jp=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};jp.prototype.area=function(){return jp.area(this.p0,this.p1,this.p2)},jp.prototype.signedArea=function(){return jp.signedArea(this.p0,this.p1,this.p2)},jp.prototype.interpolateZ=function(t){if(null===t)throw new nc("Supplied point is null.");return jp.interpolateZ(t,this.p0,this.p1,this.p2)},jp.prototype.longestSideLength=function(){return jp.longestSideLength(this.p0,this.p1,this.p2)},jp.prototype.isAcute=function(){return jp.isAcute(this.p0,this.p1,this.p2)},jp.prototype.circumcentre=function(){return jp.circumcentre(this.p0,this.p1,this.p2)},jp.prototype.area3D=function(){return jp.area3D(this.p0,this.p1,this.p2)},jp.prototype.centroid=function(){return jp.centroid(this.p0,this.p1,this.p2)},jp.prototype.inCentre=function(){return jp.inCentre(this.p0,this.p1,this.p2)},jp.prototype.interfaces_=function(){return[]},jp.prototype.getClass=function(){return jp},jp.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},jp.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},jp.det=function(t,e,n,r){return t*r-e*n},jp.interpolateZ=function(t,e,n,r){var i=e.x,o=e.y,a=n.x-i,s=r.x-i,l=n.y-o,c=r.y-o,u=a*c-s*l,h=t.x-i,p=t.y-o,d=(c*h-s*p)/u,f=(-l*h+a*p)/u;return e.z+d*(n.z-e.z)+f*(r.z-e.z)},jp.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),o=n.distance(t),a=r;return i>a&&(a=i),o>a&&(a=o),a},jp.isAcute=function(t,e,n){return!!Op.isAcute(t,e,n)&&!!Op.isAcute(e,n,t)&&!!Op.isAcute(n,t,e)},jp.circumcentre=function(t,e,n){var r=n.x,i=n.y,o=t.x-r,a=t.y-i,s=e.x-r,l=e.y-i,c=2*jp.det(o,a,s,l),u=jp.det(a,o*o+a*a,l,s*s+l*l),h=jp.det(o,o*o+a*a,s,s*s+l*l);return new cc(r-u/c,i+h/c)},jp.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new Ic(t.x+n/2,t.y+r/2,1),o=new Ic(t.x-r+n/2,t.y+n+r/2,1);return new Ic(i,o)},jp.angleBisector=function(t,e,n){var r=e.distance(t),i=r/(r+e.distance(n)),o=n.x-t.x,a=n.y-t.y;return new cc(t.x+i*o,t.y+i*a)},jp.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=e.z-t.z,a=n.x-t.x,s=n.y-t.y,l=n.z-t.z,c=i*l-o*s,u=o*a-r*l,h=r*s-i*a,p=c*c+u*u+h*h,d=Math.sqrt(p)/2;return d},jp.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new cc(r,i)},jp.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),o=t.distance(e),a=r+i+o,s=(r*t.x+i*e.x+o*n.x)/a,l=(r*t.y+i*e.y+o*n.y)/a;return new cc(s,l)};var Gp=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new uu;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};Gp.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,dc.EXTERIOR,dc.INTERIOR)},Gp.prototype.addPolygon=function(t){var e=this,n=this._distance,r=Ah.LEFT;this._distance<0&&(n=-this._distance,r=Ah.RIGHT);var i=t.getExteriorRing(),o=du.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance))return null;if(this._distance<=0&&o.length<3)return null;this.addPolygonRing(o,n,r,dc.EXTERIOR,dc.INTERIOR);for(var a=0;a<t.getNumInteriorRing();a++){var s=t.getInteriorRingN(a),l=du.removeRepeatedPoints(s.getCoordinates());e._distance>0&&e.isErodedCompletely(s,-e._distance)||e.addPolygonRing(l,n,Ah.opposite(r),dc.INTERIOR,dc.EXTERIOR)}},Gp.prototype.isTriangleErodedCompletely=function(t,e){var n=new jp(t[0],t[1],t[2]),r=n.inCentre();return qc.distancePointLine(r,n.p0,n.p1)<Math.abs(e)},Gp.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=du.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,dc.EXTERIOR,dc.INTERIOR)},Gp.prototype.addCurve=function(t,e,n){if(null===t||t.length<2)return null;var r=new yp(t,new kh(0,dc.BOUNDARY,e,n));this._curveList.add(r)},Gp.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Gp.prototype.addPolygonRing=function(t,e,n,r,i){if(0===e&&t.length<rh.MINIMUM_VALID_SIZE)return null;var o=r,a=i;t.length>=rh.MINIMUM_VALID_SIZE&&qc.isCCW(t)&&(o=i,a=r,n=Ah.opposite(n));var s=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(s,o,a)},Gp.prototype.add=function(t){if(t.isEmpty())return null;t instanceof eh?this.addPolygon(t):t instanceof Ju?this.addLineString(t):t instanceof Qu?this.addPoint(t):(t instanceof nh||t instanceof Bu||t instanceof ih||t instanceof zu)&&this.addCollection(t)},Gp.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i},Gp.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},Gp.prototype.interfaces_=function(){return[]},Gp.prototype.getClass=function(){return Gp};var Vp=function(){};Vp.prototype.locate=function(t){},Vp.prototype.interfaces_=function(){return[]},Vp.prototype.getClass=function(){return Vp};var Hp=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Hp.prototype.next=function(){if(this._atStart)return this._atStart=!1,Hp.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new cu;var t=this._parent.getGeometryN(this._index++);return t instanceof zu?(this._subcollectionIterator=new Hp(t),this._subcollectionIterator.next()):t},Hp.prototype.remove=function(){throw new Error(this.getClass().getName())},Hp.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Hp.prototype.interfaces_=function(){return[su]},Hp.prototype.getClass=function(){return Hp},Hp.isAtomic=function(t){return!(t instanceof zu)};var Wp=function(){this._geom=null;var t=arguments[0];this._geom=t};Wp.prototype.locate=function(t){return Wp.locate(t,this._geom)},Wp.prototype.interfaces_=function(){return[Vp]},Wp.prototype.getClass=function(){return Wp},Wp.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&qc.isPointInRing(t,e.getCoordinates())},Wp.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!Wp.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(Wp.isPointInRing(t,i))return!1}return!0},Wp.containsPoint=function(t,e){if(e instanceof eh)return Wp.containsPointInPolygon(t,e);if(e instanceof zu)for(var n=new Hp(e);n.hasNext();){var r=n.next();if(r!==e&&Wp.containsPoint(t,r))return!0}return!1},Wp.locate=function(t,e){return e.isEmpty()?dc.EXTERIOR:Wp.containsPoint(t,e)?dc.INTERIOR:dc.EXTERIOR};var qp=function(){this._edgeMap=new Cu,this._edgeList=null,this._ptInAreaLocation=[dc.NONE,dc.NONE]};qp.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return 0===e&&(n=this._edgeList.size()-1),this._edgeList.get(n)},qp.prototype.propagateSideLabels=function(t){for(var e=dc.NONE,n=this.iterator();n.hasNext();){var r=n.next().getLabel();r.isArea(t)&&r.getLocation(t,Ah.LEFT)!==dc.NONE&&(e=r.getLocation(t,Ah.LEFT))}if(e===dc.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getLabel();if(s.getLocation(t,Ah.ON)===dc.NONE&&s.setLocation(t,Ah.ON,i),s.isArea(t)){var l=s.getLocation(t,Ah.LEFT),c=s.getLocation(t,Ah.RIGHT);if(c!==dc.NONE){if(c!==i)throw new Rh("side location conflict",a.getCoordinate());l===dc.NONE&&Uc.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),i=l}else Uc.isTrue(s.getLocation(t,Ah.LEFT)===dc.NONE,"found single null side"),s.setLocation(t,Ah.RIGHT,i),s.setLocation(t,Ah.LEFT,i)}}},qp.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},qp.prototype.print=function(t){Lc.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},qp.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},qp.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel().getLocation(t,Ah.LEFT);Uc.isTrue(r!==dc.NONE,"Found unlabelled area edge");for(var i=r,o=this.iterator();o.hasNext();){var a=o.next().getLabel();Uc.isTrue(a.isArea(t),"Found non-area edge");var s=a.getLocation(t,Ah.LEFT),l=a.getLocation(t,Ah.RIGHT);if(s===l)return!1;if(l!==i)return!1;i=s}return!0},qp.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},qp.prototype.iterator=function(){return this.getEdges().iterator()},qp.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new uu(this._edgeMap.values())),this._edgeList},qp.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===dc.NONE&&(this._ptInAreaLocation[t]=Wp.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]},qp.prototype.toString=function(){var t=new vc;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},qp.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},qp.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var r=n.next().getLabel(),i=0;i<2;i++)r.isLine(i)&&r.getLocation(i)===dc.BOUNDARY&&(e[i]=!0);for(var o=this.iterator();o.hasNext();)for(var a=o.next(),s=a.getLabel(),l=0;l<2;l++)if(s.isAnyNull(l)){var c=dc.NONE;if(e[l])c=dc.EXTERIOR;else{var u=a.getCoordinate();c=this.getLocation(l,u,t)}s.setAllLocationsIfNull(l,c)}},qp.prototype.getDegree=function(){return this._edgeMap.size()},qp.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},qp.prototype.interfaces_=function(){return[]},qp.prototype.getClass=function(){return qp};var Xp=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var t=this;this.getResultAreaEdges();for(var e=null,n=null,r=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var o=t._resultAreaEdgeList.get(i),a=o.getSym();if(o.getLabel().isArea())switch(null===e&&o.isInResult()&&(e=o),r){case t._SCANNING_FOR_INCOMING:if(!a.isInResult())continue;n=a,r=t._LINKING_TO_OUTGOING;break;case t._LINKING_TO_OUTGOING:if(!o.isInResult())continue;n.setNext(o),r=t._SCANNING_FOR_INCOMING}}if(r===this._LINKING_TO_OUTGOING){if(null===e)throw new Rh("no outgoing dirEdge found",this.getCoordinate());Uc.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),n.setNext(e)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var r=t.get(e-1),i=n.getQuadrant(),o=r.getQuadrant();return Vh.isNorthern(i)&&Vh.isNorthern(o)?n:Vh.isNorthern(i)||Vh.isNorthern(o)?0!==n.getDy()?n:0!==r.getDy()?r:(Uc.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},e.prototype.print=function(t){Lc.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new uu;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next().getLabel();n.setAllLocationsIfNull(0,t.getLocation(0)),n.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,n=this._edgeList.size()-1;n>=0;n--){var r=this._edgeList.get(n),i=r.getSym();null===e&&(e=i),null!==t&&i.setNext(t),t=r}e.setNext(t)},e.prototype.computeDepths=function(){var t=this;if(1===arguments.length){var e=arguments[0],n=this.findIndex(e),r=e.getDepth(Ah.LEFT),i=e.getDepth(Ah.RIGHT),o=this.computeDepths(n+1,this._edgeList.size(),r),a=this.computeDepths(0,n,o);if(a!==i)throw new Rh("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var s=arguments[0],l=arguments[1],c=arguments[2],u=c,h=s;h<l;h++){var p=t._edgeList.get(h);p.setEdgeDepths(Ah.RIGHT,u),u=p.getDepth(Ah.LEFT)}return u}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=this,n=null,r=null,i=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var a=e._resultAreaEdgeList.get(o),s=a.getSym();switch(null===n&&a.getEdgeRing()===t&&(n=a),i){case e._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==t)continue;r=s,i=e._LINKING_TO_OUTGOING;break;case e._LINKING_TO_OUTGOING:if(a.getEdgeRing()!==t)continue;r.setNextMin(a),i=e._SCANNING_FOR_INCOMING}}i===this._LINKING_TO_OUTGOING&&(Uc.isTrue(null!==n,"found null for first outgoing dirEdge"),Uc.isTrue(n.getEdgeRing()===t,"unable to link last incoming dirEdge"),r.setNextMin(n))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();){var n=e.next();n.isInResult()&&t++}return t}if(1===arguments.length){for(var r=arguments[0],i=0,o=this.iterator();o.hasNext();){var a=o.next();a.getEdgeRing()===r&&i++}return i}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=dc.NONE,e=this.iterator();e.hasNext();){var n=e.next(),r=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=dc.INTERIOR;break}if(r.isInResult()){t=dc.EXTERIOR;break}}}if(t===dc.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getSym();a.isLineEdge()?a.getEdge().setCovered(i===dc.INTERIOR):(a.isInResult()&&(i=dc.EXTERIOR),s.isInResult()&&(i=dc.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new kh(dc.NONE);for(var n=this.iterator();n.hasNext();)for(var r=n.next().getEdge().getLabel(),i=0;i<2;i++){var o=r.getLocation(i);o!==dc.INTERIOR&&o!==dc.BOUNDARY||this._label.setLocation(i,dc.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(qp),Zp=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new jh(t,new Xp)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Xh),Yp=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Yp.prototype.compareTo=function(t){var e=t;return Yp.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},Yp.prototype.interfaces_=function(){return[oc]},Yp.prototype.getClass=function(){return Yp},Yp.orientation=function(t){return 1===du.increasingDirection(t)},Yp.compareOriented=function(t,e,n,r){for(var i=e?1:-1,o=r?1:-1,a=e?t.length:-1,s=r?n.length:-1,l=e?0:t.length-1,c=r?0:n.length-1;;){var u=t[l].compareTo(n[c]);if(0!==u)return u;var h=(l+=i)===a,p=(c+=o)===s;if(h&&!p)return-1;if(!h&&p)return 1;if(h&&p)return 0}};var $p=function(){this._edges=new uu,this._ocaMap=new Cu};$p.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var n=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var r=n.getCoordinates(),i=0;i<r.length;i++)i>0&&t.print(","),t.print(r[i].x+" "+r[i].y);t.println(")")}t.print(")  ")},$p.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},$p.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},$p.prototype.iterator=function(){return this._edges.iterator()},$p.prototype.getEdges=function(){return this._edges},$p.prototype.get=function(t){return this._edges.get(t)},$p.prototype.findEqualEdge=function(t){var e=new Yp(t.getCoordinates());return this._ocaMap.get(e)},$p.prototype.add=function(t){this._edges.add(t);var e=new Yp(t.getCoordinates());this._ocaMap.put(e,t)},$p.prototype.interfaces_=function(){return[]},$p.prototype.getClass=function(){return $p};var Jp=function(){};Jp.prototype.processIntersections=function(t,e,n,r){},Jp.prototype.isDone=function(){},Jp.prototype.interfaces_=function(){return[]},Jp.prototype.getClass=function(){return Jp};var Kp=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Kp.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(Kp.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},Kp.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Kp.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Kp.prototype.getLineIntersector=function(){return this._li},Kp.prototype.hasProperIntersection=function(){return this._hasProper},Kp.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Kp.prototype.hasIntersection=function(){return this._hasIntersection},Kp.prototype.isDone=function(){return!1},Kp.prototype.hasInteriorIntersection=function(){return this._hasInterior},Kp.prototype.interfaces_=function(){return[Jp]},Kp.prototype.getClass=function(){return Kp},Kp.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Qp=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new cc(t),this.segmentIndex=e,this.dist=n};Qp.prototype.getSegmentIndex=function(){return this.segmentIndex},Qp.prototype.getCoordinate=function(){return this.coord},Qp.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Qp.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},Qp.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Qp.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Qp.prototype.getDistance=function(){return this.dist},Qp.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Qp.prototype.interfaces_=function(){return[oc]},Qp.prototype.getClass=function(){return Qp};var td=function(){this._nodeMap=new Cu,this.edge=null;var t=arguments[0];this.edge=t};td.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},td.prototype.iterator=function(){return this._nodeMap.values().iterator()},td.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next(),i=this.createSplitEdge(n,r);t.add(i),n=r}},td.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},td.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,r=this.edge.pts[e.segmentIndex],i=e.dist>0||!e.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),a=0;o[a++]=new cc(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this.edge.pts[s];return i&&(o[a]=e.coord),new od(o,new kh(this.edge._label))},td.prototype.add=function(t,e,n){var r=new Qp(t,e,n),i=this._nodeMap.get(r);return null!==i?i:(this._nodeMap.put(r,r),r)},td.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},td.prototype.interfaces_=function(){return[]},td.prototype.getClass=function(){return td};var ed=function(){};ed.prototype.getChainStartIndices=function(t){var e=0,n=new uu;n.add(new _c(e));do{var r=this.findChainEnd(t,e);n.add(new _c(r)),e=r}while(e<t.length-1);return ed.toIntArray(n)},ed.prototype.findChainEnd=function(t,e){for(var n=Vh.quadrant(t[e],t[e+1]),r=e+1;r<t.length;){if(Vh.quadrant(t[r-1],t[r])!==n)break;r++}return r-1},ed.prototype.interfaces_=function(){return[]},ed.prototype.getClass=function(){return ed},ed.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var nd=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Pc,this.env2=new Pc;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new ed;this.startIndex=e.getChainStartIndices(this.pts)};nd.prototype.getCoordinates=function(){return this.pts},nd.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n},nd.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n},nd.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],l=arguments[4],c=arguments[5],u=this.pts[i],h=this.pts[o],p=a.pts[s],d=a.pts[l];if(o-i==1&&l-s==1)return c.addIntersections(this.e,i,a.e,s),null;if(this.env1.init(u,h),this.env2.init(p,d),!this.env1.intersects(this.env2))return null;var f=Math.trunc((i+o)/2),m=Math.trunc((s+l)/2);i<f&&(s<m&&this.computeIntersectsForChain(i,f,a,s,m,c),m<l&&this.computeIntersectsForChain(i,f,a,m,l,c)),f<o&&(s<m&&this.computeIntersectsForChain(f,o,a,s,m,c),m<l&&this.computeIntersectsForChain(f,o,a,m,l,c))}},nd.prototype.getStartIndexes=function(){return this.startIndex},nd.prototype.computeIntersects=function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var r=0;r<t.startIndex.length-1;r++)this.computeIntersectsForChain(n,t,r,e)},nd.prototype.interfaces_=function(){return[]},nd.prototype.getClass=function(){return nd};var rd=function t(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var n=0;n<3;n++)this._depth[e][n]=t.NULL_VALUE},id={NULL_VALUE:{configurable:!0}};rd.prototype.getDepth=function(t,e){return this._depth[t][e]},rd.prototype.setDepth=function(t,e,n){this._depth[t][e]=n},rd.prototype.isNull=function(){var t=this;if(0===arguments.length){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(t._depth[e][n]!==rd.NULL_VALUE)return!1;return!0}if(1===arguments.length){var r=arguments[0];return this._depth[r][1]===rd.NULL_VALUE}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this._depth[i][o]===rd.NULL_VALUE}},rd.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._depth[e][1];t._depth[e][2]<n&&(n=t._depth[e][2]),n<0&&(n=0);for(var r=1;r<3;r++){var i=0;t._depth[e][r]>n&&(i=1),t._depth[e][r]=i}}},rd.prototype.getDelta=function(t){return this._depth[t][Ah.RIGHT]-this._depth[t][Ah.LEFT]},rd.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?dc.EXTERIOR:dc.INTERIOR},rd.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},rd.prototype.add=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var i=e.getLocation(n,r);i!==dc.EXTERIOR&&i!==dc.INTERIOR||(t.isNull(n,r)?t._depth[n][r]=rd.depthAtLocation(i):t._depth[n][r]+=rd.depthAtLocation(i))}else if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];s===dc.INTERIOR&&this._depth[o][a]++}},rd.prototype.interfaces_=function(){return[]},rd.prototype.getClass=function(){return rd},rd.depthAtLocation=function(t){return t===dc.EXTERIOR?0:t===dc.INTERIOR?1:rd.NULL_VALUE},id.NULL_VALUE.get=function(){return-1},Object.defineProperties(rd,id);var od=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new td(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new rd,this._depthDelta=0,1===arguments.length){var n=arguments[0];e.call(this,n,null)}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,kh.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var n=t;if(this.pts.length!==n.pts.length)return!1;for(var r=!0,i=!0,o=this.pts.length,a=0;a<this.pts.length;a++)if(this.pts[a].equals2D(n.pts[a])||(r=!1),this.pts[a].equals2D(n.pts[--o])||(i=!1),!r&&!i)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new nd(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new Pc;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,n,r){var i=new cc(t.getIntersection(r)),o=e,a=t.getEdgeDistance(n,r),s=o+1;if(s<this.pts.length){var l=this.pts[s];i.equals2D(l)&&(o=s,a=0)}this.eiList.add(i,o,a)},e.prototype.toString=function(){var t=new vc;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,n,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],n=arguments[1];n.setAtLeastIfValid(e.getLocation(0,Ah.ON),e.getLocation(1,Ah.ON),1),e.isArea()&&(n.setAtLeastIfValid(e.getLocation(0,Ah.LEFT),e.getLocation(1,Ah.LEFT),2),n.setAtLeastIfValid(e.getLocation(0,Ah.RIGHT),e.getLocation(1,Ah.RIGHT),2))},e}(Uh),ad=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new $p,this._bufParams=t||null};ad.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},ad.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new kh(t.getLabel())).flip(),n.merge(r);var i=ad.depthDelta(r),o=e.getDepthDelta()+i;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(ad.depthDelta(t.getLabel()))},ad.prototype.buildSubgraphs=function(t,e){for(var n=new uu,r=t.iterator();r.hasNext();){var i=r.next(),o=i.getRightmostCoordinate(),a=new zp(n).getDepth(o);i.computeDepth(a),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}},ad.prototype.createSubgraphs=function(t){for(var e=new uu,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Dh;i.create(r),e.add(i)}}return rp.sort(e,rp.reverseOrder()),e},ad.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},ad.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new Sp,n=new Vc;return n.setPrecisionModel(t),e.setSegmentIntersector(new Kp(n)),e},ad.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;null===n&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new Fp(n,this._bufParams),i=new Gp(t,e,r).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,n),this._graph=new Zh(new Zp),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),a=new Yh(this._geomFact);this.buildSubgraphs(o,a);var s=a.getPolygons();return s.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(s)},ad.prototype.computeNodedEdges=function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var r=n.getNodedSubstrings().iterator();r.hasNext();){var i=r.next(),o=i.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var a=i.getData(),s=new od(i.getCoordinates(),new kh(a));this.insertUniqueEdge(s)}}},ad.prototype.setNoder=function(t){this._workingNoder=t},ad.prototype.interfaces_=function(){return[]},ad.prototype.getClass=function(){return ad},ad.depthDelta=function(t){var e=t.getLocation(0,Ah.LEFT),n=t.getLocation(0,Ah.RIGHT);return e===dc.INTERIOR&&n===dc.EXTERIOR?1:e===dc.EXTERIOR&&n===dc.INTERIOR?-1:0},ad.convertSegStrings=function(t){for(var e=new _h,n=new uu;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var sd=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};sd.prototype.rescale=function(){var t=this;if(mc(arguments[0],ou))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],o=0;o<i.length;o++)i[o].x=i[o].x/t._scaleFactor+t._offsetX,i[o].y=i[o].y/t._scaleFactor+t._offsetY;2===i.length&&i[0].equals2D(i[1])&&Lc.out.println(i)}},sd.prototype.scale=function(){var t=this;if(mc(arguments[0],ou)){for(var e=arguments[0],n=new uu,r=e.iterator();r.hasNext();){var i=r.next();n.add(new yp(t.scale(i.getCoordinates()),i.getData()))}return n}if(arguments[0]instanceof Array){for(var o=arguments[0],a=new Array(o.length).fill(null),s=0;s<o.length;s++)a[s]=new cc(Math.round((o[s].x-t._offsetX)*t._scaleFactor),Math.round((o[s].y-t._offsetY)*t._scaleFactor),o[s].z);var l=du.removeRepeatedPoints(a);return l}},sd.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},sd.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},sd.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},sd.prototype.interfaces_=function(){return[Mp]},sd.prototype.getClass=function(){return sd};var ld=function(){this._li=new Vc,this._segStrings=null;var t=arguments[0];this._segStrings=t},cd={fact:{configurable:!0}};ld.prototype.checkEndPtVertexIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),r=n.getCoordinates();t.checkEndPtVertexIntersections(r[0],t._segStrings),t.checkEndPtVertexIntersections(r[r.length-1],t._segStrings)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],a=o.iterator();a.hasNext();)for(var s=a.next(),l=s.getCoordinates(),c=1;c<l.length-1;c++)if(l[c].equals(i))throw new zc("found endpt/interior pt intersection at index "+c+" :pt "+i)},ld.prototype.checkInteriorIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),r=this._segStrings.iterator();r.hasNext();){var i=r.next();t.checkInteriorIntersections(n,i)}else if(2===arguments.length)for(var o=arguments[0],a=arguments[1],s=o.getCoordinates(),l=a.getCoordinates(),c=0;c<s.length-1;c++)for(var u=0;u<l.length-1;u++)t.checkInteriorIntersections(o,c,a,u);else if(4===arguments.length){var h=arguments[0],p=arguments[1],d=arguments[2],f=arguments[3];if(h===d&&p===f)return null;var m=h.getCoordinates()[p],g=h.getCoordinates()[p+1],y=d.getCoordinates()[f],v=d.getCoordinates()[f+1];if(this._li.computeIntersection(m,g,y,v),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,m,g)||this.hasInteriorIntersection(this._li,y,v)))throw new zc("found non-noded intersection at "+m+"-"+g+" and "+y+"-"+v)}},ld.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},ld.prototype.checkCollapses=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();t.checkCollapses(n)}else if(1===arguments.length)for(var r=arguments[0],i=r.getCoordinates(),o=0;o<i.length-2;o++)t.checkCollapse(i[o],i[o+1],i[o+2])},ld.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!i.equals(e)&&!i.equals(n))return!0}return!1},ld.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new zc("found non-noded collapse at "+ld.fact.createLineString([t,e,n]))},ld.prototype.interfaces_=function(){return[]},ld.prototype.getClass=function(){return ld},cd.fact.get=function(){return new _h},Object.defineProperties(ld,cd);var ud=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new nc("Scale factor must be non-zero");1!==e&&(this._pt=new cc(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new cc,this._p1Scaled=new cc),this.initCorners(this._pt)},hd={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};ud.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),a=this._maxx<n||this._minx>r||this._maxy<i||this._miny>o;if(a)return!1;var s=this.intersectsToleranceSquare(t,e);return Uc.isTrue(!(a&&s),"Found bad envelope test"),s},ud.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new cc(this._maxx,this._maxy),this._corner[1]=new cc(this._minx,this._maxy),this._corner[2]=new cc(this._minx,this._miny),this._corner[3]=new cc(this._maxx,this._miny)},ud.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},ud.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},ud.prototype.getCoordinate=function(){return this._originalPt},ud.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},ud.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=ud.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Pc(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},ud.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},ud.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!n||!r)||!!t.equals(this._pt)||!!e.equals(this._pt))))},ud.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return!!this.intersects(n,r)&&(t.addIntersection(this.getCoordinate(),e),!0)},ud.prototype.interfaces_=function(){return[]},ud.prototype.getClass=function(){return ud},hd.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(ud,hd);var pd=function(){this.tempEnv1=new Pc,this.selectedSegment=new vp};pd.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},pd.prototype.interfaces_=function(){return[]},pd.prototype.getClass=function(){return pd};var dd=function(){this._index=null;var t=arguments[0];this._index=t},fd={HotPixelSnapAction:{configurable:!0}};dd.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),o=new md(e,n,r);return this._index.query(i,{interfaces_:function(){return[Qh]},visitItem:function(t){t.select(i,o)}}),o.isNodeAdded()}},dd.prototype.interfaces_=function(){return[]},dd.prototype.getClass=function(){return dd},fd.HotPixelSnapAction.get=function(){return md},Object.defineProperties(dd,fd);var md=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._hotPixel=e,this._parentEdge=n,this._hotPixelVertexIndex=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[0],n=arguments[1],r=e.getContext();if(null!==this._parentEdge&&r===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pd),gd=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new uu};gd.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];if(this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}},gd.prototype.isDone=function(){return!1},gd.prototype.getInteriorIntersections=function(){return this._interiorIntersections},gd.prototype.interfaces_=function(){return[Jp]},gd.prototype.getClass=function(){return gd};var yd=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new Vc,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};yd.prototype.checkCorrectness=function(t){var e=yp.getNodedSubstrings(t),n=new ld(e);try{n.checkValid()}catch(t){if(!(t instanceof Ac))throw t;t.printStackTrace()}},yd.prototype.getNodedSubstrings=function(){return yp.getNodedSubstrings(this._nodedSegStrings)},yd.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},yd.prototype.findInteriorIntersections=function(t,e){var n=new gd(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()},yd.prototype.computeVertexSnaps=function(){var t=this;if(mc(arguments[0],ou))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.computeVertexSnaps(r)}else if(arguments[0]instanceof yp)for(var i=arguments[0],o=i.getCoordinates(),a=0;a<o.length;a++){var s=new ud(o[a],t._scaleFactor,t._li),l=t._pointSnapper.snap(s,i,a);l&&i.addIntersection(o[a],a)}},yd.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new Sp,this._pointSnapper=new dd(this._noder.getIndex()),this.snapRound(t,this._li)},yd.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=new ud(r,e._scaleFactor,e._li);e._pointSnapper.snap(i)}},yd.prototype.interfaces_=function(){return[Mp]},yd.prototype.getClass=function(){return yd};var vd=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Ap,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},_d={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};vd.prototype.bufferFixedPrecision=function(t){var e=new sd(new yd(new mh(1)),t.getScale()),n=new ad(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)},vd.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=vd.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof Rh))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],r=vd.precisionScaleFactor(this._argGeom,this._distance,n),i=new mh(r);this.bufferFixedPrecision(i)}},vd.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===mh.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},vd.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},vd.prototype.bufferOriginalPrecision=function(){try{var t=new ad(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof zc))throw t;this._saveException=t}},vd.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},vd.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},vd.prototype.interfaces_=function(){return[]},vd.prototype.getClass=function(){return vd},vd.bufferOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new vd(t),r=n.getResultGeometry(e);return r}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Yc&&"number"==typeof arguments[1]){var i=arguments[0],o=arguments[1],a=arguments[2],s=new vd(i);s.setQuadrantSegments(a);var l=s.getResultGeometry(o);return l}if(arguments[2]instanceof Ap&&arguments[0]instanceof Yc&&"number"==typeof arguments[1]){var c=arguments[0],u=arguments[1],h=arguments[2],p=new vd(c,h),d=p.getResultGeometry(u);return d}}else if(4===arguments.length){var f=arguments[0],m=arguments[1],g=arguments[2],y=arguments[3],v=new vd(f);v.setQuadrantSegments(g),v.setEndCapStyle(y);var _=v.getResultGeometry(m);return _}},vd.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=gc.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(e>0?e:0),o=n-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},_d.CAP_ROUND.get=function(){return Ap.CAP_ROUND},_d.CAP_BUTT.get=function(){return Ap.CAP_FLAT},_d.CAP_FLAT.get=function(){return Ap.CAP_FLAT},_d.CAP_SQUARE.get=function(){return Ap.CAP_SQUARE},_d.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(vd,_d);var xd=function(){this._pt=[new cc,new cc],this._distance=rc.NaN,this._isNull=!0};xd.prototype.getCoordinates=function(){return this._pt},xd.prototype.getCoordinate=function(t){return this._pt[t]},xd.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},xd.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},xd.prototype.getDistance=function(){return this._distance},xd.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},xd.prototype.interfaces_=function(){return[]},xd.prototype.getClass=function(){return xd};var bd=function(){};bd.prototype.interfaces_=function(){return[]},bd.prototype.getClass=function(){return bd},bd.computeDistance=function(){if(arguments[2]instanceof xd&&arguments[0]instanceof Ju&&arguments[1]instanceof cc)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=t.getCoordinates(),i=new vp,o=0;o<r.length-1;o++){i.setCoordinates(r[o],r[o+1]);var a=i.closestPoint(e);n.setMinimum(a,e)}else if(arguments[2]instanceof xd&&arguments[0]instanceof eh&&arguments[1]instanceof cc){var s=arguments[0],l=arguments[1],c=arguments[2];bd.computeDistance(s.getExteriorRing(),l,c);for(var u=0;u<s.getNumInteriorRing();u++)bd.computeDistance(s.getInteriorRingN(u),l,c)}else if(arguments[2]instanceof xd&&arguments[0]instanceof Yc&&arguments[1]instanceof cc){var h=arguments[0],p=arguments[1],d=arguments[2];if(h instanceof Ju)bd.computeDistance(h,p,d);else if(h instanceof eh)bd.computeDistance(h,p,d);else if(h instanceof zu)for(var f=h,m=0;m<f.getNumGeometries();m++){var g=f.getGeometryN(m);bd.computeDistance(g,p,d)}else d.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof xd&&arguments[0]instanceof vp&&arguments[1]instanceof cc){var y=arguments[0],v=arguments[1],_=arguments[2],x=y.closestPoint(v);_.setMinimum(x,v)}};var wd=function(t){this._maxPtDist=new xd,this._inputGeom=t||null},Md={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};wd.prototype.computeMaxMidpointDistance=function(t){var e=new Sd(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},wd.prototype.computeMaxVertexDistance=function(t){var e=new Ed(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},wd.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},wd.prototype.getDistancePoints=function(){return this._maxPtDist},wd.prototype.interfaces_=function(){return[]},wd.prototype.getClass=function(){return wd},Md.MaxPointDistanceFilter.get=function(){return Ed},Md.MaxMidpointDistanceFilter.get=function(){return Sd},Object.defineProperties(wd,Md);var Ed=function(t){this._maxPtDist=new xd,this._minPtDist=new xd,this._geom=t||null};Ed.prototype.filter=function(t){this._minPtDist.initialize(),bd.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ed.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ed.prototype.interfaces_=function(){return[Kc]},Ed.prototype.getClass=function(){return Ed};var Sd=function(t){this._maxPtDist=new xd,this._minPtDist=new xd,this._geom=t||null};Sd.prototype.filter=function(t,e){if(0===e)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new cc((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),bd.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Sd.prototype.isDone=function(){return!1},Sd.prototype.isGeometryChanged=function(){return!1},Sd.prototype.getMaxPointDistance=function(){return this._maxPtDist},Sd.prototype.interfaces_=function(){return[Fu]},Sd.prototype.getClass=function(){return Sd};var Td=function(t){this._comps=t||null};Td.prototype.filter=function(t){t instanceof eh&&this._comps.add(t)},Td.prototype.interfaces_=function(){return[ku]},Td.prototype.getClass=function(){return Td},Td.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return Td.getPolygons(t,new uu)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof eh?n.add(e):e instanceof zu&&e.apply(new Td(n)),n}};var Ad=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};Ad.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof rh){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Ju&&this._lines.add(t)},Ad.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},Ad.prototype.interfaces_=function(){return[Zc]},Ad.prototype.getClass=function(){return Ad},Ad.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Ad.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(Ad.getLines(e,n))}},Ad.getLines=function(){if(1===arguments.length){var t=arguments[0];return Ad.getLines(t,!1)}if(2===arguments.length){if(mc(arguments[0],ou)&&mc(arguments[1],ou)){for(var e=arguments[0],n=arguments[1],r=e.iterator();r.hasNext();){var i=r.next();Ad.getLines(i,n)}return n}if(arguments[0]instanceof Yc&&"boolean"==typeof arguments[1]){var o=arguments[0],a=arguments[1],s=new uu;return o.apply(new Ad(s,a)),s}if(arguments[0]instanceof Yc&&mc(arguments[1],ou)){var l=arguments[0],c=arguments[1];return l instanceof Ju?c.add(l):l.apply(new Ad(c)),c}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&mc(arguments[0],ou)&&mc(arguments[1],ou)){for(var u=arguments[0],h=arguments[1],p=arguments[2],d=u.iterator();d.hasNext();){var f=d.next();Ad.getLines(f,h,p)}return h}if("boolean"==typeof arguments[2]&&arguments[0]instanceof Yc&&mc(arguments[1],ou)){var m=arguments[0],g=arguments[1],y=arguments[2];return m.apply(new Ad(g,y)),g}}};var Cd=function(){if(this._boundaryRule=Qc.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new nc("Rule must be non-null");this._boundaryRule=t}};Cd.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof cc&&arguments[1]instanceof eh){var e=arguments[0],n=arguments[1];if(n.isEmpty())return dc.EXTERIOR;var r=n.getExteriorRing(),i=this.locateInPolygonRing(e,r);if(i===dc.EXTERIOR)return dc.EXTERIOR;if(i===dc.BOUNDARY)return dc.BOUNDARY;for(var o=0;o<n.getNumInteriorRing();o++){var a=n.getInteriorRingN(o),s=t.locateInPolygonRing(e,a);if(s===dc.INTERIOR)return dc.EXTERIOR;if(s===dc.BOUNDARY)return dc.BOUNDARY}return dc.INTERIOR}if(arguments[0]instanceof cc&&arguments[1]instanceof Ju){var l=arguments[0],c=arguments[1];if(!c.getEnvelopeInternal().intersects(l))return dc.EXTERIOR;var u=c.getCoordinates();return c.isClosed()||!l.equals(u[0])&&!l.equals(u[u.length-1])?qc.isOnLine(l,u)?dc.INTERIOR:dc.EXTERIOR:dc.BOUNDARY}if(arguments[0]instanceof cc&&arguments[1]instanceof Qu){var h=arguments[0],p=arguments[1],d=p.getCoordinate();return d.equals2D(h)?dc.INTERIOR:dc.EXTERIOR}},Cd.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?qc.locatePointInRing(t,e.getCoordinates()):dc.EXTERIOR},Cd.prototype.intersects=function(t,e){return this.locate(t,e)!==dc.EXTERIOR},Cd.prototype.updateLocationInfo=function(t){t===dc.INTERIOR&&(this._isIn=!0),t===dc.BOUNDARY&&this._numBoundaries++},Cd.prototype.computeLocation=function(t,e){var n=this;if(e instanceof Qu&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Ju)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof eh)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Bu)for(var r=e,i=0;i<r.getNumGeometries();i++){var o=r.getGeometryN(i);n.updateLocationInfo(n.locateInternal(t,o))}else if(e instanceof ih)for(var a=e,s=0;s<a.getNumGeometries();s++){var l=a.getGeometryN(s);n.updateLocationInfo(n.locateInternal(t,l))}else if(e instanceof zu)for(var c=new Hp(e);c.hasNext();){var u=c.next();u!==e&&n.computeLocation(t,u)}},Cd.prototype.locate=function(t,e){return e.isEmpty()?dc.EXTERIOR:e instanceof Ju||e instanceof eh?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?dc.BOUNDARY:this._numBoundaries>0||this._isIn?dc.INTERIOR:dc.EXTERIOR)},Cd.prototype.interfaces_=function(){return[]},Cd.prototype.getClass=function(){return Cd};var Ld=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._component=r,this._segIndex=i,this._pt=o}},Id={INSIDE_AREA:{configurable:!0}};Ld.prototype.isInsideArea=function(){return this._segIndex===Ld.INSIDE_AREA},Ld.prototype.getCoordinate=function(){return this._pt},Ld.prototype.getGeometryComponent=function(){return this._component},Ld.prototype.getSegmentIndex=function(){return this._segIndex},Ld.prototype.interfaces_=function(){return[]},Ld.prototype.getClass=function(){return Ld},Id.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Ld,Id);var Pd=function(t){this._pts=t||null};Pd.prototype.filter=function(t){t instanceof Qu&&this._pts.add(t)},Pd.prototype.interfaces_=function(){return[ku]},Pd.prototype.getClass=function(){return Pd},Pd.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Qu?rp.singletonList(t):Pd.getPoints(t,new uu)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Qu?n.add(e):e instanceof zu&&e.apply(new Pd(n)),n}};var Rd=function(){this._locations=null;var t=arguments[0];this._locations=t};Rd.prototype.filter=function(t){(t instanceof Qu||t instanceof Ju||t instanceof eh)&&this._locations.add(new Ld(t,0,t.getCoordinate()))},Rd.prototype.interfaces_=function(){return[ku]},Rd.prototype.getClass=function(){return Rd},Rd.getLocations=function(t){var e=new uu;return t.apply(new Rd(e)),e};var Od=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Cd,this._minDistanceLocation=null,this._minDistance=rc.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};Od.prototype.computeContainmentDistance=function(){var t=this;if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=1-n,o=Td.getPolygons(this._geom[n]);if(o.size()>0){var a=Rd.getLocations(this._geom[i]);if(this.computeContainmentDistance(a,o,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&mc(arguments[0],lu)&&mc(arguments[1],lu)){for(var s=arguments[0],l=arguments[1],c=arguments[2],u=0;u<s.size();u++)for(var h=s.get(u),p=0;p<l.size();p++)if(t.computeContainmentDistance(h,l.get(p),c),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ld&&arguments[1]instanceof eh){var d=arguments[0],f=arguments[1],m=arguments[2],g=d.getCoordinate();if(dc.EXTERIOR!==this._ptLocator.locate(g,f))return this._minDistance=0,m[0]=d,m[1]=new Ld(f,g),null}},Od.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),a=0;a<e.size();a++){var s=e.get(a);if(r.computeMinDistance(o,s,n),r._minDistance<=r._terminateDistance)return null}},Od.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Ad.getLines(this._geom[0]),n=Ad.getLines(this._geom[1]),r=Pd.getPoints(this._geom[0]),i=Pd.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),void this.updateMinDistance(t,!1))))},Od.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Od.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},Od.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Od.prototype.computeMinDistance=function(){var t=this;if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Ju&&arguments[1]instanceof Qu){var e=arguments[0],n=arguments[1],r=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var i=e.getCoordinates(),o=n.getCoordinate(),a=0;a<i.length-1;a++){var s=qc.distancePointLine(o,i[a],i[a+1]);if(s<t._minDistance){t._minDistance=s;var l=new vp(i[a],i[a+1]),c=l.closestPoint(o);r[0]=new Ld(e,a,c),r[1]=new Ld(n,0,o)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ju&&arguments[1]instanceof Ju){var u=arguments[0],h=arguments[1],p=arguments[2];if(u.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var d=u.getCoordinates(),f=h.getCoordinates(),m=0;m<d.length-1;m++)for(var g=0;g<f.length-1;g++){var y=qc.distanceLineLine(d[m],d[m+1],f[g],f[g+1]);if(y<t._minDistance){t._minDistance=y;var v=new vp(d[m],d[m+1]),_=new vp(f[g],f[g+1]),x=v.closestPoints(_);p[0]=new Ld(u,m,x[0]),p[1]=new Ld(h,g,x[1])}if(t._minDistance<=t._terminateDistance)return null}}},Od.prototype.computeMinDistancePoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),a=0;a<e.size();a++){var s=e.get(a),l=o.getCoordinate().distance(s.getCoordinate());if(l<r._minDistance&&(r._minDistance=l,n[0]=new Ld(o,0,o.getCoordinate()),n[1]=new Ld(s,0,s.getCoordinate())),r._minDistance<=r._terminateDistance)return null}},Od.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new nc("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Od.prototype.computeMinDistanceLines=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var o=t.get(i),a=0;a<e.size();a++){var s=e.get(a);if(r.computeMinDistance(o,s,n),r._minDistance<=r._terminateDistance)return null}},Od.prototype.interfaces_=function(){return[]},Od.prototype.getClass=function(){return Od},Od.distance=function(t,e){return new Od(t,e).distance()},Od.isWithinDistance=function(t,e,n){return new Od(t,e,n).distance()<=n},Od.nearestPoints=function(t,e){return new Od(t,e).nearestPoints()};var Dd=function(){this._pt=[new cc,new cc],this._distance=rc.NaN,this._isNull=!0};Dd.prototype.getCoordinates=function(){return this._pt},Dd.prototype.getCoordinate=function(t){return this._pt[t]},Dd.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},Dd.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},Dd.prototype.toString=function(){return Fc.toLineString(this._pt[0],this._pt[1])},Dd.prototype.getDistance=function(){return this._distance},Dd.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},Dd.prototype.interfaces_=function(){return[]},Dd.prototype.getClass=function(){return Dd};var Nd=function(){};Nd.prototype.interfaces_=function(){return[]},Nd.prototype.getClass=function(){return Nd},Nd.computeDistance=function(){if(arguments[2]instanceof Dd&&arguments[0]instanceof Ju&&arguments[1]instanceof cc)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new vp,i=t.getCoordinates(),o=0;o<i.length-1;o++){r.setCoordinates(i[o],i[o+1]);var a=r.closestPoint(e);n.setMinimum(a,e)}else if(arguments[2]instanceof Dd&&arguments[0]instanceof eh&&arguments[1]instanceof cc){var s=arguments[0],l=arguments[1],c=arguments[2];Nd.computeDistance(s.getExteriorRing(),l,c);for(var u=0;u<s.getNumInteriorRing();u++)Nd.computeDistance(s.getInteriorRingN(u),l,c)}else if(arguments[2]instanceof Dd&&arguments[0]instanceof Yc&&arguments[1]instanceof cc){var h=arguments[0],p=arguments[1],d=arguments[2];if(h instanceof Ju)Nd.computeDistance(h,p,d);else if(h instanceof eh)Nd.computeDistance(h,p,d);else if(h instanceof zu)for(var f=h,m=0;m<f.getNumGeometries();m++){var g=f.getGeometryN(m);Nd.computeDistance(g,p,d)}else d.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof Dd&&arguments[0]instanceof vp&&arguments[1]instanceof cc){var y=arguments[0],v=arguments[1],_=arguments[2],x=y.closestPoint(v);_.setMinimum(x,v)}};var kd=function(){this._g0=null,this._g1=null,this._ptDist=new Dd,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Fd={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};kd.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},kd.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new nc("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},kd.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},kd.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},kd.prototype.computeOrientedDistance=function(t,e,n){var r=new zd(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new Bd(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}},kd.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},kd.prototype.interfaces_=function(){return[]},kd.prototype.getClass=function(){return kd},kd.distance=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new kd(t,e);return n.distance()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],a=new kd(r,i);return a.setDensifyFraction(o),a.distance()}},Fd.MaxPointDistanceFilter.get=function(){return zd},Fd.MaxDensifiedByFractionDistanceFilter.get=function(){return Bd},Object.defineProperties(kd,Fd);var zd=function(){this._maxPtDist=new Dd,this._minPtDist=new Dd,this._euclideanDist=new Nd,this._geom=null;var t=arguments[0];this._geom=t};zd.prototype.filter=function(t){this._minPtDist.initialize(),Nd.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},zd.prototype.getMaxPointDistance=function(){return this._maxPtDist},zd.prototype.interfaces_=function(){return[Kc]},zd.prototype.getClass=function(){return zd};var Bd=function(){this._maxPtDist=new Dd,this._minPtDist=new Dd,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Bd.prototype.filter=function(t,e){var n=this;if(0===e)return null;for(var r=t.getCoordinate(e-1),i=t.getCoordinate(e),o=(i.x-r.x)/this._numSubSegs,a=(i.y-r.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var l=r.x+s*o,c=r.y+s*a,u=new cc(l,c);n._minPtDist.initialize(),Nd.computeDistance(n._geom,u,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}},Bd.prototype.isDone=function(){return!1},Bd.prototype.isGeometryChanged=function(){return!1},Bd.prototype.getMaxPointDistance=function(){return this._maxPtDist},Bd.prototype.interfaces_=function(){return[Fu]},Bd.prototype.getClass=function(){return Bd};var Ud=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},jd={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Ud.prototype.checkMaximumDistance=function(t,e,n){var r=new kd(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Fc.toLineString(i[0],i[1])+")"}},Ud.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Ud.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Ud.VERBOSE&&Lc.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Ud.prototype.checkNegativeValid=function(){if(!(this._input instanceof eh||this._input instanceof ih||this._input instanceof zu))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Ud.prototype.getErrorIndicator=function(){return this._errorIndicator},Ud.prototype.checkMinimumDistance=function(t,e,n){var r=new Od(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Fc.toLineString(i[0],i[1])+" )"}},Ud.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Ud.prototype.getErrorLocation=function(){return this._errorLocation},Ud.prototype.getPolygonLines=function(t){for(var e=new uu,n=new Ad(e),r=Td.getPolygons(t).iterator();r.hasNext();)r.next().apply(n);return t.getFactory().buildGeometry(e)},Ud.prototype.getErrorMessage=function(){return this._errMsg},Ud.prototype.interfaces_=function(){return[]},Ud.prototype.getClass=function(){return Ud},jd.VERBOSE.get=function(){return!1},jd.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Ud,jd);var Gd=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},Vd={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Gd.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Gd.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Gd.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new Pc(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new Pc(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")},Gd.prototype.checkDistance=function(){var t=new Ud(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},Gd.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Gd.prototype.checkPolygonal=function(){this._result instanceof eh||this._result instanceof ih||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Gd.prototype.getErrorIndicator=function(){return this._errorIndicator},Gd.prototype.getErrorLocation=function(){return this._errorLocation},Gd.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Gd.prototype.report=function(t){if(!Gd.VERBOSE)return null;Lc.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},Gd.prototype.getErrorMessage=function(){return this._errorMsg},Gd.prototype.interfaces_=function(){return[]},Gd.prototype.getClass=function(){return Gd},Gd.isValidMsg=function(t,e,n){var r=new Gd(t,e,n);return r.isValid()?null:r.getErrorMessage()},Gd.isValid=function(t,e,n){return!!new Gd(t,e,n).isValid()},Vd.VERBOSE.get=function(){return!1},Vd.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Gd,Vd);var Hd=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Hd.prototype.getCoordinates=function(){return this._pts},Hd.prototype.size=function(){return this._pts.length},Hd.prototype.getCoordinate=function(t){return this._pts[t]},Hd.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Hd.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:fp.octant(this.getCoordinate(t),this.getCoordinate(t+1))},Hd.prototype.setData=function(t){this._data=t},Hd.prototype.getData=function(){return this._data},Hd.prototype.toString=function(){return Fc.toLineString(new uh(this._pts))},Hd.prototype.interfaces_=function(){return[mp]},Hd.prototype.getClass=function(){return Hd};var Wd=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new uu,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Wd.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Wd.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},Wd.prototype.getIntersectionSegments=function(){return this._intSegments},Wd.prototype.count=function(){return this._intersectionCount},Wd.prototype.getIntersections=function(){return this._intersections},Wd.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Wd.prototype.setKeepIntersections=function(t){this._keepIntersections=t},Wd.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(n,r))return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=a,this._intSegments[3]=s,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Wd.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},Wd.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Wd.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Wd.prototype.interfaces_=function(){return[Jp]},Wd.prototype.getClass=function(){return Wd},Wd.createAllIntersectionsFinder=function(t){var e=new Wd(t);return e.setFindAllIntersections(!0),e},Wd.createAnyIntersectionFinder=function(t){return new Wd(t)},Wd.createIntersectionCounter=function(t){var e=new Wd(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var qd=function(){this._li=new Vc,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};qd.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},qd.prototype.getIntersections=function(){return this._segInt.getIntersections()},qd.prototype.isValid=function(){return this.execute(),this._isValid},qd.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},qd.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Wd(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new Sp;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},qd.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Rh(this.getErrorMessage(),this._segInt.getInteriorIntersection())},qd.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Fc.toLineString(t[0],t[1])+" and "+Fc.toLineString(t[2],t[3])},qd.prototype.interfaces_=function(){return[]},qd.prototype.getClass=function(){return qd},qd.computeIntersections=function(t){var e=new qd(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Xd=function t(){this._nv=null;var e=arguments[0];this._nv=new qd(t.toSegmentStrings(e))};Xd.prototype.checkValid=function(){this._nv.checkValid()},Xd.prototype.interfaces_=function(){return[]},Xd.prototype.getClass=function(){return Xd},Xd.toSegmentStrings=function(t){for(var e=new uu,n=t.iterator();n.hasNext();){var r=n.next();e.add(new Hd(r.getCoordinates(),r))}return e},Xd.checkValid=function(t){new Xd(t).checkValid()};var Zd=function(t){this._mapOp=t};Zd.prototype.map=function(t){for(var e=new uu,n=0;n<t.getNumGeometries();n++){var r=this._mapOp.map(t.getGeometryN(n));r.isEmpty()||e.add(r)}return t.getFactory().createGeometryCollection(_h.toGeometryArray(e))},Zd.prototype.interfaces_=function(){return[]},Zd.prototype.getClass=function(){return Zd},Zd.map=function(t,e){return new Zd(e).map(t)};var Yd=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new uu,this._resultLineList=new uu;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};Yd.prototype.collectLines=function(t){for(var e=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();e.collectLineEdge(r,t,e._lineEdgesList),e.collectBoundaryTouchEdge(r,t,e._lineEdgesList)}},Yd.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)},Yd.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},Yd.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&(t.isVisited()||!If.isResultOfOp(r,e)||i.isCovered()||(n.add(i),t.setVisitedEdge(!0)))},Yd.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next(),r=n.getEdge();if(n.isLineEdge()&&!r.isCoveredSet()){var i=this._op.isCoveredByA(n.getCoordinate());r.setCovered(i)}}},Yd.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),r=n.getLabel();n.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},Yd.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var n=e.next(),r=this._geometryFactory.createLineString(n.getCoordinates());this._resultLineList.add(r),n.setInResult(!0)}},Yd.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(Uc.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(If.isResultOfOp(r,e)&&e===If.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},Yd.prototype.interfaces_=function(){return[]},Yd.prototype.getClass=function(){return Yd};var $d=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new uu;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};$d.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}},$d.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(0===n.getEdges().getDegree()||t===If.INTERSECTION)){var r=n.getLabel();If.isResultOfOp(r,t)&&this.filterCoveredNodeToPoint(n)}}},$d.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},$d.prototype.interfaces_=function(){return[]},$d.prototype.getClass=function(){return $d};var Jd=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Jd.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Jd.prototype.transformPolygon=function(t,e){var n=!0,r=this.transformLinearRing(t.getExteriorRing(),t);null!==r&&r instanceof rh&&!r.isEmpty()||(n=!1);for(var i=new uu,o=0;o<t.getNumInteriorRing();o++){var a=this.transformLinearRing(t.getInteriorRingN(o),t);null===a||a.isEmpty()||(a instanceof rh||(n=!1),i.add(a))}if(n)return this._factory.createPolygon(r,i.toArray([]));var s=new uu;return null!==r&&s.add(r),s.addAll(i),this._factory.buildGeometry(s)},Jd.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},Jd.prototype.getInputGeometry=function(){return this._inputGeom},Jd.prototype.transformMultiLineString=function(t,e){for(var n=new uu,r=0;r<t.getNumGeometries();r++){var i=this.transformLineString(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Jd.prototype.transformCoordinates=function(t,e){return this.copy(t)},Jd.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Jd.prototype.transformMultiPoint=function(t,e){for(var n=new uu,r=0;r<t.getNumGeometries();r++){var i=this.transformPoint(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Jd.prototype.transformMultiPolygon=function(t,e){for(var n=new uu,r=0;r<t.getNumGeometries();r++){var i=this.transformPolygon(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Jd.prototype.copy=function(t){return t.copy()},Jd.prototype.transformGeometryCollection=function(t,e){for(var n=new uu,r=0;r<t.getNumGeometries();r++){var i=this.transform(t.getGeometryN(r));null!==i&&(this._pruneEmptyGeometry&&i.isEmpty()||n.add(i))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(_h.toGeometryArray(n)):this._factory.buildGeometry(n)},Jd.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Qu)return this.transformPoint(t,null);if(t instanceof nh)return this.transformMultiPoint(t,null);if(t instanceof rh)return this.transformLinearRing(t,null);if(t instanceof Ju)return this.transformLineString(t,null);if(t instanceof Bu)return this.transformMultiLineString(t,null);if(t instanceof eh)return this.transformPolygon(t,null);if(t instanceof ih)return this.transformMultiPolygon(t,null);if(t instanceof zu)return this.transformGeometryCollection(t,null);throw new nc("Unknown Geometry subtype: "+t.getClass().getName())},Jd.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)},Jd.prototype.interfaces_=function(){return[]},Jd.prototype.getClass=function(){return Jd};var Kd=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new vp,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Ju&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};Kd.prototype.snapVertices=function(t,e){for(var n=this._isClosed?t.size()-1:t.size(),r=0;r<n;r++){var i=t.get(r),o=this.findSnapForVertex(i,e);null!==o&&(t.set(r,new cc(o)),0===r&&this._isClosed&&t.set(t.size()-1,new cc(o)))}},Kd.prototype.findSnapForVertex=function(t,e){for(var n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this._snapTolerance)return e[n]}return null},Kd.prototype.snapTo=function(t){var e=new pu(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Kd.prototype.snapSegments=function(t,e){if(0===e.length)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var r=0;r<n;r++){var i=e[r],o=this.findSegmentIndexToSnap(i,t);o>=0&&t.add(o+1,new cc(i),!1)}},Kd.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,r=rc.MAX_VALUE,i=-1,o=0;o<e.size()-1;o++){if(n._seg.p0=e.get(o),n._seg.p1=e.get(o+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var a=n._seg.distance(t);a<n._snapTolerance&&a<r&&(r=a,i=o)}return i},Kd.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Kd.prototype.interfaces_=function(){return[]},Kd.prototype.getClass=function(){return Kd},Kd.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var Qd=function(t){this._srcGeom=t||null},tf={SNAP_PRECISION_FACTOR:{configurable:!0}};Qd.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t);return new ef(e,n).transform(this._srcGeom)},Qd.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new ef(t,n,!0).transform(this._srcGeom),i=r;return e&&mc(i,th)&&(i=r.buffer(0)),i},Qd.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},Qd.prototype.extractTargetCoordinates=function(t){for(var e=new Pu,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))},Qd.prototype.computeMinimumSegmentLength=function(t){for(var e=rc.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e},Qd.prototype.interfaces_=function(){return[]},Qd.prototype.getClass=function(){return Qd},Qd.snap=function(t,e,n){var r=new Array(2).fill(null),i=new Qd(t);r[0]=i.snapTo(e,n);var o=new Qd(e);return r[1]=o.snapTo(r[0],n),r},Qd.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Qd.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===mh.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min(Qd.computeOverlaySnapTolerance(i),Qd.computeOverlaySnapTolerance(o))}},Qd.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Qd.SNAP_PRECISION_FACTOR},Qd.snapToSelf=function(t,e,n){return new Qd(t).snapToSelf(e,n)},tf.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Qd,tf);var ef=function(t){function e(e,n,r){t.call(this),this._snapTolerance=e||null,this._snapPts=n||null,this._isSelfSnap=void 0!==r&&r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var n=new Kd(t,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var n=t.toCoordinateArray(),r=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Jd),nf=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};nf.prototype.getCommon=function(){return rc.longBitsToDouble(this._commonBits)},nf.prototype.add=function(t){var e=rc.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=nf.signExpBits(this._commonBits),this._isFirst=!1,null):nf.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=nf.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=nf.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},nf.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=rc.longBitsToDouble(t),n=rc.toBinaryString(t),r="0000000000000000000000000000000000000000000000000000000000000000"+n,i=r.substring(r.length-64),o=i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]";return o}},nf.prototype.interfaces_=function(){return[]},nf.prototype.getClass=function(){return nf},nf.getBit=function(t,e){return 0!=(t&1<<e)?1:0},nf.signExpBits=function(t){return t>>52},nf.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},nf.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if(nf.getBit(t,r)!==nf.getBit(e,r))return n;n++}return 52};var rf=function(){this._commonCoord=null,this._ccFilter=new af},of={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};rf.prototype.addCommonBits=function(t){var e=new sf(this._commonCoord);t.apply(e),t.geometryChanged()},rf.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new cc(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new sf(e);return t.apply(n),t.geometryChanged(),t},rf.prototype.getCommonCoordinate=function(){return this._commonCoord},rf.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},rf.prototype.interfaces_=function(){return[]},rf.prototype.getClass=function(){return rf},of.CommonCoordinateFilter.get=function(){return af},of.Translater.get=function(){return sf},Object.defineProperties(rf,of);var af=function(){this._commonBitsX=new nf,this._commonBitsY=new nf};af.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},af.prototype.getCommonCoordinate=function(){return new cc(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},af.prototype.interfaces_=function(){return[Kc]},af.prototype.getClass=function(){return af};var sf=function(){this.trans=null;var t=arguments[0];this.trans=t};sf.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)},sf.prototype.isDone=function(){return!1},sf.prototype.isGeometryChanged=function(){return!0},sf.prototype.interfaces_=function(){return[Fu]},sf.prototype.getClass=function(){return sf};var lf=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};lf.prototype.selfSnap=function(t){return new Qd(t).snapTo(t,this._snapTolerance)},lf.prototype.removeCommonBits=function(t){this._cbr=new rf,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},lf.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},lf.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=If.overlayOp(e[0],e[1],t);return this.prepareResult(n)},lf.prototype.checkValid=function(t){t.isValid()||Lc.out.println("Snapped geometry is invalid")},lf.prototype.computeSnapTolerance=function(){this._snapTolerance=Qd.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},lf.prototype.snap=function(t){var e=this.removeCommonBits(t);return Qd.snap(e[0],e[1],this._snapTolerance)},lf.prototype.interfaces_=function(){return[]},lf.prototype.getClass=function(){return lf},lf.overlayOp=function(t,e,n){return new lf(t,e).getResultGeometry(n)},lf.union=function(t,e){return lf.overlayOp(t,e,If.UNION)},lf.intersection=function(t,e){return lf.overlayOp(t,e,If.INTERSECTION)},lf.symDifference=function(t,e){return lf.overlayOp(t,e,If.SYMDIFFERENCE)},lf.difference=function(t,e){return lf.overlayOp(t,e,If.DIFFERENCE)};var cf=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};cf.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=If.overlayOp(this._geom[0],this._geom[1],t),n=!0}catch(t){if(!(t instanceof zc))throw t;r=t}if(!n)try{e=lf.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof zc?r:t}return e},cf.prototype.interfaces_=function(){return[]},cf.prototype.getClass=function(){return cf},cf.overlayOp=function(t,e,n){return new cf(t,e).getResultGeometry(n)},cf.union=function(t,e){return cf.overlayOp(t,e,If.UNION)},cf.intersection=function(t,e){return cf.overlayOp(t,e,If.INTERSECTION)},cf.symDifference=function(t,e){return cf.overlayOp(t,e,If.SYMDIFFERENCE)},cf.difference=function(t,e){return cf.overlayOp(t,e,If.DIFFERENCE)};var uf=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};uf.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},uf.prototype.interfaces_=function(){return[]},uf.prototype.getClass=function(){return uf};var hf=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=o}},pf={INSERT:{configurable:!0},DELETE:{configurable:!0}};hf.prototype.isDelete=function(){return this._eventType===hf.DELETE},hf.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},hf.prototype.getObject=function(){return this._obj},hf.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},hf.prototype.getInsertEvent=function(){return this._insertEvent},hf.prototype.isInsert=function(){return this._eventType===hf.INSERT},hf.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},hf.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},hf.prototype.interfaces_=function(){return[oc]},hf.prototype.getClass=function(){return hf},pf.INSERT.get=function(){return 1},pf.DELETE.get=function(){return 2},Object.defineProperties(hf,pf);var df=function(){};df.prototype.interfaces_=function(){return[]},df.prototype.getClass=function(){return df};var ff=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};ff.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(ff.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},ff.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ff.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},ff.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ff.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next().getCoordinate();if(t.isIntersection(r))return!0}return!1},ff.prototype.hasProperIntersection=function(){return this._hasProper},ff.prototype.hasIntersection=function(){return this._hasIntersection},ff.prototype.isDone=function(){return this._isDone},ff.prototype.isBoundaryPoint=function(t,e){return null!==e&&(!!this.isBoundaryPointInternal(t,e[0])||!!this.isBoundaryPointInternal(t,e[1]))},ff.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},ff.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},ff.prototype.interfaces_=function(){return[]},ff.prototype.getClass=function(){return ff},ff.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var mf=function(t){function e(){t.call(this),this.events=new uu,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){rp.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var n=0;n<this.events.size();n++){var r=t.events.get(n);if(r.isInsert()&&t.processOverlaps(n,r.getDeleteEventIndex(),r,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof ff&&mc(arguments[0],lu)&&mc(arguments[1],lu)){var i=arguments[0],o=arguments[1],a=arguments[2];this.addEdges(i,i),this.addEdges(o,o),this.computeIntersections(a)}else if("boolean"==typeof arguments[2]&&mc(arguments[0],lu)&&arguments[1]instanceof ff){var s=arguments[0],l=arguments[1],c=arguments[2];c?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(l)}},e.prototype.addEdge=function(t,e){for(var n=t.getMonotoneChainEdge(),r=n.getStartIndexes(),i=0;i<r.length-1;i++){var o=new uf(n,i),a=new hf(e,n.getMinX(i),o);this.events.add(a),this.events.add(new hf(n.getMaxX(i),a))}},e.prototype.processOverlaps=function(t,e,n,r){for(var i=n.getObject(),o=t;o<e;o++){var a=this.events.get(o);if(a.isInsert()){var s=a.getObject();n.isSameLabel(a)||(i.computeIntersections(s,r),this.nOverlaps++)}}},e.prototype.addEdges=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.addEdge(r,r)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],a=i.iterator();a.hasNext();){var s=a.next();t.addEdge(s,o)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(df),gf=function(){this._min=rc.POSITIVE_INFINITY,this._max=rc.NEGATIVE_INFINITY},yf={NodeComparator:{configurable:!0}};gf.prototype.getMin=function(){return this._min},gf.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},gf.prototype.getMax=function(){return this._max},gf.prototype.toString=function(){return Fc.toLineString(new cc(this._min,0),new cc(this._max,0))},gf.prototype.interfaces_=function(){return[]},gf.prototype.getClass=function(){return gf},yf.NodeComparator.get=function(){return vf},Object.defineProperties(gf,yf);var vf=function(){};vf.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,o=(r._min+r._max)/2;return i<o?-1:i>o?1:0},vf.prototype.interfaces_=function(){return[sc]},vf.prototype.getClass=function(){return vf};var _f=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],n=arguments[1],r=arguments[2];this._min=e,this._max=n,this._item=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;n.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gf),xf=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],n=arguments[1];this._node1=e,this._node2=n,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,n),null!==this._node2&&this._node2.query(t,e,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gf),bf=function(){this._leaves=new uu,this._root=null,this._level=0};bf.prototype.buildTree=function(){rp.sort(this._leaves,new gf.NodeComparator);for(var t=this._leaves,e=null,n=new uu;;){if(this.buildLevel(t,n),1===n.size())return n.get(0);e=t,t=n,n=e}},bf.prototype.insert=function(t,e,n){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new _f(t,e,n))},bf.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)},bf.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},bf.prototype.printNode=function(t){Lc.out.println(Fc.toLineString(new cc(t._min,this._level),new cc(t._max,this._level)))},bf.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},bf.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(r);else{var i=new xf(t.get(n),t.get(n+1));e.add(i)}}},bf.prototype.interfaces_=function(){return[]},bf.prototype.getClass=function(){return bf};var wf=function(){this._items=new uu};wf.prototype.visitItem=function(t){this._items.add(t)},wf.prototype.getItems=function(){return this._items},wf.prototype.interfaces_=function(){return[Qh]},wf.prototype.getClass=function(){return wf};var Mf=function(){this._index=null;var t=arguments[0];if(!mc(t,th))throw new nc("Argument must be Polygonal");this._index=new Tf(t)},Ef={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Mf.prototype.locate=function(t){var e=new Wc(t),n=new Sf(e);return this._index.query(t.y,t.y,n),e.getLocation()},Mf.prototype.interfaces_=function(){return[Vp]},Mf.prototype.getClass=function(){return Mf},Ef.SegmentVisitor.get=function(){return Sf},Ef.IntervalIndexedGeometry.get=function(){return Tf},Object.defineProperties(Mf,Ef);var Sf=function(){this._counter=null;var t=arguments[0];this._counter=t};Sf.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},Sf.prototype.interfaces_=function(){return[Qh]},Sf.prototype.getClass=function(){return Sf};var Tf=function(){this._index=new bf;var t=arguments[0];this.init(t)};Tf.prototype.init=function(t){for(var e=Ad.getLines(t).iterator();e.hasNext();){var n=e.next().getCoordinates();this.addLine(n)}},Tf.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var n=new vp(t[e-1],t[e]),r=Math.min(n.p0.y,n.p1.y),i=Math.max(n.p0.y,n.p1.y);this._index.insert(r,i,n)}},Tf.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new wf;return this._index.query(t,e,n),n.getItems()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._index.query(r,i,o)}},Tf.prototype.interfaces_=function(){return[]},Tf.prototype.getClass=function(){return Tf};var Af=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new fh,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Cd,2===arguments.length){var e=arguments[0],n=arguments[1],r=Qc.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=n,this._boundaryNodeRule=r,null!==n&&this.add(n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];this._argIndex=i,this._parentGeom=o,this._boundaryNodeRule=a,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,n){var r=this._nodes.addNode(n).getLabel(),i=1;r.getLocation(t,Ah.ON)===dc.BOUNDARY&&i++;var o=e.determineBoundary(this._boundaryNodeRule,i);r.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=new ff(n,!0,!1);o.setIsDoneIfProperInt(i);var a=this.createEdgeSetIntersector(),s=this._parentGeom instanceof rh||this._parentGeom instanceof eh||this._parentGeom instanceof ih,l=r||!s;return a.computeIntersections(this._edges,o,l),this.addSelfIntersectionNodes(this._argIndex),o}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,n){var r=new ff(e,n,!0);return r.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,r),r},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Qu){var t=arguments[0],e=t.getCoordinate();this.insertPoint(this._argIndex,e,dc.INTERIOR)}else if(arguments[0]instanceof cc){var n=arguments[0];this.insertPoint(this._argIndex,n,dc.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),dc.EXTERIOR,dc.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var n=t.getInteriorRingN(e);this.addPolygonRing(n,dc.INTERIOR,dc.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],dc.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],dc.BOUNDARY)},e.prototype.addLineString=function(t){var e=du.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var n=new od(e,new kh(this._argIndex,dc.INTERIOR));this._lineEdgeMap.put(t,n),this.insertEdge(n),Uc.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,r=t.iterator();r.hasNext();){var i=r.next();e[n++]=i.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,n){if(this.isBoundaryNode(t,e))return null;n===dc.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n)},e.prototype.addPolygonRing=function(t,e,n){if(t.isEmpty())return null;var r=du.removeRepeatedPoints(t.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=e,o=n;qc.isCCW(r)&&(i=n,o=e);var a=new od(r,new kh(this._argIndex,dc.BOUNDARY,i,o));this._lineEdgeMap.put(t,a),this.insertEdge(a),this.insertPoint(this._argIndex,r[0],dc.BOUNDARY)},e.prototype.insertPoint=function(t,e,n){var r=this._nodes.addNode(e),i=r.getLabel();null===i?r._label=new kh(t,n):i.setLocation(t,n)},e.prototype.createEdgeSetIntersector=function(){return new mf},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var n=e.next(),r=n.getLabel().getLocation(t),i=n.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(t,o.coord,r)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof ih&&(this._useBoundaryDeterminationRule=!1),e instanceof eh)this.addPolygon(e);else if(e instanceof Ju)this.addLineString(e);else if(e instanceof Qu)this.addPoint(e);else if(e instanceof nh)this.addCollection(e);else if(e instanceof Bu)this.addCollection(e);else if(e instanceof ih)this.addCollection(e);else{if(!(e instanceof zu))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},e.prototype.locate=function(t){return mc(this._parentGeom,th)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new Mf(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?dc.BOUNDARY:dc.INTERIOR},e}(Zh),Cf=function(){if(this._li=new Vc,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Af(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=Qc.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Af(0,e,r),this._arg[1]=new Af(1,n,r)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Af(0,i,a),this._arg[1]=new Af(1,o,a)}};Cf.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},Cf.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},Cf.prototype.interfaces_=function(){return[]},Cf.prototype.getClass=function(){return Cf};var Lf=function(){};Lf.prototype.interfaces_=function(){return[]},Lf.prototype.getClass=function(){return Lf},Lf.map=function(){if(arguments[0]instanceof Yc&&mc(arguments[1],Lf.MapOp)){for(var t=arguments[0],e=arguments[1],n=new uu,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));null!==i&&n.add(i)}return t.getFactory().buildGeometry(n)}if(mc(arguments[0],ou)&&mc(arguments[1],Lf.MapOp)){for(var o=arguments[0],a=arguments[1],s=new uu,l=o.iterator();l.hasNext();){var c=l.next(),u=a.map(c);null!==u&&s.add(u)}return s}},Lf.MapOp=function(){};var If=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n),this._ptLocator=new Cd,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new $p,this._resultPolyList=new uu,this._resultLineList=new uu,this._resultPointList=new uu,this._graph=new Zh(new Zp),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new kh(t.getLabel())).flip();var i=e.getDepth();i.isNull()&&i.add(n),i.add(r),n.merge(r)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,n,r,i){var o=new uu;return o.addAll(t),o.addAll(n),o.addAll(r),o.isEmpty()?e.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();if(this._ptLocator.locate(t,r)!==dc.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new uu,e=this._edgeList.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertUniqueEdge(n)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new uu;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Xd.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new Yh(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var r=new Yd(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(t);var i=new $d(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,n)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var n=e.next();this._graph.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea()&&!r.isInteriorAreaEdge()&&e.isResultOfOp(i.getLocation(0,Ah.RIGHT),i.getLocation(1,Ah.RIGHT),t)&&r.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),r=e.getDepth();if(!r.isNull()){r.normalize();for(var i=0;i<2;i++)n.isNull(i)||!n.isArea()||r.isNull(i)||(0===r.getDelta(i)?n.toLine(i):(Uc.isTrue(!r.isNull(i,Ah.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(i,Ah.LEFT,r.getLocation(i,Ah.LEFT)),Uc.isTrue(!r.isNull(i,Ah.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(i,Ah.RIGHT,r.getLocation(i,Ah.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getLabel();e.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(n)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Cf);If.overlayOp=function(t,e,n){return new If(t,e).getResultGeometry(n)},If.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return If.createEmptyResult(If.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Zd.map(t,{interfaces_:function(){return[Lf.MapOp]},map:function(t){return t.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),cf.overlayOp(t,e,If.INTERSECTION)},If.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return If.createEmptyResult(If.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),cf.overlayOp(t,e,If.SYMDIFFERENCE)},If.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),o=-1;switch(t){case If.INTERSECTION:o=Math.min(r,i);break;case If.UNION:o=Math.max(r,i);break;case If.DIFFERENCE:o=r;break;case If.SYMDIFFERENCE:o=Math.max(r,i)}return o},If.createEmptyResult=function(t,e,n,r){var i=null;switch(If.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon()}return i},If.difference=function(t,e){return t.isEmpty()?If.createEmptyResult(If.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),cf.overlayOp(t,e,If.DIFFERENCE))},If.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return If.isResultOfOp(n,r,e)}if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];switch(i===dc.BOUNDARY&&(i=dc.INTERIOR),o===dc.BOUNDARY&&(o=dc.INTERIOR),a){case If.INTERSECTION:return i===dc.INTERIOR&&o===dc.INTERIOR;case If.UNION:return i===dc.INTERIOR||o===dc.INTERIOR;case If.DIFFERENCE:return i===dc.INTERIOR&&o!==dc.INTERIOR;case If.SYMDIFFERENCE:return i===dc.INTERIOR&&o!==dc.INTERIOR||i!==dc.INTERIOR&&o===dc.INTERIOR}return!1}},If.INTERSECTION=1,If.UNION=2,If.DIFFERENCE=3,If.SYMDIFFERENCE=4;var Pf=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Cd,this._seg=new vp;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Pf.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=e._linework.getGeometryN(n).getCoordinateSequence(),i=0;i<r.size()-1;i++)if(r.getCoordinate(i,e._seg.p0),r.getCoordinate(i+1,e._seg.p1),e._seg.distance(t)<=e._boundaryDistanceTolerance)return!0;return!1},Pf.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?dc.BOUNDARY:this._ptLocator.locate(t,this._g)},Pf.prototype.extractLinework=function(t){var e=new Rf;t.apply(e);var n=e.getLinework(),r=_h.toLineStringArray(n);return t.getFactory().createMultiLineString(r)},Pf.prototype.interfaces_=function(){return[]},Pf.prototype.getClass=function(){return Pf};var Rf=function(){this._linework=null,this._linework=new uu};Rf.prototype.getLinework=function(){return this._linework},Rf.prototype.filter=function(t){if(t instanceof eh){var e=t;this._linework.add(e.getExteriorRing());for(var n=0;n<e.getNumInteriorRing();n++)this._linework.add(e.getInteriorRingN(n))}},Rf.prototype.interfaces_=function(){return[ku]},Rf.prototype.getClass=function(){return Rf};var Of=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Of.prototype.extractPoints=function(t,e,n){for(var r=t.getCoordinates(),i=0;i<r.length-1;i++)this.computeOffsetPoints(r[i],r[i+1],e,n)},Of.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},Of.prototype.getPoints=function(t){for(var e=new uu,n=Ad.getLines(this._g).iterator();n.hasNext();){var r=n.next();this.extractPoints(r,t,e)}return e},Of.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,o=e.y-t.y,a=Math.sqrt(i*i+o*o),s=n*i/a,l=n*o/a,c=(e.x+t.x)/2,u=(e.y+t.y)/2;if(this._doLeft){var h=new cc(c-l,u+s);r.add(h)}if(this._doRight){var p=new cc(c+l,u-s);r.add(p)}},Of.prototype.interfaces_=function(){return[]},Of.prototype.getClass=function(){return Of};var Df=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new uu;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new Pf(this._geom[0],this._boundaryDistanceTolerance),new Pf(this._geom[1],this._boundaryDistanceTolerance),new Pf(this._geom[2],this._boundaryDistanceTolerance)]},Nf={TOLERANCE:{configurable:!0}};Df.prototype.reportResult=function(t,e,n){Lc.out.println("Overlay result invalid - A:"+dc.toLocationSymbol(e[0])+" B:"+dc.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+dc.toLocationSymbol(e[2]))},Df.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e},Df.prototype.checkValid=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=0;n<this._testCoords.size();n++){var r=t._testCoords.get(n);if(!t.checkValid(e,r))return t._invalidLocation=r,!1}return!0}if(2===arguments.length){var i=arguments[0],o=arguments[1];return this._location[0]=this._locFinder[0].getLocation(o),this._location[1]=this._locFinder[1].getLocation(o),this._location[2]=this._locFinder[2].getLocation(o),!!Df.hasLocation(this._location,dc.BOUNDARY)||this.isValidResult(i,this._location)}},Df.prototype.addTestPts=function(t){var e=new Of(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},Df.prototype.isValidResult=function(t,e){var n=If.isResultOfOp(e[0],e[1],t),r=!(n^e[2]===dc.INTERIOR);return r||this.reportResult(t,e,n),r},Df.prototype.getInvalidLocation=function(){return this._invalidLocation},Df.prototype.interfaces_=function(){return[]},Df.prototype.getClass=function(){return Df},Df.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1},Df.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Qd.computeSizeBasedSnapTolerance(t),Qd.computeSizeBasedSnapTolerance(e))},Df.isValid=function(t,e,n,r){return new Df(t,e,r).isValid(n)},Nf.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Df,Nf);var kf=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};kf.prototype.extractElements=function(t,e){if(null===t)return null;for(var n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);this._skipEmpty&&r.isEmpty()||e.add(r)}},kf.prototype.combine=function(){for(var t=new uu,e=this._inputGeoms.iterator();e.hasNext();){var n=e.next();this.extractElements(n,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},kf.prototype.interfaces_=function(){return[]},kf.prototype.getClass=function(){return kf},kf.combine=function(){if(1===arguments.length){var t=arguments[0],e=new kf(t);return e.combine()}if(2===arguments.length){var n=arguments[0],r=arguments[1],i=new kf(kf.createList(n,r));return i.combine()}if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2],l=new kf(kf.createList(o,a,s));return l.combine()}},kf.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},kf.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new uu;return n.add(t),n.add(e),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],a=new uu;return a.add(r),a.add(i),a.add(o),a}};var Ff=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new uu)},zf={STRTREE_NODE_CAPACITY:{configurable:!0}};Ff.prototype.reduceToGeometries=function(t){for(var e=new uu,n=t.iterator();n.hasNext();){var r=n.next(),i=null;mc(r,lu)?i=this.unionTree(r):r instanceof Yc&&(i=r),e.add(i)}return e},Ff.prototype.extractByEnvelope=function(t,e,n){for(var r=new uu,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?r.add(o):n.add(o)}return this._geomFactory.buildGeometry(r)},Ff.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r))return kf.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var i=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,i)},Ff.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new cp(Ff.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree();return this.unionTree(r)},Ff.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=Ff.getGeometry(e,n);return this.unionSafe(i,null)}if(r-n==2)return this.unionSafe(Ff.getGeometry(e,n),Ff.getGeometry(e,n+1));var o=Math.trunc((r+n)/2),a=this.binaryUnion(e,n,o),s=this.binaryUnion(e,o,r);return this.unionSafe(a,s)}},Ff.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e=null===e?r.copy():e.union(r)}return e},Ff.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Ff.prototype.unionActual=function(t,e){return Ff.restrictToPolygons(t.union(e))},Ff.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Ff.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new uu,i=this.extractByEnvelope(n,t,r),o=this.extractByEnvelope(n,e,r),a=this.unionActual(i,o);return r.add(a),kf.combine(r)},Ff.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),r=n.buffer(0);return r}if(2===arguments.length){var i=arguments[0],o=arguments[1],a=i.getFactory(),s=a.createGeometryCollection([i,o]),l=s.buffer(0);return l}},Ff.prototype.interfaces_=function(){return[]},Ff.prototype.getClass=function(){return Ff},Ff.restrictToPolygons=function(t){if(mc(t,th))return t;var e=Td.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(_h.toPolygonArray(e))},Ff.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Ff.union=function(t){return new Ff(t).union()},zf.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Ff,zf);var Bf=function(){};function Uf(){return new jf}function jf(){this.reset()}Bf.prototype.interfaces_=function(){return[]},Bf.prototype.getClass=function(){return Bf},Bf.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return If.createEmptyResult(If.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),cf.overlayOp(t,e,If.UNION)},jf.prototype={constructor:jf,reset:function(){this.s=this.t=0},add:function(t){Vf(Gf,t,this.t),Vf(this,Gf.s,this.s),this.s?this.t+=Gf.t:this.s=Gf.t},valueOf:function(){return this.s}};var Gf=new jf;function Vf(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}var Hf=1e-6,Wf=Math.PI,qf=Wf/2,Xf=Wf/4,Zf=2*Wf,Yf=180/Wf,$f=Wf/180,Jf=Math.abs,Kf=Math.atan,Qf=Math.atan2,tm=Math.cos,em=Math.sin,nm=Math.sqrt;function rm(t){return t>1?0:t<-1?Wf:Math.acos(t)}function im(t){return t>1?qf:t<-1?-qf:Math.asin(t)}function om(){}function am(t,e){t&&um.hasOwnProperty(t.type)&&um[t.type](t,e)}var sm,lm,cm={Feature:function(t,e){am(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)am(n[r].geometry,e)}},um={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){hm(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)hm(n[r],e,0)},Polygon:function(t,e){pm(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)pm(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)am(n[r],e)}};function hm(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function pm(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)hm(t[n],e,1);e.polygonEnd()}function dm(t){return[Qf(t[1],t[0]),im(t[2])]}function fm(t){var e=t[0],n=t[1],r=tm(n);return[r*tm(e),r*em(e),em(n)]}function mm(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function gm(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ym(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function vm(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function _m(t){var e=nm(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function xm(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n}function bm(t,e){return[t>Wf?t-Zf:t<-Wf?t+Zf:t,e]}function wm(t){return function(e,n){return[(e+=t)>Wf?e-Zf:e<-Wf?e+Zf:e,n]}}function Mm(t){var e=wm(t);return e.invert=wm(-t),e}function Em(t,e){var n=tm(t),r=em(t),i=tm(e),o=em(e);function a(t,e){var a=tm(e),s=tm(t)*a,l=em(t)*a,c=em(e),u=c*n+s*r;return[Qf(l*i-u*o,s*n-c*r),im(u*i+l*o)]}return a.invert=function(t,e){var a=tm(e),s=tm(t)*a,l=em(t)*a,c=em(e),u=c*i-l*o;return[Qf(l*i+c*o,s*n+u*r),im(u*n-s*r)]},a}function Sm(t,e){(e=fm(e))[0]-=t,_m(e);var n=rm(-e[1]);return((-e[2]<0?-n:n)+Zf-Hf)%Zf}function Tm(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:om,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Am(t,e){return Jf(t[0]-e[0])<Hf&&Jf(t[1]-e[1])<Hf}function Cm(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Lm(t,e,n,r,i){var o,a,s=[],l=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],a=t[e];if(Am(r,a)){for(i.lineStart(),o=0;o<e;++o)i.point((r=t[o])[0],r[1]);i.lineEnd()}else s.push(n=new Cm(r,t,null,!0)),l.push(n.o=new Cm(r,null,n,!1)),s.push(n=new Cm(a,t,null,!1)),l.push(n.o=new Cm(a,null,n,!0))}})),s.length){for(l.sort(e),Im(s),Im(l),o=0,a=l.length;o<a;++o)l[o].e=n=!n;for(var c,u,h=s[0];;){for(var p=h,d=!0;p.v;)if((p=p.n)===h)return;c=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(o=0,a=c.length;o<a;++o)i.point((u=c[o])[0],u[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(d)for(c=p.p.z,o=c.length-1;o>=0;--o)i.point((u=c[o])[0],u[1]);else r(p.x,p.p.x,-1,i);p=p.p}c=(p=p.o).z,d=!d}while(!p.v);i.lineEnd()}}}function Im(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function Pm(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Rm(t){for(var e,n,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(n=new Array(a);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--a]=r[e];return n}Uf(),Uf(),Uf(),bm.invert=bm,1===(sm=Pm).length&&(lm=sm,sm=function(t,e){return Pm(lm(t),e)});var Om=1e9,Dm=-Om;function Nm(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,s,c){var u=0,h=0;if(null==i||(u=a(i,s))!==(h=a(o,s))||l(i,o)<0^s>0)do{c.point(0===u||3===u?t:n,u>1?r:e)}while((u=(u+s+4)%4)!==h);else c.point(o[0],o[1])}function a(r,i){return Jf(r[0]-t)<Hf?i>0?0:3:Jf(r[0]-n)<Hf?i>0?2:1:Jf(r[1]-e)<Hf?i>0?1:0:i>0?3:2}function s(t,e){return l(t.x,e.x)}function l(t,e){var n=a(t,1),r=a(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var l,c,u,h,p,d,f,m,g,y,v,_=a,x=Tm(),b={point:w,lineStart:function(){b.point=M,c&&c.push(u=[]),y=!0,g=!1,f=m=NaN},lineEnd:function(){l&&(M(h,p),d&&g&&x.rejoin(),l.push(x.result())),b.point=w,g&&_.lineEnd()},polygonStart:function(){_=x,l=[],c=[],v=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=c.length;n<i;++n)for(var o,a,s=c[n],l=1,u=s.length,h=s[0],p=h[0],d=h[1];l<u;++l)o=p,a=d,p=(h=s[l])[0],d=h[1],a<=r?d>r&&(p-o)*(r-a)>(d-a)*(t-o)&&++e:d<=r&&(p-o)*(r-a)<(d-a)*(t-o)&&--e;return e}(),n=v&&e,i=(l=Rm(l)).length;(n||i)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),i&&Lm(l,s,e,o,a),a.polygonEnd()),_=a,l=c=u=null}};function w(t,e){i(t,e)&&_.point(t,e)}function M(o,a){var s=i(o,a);if(c&&u.push([o,a]),y)h=o,p=a,d=s,y=!1,s&&(_.lineStart(),_.point(o,a));else if(s&&g)_.point(o,a);else{var l=[f=Math.max(Dm,Math.min(Om,f)),m=Math.max(Dm,Math.min(Om,m))],x=[o=Math.max(Dm,Math.min(Om,o)),a=Math.max(Dm,Math.min(Om,a))];!function(t,e,n,r,i,o){var a,s=t[0],l=t[1],c=0,u=1,h=e[0]-s,p=e[1]-l;if(a=n-s,h||!(a>0)){if(a/=h,h<0){if(a<c)return;a<u&&(u=a)}else if(h>0){if(a>u)return;a>c&&(c=a)}if(a=i-s,h||!(a<0)){if(a/=h,h<0){if(a>u)return;a>c&&(c=a)}else if(h>0){if(a<c)return;a<u&&(u=a)}if(a=r-l,p||!(a>0)){if(a/=p,p<0){if(a<c)return;a<u&&(u=a)}else if(p>0){if(a>u)return;a>c&&(c=a)}if(a=o-l,p||!(a<0)){if(a/=p,p<0){if(a>u)return;a>c&&(c=a)}else if(p>0){if(a<c)return;a<u&&(u=a)}return c>0&&(t[0]=s+c*h,t[1]=l+c*p),u<1&&(e[0]=s+u*h,e[1]=l+u*p),!0}}}}}(l,x,t,e,n,r)?s&&(_.lineStart(),_.point(o,a),v=!1):(g||(_.lineStart(),_.point(l[0],l[1])),_.point(x[0],x[1]),s||_.lineEnd(),v=!1)}f=o,m=a,g=s}return b}}var km=Uf();function Fm(t){return t}Uf(),Uf(),Uf();var zm=1/0,Bm=zm,Um=-zm,jm=Um,Gm={point:function(t,e){t<zm&&(zm=t),t>Um&&(Um=t),e<Bm&&(Bm=e),e>jm&&(jm=e)},lineStart:om,lineEnd:om,polygonStart:om,polygonEnd:om,result:function(){var t=[[zm,Bm],[Um,jm]];return Um=jm=-(Bm=zm=1/0),t}};function Vm(t,e,n,r){return function(i,o){var a,s,l,c=e(o),u=i.invert(r[0],r[1]),h=Tm(),p=e(h),d=!1,f={point:m,lineStart:y,lineEnd:v,polygonStart:function(){f.point=_,f.lineStart=x,f.lineEnd=b,s=[],a=[]},polygonEnd:function(){f.point=m,f.lineStart=y,f.lineEnd=v,s=Rm(s);var t=function(t,e){var n=e[0],r=e[1],i=[em(n),-tm(n),0],o=0,a=0;km.reset();for(var s=0,l=t.length;s<l;++s)if(u=(c=t[s]).length)for(var c,u,h=c[u-1],p=h[0],d=h[1]/2+Xf,f=em(d),m=tm(d),g=0;g<u;++g,p=v,f=x,m=b,h=y){var y=c[g],v=y[0],_=y[1]/2+Xf,x=em(_),b=tm(_),w=v-p,M=w>=0?1:-1,E=M*w,S=E>Wf,T=f*x;if(km.add(Qf(T*M*em(E),m*b+T*tm(E))),o+=S?w+M*Zf:w,S^p>=n^v>=n){var A=gm(fm(h),fm(y));_m(A);var C=gm(i,A);_m(C);var L=(S^w>=0?-1:1)*im(C[2]);(r>L||r===L&&(A[0]||A[1]))&&(a+=S^w>=0?1:-1)}}return(o<-1e-6||o<Hf&&km<-1e-6)^1&a}(a,u);s.length?(d||(o.polygonStart(),d=!0),Lm(s,Wm,t,n,o)):t&&(d||(o.polygonStart(),d=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),d&&(o.polygonEnd(),d=!1),s=a=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function m(e,n){var r=i(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function g(t,e){var n=i(t,e);c.point(n[0],n[1])}function y(){f.point=g,c.lineStart()}function v(){f.point=m,c.lineEnd()}function _(t,e){l.push([t,e]);var n=i(t,e);p.point(n[0],n[1])}function x(){p.lineStart(),l=[]}function b(){_(l[0][0],l[0][1]),p.lineEnd();var t,e,n,r,i=p.clean(),c=h.result(),u=c.length;if(l.pop(),a.push(l),l=null,u)if(1&i){if((e=(n=c[0]).length-1)>0){for(d||(o.polygonStart(),d=!0),o.lineStart(),t=0;t<e;++t)o.point((r=n[t])[0],r[1]);o.lineEnd()}}else u>1&&2&i&&c.push(c.pop().concat(c.shift())),s.push(c.filter(Hm))}return f}}function Hm(t){return t.length>1}function Wm(t,e){return((t=t.x)[0]<0?t[1]-qf-Hf:qf-t[1])-((e=e.x)[0]<0?e[1]-qf-Hf:qf-e[1])}Uf();var qm=Vm((function(){return!0}),(function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?Wf:-Wf,l=Jf(o-n);Jf(l-Wf)<Hf?(t.point(n,r=(r+a)/2>0?qf:-qf),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(o,r),e=0):i!==s&&l>=Wf&&(Jf(n-i)<Hf&&(n-=i*Hf),Jf(o-s)<Hf&&(o-=s*Hf),r=function(t,e,n,r){var i,o,a=em(t-n);return Jf(a)>Hf?Kf((em(e)*(o=tm(r))*em(n)-em(r)*(i=tm(e))*em(t))/(i*o*a)):(e+r)/2}(n,r,o,a),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),e=0),t.point(n=o,r=a),i=s},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}}),(function(t,e,n,r){var i;if(null==t)i=n*qf,r.point(-Wf,i),r.point(0,i),r.point(Wf,i),r.point(Wf,0),r.point(Wf,-i),r.point(0,-i),r.point(-Wf,-i),r.point(-Wf,0),r.point(-Wf,i);else if(Jf(t[0]-e[0])>Hf){var o=t[0]<e[0]?Wf:-Wf;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}),[-Wf,-qf]);function Xm(t,e){var n=tm(t),r=n>0,i=Jf(n)>Hf;function o(t,e){return tm(t)*tm(e)>n}function a(t,e,r){var i=[1,0,0],o=gm(fm(t),fm(e)),a=mm(o,o),s=o[0],l=a-s*s;if(!l)return!r&&t;var c=n*a/l,u=-n*s/l,h=gm(i,o),p=vm(i,c);ym(p,vm(o,u));var d=h,f=mm(p,d),m=mm(d,d),g=f*f-m*(mm(p,p)-1);if(!(g<0)){var y=nm(g),v=vm(d,(-f-y)/m);if(ym(v,p),v=dm(v),!r)return v;var _,x=t[0],b=e[0],w=t[1],M=e[1];b<x&&(_=x,x=b,b=_);var E=b-x,S=Jf(E-Wf)<Hf;if(!S&&M<w&&(_=w,w=M,M=_),S||E<Hf?S?w+M>0^v[1]<(Jf(v[0]-x)<Hf?w:M):w<=v[1]&&v[1]<=M:E>Wf^(x<=v[0]&&v[0]<=b)){var T=vm(d,(-f+y)/m);return ym(T,p),[v,dm(T)]}}}function s(e,n){var i=r?t:Wf-t,o=0;return e<-i?o|=1:e>i&&(o|=2),n<-i?o|=4:n>i&&(o|=8),o}return Vm(o,(function(t){var e,n,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(h,p){var d,f=[h,p],m=o(h,p),g=r?m?0:s(h,p):m?s(h+(h<0?Wf:-Wf),p):0;if(!e&&(c=l=m)&&t.lineStart(),m!==l&&(!(d=a(e,f))||Am(e,d)||Am(f,d))&&(f[0]+=Hf,f[1]+=Hf,m=o(f[0],f[1])),m!==l)u=0,m?(t.lineStart(),d=a(f,e),t.point(d[0],d[1])):(d=a(e,f),t.point(d[0],d[1]),t.lineEnd()),e=d;else if(i&&e&&r^m){var y;g&n||!(y=a(f,e,!0))||(u=0,r?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1])))}!m||e&&Am(e,f)||t.point(f[0],f[1]),e=f,l=m,n=g},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return u|(c&&l)<<1}}}),(function(n,r,i,o){!function(t,e,n,r,i,o){if(n){var a=tm(e),s=em(e),l=r*n;null==i?(i=e+r*Zf,o=e-l/2):(i=Sm(a,i),o=Sm(a,o),(r>0?i<o:i>o)&&(i+=r*Zf));for(var c,u=i;r>0?u>o:u<o;u-=l)c=dm([a,-s*tm(u),-s*em(u)]),t.point(c[0],c[1])}}(o,t,e,i,n,r)}),r?[0,-t]:[-Wf,t-Wf])}function Zm(t){return function(e){var n=new Ym;for(var r in t)n[r]=t[r];return n.stream=e,n}}function Ym(){}function $m(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),function(t,e){t&&cm.hasOwnProperty(t.type)?cm[t.type](t,e):am(t,e)}(n,t.stream(Gm));var a=Gm.result(),s=Math.min(r/(a[1][0]-a[0][0]),i/(a[1][1]-a[0][1])),l=+e[0][0]+(r-s*(a[1][0]+a[0][0]))/2,c=+e[0][1]+(i-s*(a[1][1]+a[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*s).translate([l,c])}Ym.prototype={constructor:Ym,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Jm=tm(30*$f);function Km(t,e){return+e?function(t,e){function n(r,i,o,a,s,l,c,u,h,p,d,f,m,g){var y=c-r,v=u-i,_=y*y+v*v;if(_>4*e&&m--){var x=a+p,b=s+d,w=l+f,M=nm(x*x+b*b+w*w),E=im(w/=M),S=Jf(Jf(w)-1)<Hf||Jf(o-h)<Hf?(o+h)/2:Qf(b,x),T=t(S,E),A=T[0],C=T[1],L=A-r,I=C-i,P=v*L-y*I;(P*P/_>e||Jf((y*L+v*I)/_-.5)>.3||a*p+s*d+l*f<Jm)&&(n(r,i,o,a,s,l,A,C,S,x/=M,b/=M,w,m,g),g.point(A,C),n(A,C,S,x,b,w,c,u,h,p,d,f,m,g))}}return function(e){var r,i,o,a,s,l,c,u,h,p,d,f,m={point:g,lineStart:y,lineEnd:_,polygonStart:function(){e.polygonStart(),m.lineStart=x},polygonEnd:function(){e.polygonEnd(),m.lineStart=y}};function g(n,r){n=t(n,r),e.point(n[0],n[1])}function y(){u=NaN,m.point=v,e.lineStart()}function v(r,i){var o=fm([r,i]),a=t(r,i);n(u,h,c,p,d,f,u=a[0],h=a[1],c=r,p=o[0],d=o[1],f=o[2],16,e),e.point(u,h)}function _(){m.point=g,e.lineEnd()}function x(){y(),m.point=b,m.lineEnd=w}function b(t,e){v(r=t,e),i=u,o=h,a=p,s=d,l=f,m.point=v}function w(){n(u,h,c,p,d,f,i,o,r,a,s,l,16,e),m.lineEnd=_,_()}return m}}(t,e):function(t){return Zm({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)}var Qm=Zm({point:function(t,e){this.stream.point(t*$f,e*$f)}});function tg(t){return function(t){var e,n,r,i,o,a,s,l,c,u,h=150,p=480,d=250,f=0,m=0,g=0,y=0,v=0,_=null,x=qm,b=null,w=Fm,M=.5,E=Km(A,M);function S(t){return[(t=o(t[0]*$f,t[1]*$f))[0]*h+n,r-t[1]*h]}function T(t){return(t=o.invert((t[0]-n)/h,(r-t[1])/h))&&[t[0]*Yf,t[1]*Yf]}function A(t,i){return[(t=e(t,i))[0]*h+n,r-t[1]*h]}function C(){o=xm(i=function(t,e,n){return(t%=Zf)?e||n?xm(Mm(t),Em(e,n)):Mm(t):e||n?Em(e,n):bm}(g,y,v),e);var t=e(f,m);return n=p-t[0]*h,r=d+t[1]*h,L()}function L(){return c=u=null,S}return S.stream=function(t){return c&&u===t?c:c=Qm(x(i,E(w(u=t))))},S.clipAngle=function(t){return arguments.length?(x=+t?Xm(_=t*$f,6*$f):(_=null,qm),L()):_*Yf},S.clipExtent=function(t){return arguments.length?(w=null==t?(b=a=s=l=null,Fm):Nm(b=+t[0][0],a=+t[0][1],s=+t[1][0],l=+t[1][1]),L()):null==b?null:[[b,a],[s,l]]},S.scale=function(t){return arguments.length?(h=+t,C()):h},S.translate=function(t){return arguments.length?(p=+t[0],d=+t[1],C()):[p,d]},S.center=function(t){return arguments.length?(f=t[0]%360*$f,m=t[1]%360*$f,C()):[f*Yf,m*Yf]},S.rotate=function(t){return arguments.length?(g=t[0]%360*$f,y=t[1]%360*$f,v=t.length>2?t[2]%360*$f:0,C()):[g*Yf,y*Yf,v*Yf]},S.precision=function(t){return arguments.length?(E=Km(A,M=t*t),L()):nm(M)},S.fitExtent=function(t,e){return $m(S,t,e)},S.fitSize=function(t,e){return function(t,e,n){return $m(t,[[0,0],e],n)}(S,t,e)},function(){return e=t.apply(this,arguments),S.invert=e.invert&&T,C()}}((function(){return t}))()}var eg=function(t){return function(e,n){var r=tm(e),i=tm(n),o=t(r*i);return[o*i*em(e),o*em(n)]}}((function(t){return(t=rm(t))&&t/em(t)}));function ng(){return tg(eg).scale(79.4188).clipAngle(179.999)}function rg(t,e,r,i){var o=t.properties||{},s="Feature"===t.type?t.geometry:t;if("GeometryCollection"===s.type){var l=[];return U(t,(function(t){var n=rg(t,e,r,i);n&&l.push(n)})),f(l)}var c=function(t){var e=bn(t).geometry.coordinates,r=[-e[0],-e[1]];return ng().rotate(r).scale(n)}(s),u={type:s.type,coordinates:og(s.coordinates,c)},h=(new Sh).read(u),p=x(b(e,r),"meters"),d=vd.bufferOp(h,p,i);if(!ig((d=(new Th).write(d)).coordinates))return a({type:d.type,coordinates:ag(d.coordinates,c)},o)}function ig(t){return Array.isArray(t[0])?ig(t[0]):isNaN(t[0])}function og(t,e){return"object"!=typeof t[0]?e(t):t.map((function(t){return og(t,e)}))}function ag(t,e){return"object"!=typeof t[0]?e.invert(t):t.map((function(t){return ag(t,e)}))}function sg(t,e,n){void 0===n&&(n={});var r=it(t),i=it(e),o=tc.intersection(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?u(o[0],n.properties):y(o,n.properties)}function lg(t,e,n){void 0===n&&(n={});var r=JSON.stringify(n.properties||{}),i=t[0],o=t[1],a=t[2],s=t[3],l=(o+s)/2,c=(i+a)/2,u=2*e/xe([i,l],[a,l],n)*(a-i),h=2*e/xe([c,o],[c,s],n)*(s-o),p=u/2,d=2*p,m=Math.sqrt(3)/2*h,g=a-i,y=s-o,v=3/4*d,_=m,x=(g-d)/(d-p/2),b=Math.floor(x),w=(b*v-p/2-g)/2-p/2+v/2,M=Math.floor((y-m)/m),E=(y-M*m)/2,S=M*m-y>m/2;S&&(E-=m/4);for(var T=[],A=[],C=0;C<6;C++){var L=2*Math.PI/6*C;T.push(Math.cos(L)),A.push(Math.sin(L))}for(var I=[],P=0;P<=b;P++)for(var R=0;R<=M;R++){var O=P%2==1;if((0!==R||!O)&&(0!==R||!S)){var D=P*v+i-w,N=R*_+o+E;if(O&&(N-=m/2),!0===n.triangles)ug([D,N],u/2,h/2,JSON.parse(r),T,A).forEach((function(t){n.mask?sg(n.mask,t)&&I.push(t):I.push(t)}));else{var k=cg([D,N],u/2,h/2,JSON.parse(r),T,A);n.mask?sg(n.mask,k)&&I.push(k):I.push(k)}}}return f(I)}function cg(t,e,n,r,i,o){for(var a=[],s=0;s<6;s++){var l=t[0]+e*i[s],c=t[1]+n*o[s];a.push([l,c])}return a.push(a[0].slice()),u([a],r)}function ug(t,e,n,r,i,o){for(var a=[],s=0;s<6;s++){var l=[];l.push(t),l.push([t[0]+e*i[s],t[1]+n*o[s]]),l.push([t[0]+e*i[(s+1)%6],t[1]+n*o[(s+1)%6]]),l.push(t),a.push(u([l],r))}return a}function hg(t){return y(t)}function pg(t){return u(t&&t.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]])}function dg(t,e,n){return void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});for(var i=[],o=t[0],a=t[1],s=t[2],l=t[3],c=e/xe([o,a],[s,a],r)*(s-o),h=n/xe([o,a],[o,l],r)*(l-a),p=s-o,d=l-a,m=Math.floor(p/c),g=Math.floor(d/h),y=(d-g*h)/2,v=o+(p-m*c)/2,_=0;_<m;_++){for(var x=a+y,b=0;b<g;b++){var w=u([[[v,x],[v,x+h],[v+c,x+h],[v+c,x],[v,x]]],r.properties);r.mask?La(r.mask,w)&&i.push(w):i.push(w),x+=h}v+=c}return f(i)}(t,e,e,n)}function fg(t,e,n){void 0===n&&(n={});for(var r=[],i=e/xe([t[0],t[1]],[t[2],t[1]],n)*(t[2]-t[0]),o=e/xe([t[0],t[1]],[t[0],t[3]],n)*(t[3]-t[1]),a=0,s=t[0];s<=t[2];){for(var l=0,c=t[1];c<=t[3];){var h=null,p=null;a%2==0&&l%2==0?(h=u([[[s,c],[s,c+o],[s+i,c],[s,c]]],n.properties),p=u([[[s,c+o],[s+i,c+o],[s+i,c],[s,c+o]]],n.properties)):a%2==0&&l%2==1?(h=u([[[s,c],[s+i,c+o],[s+i,c],[s,c]]],n.properties),p=u([[[s,c],[s,c+o],[s+i,c+o],[s,c]]],n.properties)):l%2==0&&a%2==1?(h=u([[[s,c],[s,c+o],[s+i,c+o],[s,c]]],n.properties),p=u([[[s,c],[s+i,c+o],[s+i,c],[s,c]]],n.properties)):l%2==1&&a%2==1&&(h=u([[[s,c],[s,c+o],[s+i,c],[s,c]]],n.properties),p=u([[[s,c+o],[s+i,c+o],[s+i,c],[s,c+o]]],n.properties)),n.mask?(sg(n.mask,h)&&r.push(h),sg(n.mask,p)&&r.push(p)):(r.push(h),r.push(p)),c+=o,l++}a++,s+=i}return f(r)}eg.invert=function(t){return function(e,n){var r=nm(e*e+n*n),i=t(r),o=em(i),a=tm(i);return[Qf(e*o,r*a),im(r&&n*o/r)]}}((function(t){return t})),e.along=function(t,e,n){void 0===n&&(n={});for(var r=it(t).coordinates,i=0,o=0;o<r.length&&!(e>=i&&o===r.length-1);o++){if(i>=e){var a=e-i;if(a){var s=xn(r[o],r[o-1])-180;return vn(r[o],a,s,n)}return l(r[o])}i+=xe(r[o],r[o+1],n)}return l(r[r.length-1])},e.angle=function(t,e,n,r){if(void 0===r&&(r={}),!L(r))throw new Error("options is invalid");if(!t)throw new Error("startPoint is required");if(!e)throw new Error("midPoint is required");if(!n)throw new Error("endPoint is required");var i=t,o=e,a=n,s=M(!0!==r.mercator?xn(i,o):ji(i,o)),l=M(!0!==r.mercator?xn(a,o):ji(a,o)),c=Math.abs(s-l);return!0===r.explementary?360-c:c},e.applyFilter=cl,e.area=Vr,e.areaFactors=o,e.bbox=J,e.bboxClip=function(t,e){var n=it(t),r=n.type,i="Feature"===t.type?t.properties:{},o=n.coordinates;switch(r){case"LineString":case"MultiLineString":var a=[];return"LineString"===r&&(o=[o]),o.forEach((function(t){!function(t,e,n){var r,i,o,a,s,l=t.length,c=Oi(t[0],e),u=[];for(n||(n=[]),r=1;r<l;r++){for(a=t[r-1],i=o=Oi(s=t[r],e);;){if(!(c|i)){u.push(a),i!==o?(u.push(s),r<l-1&&(n.push(u),u=[])):r===l-1&&u.push(s);break}if(c&i)break;c?c=Oi(a=Ri(a,s,c,e),e):i=Oi(s=Ri(a,s,i,e),e)}c=o}u.length&&n.push(u)}(t,e,a)})),1===a.length?p(a[0],i):m(a,i);case"Polygon":return u(Di(o,e),i);case"MultiPolygon":return y(o.map((function(t){return Di(t,e)})),i);default:throw new Error("geometry "+r+" not supported")}},e.bboxPolygon=mn,e.bearing=xn,e.bearingToAngle=M,e.bearingToAzimuth=M,e.bezier=fn,e.bezierSpline=fn,e.booleanClockwise=Xi,e.booleanContains=function(t,e){var n=it(t),r=it(e),i=n.type,o=r.type,a=n.coordinates,s=r.coordinates;switch(i){case"Point":switch(o){case"Point":return va(a,s);default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"Point":return function(t,e){var n,r=!1;for(n=0;n<t.coordinates.length;n++)if(va(t.coordinates[n],e.coordinates)){r=!0;break}return r}(n,r);case"MultiPoint":return function(t,e){for(var n=0,r=e.coordinates;n<r.length;n++){for(var i=r[n],o=!1,a=0,s=t.coordinates;a<s.length;a++)if(va(i,s[a])){o=!0;break}if(!o)return!1}return!0}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"Point":return Yr(r,n,{ignoreEndVertices:!0});case"LineString":return function(t,e){for(var n=!1,r=0,i=e.coordinates;r<i.length;r++){var o=i[r];if(Yr({type:"Point",coordinates:o},t,{ignoreEndVertices:!0})&&(n=!0),!Yr({type:"Point",coordinates:o},t,{ignoreEndVertices:!1}))return!1}return n}(n,r);case"MultiPoint":return function(t,e){for(var n=!1,r=0,i=e.coordinates;r<i.length;r++){var o=i[r];if(Yr(o,t,{ignoreEndVertices:!0})&&(n=!0),!Yr(o,t))return!1}return!!n}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Point":return ye(r,n,{ignoreBoundary:!0});case"LineString":return function(t,e){var n=!1,r=0,i=J(t),o=J(e);if(!ya(i,o))return!1;for(;r<e.coordinates.length-1;r++)if(ye({type:"Point",coordinates:_a(e.coordinates[r],e.coordinates[r+1])},t,{ignoreBoundary:!0})){n=!0;break}return n}(n,r);case"Polygon":return function(t,e){if("Feature"===t.type&&null===t.geometry)return!1;if("Feature"===e.type&&null===e.geometry)return!1;var n=J(t),r=J(e);if(!ya(n,r))return!1;for(var i=it(e).coordinates,o=0,a=i;o<a.length;o++)for(var s=0,l=a[o];s<l.length;s++)if(!ye(l[s],t))return!1;return!0}(n,r);case"MultiPoint":return function(t,e){for(var n=0,r=e.coordinates;n<r.length;n++)if(!ye(r[n],t,{ignoreBoundary:!0}))return!1;return!0}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}},e.booleanCrosses=function(t,e){var n=it(t),r=it(e),i=n.type,o=r.type;switch(i){case"MultiPoint":switch(o){case"LineString":return xa(n,r);case"Polygon":return wa(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"MultiPoint":return xa(r,n);case"LineString":return function(t,e){if(Rr(t,e).features.length>0)for(var n=0;n<t.coordinates.length-1;n++)for(var r=0;r<e.coordinates.length-1;r++){var i=!0;if(0!==r&&r!==e.coordinates.length-2||(i=!1),Ma(t.coordinates[n],t.coordinates[n+1],e.coordinates[r],i))return!0}return!1}(n,r);case"Polygon":return ba(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"MultiPoint":return wa(r,n);case"LineString":return ba(r,n);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}},e.booleanDisjoint=da,e.booleanEqual=function(t,e){return it(t).type===it(e).type&&new Ca({precision:6}).compare(en(t),en(e))},e.booleanIntersects=La,e.booleanOverlap=function(t,e){var n=it(t),r=it(e),i=n.type,o=r.type;if("MultiPoint"===i&&"MultiPoint"!==o||("LineString"===i||"MultiLineString"===i)&&"LineString"!==o&&"MultiLineString"!==o||("Polygon"===i||"MultiPolygon"===i)&&"Polygon"!==o&&"MultiPolygon"!==o)throw new Error("features must be of the same type");if("Point"===i)throw new Error("Point geometry not supported");if(new Ca({precision:6}).compare(t,e))return!1;var a=0;switch(i){case"MultiPoint":for(var s=0;s<n.coordinates.length;s++)for(var l=0;l<r.coordinates.length;l++){var c=n.coordinates[s],u=r.coordinates[l];if(c[0]===u[0]&&c[1]===u[1])return!0}return!1;case"LineString":case"MultiLineString":H(t,(function(t){H(e,(function(e){zi(t,e).features.length&&a++}))}));break;case"Polygon":case"MultiPolygon":H(t,(function(t){H(e,(function(e){Rr(t,e).features.length&&a++}))}))}return a>0},e.booleanParallel=function(t,e){if(!t)throw new Error("line1 is required");if(!e)throw new Error("line2 is required");if("LineString"!==Ha(t,"line1"))throw new Error("line1 must be a LineString");if("LineString"!==Ha(e,"line2"))throw new Error("line2 must be a LineString");for(var n=Jn(en(t)).features,r=Jn(en(e)).features,i=0;i<n.length;i++){var o=n[i].geometry.coordinates;if(!r[i])break;if(!Va(o,r[i].geometry.coordinates))return!1}return!0},e.booleanPointInPolygon=ye,e.booleanPointOnLine=Yr,e.booleanWithin=Jr,e.buffer=function(t,e,n){var r=(n=n||{}).units||"kilometers",i=n.steps||8;if(!t)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof i)throw new Error("steps must be an number");if(void 0===e)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return U(t,(function(t){var n=rg(t,e,r,i);n&&o.push(n)})),f(o);case"FeatureCollection":return F(t,(function(t){var n=rg(t,e,r,i);n&&F(n,(function(t){t&&o.push(t)}))})),f(o)}return rg(t,e,r,i)},e.center=bn,e.centerMean=Fs,e.centerMedian=function(t,e){if(void 0===e&&(e={}),!L(e=e||{}))throw new Error("options is invalid");var n=e.counter||10;if(!C(n))throw new Error("counter must be a number");var r=e.weight,i=Fs(t,{weight:e.weight}),o=f([]);F(t,(function(t){var e;o.features.push(wn(t,{properties:{weight:null===(e=t.properties)||void 0===e?void 0:e[r]}}))}));var a={tolerance:e.tolerance,medianCandidates:[]};return zs(i.geometry.coordinates,[0,0],o,a,n)},e.centerOfMass=function t(e,n){switch(void 0===n&&(n={}),ot(e)){case"Point":return l(K(e),n.properties);case"Polygon":var r=[];O(e,(function(t){r.push(t)}));var i,o,a,s,c,u,h,p,d=wn(e,{properties:n.properties}),f=d.geometry.coordinates,m=0,g=0,y=0,v=r.map((function(t){return[t[0]-f[0],t[1]-f[1]]}));for(i=0;i<r.length-1;i++)s=(o=v[i])[0],u=o[1],c=(a=v[i+1])[0],y+=p=s*(h=a[1])-c*u,m+=(s+c)*p,g+=(u+h)*p;if(0===y)return d;var _=1/(.5*y*6);return l([f[0]+_*m,f[1]+_*g],n.properties);default:var x=ge(e);return x?t(x,{properties:n.properties}):wn(e,{properties:n.properties})}},e.centroid=wn,e.circle=_n,e.cleanCoords=en,e.clone=Se,e.clusterEach=al,e.clusterReduce=sl,e.clusters=pl,e.clustersDbscan=function(t,e,n){void 0===n&&(n={}),!0!==n.mutate&&(t=Se(t)),n.minPoints=n.minPoints||3;var r=new Da.DBSCAN,i=r.run(B(t),T(e,n.units),n.minPoints,xe),o=-1;return i.forEach((function(e){o++,e.forEach((function(e){var n=t.features[e];n.properties||(n.properties={}),n.properties.cluster=o,n.properties.dbscan="core"}))})),r.noise.forEach((function(e){var n=t.features[e];n.properties||(n.properties={}),n.properties.cluster?n.properties.dbscan="edge":n.properties.dbscan="noise"})),t},e.clustersKmeans=function(t,e){void 0===e&&(e={});var n=t.features.length;e.numberOfClusters=e.numberOfClusters||Math.round(Math.sqrt(n/2)),e.numberOfClusters>n&&(e.numberOfClusters=n),!0!==e.mutate&&(t=Se(t));var r=B(t),i=r.slice(0,e.numberOfClusters),o=Ga(r,e.numberOfClusters,i),a={};return o.centroids.forEach((function(t,e){a[e]=t})),F(t,(function(t,e){var n=o.idxs[e];t.properties.cluster=n,t.properties.centroid=a[n]})),t},e.collect=function(t,e,n,r){var i=Tt(6),o=e.features.map((function(t){var e;return{minX:t.geometry.coordinates[0],minY:t.geometry.coordinates[1],maxX:t.geometry.coordinates[0],maxY:t.geometry.coordinates[1],property:null===(e=t.properties)||void 0===e?void 0:e[n]}}));return i.load(o),t.features.forEach((function(t){t.properties||(t.properties={});var e=J(t),n=i.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}),o=[];n.forEach((function(e){ye([e.minX,e.minY],t)&&o.push(e.property)})),t.properties[r]=o})),t},e.collectionOf=rt,e.combine=function(t){var e={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return F(t,(function(t){var n,r,i,o;switch(null===(o=t.geometry)||void 0===o?void 0:o.type){case"Point":e.MultiPoint.coordinates.push(t.geometry.coordinates),e.MultiPoint.properties.push(t.properties);break;case"MultiPoint":(n=e.MultiPoint.coordinates).push.apply(n,t.geometry.coordinates),e.MultiPoint.properties.push(t.properties);break;case"LineString":e.MultiLineString.coordinates.push(t.geometry.coordinates),e.MultiLineString.properties.push(t.properties);break;case"MultiLineString":(r=e.MultiLineString.coordinates).push.apply(r,t.geometry.coordinates),e.MultiLineString.properties.push(t.properties);break;case"Polygon":e.MultiPolygon.coordinates.push(t.geometry.coordinates),e.MultiPolygon.properties.push(t.properties);break;case"MultiPolygon":(i=e.MultiPolygon.coordinates).push.apply(i,t.geometry.coordinates),e.MultiPolygon.properties.push(t.properties)}})),f(Object.keys(e).filter((function(t){return e[t].coordinates.length})).sort().map((function(t){return a({type:t,coordinates:e[t].coordinates},{collectedProperties:e[t].properties})})))},e.concave=function(t,e){void 0===e&&(e={});var n=e.maxEdge||1/0,r=be(function(t){var e=[],n={};return F(t,(function(t){if(t.geometry){var r=t.geometry.coordinates.join("-");Object.prototype.hasOwnProperty.call(n,r)||(e.push(t),n[r]=!0)}})),f(e)}(t));if(r.features=r.features.filter((function(t){var r=t.geometry.coordinates[0][0],i=t.geometry.coordinates[0][1],o=t.geometry.coordinates[0][2],a=xe(r,i,e),s=xe(i,o,e),l=xe(r,o,e);return a<=n&&s<=n&&l<=n})),r.features.length<1)return null;var i=tn(r);return 1===i.coordinates.length&&(i.coordinates=i.coordinates[0],i.type="Polygon"),a(i)},e.containsNumber=tt,e.convertArea=A,e.convertDistance=T,e.convertLength=T,e.convex=ge,e.coordAll=B,e.coordEach=O,e.coordReduce=D,e.createBins=ll,e.degrees2radians=S,e.degreesToRadians=S,e.destination=vn,e.difference=function(t,e){var n=it(t),r=it(e),i=t.properties||{},o=tc.difference(n.coordinates,r.coordinates);return 0===o.length?null:1===o.length?u(o[0],i):y(o,i)},e.dissolve=function(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n=e.propertyName;rt(t,"Polygon","dissolve");var r=[];if(!e.propertyName)return ri(y(tc.union.apply(null,t.features.map((function(t){return t.geometry.coordinates})))));var i={};F(t,(function(t){Object.prototype.hasOwnProperty.call(i,t.properties[n])||(i[t.properties[n]]=[]),i[t.properties[n]].push(t)}));for(var o=Object.keys(i),a=0;a<o.length;a++){var s=y(tc.union.apply(null,i[o[a]].map((function(t){return t.geometry.coordinates}))));s.properties[n]=o[a],r.push(s)}return ri(f(r))},e.distance=xe,e.distanceToDegrees=w,e.distanceToRadians=b,e.distanceWeight=Vs,e.earthRadius=n,e.ellipse=Ns,e.envelope=gn,e.explode=Mn,e.factors=r,e.feature=a,e.featureCollection=f,e.featureEach=F,e.featureOf=nt,e.featureReduce=z,e.filterProperties=hl,e.findPoint=Y,e.findSegment=Z,e.flatten=ri,e.flattenEach=G,e.flattenReduce=V,e.flip=function(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n=e.mutate;if(!t)throw new Error("geojson is required");return!1!==n&&void 0!==n||(t=Se(t)),O(t,(function(t){var e=t[0],n=t[1];t[0]=n,t[1]=e})),t},e.geojsonType=et,e.geomEach=U,e.geomReduce=j,e.geometry=s,e.geometryCollection=v,e.getCluster=ol,e.getCoord=K,e.getCoords=Q,e.getGeom=it,e.getType=ot,e.greatCircle=function(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.properties,i=n.npoints,o=n.offset;return t=K(t),e=K(e),r=r||{},i=i||100,o=o||10,new vi({x:t[0],y:t[1]},{x:e[0],y:e[1]},r).Arc(i,{offset:o}).json()},e.helpers=R,e.hexGrid=lg,e.inside=ye,e.interpolate=function(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.gridType,i=n.property,o=n.weight;if(!t)throw new Error("points is required");if(rt(t,"Point","input must contain Points"),!e)throw new Error("cellSize is required");if(void 0!==o&&"number"!=typeof o)throw new Error("weight must be a number");i=i||"elevation",r=r||"square",o=o||1;var a,s=J(t);switch(r){case"point":case"points":a=ei(s,e,n);break;case"square":case"squares":a=dg(s,e,n);break;case"hex":case"hexes":a=lg(s,e,n);break;case"triangle":case"triangles":a=fg(s,e,n);break;default:throw new Error("invalid gridType")}var l=[];return F(a,(function(e){var a=0,s=0;F(t,(function(t){var l,c=xe("point"===r?e:wn(e),t,n);if(void 0!==i&&(l=t.properties[i]),void 0===l&&(l=t.geometry.coordinates[2]),void 0===l)throw new Error("zValue is missing");0===c&&(a=l);var u=1/Math.pow(c,o);s+=u,a+=u*l}));var c=Se(e);c.properties[i]=a/s,l.push(c)})),f(l)},e.intersect=sg,e.invariant=at,e.isNumber=C,e.isObject=L,e.isobands=function(t,e,n){if(!L(n=n||{}))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(rt(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks is not an Array");if(!L(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(o))throw new Error("breaksProperties is not an Array");var a=Ji(t,{zProperty:r,flip:!0}),s=function(t,e,n){for(var r=[],i=1;i<e.length;i++){var o=+e[i-1],a=+e[i],s=Jo($o(to(t,o,a-o))),l={};l.groupedRings=s,l[n]=o+"-"+a,r.push(l)}return r}(a,e,r);return f((s=function(t,e,n){var r=J(n),i=r[2]-r[0],o=r[3]-r[1],a=r[0],s=r[1],l=e[0].length-1,c=e.length-1,u=i/l,h=o/c,p=function(t){t[0]=t[0]*u+a,t[1]=t[1]*h+s};return t.forEach((function(t){t.groupedRings.forEach((function(t){t.forEach((function(t){t.forEach(p)}))}))})),t}(s,a,t)).map((function(t,e){if(o[e]&&!L(o[e]))throw new Error("Each mappedProperty is required to be an Object");var n=ht({},i,o[e]);return n[r]=t[r],y(t.groupedRings,n)})))},e.isolines=function(t,e,n){if(!L(n=n||{}))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(rt(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!L(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(o))throw new Error("breaksProperties must be an Array");var a=_t(t,{zProperty:r,flip:!0});return f(function(t,e,n){var r=J(n),i=r[2]-r[0],o=r[3]-r[1],a=r[0],s=r[1],l=e[0].length-1,c=e.length-1,u=i/l,h=o/c,p=function(t){t[0]=t[0]*u+a,t[1]=t[1]*h+s};return t.forEach((function(t){O(t,p)})),t}(function(t,e,n,r,i){for(var o=[],a=1;a<e.length;a++){var s=+e[a],l=ht({},r,i[a]);l[n]=s;var c=m(ft(t,s),l);o.push(c)}return o}(a,e,r,i,o),a,t))},e.kinks=function(t){var e,n,r={type:"FeatureCollection",features:[]};if("LineString"===(n="Feature"===t.type?t.geometry:t).type)e=[n.coordinates];else if("MultiLineString"===n.type)e=n.coordinates;else if("MultiPolygon"===n.type)e=[].concat.apply([],n.coordinates);else{if("Polygon"!==n.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");e=n.coordinates}return e.forEach((function(t){e.forEach((function(e){for(var n=0;n<t.length-1;n++)for(var i=n;i<e.length-1;i++){if(t===e){if(1===Math.abs(n-i))continue;if(0===n&&i===t.length-2&&t[n][0]===t[t.length-1][0]&&t[n][1]===t[t.length-1][1])continue}var o=Br(t[n][0],t[n][1],t[n+1][0],t[n+1][1],e[i][0],e[i][1],e[i+1][0],e[i+1][1]);o&&r.features.push(l([o[0],o[1]]))}}))})),r},e.length=Xr,e.lengthToDegrees=w,e.lengthToRadians=b,e.lineArc=Mi,e.lineChunk=function(t,e,n){if(!L(n=n||{}))throw new Error("options is invalid");var r=n.units,i=n.reverse;if(!t)throw new Error("geojson is required");if(e<=0)throw new Error("segmentLength must be greater than 0");var o=[];return G(t,(function(t){i&&(t.geometry.coordinates=t.geometry.coordinates.reverse()),function(t,e,n,r){var i=Xr(t,{units:n});if(i<=e)return r(t);var o=i/e;Number.isInteger(o)||(o=Math.floor(o)+1);for(var a=0;a<o;a++)r(Zr(t,e*a,e*(a+1),{units:n}),a)}(t,e,r,(function(t){o.push(t)}))})),f(o)},e.lineDistance=Xr,e.lineEach=q,e.lineIntersect=Rr,e.lineOffset=function(t,e,n){if(!L(n=n||{}))throw new Error("options is invalid");var r=n.units;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");var i=ot(t),o=t.properties;switch(i){case"LineString":return aa(t,e,r);case"MultiLineString":var a=[];return G(t,(function(t){a.push(aa(t,e,r).geometry.coordinates)})),m(a,o);default:throw new Error("geometry "+i+" is not supported")}},e.lineOverlap=zi,e.lineReduce=X,e.lineSegment=Jn,e.lineSlice=function(t,e,n){var r=Q(n);if("LineString"!==ot(n))throw new Error("line must be a LineString");for(var i,o=Dr(n,t),a=Dr(n,e),s=[(i=o.properties.index<=a.properties.index?[o,a]:[a,o])[0].geometry.coordinates],l=i[0].properties.index+1;l<i[1].properties.index+1;l++)s.push(r[l]);return s.push(i[1].geometry.coordinates),p(s,n.properties)},e.lineSliceAlong=Zr,e.lineSplit=function(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var n=ot(t),r=ot(e);if("LineString"!==n)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var i=ni(e,{precision:7});switch(r){case"Point":return xi(t,i);case"MultiPoint":return _i(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return _i(t,Rr(t,i))}},e.lineString=p,e.lineStringToPolygon=Ci,e.lineStrings=d,e.lineToPolygon=Ci,e.mask=function(t,e){var n,r=pg(e),i=null;return i="FeatureCollection"===t.type?hg(2===(n=t).features.length?tc.union(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):tc.union.apply(tc,n.features.map((function(t){return t.geometry.coordinates})))):hg(tc.union(t.geometry.coordinates)),i.geometry.coordinates.forEach((function(t){r.geometry.coordinates.push(t[0])})),r},e.meta=$,e.midpoint=function(t,e){return vn(t,xe(t,e)/2,xn(t,e))},e.moranIndex=function(t,e){var n=e.inputField,r=e.threshold||1e5,i=e.p||2,o=e.binary||!1,a=Vs(t,{alpha:e.alpha||-1,binary:o,p:i,standardization:e.standardization||!0,threshold:r}),s=[];F(t,(function(t){var e=t.properties||{};s.push(e[n])}));for(var l=Hs(s),c=function(t){for(var e=Hs(t),n=0,r=0,i=t;r<i.length;r++){var o=i[r];n+=Math.pow(o-e,2)}return n/t.length}(s),u=0,h=0,p=0,d=0,f=a.length,m=0;m<f;m++){for(var g=0,y=0;y<f;y++)u+=a[m][y]*(s[m]-l)*(s[y]-l),h+=a[m][y],p+=Math.pow(a[m][y]+a[y][m],2),g+=a[m][y]+a[y][m];d+=Math.pow(g,2)}var v=u/h/c,_=-1/(f-1),x=(f*f*(p*=.5)-f*d+h*h*3)/((f-1)*(f+1)*(h*h))-_*_,b=Math.sqrt(x);return{expectedMoranIndex:_,moranIndex:v,stdNorm:b,zNorm:(v-_)/b}},e.multiLineString=m,e.multiPoint=g,e.multiPolygon=y,e.nearest=$n,e.nearestPoint=$n,e.nearestPointOnLine=Dr,e.nearestPointToLine=function(t,e,n){void 0===n&&(n={});var r=n.units,i=n.properties||{},o=function(t){var e=[];switch(t.geometry?t.geometry.type:t.type){case"GeometryCollection":return U(t,(function(t){"Point"===t.type&&e.push({type:"Feature",properties:{},geometry:t})})),{type:"FeatureCollection",features:e};case"FeatureCollection":return t.features=t.features.filter((function(t){return"Point"===t.geometry.type})),t;default:throw new Error("points must be a Point Collection")}}(t);if(!o.features.length)throw new Error("points must contain features");if(!e)throw new Error("line is required");if("LineString"!==ot(e))throw new Error("line must be a LineString");var a=1/0,s=null;return F(o,(function(t){var n=kr(t,e,{units:r});n<a&&(a=n,s=t)})),s&&(s.properties=ht({dist:a},s.properties,i)),s},e.planepoint=function(t,e){var n=K(t),r=it(e).coordinates[0];if(r.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var i=e.properties||{},o=i.a,a=i.b,s=i.c,l=n[0],c=n[1],u=r[0][0],h=r[0][1],p=void 0!==o?o:r[0][2],d=r[1][0],f=r[1][1],m=void 0!==a?a:r[1][2],g=r[2][0],y=r[2][1],v=void 0!==s?s:r[2][2];return(v*(l-u)*(c-f)+p*(l-d)*(c-y)+m*(l-g)*(c-h)-m*(l-u)*(c-y)-v*(l-d)*(c-h)-p*(l-g)*(c-f))/((l-u)*(c-f)+(l-d)*(c-y)+(l-g)*(c-h)-(l-u)*(c-y)-(l-d)*(c-h)-(l-g)*(c-f))},e.point=l,e.pointGrid=ei,e.pointOnFeature=Ur,e.pointOnLine=Dr,e.pointOnSurface=Ur,e.pointToLineDistance=kr,e.points=c,e.pointsWithinPolygon=_e,e.polygon=u,e.polygonSmooth=function(t,e){var n=[],r=e.iterations||1;if(!t)throw new Error("inputPolys is required");return U(t,(function(t,e,i){var o,a,s;switch(t.type){case"Polygon":o=[[]];for(var l=0;l<r;l++)s=[[]],a=t,l>0&&(a=u(o).geometry),Us(a,s),o=s.slice(0);n.push(u(o,i));break;case"MultiPolygon":o=[[[]]];for(var c=0;c<r;c++)s=[[[]]],a=t,c>0&&(a=y(o).geometry),js(a,s),o=s.slice(0);n.push(y(o,i));break;default:throw new Error("geometry is invalid, must be Polygon or MultiPolygon")}})),f(n)},e.polygonTangents=function(t,e){var n,r,i,o,a=Q(t),s=Q(e),c=J(e),u=0,h=null;switch(a[0]>c[0]&&a[0]<c[2]&&a[1]>c[1]&&a[1]<c[3]&&(u=(h=$n(t,Mn(e))).properties.featureIndex),ot(e)){case"Polygon":n=s[0][u],r=s[0][0],null!==h&&h.geometry.coordinates[1]<a[1]&&(r=s[0][u]),o=qi(s[0][0],s[0][s[0].length-1],a);var p=Hi(s[0],a,o,i,n,r);n=p[0],r=p[1];break;case"MultiPolygon":for(var d=0,m=0,g=0,y=0;y<s[0].length;y++){d=y;for(var v=!1,_=0;_<s[0][y].length;_++){if(m=_,g===u){v=!0;break}g++}if(v)break}n=s[0][d][m],r=s[0][d][m],o=qi(s[0][0][0],s[0][0][s[0][0].length-1],a),s.forEach((function(t){var e=Hi(t[0],a,o,i,n,r);n=e[0],r=e[1]}))}return f([l(n),l(r)])},e.polygonToLine=Si,e.polygonToLineString=Si,e.polygonize=function(t){var e=pa.fromGeoJson(t);e.deleteDangles(),e.deleteCutEdges();var n=[],r=[];return e.getEdgeRings().filter((function(t){return t.isValid()})).forEach((function(t){t.isHole()?n.push(t):r.push(t)})),n.forEach((function(t){ha.findEdgeRingContaining(t,r)&&r.push(t)})),f(r.map((function(t){return t.toPolygon()})))},e.polygons=h,e.projection=$s,e.propEach=N,e.propReduce=k,e.propertiesContainsFilter=ul,e.radians2degrees=E,e.radiansToDegrees=E,e.radiansToDistance=x,e.radiansToLength=x,e.random=il,e.randomLineString=el,e.randomPoint=Qs,e.randomPolygon=tl,e.randomPosition=Ks,e.rewind=function(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n=e.reverse||!1,r=e.mutate||!1;if(!t)throw new Error("<geojson> is required");if("boolean"!=typeof n)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof r)throw new Error("<mutate> must be a boolean");!1===r&&(t=Se(t));var i=[];switch(t.type){case"GeometryCollection":return U(t,(function(t){Zi(t,n)})),t;case"FeatureCollection":return F(t,(function(t){F(Zi(t,n),(function(t){i.push(t)}))})),f(i)}return Zi(t,n)},e.rhumbBearing=ji,e.rhumbDestination=Vi,e.rhumbDistance=Nr,e.round=_,e.sample=function(t,e){if(!t)throw new Error("featurecollection is required");if(null==e)throw new Error("num is required");if("number"!=typeof e)throw new Error("num must be a number");return f(function(t,e){for(var n,r,i=t.slice(0),o=t.length,a=o-e;o-- >a;)n=i[r=Math.floor((o+1)*Math.random())],i[r]=i[o],i[o]=n;return i.slice(a)}(t.features,e))},e.sector=function(t,e,n,r,i){if(!L(i=i||{}))throw new Error("options is invalid");var o=i.properties;if(!t)throw new Error("center is required");if(null==n)throw new Error("bearing1 is required");if(null==r)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");if("object"!=typeof i)throw new Error("options must be an object");if(Ui(n)===Ui(r))return _n(t,e,i);var a=Q(t),s=Mi(t,e,n,r,i),l=[[a]];return O(s,(function(t){l[0].push(t)})),l[0].push(a),u(l,o)},e.segmentEach=H,e.segmentReduce=W,e.shortestPath=function(t,e,n){if(!L(n=n||{}))throw new Error("options is invalid");var r=n.resolution,i=n.minDistance,o=n.obstacles||f([]);if(!t)throw new Error("start is required");if(!e)throw new Error("end is required");if(r&&!C(r)||r<=0)throw new Error("options.resolution must be a number, greater than 0");if(i)throw new Error("options.minDistance is not yet implemented");var s=K(t),c=K(e);switch(t=l(s),e=l(c),ot(o)){case"FeatureCollection":if(0===o.features.length)return p([s,c]);break;case"Polygon":o=f([a(it(o))]);break;default:throw new Error("invalid obstacles")}var u=o;u.features.push(t),u.features.push(e);var h=J(ea(mn(J(u)),1.15));r||(r=xe([h[0],h[1]],[h[2],h[1]],n)/100),u.features.pop(),u.features.pop();for(var d=h[0],m=h[1],g=h[2],y=h[3],v=r/xe([d,m],[g,m],n)*(g-d),_=r/xe([d,m],[d,y],n)*(y-m),x=g-d,b=y-m,w=Math.floor(x/v),M=Math.floor(b/_),E=(x-w*v)/2,S=[],T=[],A=[],I=[],P=1/0,R=1/0,O=y-(b-M*_)/2,D=0;O>=m;){for(var N=[],k=[],F=d+E,z=0;F<=g;){var B=l([F,O]),U=$a(B,o);N.push(U?0:1),k.push(F+"|"+O);var j=xe(B,t);!U&&j<P&&(P=j,A={x:z,y:D});var G=xe(B,e);!U&&G<R&&(R=G,I={x:z,y:D}),F+=v,z++}T.push(N),S.push(k),O-=_,D++}var V=new Xa(T,{diagonal:!0}),H=V.grid[A.y][A.x],W=V.grid[I.y][I.x],q=qa.search(V,H,W),X=[s];return q.forEach((function(t){var e=S[t.x][t.y].split("|");X.push([+e[0],+e[1]])})),X.push(c),en(p(X))},e.simplify=function(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n=void 0!==e.tolerance?e.tolerance:1,r=e.highQuality||!1,i=e.mutate||!1;if(!t)throw new Error("geojson is required");if(n&&n<0)throw new Error("invalid tolerance");return!0!==i&&(t=Se(t)),U(t,(function(t){!function(t,e,n){var r=t.type;if("Point"===r||"MultiPoint"===r)return t;en(t,!0);var i=t.coordinates;switch(r){case"LineString":t.coordinates=un(i,e,n);break;case"MultiLineString":t.coordinates=i.map((function(t){return un(t,e,n)}));break;case"Polygon":t.coordinates=hn(i,e,n);break;case"MultiPolygon":t.coordinates=i.map((function(t){return hn(t,e,n)}))}}(t,n,r)})),t},e.square=yn,e.squareGrid=dg,e.standardDeviationalEllipse=function(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n=e.steps||64,r=e.weight,i=e.properties||{};if(!C(n))throw new Error("steps must be a number");if(!L(i))throw new Error("properties must be a number");var o=B(t).length,a=Fs(t,{weight:r}),s=0,l=0,c=0;F(t,(function(t){var e=t.properties[r]||1,n=Bs(Q(t),Q(a));s+=Math.pow(n.x,2)*e,l+=Math.pow(n.y,2)*e,c+=n.x*n.y*e}));var u=s-l,h=Math.sqrt(Math.pow(u,2)+4*Math.pow(c,2)),p=2*c,d=Math.atan((u+h)/p),m=180*d/Math.PI,g=0,y=0,v=0;F(t,(function(t){var e=t.properties[r]||1,n=Bs(Q(t),Q(a));g+=Math.pow(n.x*Math.cos(d)-n.y*Math.sin(d),2)*e,y+=Math.pow(n.x*Math.sin(d)+n.y*Math.cos(d),2)*e,v+=e}));var _=Math.sqrt(2*g/v),x=Math.sqrt(2*y/v),b=Ns(a,_,x,{units:"degrees",angle:m,steps:n,properties:i}),w=_e(t,f([b])),M={meanCenterCoordinates:Q(a),semiMajorAxis:_,semiMinorAxis:x,numberOfFeatures:o,angle:m,percentageWithinEllipse:100*B(w).length/o};return b.properties.standardDeviationalEllipse=M,b},e.tag=function(t,e,n,r){return t=Se(t),e=Se(e),F(t,(function(t){t.properties||(t.properties={}),F(e,(function(e){void 0===t.properties[r]&&ye(t,e)&&(t.properties[r]=e.properties[n])}))})),t},e.tesselate=function(t){if(!t.geometry||"Polygon"!==t.geometry.type&&"MultiPolygon"!==t.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var e={type:"FeatureCollection",features:[]};return"Polygon"===t.geometry.type?e.features=Yn(t.geometry.coordinates):t.geometry.coordinates.forEach((function(t){e.features=e.features.concat(Yn(t))})),e},e.tin=be,e.toMercator=Ws,e.toWgs84=qs,e.transformRotate=ta,e.transformScale=ea,e.transformTranslate=function(t,e,n,r){if(!L(r=r||{}))throw new Error("options is invalid");var i=r.units,o=r.zTranslation,a=r.mutate;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===e&&0===o)return t;if(null==n||isNaN(n))throw new Error("direction is required");return e<0&&(e=-e,n+=180),!1!==a&&void 0!==a||(t=Se(t)),O(t,(function(t){var r=Q(Vi(t,e,n,{units:i}));t[0]=r[0],t[1]=r[1],o&&3===t.length&&(t[2]+=o)})),t},e.triangleGrid=fg,e.truncate=ni,e.union=function(t,e,n){void 0===n&&(n={});var r=it(t),i=it(e),o=tc.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?u(o[0],n.properties):y(o,n.properties)},e.unitsFactors=i,e.unkinkPolygon=function(t){var e=[];return G(t,(function(t){"Polygon"===t.geometry.type&&F(ai(t),(function(n){e.push(u(n.geometry.coordinates,t.properties))}))})),f(e)},e.validateBBox=I,e.validateId=P,e.voronoi=function(t,e){if(!L(e=e||{}))throw new Error("options is invalid");var n=e.bbox||[-180,-85,180,85];if(!t)throw new Error("points is required");if(!Array.isArray(n))throw new Error("bbox is invalid");return rt(t,"Point","points"),f(function(){var t=Ka,e=Qa,n=null;function r(r){return new Os(r.map((function(n,i){var o=[Math.round(t(n,i,r)/Is)*Is,Math.round(e(n,i,r)/Is)*Is];return o.index=i,o.data=n,o})),n)}return r.polygons=function(t){return r(t).polygons()},r.links=function(t){return r(t).links()},r.triangles=function(t){return r(t).triangles()},r.x=function(e){return arguments.length?(t="function"==typeof e?e:Ja(+e),r):t},r.y=function(t){return arguments.length?(e="function"==typeof t?t:Ja(+t),r):e},r.extent=function(t){return arguments.length?(n=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],r):n&&[[n[0][0],n[0][1]],[n[1][0],n[1][1]]]},r.size=function(t){return arguments.length?(n=null==t?null:[[0,0],[+t[0],+t[1]]],r):n&&[n[1][0]-n[0][0],n[1][1]-n[0][1]]},r}().x((function(t){return t.geometry.coordinates[0]})).y((function(t){return t.geometry.coordinates[1]})).extent([[n[0],n[1]],[n[2],n[3]]]).polygons(t.features).map(Ds))},e.within=_e,Object.defineProperty(e,"__esModule",{value:!0})}))}).call(this,n("4362"))},"5cc9":function(t,e,n){const r=n("93b5"),i=n("a4f5"),o=n("2788");function a(t){t=r._validate(t,i.prototype._defaults.label);let e=i.prototype.drawLabelHTML(t.htmlElement,t.cssClass),n=new o.CSS2DObject(e);n.name="label",n.visible=t.alwaysVisible,n.alwaysVisible=t.alwaysVisible;var a=i.prototype._makeGroup(n,t);return i.prototype._addMethods(a),a.visibility=t.alwaysVisible,a}t.exports=a},"5da1":function(t,e,n){(function(t,n){var r=200,i="__lodash_hash_undefined__",o=1,a=2,s=9007199254740991,l="[object Arguments]",c="[object Array]",u="[object AsyncFunction]",h="[object Boolean]",p="[object Date]",d="[object Error]",f="[object Function]",m="[object GeneratorFunction]",g="[object Map]",y="[object Number]",v="[object Null]",_="[object Object]",x="[object Promise]",b="[object Proxy]",w="[object RegExp]",M="[object Set]",E="[object String]",S="[object Symbol]",T="[object Undefined]",A="[object WeakMap]",C="[object ArrayBuffer]",L="[object DataView]",I="[object Float32Array]",P="[object Float64Array]",R="[object Int8Array]",O="[object Int16Array]",D="[object Int32Array]",N="[object Uint8Array]",k="[object Uint8ClampedArray]",F="[object Uint16Array]",z="[object Uint32Array]",B=/[\\^$.*+?()[\]{}|]/g,U=/^\[object .+?Constructor\]$/,j=/^(?:0|[1-9]\d*)$/,G={};G[I]=G[P]=G[R]=G[O]=G[D]=G[N]=G[k]=G[F]=G[z]=!0,G[l]=G[c]=G[C]=G[h]=G[L]=G[p]=G[d]=G[f]=G[g]=G[y]=G[_]=G[w]=G[M]=G[E]=G[A]=!1;var V="object"==typeof t&&t&&t.Object===Object&&t,H="object"==typeof self&&self&&self.Object===Object&&self,W=V||H||Function("return this")(),q=e&&!e.nodeType&&e,X=q&&"object"==typeof n&&n&&!n.nodeType&&n,Z=X&&X.exports===q,Y=Z&&V.process,$=function(){try{return Y&&Y.binding&&Y.binding("util")}catch(t){}}(),J=$&&$.isTypedArray;function K(t,e){var n=-1,r=null==t?0:t.length,i=0,o=[];while(++n<r){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Q(t,e){var n=-1,r=e.length,i=t.length;while(++n<r)t[i+n]=e[n];return t}function tt(t,e){var n=-1,r=null==t?0:t.length;while(++n<r)if(e(t[n],n,t))return!0;return!1}function et(t,e){var n=-1,r=Array(t);while(++n<t)r[n]=e(n);return r}function nt(t){return function(e){return t(e)}}function rt(t,e){return t.has(e)}function it(t,e){return null==t?void 0:t[e]}function ot(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function at(t,e){return function(n){return t(e(n))}}function st(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var lt=Array.prototype,ct=Function.prototype,ut=Object.prototype,ht=W["__core-js_shared__"],pt=ct.toString,dt=ut.hasOwnProperty,ft=function(){var t=/[^.]+$/.exec(ht&&ht.keys&&ht.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),mt=ut.toString,gt=RegExp("^"+pt.call(dt).replace(B,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yt=Z?W.Buffer:void 0,vt=W.Symbol,_t=W.Uint8Array,xt=ut.propertyIsEnumerable,bt=lt.splice,wt=vt?vt.toStringTag:void 0,Mt=Object.getOwnPropertySymbols,Et=yt?yt.isBuffer:void 0,St=at(Object.keys,Object),Tt=Ae(W,"DataView"),At=Ae(W,"Map"),Ct=Ae(W,"Promise"),Lt=Ae(W,"Set"),It=Ae(W,"WeakMap"),Pt=Ae(Object,"create"),Rt=ke(Tt),Ot=ke(At),Dt=ke(Ct),Nt=ke(Lt),kt=ke(It),Ft=vt?vt.prototype:void 0,zt=Ft?Ft.valueOf:void 0;function Bt(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}function Ut(){this.__data__=Pt?Pt(null):{},this.size=0}function jt(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Gt(t){var e=this.__data__;if(Pt){var n=e[t];return n===i?void 0:n}return dt.call(e,t)?e[t]:void 0}function Vt(t){var e=this.__data__;return Pt?void 0!==e[t]:dt.call(e,t)}function Ht(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Pt&&void 0===e?i:e,this}function Wt(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}function qt(){this.__data__=[],this.size=0}function Xt(t){var e=this.__data__,n=de(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():bt.call(e,n,1),--this.size,!0}function Zt(t){var e=this.__data__,n=de(e,t);return n<0?void 0:e[n][1]}function Yt(t){return de(this.__data__,t)>-1}function $t(t,e){var n=this.__data__,r=de(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Jt(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}function Kt(){this.size=0,this.__data__={hash:new Bt,map:new(At||Wt),string:new Bt}}function Qt(t){var e=Te(this,t)["delete"](t);return this.size-=e?1:0,e}function te(t){return Te(this,t).get(t)}function ee(t){return Te(this,t).has(t)}function ne(t,e){var n=Te(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function re(t){var e=-1,n=null==t?0:t.length;this.__data__=new Jt;while(++e<n)this.add(t[e])}function ie(t){return this.__data__.set(t,i),this}function oe(t){return this.__data__.has(t)}function ae(t){var e=this.__data__=new Wt(t);this.size=e.size}function se(){this.__data__=new Wt,this.size=0}function le(t){var e=this.__data__,n=e["delete"](t);return this.size=e.size,n}function ce(t){return this.__data__.get(t)}function ue(t){return this.__data__.has(t)}function he(t,e){var n=this.__data__;if(n instanceof Wt){var i=n.__data__;if(!At||i.length<r-1)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new Jt(i)}return n.set(t,e),this.size=n.size,this}function pe(t,e){var n=Be(t),r=!n&&ze(t),i=!n&&!r&&je(t),o=!n&&!r&&!i&&Xe(t),a=n||r||i||o,s=a?et(t.length,String):[],l=s.length;for(var c in t)!e&&!dt.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Pe(c,l))||s.push(c);return s}function de(t,e){var n=t.length;while(n--)if(Fe(t[n][0],e))return n;return-1}function fe(t,e,n){var r=e(t);return Be(t)?r:Q(r,n(t))}function me(t){return null==t?void 0===t?T:v:wt&&wt in Object(t)?Ce(t):Ne(t)}function ge(t){return qe(t)&&me(t)==l}function ye(t,e,n,r,i){return t===e||(null==t||null==e||!qe(t)&&!qe(e)?t!==t&&e!==e:ve(t,e,n,r,ye,i))}function ve(t,e,n,r,i,a){var s=Be(t),u=Be(e),h=s?c:Ie(t),p=u?c:Ie(e);h=h==l?_:h,p=p==l?_:p;var d=h==_,f=p==_,m=h==p;if(m&&je(t)){if(!je(e))return!1;s=!0,d=!1}if(m&&!d)return a||(a=new ae),s||Xe(t)?we(t,e,n,r,i,a):Me(t,e,h,n,r,i,a);if(!(n&o)){var g=d&&dt.call(t,"__wrapped__"),y=f&&dt.call(e,"__wrapped__");if(g||y){var v=g?t.value():t,x=y?e.value():e;return a||(a=new ae),i(v,x,n,r,a)}}return!!m&&(a||(a=new ae),Ee(t,e,n,r,i,a))}function _e(t){if(!We(t)||Oe(t))return!1;var e=Ve(t)?gt:U;return e.test(ke(t))}function xe(t){return qe(t)&&He(t.length)&&!!G[me(t)]}function be(t){if(!De(t))return St(t);var e=[];for(var n in Object(t))dt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function we(t,e,n,r,i,s){var l=n&o,c=t.length,u=e.length;if(c!=u&&!(l&&u>c))return!1;var h=s.get(t);if(h&&s.get(e))return h==e;var p=-1,d=!0,f=n&a?new re:void 0;s.set(t,e),s.set(e,t);while(++p<c){var m=t[p],g=e[p];if(r)var y=l?r(g,m,p,e,t,s):r(m,g,p,t,e,s);if(void 0!==y){if(y)continue;d=!1;break}if(f){if(!tt(e,(function(t,e){if(!rt(f,e)&&(m===t||i(m,t,n,r,s)))return f.push(e)}))){d=!1;break}}else if(m!==g&&!i(m,g,n,r,s)){d=!1;break}}return s["delete"](t),s["delete"](e),d}function Me(t,e,n,r,i,s,l){switch(n){case L:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case C:return!(t.byteLength!=e.byteLength||!s(new _t(t),new _t(e)));case h:case p:case y:return Fe(+t,+e);case d:return t.name==e.name&&t.message==e.message;case w:case E:return t==e+"";case g:var c=ot;case M:var u=r&o;if(c||(c=st),t.size!=e.size&&!u)return!1;var f=l.get(t);if(f)return f==e;r|=a,l.set(t,e);var m=we(c(t),c(e),r,i,s,l);return l["delete"](t),m;case S:if(zt)return zt.call(t)==zt.call(e)}return!1}function Ee(t,e,n,r,i,a){var s=n&o,l=Se(t),c=l.length,u=Se(e),h=u.length;if(c!=h&&!s)return!1;var p=c;while(p--){var d=l[p];if(!(s?d in e:dt.call(e,d)))return!1}var f=a.get(t);if(f&&a.get(e))return f==e;var m=!0;a.set(t,e),a.set(e,t);var g=s;while(++p<c){d=l[p];var y=t[d],v=e[d];if(r)var _=s?r(v,y,d,e,t,a):r(y,v,d,t,e,a);if(!(void 0===_?y===v||i(y,v,n,r,a):_)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var x=t.constructor,b=e.constructor;x==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(m=!1)}return a["delete"](t),a["delete"](e),m}function Se(t){return fe(t,Ze,Le)}function Te(t,e){var n=t.__data__;return Re(e)?n["string"==typeof e?"string":"hash"]:n.map}function Ae(t,e){var n=it(t,e);return _e(n)?n:void 0}function Ce(t){var e=dt.call(t,wt),n=t[wt];try{t[wt]=void 0;var r=!0}catch(o){}var i=mt.call(t);return r&&(e?t[wt]=n:delete t[wt]),i}Bt.prototype.clear=Ut,Bt.prototype["delete"]=jt,Bt.prototype.get=Gt,Bt.prototype.has=Vt,Bt.prototype.set=Ht,Wt.prototype.clear=qt,Wt.prototype["delete"]=Xt,Wt.prototype.get=Zt,Wt.prototype.has=Yt,Wt.prototype.set=$t,Jt.prototype.clear=Kt,Jt.prototype["delete"]=Qt,Jt.prototype.get=te,Jt.prototype.has=ee,Jt.prototype.set=ne,re.prototype.add=re.prototype.push=ie,re.prototype.has=oe,ae.prototype.clear=se,ae.prototype["delete"]=le,ae.prototype.get=ce,ae.prototype.has=ue,ae.prototype.set=he;var Le=Mt?function(t){return null==t?[]:(t=Object(t),K(Mt(t),(function(e){return xt.call(t,e)})))}:Ye,Ie=me;function Pe(t,e){return e=null==e?s:e,!!e&&("number"==typeof t||j.test(t))&&t>-1&&t%1==0&&t<e}function Re(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function Oe(t){return!!ft&&ft in t}function De(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||ut;return t===n}function Ne(t){return mt.call(t)}function ke(t){if(null!=t){try{return pt.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Fe(t,e){return t===e||t!==t&&e!==e}(Tt&&Ie(new Tt(new ArrayBuffer(1)))!=L||At&&Ie(new At)!=g||Ct&&Ie(Ct.resolve())!=x||Lt&&Ie(new Lt)!=M||It&&Ie(new It)!=A)&&(Ie=function(t){var e=me(t),n=e==_?t.constructor:void 0,r=n?ke(n):"";if(r)switch(r){case Rt:return L;case Ot:return g;case Dt:return x;case Nt:return M;case kt:return A}return e});var ze=ge(function(){return arguments}())?ge:function(t){return qe(t)&&dt.call(t,"callee")&&!xt.call(t,"callee")},Be=Array.isArray;function Ue(t){return null!=t&&He(t.length)&&!Ve(t)}var je=Et||$e;function Ge(t,e){return ye(t,e)}function Ve(t){if(!We(t))return!1;var e=me(t);return e==f||e==m||e==u||e==b}function He(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=s}function We(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function qe(t){return null!=t&&"object"==typeof t}var Xe=J?nt(J):xe;function Ze(t){return Ue(t)?pe(t):be(t)}function Ye(){return[]}function $e(){return!1}n.exports=Ge}).call(this,n("c8ba"),n("62e4")(t))},"5e67":function(t,e){const n=function(t,e){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[]},r={on:function(t,e,r){if(void 0===n[t])throw new Error("Invalid event type: "+t);n[t].push({selector:e,fn:r})},render:function(t){e.store.featureChanged(t)}},i=function(t,i){const o=n[t];let a=o.length;while(a--){const t=o[a];if(t.selector(i)){t.fn.call(r,i),e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(r),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(t){i("drag",t)},click:function(t){i("click",t)},mousemove:function(t){i("mousemove",t)},mousedown:function(t){i("mousedown",t)},mouseup:function(t){i("mouseup",t)},mouseout:function(t){i("mouseout",t)},keydown:function(t){i("keydown",t)},keyup:function(t){i("keyup",t)}}};t.exports=n},6044:function(t,e,n){const r=n("7bc4");r.OBJLoader=function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,n=/^usemtl /,i=/^usemap /,o=new r.Vector3,a=new r.Vector3,s=new r.Vector3,l=new r.Vector3,c=new r.Vector3;function u(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var n=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasNormalIndices:!1,hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"===typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"===typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(t){var e=this.vertices,n=this.object.geometry.vertices;n.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices,n=this.object.geometry.vertices;n.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(t,e,n){var r=this.vertices,i=this.object.geometry.normals;o.fromArray(r,t),a.fromArray(r,e),s.fromArray(r,n),c.subVectors(s,a),l.subVectors(o,a),c.cross(l),c.normalize(),i.push(c.x,c.y,c.z),i.push(c.x,c.y,c.z),i.push(c.x,c.y,c.z)},addColor:function(t,e,n){var r=this.colors,i=this.object.geometry.colors;void 0!==r[t]&&i.push(r[t+0],r[t+1],r[t+2]),void 0!==r[e]&&i.push(r[e+0],r[e+1],r[e+2]),void 0!==r[n]&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(t,e,n){var r=this.uvs,i=this.object.geometry.uvs;i.push(r[t+0],r[t+1]),i.push(r[e+0],r[e+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){var t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){var e=this.uvs,n=this.object.geometry.uvs;n.push(e[t+0],e[t+1])},addFace:function(t,e,n,r,i,o,a,s,l){var c=this.vertices.length,u=this.parseVertexIndex(t,c),h=this.parseVertexIndex(e,c),p=this.parseVertexIndex(n,c);if(this.addVertex(u,h,p),this.addColor(u,h,p),void 0!==a&&""!==a){var d=this.normals.length;u=this.parseNormalIndex(a,d),h=this.parseNormalIndex(s,d),p=this.parseNormalIndex(l,d),this.addNormal(u,h,p),this.object.geometry.hasNormalIndices=!0}else this.addFaceNormal(u,h,p);if(void 0!==r&&""!==r){var f=this.uvs.length;u=this.parseUVIndex(r,f),h=this.parseUVIndex(i,f),p=this.parseUVIndex(o,f),this.addUV(u,h,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,n=0,r=t.length;n<r;n++)this.addVertexPoint(this.parseVertexIndex(t[n],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,i=0,o=t.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(t[i],n));var a=0;for(o=e.length;a<o;a++)this.addUVLine(this.parseUVIndex(e[a],r))}};return t.startObject("",!1),t}function h(t){r.Loader.call(this,t),this.materials=null}return h.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:h,load:function(t,e,n,i){var o=this,a=new r.FileLoader(o.manager);a.setPath(this.path),a.load(t,(function(n){try{e(o.parse(n))}catch(r){i?i(r):console.error(r),o.manager.itemError(t)}}),n,i)},setMaterials:function(t){return this.materials=t,this},parse:function(o){var a=new u;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var s=o.split("\n"),l="",c="",h=0,p=[],d="function"===typeof"".trimLeft,f=0,m=s.length;f<m;f++)if(l=s[f],l=d?l.trimLeft():l.trim(),h=l.length,0!==h&&(c=l.charAt(0),"#"!==c))if("v"===c){var g=l.split(/\s+/);switch(g[0]){case"v":a.vertices.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])),g.length>=7?a.colors.push(parseFloat(g[4]),parseFloat(g[5]),parseFloat(g[6])):a.colors.push(void 0,void 0,void 0);break;case"vn":a.normals.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3]));break;case"vt":a.uvs.push(parseFloat(g[1]),parseFloat(g[2]));break}}else if("f"===c){for(var y=l.substr(1).trim(),v=y.split(/\s+/),_=[],x=0,b=v.length;x<b;x++){var w=v[x];if(w.length>0){var M=w.split("/");_.push(M)}}var E=_[0];for(x=1,b=_.length-1;x<b;x++){var S=_[x],T=_[x+1];a.addFace(E[0],S[0],T[0],E[1],S[1],T[1],E[2],S[2],T[2])}}else if("l"===c){var A=l.substring(1).trim().split(" "),C=[],L=[];if(-1===l.indexOf("/"))C=A;else for(var I=0,P=A.length;I<P;I++){var R=A[I].split("/");""!==R[0]&&C.push(R[0]),""!==R[1]&&L.push(R[1])}a.addLineGeometry(C,L)}else if("p"===c){y=l.substr(1).trim();var O=y.split(" ");a.addPointGeometry(O)}else if(null!==(p=t.exec(l))){var D=(" "+p[0].substr(1).trim()).substr(1);a.startObject(D)}else if(n.test(l))a.object.startMaterial(l.substring(7).trim(),a.materialLibraries);else if(e.test(l))a.materialLibraries.push(l.substring(7).trim());else if(i.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if(p=l.split(" "),p.length>1){var N=p[1].trim().toLowerCase();a.object.smooth="0"!==N&&"off"!==N}else a.object.smooth=!0;var k=a.object.currentMaterial();k&&(k.smooth=a.object.smooth)}else{if("\0"===l)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}a.finalize();var F=new r.Group;F.materialLibraries=[].concat(a.materialLibraries);for(f=0,m=a.objects.length;f<m;f++){var z=a.objects[f],B=z.geometry,U=z.materials,j="Line"===B.type,G="Points"===B.type,V=!1;if(0!==B.vertices.length){var H=new r.BufferGeometry;H.setAttribute("position",new r.Float32BufferAttribute(B.vertices,3)),!0===B.hasNormalIndices&&H.setAttribute("normal",new r.Float32BufferAttribute(B.normals,3)),B.colors.length>0&&(V=!0,H.setAttribute("color",new r.Float32BufferAttribute(B.colors,3))),!0===B.hasUVIndices&&H.setAttribute("uv",new r.Float32BufferAttribute(B.uvs,2));for(var W,q=[],X=0,Z=U.length;X<Z;X++){var Y=U[X],$=Y.name+"_"+Y.smooth+"_"+V;k=a.materials[$];if(null!==this.materials)if(k=this.materials.create(Y.name),!j||!k||k instanceof r.LineBasicMaterial){if(G&&k&&!(k instanceof r.PointsMaterial)){var J=new r.PointsMaterial({size:10,sizeAttenuation:!1});r.Material.prototype.copy.call(J,k),J.color.copy(k.color),J.map=k.map,k=J}}else{var K=new r.LineBasicMaterial;r.Material.prototype.copy.call(K,k),K.color.copy(k.color),k=K}void 0===k&&(k=j?new r.LineBasicMaterial:G?new r.PointsMaterial({size:1,sizeAttenuation:!1}):new r.MeshPhongMaterial,k.name=Y.name,k.flatShading=!Y.smooth,k.vertexColors=V,a.materials[$]=k),q.push(k)}if(q.length>1){for(X=0,Z=U.length;X<Z;X++){Y=U[X];H.addGroup(Y.groupStart,Y.groupCount,X)}W=j?new r.LineSegments(H,q):G?new r.Points(H,q):new r.Mesh(H,q)}else W=j?new r.LineSegments(H,q[0]):G?new r.Points(H,q[0]):new r.Mesh(H,q[0]);W.name=z.name,F.add(W)}}return F}}),h}(),t.exports=r.OBJLoader},"619d":function(t,e,n){const r=n("ed5e"),i=n("e133"),o={Point:0,LineString:1,Polygon:2};function a(t,e){const n=o[t.geometry.type]-o[e.geometry.type];return 0===n&&t.geometry.type===i.geojsonTypes.POLYGON?t.area-e.area:n}function s(t){return t.map(t=>(t.geometry.type===i.geojsonTypes.POLYGON&&(t.area=r.geometry({type:i.geojsonTypes.FEATURE,property:{},geometry:t.geometry})),t)).sort(a).map(t=>(delete t.area,t))}t.exports=s},"62e4":function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},6403:function(t,e){function n(t){if(this._items={},this._length=t?t.length:0,t)for(let e=0,n=t.length;e<n;e++)void 0!==t[e]&&(this._items[t[e]]=e)}n.prototype.add=function(t){return this._length=this._items[t]?this._length:this._length+1,this._items[t]=this._items[t]?this._items[t]:this._length,this},n.prototype.delete=function(t){return this._length=this._items[t]?this._length-1:this._length,delete this._items[t],this},n.prototype.has=function(t){return void 0!==this._items[t]},n.prototype.values=function(){const t=Object.keys(this._items).sort((t,e)=>this._items[t]-this._items[e]);return t},n.prototype.clear=function(){return this._length=0,this._items={},this},t.exports=n},"64af":function(t,e){t.exports.RADIUS=6378137,t.exports.FLATTENING=1/298.257223563,t.exports.POLAR_RADIUS=6356752.3142},"6aea":function(t,e,n){const r=n("619d"),i=n("e46a"),o=n("e133"),a=n("6403"),s=[o.meta.FEATURE,o.meta.MIDPOINT,o.meta.VERTEX];t.exports=function(t,e,n){if(null===n.map)return[];const o=t?i(t,n.options.clickBuffer):e,l={};n.options.styles&&(l.layers=n.options.styles.map(t=>t.id));const c=n.map.queryRenderedFeatures(o,l).filter(t=>-1!==s.indexOf(t.properties.meta)),u=new a,h=[];return c.forEach(t=>{const e=t.properties.id;u.has(e)||(u.add(e),h.push(t))}),r(h)}},"6bfd":function(t,e,n){const r=n("2413"),i=n("ca6a"),o=n("6aea"),a=n("d7df"),s=n("6403"),l=n("00a3"),c=n("190f"),u=n("e133"),h=n("12ec");t.exports=function(t,e={}){let n,p=null,d=null,f=!1,m=!1,g=!1,y=!1;const v=e.featureIds||[],_=function(){t.map.fire(u.events.UPDATE,{action:u.updateActions.MOVE,features:t.store.getSelected().map(t=>t.toGeoJSON())})},x=()=>{const e=t.store.getSelected(),n=e.filter(t=>t instanceof h);let r=!1;if(e.length>1){r=!0;const t=e[0].type.replace("Multi","");e.forEach(e=>{e.type.replace("Multi","")!==t&&(r=!1)})}const i=n.length>0,o=e.length>0;t.events.actionable({combineFeatures:r,uncombineFeatures:i,trash:o})},b=function(t){if(!t.length)return[];const e=t.map(t=>t.properties.id).filter(t=>void 0!==t).reduce((t,e)=>(t.add(e),t),new s);return e.values()},w=function(){n&&(n.parentNode&&n.parentNode.removeChild(n),n=null),t.map.dragPan.enable(),f=!1,m=!1,g=!1,y=!1};return{stop:function(){l.enable(t)},start:function(){t.store&&(t.store.setSelected(v.filter(e=>void 0!==t.store.get(e))),x()),this.on("mouseup",r.true,w),this.on("mousemove",r.true,w),this.on("mouseout",()=>g,_),this.on("click",r.noTarget,(function(){const e=t.store.getSelectedIds();e.length&&(t.store.clearSelected(),e.forEach(t=>this.render(t))),l.enable(t),w()})),this.on("click",r.isOfMetaType(u.meta.VERTEX),e=>{t.events.changeMode(u.modes.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),t.ui.queueMapClasses({mouse:u.cursors.MOVE})}),this.on("mousedown",r.isActiveFeature,(function(e){w(),t.map.dragPan.disable(),this.render(e.featureTarget.properties.id),y=!0,p=e.lngLat})),this.on("click",r.isFeature,(function(e){l.disable(t),w();const n=r.isShiftDown(e),i=t.store.getSelectedIds(),o=e.featureTarget.properties.id,a=t.store.isSelected(o);if(!n&&a&&t.store.get(o).type!==u.geojsonTypes.POINT)return t.events.changeMode(u.modes.DIRECT_SELECT,{featureId:o});a&&n?(t.store.deselect(o),t.ui.queueMapClasses({mouse:u.cursors.POINTER}),1===i.length&&l.enable(t)):!a&&n?(t.store.select(o),t.ui.queueMapClasses({mouse:u.cursors.MOVE})):a||n||(i.forEach(this.render),t.store.setSelected(o),t.ui.queueMapClasses({mouse:u.cursors.MOVE})),this.render(o)})),this.on("drag",()=>y,e=>{g=!0,e.originalEvent.stopPropagation();const n={lng:e.lngLat.lng-p.lng,lat:e.lngLat.lat-p.lat};c(t.store.getSelected(),n),p=e.lngLat}),this.on("mouseup",r.true,(function(e){if(g)_();else if(f){const n=[d,i(e.originalEvent,t.container)],r=o(null,n,t),a=b(r).filter(e=>!t.store.isSelected(e));a.length&&(t.store.select(a),a.forEach(this.render),t.ui.queueMapClasses({mouse:u.cursors.MOVE}))}w()})),t.options.boxSelect&&(this.on("mousedown",r.isShiftMousedown,e=>{w(),t.map.dragPan.disable(),d=i(e.originalEvent,t.container),m=!0}),this.on("drag",()=>m,e=>{f=!0,t.ui.queueMapClasses({mouse:u.cursors.ADD}),n||(n=document.createElement("div"),n.classList.add(u.classes.BOX_SELECT),t.container.appendChild(n));const r=i(e.originalEvent,t.container),o=Math.min(d.x,r.x),a=Math.max(d.x,r.x),s=Math.min(d.y,r.y),l=Math.max(d.y,r.y),c=`translate(${o}px, ${s}px)`;n.style.transform=c,n.style.WebkitTransform=c,n.style.width=a-o+"px",n.style.height=l-s+"px"}))},render:function(e,n){e.properties.active=t.store.isSelected(e.properties.id)?u.activeStates.ACTIVE:u.activeStates.INACTIVE,n(e),x(),e.properties.active===u.activeStates.ACTIVE&&e.geometry.type!==u.geojsonTypes.POINT&&a(e).forEach(n)},trash:function(){t.store.delete(t.store.getSelectedIds()),x()},combineFeatures:function(){const e=t.store.getSelected();if(0===e.length||e.length<2)return;const n=[],r=[],i=e[0].type.replace("Multi","");for(let t=0;t<e.length;t++){const o=e[t];if(o.type.replace("Multi","")!==i)return;o.type.includes("Multi")?o.getCoordinates().forEach(t=>{n.push(t)}):n.push(o.getCoordinates()),r.push(o.toGeoJSON())}if(r.length>1){const e=new h(t,{type:u.geojsonTypes.FEATURE,properties:r[0].properties,geometry:{type:"Multi"+i,coordinates:n}});t.store.add(e),t.store.delete(t.store.getSelectedIds(),{silent:!0}),t.store.setSelected([e.id]),t.map.fire(u.events.COMBINE_FEATURES,{createdFeatures:[e.toGeoJSON()],deletedFeatures:r})}x()},uncombineFeatures:function(){const e=t.store.getSelected();if(0===e.length)return;const n=[],r=[];for(let i=0;i<e.length;i++){const o=e[i];o instanceof h&&(o.getFeatures().forEach(e=>{t.store.add(e),e.properties=o.properties,n.push(e.toGeoJSON()),t.store.select([e.id])}),t.store.delete(o.id,{silent:!0}),r.push(o.toGeoJSON()))}n.length>1&&t.map.fire(u.events.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:r}),x()}}}},"6e61":function(t,e,n){const r=n("3562"),i=n("6ff3"),o=n("6403"),a=n("39c8"),s=t.exports=function(t){this._features={},this._featureIds=new o,this._selectedFeatureIds=new o,this._changedFeatureIds=new o,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this.ctx=t,this.sources={hot:[],cold:[]},this.render=r(a,16,this),this.isDirty=!1};s.prototype.createRenderBatch=function(){const t=this.render;let e=0;return this.render=function(){e++},()=>{this.render=t,e>0&&this.render()}},s.prototype.setDirty=function(){return this.isDirty=!0,this},s.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},s.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},s.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},s.prototype.getAllIds=function(){return this._featureIds.values()},s.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},s.prototype.delete=function(t,e={}){return i(t).forEach(t=>{this._featureIds.has(t)&&(this._featureIds.delete(t),this._selectedFeatureIds.delete(t),e.silent||-1===this._deletedFeaturesToEmit.indexOf(this._features[t])&&this._deletedFeaturesToEmit.push(this._features[t]),delete this._features[t],this.isDirty=!0)}),this},s.prototype.get=function(t){return this._features[t]},s.prototype.getAll=function(){return Object.keys(this._features).map(t=>this._features[t])},s.prototype.select=function(t,e={}){return i(t).forEach(t=>{this._selectedFeatureIds.has(t)||(this._selectedFeatureIds.add(t),this._changedFeatureIds.add(t),e.silent||(this._emitSelectionChange=!0))}),this},s.prototype.deselect=function(t,e={}){return i(t).forEach(t=>{this._selectedFeatureIds.has(t)&&(this._selectedFeatureIds.delete(t),this._changedFeatureIds.add(t),e.silent||(this._emitSelectionChange=!0))}),this},s.prototype.clearSelected=function(t={}){return this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},s.prototype.setSelected=function(t,e={}){return t=i(t),this.deselect(this._selectedFeatureIds.values().filter(e=>-1===t.indexOf(e)),{silent:e.silent}),this.select(t.filter(t=>!this._selectedFeatureIds.has(t)),{silent:e.silent}),this},s.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},s.prototype.getSelected=function(){return this._selectedFeatureIds.values().map(t=>this.get(t))},s.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},s.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)}},"6ff3":function(t,e){function n(t){return[].concat(t).filter(t=>void 0!==t)}t.exports=n},"786a":function(t,e){var n=t.exports=function(t){return new r(t)};function r(t){this.value=t}function i(t,e,n){var r=[],i=[],s=!0;return function t(l){var c=n?o(l):l,u={},h=!0,p={node:c,node_:l,path:[].concat(r),parent:i[i.length-1],parents:i,key:r.slice(-1)[0],isRoot:0===r.length,level:r.length,circular:null,update:function(t,e){p.isRoot||(p.parent.node[p.key]=t),p.node=t,e&&(h=!1)},delete:function(t){delete p.parent.node[p.key],t&&(h=!1)},remove:function(t){f(p.parent.node)?p.parent.node.splice(p.key,1):delete p.parent.node[p.key],t&&(h=!1)},keys:null,before:function(t){u.before=t},after:function(t){u.after=t},pre:function(t){u.pre=t},post:function(t){u.post=t},stop:function(){s=!1},block:function(){h=!1}};if(!s)return p;function d(){if("object"===typeof p.node&&null!==p.node){p.keys&&p.node_===p.node||(p.keys=a(p.node)),p.isLeaf=0==p.keys.length;for(var t=0;t<i.length;t++)if(i[t].node_===l){p.circular=i[t];break}}else p.isLeaf=!0,p.keys=null;p.notLeaf=!p.isLeaf,p.notRoot=!p.isRoot}d();var y=e.call(p,p.node);return void 0!==y&&p.update&&p.update(y),u.before&&u.before.call(p,p.node),h?("object"!=typeof p.node||null===p.node||p.circular||(i.push(p),d(),m(p.keys,(function(e,i){r.push(e),u.pre&&u.pre.call(p,p.node[e],e);var o=t(p.node[e]);n&&g.call(p.node,e)&&(p.node[e]=o.node),o.isLast=i==p.keys.length-1,o.isFirst=0==i,u.post&&u.post.call(p,o),r.pop()})),i.pop()),u.after&&u.after.call(p,p.node),p):p}(t).node}function o(t){if("object"===typeof t&&null!==t){var e;if(f(t))e=[];else if(l(t))e=new Date(t.getTime?t.getTime():t);else if(c(t))e=new RegExp(t);else if(u(t))e={message:t.message};else if(h(t))e=new Boolean(t);else if(p(t))e=new Number(t);else if(d(t))e=new String(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},r=function(){};r.prototype=n,e=new r}return m(a(t),(function(n){e[n]=t[n]})),e}return t}r.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var r=t[n];if(!e||!g.call(e,r)){e=void 0;break}e=e[r]}return e},r.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var r=t[n];if(!e||!g.call(e,r))return!1;e=e[r]}return!0},r.prototype.set=function(t,e){for(var n=this.value,r=0;r<t.length-1;r++){var i=t[r];g.call(n,i)||(n[i]={}),n=n[i]}return n[t[r]]=e,e},r.prototype.map=function(t){return i(this.value,t,!0)},r.prototype.forEach=function(t){return this.value=i(this.value,t,!1),this.value},r.prototype.reduce=function(t,e){var n=1===arguments.length,r=n?this.value:e;return this.forEach((function(e){this.isRoot&&n||(r=t.call(this,r,e))})),r},r.prototype.paths=function(){var t=[];return this.forEach((function(e){t.push(this.path)})),t},r.prototype.nodes=function(){var t=[];return this.forEach((function(e){t.push(this.node)})),t},r.prototype.clone=function(){var t=[],e=[];return function n(r){for(var i=0;i<t.length;i++)if(t[i]===r)return e[i];if("object"===typeof r&&null!==r){var s=o(r);return t.push(r),e.push(s),m(a(r),(function(t){s[t]=n(r[t])})),t.pop(),e.pop(),s}return r}(this.value)};var a=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function s(t){return Object.prototype.toString.call(t)}function l(t){return"[object Date]"===s(t)}function c(t){return"[object RegExp]"===s(t)}function u(t){return"[object Error]"===s(t)}function h(t){return"[object Boolean]"===s(t)}function p(t){return"[object Number]"===s(t)}function d(t){return"[object String]"===s(t)}var f=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},m=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};m(a(r.prototype),(function(t){n[t]=function(e){var n=[].slice.call(arguments,1),i=new r(e);return i[t].apply(i,n)}}));var g=Object.hasOwnProperty||function(t,e){return e in t}},"7bc4":function(t,e,n){(function(t,n){n(e)})(0,(function(t){function e(){}function n(t,e){this.x=t||0,this.y=e||0}function r(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function i(t,e,o,a,s,l,c,u,h,p){Object.defineProperty(this,"id",{value:qo++}),this.uuid=Vo.generateUUID(),this.name="",this.image=void 0!==t?t:i.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:i.DEFAULT_MAPPING,this.wrapS=void 0!==o?o:1001,this.wrapT=void 0!==a?a:1001,this.magFilter=void 0!==s?s:1006,this.minFilter=void 0!==l?l:1008,this.anisotropy=void 0!==h?h:1,this.format=void 0!==c?c:1023,this.internalFormat=null,this.type=void 0!==u?u:1009,this.offset=new n(0,0),this.repeat=new n(1,1),this.center=new n(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new r,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==p?p:3e3,this.version=0,this.onUpdate=null}function o(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1}function a(t,e,n){this.width=t,this.height=e,this.scissor=new o(0,0,t,e),this.scissorTest=!1,this.viewport=new o(0,0,t,e),n=n||{},this.texture=new i(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function s(t,e,n){a.call(this,t,e,n),this.samples=4}function l(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1}function c(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}function u(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function h(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||h.DefaultOrder}function p(){this.mask=1}function d(){Object.defineProperty(this,"id",{value:ia++}),this.uuid=Vo.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=d.DefaultUp.clone();var t=new c,e=new h,n=new l,i=new c(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new u},normalMatrix:{value:new r}}),this.matrix=new u,this.matrixWorld=new u,this.matrixAutoUpdate=d.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new p,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function f(){d.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.environment=this.background=null,this.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function m(t,e){this.min=void 0!==t?t:new c(1/0,1/0,1/0),this.max=void 0!==e?e:new c(-1/0,-1/0,-1/0)}function g(t,e,n,r,i){var o,a=0;for(o=t.length-3;a<=o;a+=3){La.fromArray(t,a);var s=i.x*Math.abs(La.x)+i.y*Math.abs(La.y)+i.z*Math.abs(La.z),l=e.dot(La),c=n.dot(La),u=r.dot(La);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}function y(t,e){this.center=void 0!==t?t:new c,this.radius=void 0!==e?e:-1}function v(t,e){this.origin=void 0!==t?t:new c,this.direction=void 0!==e?e:new c(0,0,-1)}function _(t,e){this.normal=void 0!==t?t:new c(1,0,0),this.constant=void 0!==e?e:0}function x(t,e,n){this.a=void 0!==t?t:new c,this.b=void 0!==e?e:new c,this.c=void 0!==n?n:new c}function b(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function w(t,e,n){return 0>n&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:.5>n?e:n<2/3?t+6*(e-t)*(2/3-n):t}function M(t){return.04045>t?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function E(t){return.0031308>t?12.92*t:1.055*Math.pow(t,.41666)-.055}function S(t,e,n,r,i,o){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new c,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new b,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}function T(){Object.defineProperty(this,"id",{value:ts++}),this.uuid=Vo.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=this.flatShading=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilZPass=this.stencilZFail=this.stencilFail=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.toneMapped=this.visible=!0,this.userData={},this.version=0}function A(t){T.call(this),this.type="MeshBasicMaterial",this.color=new b(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphTargets=this.skinning=!1,this.setValues(t)}function C(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function L(t,e,n){C.call(this,new Int8Array(t),e,n)}function I(t,e,n){C.call(this,new Uint8Array(t),e,n)}function P(t,e,n){C.call(this,new Uint8ClampedArray(t),e,n)}function R(t,e,n){C.call(this,new Int16Array(t),e,n)}function O(t,e,n){C.call(this,new Uint16Array(t),e,n)}function D(t,e,n){C.call(this,new Int32Array(t),e,n)}function N(t,e,n){C.call(this,new Uint32Array(t),e,n)}function k(t,e,n){C.call(this,new Float32Array(t),e,n)}function F(t,e,n){C.call(this,new Float64Array(t),e,n)}function z(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function B(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}function U(){Object.defineProperty(this,"id",{value:ns+=2}),this.uuid=Vo.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function j(t,e){d.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new U,this.material=void 0!==e?e:new A,this.updateMorphTargets()}function G(t,e,n,r,i,o,a,s){return null===(1===e.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,2!==e.side,s))?null:(Ss.copy(s),Ss.applyMatrix4(t.matrixWorld),e=n.ray.origin.distanceTo(Ss),e<n.near||e>n.far?null:{distance:e,point:Ss.clone(),object:t})}function V(t,e,r,i,o,a,s,l,c,u,h,p){if(ps.fromBufferAttribute(o,u),ds.fromBufferAttribute(o,h),fs.fromBufferAttribute(o,p),o=t.morphTargetInfluences,e.morphTargets&&a&&o){vs.set(0,0,0),_s.set(0,0,0),xs.set(0,0,0);for(var d=0,f=a.length;d<f;d++){var m=o[d],g=a[d];0!==m&&(ms.fromBufferAttribute(g,u),gs.fromBufferAttribute(g,h),ys.fromBufferAttribute(g,p),s?(vs.addScaledVector(ms,m),_s.addScaledVector(gs,m),xs.addScaledVector(ys,m)):(vs.addScaledVector(ms.sub(ps),m),_s.addScaledVector(gs.sub(ds),m),xs.addScaledVector(ys.sub(fs),m)))}ps.add(vs),ds.add(_s),fs.add(xs)}return t.isSkinnedMesh&&(t.boneTransform(u,ps),t.boneTransform(h,ds),t.boneTransform(p,fs)),(t=G(t,e,r,i,ps,ds,fs,Es))&&(l&&(bs.fromBufferAttribute(l,u),ws.fromBufferAttribute(l,h),Ms.fromBufferAttribute(l,p),t.uv=x.getUV(Es,ps,ds,fs,bs,ws,Ms,new n)),c&&(bs.fromBufferAttribute(c,u),ws.fromBufferAttribute(c,h),Ms.fromBufferAttribute(c,p),t.uv2=x.getUV(Es,ps,ds,fs,bs,ws,Ms,new n)),l=new S(u,h,p),x.getNormal(ps,ds,fs,l.normal),t.face=l),t}function H(){Object.defineProperty(this,"id",{value:Ts+=2}),this.uuid=Vo.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function W(t){var e,n={};for(e in t)for(var r in n[e]={},t[e]){var i=t[e][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?n[e][r]=i.clone():Array.isArray(i)?n[e][r]=i.slice():n[e][r]=i}return n}function q(t){for(var e={},n=0;n<t.length;n++){var r,i=W(t[n]);for(r in i)e[r]=i[r]}return e}function X(t){T.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Z(){d.call(this),this.type="Camera",this.matrixWorldInverse=new u,this.projectionMatrix=new u,this.projectionMatrixInverse=new u}function Y(t,e,n,r){Z.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function $(t,e,n){if(d.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");else{this.renderTarget=n;var r=new Y(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new c(1,0,0)),this.add(r);var i=new Y(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new c(-1,0,0)),this.add(i);var o=new Y(90,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new c(0,1,0)),this.add(o);var a=new Y(90,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new c(0,-1,0)),this.add(a);var s=new Y(90,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new c(0,0,1)),this.add(s);var l=new Y(90,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new c(0,0,-1)),this.add(l),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,a),t.setRenderTarget(n,4),t.render(e,s),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c},this.clear=function(t,e,r,i){for(var o=t.getRenderTarget(),a=0;6>a;a++)t.setRenderTarget(n,a),t.clear(e,r,i);t.setRenderTarget(o)}}}function J(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),a.call(this,t,t,e)}function K(t,e,n,r,o,a,s,l,c,u,h,p){i.call(this,null,a,s,l,c,u,r,o,h,p),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==c?c:1003,this.minFilter=void 0!==u?u:1003,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1,this.needsUpdate=!0}function Q(t,e,n,r,i,o){this.planes=[void 0!==t?t:new _,void 0!==e?e:new _,void 0!==n?n:new _,void 0!==r?r:new _,void 0!==i?i:new _,void 0!==o?o:new _]}function tt(){function t(i,o){!1!==n&&(r(i,o),e.requestAnimationFrame(t))}var e=null,n=!1,r=null;return{start:function(){!0!==n&&null!==r&&(e.requestAnimationFrame(t),n=!0)},stop:function(){n=!1},setAnimationLoop:function(t){r=t},setContext:function(t){e=t}}}function et(t,e){function n(e,n){var r=e.array,i=e.usage,o=t.createBuffer();return t.bindBuffer(n,o),t.bufferData(n,r,i),e.onUploadCallback(),n=5126,r instanceof Float32Array?n=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?n=5123:r instanceof Int16Array?n=5122:r instanceof Uint32Array?n=5125:r instanceof Int32Array?n=5124:r instanceof Int8Array?n=5120:r instanceof Uint8Array&&(n=5121),{buffer:o,type:n,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}var r=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,o){e.isInterleavedBufferAttribute&&(e=e.data);var a=i.get(e);if(void 0===a)i.set(e,n(e,o));else if(a.version<e.version){var s=e.array,l=e.updateRange;t.bindBuffer(o,a.buffer),-1===l.count?t.bufferSubData(o,0,s):(r?t.bufferSubData(o,l.offset*s.BYTES_PER_ELEMENT,s,l.offset,l.count):t.bufferSubData(o,l.offset*s.BYTES_PER_ELEMENT,s.subarray(l.offset,l.offset+l.count)),l.count=-1),a.version=e.version}}}}function nt(t,e,n,r){H.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new rt(t,e,n,r)),this.mergeVertices()}function rt(t,e,n,r){U.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},t=t||1,e=e||1;var i=t/2,o=e/2;n=Math.floor(n)||1,r=Math.floor(r)||1;var a=n+1,s=r+1,l=t/n,c=e/r,u=[],h=[],p=[],d=[];for(t=0;t<s;t++){var f=t*c-o;for(e=0;e<a;e++)h.push(e*l-i,-f,0),p.push(0,0,1),d.push(e/n),d.push(1-t/r)}for(t=0;t<r;t++)for(e=0;e<n;e++)i=e+a*(t+1),o=e+1+a*(t+1),s=e+1+a*t,u.push(e+a*t,i,s),u.push(i,o,s);this.setIndex(u),this.setAttribute("position",new k(h,3)),this.setAttribute("normal",new k(p,3)),this.setAttribute("uv",new k(d,2))}function it(t,e,n,r){function i(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,r)}var o,a,s=new b(0),l=0,c=null,u=0,h=null;return{getClearColor:function(){return s},setClearColor:function(t,e){s.set(t),l=void 0!==e?e:1,i(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,i(s,l)},render:function(e,r,p,d){r=r.background,p=t.xr,(p=p.getSession&&p.getSession())&&"additive"===p.environmentBlendMode&&(r=null),null===r?i(s,l):r&&r.isColor&&(i(r,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),r&&(r.isCubeTexture||r.isWebGLCubeRenderTarget||306===r.mapping)?(void 0===a&&(a=new j(new Ps(1,1,1),new X({type:"BackgroundCubeMaterial",uniforms:W(Fs.cube.uniforms),vertexShader:Fs.cube.vertexShader,fragmentShader:Fs.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),d=r.isWebGLCubeRenderTarget?r.texture:r,a.material.uniforms.envMap.value=d,a.material.uniforms.flipEnvMap.value=d.isCubeTexture?-1:1,c===r&&u===d.version&&h===t.toneMapping||(a.material.needsUpdate=!0,c=r,u=d.version,h=t.toneMapping),e.unshift(a,a.geometry,a.material,0,0,null)):r&&r.isTexture&&(void 0===o&&(o=new j(new rt(2,2),new X({type:"BackgroundMaterial",uniforms:W(Fs.background.uniforms),vertexShader:Fs.background.vertexShader,fragmentShader:Fs.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=r,!0===r.matrixAutoUpdate&&r.updateMatrix(),o.material.uniforms.uvTransform.value.copy(r.matrix),c===r&&u===r.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=r,u=r.version,h=t.toneMapping),e.unshift(o,o.geometry,o.material,0,0,null))}}}function ot(t,e,n,r){var i,o=r.isWebGL2;this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i)},this.renderInstances=function(r,a,s,l){if(0!==l){if(o){r=t;var c="drawArraysInstanced"}else if(r=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===r)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[c](i,a,s,l),n.update(s,i,l)}}}function at(t,e,n){function r(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var i,o="undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s),n=!0===n.logarithmicDepthBuffer,s=t.getParameter(34930);var l=t.getParameter(35660),c=t.getParameter(3379),u=t.getParameter(34076),h=t.getParameter(34921),p=t.getParameter(36347),d=t.getParameter(36348),f=t.getParameter(36349),m=0<l,g=o||!!e.get("OES_texture_float"),y=m&&g,v=o?t.getParameter(36183):0;return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;var n=e.get("EXT_texture_filter_anisotropic");return i=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:n,maxTextures:s,maxVertexTextures:l,maxTextureSize:c,maxCubemapSize:u,maxAttributes:h,maxVertexUniforms:p,maxVaryings:d,maxFragmentUniforms:f,vertexTextures:m,floatFragmentTextures:g,floatVertexTextures:y,maxSamples:v}}function st(){function t(){u.value!==i&&(u.value=i,u.needsUpdate=0<o),n.numPlanes=o,n.numIntersection=0}function e(t,e,r,i){var o=null!==t?t.length:0,a=null;if(0!==o){if(a=u.value,!0!==i||null===a)for(i=r+4*o,e=e.matrixWorldInverse,c.getNormalMatrix(e),(null===a||a.length<i)&&(a=new Float32Array(i)),i=0;i!==o;++i,r+=4)l.copy(t[i]).applyMatrix4(e,c),l.normal.toArray(a,r),a[r+3]=l.constant;u.value=a,u.needsUpdate=!0}return n.numPlanes=o,n.numIntersection=0,a}var n=this,i=null,o=0,a=!1,s=!1,l=new _,c=new r,u={value:null,needsUpdate:!1};this.uniform=u,this.numIntersection=this.numPlanes=0,this.init=function(t,n,r){var s=0!==t.length||n||0!==o||a;return a=n,i=e(t,r,0),o=t.length,s},this.beginShadows=function(){s=!0,e(null)},this.endShadows=function(){s=!1,t()},this.setState=function(n,r,l,c,h,p){if(!a||null===n||0===n.length||s&&!l)s?e(null):t();else{l=s?0:o;var d=4*l,f=h.clippingState||null;for(u.value=f,f=e(n,c,d,p),n=0;n!==d;++n)f[n]=i[n];h.clippingState=f,this.numIntersection=r?this.numPlanes:0,this.numPlanes+=l}}}function lt(t){var e={};return{get:function(n){if(void 0!==e[n])return e[n];switch(n){case"WEBGL_depth_texture":var r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=r}}}function ct(t,e,n){function r(t){var i=t.target;for(var s in t=o.get(i),null!==t.index&&e.remove(t.index),t.attributes)e.remove(t.attributes[s]);i.removeEventListener("dispose",r),o.delete(i),(s=a.get(t))&&(e.remove(s),a.delete(t)),n.memory.geometries--}function i(t){var n=[],r=t.index,i=t.attributes.position;if(null!==r){var o=r.array;r=r.version,i=0;for(var s=o.length;i<s;i+=3){var l=o[i+0],c=o[i+1],u=o[i+2];n.push(l,c,c,u,u,l)}}else for(o=i.array,r=i.version,i=0,s=o.length/3-1;i<s;i+=3)l=i+0,c=i+1,u=i+2,n.push(l,c,c,u,u,l);n=new(65535<B(n)?N:O)(n,1),n.version=r,e.update(n,34963),(o=a.get(t))&&e.remove(o),a.set(t,n)}var o=new WeakMap,a=new WeakMap;return{get:function(t,e){var i=o.get(e);return i||(e.addEventListener("dispose",r),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new U).setFromObject(t)),i=e._bufferGeometry),o.set(e,i),n.memory.geometries++,i)},update:function(t){var n=t.index,r=t.attributes;for(var i in null!==n&&e.update(n,34963),r)e.update(r[i],34962);for(i in t=t.morphAttributes,t){n=t[i],r=0;for(var o=n.length;r<o;r++)e.update(n[r],34962)}},getWireframeAttribute:function(t){var e=a.get(t);if(e){var n=t.index;null!==n&&e.version<n.version&&i(t)}else i(t);return a.get(t)}}}function ut(t,e,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(t){i=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(i,r,o,e*a),n.update(r,i)},this.renderInstances=function(r,l,c,u){if(0!==u){if(s){r=t;var h="drawElementsInstanced"}else if(r=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===r)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[h](i,c,o,l*a,u),n.update(c,i,u)}}}function ht(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(r=r||1,e.calls++,n){case 4:e.triangles+=t/3*r;break;case 1:e.lines+=t/2*r;break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function pt(t,e){return Math.abs(e[1])-Math.abs(t[1])}function dt(t){var e={},n=new Float32Array(8);return{update:function(r,i,o,a){var s=r.morphTargetInfluences,l=void 0===s?0:s.length;if(r=e[i.id],void 0===r){r=[];for(var c=0;c<l;c++)r[c]=[c,0];e[i.id]=r}var u=o.morphTargets&&i.morphAttributes.position;for(o=o.morphNormals&&i.morphAttributes.normal,c=0;c<l;c++){var h=r[c];0!==h[1]&&(u&&i.deleteAttribute("morphTarget"+c),o&&i.deleteAttribute("morphNormal"+c))}for(c=0;c<l;c++)h=r[c],h[0]=c,h[1]=s[c];for(r.sort(pt),c=s=0;8>c;c++)(h=r[c])&&(l=h[0],h=h[1])?(u&&i.setAttribute("morphTarget"+c,u[l]),o&&i.setAttribute("morphNormal"+c,o[l]),n[c]=h,s+=h):n[c]=0;i=i.morphTargetsRelative?1:1-s,a.getUniforms().setValue(t,"morphTargetBaseInfluence",i),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function ft(t,e,n,r){var i=new WeakMap;return{update:function(t){var o=r.render.frame,a=t.geometry,s=e.get(t,a);return i.get(s)!==o&&(a.isGeometry&&s.updateFromObject(t),e.update(s),i.set(s,o)),t.isInstancedMesh&&n.update(t.instanceMatrix,34962),s},dispose:function(){i=new WeakMap}}}function mt(t,e,n,r,o,a,s,l,c,u){t=void 0!==t?t:[],i.call(this,t,void 0!==e?e:301,n,r,o,a,void 0!==s?s:1022,l,c,u),this.flipY=!1}function gt(t,e,n,r){i.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1,this.needsUpdate=!0}function yt(t,e,n,r){i.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1,this.needsUpdate=!0}function vt(t,e,n){var r=t[0];if(0>=r||0<r)return t;var i=e*n,o=Gs[i];if(void 0===o&&(o=new Float32Array(i),Gs[i]=o),0!==e)for(r.toArray(o,0),r=1,i=0;r!==e;++r)i+=n,t[r].toArray(o,i);return o}function _t(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function xt(t,e){for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}function bt(t,e){var n=Vs[e];void 0===n&&(n=new Int32Array(e),Vs[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function wt(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Mt(t,e){var n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y):_t(n,e)||(t.uniform2fv(this.addr,e),xt(n,e))}function Et(t,e){var n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z):void 0!==e.r?n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b):_t(n,e)||(t.uniform3fv(this.addr,e),xt(n,e))}function St(t,e){var n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w):_t(n,e)||(t.uniform4fv(this.addr,e),xt(n,e))}function Tt(t,e){var n=this.cache,r=e.elements;void 0===r?_t(n,e)||(t.uniformMatrix2fv(this.addr,!1,e),xt(n,e)):_t(n,r)||(qs.set(r),t.uniformMatrix2fv(this.addr,!1,qs),xt(n,r))}function At(t,e){var n=this.cache,r=e.elements;void 0===r?_t(n,e)||(t.uniformMatrix3fv(this.addr,!1,e),xt(n,e)):_t(n,r)||(Ws.set(r),t.uniformMatrix3fv(this.addr,!1,Ws),xt(n,r))}function Ct(t,e){var n=this.cache,r=e.elements;void 0===r?_t(n,e)||(t.uniformMatrix4fv(this.addr,!1,e),xt(n,e)):_t(n,r)||(Hs.set(r),t.uniformMatrix4fv(this.addr,!1,Hs),xt(n,r))}function Lt(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||zs,i)}function It(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Bs,i)}function Pt(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Us,i)}function Rt(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||js,i)}function Ot(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Dt(t,e){var n=this.cache;_t(n,e)||(t.uniform2iv(this.addr,e),xt(n,e))}function Nt(t,e){var n=this.cache;_t(n,e)||(t.uniform3iv(this.addr,e),xt(n,e))}function kt(t,e){var n=this.cache;_t(n,e)||(t.uniform4iv(this.addr,e),xt(n,e))}function Ft(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function zt(t){switch(t){case 5126:return wt;case 35664:return Mt;case 35665:return Et;case 35666:return St;case 35674:return Tt;case 35675:return At;case 35676:return Ct;case 5124:case 35670:return Ot;case 35667:case 35671:return Dt;case 35668:case 35672:return Nt;case 35669:case 35673:return kt;case 5125:return Ft;case 35678:case 36198:case 36298:case 36306:case 35682:return Lt;case 35679:case 36299:case 36307:return Pt;case 35680:case 36300:case 36308:case 36293:return Rt;case 36289:case 36303:case 36311:case 36292:return It}}function Bt(t,e){t.uniform1fv(this.addr,e)}function Ut(t,e){t.uniform1iv(this.addr,e)}function jt(t,e){t.uniform2iv(this.addr,e)}function Gt(t,e){t.uniform3iv(this.addr,e)}function Vt(t,e){t.uniform4iv(this.addr,e)}function Ht(t,e){e=vt(e,this.size,2),t.uniform2fv(this.addr,e)}function Wt(t,e){e=vt(e,this.size,3),t.uniform3fv(this.addr,e)}function qt(t,e){e=vt(e,this.size,4),t.uniform4fv(this.addr,e)}function Xt(t,e){e=vt(e,this.size,4),t.uniformMatrix2fv(this.addr,!1,e)}function Zt(t,e){e=vt(e,this.size,9),t.uniformMatrix3fv(this.addr,!1,e)}function Yt(t,e){e=vt(e,this.size,16),t.uniformMatrix4fv(this.addr,!1,e)}function $t(t,e,n){var r=e.length,i=bt(n,r);for(t.uniform1iv(this.addr,i),t=0;t!==r;++t)n.safeSetTexture2D(e[t]||zs,i[t])}function Jt(t,e,n){var r=e.length,i=bt(n,r);for(t.uniform1iv(this.addr,i),t=0;t!==r;++t)n.safeSetTextureCube(e[t]||js,i[t])}function Kt(t){switch(t){case 5126:return Bt;case 35664:return Ht;case 35665:return Wt;case 35666:return qt;case 35674:return Xt;case 35675:return Zt;case 35676:return Yt;case 5124:case 35670:return Ut;case 35667:case 35671:return jt;case 35668:case 35672:return Gt;case 35669:case 35673:return Vt;case 35678:case 36198:case 36298:case 36306:case 35682:return $t;case 35680:case 36300:case 36308:case 36293:return Jt}}function Qt(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=zt(e.type)}function te(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=Kt(e.type)}function ee(t){this.id=t,this.seq=[],this.map={}}function ne(t,e){this.seq=[],this.map={};for(var n=t.getProgramParameter(e,35718),r=0;r<n;++r){var i=t.getActiveUniform(e,r),o=t.getUniformLocation(e,i.name),a=this,s=i.name,l=s.length;for(Xs.lastIndex=0;;){var c=Xs.exec(s),u=Xs.lastIndex,h=c[1],p=c[3];if("]"===c[2]&&(h|=0),void 0===p||"["===p&&u+2===l){s=a,i=void 0===p?new Qt(h,i,o):new te(h,i,o),s.seq.push(i),s.map[i.id]=i;break}p=a.map[h],void 0===p&&(p=new ee(h),h=a,a=p,h.seq.push(a),h.map[a.id]=a),a=p}}}function re(t,e,n){return e=t.createShader(e),t.shaderSource(e,n),t.compileShader(e),e}function ie(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw Error("unsupported encoding: "+t)}}function oe(t,e,n){var r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";for(t=t.getShaderSource(e).split("\n"),e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t=t.join("\n"),"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+t}function ae(t,e){return e=ie(e),"vec4 "+t+"( vec4 value ) { return "+e[0]+"ToLinear"+e[1]+"; }"}function se(t,e){return e=ie(e),"vec4 "+t+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function le(t,e){switch(e){case 1:e="Linear";break;case 2:e="Reinhard";break;case 3:e="Uncharted2";break;case 4:e="OptimizedCineon";break;case 5:e="ACESFilmic";break;default:throw Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function ce(t){var e,n=[];for(e in t){var r=t[e];!1!==r&&n.push("#define "+e+" "+r)}return n.join("\n")}function ue(t){return""!==t}function he(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pe(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function de(t,e){if(t=ks[e],void 0===t)throw Error("Can not resolve #include <"+e+">");return t.replace(Ys,de)}function fe(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),me(t,e,n,r)}function me(t,e,n,r){for(t="",e=parseInt(e);e<parseInt(n);e++)t+=r.replace(/\[ i \]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return t}function ge(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ye(t){var e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}function ve(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:e="ENVMAP_TYPE_EQUIREC";break;case 305:e="ENVMAP_TYPE_SPHERE"}return e}function _e(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 304:e="ENVMAP_MODE_REFRACTION"}return e}function xe(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}function be(t,e,n){var r,i,o=t.getContext(),a=n.defines,s=n.vertexShader,l=n.fragmentShader,c=ye(n),u=ve(n),h=_e(n),p=xe(n),d=0<t.gammaFactor?t.gammaFactor:1,f=n.isWebGL2?"":[n.extensionDerivatives||n.envMapCubeUV||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ue).join("\n"),m=ce(a),g=o.createProgram();return n.isRawShaderMaterial?(a=[m].filter(ue).join("\n"),0<a.length&&(a+="\n"),c=[f,m].filter(ue).join("\n"),0<c.length&&(c+="\n")):(a=[ge(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ue).join("\n"),c=[f,ge(n),"#define SHADER_NAME "+n.shaderName,m,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?ks.tonemapping_pars_fragment:"",0!==n.toneMapping?le("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?ks.encodings_pars_fragment:"",n.mapEncoding?ae("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?ae("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?ae("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?ae("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?ae("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?se("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ue).join("\n")),s=s.replace(Ys,de),s=he(s,n),s=pe(s,n),l=l.replace(Ys,de),l=he(l,n),l=pe(l,n),s=s.replace(Js,me).replace($s,fe),l=l.replace(Js,me).replace($s,fe),n.isWebGL2&&!n.isRawShaderMaterial&&(u=!1,h=/^\s*#version\s+300\s+es\s*\n/,n.isShaderMaterial&&null!==s.match(h)&&null!==l.match(h)&&(u=!0,s=s.replace(h,""),l=l.replace(h,"")),a="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+a,c=["#version 300 es\n\n#define varying in",u?"":"out highp vec4 pc_fragColor;",u?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+c),l=c+l,s=re(o,35633,a+s),l=re(o,35632,l),o.attachShader(g,s),o.attachShader(g,l),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),t.debug.checkShaderErrors&&(t=o.getProgramInfoLog(g).trim(),u=o.getShaderInfoLog(s).trim(),h=o.getShaderInfoLog(l).trim(),d=p=!0,!1===o.getProgramParameter(g,35714)?(p=!1,f=oe(o,s,"vertex"),m=oe(o,l,"fragment"),console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(g,35715),"gl.getProgramInfoLog",t,f,m)):""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==u&&""!==h||(d=!1),d&&(this.diagnostics={runnable:p,programLog:t,vertexShader:{log:u,prefix:a},fragmentShader:{log:h,prefix:c}})),o.deleteShader(s),o.deleteShader(l),this.getUniforms=function(){return void 0===r&&(r=new ne(o,g)),r},this.getAttributes=function(){if(void 0===i){for(var t={},e=o.getProgramParameter(g,35721),n=0;n<e;n++){var r=o.getActiveAttrib(g,n).name;t[r]=o.getAttribLocation(g,r)}i=t}return i},this.destroy=function(){o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=Zs++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=s,this.fragmentShader=l,this}function we(t,e,n){function r(t){if(t)t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding);else var e=3e3;return e}var i=[],o=n.isWebGL2,a=n.logarithmicDepthBuffer,s=n.floatVertexTextures,l=n.precision,c=n.maxVertexUniforms,u=n.vertexTextures,h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p="precision isWebGL2 supportsVertexTextures outputEncoding instancing map mapEncoding matcap matcapEncoding envMap envMapMode envMapEncoding envMapCubeUV lightMap lightMapEncoding aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap tangentSpaceNormalMap clearcoatMap clearcoatRoughnessMap clearcoatNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors vertexTangents vertexUvs uvsVertexOnly fog useFog fogExp2 flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights numDirLightShadows numPointLightShadows numSpotLightShadows shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering sheen".split(" ");this.getParameters=function(i,p,d,f,m,g,y){var v=f.fog;f=i.isMeshStandardMaterial?f.environment:null,f=i.envMap||f;var _=h[i.type];if(y.isSkinnedMesh){var x=y.skeleton.bones;if(s)x=1024;else{var b=Math.min(Math.floor((c-20)/4),x.length);b<x.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+x.length+" bones. This GPU supports "+b+"."),x=0):x=b}}else x=0;null!==i.precision&&(l=n.getMaxPrecision(i.precision),l!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",l,"instead.")),_?(b=Fs[_],b={name:i.type,uniforms:Rs.clone(b.uniforms),vertexShader:b.vertexShader,fragmentShader:b.fragmentShader}):b={name:i.type,uniforms:i.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader},i.onBeforeCompile(b,t);var w=t.getRenderTarget();return{isWebGL2:o,shaderID:_,shaderName:b.name,uniforms:b.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,defines:i.defines,isRawShaderMaterial:i.isRawShaderMaterial,isShaderMaterial:i.isShaderMaterial,precision:l,instancing:!0===y.isInstancedMesh,supportsVertexTextures:u,outputEncoding:null!==w?r(w.texture):t.outputEncoding,map:!!i.map,mapEncoding:r(i.map),matcap:!!i.matcap,matcapEncoding:r(i.matcap),envMap:!!f,envMapMode:f&&f.mapping,envMapEncoding:r(f),envMapCubeUV:!!f&&(306===f.mapping||307===f.mapping),lightMap:!!i.lightMap,lightMapEncoding:r(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:r(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!i.map||!!i.bumpMap||!!i.normalMap||!!i.specularMap||!!i.alphaMap||!!i.emissiveMap||!!i.roughnessMap||!!i.metalnessMap||!!i.clearcoatMap||!!i.clearcoatRoughnessMap||!!i.clearcoatNormalMap||!!i.displacementMap,uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap)&&!!i.displacementMap,fog:!!v,useFog:i.fog,fogExp2:v&&v.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:a,skinning:i.skinning&&0<x,maxBones:x,useVertexTexture:s,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:p.directional.length,numPointLights:p.point.length,numSpotLights:p.spot.length,numRectAreaLights:p.rectArea.length,numHemiLights:p.hemi.length,numDirLightShadows:p.directionalShadowMap.length,numPointLightShadows:p.pointShadowMap.length,numSpotLightShadows:p.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:g,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&0<d.length,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||null!==e.get("EXT_frag_depth"),rendererExtensionDrawBuffers:o||null!==e.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||null!==e.get("EXT_shader_texture_lod"),onBeforeCompile:i.onBeforeCompile}},this.getProgramCacheKey=function(e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);if(void 0===e.isRawShaderMaterial){for(r=0;r<p.length;r++)n.push(e[p[r]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.onBeforeCompile.toString()),n.join()},this.acquireProgram=function(e,n){for(var r,o=0,a=i.length;o<a;o++){var s=i[o];if(s.cacheKey===n){r=s,++r.usedTimes;break}}return void 0===r&&(r=new be(t,n,e),i.push(r)),r},this.releaseProgram=function(t){if(0===--t.usedTimes){var e=i.indexOf(t);i[e]=i[i.length-1],i.pop(),t.destroy()}},this.programs=i}function Me(){var t=new WeakMap;return{get:function(e){var n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function Ee(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Se(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Te(){function t(t,r,i,a,s,l){var c=e[n];return void 0===c?(c={id:t.id,object:t,geometry:r,material:i,program:i.program||o,groupOrder:a,renderOrder:t.renderOrder,z:s,group:l},e[n]=c):(c.id=t.id,c.object=t,c.geometry=r,c.material=i,c.program=i.program||o,c.groupOrder=a,c.renderOrder=t.renderOrder,c.z=s,c.group=l),n++,c}var e=[],n=0,r=[],i=[],o={id:-1};return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(e,n,o,a,s,l){e=t(e,n,o,a,s,l),(!0===o.transparent?i:r).push(e)},unshift:function(e,n,o,a,s,l){e=t(e,n,o,a,s,l),(!0===o.transparent?i:r).unshift(e)},finish:function(){for(var t=n,r=e.length;t<r;t++){var i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){1<r.length&&r.sort(t||Ee),1<i.length&&i.sort(e||Se)}}}function Ae(){function t(n){n=n.target,n.removeEventListener("dispose",t),e.delete(n)}var e=new WeakMap;return{get:function(n,r){var i=e.get(n);if(void 0===i){var o=new Te;e.set(n,new WeakMap),e.get(n).set(r,o),n.addEventListener("dispose",t)}else o=i.get(r),void 0===o&&(o=new Te,i.set(r,o));return o},dispose:function(){e=new WeakMap}}}function Ce(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];switch(e.type){case"DirectionalLight":var n={direction:new c,color:new b};break;case"SpotLight":n={position:new c,direction:new c,color:new b,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new c,color:new b,distance:0,decay:0};break;case"HemisphereLight":n={direction:new c,skyColor:new b,groundColor:new b};break;case"RectAreaLight":n={color:new b,position:new c,halfWidth:new c,halfHeight:new c}}return t[e.id]=n}}}function Le(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];switch(e.type){case"DirectionalLight":var r={shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case"SpotLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case"PointLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new n,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=r}}}function Ie(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Pe(){for(var t=new Ce,e=Le(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;9>r;r++)n.probe.push(new c);var i=new c,o=new u,a=new u;return{setup:function(r,s,l){for(var c=0,u=0,h=0,p=0;9>p;p++)n.probe[p].set(0,0,0);var d=s=0,f=0,m=0,g=0,y=0,v=0,_=0;l=l.matrixWorldInverse,r.sort(Ie),p=0;for(var x=r.length;p<x;p++){var b=r[p],w=b.color,M=b.intensity,E=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)c+=w.r*M,u+=w.g*M,h+=w.b*M;else if(b.isLightProbe)for(S=0;9>S;S++)n.probe[S].addScaledVector(b.sh.coefficients[S],M);else if(b.isDirectionalLight){var T=t.get(b);T.color.copy(b.color).multiplyScalar(b.intensity),T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(l),b.castShadow&&(M=b.shadow,w=e.get(b),w.shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,n.directionalShadow[s]=w,n.directionalShadowMap[s]=S,n.directionalShadowMatrix[s]=b.shadow.matrix,y++),n.directional[s]=T,s++}else b.isSpotLight?(T=t.get(b),T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(l),T.color.copy(w).multiplyScalar(M),T.distance=E,T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(l),T.coneCos=Math.cos(b.angle),T.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),T.decay=b.decay,b.castShadow&&(M=b.shadow,w=e.get(b),w.shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,n.spotShadow[f]=w,n.spotShadowMap[f]=S,n.spotShadowMatrix[f]=b.shadow.matrix,_++),n.spot[f]=T,f++):b.isRectAreaLight?(T=t.get(b),T.color.copy(w).multiplyScalar(M),T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(l),a.identity(),o.copy(b.matrixWorld),o.premultiply(l),a.extractRotation(o),T.halfWidth.set(.5*b.width,0,0),T.halfHeight.set(0,.5*b.height,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),n.rectArea[m]=T,m++):b.isPointLight?(T=t.get(b),T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(l),T.color.copy(b.color).multiplyScalar(b.intensity),T.distance=b.distance,T.decay=b.decay,b.castShadow&&(M=b.shadow,w=e.get(b),w.shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,w.shadowCameraNear=M.camera.near,w.shadowCameraFar=M.camera.far,n.pointShadow[d]=w,n.pointShadowMap[d]=S,n.pointShadowMatrix[d]=b.shadow.matrix,v++),n.point[d]=T,d++):b.isHemisphereLight&&(T=t.get(b),T.direction.setFromMatrixPosition(b.matrixWorld),T.direction.transformDirection(l),T.direction.normalize(),T.skyColor.copy(b.color).multiplyScalar(M),T.groundColor.copy(b.groundColor).multiplyScalar(M),n.hemi[g]=T,g++)}n.ambient[0]=c,n.ambient[1]=u,n.ambient[2]=h,r=n.hash,r.directionalLength===s&&r.pointLength===d&&r.spotLength===f&&r.rectAreaLength===m&&r.hemiLength===g&&r.numDirectionalShadows===y&&r.numPointShadows===v&&r.numSpotShadows===_||(n.directional.length=s,n.spot.length=f,n.rectArea.length=m,n.point.length=d,n.hemi.length=g,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=v,n.pointShadowMap.length=v,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=v,n.spotShadowMatrix.length=_,r.directionalLength=s,r.pointLength=d,r.spotLength=f,r.rectAreaLength=m,r.hemiLength=g,r.numDirectionalShadows=y,r.numPointShadows=v,r.numSpotShadows=_,n.version=Ks++)},state:n}}function Re(){var t=new Pe,e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(r){t.setup(e,n,r)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)}}}function Oe(){function t(n){n=n.target,n.removeEventListener("dispose",t),e.delete(n)}var e=new WeakMap;return{get:function(n,r){if(!1===e.has(n)){var i=new Re;e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)}else!1===e.get(n).has(r)?(i=new Re,e.get(n).set(r,i)):i=e.get(n).get(r);return i},dispose:function(){e=new WeakMap}}}function De(t){T.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Ne(t){T.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new c,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}function ke(t,e,r){function i(t,e,n){n=t<<0|e<<1|n<<2;var r=f[n];return void 0===r&&(r=new De({depthPacking:3201,morphTargets:t,skinning:e}),f[n]=r),r}function s(t,e,n){n=t<<0|e<<1|n<<2;var r=m[n];return void 0===r&&(r=new Ne({morphTargets:t,skinning:e}),m[n]=r),r}function l(e,n,r,o,a,l,c){var u=i,h=e.customDepthMaterial;return!0===o.isPointLight&&(u=s,h=e.customDistanceMaterial),void 0===h?(h=!1,!0===r.morphTargets&&(h=n.morphAttributes&&n.morphAttributes.position&&0<n.morphAttributes.position.length),n=!1,!0===e.isSkinnedMesh&&(!0===r.skinning?n=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),e=u(h,n,!0===e.isInstancedMesh)):e=h,t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length&&(h=e.uuid,u=r.uuid,n=g[h],void 0===n&&(n={},g[h]=n),h=n[u],void 0===h&&(h=e.clone(),n[u]=h),e=h),e.visible=r.visible,e.wireframe=r.wireframe,e.side=3===c?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:y[r.side],e.clipShadows=r.clipShadows,e.clippingPlanes=r.clippingPlanes,e.clipIntersection=r.clipIntersection,e.wireframeLinewidth=r.wireframeLinewidth,e.linewidth=r.linewidth,!0===o.isPointLight&&!0===e.isMeshDistanceMaterial&&(e.referencePosition.setFromMatrixPosition(o.matrixWorld),e.nearDistance=a,e.farDistance=l),e}function c(n,r,i,o,a){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||u.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);var s=e.update(n),h=n.material;if(Array.isArray(h))for(var p=s.groups,d=0,f=p.length;d<f;d++){var m=p[d],g=h[m.materialIndex];g&&g.visible&&(g=l(n,s,g,o,i.near,i.far,a),t.renderBufferDirect(i,null,s,g,n,m))}else h.visible&&(g=l(n,s,h,o,i.near,i.far,a),t.renderBufferDirect(i,null,s,g,n,null))}for(n=n.children,s=0,h=n.length;s<h;s++)c(n[s],r,i,o,a)}}var u=new Q,h=new n,p=new n,d=new o,f=[],m=[],g={},y={0:1,1:0,2:2},v=new X({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:.125},uniforms:{shadow_pass:{value:null},resolution:{value:new n},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=v.clone();_.defines.HORIZONAL_PASS=1;var x=new U;x.setAttribute("position",new C(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var b=new j(x,v),w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(n,i,o){if(!1!==w.enabled&&(!1!==w.autoUpdate||!1!==w.needsUpdate)&&0!==n.length){var s=t.getRenderTarget(),l=t.getActiveCubeFace(),f=t.getActiveMipmapLevel(),m=t.state;m.setBlending(0),m.buffers.color.setClear(1,1,1,1),m.buffers.depth.setTest(!0),m.setScissorTest(!1);for(var g=0,y=n.length;g<y;g++){var x=n[g],M=x.shadow;if(void 0===M)console.warn("THREE.WebGLShadowMap:",x,"has no shadow.");else{h.copy(M.mapSize);var E=M.getFrameExtents();h.multiply(E),p.copy(M.mapSize),(h.x>r||h.y>r)&&(h.x>r&&(p.x=Math.floor(r/E.x),h.x=p.x*E.x,M.mapSize.x=p.x),h.y>r&&(p.y=Math.floor(r/E.y),h.y=p.y*E.y,M.mapSize.y=p.y)),null!==M.map||M.isPointLightShadow||3!==this.type||(E={minFilter:1006,magFilter:1006,format:1023},M.map=new a(h.x,h.y,E),M.map.texture.name=x.name+".shadowMap",M.mapPass=new a(h.x,h.y,E),M.camera.updateProjectionMatrix()),null===M.map&&(E={minFilter:1003,magFilter:1003,format:1023},M.map=new a(h.x,h.y,E),M.map.texture.name=x.name+".shadowMap",M.camera.updateProjectionMatrix()),t.setRenderTarget(M.map),t.clear(),E=M.getViewportCount();for(var S=0;S<E;S++){var T=M.getViewport(S);d.set(p.x*T.x,p.y*T.y,p.x*T.z,p.y*T.w),m.viewport(d),M.updateMatrices(x,S),u=M.getFrustum(),c(i,o,M.camera,x,this.type)}M.isPointLightShadow||3!==this.type||(x=M,M=o,E=e.update(b),v.uniforms.shadow_pass.value=x.map.texture,v.uniforms.resolution.value=x.mapSize,v.uniforms.radius.value=x.radius,t.setRenderTarget(x.mapPass),t.clear(),t.renderBufferDirect(M,null,E,v,b,null),_.uniforms.shadow_pass.value=x.mapPass.texture,_.uniforms.resolution.value=x.mapSize,_.uniforms.radius.value=x.radius,t.setRenderTarget(x.map),t.clear(),t.renderBufferDirect(M,null,E,_,b,null))}}w.needsUpdate=!1,t.setRenderTarget(s,l,f)}}}function Fe(t,e,n){function r(e,n,r){var i=new Uint8Array(4),o=t.createTexture();for(t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728),e=0;e<r;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,i);return o}function i(n,r){y[n]=1,0===v[n]&&(t.enableVertexAttribArray(n),v[n]=1),_[n]!==r&&((d?t:e.get("ANGLE_instanced_arrays"))[d?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),_[n]=r)}function a(e){!0!==x[e]&&(t.enable(e),x[e]=!0)}function s(e){!1!==x[e]&&(t.disable(e),x[e]=!1)}function l(e,n,r,i,o,l,c,u){if(0===e)w&&(s(3042),w=!1);else if(w||(a(3042),w=!0),5!==e){if(e!==M||u!==I){if(100===E&&100===A||(t.blendEquation(32774),A=E=100),u)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}L=C=T=S=null,M=e,I=u}}else o=o||n,l=l||r,c=c||i,n===E&&o===A||(t.blendEquationSeparate(V[n],V[o]),E=n,A=o),r===S&&i===T&&l===C&&c===L||(t.blendFuncSeparate(H[r],H[i],H[l],H[c]),S=r,T=i,C=l,L=c),M=e,I=null}function c(e){P!==e&&(e?t.frontFace(2304):t.frontFace(2305),P=e)}function u(e){0!==e?(a(2884),e!==R&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):s(2884),R=e}function h(e,n,r){e?(a(32823),(D!==n||N!==r)&&(t.polygonOffset(n,r),D=n,N=r)):s(32823)}function p(e){void 0===e&&(e=33984+k-1),z!==e&&(t.activeTexture(e),z=e)}var d=n.isWebGL2,f=new function(){var e=!1,n=new o,r=null,i=new o(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,a,s){!0===s&&(e*=a,r*=a,o*=a),n.set(e,r,o,a),!1===i.equals(n)&&(t.clearColor(e,r,o,a),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},m=new function(){var e=!1,n=null,r=null,i=null;return{setTest:function(t){t?a(2929):s(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,i=r=n=null}}},g=new function(){var e=!1,n=null,r=null,i=null,o=null,l=null,c=null,u=null,h=null;return{setTest:function(t){e||(t?a(2960):s(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,a){r===e&&i===n&&o===a||(t.stencilFunc(e,n,a),r=e,i=n,o=a)},setOp:function(e,n,r){l===e&&c===n&&u===r||(t.stencilOp(e,n,r),l=e,c=n,u=r)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,h=u=c=l=o=i=r=n=null}}};n=t.getParameter(34921);var y=new Uint8Array(n),v=new Uint8Array(n),_=new Uint8Array(n),x={},b=null,w=null,M=null,E=null,S=null,T=null,A=null,C=null,L=null,I=!1,P=null,R=null,O=null,D=null,N=null,k=t.getParameter(35661),F=!1;n=0,n=t.getParameter(7938),-1!==n.indexOf("WebGL")?(n=parseFloat(/^WebGL ([0-9])/.exec(n)[1]),F=1<=n):-1!==n.indexOf("OpenGL ES")&&(n=parseFloat(/^OpenGL ES ([0-9])/.exec(n)[1]),F=2<=n);var z=null,B={},U=new o,j=new o,G={};G[3553]=r(3553,3553,1),G[34067]=r(34067,34069,6),f.setClear(0,0,0,1),m.setClear(1),g.setClear(0),a(2929),m.setFunc(3),c(!1),u(1),a(2884),l(0);var V={100:32774,101:32778,102:32779};d?(V[103]=32775,V[104]=32776):(n=e.get("EXT_blend_minmax"),null!==n&&(V[103]=n.MIN_EXT,V[104]=n.MAX_EXT));var H={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};return{buffers:{color:f,depth:m,stencil:g},initAttributes:function(){for(var t=0,e=y.length;t<e;t++)y[t]=0},enableAttribute:function(t){i(t,0)},enableAttributeAndDivisor:i,disableUnusedAttributes:function(){for(var e=0,n=v.length;e!==n;++e)v[e]!==y[e]&&(t.disableVertexAttribArray(e),v[e]=0)},vertexAttribPointer:function(e,n,r,i,o,a){!0!==d||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,i,o,a):t.vertexAttribIPointer(e,n,r,i,o,a)},enable:a,disable:s,useProgram:function(e){return b!==e&&(t.useProgram(e),b=e,!0)},setBlending:l,setMaterial:function(t,e){2===t.side?s(2884):a(2884);var n=1===t.side;e&&(n=!n),c(n),1===t.blending&&!1===t.transparent?l(0):l(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),m.setFunc(t.depthFunc),m.setTest(t.depthTest),m.setMask(t.depthWrite),f.setMask(t.colorWrite),e=t.stencilWrite,g.setTest(e),e&&(g.setMask(t.stencilWriteMask),g.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),g.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),h(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:c,setCullFace:u,setLineWidth:function(e){e!==O&&(F&&t.lineWidth(e),O=e)},setPolygonOffset:h,setScissorTest:function(t){t?a(3089):s(3089)},activeTexture:p,bindTexture:function(e,n){null===z&&p();var r=B[z];void 0===r&&(r={type:void 0,texture:void 0},B[z]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||G[e]),r.type=e,r.texture=n)},unbindTexture:function(){var e=B[z];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===U.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),U.copy(e))},viewport:function(e){!1===j.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),j.copy(e))},reset:function(){for(var e=0;e<v.length;e++)1===v[e]&&(t.disableVertexAttribArray(e),v[e]=0);x={},z=null,B={},R=P=M=b=null,f.reset(),m.reset(),g.reset()}}}function ze(t,e,n,r,i,o,a){function s(t,e){return R?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function l(t,e,n,r){var i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),1>i||!0===e){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap)return r=e?Vo.floorPowerOfTwo:Math.floor,e=r(i*t.width),i=r(i*t.height),void 0===S&&(S=s(e,i)),n=n?s(e,i):S,n.width=e,n.height=i,n.getContext("2d").drawImage(t,0,0,e,i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+e+"x"+i+")."),n;"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+").")}return t}function c(t){return Vo.isPowerOfTwo(t.width)&&Vo.isPowerOfTwo(t.height)}function u(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function h(e,n,i,o){t.generateMipmap(e),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function p(n,r,i){if(!1===T)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}return n=r,6403===r&&(5126===i&&(n=33326),5131===i&&(n=33325),5121===i&&(n=33321)),6407===r&&(5126===i&&(n=34837),5131===i&&(n=34843),5121===i&&(n=32849)),6408===r&&(5126===i&&(n=34836),5131===i&&(n=34842),5121===i&&(n=32856)),33325!==n&&33326!==n&&34842!==n&&34836!==n||e.get("EXT_color_buffer_float"),n}function d(t){return 1003===t||1004===t||1005===t?9728:9729}function f(e){e=e.target,e.removeEventListener("dispose",f);var n=r.get(e);void 0!==n.__webglInit&&(t.deleteTexture(n.__webglTexture),r.remove(e)),e.isVideoTexture&&P.delete(e),a.memory.textures--}function m(e){e=e.target,e.removeEventListener("dispose",m);var n=r.get(e),i=r.get(e.texture);if(e){if(void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(i=0;6>i;i++)t.deleteFramebuffer(n.__webglFramebuffer[i]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[i]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(e.texture),r.remove(e)}a.memory.textures--}function g(t,e){var i=r.get(t);if(t.isVideoTexture){var o=a.render.frame;P.get(t)!==o&&(P.set(t,o),t.update())}if(0<t.version&&i.__version!==t.version)if(o=t.image,void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void b(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function y(e,i){if(6===e.image.length){var a=r.get(e);if(0<e.version&&a.__version!==e.version){x(a,e),n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture),t.pixelStorei(37440,e.flipY);var s=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture);i=e.image[0]&&e.image[0].isDataTexture;for(var d=[],f=0;6>f;f++)d[f]=s||i?i?e.image[f].image:e.image[f]:l(e.image[f],!1,!0,C);var m=d[0],g=c(m)||T,y=o.convert(e.format),v=o.convert(e.type),b=p(e.internalFormat,y,v);if(_(34067,e,g),s){for(f=0;6>f;f++){var w=d[f].mipmaps;for(s=0;s<w.length;s++){var M=w[s];1023!==e.format&&1022!==e.format?null!==y?n.compressedTexImage2D(34069+f,s,b,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+f,s,b,M.width,M.height,0,y,v,M.data)}}a.__maxMipLevel=w.length-1}else{for(w=e.mipmaps,f=0;6>f;f++)if(i)for(n.texImage2D(34069+f,0,b,d[f].width,d[f].height,0,y,v,d[f].data),s=0;s<w.length;s++)M=w[s],M=M.image[f].image,n.texImage2D(34069+f,s+1,b,M.width,M.height,0,y,v,M.data);else for(n.texImage2D(34069+f,0,b,y,v,d[f]),s=0;s<w.length;s++)M=w[s],n.texImage2D(34069+f,s+1,b,y,v,M.image[f]);a.__maxMipLevel=w.length}u(e,g)&&h(34067,e,m.width,m.height),a.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture)}}function v(t,e){n.activeTexture(33984+e),n.bindTexture(34067,r.get(t).__webglTexture)}function _(n,o,a){a?(t.texParameteri(n,10242,D[o.wrapS]),t.texParameteri(n,10243,D[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,D[o.wrapR]),t.texParameteri(n,10240,N[o.magFilter]),t.texParameteri(n,10241,N[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,d(o.magFilter)),t.texParameteri(n,10241,d(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!(a=e.get("EXT_texture_filter_anisotropic"))||1015===o.type&&null===e.get("OES_texture_float_linear")||1016===o.type&&null===(T||e.get("OES_texture_half_float_linear"))||!(1<o.anisotropy||r.get(o).__currentAnisotropy)||(t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}function x(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",f),e.__webglTexture=t.createTexture(),a.memory.textures++)}function b(e,r,i){var a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),x(e,r),n.activeTexture(33984+i),n.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),i=!T&&(1001!==r.wrapS||1001!==r.wrapT||1003!==r.minFilter&&1006!==r.minFilter),i=i&&!1===c(r.image),i=l(r.image,i,!1,L);var s=c(i)||T,d=o.convert(r.format),f=o.convert(r.type),m=p(r.internalFormat,d,f);_(a,r,s);var g=r.mipmaps;if(r.isDepthTexture)m=6402,T?m=1015===r.type?36012:1014===r.type?33190:1020===r.type?35056:33189:1015===r.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===r.format&&6402===m&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,f=o.convert(r.type)),1027===r.format&&6402===m&&(m=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,f=o.convert(r.type))),n.texImage2D(3553,0,m,i.width,i.height,0,d,f,null);else if(r.isDataTexture)if(0<g.length&&s){for(var y=0,v=g.length;y<v;y++){var b=g[y];n.texImage2D(3553,y,m,b.width,b.height,0,d,f,b.data)}r.generateMipmaps=!1,e.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,i.width,i.height,0,d,f,i.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(y=0,v=g.length;y<v;y++)b=g[y],1023!==r.format&&1022!==r.format?null!==d?n.compressedTexImage2D(3553,y,m,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,y,m,b.width,b.height,0,d,f,b.data);e.__maxMipLevel=g.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,i.width,i.height,i.depth,0,d,f,i.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,i.width,i.height,i.depth,0,d,f,i.data),e.__maxMipLevel=0;else if(0<g.length&&s){for(y=0,v=g.length;y<v;y++)b=g[y],n.texImage2D(3553,y,m,d,f,b);r.generateMipmaps=!1,e.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,d,f,i),e.__maxMipLevel=0;u(r,s)&&h(a,r,i.width,i.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function w(e,i,a,s){var l=o.convert(i.texture.format),c=o.convert(i.texture.type),u=p(i.texture.internalFormat,l,c);n.texImage2D(s,0,u,i.width,i.height,0,l,c,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,s,r.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function M(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){var i=33189;r?((r=n.depthTexture)&&r.isDepthTexture&&(1015===r.type?i=36012:1014===r.type&&(i=33190)),r=E(n),t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)):t.renderbufferStorage(36161,i,n.width,n.height),t.framebufferRenderbuffer(36160,36096,36161,e)}else n.depthBuffer&&n.stencilBuffer?(r?(r=E(n),t.renderbufferStorageMultisample(36161,r,35056,n.width,n.height)):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)):(e=o.convert(n.texture.format),i=o.convert(n.texture.type),i=p(n.texture.internalFormat,e,i),r?(r=E(n),t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)):t.renderbufferStorage(36161,i,n.width,n.height));t.bindRenderbuffer(36161,null)}function E(t){return T&&t.isWebGLMultisampleRenderTarget?Math.min(I,t.samples):0}var S,T=i.isWebGL2,A=i.maxTextures,C=i.maxCubemapSize,L=i.maxTextureSize,I=i.maxSamples,P=new WeakMap,R=!1;try{R="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(z){}var O=0,D={1e3:10497,1001:33071,1002:33648},N={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987},k=!1,F=!1;this.allocateTextureUnit=function(){var t=O;return t>=A&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+A),O+=1,t},this.resetTextureUnits=function(){O=0},this.setTexture2D=g,this.setTexture2DArray=function(t,e){var i=r.get(t);0<t.version&&i.__version!==t.version?b(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){var i=r.get(t);0<t.version&&i.__version!==t.version?b(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=y,this.setTextureCubeDynamic=v,this.setupRenderTarget=function(e){var i=r.get(e),s=r.get(e.texture);e.addEventListener("dispose",m),s.__webglTexture=t.createTexture(),a.memory.textures++;var l=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultisampleRenderTarget,f=c(e)||T;if(!T||1022!==e.texture.format||1015!==e.texture.type&&1016!==e.texture.type||(e.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l)for(i.__webglFramebuffer=[],d=0;6>d;d++)i.__webglFramebuffer[d]=t.createFramebuffer();else if(i.__webglFramebuffer=t.createFramebuffer(),d)if(T){i.__webglMultisampledFramebuffer=t.createFramebuffer(),i.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,i.__webglColorRenderbuffer),d=o.convert(e.texture.format);var y=o.convert(e.texture.type);d=p(e.texture.internalFormat,d,y),y=E(e),t.renderbufferStorageMultisample(36161,y,d,e.width,e.height),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(i.__webglDepthRenderbuffer=t.createRenderbuffer(),M(i.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){for(n.bindTexture(34067,s.__webglTexture),_(34067,e.texture,f),d=0;6>d;d++)w(i.__webglFramebuffer[d],e,36064,34069+d);u(e.texture,f)&&h(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,s.__webglTexture),_(3553,e.texture,f),w(i.__webglFramebuffer,e,36064,3553),u(e.texture,f)&&h(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);if(e.depthBuffer){if(i=r.get(e),s=!0===e.isWebGLCubeRenderTarget,e.depthTexture){if(s)throw Error("target.depthTexture not supported in Cube render targets");if(e&&e.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,i.__webglFramebuffer),!e.depthTexture||!e.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(r.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),g(e.depthTexture,0),i=r.get(e.depthTexture).__webglTexture,1026===e.depthTexture.format)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(1027!==e.depthTexture.format)throw Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}else if(s)for(i.__webglDepthbuffer=[],s=0;6>s;s++)t.bindFramebuffer(36160,i.__webglFramebuffer[s]),i.__webglDepthbuffer[s]=t.createRenderbuffer(),M(i.__webglDepthbuffer[s],e,!1);else t.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),M(i.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}},this.updateRenderTargetMipmap=function(t){var e=t.texture,i=c(t)||T;if(u(e,i)){i=t.isWebGLCubeRenderTarget?34067:3553;var o=r.get(e).__webglTexture;n.bindTexture(i,o),h(i,e,t.width,t.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(T){var n=r.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);var i=e.width,o=e.height,a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),t=t.texture),g(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?y(t,e):v(t,e)}}function Be(t,e,n){var r=n.isWebGL2;return{convert:function(t){if(1009===t)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(1012===t)return 5123;if(1013===t)return 5124;if(1014===t)return 5125;if(1015===t)return 5126;if(1016===t){if(r)return 5131;var n=e.get("OES_texture_half_float");return null!==n?n.HALF_FLOAT_OES:null}if(1021===t)return 6406;if(1022===t)return 6407;if(1023===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(1026===t)return 6402;if(1027===t)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===t)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===t)return n.COMPRESSED_RGB8_ETC2;if(37496===t)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):36492===t?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):1020===t?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Ue(t){Y.call(this),this.cameras=t||[]}function je(){d.call(this),this.type="Group"}function Ge(){this._grip=this._targetRay=null}function Ve(t,e){function n(t){var e=g.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function r(){g.forEach((function(t,e){t.disconnect(e)})),g.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),T.stop(),l.isPresenting=!1,l.dispatchEvent({type:"sessionend"})}function i(t){p=t,T.setContext(u),T.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}function a(t){for(var e=u.inputSources,n=0;n<m.length;n++)g.set(e[n],m[n]);for(n=0;n<t.removed.length;n++){e=t.removed[n];var r=g.get(e);r&&(r.dispatchEvent({type:"disconnected",data:e}),g.delete(e))}for(n=0;n<t.added.length;n++)e=t.added[n],(r=g.get(e))&&r.dispatchEvent({type:"connected",data:e})}function s(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}var l=this,u=null,h=1,p=null,d="local-floor",f=null,m=[],g=new Map,y=new Y;y.layers.enable(1),y.viewport=new o;var v=new Y;v.layers.enable(2),v.viewport=new o;var _=[y,v],x=new Ue;x.layers.enable(1),x.layers.enable(2);var b=null,w=null;this.isPresenting=this.enabled=!1,this.getController=function(t){var e=m[t];return void 0===e&&(e=new Ge,m[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){var e=m[t];return void 0===e&&(e=new Ge,m[t]=e),e.getGripSpace()},this.setFramebufferScaleFactor=function(t){h=t,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){d=t,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p},this.getSession=function(){return u},this.setSession=function(t){u=t,null!==u&&(u.addEventListener("select",n),u.addEventListener("selectstart",n),u.addEventListener("selectend",n),u.addEventListener("squeeze",n),u.addEventListener("squeezestart",n),u.addEventListener("squeezeend",n),u.addEventListener("end",r),t=e.getContextAttributes(),!0!==t.xrCompatible&&e.makeXRCompatible(),t=new XRWebGLLayer(u,e,{antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:h}),u.updateRenderState({baseLayer:t}),u.requestReferenceSpace(d).then(i),u.addEventListener("inputsourceschange",a))};var M=new c,E=new c;this.getCamera=function(t){x.near=v.near=y.near=t.near,x.far=v.far=y.far=t.far,b===x.near&&w===x.far||(u.updateRenderState({depthNear:x.near,depthFar:x.far}),b=x.near,w=x.far);var e=t.parent,n=x.cameras;s(x,e);for(var r=0;r<n.length;r++)s(n[r],e);for(t.matrixWorld.copy(x.matrixWorld),t=t.children,r=0,e=t.length;r<e;r++)t[r].updateMatrixWorld(!0);if(2===n.length){M.setFromMatrixPosition(y.matrixWorld),E.setFromMatrixPosition(v.matrixWorld),n=M.distanceTo(E);var i=y.projectionMatrix.elements,o=v.projectionMatrix.elements,a=i[14]/(i[10]-1);r=i[14]/(i[10]+1),t=(i[9]+1)/i[5],e=(i[9]-1)/i[5];var l=(i[8]-1)/i[0],c=(o[8]+1)/o[0];o=a*l,i=a*c,c=n/(-l+c),l=c*-l,y.matrixWorld.decompose(x.position,x.quaternion,x.scale),x.translateX(l),x.translateZ(c),x.matrixWorld.compose(x.position,x.quaternion,x.scale),x.matrixWorldInverse.getInverse(x.matrixWorld),a+=c,c=r+c,x.projectionMatrix.makePerspective(o-l,i+(n-l),t*r/c*a,e*r/c*a,a,c)}else x.projectionMatrix.copy(y.projectionMatrix);return x};var S=null,T=new tt;T.setAnimationLoop((function(e,n){if(f=n.getViewerPose(p),null!==f){var r=f.views,i=u.renderState.baseLayer;t.setFramebuffer(i.framebuffer);var o=!1;r.length!==x.cameras.length&&(x.cameras.length=0,o=!0);for(var a=0;a<r.length;a++){var s=r[a],l=i.getViewport(s),c=_[a];c.matrix.fromArray(s.transform.matrix),c.projectionMatrix.fromArray(s.projectionMatrix),c.viewport.set(l.x,l.y,l.width,l.height),0===a&&x.matrix.copy(c.matrix),!0===o&&x.cameras.push(c)}}for(r=u.inputSources,a=0;a<m.length;a++)m[a].update(r[a],n,p);S&&S(e,n)})),this.setAnimationLoop=function(t){S=t},this.dispose=function(){}}function He(t){function e(e,n,r){if(e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap),(r=n.envMap||r)&&(e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio,e.maxMipLevel.value=t.get(r).__maxMipLevel),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map)var i=n.map;else n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap&&(i=n.emissiveMap);if(void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap)var o=n.aoMap;else n.lightMap&&(o=n.lightMap);void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function n(t,e,n){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||n)&&(t.envMapIntensity.value=e.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,o,a){if(r.isMeshBasicMaterial)e(t,r);else if(r.isMeshLambertMaterial)e(t,r),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap);else if(r.isMeshToonMaterial)e(t,r),t.specular.value.copy(r.specular),t.shininess.value=Math.max(r.shininess,1e-4),r.gradientMap&&(t.gradientMap.value=r.gradientMap),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isMeshPhongMaterial)e(t,r),t.specular.value.copy(r.specular),t.shininess.value=Math.max(r.shininess,1e-4),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isMeshStandardMaterial)e(t,r,i),r.isMeshPhysicalMaterial?(n(t,r,i),t.reflectivity.value=r.reflectivity,t.clearcoat.value=r.clearcoat,t.clearcoatRoughness.value=r.clearcoatRoughness,r.sheen&&t.sheen.value.copy(r.sheen),r.clearcoatMap&&(t.clearcoatMap.value=r.clearcoatMap),r.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=r.clearcoatRoughnessMap),r.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(r.clearcoatNormalScale),t.clearcoatNormalMap.value=r.clearcoatNormalMap,1===r.side&&t.clearcoatNormalScale.value.negate()),t.transparency.value=r.transparency):n(t,r,i);else if(r.isMeshMatcapMaterial)e(t,r),r.matcap&&(t.matcap.value=r.matcap),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isMeshDepthMaterial)e(t,r),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isMeshDistanceMaterial)e(t,r),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias),t.referencePosition.value.copy(r.referencePosition),t.nearDistance.value=r.nearDistance,t.farDistance.value=r.farDistance;else if(r.isMeshNormalMaterial)e(t,r),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isLineBasicMaterial)t.diffuse.value.copy(r.color),t.opacity.value=r.opacity,r.isLineDashedMaterial&&(t.dashSize.value=r.dashSize,t.totalSize.value=r.dashSize+r.gapSize,t.scale.value=r.scale);else if(r.isPointsMaterial){if(t.diffuse.value.copy(r.color),t.opacity.value=r.opacity,t.size.value=r.size*o,t.scale.value=.5*a,r.map&&(t.map.value=r.map),r.alphaMap&&(t.alphaMap.value=r.alphaMap),r.map)var s=r.map;else r.alphaMap&&(s=r.alphaMap);void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uvTransform.value.copy(s.matrix))}else if(r.isSpriteMaterial){if(t.diffuse.value.copy(r.color),t.opacity.value=r.opacity,t.rotation.value=r.rotation,r.map&&(t.map.value=r.map),r.alphaMap&&(t.alphaMap.value=r.alphaMap),r.map)var l=r.map;else r.alphaMap&&(l=r.alphaMap);void 0!==l&&(!0===l.matrixAutoUpdate&&l.updateMatrix(),t.uvTransform.value.copy(l.matrix))}else r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function We(t){var e;function r(){I=new lt(Ft),P=new at(Ft,I,t),!1===P.isWebGL2&&(I.get("WEBGL_depth_texture"),I.get("OES_texture_float"),I.get("OES_texture_half_float"),I.get("OES_texture_half_float_linear"),I.get("OES_standard_derivatives"),I.get("OES_element_index_uint"),I.get("ANGLE_instanced_arrays")),I.get("OES_texture_float_linear"),X=new Be(Ft,I,P),R=new Fe(Ft,I,P),R.scissor(bt.copy(Lt).multiplyScalar(St).floor()),R.viewport(xt.copy(Ct).multiplyScalar(St).floor()),O=new ht(Ft),D=new Me,N=new ze(Ft,I,R,D,P,X,O),k=new et(Ft,P),F=new ct(Ft,k,O),z=new ft(Ft,F,k,O),H=new dt(Ft),B=new we(Z,I,P),U=new He(D),j=new Ae,G=new Oe,V=new it(Z,R,z,E),W=new ot(Ft,I,O,P),q=new ut(Ft,I,O,P),O.programs=B.programs,Z.capabilities=P,Z.extensions=I,Z.properties=D,Z.renderLists=j,Z.state=R,Z.info=O}function i(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Y=!0}function a(){console.log("THREE.WebGLRenderer: Context Restored."),Y=!1,r()}function s(t){t=t.target,t.removeEventListener("dispose",s),l(t),D.remove(t)}function l(t){var e=D.get(t).program;t.program=void 0,void 0!==e&&B.releaseProgram(e)}function h(t,e){t.render((function(t){Z.renderBufferImmediate(t,e)}))}function p(t,e,n,r){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)L.pushLight(t),t.castShadow&&L.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Pt.intersectsSprite(t)){r&&kt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Nt);var i=z.update(t),o=t.material;o.visible&&C.push(t,i,o,n,kt.z,null)}}else if(t.isImmediateRenderObject)r&&kt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Nt),C.push(t,null,t.material,n,kt.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==O.render.frame&&(t.skeleton.update(),t.skeleton.frame=O.render.frame),!t.frustumCulled||Pt.intersectsObject(t)))if(r&&kt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Nt),i=z.update(t),o=t.material,Array.isArray(o))for(var a=i.groups,s=0,l=a.length;s<l;s++){var c=a[s],u=o[c.materialIndex];u&&u.visible&&C.push(t,i,u,n,kt.z,c)}else o.visible&&C.push(t,i,o,n,kt.z,null);for(t=t.children,s=0,l=t.length;s<l;s++)p(t[s],e,n,r)}}function d(t,e,n,r){for(var i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,l=a.geometry,c=void 0===r?a.material:r;if(a=a.group,n.isArrayCamera){_t=n;for(var u=n.cameras,h=0,p=u.length;h<p;h++){var d=u[h];s.layers.test(d.layers)&&(R.viewport(xt.copy(d.viewport)),L.setupLights(d),m(s,e,d,l,c,a))}}else _t=null,m(s,e,n,l,c,a)}}function m(t,n,r,i,o,a){if(t.onBeforeRender(Z,n,r,i,o,a),L=G.get(n,_t||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var s=y(r,n,o,t);R.setMaterial(o),gt=e=null,yt=!1,h(t,s)}else Z.renderBufferDirect(r,n,i,o,t,a);t.onAfterRender(Z,n,r,i,o,a),L=G.get(n,_t||r)}function g(t,e,n){var r=D.get(t),i=L.state.lights,o=i.state.version;n=B.getParameters(t,i.state,L.state.shadowsArray,e,Rt.numPlanes,Rt.numIntersection,n);var a=B.getProgramCacheKey(n),c=r.program,u=!0;if(void 0===c)t.addEventListener("dispose",s);else if(c.cacheKey!==a)l(t);else{if(r.lightsStateVersion!==o)r.lightsStateVersion=o;else if(void 0!==n.shaderID)return;u=!1}if(u&&(c=B.acquireProgram(n,a),r.program=c,r.uniforms=n.uniforms,r.outputEncoding=n.outputEncoding,t.program=c),n=c.getAttributes(),t.morphTargets)for(a=t.numSupportedMorphTargets=0;a<Z.maxMorphTargets;a++)0<=n["morphTarget"+a]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(a=t.numSupportedMorphNormals=0;a<Z.maxMorphNormals;a++)0<=n["morphNormal"+a]&&t.numSupportedMorphNormals++;n=r.uniforms,(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=Rt.numPlanes,r.numIntersection=Rt.numIntersection,n.clippingPlanes=Rt.uniform),r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.needsLights=t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights,r.lightsStateVersion=o,r.needsLights&&(n.ambientLightColor.value=i.state.ambient,n.lightProbe.value=i.state.probe,n.directionalLights.value=i.state.directional,n.directionalLightShadows.value=i.state.directionalShadow,n.spotLights.value=i.state.spot,n.spotLightShadows.value=i.state.spotShadow,n.rectAreaLights.value=i.state.rectArea,n.pointLights.value=i.state.point,n.pointLightShadows.value=i.state.pointShadow,n.hemisphereLights.value=i.state.hemi,n.directionalShadowMap.value=i.state.directionalShadowMap,n.directionalShadowMatrix.value=i.state.directionalShadowMatrix,n.spotShadowMap.value=i.state.spotShadowMap,n.spotShadowMatrix.value=i.state.spotShadowMatrix,n.pointShadowMap.value=i.state.pointShadowMap,n.pointShadowMatrix.value=i.state.pointShadowMatrix),t=r.program.getUniforms(),t=ne.seqWithValue(t.seq,n),r.uniformsList=t}function y(t,e,n,r){N.resetTextureUnits();var i=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===rt?Z.outputEncoding:rt.texture.encoding,s=D.get(n),l=L.state.lights;Ot&&(Dt||t!==vt)&&Rt.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,s,t===vt&&n.id===mt),n.version===s.__version?void 0===s.program||n.fog&&s.fog!==i||s.environment!==o||s.needsLights&&s.lightsStateVersion!==l.state.version?g(n,e,r):void 0===s.numClippingPlanes||s.numClippingPlanes===Rt.numPlanes&&s.numIntersection===Rt.numIntersection?s.outputEncoding!==a&&g(n,e,r):g(n,e,r):(g(n,e,r),s.__version=n.version);var c=!1,u=!1,h=!1;if(e=s.program,a=e.getUniforms(),l=s.uniforms,R.useProgram(e.program)&&(h=u=c=!0),n.id!==mt&&(mt=n.id,u=!0),(c||vt!==t)&&(a.setValue(Ft,"projectionMatrix",t.projectionMatrix),P.logarithmicDepthBuffer&&a.setValue(Ft,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),vt!==t&&(vt=t,h=u=!0),(n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap)&&(c=a.map.cameraPosition,void 0!==c&&c.setValue(Ft,kt.setFromMatrixPosition(t.matrixWorld))),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&a.setValue(Ft,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&a.setValue(Ft,"viewMatrix",t.matrixWorldInverse)),n.skinning&&(a.setOptional(Ft,r,"bindMatrix"),a.setOptional(Ft,r,"bindMatrixInverse"),t=r.skeleton))if(c=t.bones,P.floatVertexTextures){if(void 0===t.boneTexture){c=Math.sqrt(4*c.length),c=Vo.ceilPowerOfTwo(c),c=Math.max(c,4);var p=new Float32Array(c*c*4);p.set(t.boneMatrices);var d=new K(p,c,c,1023,1015);t.boneMatrices=p,t.boneTexture=d,t.boneTextureSize=c}a.setValue(Ft,"boneTexture",t.boneTexture,N),a.setValue(Ft,"boneTextureSize",t.boneTextureSize)}else a.setOptional(Ft,t,"boneMatrices");return(u||s.receiveShadow!==r.receiveShadow)&&(s.receiveShadow=r.receiveShadow,a.setValue(Ft,"receiveShadow",r.receiveShadow)),u&&(a.setValue(Ft,"toneMappingExposure",Z.toneMappingExposure),a.setValue(Ft,"toneMappingWhitePoint",Z.toneMappingWhitePoint),s.needsLights&&(u=h,l.ambientLightColor.needsUpdate=u,l.lightProbe.needsUpdate=u,l.directionalLights.needsUpdate=u,l.directionalLightShadows.needsUpdate=u,l.pointLights.needsUpdate=u,l.pointLightShadows.needsUpdate=u,l.spotLights.needsUpdate=u,l.spotLightShadows.needsUpdate=u,l.rectAreaLights.needsUpdate=u,l.hemisphereLights.needsUpdate=u),i&&n.fog&&U.refreshFogUniforms(l,i),U.refreshMaterialUniforms(l,n,o,St,Et),void 0!==l.ltc_1&&(l.ltc_1.value=Ns.LTC_1),void 0!==l.ltc_2&&(l.ltc_2.value=Ns.LTC_2),ne.upload(Ft,s.uniformsList,l,N)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ne.upload(Ft,s.uniformsList,l,N),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&a.setValue(Ft,"center",r.center),a.setValue(Ft,"modelViewMatrix",r.modelViewMatrix),a.setValue(Ft,"normalMatrix",r.normalMatrix),a.setValue(Ft,"modelMatrix",r.matrixWorld),e}t=t||{};var v=void 0!==t.canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),_=void 0!==t.context?t.context:null,x=void 0!==t.alpha&&t.alpha,b=void 0===t.depth||t.depth,w=void 0===t.stencil||t.stencil,M=void 0!==t.antialias&&t.antialias,E=void 0===t.premultipliedAlpha||t.premultipliedAlpha,S=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,T=void 0!==t.powerPreference?t.powerPreference:"default",A=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,C=null,L=null;this.domElement=v,this.debug={checkShaderErrors:!0},this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingWhitePoint=this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var I,P,R,O,D,N,k,F,z,B,U,j,G,V,H,W,q,X,Z=this,Y=!1,$=null,J=0,nt=0,rt=null,pt=null,mt=-1,gt=e=null,yt=!1,vt=null,_t=null,xt=new o,bt=new o,wt=null,Mt=v.width,Et=v.height,St=1,Tt=null,At=null,Ct=new o(0,0,Mt,Et),Lt=new o(0,0,Mt,Et),It=!1,Pt=new Q,Rt=new st,Ot=!1,Dt=!1,Nt=new u,kt=new c;try{x={alpha:x,depth:b,stencil:w,antialias:M,premultipliedAlpha:E,preserveDrawingBuffer:S,powerPreference:T,failIfMajorPerformanceCaveat:A},v.addEventListener("webglcontextlost",i,!1),v.addEventListener("webglcontextrestored",a,!1);var Ft=_||v.getContext("webgl",x)||v.getContext("experimental-webgl",x);if(null===Ft){if(null!==v.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===Ft.getShaderPrecisionFormat&&(Ft.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Vt){throw console.error("THREE.WebGLRenderer: "+Vt.message),Vt}r();var zt=new Ve(Z,Ft);this.xr=zt;var Bt=new ke(Z,z,P.maxTextureSize);this.shadowMap=Bt,this.getContext=function(){return Ft},this.getContextAttributes=function(){return Ft.getContextAttributes()},this.forceContextLoss=function(){var t=I.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=I.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return St},this.setPixelRatio=function(t){void 0!==t&&(St=t,this.setSize(Mt,Et,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new n),t.set(Mt,Et)},this.setSize=function(t,e,n){zt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Mt=t,Et=e,v.width=Math.floor(t*St),v.height=Math.floor(e*St),!1!==n&&(v.style.width=t+"px",v.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new n),t.set(Mt*St,Et*St).floor()},this.setDrawingBufferSize=function(t,e,n){Mt=t,Et=e,St=n,v.width=Math.floor(t*n),v.height=Math.floor(e*n),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new o),t.copy(xt)},this.getViewport=function(t){return t.copy(Ct)},this.setViewport=function(t,e,n,r){t.isVector4?Ct.set(t.x,t.y,t.z,t.w):Ct.set(t,e,n,r),R.viewport(xt.copy(Ct).multiplyScalar(St).floor())},this.getScissor=function(t){return t.copy(Lt)},this.setScissor=function(t,e,n,r){t.isVector4?Lt.set(t.x,t.y,t.z,t.w):Lt.set(t,e,n,r),R.scissor(bt.copy(Lt).multiplyScalar(St).floor())},this.getScissorTest=function(){return It},this.setScissorTest=function(t){R.setScissorTest(It=t)},this.setOpaqueSort=function(t){Tt=t},this.setTransparentSort=function(t){At=t},this.getClearColor=function(){return V.getClearColor()},this.setClearColor=function(){V.setClearColor.apply(V,arguments)},this.getClearAlpha=function(){return V.getClearAlpha()},this.setClearAlpha=function(){V.setClearAlpha.apply(V,arguments)},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),Ft.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){v.removeEventListener("webglcontextlost",i,!1),v.removeEventListener("webglcontextrestored",a,!1),j.dispose(),G.dispose(),D.dispose(),z.dispose(),zt.dispose(),Gt.stop()},this.renderBufferImmediate=function(t,e){R.initAttributes();var n=D.get(t);t.hasPositions&&!n.position&&(n.position=Ft.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=Ft.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=Ft.createBuffer()),t.hasColors&&!n.color&&(n.color=Ft.createBuffer()),e=e.getAttributes(),t.hasPositions&&(Ft.bindBuffer(34962,n.position),Ft.bufferData(34962,t.positionArray,35048),R.enableAttribute(e.position),Ft.vertexAttribPointer(e.position,3,5126,!1,0,0)),t.hasNormals&&(Ft.bindBuffer(34962,n.normal),Ft.bufferData(34962,t.normalArray,35048),R.enableAttribute(e.normal),Ft.vertexAttribPointer(e.normal,3,5126,!1,0,0)),t.hasUvs&&(Ft.bindBuffer(34962,n.uv),Ft.bufferData(34962,t.uvArray,35048),R.enableAttribute(e.uv),Ft.vertexAttribPointer(e.uv,2,5126,!1,0,0)),t.hasColors&&(Ft.bindBuffer(34962,n.color),Ft.bufferData(34962,t.colorArray,35048),R.enableAttribute(e.color),Ft.vertexAttribPointer(e.color,3,5126,!1,0,0)),R.disableUnusedAttributes(),Ft.drawArrays(4,0,t.count),t.count=0};var Ut=new f;this.renderBufferDirect=function(t,n,r,i,o,a){null===n&&(n=Ut);var s=o.isMesh&&0>o.matrixWorld.determinant(),l=y(t,n,i,o);R.setMaterial(i,s);var c=!1;if(e===r.id&&gt===l.id&&yt===(!0===i.wireframe)||(e=r.id,gt=l.id,yt=!0===i.wireframe,c=!0),(i.morphTargets||i.morphNormals)&&(H.update(o,r,i,l),c=!0),!0===o.isInstancedMesh&&(c=!0),t=r.index,n=r.attributes.position,null===t){if(void 0===n||0===n.count)return}else if(0===t.count)return;var u=1;if(!0===i.wireframe&&(t=F.getWireframeAttribute(r),u=2),s=W,null!==t){var h=k.get(t);s=q,s.setIndex(h)}if(c){if(!1!==P.isWebGL2||!o.isInstancedMesh&&!r.isInstancedBufferGeometry||null!==I.get("ANGLE_instanced_arrays")){R.initAttributes(),c=r.attributes,l=l.getAttributes();var p=i.defaultAttributeValues;for(M in l){var d=l[M];if(0<=d){var f=c[M];if(void 0!==f){var m=f.normalized,g=f.itemSize,v=k.get(f);if(void 0!==v){var _=v.buffer,x=v.type;if(v=v.bytesPerElement,f.isInterleavedBufferAttribute){var b=f.data,w=b.stride;f=f.offset,b&&b.isInstancedInterleavedBuffer?(R.enableAttributeAndDivisor(d,b.meshPerAttribute),void 0===r._maxInstanceCount&&(r._maxInstanceCount=b.meshPerAttribute*b.count)):R.enableAttribute(d),Ft.bindBuffer(34962,_),R.vertexAttribPointer(d,g,x,m,w*v,f*v)}else f.isInstancedBufferAttribute?(R.enableAttributeAndDivisor(d,f.meshPerAttribute),void 0===r._maxInstanceCount&&(r._maxInstanceCount=f.meshPerAttribute*f.count)):R.enableAttribute(d),Ft.bindBuffer(34962,_),R.vertexAttribPointer(d,g,x,m,0,0)}}else if("instanceMatrix"===M)v=k.get(o.instanceMatrix),void 0!==v&&(_=v.buffer,x=v.type,R.enableAttributeAndDivisor(d+0,1),R.enableAttributeAndDivisor(d+1,1),R.enableAttributeAndDivisor(d+2,1),R.enableAttributeAndDivisor(d+3,1),Ft.bindBuffer(34962,_),Ft.vertexAttribPointer(d+0,4,x,!1,64,0),Ft.vertexAttribPointer(d+1,4,x,!1,64,16),Ft.vertexAttribPointer(d+2,4,x,!1,64,32),Ft.vertexAttribPointer(d+3,4,x,!1,64,48));else if(void 0!==p&&(m=p[M],void 0!==m))switch(m.length){case 2:Ft.vertexAttrib2fv(d,m);break;case 3:Ft.vertexAttrib3fv(d,m);break;case 4:Ft.vertexAttrib4fv(d,m);break;default:Ft.vertexAttrib1fv(d,m)}}}R.disableUnusedAttributes()}null!==t&&Ft.bindBuffer(34963,h.buffer)}var M=r.drawRange.start*u;c=null!==a?a.start*u:0,h=Math.max(M,c),a=Math.max(0,Math.min(null!==t?t.count:n.count,M+r.drawRange.count*u,c+(null!==a?a.count*u:1/0))-1-h+1),0!==a&&(o.isMesh?!0===i.wireframe?(R.setLineWidth(i.wireframeLinewidth*(null===rt?St:1)),s.setMode(1)):s.setMode(4):o.isLine?(i=i.linewidth,void 0===i&&(i=1),R.setLineWidth(i*(null===rt?St:1)),o.isLineSegments?s.setMode(1):o.isLineLoop?s.setMode(2):s.setMode(3)):o.isPoints?s.setMode(0):o.isSprite&&s.setMode(4),o.isInstancedMesh?s.renderInstances(r,h,a,o.count):r.isInstancedBufferGeometry?s.renderInstances(r,h,a,Math.min(r.instanceCount,r._maxInstanceCount)):s.render(h,a))},this.compile=function(t,e){L=G.get(t,e),L.init(),t.traverse((function(t){t.isLight&&(L.pushLight(t),t.castShadow&&L.pushShadow(t))})),L.setupLights(e);var n={};t.traverse((function(e){var r=e.material;if(r)if(Array.isArray(r))for(var i=0;i<r.length;i++){var o=r[i];!1===o.uuid in n&&(g(o,t,e),n[o.uuid]=!0)}else!1===r.uuid in n&&(g(r,t,e),n[r.uuid]=!0)}))};var jt=null,Gt=new tt;Gt.setAnimationLoop((function(t){zt.isPresenting||jt&&jt(t)})),"undefined"!==typeof window&&Gt.setContext(window),this.setAnimationLoop=function(t){jt=t,zt.setAnimationLoop(t),Gt.start()},this.render=function(t,n,r,i){if(void 0!==r){console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.");var o=r}if(void 0!==i){console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead.");var a=i}n&&n.isCamera?Y||(gt=e=null,yt=!1,mt=-1,vt=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),zt.enabled&&zt.isPresenting&&(n=zt.getCamera(n)),t.onBeforeRender(Z,t,n,o||rt),L=G.get(t,n),L.init(),Nt.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Pt.setFromProjectionMatrix(Nt),Dt=this.localClippingEnabled,Ot=Rt.init(this.clippingPlanes,Dt,n),C=j.get(t,n),C.init(),p(t,n,0,Z.sortObjects),C.finish(),!0===Z.sortObjects&&C.sort(Tt,At),Ot&&Rt.beginShadows(),Bt.render(L.state.shadowsArray,t,n),L.setupLights(n),Ot&&Rt.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==o&&this.setRenderTarget(o),V.render(C,t,n,a),r=C.opaque,i=C.transparent,t.overrideMaterial?(o=t.overrideMaterial,r.length&&d(r,t,n,o),i.length&&d(i,t,n,o)):(r.length&&d(r,t,n),i.length&&d(i,t,n)),t.onAfterRender(Z,t,n),null!==rt&&(N.updateRenderTargetMipmap(rt),N.updateMultisampleRenderTarget(rt)),R.buffers.depth.setTest(!0),R.buffers.depth.setMask(!0),R.buffers.color.setMask(!0),R.setPolygonOffset(!1),L=C=null):console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){$!==t&&null===rt&&Ft.bindFramebuffer(36160,t),$=t},this.getActiveCubeFace=function(){return J},this.getActiveMipmapLevel=function(){return nt},this.getRenderTarget=function(){return rt},this.setRenderTarget=function(t,e,n){rt=t,J=e,nt=n,t&&void 0===D.get(t).__webglFramebuffer&&N.setupRenderTarget(t);var r=$,i=!1;t?(r=D.get(t).__webglFramebuffer,t.isWebGLCubeRenderTarget?(r=r[e||0],i=!0):r=t.isWebGLMultisampleRenderTarget?D.get(t).__webglMultisampledFramebuffer:r,xt.copy(t.viewport),bt.copy(t.scissor),wt=t.scissorTest):(xt.copy(Ct).multiplyScalar(St).floor(),bt.copy(Lt).multiplyScalar(St).floor(),wt=It),pt!==r&&(Ft.bindFramebuffer(36160,r),pt=r),R.viewport(xt),R.scissor(bt),R.setScissorTest(wt),i&&(t=D.get(t.texture),Ft.framebufferTexture2D(36160,36064,34069+(e||0),t.__webglTexture,n||0))},this.readRenderTargetPixels=function(t,e,n,r,i,o,a){if(t&&t.isWebGLRenderTarget){var s=D.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){a=!1,s!==pt&&(Ft.bindFramebuffer(36160,s),a=!0);try{var l=t.texture,c=l.format,u=l.type;1023!==c&&X.convert(c)!==Ft.getParameter(35739)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===u||X.convert(u)===Ft.getParameter(35738)||1015===u&&(P.isWebGL2||I.get("OES_texture_float")||I.get("WEBGL_color_buffer_float"))||1016===u&&(P.isWebGL2?I.get("EXT_color_buffer_float"):I.get("EXT_color_buffer_half_float"))?36053===Ft.checkFramebufferStatus(36160)?0<=e&&e<=t.width-r&&0<=n&&n<=t.height-i&&Ft.readPixels(e,n,r,i,X.convert(c),X.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{a&&Ft.bindFramebuffer(36160,pt)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(e.image.width*r);r=Math.floor(e.image.height*r);var o=X.convert(e.format);N.setTexture2D(e,0),Ft.copyTexImage2D(3553,n,o,t.x,t.y,i,r,0),R.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r){void 0===r&&(r=0);var i=e.image.width,o=e.image.height,a=X.convert(n.format),s=X.convert(n.type);N.setTexture2D(n,0),e.isDataTexture?Ft.texSubImage2D(3553,r,t.x,t.y,i,o,a,s,e.image.data):e.isCompressedTexture?Ft.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):Ft.texSubImage2D(3553,r,t.x,t.y,a,s,e.image),0===r&&n.generateMipmaps&&Ft.generateMipmap(3553),R.unbindTexture()},this.initTexture=function(t){N.setTexture2D(t,0),R.unbindTexture()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function qe(t,e){this.name="",this.color=new b(t),this.density=void 0!==e?e:25e-5}function Xe(t,e,n){this.name="",this.color=new b(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function Ze(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function Ye(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function $e(t){T.call(this),this.type="SpriteMaterial",this.color=new b(16777215),this.alphaMap=this.map=null,this.rotation=0,this.transparent=this.sizeAttenuation=!0,this.setValues(t)}function Je(t){if(d.call(this),this.type="Sprite",void 0===tl){tl=new U;var e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);e=new Ze(e,5),tl.setIndex([0,1,2,0,2,3]),tl.setAttribute("position",new Ye(e,3,0,!1)),tl.setAttribute("uv",new Ye(e,2,3,!1))}this.geometry=tl,this.material=void 0!==t?t:new $e,this.center=new n(.5,.5)}function Ke(t,e,n,r,i,o){il.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(ol.x=o*il.x-i*il.y,ol.y=i*il.x+o*il.y):ol.copy(il),t.copy(e),t.x+=ol.x,t.y+=ol.y,t.applyMatrix4(al)}function Qe(){d.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function tn(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),j.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new u,this.bindMatrixInverse=new u}function en(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new u)}function nn(){d.call(this),this.type="Bone"}function rn(t,e,n){j.call(this,t,e),this.instanceMatrix=new C(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function on(t){T.call(this),this.type="LineBasicMaterial",this.color=new b(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.morphTargets=!1,this.setValues(t)}function an(t,e,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),d.call(this),this.type="Line",this.geometry=void 0!==t?t:new U,this.material=void 0!==e?e:new on,this.updateMorphTargets()}function sn(t,e){an.call(this,t,e),this.type="LineSegments"}function ln(t,e){an.call(this,t,e),this.type="LineLoop"}function cn(t){T.call(this),this.type="PointsMaterial",this.color=new b(16777215),this.alphaMap=this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}function un(t,e){d.call(this),this.type="Points",this.geometry=void 0!==t?t:new U,this.material=void 0!==e?e:new cn,this.updateMorphTargets()}function hn(t,e,n,r,i,o,a){var s=Ll.distanceSqToPoint(t);s<n&&(n=new c,Ll.closestPointToPoint(t,n),n.applyMatrix4(r),t=i.ray.origin.distanceTo(n),t<i.near||t>i.far||o.push({distance:t,distanceToRay:Math.sqrt(s),point:n,index:e,face:null,object:a}))}function pn(t,e,n,r,o,a,s,l,c){i.call(this,t,e,n,r,o,a,s,l,c),this.format=void 0!==s?s:1022,this.minFilter=void 0!==a?a:1006,this.magFilter=void 0!==o?o:1006,this.generateMipmaps=!1}function dn(t,e,n,r,o,a,s,l,c,u,h,p){i.call(this,null,a,s,l,c,u,r,o,h,p),this.image={width:e,height:n},this.mipmaps=t,this.generateMipmaps=this.flipY=!1}function fn(t,e,n,r,o,a,s,l,c){i.call(this,t,e,n,r,o,a,s,l,c),this.needsUpdate=!0}function mn(t,e,n,r,o,a,s,l,c,u){if(u=void 0!==u?u:1026,1026!==u&&1027!==u)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===u&&(n=1012),void 0===n&&1027===u&&(n=1020),i.call(this,null,r,o,a,s,l,u,n,c),this.image={width:t,height:e},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==l?l:1003,this.generateMipmaps=this.flipY=!1}function gn(t){U.call(this),this.type="WireframeGeometry";var e,n,r,i=[],o=[0,0],a={},s=["a","b","c"];if(t&&t.isGeometry){var l=t.faces,u=0;for(n=l.length;u<n;u++){var h=l[u];for(e=0;3>e;e++){var p=h[s[e]],d=h[s[(e+1)%3]];o[0]=Math.min(p,d),o[1]=Math.max(p,d),p=o[0]+","+o[1],void 0===a[p]&&(a[p]={index1:o[0],index2:o[1]})}}for(p in a)u=a[p],s=t.vertices[u.index1],i.push(s.x,s.y,s.z),s=t.vertices[u.index2],i.push(s.x,s.y,s.z)}else if(t&&t.isBufferGeometry)if(s=new c,null!==t.index){l=t.attributes.position,h=t.index;var f=t.groups;for(0===f.length&&(f=[{start:0,count:h.count,materialIndex:0}]),t=0,r=f.length;t<r;++t)for(u=f[t],e=u.start,n=u.count,u=e,n=e+n;u<n;u+=3)for(e=0;3>e;e++)p=h.getX(u+e),d=h.getX(u+(e+1)%3),o[0]=Math.min(p,d),o[1]=Math.max(p,d),p=o[0]+","+o[1],void 0===a[p]&&(a[p]={index1:o[0],index2:o[1]});for(p in a)u=a[p],s.fromBufferAttribute(l,u.index1),i.push(s.x,s.y,s.z),s.fromBufferAttribute(l,u.index2),i.push(s.x,s.y,s.z)}else for(l=t.attributes.position,u=0,n=l.count/3;u<n;u++)for(e=0;3>e;e++)a=3*u+e,s.fromBufferAttribute(l,a),i.push(s.x,s.y,s.z),a=3*u+(e+1)%3,s.fromBufferAttribute(l,a),i.push(s.x,s.y,s.z);this.setAttribute("position",new k(i,3))}function yn(t,e,n){H.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new vn(t,e,n)),this.mergeVertices()}function vn(t,e,n){U.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};var r,i,o=[],a=[],s=[],l=[],u=new c,h=new c,p=new c,d=new c,f=new c;3>t.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=e+1;for(r=0;r<=n;r++){var g=r/n;for(i=0;i<=e;i++){var y=i/e;t(y,g,h),a.push(h.x,h.y,h.z),0<=y-1e-5?(t(y-1e-5,g,p),d.subVectors(h,p)):(t(y+1e-5,g,p),d.subVectors(p,h)),0<=g-1e-5?(t(y,g-1e-5,p),f.subVectors(h,p)):(t(y,g+1e-5,p),f.subVectors(p,h)),u.crossVectors(d,f).normalize(),s.push(u.x,u.y,u.z),l.push(y,g)}}for(r=0;r<n;r++)for(i=0;i<e;i++)t=r*m+i+1,u=(r+1)*m+i+1,h=(r+1)*m+i,o.push(r*m+i,t,h),o.push(t,u,h);this.setIndex(o),this.setAttribute("position",new k(a,3)),this.setAttribute("normal",new k(s,3)),this.setAttribute("uv",new k(l,2))}function _n(t,e,n,r){H.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new xn(t,e,n,r)),this.mergeVertices()}function xn(t,e,r,i){function o(t){l.push(t.x,t.y,t.z)}function a(e,n){e*=3,n.x=t[e+0],n.y=t[e+1],n.z=t[e+2]}function s(t,e,n,r){0>r&&1===t.x&&(u[e]=t.x-1),0===n.x&&0===n.z&&(u[e]=r/2/Math.PI+.5)}U.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:i},r=r||1,i=i||0;var l=[],u=[];(function(t){for(var n=new c,r=new c,i=new c,s=0;s<e.length;s+=3){a(e[s+0],n),a(e[s+1],r),a(e[s+2],i);var l,u,h=n,p=r,d=i,f=Math.pow(2,t),m=[];for(u=0;u<=f;u++){m[u]=[];var g=h.clone().lerp(d,u/f),y=p.clone().lerp(d,u/f),v=f-u;for(l=0;l<=v;l++)m[u][l]=0===l&&u===f?g:g.clone().lerp(y,l/v)}for(u=0;u<f;u++)for(l=0;l<2*(f-u)-1;l++)h=Math.floor(l/2),0===l%2?(o(m[u][h+1]),o(m[u+1][h]),o(m[u][h])):(o(m[u][h+1]),o(m[u+1][h+1]),o(m[u+1][h]))}})(i),function(t){for(var e=new c,n=0;n<l.length;n+=3)e.x=l[n+0],e.y=l[n+1],e.z=l[n+2],e.normalize().multiplyScalar(t),l[n+0]=e.x,l[n+1]=e.y,l[n+2]=e.z}(r),function(){for(var t=new c,e=0;e<l.length;e+=3)t.x=l[e+0],t.y=l[e+1],t.z=l[e+2],u.push(Math.atan2(t.z,-t.x)/2/Math.PI+.5,1-(Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5));t=new c,e=new c;for(var r=new c,i=new c,o=new n,a=new n,h=new n,p=0,d=0;p<l.length;p+=9,d+=6){t.set(l[p+0],l[p+1],l[p+2]),e.set(l[p+3],l[p+4],l[p+5]),r.set(l[p+6],l[p+7],l[p+8]),o.set(u[d+0],u[d+1]),a.set(u[d+2],u[d+3]),h.set(u[d+4],u[d+5]),i.copy(t).add(e).add(r).divideScalar(3);var f=Math.atan2(i.z,-i.x);s(o,d+0,t,f),s(a,d+2,e,f),s(h,d+4,r,f)}for(t=0;t<u.length;t+=6)e=u[t+0],r=u[t+2],i=u[t+4],o=Math.min(e,r,i),.9<Math.max(e,r,i)&&.1>o&&(.2>e&&(u[t+0]+=1),.2>r&&(u[t+2]+=1),.2>i&&(u[t+4]+=1))}(),this.setAttribute("position",new k(l,3)),this.setAttribute("normal",new k(l.slice(),3)),this.setAttribute("uv",new k(u,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function bn(t,e){H.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new wn(t,e)),this.mergeVertices()}function wn(t,e){xn.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Mn(t,e){H.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new En(t,e)),this.mergeVertices()}function En(t,e){xn.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Sn(t,e){H.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Tn(t,e)),this.mergeVertices()}function Tn(t,e){var n=(1+Math.sqrt(5))/2;xn.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function An(t,e){H.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Cn(t,e)),this.mergeVertices()}function Cn(t,e){var n=(1+Math.sqrt(5))/2,r=1/n;xn.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ln(t,e,n,r,i,o){H.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed."),t=new In(t,e,n,r,i),this.tangents=t.tangents,this.normals=t.normals,this.binormals=t.binormals,this.fromBufferGeometry(t),this.mergeVertices()}function In(t,e,r,i,o){function a(n){f=t.getPointAt(n/e,f);var o=s.normals[n];for(n=s.binormals[n],u=0;u<=i;u++){var a=u/i*Math.PI*2,l=Math.sin(a);a=-Math.cos(a),p.x=a*o.x+l*n.x,p.y=a*o.y+l*n.y,p.z=a*o.z+l*n.z,p.normalize(),g.push(p.x,p.y,p.z),h.x=f.x+r*p.x,h.y=f.y+r*p.y,h.z=f.z+r*p.z,m.push(h.x,h.y,h.z)}}U.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:i,closed:o},e=e||64,r=r||1,i=i||8,o=o||!1;var s=t.computeFrenetFrames(e,o);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;var l,u,h=new c,p=new c,d=new n,f=new c,m=[],g=[],y=[],v=[];for(l=0;l<e;l++)a(l);for(a(!1===o?e:0),l=0;l<=e;l++)for(u=0;u<=i;u++)d.x=l/e,d.y=u/i,y.push(d.x,d.y);(function(){for(u=1;u<=e;u++)for(l=1;l<=i;l++){var t=(i+1)*u+(l-1),n=(i+1)*u+l,r=(i+1)*(u-1)+l;v.push((i+1)*(u-1)+(l-1),t,r),v.push(t,n,r)}})(),this.setIndex(v),this.setAttribute("position",new k(m,3)),this.setAttribute("normal",new k(g,3)),this.setAttribute("uv",new k(y,2))}function Pn(t,e,n,r,i,o,a){H.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Rn(t,e,n,r,i,o)),this.mergeVertices()}function Rn(t,e,n,r,i,o){function a(t,e,n,r,i){var o=Math.sin(t);e=n/e*t,n=Math.cos(e),i.x=r*(2+n)*.5*Math.cos(t),i.y=r*(2+n)*o*.5,i.z=r*Math.sin(e)*.5}U.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},t=t||1,e=e||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,o=o||3;var s,l=[],u=[],h=[],p=[],d=new c,f=new c,m=new c,g=new c,y=new c,v=new c,_=new c;for(s=0;s<=n;++s){var x=s/n*i*Math.PI*2;for(a(x,i,o,t,m),a(x+.01,i,o,t,g),v.subVectors(g,m),_.addVectors(g,m),y.crossVectors(v,_),_.crossVectors(y,v),y.normalize(),_.normalize(),x=0;x<=r;++x){var b=x/r*Math.PI*2,w=-e*Math.cos(b);b=e*Math.sin(b),d.x=m.x+(w*_.x+b*y.x),d.y=m.y+(w*_.y+b*y.y),d.z=m.z+(w*_.z+b*y.z),u.push(d.x,d.y,d.z),f.subVectors(d,m).normalize(),h.push(f.x,f.y,f.z),p.push(s/n),p.push(x/r)}}for(x=1;x<=n;x++)for(s=1;s<=r;s++)t=(r+1)*x+(s-1),e=(r+1)*x+s,i=(r+1)*(x-1)+s,l.push((r+1)*(x-1)+(s-1),t,i),l.push(t,e,i);this.setIndex(l),this.setAttribute("position",new k(u,3)),this.setAttribute("normal",new k(h,3)),this.setAttribute("uv",new k(p,2))}function On(t,e,n,r,i){H.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new Dn(t,e,n,r,i)),this.mergeVertices()}function Dn(t,e,n,r,i){U.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},t=t||1,e=e||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var o,a,s=[],l=[],u=[],h=[],p=new c,d=new c,f=new c;for(o=0;o<=n;o++)for(a=0;a<=r;a++){var m=a/r*i,g=o/n*Math.PI*2;d.x=(t+e*Math.cos(g))*Math.cos(m),d.y=(t+e*Math.cos(g))*Math.sin(m),d.z=e*Math.sin(g),l.push(d.x,d.y,d.z),p.x=t*Math.cos(m),p.y=t*Math.sin(m),f.subVectors(d,p).normalize(),u.push(f.x,f.y,f.z),h.push(a/r),h.push(o/n)}for(o=1;o<=n;o++)for(a=1;a<=r;a++)t=(r+1)*(o-1)+a-1,e=(r+1)*(o-1)+a,i=(r+1)*o+a,s.push((r+1)*o+a-1,t,i),s.push(t,e,i);this.setIndex(s),this.setAttribute("position",new k(l,3)),this.setAttribute("normal",new k(u,3)),this.setAttribute("uv",new k(h,2))}function Nn(t,e,n,r,i){for(var o,a=0,s=e,l=n-r;s<n;s+=r)a+=(t[l]-t[s])*(t[s+1]+t[l+1]),l=s;if(i===0<a)for(i=e;i<n;i+=r)o=Jn(i,t[i],t[i+1],o);else for(i=n-r;i>=e;i-=r)o=Jn(i,t[i],t[i+1],o);return o&&Wn(o,o.next)&&(Kn(o),o=o.next),o}function kn(t,e){if(!t)return t;e||(e=t);do{var n=!1;if(t.steiner||!Wn(t,t.next)&&0!==Hn(t.prev,t,t.next))t=t.next;else{if(Kn(t),t=e=t.prev,t===t.next)break;n=!0}}while(n||t!==e);return e}function Fn(t,e,n,r,i,o,a){if(t){if(!a&&o){var s=t,l=s;do{null===l.z&&(l.z=jn(l.x,l.y,r,i,o)),l.prevZ=l.prev,l=l.nextZ=l.next}while(l!==s);l.prevZ.nextZ=null,l.prevZ=null,s=l;var c,u,h,p,d=1;do{l=s;var f=s=null;for(u=0;l;){u++;var m=l;for(c=h=0;c<d&&(h++,m=m.nextZ,m);c++);for(p=d;0<h||0<p&&m;)0!==h&&(0===p||!m||l.z<=m.z)?(c=l,l=l.nextZ,h--):(c=m,m=m.nextZ,p--),f?f.nextZ=c:s=c,c.prevZ=f,f=c;l=m}f.nextZ=null,d*=2}while(1<u)}for(s=t;t.prev!==t.next;){if(l=t.prev,m=t.next,o)f=zn(t,r,i,o);else t:if(f=t,u=f.prev,h=f,d=f.next,0<=Hn(u,h,d))f=!1;else{for(c=f.next.next;c!==f.prev;){if(Vn(u.x,u.y,h.x,h.y,d.x,d.y,c.x,c.y)&&0<=Hn(c.prev,c,c.next)){f=!1;break t}c=c.next}f=!0}if(f)e.push(l.i/n),e.push(t.i/n),e.push(m.i/n),Kn(t),s=t=m.next;else if(t=m,t===s){if(a){if(1===a){t=kn(t),a=e,s=n,l=t;do{m=l.prev,f=l.next.next,!Wn(m,f)&&qn(m,l,l.next,f)&&Yn(m,f)&&Yn(f,m)&&(a.push(m.i/s),a.push(l.i/s),a.push(f.i/s),Kn(l),Kn(l.next),l=t=f),l=l.next}while(l!==t);t=kn(l),Fn(t,e,n,r,i,o,2)}else if(2===a)t:{a=t;do{for(s=a.next.next;s!==a.prev;){if(l=a.i!==s.i){if(l=a,m=s,f=l.next.i!==m.i&&l.prev.i!==m.i){e:{f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==m.i&&f.next.i!==m.i&&qn(f,f.next,l,m)){f=!0;break e}f=f.next}while(f!==l);f=!1}f=!f}if(f){if(f=Yn(l,m)&&Yn(m,l)){f=l,u=!1,h=(l.x+m.x)/2,d=(l.y+m.y)/2;do{f.y>d!==f.next.y>d&&f.next.y!==f.y&&h<(f.next.x-f.x)*(d-f.y)/(f.next.y-f.y)+f.x&&(u=!u),f=f.next}while(f!==l);f=u}f=f&&(Hn(l.prev,l,m.prev)||Hn(l,m.prev,m))||Wn(l,m)&&0<Hn(l.prev,l,l.next)&&0<Hn(m.prev,m,m.next)}l=f}if(l){t=$n(a,s),a=kn(a,a.next),t=kn(t,t.next),Fn(a,e,n,r,i,o),Fn(t,e,n,r,i,o);break t}s=s.next}a=a.next}while(a!==t)}}else Fn(kn(t),e,n,r,i,o,1);break}}}}function zn(t,e,n,r){var i=t.prev,o=t.next;if(0<=Hn(i,t,o))return!1;var a=i.x>t.x?i.x>o.x?i.x:o.x:t.x>o.x?t.x:o.x,s=i.y>t.y?i.y>o.y?i.y:o.y:t.y>o.y?t.y:o.y,l=jn(i.x<t.x?i.x<o.x?i.x:o.x:t.x<o.x?t.x:o.x,i.y<t.y?i.y<o.y?i.y:o.y:t.y<o.y?t.y:o.y,e,n,r);for(e=jn(a,s,e,n,r),n=t.prevZ,r=t.nextZ;n&&n.z>=l&&r&&r.z<=e;){if(n!==t.prev&&n!==t.next&&Vn(i.x,i.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=Hn(n.prev,n,n.next))return!1;if(n=n.prevZ,r!==t.prev&&r!==t.next&&Vn(i.x,i.y,t.x,t.y,o.x,o.y,r.x,r.y)&&0<=Hn(r.prev,r,r.next))return!1;r=r.nextZ}for(;n&&n.z>=l;){if(n!==t.prev&&n!==t.next&&Vn(i.x,i.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=Hn(n.prev,n,n.next))return!1;n=n.prevZ}for(;r&&r.z<=e;){if(r!==t.prev&&r!==t.next&&Vn(i.x,i.y,t.x,t.y,o.x,o.y,r.x,r.y)&&0<=Hn(r.prev,r,r.next))return!1;r=r.nextZ}return!0}function Bn(t,e){return t.x-e.x}function Un(t,e){var n=e,r=t.x,i=t.y,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(i===n.y)return n;if(i===n.next.y)return n.next}var s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(r===o)return s;e=s,a=s.x;var l=s.y,c=1/0;n=s;do{if(r>=n.x&&n.x>=a&&r!==n.x&&Vn(i<l?r:o,i,a,l,i<l?o:r,i,n.x,n.y)){var u,h=Math.abs(i-n.y)/(r-n.x);if((u=Yn(n,t))&&!(u=h<c)&&(u=h===c)&&!(u=n.x>s.x)&&(u=n.x===s.x)){u=s;var p=n;u=0>Hn(u.prev,u,p.prev)&&0>Hn(p.next,u,u.next)}u&&(s=n,c=h)}n=n.next}while(n!==e);return s}function jn(t,e,n,r,i){return t=32767*(t-n)*i,e=32767*(e-r)*i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),1431655765&(t|t<<1)|(1431655765&(e|e<<1))<<1}function Gn(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Vn(t,e,n,r,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(r-s)-(n-a)*(e-s)&&0<=(n-a)*(o-s)-(i-a)*(r-s)}function Hn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Wn(t,e){return t.x===e.x&&t.y===e.y}function qn(t,e,n,r){var i=Zn(Hn(t,e,n)),o=Zn(Hn(t,e,r)),a=Zn(Hn(n,r,t)),s=Zn(Hn(n,r,e));return!!(i!==o&&a!==s||0===i&&Xn(t,n,e)||0===o&&Xn(t,r,e)||0===a&&Xn(n,t,r)||0===s&&Xn(n,e,r))}function Xn(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Zn(t){return 0<t?1:0>t?-1:0}function Yn(t,e){return 0>Hn(t.prev,t,t.next)?0<=Hn(t,e,t.next)&&0<=Hn(t,t.prev,e):0>Hn(t,e,t.prev)||0>Hn(t,t.next,e)}function $n(t,e){var n=new Qn(t.i,t.x,t.y),r=new Qn(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Jn(t,e,n,r){return t=new Qn(t,e,n),r?(t.next=r.next,t.prev=r,r.next.prev=t,r.next=t):(t.prev=t,t.next=t),t}function Kn(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Qn(t,e,n){this.i=t,this.x=e,this.y=n,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function tr(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function er(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function nr(t,e){H.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new rr(t,e)),this.mergeVertices()}function rr(t,e){function r(t){function r(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}function s(t,e,r){var i=t.x-e.x,o=t.y-e.y,a=r.x-t.x,s=r.y-t.y,l=i*i+o*o;if(Math.abs(i*s-o*a)>Number.EPSILON){var c=Math.sqrt(l),u=Math.sqrt(a*a+s*s);if(l=e.x-o/c,e=e.y+i/c,s=((r.x-s/u-l)*s-(r.y+a/u-e)*a)/(i*s-o*a),a=l+i*s-t.x,i=e+o*s-t.y,o=a*a+i*i,2>=o)return new n(a,i);o=Math.sqrt(o/2)}else t=!1,i>Number.EPSILON?a>Number.EPSILON&&(t=!0):i<-Number.EPSILON?a<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(s)&&(t=!0),t?(a=-o,o=Math.sqrt(l)):(a=i,i=o,o=Math.sqrt(l/2));return new n(a/o,i/o)}function l(t,e){for(j=t.length;0<=--j;){var n=j,r=j-1;0>r&&(r=t.length-1);var a,s=g+2*w;for(a=0;a<s;a++){var l=B*a,c=B*(a+1),u=e+r+l,h=e+r+c;c=e+n+c,p(e+n+l),p(u),p(c),p(u),p(h),p(c),l=o.length/3,l=E.generateSideWallUV(i,o,l-6,l-3,l-2,l-1),d(l[0]),d(l[1]),d(l[3]),d(l[1]),d(l[2]),d(l[3])}}}function u(t,e,n){f.push(t),f.push(e),f.push(n)}function h(t,e,n){p(t),p(e),p(n),t=o.length/3,t=E.generateTopUV(i,o,t-3,t-2,t-1),d(t[0]),d(t[1]),d(t[2])}function p(t){o.push(f[3*t]),o.push(f[3*t+1]),o.push(f[3*t+2])}function d(t){a.push(t.x),a.push(t.y)}var f=[],m=void 0!==e.curveSegments?e.curveSegments:12,g=void 0!==e.steps?e.steps:1,y=void 0!==e.depth?e.depth:100,v=void 0===e.bevelEnabled||e.bevelEnabled,_=void 0!==e.bevelThickness?e.bevelThickness:6,x=void 0!==e.bevelSize?e.bevelSize:_-2,b=void 0!==e.bevelOffset?e.bevelOffset:0,w=void 0!==e.bevelSegments?e.bevelSegments:3,M=e.extrudePath,E=void 0!==e.UVGenerator?e.UVGenerator:Dl;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),y=e.amount);var S,T=!1;if(M){var A=M.getSpacedPoints(g);T=!0,v=!1;var C=M.computeFrenetFrames(g,!1),L=new c,I=new c,P=new c}v||(b=x=_=w=0),m=t.extractPoints(m),t=m.shape;var R=m.holes;if(!Ol.isClockWise(t)){t=t.reverse();var O=0;for(S=R.length;O<S;O++){var D=R[O];Ol.isClockWise(D)&&(R[O]=D.reverse())}}var N=Ol.triangulateShape(t,R),k=t;for(O=0,S=R.length;O<S;O++)D=R[O],t=t.concat(D);var F,z,B=t.length,U=N.length;m=[];var j=0,G=k.length,V=G-1;for(F=j+1;j<G;j++,V++,F++)V===G&&(V=0),F===G&&(F=0),m[j]=s(k[j],k[V],k[F]);M=[];var H=m.concat();for(O=0,S=R.length;O<S;O++){D=R[O];var W=[];for(j=0,G=D.length,V=G-1,F=j+1;j<G;j++,V++,F++)V===G&&(V=0),F===G&&(F=0),W[j]=s(D[j],D[V],D[F]);M.push(W),H=H.concat(W)}for(V=0;V<w;V++){G=V/w;var q=_*Math.cos(G*Math.PI/2);for(F=x*Math.sin(G*Math.PI/2)+b,j=0,G=k.length;j<G;j++){var X=r(k[j],m[j],F);u(X.x,X.y,-q)}for(O=0,S=R.length;O<S;O++)for(D=R[O],W=M[O],j=0,G=D.length;j<G;j++)X=r(D[j],W[j],F),u(X.x,X.y,-q)}for(F=x+b,j=0;j<B;j++)X=v?r(t[j],H[j],F):t[j],T?(I.copy(C.normals[0]).multiplyScalar(X.x),L.copy(C.binormals[0]).multiplyScalar(X.y),P.copy(A[0]).add(I).add(L),u(P.x,P.y,P.z)):u(X.x,X.y,0);for(G=1;G<=g;G++)for(j=0;j<B;j++)X=v?r(t[j],H[j],F):t[j],T?(I.copy(C.normals[G]).multiplyScalar(X.x),L.copy(C.binormals[G]).multiplyScalar(X.y),P.copy(A[G]).add(I).add(L),u(P.x,P.y,P.z)):u(X.x,X.y,y/g*G);for(V=w-1;0<=V;V--){for(G=V/w,q=_*Math.cos(G*Math.PI/2),F=x*Math.sin(G*Math.PI/2)+b,j=0,G=k.length;j<G;j++)X=r(k[j],m[j],F),u(X.x,X.y,y+q);for(O=0,S=R.length;O<S;O++)for(D=R[O],W=M[O],j=0,G=D.length;j<G;j++)X=r(D[j],W[j],F),T?u(X.x,X.y+A[g-1].y,A[g-1].x+q):u(X.x,X.y,y+q)}(function(){var t=o.length/3;if(v){var e=0*B;for(j=0;j<U;j++)z=N[j],h(z[2]+e,z[1]+e,z[0]+e);for(e=B*(g+2*w),j=0;j<U;j++)z=N[j],h(z[0]+e,z[1]+e,z[2]+e)}else{for(j=0;j<U;j++)z=N[j],h(z[2],z[1],z[0]);for(j=0;j<U;j++)z=N[j],h(z[0]+B*g,z[1]+B*g,z[2]+B*g)}i.addGroup(t,o.length/3-t,0)})(),function(){var t=o.length/3,e=0;for(l(k,e),e+=k.length,O=0,S=R.length;O<S;O++)D=R[O],l(D,e),e+=D.length;i.addGroup(t,o.length/3-t,1)}()}U.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var i=this,o=[],a=[],s=0,l=t.length;s<l;s++)r(t[s]);this.setAttribute("position",new k(o,3)),this.setAttribute("uv",new k(a,2)),this.computeVertexNormals()}function ir(t,e,n){if(n.shapes=[],Array.isArray(t))for(var r=0,i=t.length;r<i;r++)n.shapes.push(t[r].uuid);else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}function or(t,e){H.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new ar(t,e)),this.mergeVertices()}function ar(t,e){e=e||{};var n=e.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new H;t=n.generateShapes(t,e.size),e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),rr.call(this,t,e),this.type="TextBufferGeometry"}function sr(t,e,n,r,i,o,a){H.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new lr(t,e,n,r,i,o,a)),this.mergeVertices()}function lr(t,e,n,r,i,o,a){U.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,u=Math.min(o+a,Math.PI),h=0,p=[],d=new c,f=new c,m=[],g=[],y=[],v=[];for(l=0;l<=n;l++){var _=[],x=l/n,b=0;for(0==l&&0==o?b=.5/e:l==n&&u==Math.PI&&(b=-.5/e),s=0;s<=e;s++){var w=s/e;d.x=-t*Math.cos(r+w*i)*Math.sin(o+x*a),d.y=t*Math.cos(o+x*a),d.z=t*Math.sin(r+w*i)*Math.sin(o+x*a),g.push(d.x,d.y,d.z),f.copy(d).normalize(),y.push(f.x,f.y,f.z),v.push(w+b,1-x),_.push(h++)}p.push(_)}for(l=0;l<n;l++)for(s=0;s<e;s++)t=p[l][s+1],r=p[l][s],i=p[l+1][s],a=p[l+1][s+1],(0!==l||0<o)&&m.push(t,r,a),(l!==n-1||u<Math.PI)&&m.push(r,i,a);this.setIndex(m),this.setAttribute("position",new k(g,3)),this.setAttribute("normal",new k(y,3)),this.setAttribute("uv",new k(v,2))}function cr(t,e,n,r,i,o){H.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new ur(t,e,n,r,i,o)),this.mergeVertices()}function ur(t,e,r,i,o,a){U.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:a},t=t||.5,e=e||1,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(1,i):1;var s,l,u=[],h=[],p=[],d=[],f=t,m=(e-t)/i,g=new c,y=new n;for(s=0;s<=i;s++){for(l=0;l<=r;l++)t=o+l/r*a,g.x=f*Math.cos(t),g.y=f*Math.sin(t),h.push(g.x,g.y,g.z),p.push(0,0,1),y.x=(g.x/e+1)/2,y.y=(g.y/e+1)/2,d.push(y.x,y.y);f+=m}for(s=0;s<i;s++)for(e=s*(r+1),l=0;l<r;l++)t=l+e,o=t+r+1,a=t+r+2,f=t+1,u.push(t,o,f),u.push(o,a,f);this.setIndex(u),this.setAttribute("position",new k(h,3)),this.setAttribute("normal",new k(p,3)),this.setAttribute("uv",new k(d,2))}function hr(t,e,n,r){H.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new pr(t,e,n,r)),this.mergeVertices()}function pr(t,e,r,i){U.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},e=Math.floor(e)||12,r=r||0,i=i||2*Math.PI,i=Vo.clamp(i,0,2*Math.PI);var o,a=[],s=[],l=[],u=1/e,h=new c,p=new n;for(o=0;o<=e;o++){var d=r+o*u*i,f=Math.sin(d),m=Math.cos(d);for(d=0;d<=t.length-1;d++)h.x=t[d].x*f,h.y=t[d].y,h.z=t[d].x*m,s.push(h.x,h.y,h.z),p.x=o/e,p.y=d/(t.length-1),l.push(p.x,p.y)}for(o=0;o<e;o++)for(d=0;d<t.length-1;d++)r=d+o*t.length,u=r+t.length,h=r+t.length+1,p=r+1,a.push(r,u,p),a.push(u,h,p);if(this.setIndex(a),this.setAttribute("position",new k(s,3)),this.setAttribute("uv",new k(l,2)),this.computeVertexNormals(),i===2*Math.PI)for(i=this.attributes.normal.array,a=new c,s=new c,l=new c,r=e*t.length*3,d=o=0;o<t.length;o++,d+=3)a.x=i[d+0],a.y=i[d+1],a.z=i[d+2],s.x=i[r+d+0],s.y=i[r+d+1],s.z=i[r+d+2],l.addVectors(a,s).normalize(),i[d+0]=i[r+d+0]=l.x,i[d+1]=i[r+d+1]=l.y,i[d+2]=i[r+d+2]=l.z}function dr(t,e){H.call(this),this.type="ShapeGeometry","object"===typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new fr(t,e)),this.mergeVertices()}function fr(t,e){function n(t){var n,s=i.length/3;t=t.extractPoints(e);var c=t.shape,u=t.holes;for(!1===Ol.isClockWise(c)&&(c=c.reverse()),t=0,n=u.length;t<n;t++){var h=u[t];!0===Ol.isClockWise(h)&&(u[t]=h.reverse())}var p=Ol.triangulateShape(c,u);for(t=0,n=u.length;t<n;t++)h=u[t],c=c.concat(h);for(t=0,n=c.length;t<n;t++)h=c[t],i.push(h.x,h.y,0),o.push(0,0,1),a.push(h.x,h.y);for(t=0,n=p.length;t<n;t++)c=p[t],r.push(c[0]+s,c[1]+s,c[2]+s),l+=3}U.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],i=[],o=[],a=[],s=0,l=0;if(!1===Array.isArray(t))n(t);else for(var c=0;c<t.length;c++)n(t[c]),this.addGroup(s,l,c),s+=l,l=0;this.setIndex(r),this.setAttribute("position",new k(i,3)),this.setAttribute("normal",new k(o,3)),this.setAttribute("uv",new k(a,2))}function mr(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++)e.shapes.push(t[n].uuid);else e.shapes.push(t.uuid);return e}function gr(t,e){U.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e};var n=[];e=Math.cos(Vo.DEG2RAD*(void 0!==e?e:1));var r=[0,0],i={},o=["a","b","c"];if(t.isBufferGeometry){var a=new H;a.fromBufferGeometry(t)}else a=t.clone();a.mergeVertices(),a.computeFaceNormals(),t=a.vertices,a=a.faces;for(var s=0,l=a.length;s<l;s++)for(var c=a[s],u=0;3>u;u++){var h=c[o[u]],p=c[o[(u+1)%3]];r[0]=Math.min(h,p),r[1]=Math.max(h,p),h=r[0]+","+r[1],void 0===i[h]?i[h]={index1:r[0],index2:r[1],face1:s,face2:void 0}:i[h].face2=s}for(h in i)r=i[h],(void 0===r.face2||a[r.face1].normal.dot(a[r.face2].normal)<=e)&&(o=t[r.index1],n.push(o.x,o.y,o.z),o=t[r.index2],n.push(o.x,o.y,o.z));this.setAttribute("position",new k(n,3))}function yr(t,e,n,r,i,o,a,s){H.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new vr(t,e,n,r,i,o,a,s)),this.mergeVertices()}function vr(t,e,r,i,o,a,s,l){function u(r){var o,a=new n,u=new c,y=0,x=!0===r?t:e,b=!0===r?1:-1,w=g;for(o=1;o<=i;o++)d.push(0,v*b,0),f.push(0,b,0),m.push(.5,.5),g++;var M=g;for(o=0;o<=i;o++){var E=o/i*l+s,S=Math.cos(E);E=Math.sin(E),u.x=x*E,u.y=v*b,u.z=x*S,d.push(u.x,u.y,u.z),f.push(0,b,0),a.x=.5*S+.5,a.y=.5*E*b+.5,m.push(a.x,a.y),g++}for(o=0;o<i;o++)a=w+o,u=M+o,!0===r?p.push(u,u+1,a):p.push(u+1,u,a),y+=3;h.addGroup(_,y,!0===r?1:2),_+=y}U.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:l};var h=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,i=Math.floor(i)||8,o=Math.floor(o)||1,a=void 0!==a&&a,s=void 0!==s?s:0,l=void 0!==l?l:2*Math.PI;var p=[],d=[],f=[],m=[],g=0,y=[],v=r/2,_=0;(function(){var n,a,u=new c,x=new c,b=0,w=(e-t)/r;for(a=0;a<=o;a++){var M=[],E=a/o,S=E*(e-t)+t;for(n=0;n<=i;n++){var T=n/i,A=T*l+s,C=Math.sin(A);A=Math.cos(A),x.x=S*C,x.y=-E*r+v,x.z=S*A,d.push(x.x,x.y,x.z),u.set(C,w,A).normalize(),f.push(u.x,u.y,u.z),m.push(T,1-E),M.push(g++)}y.push(M)}for(n=0;n<i;n++)for(a=0;a<o;a++)u=y[a+1][n],x=y[a+1][n+1],w=y[a][n+1],p.push(y[a][n],u,w),p.push(u,x,w),b+=6;h.addGroup(_,b,0),_+=b})(),!1===a&&(0<t&&u(!0),0<e&&u(!1)),this.setIndex(p),this.setAttribute("position",new k(d,3)),this.setAttribute("normal",new k(f,3)),this.setAttribute("uv",new k(m,2))}function _r(t,e,n,r,i,o,a){yr.call(this,0,t,e,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function xr(t,e,n,r,i,o,a){vr.call(this,0,t,e,n,r,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function br(t,e,n,r){H.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new wr(t,e,n,r)),this.mergeVertices()}function wr(t,e,r,i){U.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var o,a=[],s=[],l=[],u=[],h=new c,p=new n;s.push(0,0,0),l.push(0,0,1),u.push(.5,.5);var d=0;for(o=3;d<=e;d++,o+=3){var f=r+d/e*i;h.x=t*Math.cos(f),h.y=t*Math.sin(f),s.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(s[o]/t+1)/2,p.y=(s[o+1]/t+1)/2,u.push(p.x,p.y)}for(o=1;o<=e;o++)a.push(o,o+1,0);this.setIndex(a),this.setAttribute("position",new k(s,3)),this.setAttribute("normal",new k(l,3)),this.setAttribute("uv",new k(u,2))}function Mr(t){T.call(this),this.type="ShadowMaterial",this.color=new b(0),this.transparent=!0,this.setValues(t)}function Er(t){X.call(this,t),this.type="RawShaderMaterial"}function Sr(t){T.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new b(16777215),this.roughness=1,this.metalness=0,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexTangents=this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Tr(t){Sr.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new n(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function Ar(t){T.call(this),this.type="MeshPhongMaterial",this.color=new b(16777215),this.specular=new b(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Cr(t){T.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new b(16777215),this.specular=new b(1118481),this.shininess=30,this.lightMap=this.gradientMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=this.specularMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Lr(t){T.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.fog=!1,this.setValues(t)}function Ir(t){T.call(this),this.type="MeshLambertMaterial",this.color=new b(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Pr(t){T.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new b(16777215),this.bumpMap=this.map=this.matcap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Rr(t){on.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function Or(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function Dr(t,e,n,r){Or.call(this,t,e,n,r),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Nr(t,e,n,r){Or.call(this,t,e,n,r)}function kr(t,e,n,r){Or.call(this,t,e,n,r)}function Fr(t,e,n,r){if(void 0===t)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Fl.convertArray(e,this.TimeBufferType),this.values=Fl.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function zr(t,e,n){Fr.call(this,t,e,n)}function Br(t,e,n,r){Fr.call(this,t,e,n,r)}function Ur(t,e,n,r){Fr.call(this,t,e,n,r)}function jr(t,e,n,r){Or.call(this,t,e,n,r)}function Gr(t,e,n,r){Fr.call(this,t,e,n,r)}function Vr(t,e,n,r){Fr.call(this,t,e,n,r)}function Hr(t,e,n,r){Fr.call(this,t,e,n,r)}function Wr(t,e,n,r){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==r?r:2500,this.uuid=Vo.generateUUID(),0>this.duration&&this.resetDuration()}function qr(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ur;case"vector":case"vector2":case"vector3":case"vector4":return Hr;case"color":return Br;case"quaternion":return Gr;case"bool":case"boolean":return zr;case"string":return Vr}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function Xr(t){if(void 0===t.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=qr(t.type);if(void 0===t.times){var n=[],r=[];Fl.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}function Zr(t,e,n){var r=this,i=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(i=!1,void 0!==r.onLoad)&&r.onLoad()},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){return t=l.indexOf(t),-1!==t&&l.splice(t,2),this},this.getHandler=function(t){for(var e=0,n=l.length;e<n;e+=2){var r=l[e],i=l[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return i}return null}}function Yr(t){this.manager=void 0!==t?t:Bl,this.crossOrigin="anonymous",this.resourcePath=this.path="",this.requestHeader={}}function $r(t){Yr.call(this,t)}function Jr(t){Yr.call(this,t)}function Kr(t){Yr.call(this,t)}function Qr(t){Yr.call(this,t)}function ti(t){Yr.call(this,t)}function ei(t){Yr.call(this,t)}function ni(t){Yr.call(this,t)}function ri(){this.type="Curve",this.arcLengthDivisions=200}function ii(t,e,n,r,i,o,a,s){ri.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function oi(t,e,n,r,i,o){ii.call(this,t,e,n,n,r,i,o),this.type="ArcCurve"}function ai(){var t=0,e=0,n=0,r=0;return{initCatmullRom:function(i,o,a,s,l){i=l*(a-i),s=l*(s-o),t=o,e=i,n=-3*o+3*a-2*i-s,r=2*o-2*a+i+s},initNonuniformCatmullRom:function(i,o,a,s,l,c,u){i=((o-i)/l-(a-i)/(l+c)+(a-o)/c)*c,s=((a-o)/c-(s-o)/(c+u)+(s-a)/u)*c,t=o,e=i,n=-3*o+3*a-2*i-s,r=2*o-2*a+i+s},calc:function(i){var o=i*i;return t+e*i+n*o+r*o*i}}}function si(t,e,n,r){ri.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=r||.5}function li(t,e,n,r,i){e=.5*(r-e),i=.5*(i-n);var o=t*t;return(2*n-2*r+e+i)*t*o+(-3*n+3*r-2*e-i)*o+e*t+n}function ci(t,e,n,r){var i=1-t;return i*i*e+2*(1-t)*t*n+t*t*r}function ui(t,e,n,r,i){var o=1-t,a=1-t;return o*o*o*e+3*a*a*t*n+3*(1-t)*t*t*r+t*t*t*i}function hi(t,e,r,i){ri.call(this),this.type="CubicBezierCurve",this.v0=t||new n,this.v1=e||new n,this.v2=r||new n,this.v3=i||new n}function pi(t,e,n,r){ri.call(this),this.type="CubicBezierCurve3",this.v0=t||new c,this.v1=e||new c,this.v2=n||new c,this.v3=r||new c}function di(t,e){ri.call(this),this.type="LineCurve",this.v1=t||new n,this.v2=e||new n}function fi(t,e){ri.call(this),this.type="LineCurve3",this.v1=t||new c,this.v2=e||new c}function mi(t,e,r){ri.call(this),this.type="QuadraticBezierCurve",this.v0=t||new n,this.v1=e||new n,this.v2=r||new n}function gi(t,e,n){ri.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new c,this.v1=e||new c,this.v2=n||new c}function yi(t){ri.call(this),this.type="SplineCurve",this.points=t||[]}function vi(){ri.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function _i(t){vi.call(this),this.type="Path",this.currentPoint=new n,t&&this.setFromPoints(t)}function xi(t){_i.call(this,t),this.uuid=Vo.generateUUID(),this.type="Shape",this.holes=[]}function bi(t,e){d.call(this),this.type="Light",this.color=new b(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function wi(t,e,n){bi.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(d.DefaultUp),this.updateMatrix(),this.groundColor=new b(e)}function Mi(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new n(512,512),this.mapPass=this.map=null,this.matrix=new u,this._frustum=new Q,this._frameExtents=new n(1,1),this._viewportCount=1,this._viewports=[new o(0,0,1,1)]}function Ei(){Mi.call(this,new Y(50,1,.5,500))}function Si(t,e,n,r,i,o){bi.call(this,t,e),this.type="SpotLight",this.position.copy(d.DefaultUp),this.updateMatrix(),this.target=new d,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Ei}function Ti(){Mi.call(this,new Y(90,1,.5,500)),this._frameExtents=new n(4,2),this._viewportCount=6,this._viewports=[new o(2,1,1,1),new o(0,1,1,1),new o(3,1,1,1),new o(1,1,1,1),new o(3,0,1,1),new o(1,0,1,1)],this._cubeDirections=[new c(1,0,0),new c(-1,0,0),new c(0,0,1),new c(0,0,-1),new c(0,1,0),new c(0,-1,0)],this._cubeUps=[new c(0,1,0),new c(0,1,0),new c(0,1,0),new c(0,1,0),new c(0,0,1),new c(0,0,-1)]}function Ai(t,e,n,r){bi.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new Ti}function Ci(t,e,n,r,i,o){Z.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Li(){Mi.call(this,new Ci(-5,5,5,-5,.5,500))}function Ii(t,e){bi.call(this,t,e),this.type="DirectionalLight",this.position.copy(d.DefaultUp),this.updateMatrix(),this.target=new d,this.shadow=new Li}function Pi(t,e){bi.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Ri(t,e,n,r){bi.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function Oi(){this.coefficients=[];for(var t=0;9>t;t++)this.coefficients.push(new c)}function Di(t,e){bi.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new Oi}function Ni(t){Yr.call(this,t),this.textures={}}function ki(){U.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Fi(t,e,n,r){"number"===typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),C.call(this,t,e,n),this.meshPerAttribute=r||1}function zi(t){Yr.call(this,t)}function Bi(t){Yr.call(this,t)}function Ui(t){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Yr.call(this,t),this.options=void 0}function ji(){this.type="ShapePath",this.color=new b,this.subPaths=[],this.currentPath=null}function Gi(t){this.type="Font",this.data=t}function Vi(t){Yr.call(this,t)}function Hi(t){Yr.call(this,t)}function Wi(t,e,n){Di.call(this,void 0,n),t=(new b).set(t),n=(new b).set(e),e=new c(t.r,t.g,t.b),t=new c(n.r,n.g,n.b),n=Math.sqrt(Math.PI);var r=n*Math.sqrt(.75);this.sh.coefficients[0].copy(e).add(t).multiplyScalar(n),this.sh.coefficients[1].copy(e).sub(t).multiplyScalar(r)}function qi(t,e){Di.call(this,void 0,e),t=(new b).set(t),this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}function Xi(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Y,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Y,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Zi(t){this.autoStart=void 0===t||t,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function Yi(){d.call(this),this.type="AudioListener",this.context=Kl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Zi}function $i(t){d.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.offset=this.loopEnd=this.loopStart=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._progress=this._startedAt=0,this.filters=[]}function Ji(t){$i.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Ki(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function Qi(t,e,n){switch(this.binding=t,this.valueSize=n,e){case"quaternion":t=this._slerp,e=this._slerpAdditive;var r=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":e=t=this._select,r=this._setAdditiveIdentityOther,this.buffer=Array(5*n);break;default:t=this._lerp,e=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=t,this._mixBufferRegionAdditive=e,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.referenceCount=this.useCount=this.cumulativeWeightAdditive=this.cumulativeWeight=0}function to(t,e,n){n=n||eo.parseTrackName(e),this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function eo(t,e,n){this.path=e,this.parsedPath=n||eo.parseTrackName(e),this.node=eo.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function no(){this.uuid=Vo.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function ro(t,e,n,r){this._mixer=t,this._clip=e,this._localRoot=n||null,this.blendMode=r||e.blendMode,t=e.tracks,e=t.length,n=Array(e),r={endingStart:2400,endingEnd:2400};for(var i=0;i!==e;++i){var o=t[i].createInterpolant(null);n[i]=o,o.settings=r}this._interpolantSettings=r,this._interpolants=n,this._propertyBindings=Array(e),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function io(t){this._root=t,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function oo(t,e){"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=e),this.value=t}function ao(t,e,n){Ze.call(this,t,e),this.meshPerAttribute=n||1}function so(t,e,n,r){this.ray=new v(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new p,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function lo(t,e){return t.distance-e.distance}function co(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){t=t.children,r=0;for(var i=t.length;r<i;r++)co(t[r],e,n,!0)}}function uo(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}function ho(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}function po(t,e){this.min=void 0!==t?t:new n(1/0,1/0),this.max=void 0!==e?e:new n(-1/0,-1/0)}function fo(t,e){this.start=void 0!==t?t:new c,this.end=void 0!==e?e:new c}function mo(t){d.call(this),this.material=t,this.render=function(){},this.hasUvs=this.hasColors=this.hasNormals=this.hasPositions=!1,this.uvArray=this.colorArray=this.normalArray=this.positionArray=null,this.count=0}function go(t,e){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,t=new U,e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var n=0,r=1;32>n;n++,r++){var i=n/32*Math.PI*2,o=r/32*Math.PI*2;e.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}t.setAttribute("position",new k(e,3)),e=new on({fog:!1,toneMapped:!1}),this.cone=new sn(t,e),this.add(this.cone),this.update()}function yo(t){var e=[];t&&t.isBone&&e.push(t);for(var n=0;n<t.children.length;n++)e.push.apply(e,yo(t.children[n]));return e}function vo(t){for(var e=yo(t),n=new U,r=[],i=[],o=new b(0,0,1),a=new b(0,1,0),s=0;s<e.length;s++){var l=e[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new k(r,3)),n.setAttribute("color",new k(i,3)),r=new on({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0}),sn.call(this,n,r),this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function _o(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n,t=new lr(e,4,2),e=new A({wireframe:!0,fog:!1,toneMapped:!1}),j.call(this,t,e),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function xo(t,e,n){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t=new En(e),t.rotateY(.5*Math.PI),this.material=new A({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0),e=t.getAttribute("position"),e=new Float32Array(3*e.count),t.setAttribute("color",new C(e,3)),this.add(new j(t,this.material)),this.update()}function bo(t,e,n,r){t=t||10,e=e||10,n=new b(void 0!==n?n:4473924),r=new b(void 0!==r?r:8947848);var i=e/2,o=t/e,a=t/2;t=[];for(var s=[],l=0,c=0,u=-a;l<=e;l++,u+=o){t.push(-a,0,u,a,0,u),t.push(u,0,-a,u,0,a);var h=l===i?n:r;h.toArray(s,c),c+=3,h.toArray(s,c),c+=3,h.toArray(s,c),c+=3,h.toArray(s,c),c+=3}e=new U,e.setAttribute("position",new k(t,3)),e.setAttribute("color",new k(s,3)),n=new on({vertexColors:!0,toneMapped:!1}),sn.call(this,e,n),this.type="GridHelper"}function wo(t,e,n,r,i,o){t=t||10,e=e||16,n=n||8,r=r||64,i=new b(void 0!==i?i:4473924),o=new b(void 0!==o?o:8947848);var a,s=[],l=[];for(a=0;a<=e;a++){var c=a/e*2*Math.PI,u=Math.sin(c)*t;c=Math.cos(c)*t,s.push(0,0,0),s.push(u,0,c);var h=1&a?i:o;l.push(h.r,h.g,h.b),l.push(h.r,h.g,h.b)}for(a=0;a<=n;a++){h=1&a?i:o;var p=t-t/n*a;for(e=0;e<r;e++)c=e/r*2*Math.PI,u=Math.sin(c)*p,c=Math.cos(c)*p,s.push(u,0,c),l.push(h.r,h.g,h.b),c=(e+1)/r*2*Math.PI,u=Math.sin(c)*p,c=Math.cos(c)*p,s.push(u,0,c),l.push(h.r,h.g,h.b)}t=new U,t.setAttribute("position",new k(s,3)),t.setAttribute("color",new k(l,3)),s=new on({vertexColors:!0,toneMapped:!1}),sn.call(this,t,s),this.type="PolarGridHelper"}function Mo(t,e,n){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1),t=new U,t.setAttribute("position",new k([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3)),e=new on({fog:!1,toneMapped:!1}),this.lightPlane=new an(t,e),this.add(this.lightPlane),t=new U,t.setAttribute("position",new k([0,0,0,0,0,1],3)),this.targetLine=new an(t,e),this.add(this.targetLine),this.update()}function Eo(t){function e(t,e,r){n(t,r),n(e,r)}function n(t,e){o.push(0,0,0),a.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(o.length/3-1)}var r=new U,i=new on({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],a=[],s={},l=new b(16755200),c=new b(16711680),u=new b(43775),h=new b(16777215),p=new b(3355443);e("n1","n2",l),e("n2","n4",l),e("n4","n3",l),e("n3","n1",l),e("f1","f2",l),e("f2","f4",l),e("f4","f3",l),e("f3","f1",l),e("n1","f1",l),e("n2","f2",l),e("n3","f3",l),e("n4","f4",l),e("p","n1",c),e("p","n2",c),e("p","n3",c),e("p","n4",c),e("u1","u2",u),e("u2","u3",u),e("u3","u1",u),e("c","t",h),e("p","c",p),e("cn1","cn2",p),e("cn3","cn4",p),e("cf1","cf2",p),e("cf3","cf4",p),r.setAttribute("position",new k(o,3)),r.setAttribute("color",new k(a,3)),sn.call(this,r,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function So(t,e,n,r,i,o,a){if(Ic.set(i,o,a).unproject(r),t=e[t],void 0!==t)for(n=n.getAttribute("position"),e=0,r=t.length;e<r;e++)n.setXYZ(t[e],Ic.x,Ic.y,Ic.z)}function To(t,e){this.object=t,void 0===e&&(e=16776960),t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var n=new Float32Array(24),r=new U;r.setIndex(new C(t,1)),r.setAttribute("position",new C(n,3)),sn.call(this,r,new on({color:e,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function Ao(t,e){this.type="Box3Helper",this.box=t,e=e||16776960,t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var n=new U;n.setIndex(new C(t,1)),n.setAttribute("position",new k([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),sn.call(this,n,new on({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function Co(t,e,n){this.plane=t,this.size=void 0===e?1:e,t=void 0!==n?n:16776960,e=new U,e.setAttribute("position",new k([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),e.computeBoundingSphere(),an.call(this,e,new on({color:t,toneMapped:!1})),this.type="PlaneHelper",e=new U,e.setAttribute("position",new k([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),e.computeBoundingSphere(),this.add(new j(e,new A({color:t,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}function Lo(t,e,n,r,i,o){d.call(this),this.type="ArrowHelper",void 0===t&&(t=new c(0,0,1)),void 0===e&&(e=new c(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===Oc&&(Oc=new U,Oc.setAttribute("position",new k([0,0,0,0,1,0],3)),Dc=new vr(0,.5,1,5,1),Dc.translate(0,-.5,0)),this.position.copy(e),this.line=new an(Oc,new on({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new j(Dc,new A({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,o)}function Io(t){t=t||1;var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t];t=new U,t.setAttribute("position",new k(e,3)),t.setAttribute("color",new k([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),e=new on({vertexColors:!0,toneMapped:!1}),sn.call(this,t,e),this.type="AxesHelper"}function Po(t){this._renderer=t,this._pingPongRenderTarget=null,t=new Float32Array(20);var e=new c(0,1,0);t=new Er({defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:e},inputEncoding:{value:Bc[3e3]},outputEncoding:{value:Bc[3e3]}},vertexShader:ko(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n"+Fo()+"\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1}),t.type="SphericalGaussianBlur",this._blurMaterial=t,this._cubemapShader=this._equirectShader=null,this._compileMaterial(this._blurMaterial)}function Ro(t){return t=new a(3*kc,3*kc,t),t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Oo(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function Do(){var t=new n(1,1);return t=new Er({uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:Bc[3e3]},outputEncoding:{value:Bc[3e3]}},vertexShader:ko(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n"+Fo()+"\n\n#include <common>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv = equirectUv( outputDirection );\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1}),t.type="EquirectangularToCubeUV",t}function No(){var t=new Er({uniforms:{envMap:{value:null},inputEncoding:{value:Bc[3e3]},outputEncoding:{value:Bc[3e3]}},vertexShader:ko(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n"+Fo()+"\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function ko(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function Fo(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function zo(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),si.call(this,t),this.type="catmullrom",this.closed=!0}function Bo(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),si.call(this,t),this.type="catmullrom"}function Uo(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),si.call(this,t),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"===typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return 0>t?-1:0<t?1:+t}),!1==="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}),Object.assign(e.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){void 0!==this._listeners&&(t=this._listeners[t],void 0!==t&&(e=t.indexOf(e),-1!==e&&t.splice(e,1)))},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this,e=e.slice(0);for(var n=0,r=e.length;n<r;n++)e[n].call(this,t)}}}});for(var jo=[],Go=0;256>Go;Go++)jo[Go]=(16>Go?"0":"")+Go.toString(16);var Vo={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(jo[255&t]+jo[t>>8&255]+jo[t>>16&255]+jo[t>>24&255]+"-"+jo[255&e]+jo[e>>8&255]+"-"+jo[e>>16&15|64]+jo[e>>24&255]+"-"+jo[63&n|128]+jo[n>>8&255]+"-"+jo[n>>16&255]+jo[n>>24&255]+jo[255&r]+jo[r>>8&255]+jo[r>>16&255]+jo[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(6*t-15)+10))},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Vo.DEG2RAD},radToDeg:function(t){return t*Vo.RAD2DEG},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){var o=Math.cos,a=Math.sin,s=o(n/2);n=a(n/2);var l=o((e+r)/2),c=a((e+r)/2),u=o((e-r)/2),h=a((e-r)/2);switch(o=o((r-e)/2),e=a((r-e)/2),i){case"XYX":t.set(s*c,n*u,n*h,s*l);break;case"YZY":t.set(n*h,s*c,n*u,s*l);break;case"ZXZ":t.set(n*u,n*h,s*c,s*l);break;case"XZX":t.set(s*c,n*e,n*o,s*l);break;case"YXY":t.set(n*o,s*c,n*e,s*l);break;case"ZYZ":t.set(n*e,n*o,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};Object.defineProperties(n.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(n.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y;return t=t.elements,this.x=t[0]*e+t[3]*n+t[6],this.y=t[1]*e+t[4]*n+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x;return t=this.y-t.y,e*e+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e);e=Math.sin(e);var r=this.x-t.x,i=this.y-t.y;return this.x=r*n-i*e+t.x,this.y=r*e+i*n+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(r.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,o,a,s,l){var c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements;return t=t.elements,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){return t=t.elements,this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements;e=this.elements,t=n[0];var i=n[3],o=n[6],a=n[1],s=n[4],l=n[7],c=n[2],u=n[5];n=n[8];var h=r[0],p=r[3],d=r[6],f=r[1],m=r[4],g=r[7],y=r[2],v=r[5];return r=r[8],e[0]=t*h+i*f+o*y,e[3]=t*p+i*m+o*v,e[6]=t*d+i*g+o*r,e[1]=a*h+s*f+l*y,e[4]=a*p+s*m+l*v,e[7]=a*d+s*g+l*r,e[2]=c*h+u*f+n*y,e[5]=c*p+u*m+n*v,e[8]=c*d+u*g+n*r,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7];return t=t[8],e*o*t-e*a*l-n*i*t+n*a*s+r*i*l-r*o*s},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=t.elements;t=this.elements,e=n[0];var r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],l=n[6],c=n[7];n=n[8];var u=n*a-s*c,h=s*l-n*o,p=c*o-a*l,d=e*u+r*h+i*p;return 0===d?this.set(0,0,0,0,0,0,0,0,0):(d=1/d,t[0]=u*d,t[1]=(i*c-n*r)*d,t[2]=(s*r-i*a)*d,t[3]=h*d,t[4]=(n*e-i*l)*d,t[5]=(i*o-s*e)*d,t[6]=p*d,t[7]=(r*l-c*e)*d,t[8]=(a*e-r*o)*d,this)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,o,a){var s=Math.cos(i);i=Math.sin(i),this.set(n*s,n*i,-n*(s*o+i*a)+o+t,-r*i,r*s,-r*(-i*o+s*a)+a+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t);t=Math.sin(t);var n=this.elements,r=n[0],i=n[3],o=n[6],a=n[1],s=n[4],l=n[7];return n[0]=e*r+t*a,n[3]=e*i+t*s,n[6]=e*o+t*l,n[1]=-t*r+e*a,n[4]=-t*i+e*s,n[7]=-t*o+e*l,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){var e=this.elements;t=t.elements;for(var n=0;9>n;n++)if(e[n]!==t[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;9>n;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var Ho,Wo={getDataURL:function(t){if("undefined"==typeof HTMLCanvasElement)return t.src;if(!(t instanceof HTMLCanvasElement)){void 0===Ho&&(Ho=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ho.width=t.width,Ho.height=t.height;var e=Ho.getContext("2d");t instanceof ImageData?e.putImageData(t,0,0):e.drawImage(t,0,0,t.width,t.height),t=Ho}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},qo=0;i.DEFAULT_IMAGE=void 0,i.DEFAULT_MAPPING=300,i.prototype=Object.assign(Object.create(e.prototype),{constructor:i,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Vo.generateUUID()),!e&&void 0===t.images[r.uuid]){if(Array.isArray(r))for(var i=[],o=0,a=r.length;o<a;o++)i.push(Wo.getDataURL(r[o]));else i=Wo.getDataURL(r);t.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),0>t.x||1<t.x)switch(this.wrapS){case 1e3:t.x-=Math.floor(t.x);break;case 1001:t.x=0>t.x?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(0>t.y||1<t.y)switch(this.wrapT){case 1e3:t.y-=Math.floor(t.y);break;case 1001:t.y=0>t.y?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(i.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(o.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(o.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.w=this.z=this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w;return t=t.elements,this.x=t[0]*e+t[4]*n+t[8]*r+t[12]*i,this.y=t[1]*e+t[5]*n+t[9]*r+t[13]*i,this.z=t[2]*e+t[6]*n+t[10]*r+t[14]*i,this.w=t[3]*e+t[7]*n+t[11]*r+t[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return 1e-4>e?(this.x=1,this.z=this.y=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){t=t.elements;var e=t[0],n=t[4],r=t[8],i=t[1],o=t[5],a=t[9],s=t[2],l=t[6],c=t[10];return.01>Math.abs(n-i)&&.01>Math.abs(r-s)&&.01>Math.abs(a-l)?.1>Math.abs(n+i)&&.1>Math.abs(r+s)&&.1>Math.abs(a+l)&&.1>Math.abs(e+o+c-3)?(this.set(1,0,0,0),this):(t=Math.PI,e=(e+1)/2,o=(o+1)/2,c=(c+1)/2,n=(n+i)/4,r=(r+s)/4,a=(a+l)/4,e>o&&e>c?.01>e?(l=0,n=s=.707106781):(l=Math.sqrt(e),s=n/l,n=r/l):o>c?.01>o?(l=.707106781,s=0,n=.707106781):(s=Math.sqrt(o),l=n/s,n=a/s):.01>c?(s=l=.707106781,n=0):(n=Math.sqrt(c),l=r/n,s=a/n),this.set(l,s,n,t),this):(t=Math.sqrt((l-a)*(l-a)+(r-s)*(r-s)+(i-n)*(i-n)),.001>Math.abs(t)&&(t=1),this.x=(l-a)/t,this.y=(r-s)/t,this.z=(i-n)/t,this.w=Math.acos((e+o+c-1)/2),this)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),a.prototype=Object.assign(Object.create(e.prototype),{constructor:a,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),s.prototype=Object.assign(Object.create(a.prototype),{constructor:s,isWebGLMultisampleRenderTarget:!0,copy:function(t){return a.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(l,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,o,a){var s=n[r+0],l=n[r+1],c=n[r+2];n=n[r+3],r=i[o+0];var u=i[o+1],h=i[o+2];if(i=i[o+3],n!==i||s!==r||l!==u||c!==h){o=1-a;var p=s*r+l*u+c*h+n*i,d=0<=p?1:-1,f=1-p*p;f>Number.EPSILON&&(f=Math.sqrt(f),p=Math.atan2(f,p*d),o=Math.sin(o*p)/f,a=Math.sin(a*p)/f),d*=a,s=s*o+r*d,l=l*o+u*d,c=c*o+h*d,n=n*o+i*d,o===1-a&&(a=1/Math.sqrt(s*s+l*l+c*c+n*n),s*=a,l*=a,c*=a,n*=a)}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=n},multiplyQuaternionsFlat:function(t,e,n,r,i,o){var a=n[r],s=n[r+1],l=n[r+2];n=n[r+3],r=i[o];var c=i[o+1],u=i[o+2];return i=i[o+3],t[e]=a*i+n*r+s*u-l*c,t[e+1]=s*i+n*c+l*r-a*u,t[e+2]=l*i+n*u+a*c-s*r,t[e+3]=n*i-a*r-s*c-l*u,t}}),Object.defineProperties(l.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(l.prototype,{isQuaternion:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z;t=t.order;var o=Math.cos,a=Math.sin,s=o(n/2),l=o(r/2);switch(o=o(i/2),n=a(n/2),r=a(r/2),i=a(i/2),t){case"XYZ":this._x=n*l*o+s*r*i,this._y=s*r*o-n*l*i,this._z=s*l*i+n*r*o,this._w=s*l*o-n*r*i;break;case"YXZ":this._x=n*l*o+s*r*i,this._y=s*r*o-n*l*i,this._z=s*l*i-n*r*o,this._w=s*l*o+n*r*i;break;case"ZXY":this._x=n*l*o-s*r*i,this._y=s*r*o+n*l*i,this._z=s*l*i+n*r*o,this._w=s*l*o-n*r*i;break;case"ZYX":this._x=n*l*o-s*r*i,this._y=s*r*o+n*l*i,this._z=s*l*i-n*r*o,this._w=s*l*o+n*r*i;break;case"YZX":this._x=n*l*o+s*r*i,this._y=s*r*o+n*l*i,this._z=s*l*i-n*r*o,this._w=s*l*o-n*r*i;break;case"XZY":this._x=n*l*o-s*r*i,this._y=s*r*o-n*l*i,this._z=s*l*i+n*r*o,this._w=s*l*o+n*r*i;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+t)}return!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){e/=2;var n=Math.sin(e);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(e),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e=t.elements,n=e[0];t=e[4];var r=e[8],i=e[1],o=e[5],a=e[9],s=e[2],l=e[6];e=e[10];var c=n+o+e;return 0<c?(n=.5/Math.sqrt(c+1),this._w=.25/n,this._x=(l-a)*n,this._y=(r-s)*n,this._z=(i-t)*n):n>o&&n>e?(n=2*Math.sqrt(1+n-o-e),this._w=(l-a)/n,this._x=.25*n,this._y=(t+i)/n,this._z=(r+s)/n):o>e?(n=2*Math.sqrt(1+o-n-e),this._w=(r-s)/n,this._x=(t+i)/n,this._y=.25*n,this._z=(a+l)/n):(n=2*Math.sqrt(1+e-n-o),this._w=(i-t)/n,this._x=(r+s)/n,this._y=(a+l)/n,this._z=.25*n),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var n=t.dot(e)+1;return 1e-6>n?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0):(this._x=0,this._y=-t.z,this._z=t.y)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x),this._w=n,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Vo.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var n=this.angleTo(t);return 0===n||this.slerp(t,Math.min(1,e/n)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._z=this._y=this._x=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z;t=t._w;var o=e._x,a=e._y,s=e._z;return e=e._w,this._x=n*e+t*o+r*s-i*a,this._y=r*e+t*a+i*o-n*s,this._z=i*e+t*s+n*a-r*o,this._w=t*e-n*o-r*a-i*s,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(0>a?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),1<=a)return this._w=o,this._x=n,this._y=r,this._z=i,this;if(t=1-a*a,t<=Number.EPSILON)return a=1-e,this._w=a*o+e*this._w,this._x=a*n+e*this._x,this._y=a*r+e*this._y,this._z=a*i+e*this._z,this.normalize(),this._onChangeCallback(),this;t=Math.sqrt(t);var s=Math.atan2(t,a);return a=Math.sin((1-e)*s)/t,e=Math.sin(e*s)/t,this._w=o*a+this._w*e,this._x=n*a+this._x*e,this._y=r*a+this._y*e,this._z=i*a+this._z*e,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var Xo=new c,Zo=new l;Object.assign(c.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.z=this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Zo.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Zo.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[3]*n+t[6]*r,this.y=t[1]*e+t[4]*n+t[7]*r,this.z=t[2]*e+t[5]*n+t[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z;t=t.elements;var i=1/(t[3]*e+t[7]*n+t[11]*r+t[15]);return this.x=(t[0]*e+t[4]*n+t[8]*r+t[12])*i,this.y=(t[1]*e+t[5]*n+t[9]*r+t[13])*i,this.z=(t[2]*e+t[6]*n+t[10]*r+t[14])*i,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z;t=t.w;var s=t*e+o*r-a*n,l=t*n+a*e-i*r,c=t*r+i*n-o*e;return e=-i*e-o*n-a*r,this.x=s*t+e*-i+l*-a-c*-o,this.y=l*t+e*-o+c*-i-s*-a,this.z=c*t+e*-a+s*-o-l*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,n=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[4]*n+t[8]*r,this.y=t[1]*e+t[5]*n+t[9]*r,this.z=t[2]*e+t[6]*n+t[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y;t=t.z;var i=e.x,o=e.y;return e=e.z,this.x=r*e-t*o,this.y=t*i-n*e,this.z=n*o-r*i,this},projectOnVector:function(t){var e=t.lengthSq();return 0===e?this.set(0,0,0):(e=t.dot(this)/e,this.copy(t).multiplyScalar(e))},projectOnPlane:function(t){return Xo.copy(this).projectOnVector(t),this.sub(Xo)},reflect:function(t){return this.sub(Xo.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===e?Math.PI/2:(t=this.dot(t)/e,Math.acos(Vo.clamp(t,-1,1)))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return t=this.z-t.z,e*e+n*n+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){return t=t.elements,this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length();return t=this.setFromMatrixColumn(t,2).length(),this.x=e,this.y=n,this.z=t,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});var Yo=new c,$o=new u,Jo=new c(0,0,0),Ko=new c(1,1,1),Qo=new c,ta=new c,ea=new c;Object.assign(u.prototype,{isMatrix4:!0,set:function(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new u).fromArray(this.elements)},copy:function(t){var e=this.elements;return t=t.elements,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},copyPosition:function(t){var e=this.elements;return t=t.elements,e[12]=t[12],e[13]=t[13],e[14]=t[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,n=t.elements,r=1/Yo.setFromMatrixColumn(t,0).length(),i=1/Yo.setFromMatrixColumn(t,1).length();return t=1/Yo.setFromMatrixColumn(t,2).length(),e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*t,e[9]=n[9]*t,e[10]=n[10]*t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n);n=Math.sin(n);var a=Math.cos(r);r=Math.sin(r);var s=Math.cos(i);if(i=Math.sin(i),"XYZ"===t.order){t=o*s;var l=o*i,c=n*s,u=n*i;e[0]=a*s,e[4]=-a*i,e[8]=r,e[1]=l+c*r,e[5]=t-u*r,e[9]=-n*a,e[2]=u-t*r,e[6]=c+l*r,e[10]=o*a}else"YXZ"===t.order?(t=a*s,l=a*i,c=r*s,u=r*i,e[0]=t+u*n,e[4]=c*n-l,e[8]=o*r,e[1]=o*i,e[5]=o*s,e[9]=-n,e[2]=l*n-c,e[6]=u+t*n,e[10]=o*a):"ZXY"===t.order?(t=a*s,l=a*i,c=r*s,u=r*i,e[0]=t-u*n,e[4]=-o*i,e[8]=c+l*n,e[1]=l+c*n,e[5]=o*s,e[9]=u-t*n,e[2]=-o*r,e[6]=n,e[10]=o*a):"ZYX"===t.order?(t=o*s,l=o*i,c=n*s,u=n*i,e[0]=a*s,e[4]=c*r-l,e[8]=t*r+u,e[1]=a*i,e[5]=u*r+t,e[9]=l*r-c,e[2]=-r,e[6]=n*a,e[10]=o*a):"YZX"===t.order?(t=o*a,l=o*r,c=n*a,u=n*r,e[0]=a*s,e[4]=u-t*i,e[8]=c*i+l,e[1]=i,e[5]=o*s,e[9]=-n*s,e[2]=-r*s,e[6]=l*i+c,e[10]=t-u*i):"XZY"===t.order&&(t=o*a,l=o*r,c=n*a,u=n*r,e[0]=a*s,e[4]=-i,e[8]=r*s,e[1]=t*i+u,e[5]=o*s,e[9]=l*i-c,e[2]=c*i-l,e[6]=n*s,e[10]=u*i+t);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Jo,t,Ko)},lookAt:function(t,e,n){var r=this.elements;return ea.subVectors(t,e),0===ea.lengthSq()&&(ea.z=1),ea.normalize(),Qo.crossVectors(n,ea),0===Qo.lengthSq()&&(1===Math.abs(n.z)?ea.x+=1e-4:ea.z+=1e-4,ea.normalize(),Qo.crossVectors(n,ea)),Qo.normalize(),ta.crossVectors(ea,Qo),r[0]=Qo.x,r[4]=ta.x,r[8]=ea.x,r[1]=Qo.y,r[5]=ta.y,r[9]=ea.y,r[2]=Qo.z,r[6]=ta.z,r[10]=ea.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements;e=this.elements,t=n[0];var i=n[4],o=n[8],a=n[12],s=n[1],l=n[5],c=n[9],u=n[13],h=n[2],p=n[6],d=n[10],f=n[14],m=n[3],g=n[7],y=n[11];n=n[15];var v=r[0],_=r[4],x=r[8],b=r[12],w=r[1],M=r[5],E=r[9],S=r[13],T=r[2],A=r[6],C=r[10],L=r[14],I=r[3],P=r[7],R=r[11];return r=r[15],e[0]=t*v+i*w+o*T+a*I,e[4]=t*_+i*M+o*A+a*P,e[8]=t*x+i*E+o*C+a*R,e[12]=t*b+i*S+o*L+a*r,e[1]=s*v+l*w+c*T+u*I,e[5]=s*_+l*M+c*A+u*P,e[9]=s*x+l*E+c*C+u*R,e[13]=s*b+l*S+c*L+u*r,e[2]=h*v+p*w+d*T+f*I,e[6]=h*_+p*M+d*A+f*P,e[10]=h*x+p*E+d*C+f*R,e[14]=h*b+p*S+d*L+f*r,e[3]=m*v+g*w+y*T+n*I,e[7]=m*_+g*M+y*A+n*P,e[11]=m*x+g*E+y*C+n*R,e[15]=m*b+g*S+y*L+n*r,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],p=t[14];return t[3]*(+i*s*u-r*l*u-i*a*h+n*l*h+r*a*p-n*s*p)+t[7]*(+e*s*p-e*l*h+i*o*h-r*o*p+r*l*c-i*s*c)+t[11]*(+e*l*u-e*a*p-i*o*u+n*o*p+i*a*c-n*l*c)+t[15]*(-r*a*c-e*s*u+e*a*h+r*o*u-n*o*h+n*s*c)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate."),e=this.elements;var n=t.elements;t=n[0];var r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],l=n[6],c=n[7],u=n[8],h=n[9],p=n[10],d=n[11],f=n[12],m=n[13],g=n[14];n=n[15];var y=h*g*c-m*p*c+m*l*d-s*g*d-h*l*n+s*p*n,v=f*p*c-u*g*c-f*l*d+a*g*d+u*l*n-a*p*n,_=u*m*c-f*h*c+f*s*d-a*m*d-u*s*n+a*h*n,x=f*h*l-u*m*l-f*s*p+a*m*p+u*s*g-a*h*g,b=t*y+r*v+i*_+o*x;return 0===b?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(b=1/b,e[0]=y*b,e[1]=(m*p*o-h*g*o-m*i*d+r*g*d+h*i*n-r*p*n)*b,e[2]=(s*g*o-m*l*o+m*i*c-r*g*c-s*i*n+r*l*n)*b,e[3]=(h*l*o-s*p*o-h*i*c+r*p*c+s*i*d-r*l*d)*b,e[4]=v*b,e[5]=(u*g*o-f*p*o+f*i*d-t*g*d-u*i*n+t*p*n)*b,e[6]=(f*l*o-a*g*o-f*i*c+t*g*c+a*i*n-t*l*n)*b,e[7]=(a*p*o-u*l*o+u*i*c-t*p*c-a*i*d+t*l*d)*b,e[8]=_*b,e[9]=(f*h*o-u*m*o-f*r*d+t*m*d+u*r*n-t*h*n)*b,e[10]=(a*m*o-f*s*o+f*r*c-t*m*c-a*r*n+t*s*n)*b,e[11]=(u*s*o-a*h*o-u*r*c+t*h*c+a*r*d-t*s*d)*b,e[12]=x*b,e[13]=(u*m*i-f*h*i+f*r*p-t*m*p-u*r*g+t*h*g)*b,e[14]=(f*s*i-a*m*i-f*r*l+t*m*l+a*r*g-t*s*g)*b,e[15]=(a*h*i-u*s*i+u*r*l-t*h*l-a*r*p+t*s*p)*b,this)},scale:function(t){var e=this.elements,n=t.x,r=t.y;return t=t.z,e[0]*=n,e[4]*=r,e[8]*=t,e[1]*=n,e[5]*=r,e[9]*=t,e[2]*=n,e[6]*=r,e[10]*=t,e[3]*=n,e[7]*=r,e[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e);e=Math.sin(e);var r=1-n,i=t.x,o=t.y;t=t.z;var a=r*i,s=r*o;return this.set(a*i+n,a*o-e*t,a*t+e*o,0,a*o+e*t,s*o+n,s*t-e*i,0,a*t-e*o,s*t+e*i,r*t*t+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){var r=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,l=i+i,c=o+o,u=a+a;e=i*l;var h=i*c;i*=u;var p=o*c;o*=u,a*=u,l*=s,c*=s,s*=u,u=n.x;var d=n.y;return n=n.z,r[0]=(1-(p+a))*u,r[1]=(h+s)*u,r[2]=(i-c)*u,r[3]=0,r[4]=(h-s)*d,r[5]=(1-(e+a))*d,r[6]=(o+l)*d,r[7]=0,r[8]=(i+c)*n,r[9]=(o-l)*n,r[10]=(1-(e+p))*n,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,n){var r=this.elements,i=Yo.set(r[0],r[1],r[2]).length(),o=Yo.set(r[4],r[5],r[6]).length(),a=Yo.set(r[8],r[9],r[10]).length();0>this.determinant()&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],$o.copy(this),t=1/i,r=1/o;var s=1/a;return $o.elements[0]*=t,$o.elements[1]*=t,$o.elements[2]*=t,$o.elements[4]*=r,$o.elements[5]*=r,$o.elements[6]*=r,$o.elements[8]*=s,$o.elements[9]*=s,$o.elements[10]*=s,e.setFromRotationMatrix($o),n.x=i,n.y=o,n.z=a,this},makePerspective:function(t,e,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements;return a[0]=2*i/(e-t),a[4]=0,a[8]=(e+t)/(e-t),a[12]=0,a[1]=0,a[5]=2*i/(n-r),a[9]=(n+r)/(n-r),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+i)/(o-i),a[14]=-2*o*i/(o-i),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,n,r,i,o){var a=this.elements,s=1/(e-t),l=1/(n-r),c=1/(o-i);return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-(e+t)*s,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-(n+r)*l,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-(o+i)*c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){var e=this.elements;t=t.elements;for(var n=0;16>n;n++)if(e[n]!==t[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;16>n;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});var na=new u,ra=new l;h.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),h.DefaultOrder="XYZ",Object.defineProperties(h.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(h.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=Vo.clamp,i=t.elements;t=i[0];var o=i[4],a=i[8],s=i[1],l=i[5],c=i[9],u=i[2],h=i[6];switch(i=i[10],e=e||this._order,e){case"XYZ":this._y=Math.asin(r(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(-c,i),this._z=Math.atan2(-o,t)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(c,-1,1)),.9999999>Math.abs(c)?(this._y=Math.atan2(a,i),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,t),this._z=0);break;case"ZXY":this._x=Math.asin(r(h,-1,1)),.9999999>Math.abs(h)?(this._y=Math.atan2(-u,i),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,t));break;case"ZYX":this._y=Math.asin(-r(u,-1,1)),.9999999>Math.abs(u)?(this._x=Math.atan2(h,i),this._z=Math.atan2(s,t)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(r(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,t)):(this._x=0,this._y=Math.atan2(a,i));break;case"XZY":this._z=Math.asin(-r(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,t)):(this._x=Math.atan2(-c,i),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return na.makeRotationFromQuaternion(t),this.setFromRotationMatrix(na,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return ra.setFromEuler(this),this.setFromQuaternion(ra,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new c(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(p.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask=this.mask|1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!==(this.mask&t.mask)}});var ia=0,oa=new c,aa=new l,sa=new u,la=new c,ca=new c,ua=new c,ha=new l,pa=new c(1,0,0),da=new c(0,1,0),fa=new c(0,0,1),ma={type:"added"},ga={type:"removed"};d.DefaultUp=new c(0,1,0),d.DefaultMatrixAutoUpdate=!0,d.prototype=Object.assign(Object.create(e.prototype),{constructor:d,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return aa.setFromAxisAngle(t,e),this.quaternion.multiply(aa),this},rotateOnWorldAxis:function(t,e){return aa.setFromAxisAngle(t,e),this.quaternion.premultiply(aa),this},rotateX:function(t){return this.rotateOnAxis(pa,t)},rotateY:function(t){return this.rotateOnAxis(da,t)},rotateZ:function(t){return this.rotateOnAxis(fa,t)},translateOnAxis:function(t,e){return oa.copy(t).applyQuaternion(this.quaternion),this.position.add(oa.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(pa,t)},translateY:function(t){return this.translateOnAxis(da,t)},translateZ:function(t){return this.translateOnAxis(fa,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(sa.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?la.copy(t):la.set(t,e,n),t=this.parent,this.updateWorldMatrix(!0,!1),ca.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?sa.lookAt(ca,la,this.up):sa.lookAt(la,ca,this.up),this.quaternion.setFromRotationMatrix(sa),t&&(sa.extractRotation(t.matrixWorld),aa.setFromRotationMatrix(sa),this.quaternion.premultiply(aa.inverse()))},add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ma)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}return e=this.children.indexOf(t),-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ga)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),sa.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),sa.multiply(t.parent.matrixWorld)),t.applyMatrix4(sa),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new c),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new l),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ca,t,ua),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new c),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ca,ha,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new c),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(t=this.children,e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)},toJSON:function(t){function e(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}function n(t){var e,n=[];for(e in t){var r=t[e];delete r.metadata,n.push(r)}return n}var r=void 0===t||"string"===typeof t,i={};r&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){o.geometry=e(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes)if(a=a.shapes,Array.isArray(a))for(var s=0,l=a.length;s<l;s++)e(t.shapes,a[s]);else e(t.shapes,a)}if(void 0!==this.material)if(Array.isArray(this.material)){for(a=[],s=0,l=this.material.length;s<l;s++)a.push(e(t.materials,this.material[s]));o.material=a}else o.material=e(t.materials,this.material);if(0<this.children.length)for(o.children=[],s=0;s<this.children.length;s++)o.children.push(this.children[s].toJSON(t).object);if(r){r=n(t.geometries),s=n(t.materials),l=n(t.textures);var c=n(t.images);a=n(t.shapes),0<r.length&&(i.geometries=r),0<s.length&&(i.materials=s),0<l.length&&(i.textures=l),0<c.length&&(i.images=c),0<a.length&&(i.shapes=a)}return i.object=o,i},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(e=0;e<t.children.length;e++)this.add(t.children[e].clone());return this}}),f.prototype=Object.assign(Object.create(d.prototype),{constructor:f,isScene:!0,copy:function(t,e){return d.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=d.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ya=[new c,new c,new c,new c,new c,new c,new c,new c],va=new c,_a=new m,xa=new c,ba=new c,wa=new c,Ma=new c,Ea=new c,Sa=new c,Ta=new c,Aa=new c,Ca=new c,La=new c;Object.assign(m.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;s<l;s+=3){var c=t[s],u=t[s+1],h=t[s+2];c<e&&(e=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.count;s<l;s++){var c=t.getX(s),u=t.getY(s),h=t.getZ(s);c<e&&(e=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){return e=va.copy(e).multiplyScalar(.5),this.min.copy(t).sub(e),this.max.copy(t).add(e),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new c),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new c),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),_a.copy(e.boundingBox),_a.applyMatrix4(t.matrixWorld),this.union(_a)),t=t.children,e=0;for(var n=t.length;e<n;e++)this.expandByObject(t[e]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new c),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,va),va.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){if(0<t.normal.x)var e=t.normal.x*this.min.x,n=t.normal.x*this.max.x;else e=t.normal.x*this.max.x,n=t.normal.x*this.min.x;return 0<t.normal.y?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){return!this.isEmpty()&&(this.getCenter(Ta),Aa.subVectors(this.max,Ta),xa.subVectors(t.a,Ta),ba.subVectors(t.b,Ta),wa.subVectors(t.c,Ta),Ma.subVectors(ba,xa),Ea.subVectors(wa,ba),Sa.subVectors(xa,wa),t=[0,-Ma.z,Ma.y,0,-Ea.z,Ea.y,0,-Sa.z,Sa.y,Ma.z,0,-Ma.x,Ea.z,0,-Ea.x,Sa.z,0,-Sa.x,-Ma.y,Ma.x,0,-Ea.y,Ea.x,0,-Sa.y,Sa.x,0],!!g(t,xa,ba,wa,Aa)&&(t=[1,0,0,0,1,0,0,0,1],!!g(t,xa,ba,wa,Aa)&&(Ca.crossVectors(Ma,Ea),t=[Ca.x,Ca.y,Ca.z],g(t,xa,ba,wa,Aa))))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new c),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return va.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(va).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(ya[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ya[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ya[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ya[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ya[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ya[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ya[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ya[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ya)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Ia=new m;Object.assign(y.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var n=this.center;void 0!==e?n.copy(e):Ia.setFromPoints(t).getCenter(n);for(var r=e=0,i=t.length;r<i;r++)e=Math.max(e,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return 0>this.radius},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new c),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new m),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius*=t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var Pa=new c,Ra=new c,Oa=new c,Da=new c,Na=new c,ka=new c,Fa=new c;Object.assign(v.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new c),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,Pa)),this},closestPointToPoint:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new c),e.subVectors(t,this.origin),t=e.dot(this.direction),0>t?e.copy(this.origin):e.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=Pa.subVectors(t,this.origin).dot(this.direction);return 0>e?this.origin.distanceToSquared(t):(Pa.copy(this.direction).multiplyScalar(e).add(this.origin),Pa.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,r){Ra.copy(t).add(e).multiplyScalar(.5),Oa.copy(e).sub(t).normalize(),Da.copy(this.origin).sub(Ra);var i=.5*t.distanceTo(e),o=-this.direction.dot(Oa),a=Da.dot(this.direction),s=-Da.dot(Oa),l=Da.lengthSq(),c=Math.abs(1-o*o);if(0<c){t=o*s-a,e=o*a-s;var u=i*c;0<=t?e>=-u?e<=u?(i=1/c,t*=i,e*=i,o=t*(t+o*e+2*a)+e*(o*t+e+2*s)+l):(e=i,t=Math.max(0,-(o*e+a)),o=-t*t+e*(e+2*s)+l):(e=-i,t=Math.max(0,-(o*e+a)),o=-t*t+e*(e+2*s)+l):e<=-u?(t=Math.max(0,-(-o*i+a)),e=0<t?-i:Math.min(Math.max(-i,-s),i),o=-t*t+e*(e+2*s)+l):e<=u?(t=0,e=Math.min(Math.max(-i,-s),i),o=e*(e+2*s)+l):(t=Math.max(0,-(o*i+a)),e=0<t?i:Math.min(Math.max(-i,-s),i),o=-t*t+e*(e+2*s)+l)}else e=0<o?-i:i,t=Math.max(0,-(o*e+a)),o=-t*t+e*(e+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(t).add(this.origin),r&&r.copy(Oa).multiplyScalar(e).add(Ra),o},intersectSphere:function(t,e){Pa.subVectors(t.center,this.origin);var n=Pa.dot(this.direction),r=Pa.dot(Pa)-n*n;return t=t.radius*t.radius,r>t?null:(t=Math.sqrt(t-r),r=n-t,n+=t,0>r&&0>n?null:0>r?this.at(n,e):this.at(r,e))},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);return 0===e?0===t.distanceToPoint(this.origin)?0:null:(t=-(this.origin.dot(t.normal)+t.constant)/e,0<=t?t:null)},intersectPlane:function(t,e){return t=this.distanceToPlane(t),null===t?null:this.at(t,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||0>t.normal.dot(this.direction)*e},intersectBox:function(t,e){var n=1/this.direction.x,r=1/this.direction.y,i=1/this.direction.z,o=this.origin;if(0<=n){var a=(t.min.x-o.x)*n;n*=t.max.x-o.x}else a=(t.max.x-o.x)*n,n*=t.min.x-o.x;if(0<=r){var s=(t.min.y-o.y)*r;r*=t.max.y-o.y}else s=(t.max.y-o.y)*r,r*=t.min.y-o.y;return a>r||s>n?null:((s>a||a!==a)&&(a=s),(r<n||n!==n)&&(n=r),0<=i?(s=(t.min.z-o.z)*i,t=(t.max.z-o.z)*i):(s=(t.max.z-o.z)*i,t=(t.min.z-o.z)*i),a>t||s>n?null:((s>a||a!==a)&&(a=s),(t<n||n!==n)&&(n=t),0>n?null:this.at(0<=a?a:n,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,Pa)},intersectTriangle:function(t,e,n,r,i){if(Na.subVectors(e,t),ka.subVectors(n,t),Fa.crossVectors(Na,ka),e=this.direction.dot(Fa),0<e){if(r)return null;r=1}else{if(!(0>e))return null;r=-1,e=-e}return Da.subVectors(this.origin,t),t=r*this.direction.dot(ka.crossVectors(Da,ka)),0>t?null:(n=r*this.direction.dot(Na.cross(Da)),0>n||t+n>e?null:(t=-r*Da.dot(Fa),0>t?null:this.at(t/e,i)))},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var za=new c,Ba=new c,Ua=new r;Object.assign(_.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){return e=za.subVectors(n,e).cross(Ba.subVectors(t,e)).normalize(),this.setFromNormalAndCoplanarPoint(e,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new c),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new c);var n=t.delta(za),r=this.normal.dot(n);if(0===r){if(0===this.distanceToPoint(t.start))return e.copy(t.start)}else if(r=-(t.start.dot(this.normal)+this.constant)/r,!(0>r||1<r))return e.copy(n).multiplyScalar(r).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start);return t=this.distanceToPoint(t.end),0>e&&0<t||0>t&&0<e},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new c),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){return e=e||Ua.getNormalMatrix(t),t=this.coplanarPoint(za).applyMatrix4(t),e=this.normal.applyMatrix3(e).normalize(),this.constant=-t.dot(e),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var ja=new c,Ga=new c,Va=new c,Ha=new c,Wa=new c,qa=new c,Xa=new c,Za=new c,Ya=new c,$a=new c;Object.assign(x,{getNormal:function(t,e,n,r){return void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new c),r.subVectors(n,e),ja.subVectors(t,e),r.cross(ja),t=r.lengthSq(),0<t?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)},getBarycoord:function(t,e,n,r,i){ja.subVectors(r,e),Ga.subVectors(n,e),Va.subVectors(t,e),t=ja.dot(ja),e=ja.dot(Ga),n=ja.dot(Va);var o=Ga.dot(Ga);r=Ga.dot(Va);var a=t*o-e*e;return void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new c),0===a?i.set(-2,-1,-1):(a=1/a,o=(o*n-e*r)*a,t=(t*r-e*n)*a,i.set(1-o-t,t,o))},containsPoint:function(t,e,n,r){return x.getBarycoord(t,e,n,r,Ha),0<=Ha.x&&0<=Ha.y&&1>=Ha.x+Ha.y},getUV:function(t,e,n,r,i,o,a,s){return this.getBarycoord(t,e,n,r,Ha),s.set(0,0),s.addScaledVector(i,Ha.x),s.addScaledVector(o,Ha.y),s.addScaledVector(a,Ha.z),s},isFrontFacing:function(t,e,n,r){return ja.subVectors(n,e),Ga.subVectors(t,e),0>ja.cross(Ga).dot(r)}}),Object.assign(x.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return ja.subVectors(this.c,this.b),Ga.subVectors(this.a,this.b),.5*ja.cross(Ga).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new c),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return x.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new _),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return x.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,r,i){return x.getUV(t,this.a,this.b,this.c,e,n,r,i)},containsPoint:function(t){return x.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return x.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new c);var n=this.a,r=this.b,i=this.c;Wa.subVectors(r,n),qa.subVectors(i,n),Za.subVectors(t,n);var o=Wa.dot(Za),a=qa.dot(Za);if(0>=o&&0>=a)return e.copy(n);Ya.subVectors(t,r);var s=Wa.dot(Ya),l=qa.dot(Ya);if(0<=s&&l<=s)return e.copy(r);var u=o*l-s*a;if(0>=u&&0<=o&&0>=s)return r=o/(o-s),e.copy(n).addScaledVector(Wa,r);$a.subVectors(t,i),t=Wa.dot($a);var h=qa.dot($a);return 0<=h&&t<=h?e.copy(i):(o=t*a-o*h,0>=o&&0<=a&&0>=h?(u=a/(a-h),e.copy(n).addScaledVector(qa,u)):(a=s*h-t*l,0>=a&&0<=l-s&&0<=t-h?(Xa.subVectors(i,r),u=(l-s)/(l-s+(t-h)),e.copy(r).addScaledVector(Xa,u)):(i=1/(a+o+u),r=o*i,u*=i,e.copy(n).addScaledVector(Wa,r).addScaledVector(qa,u))))},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var Ja={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ka={h:0,s:0,l:0},Qa={h:0,s:0,l:0};Object.assign(b.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t),this},setScalar:function(t){return this.b=this.g=this.r=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){return t=Vo.euclideanModulo(t,1),e=Vo.clamp(e,0,1),n=Vo.clamp(n,0,1),0===e?this.r=this.g=this.b=n:(e=.5>=n?n*(1+e):n+e-n*e,n=2*n-e,this.r=w(n,e,t+1/3),this.g=w(n,e,t),this.b=w(n,e,t-1/3)),this},setStyle:function(t){function e(e){void 0!==e&&1>parseFloat(e)&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r=n[2];switch(n[1]){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){r=parseFloat(n[1])/360;var i=parseInt(n[2],10)/100,o=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(r,i,o)}}}else if(n=/^#([A-Fa-f0-9]+)$/.exec(t)){if(n=n[1],r=n.length,3===r)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,this;if(6===r)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this},setColorName:function(t){var e=Ja[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){return void 0===e&&(e=2),e=0<e?1/e:1,this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=M(t.r),this.g=M(t.g),this.b=M(t.b),this},copyLinearToSRGB:function(t){return this.r=E(t.r),this.g=E(t.g),this.b=E(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n=this.r,r=this.g,i=this.b,o=Math.max(n,r,i),a=Math.min(n,r,i),s=(a+o)/2;if(a===o)a=e=0;else{var l=o-a;switch(a=.5>=s?l/(o+a):l/(2-o-a),o){case n:e=(r-i)/l+(r<i?6:0);break;case r:e=(i-n)/l+2;break;case i:e=(n-r)/l+4}e/=6}return t.h=e,t.s=a,t.l=s,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){return this.getHSL(Ka),Ka.h+=t,Ka.s+=e,Ka.l+=n,this.setHSL(Ka.h,Ka.s,Ka.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(Ka),t.getHSL(Qa),t=Vo.lerp(Ka.h,Qa.h,e);var n=Vo.lerp(Ka.s,Qa.s,e);return e=Vo.lerp(Ka.l,Qa.l,e),this.setHSL(t,n,e),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),b.NAMES=Ja,Object.assign(S.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var ts=0;T.prototype=Object.assign(Object.create(e.prototype),{constructor:T,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0===n)console.warn("THREE.Material: '"+e+"' parameter is undefined.");else if("shading"===e)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else{var r=this[e];void 0===r?console.warn("THREE."+this.type+": '"+e+"' is not a property of this material."):r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n}}},toJSON:function(t){function e(t){var e,n=[];for(e in t){var r=t[e];delete r.metadata,n.push(r)}return n}var n=void 0===t||"string"===typeof t;n&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),0!==this.side&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),1>this.opacity&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),n&&(n=e(t.textures),t=e(t.images),0<n.length&&(r.textures=n),0<t.length&&(r.images=t)),r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(null!==e){var r=e.length;n=Array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(T.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),A.prototype=Object.create(T.prototype),A.prototype.constructor=A,A.prototype.isMeshBasicMaterial=!0,A.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var es=new c;Object.defineProperty(C.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(C.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new b),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,i=0,o=t.length;i<o;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new n),e[r++]=a.x,e[r++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new c),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new o),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z,e[n++]=a.w}return this},applyMatrix3:function(t){for(var e=0,n=this.count;e<n;e++)es.x=this.getX(e),es.y=this.getY(e),es.z=this.getZ(e),es.applyMatrix3(t),this.setXYZ(e,es.x,es.y,es.z);return this},applyMatrix4:function(t){for(var e=0,n=this.count;e<n;e++)es.x=this.getX(e),es.y=this.getY(e),es.z=this.getZ(e),es.applyMatrix4(t),this.setXYZ(e,es.x,es.y,es.z);return this},applyNormalMatrix:function(t){for(var e=0,n=this.count;e<n;e++)es.x=this.getX(e),es.y=this.getY(e),es.z=this.getZ(e),es.applyNormalMatrix(t),this.setXYZ(e,es.x,es.y,es.z);return this},transformDirection:function(t){for(var e=0,n=this.count;e<n;e++)es.x=this.getX(e),es.y=this.getY(e),es.z=this.getZ(e),es.transformDirection(t),this.setXYZ(e,es.x,es.y,es.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),L.prototype=Object.create(C.prototype),L.prototype.constructor=L,I.prototype=Object.create(C.prototype),I.prototype.constructor=I,P.prototype=Object.create(C.prototype),P.prototype.constructor=P,R.prototype=Object.create(C.prototype),R.prototype.constructor=R,O.prototype=Object.create(C.prototype),O.prototype.constructor=O,D.prototype=Object.create(C.prototype),D.prototype.constructor=D,N.prototype=Object.create(C.prototype),N.prototype.constructor=N,k.prototype=Object.create(C.prototype),k.prototype.constructor=k,F.prototype=Object.create(C.prototype),F.prototype.constructor=F,Object.assign(z.prototype,{computeGroups:function(t){var e=[],n=void 0;t=t.faces;for(var r=0;r<t.length;r++){var i=t[r];if(i.materialIndex!==n){n=i.materialIndex,void 0!==o&&(o.count=3*r-o.start,e.push(o));var o={start:3*r,materialIndex:n}}}void 0!==o&&(o.count=3*r-o.start,e.push(o)),this.groups=e},fromGeometry:function(t){var e=t.faces,r=t.vertices,i=t.faceVertexUvs,o=i[0]&&0<i[0].length,a=i[1]&&0<i[1].length,s=t.morphTargets,l=s.length;if(0<l){for(var c=[],u=0;u<l;u++)c[u]={name:s[u].name,data:[]};this.morphTargets.position=c}var h=t.morphNormals,p=h.length;if(0<p){var d=[];for(u=0;u<p;u++)d[u]={name:h[u].name,data:[]};this.morphTargets.normal=d}var f=t.skinIndices,m=t.skinWeights,g=f.length===r.length,y=m.length===r.length;for(0<r.length&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),u=0;u<e.length;u++){var v=e[u];this.vertices.push(r[v.a],r[v.b],r[v.c]);var _=v.vertexNormals;for(3===_.length?this.normals.push(_[0],_[1],_[2]):(_=v.normal,this.normals.push(_,_,_)),_=v.vertexColors,3===_.length?this.colors.push(_[0],_[1],_[2]):(_=v.color,this.colors.push(_,_,_)),!0===o&&(_=i[0][u],void 0!==_?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new n,new n,new n))),!0===a&&(_=i[1][u],void 0!==_?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new n,new n,new n))),_=0;_<l;_++){var x=s[_].vertices;c[_].data.push(x[v.a],x[v.b],x[v.c])}for(_=0;_<p;_++)x=h[_].vertexNormals[u],d[_].data.push(x.a,x.b,x.c);g&&this.skinIndices.push(f[v.a],f[v.b],f[v.c]),y&&this.skinWeights.push(m[v.a],m[v.b],m[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var ns=1,rs=new u,is=new d,os=new c,as=new m,ss=new m,ls=new c;U.prototype=Object.assign(Object.create(e.prototype),{constructor:U,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<B(t)?N:O)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position;if(void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0),e=this.attributes.normal,void 0!==e){var n=(new r).getNormalMatrix(t);e.applyNormalMatrix(n),e.needsUpdate=!0}return e=this.attributes.tangent,void 0!==e&&(e.transformDirection(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return rs.makeRotationX(t),this.applyMatrix4(rs),this},rotateY:function(t){return rs.makeRotationY(t),this.applyMatrix4(rs),this},rotateZ:function(t){return rs.makeRotationZ(t),this.applyMatrix4(rs),this},translate:function(t,e,n){return rs.makeTranslation(t,e,n),this.applyMatrix4(rs),this},scale:function(t,e,n){return rs.makeScale(t,e,n),this.applyMatrix4(rs),this},lookAt:function(t){return is.lookAt(t),is.updateMatrix(),this.applyMatrix4(is.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(os).negate(),this.translate(os.x,os.y,os.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){t=new k(3*e.vertices.length,3);var n=new k(3*e.colors.length,3);this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length&&(t=new k(e.lineDistances.length,1),this.setAttribute("lineDistance",t.copyArray(e.lineDistances))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new k(e,3)),this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var n=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(n=void 0,e.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(e);n.verticesNeedUpdate=e.verticesNeedUpdate,n.normalsNeedUpdate=e.normalsNeedUpdate,n.colorsNeedUpdate=e.colorsNeedUpdate,n.uvsNeedUpdate=e.uvsNeedUpdate,n.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=n}return!0===e.verticesNeedUpdate&&(n=this.attributes.position,void 0!==n&&(n.copyVector3sArray(e.vertices),n.needsUpdate=!0),e.verticesNeedUpdate=!1),!0===e.normalsNeedUpdate&&(n=this.attributes.normal,void 0!==n&&(n.copyVector3sArray(e.normals),n.needsUpdate=!0),e.normalsNeedUpdate=!1),!0===e.colorsNeedUpdate&&(n=this.attributes.color,void 0!==n&&(n.copyColorsArray(e.colors),n.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(n=this.attributes.uv,void 0!==n&&(n.copyVector2sArray(e.uvs),n.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(n=this.attributes.lineDistance,void 0!==n&&(n.copyArray(e.lineDistances),n.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new z).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);for(var n in this.setAttribute("position",new C(e,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(e=new Float32Array(3*t.normals.length),this.setAttribute("normal",new C(e,3).copyVector3sArray(t.normals))),0<t.colors.length&&(e=new Float32Array(3*t.colors.length),this.setAttribute("color",new C(e,3).copyColorsArray(t.colors))),0<t.uvs.length&&(e=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new C(e,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(e=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new C(e,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){e=[];for(var r=t.morphTargets[n],i=0,o=r.length;i<o;i++){var a=r[i],s=new k(3*a.data.length,3);s.name=a.name,e.push(s.copyVector3sArray(a.data))}this.morphAttributes[n]=e}return 0<t.skinIndices.length&&(n=new k(4*t.skinIndices.length,4),this.setAttribute("skinIndex",n.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(n=new k(4*t.skinWeights.length,4),this.setAttribute("skinWeight",n.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m);var t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e){t=0;for(var n=e.length;t<n;t++)as.setFromBufferAttribute(e[t]),this.morphTargetsRelative?(ls.addVectors(this.boundingBox.min,as.min),this.boundingBox.expandByPoint(ls),ls.addVectors(this.boundingBox.max,as.max),this.boundingBox.expandByPoint(ls)):(this.boundingBox.expandByPoint(as.min),this.boundingBox.expandByPoint(as.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new y);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(as.setFromBufferAttribute(t),e)for(var r=0,i=e.length;r<i;r++){var o=e[r];ss.setFromBufferAttribute(o),this.morphTargetsRelative?(ls.addVectors(as.min,ss.min),as.expandByPoint(ls),ls.addVectors(as.max,ss.max),as.expandByPoint(ls)):(as.expandByPoint(ss.min),as.expandByPoint(ss.max))}as.getCenter(n);var a=0;for(r=0,i=t.count;r<i;r++)ls.fromBufferAttribute(t,r),a=Math.max(a,n.distanceToSquared(ls));if(e)for(r=0,i=e.length;r<i;r++){o=e[r];for(var s=this.morphTargetsRelative,l=0,c=o.count;l<c;l++)ls.fromBufferAttribute(o,l),s&&(os.fromBufferAttribute(t,l),ls.add(os)),a=Math.max(a,n.distanceToSquared(ls))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var n=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new C(new Float32Array(n.length),3));else for(var r=e.normal.array,i=0,o=r.length;i<o;i++)r[i]=0;r=e.normal.array;var a=new c,s=new c,l=new c,u=new c,h=new c;if(t){var p=t.array;for(i=0,o=t.count;i<o;i+=3){t=3*p[i+0];var d=3*p[i+1],f=3*p[i+2];a.fromArray(n,t),s.fromArray(n,d),l.fromArray(n,f),u.subVectors(l,s),h.subVectors(a,s),u.cross(h),r[t]+=u.x,r[t+1]+=u.y,r[t+2]+=u.z,r[d]+=u.x,r[d+1]+=u.y,r[d+2]+=u.z,r[f]+=u.x,r[f+1]+=u.y,r[f+2]+=u.z}}else for(i=0,o=n.length;i<o;i+=9)a.fromArray(n,i),s.fromArray(n,i+3),l.fromArray(n,i+6),u.subVectors(l,s),h.subVectors(a,s),u.cross(h),r[i]=u.x,r[i+1]=u.y,r[i+2]=u.z,r[i+3]=u.x,r[i+4]=u.y,r[i+5]=u.z,r[i+6]=u.x,r[i+7]=u.y,r[i+8]=u.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n,r=this.attributes;for(n in r)if(void 0!==t.attributes[n]){var i=r[n].array,o=t.attributes[n],a=o.array,s=o.itemSize*e;o=Math.min(a.length,i.length-s);for(var l=0;l<o;l++,s++)i[s]=a[l]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)ls.x=t.getX(e),ls.y=t.getY(e),ls.z=t.getZ(e),ls.normalize(),t.setXYZ(e,ls.x,ls.y,ls.z)},toNonIndexed:function(){function t(t,e){var n=t.array,r=t.itemSize;t=t.normalized;for(var i,o=new n.constructor(e.length*r),a=0,s=0,l=e.length;s<l;s++){i=e[s]*r;for(var c=0;c<r;c++)o[a++]=n[i++]}return new C(o,r,t)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e,n=new U,r=this.index.array,i=this.attributes;for(e in i){var o=i[e];o=t(o,r),n.setAttribute(e,o)}var a=this.morphAttributes;for(e in a){var s=[],l=a[e];i=0;for(var c=l.length;i<c;i++)o=l[i],o=t(o,r),s.push(o);n.morphAttributes[e]=s}for(n.morphTargetsRelative=this.morphTargetsRelative,r=this.groups,i=0,e=r.length;i<e;i++)o=r[i],n.addGroup(o.start,o.count,o.materialIndex);return n},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),0<Object.keys(this.userData).length&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(c in e)void 0!==e[c]&&(t[c]=e[c]);return t}t.data={attributes:{}},e=this.index,null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});var n=this.attributes;for(c in n){e=n[c];var r=e.toJSON();""!==e.name&&(r.name=e.name),t.data.attributes[c]=r}n={};var i=!1;for(c in this.morphAttributes){for(var o=this.morphAttributes[c],a=[],s=0,l=o.length;s<l;s++)e=o[s],r=e.toJSON(),""!==e.name&&(r.name=e.name),a.push(r);0<a.length&&(n[c]=a,i=!0)}i&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);var c=this.groups;return 0<c.length&&(t.data.groups=JSON.parse(JSON.stringify(c))),c=this.boundingSphere,null!==c&&(t.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),t},clone:function(){return(new U).copy(this)},copy:function(t){var e;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var n=t.index;for(a in null!==n&&this.setIndex(n.clone()),n=t.attributes,n)this.setAttribute(a,n[a].clone());var r=t.morphAttributes;for(a in r){var i=[],o=r[a];for(n=0,e=o.length;n<e;n++)i.push(o[n].clone());this.morphAttributes[a]=i}this.morphTargetsRelative=t.morphTargetsRelative;var a=t.groups;for(n=0,e=a.length;n<e;n++)r=a[n],this.addGroup(r.start,r.count,r.materialIndex);return a=t.boundingBox,null!==a&&(this.boundingBox=a.clone()),a=t.boundingSphere,null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var cs=new u,us=new v,hs=new y,ps=new c,ds=new c,fs=new c,ms=new c,gs=new c,ys=new c,vs=new c,_s=new c,xs=new c,bs=new n,ws=new n,Ms=new n,Es=new c,Ss=new c;j.prototype=Object.assign(Object.create(d.prototype),{constructor:j,isMesh:!0,copy:function(t){return d.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var n=t[e[0]];if(void 0!==n)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}else t=t.morphTargets,void 0!==t&&0<t.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},raycast:function(t,e){var r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),hs.copy(r.boundingSphere),hs.applyMatrix4(o),!1!==t.ray.intersectsSphere(hs)&&(cs.getInverse(o),us.copy(t.ray).applyMatrix4(cs),null===r.boundingBox||!1!==us.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a=r.index;o=r.attributes.position;var s,l,c=r.morphAttributes.position,u=r.morphTargetsRelative,h=r.attributes.uv,p=r.attributes.uv2,d=r.groups,f=r.drawRange;if(null!==a)if(Array.isArray(i)){var m=0;for(s=d.length;m<s;m++){var g=d[m],y=i[g.materialIndex],v=Math.max(g.start,f.start);for(l=r=Math.min(g.start+g.count,f.start+f.count);v<l;v+=3){r=a.getX(v);var _=a.getX(v+1),b=a.getX(v+2);(r=V(this,y,t,us,o,c,u,h,p,r,_,b))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=g.materialIndex,e.push(r))}}}else for(v=Math.max(0,f.start),r=Math.min(a.count,f.start+f.count),m=v,s=r;m<s;m+=3)r=a.getX(m),_=a.getX(m+1),b=a.getX(m+2),(r=V(this,i,t,us,o,c,u,h,p,r,_,b))&&(r.faceIndex=Math.floor(m/3),e.push(r));else if(void 0!==o)if(Array.isArray(i))for(m=0,s=d.length;m<s;m++)for(g=d[m],y=i[g.materialIndex],v=Math.max(g.start,f.start),l=r=Math.min(g.start+g.count,f.start+f.count);v<l;v+=3)r=v,_=v+1,b=v+2,(r=V(this,y,t,us,o,c,u,h,p,r,_,b))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=g.materialIndex,e.push(r));else for(v=Math.max(0,f.start),r=Math.min(o.count,f.start+f.count),m=v,s=r;m<s;m+=3)r=m,_=m+1,b=m+2,(r=V(this,i,t,us,o,c,u,h,p,r,_,b))&&(r.faceIndex=Math.floor(m/3),e.push(r))}else if(r.isGeometry)for(o=Array.isArray(i),c=r.vertices,u=r.faces,r=r.faceVertexUvs[0],0<r.length&&(a=r),f=0,m=u.length;f<m;f++)s=u[f],r=o?i[s.materialIndex]:i,void 0!==r&&(h=c[s.a],p=c[s.b],d=c[s.c],r=G(this,r,t,us,h,p,d,Es))&&(a&&a[f]&&(g=a[f],bs.copy(g[0]),ws.copy(g[1]),Ms.copy(g[2]),r.uv=x.getUV(Es,h,p,d,bs,ws,Ms,new n)),r.face=s,r.faceIndex=f,e.push(r))},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ts=0,As=new u,Cs=new d,Ls=new c;H.prototype=Object.assign(Object.create(e.prototype),{constructor:H,isGeometry:!0,applyMatrix4:function(t){for(var e=(new r).getNormalMatrix(t),n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(t);for(n=0,i=this.faces.length;n<i;n++){t=this.faces[n],t.normal.applyMatrix3(e).normalize();for(var o=0,a=t.vertexNormals.length;o<a;o++)t.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(t){return As.makeRotationX(t),this.applyMatrix4(As),this},rotateY:function(t){return As.makeRotationY(t),this.applyMatrix4(As),this},rotateZ:function(t){return As.makeRotationZ(t),this.applyMatrix4(As),this},translate:function(t,e,n){return As.makeTranslation(t,e,n),this.applyMatrix4(As),this},scale:function(t,e,n){return As.makeScale(t,e,n),this.applyMatrix4(As),this},lookAt:function(t){return Cs.lookAt(t),Cs.updateMatrix(),this.applyMatrix4(Cs.matrix),this},fromBufferGeometry:function(t){function e(t,e,i,o){var a=void 0===l?[]:[r.colors[t].clone(),r.colors[e].clone(),r.colors[i].clone()],p=void 0===s?[]:[(new c).fromArray(s,3*t),(new c).fromArray(s,3*e),(new c).fromArray(s,3*i)];o=new S(t,e,i,p,a,o),r.faces.push(o),void 0!==u&&r.faceVertexUvs[0].push([(new n).fromArray(u,2*t),(new n).fromArray(u,2*e),(new n).fromArray(u,2*i)]),void 0!==h&&r.faceVertexUvs[1].push([(new n).fromArray(h,2*t),(new n).fromArray(h,2*e),(new n).fromArray(h,2*i)])}var r=this,i=null!==t.index?t.index.array:void 0,o=t.attributes;if(void 0===o.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var a=o.position.array,s=void 0!==o.normal?o.normal.array:void 0,l=void 0!==o.color?o.color.array:void 0,u=void 0!==o.uv?o.uv.array:void 0,h=void 0!==o.uv2?o.uv2.array:void 0;for(void 0!==h&&(this.faceVertexUvs[1]=[]),o=0;o<a.length;o+=3)r.vertices.push((new c).fromArray(a,o)),void 0!==l&&r.colors.push((new b).fromArray(l,o));var p=t.groups;if(0<p.length)for(o=0;o<p.length;o++){a=p[o];var d=a.start,f=d;for(d+=a.count;f<d;f+=3)void 0!==i?e(i[f],i[f+1],i[f+2],a.materialIndex):e(f,f+1,f+2,a.materialIndex)}else if(void 0!==i)for(o=0;o<i.length;o+=3)e(i[o],i[o+1],i[o+2]);else for(o=0;o<a.length/3;o+=3)e(o,o+1,o+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ls).negate(),this.translate(Ls.x,Ls.y,Ls.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius;e=0===e?1:1/e;var n=new u;return n.set(e,0,0,-e*t.x,0,e,0,-e*t.y,0,0,e,-e*t.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){for(var t=new c,e=new c,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b];t.subVectors(this.vertices[i.c],a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e;void 0===t&&(t=!0);var n=Array(this.vertices.length),r=0;for(e=this.vertices.length;r<e;r++)n[r]=new c;if(t){var i=new c,o=new c;for(t=0,r=this.faces.length;t<r;t++){e=this.faces[t];var a=this.vertices[e.a],s=this.vertices[e.b],l=this.vertices[e.c];i.subVectors(l,s),o.subVectors(a,s),i.cross(o),n[e.a].add(i),n[e.b].add(i),n[e.c].add(i)}}else for(this.computeFaceNormals(),t=0,r=this.faces.length;t<r;t++)e=this.faces[t],n[e.a].add(e.normal),n[e.b].add(e.normal),n[e.c].add(e.normal);for(r=0,e=this.vertices.length;r<e;r++)n[r].normalize();for(t=0,r=this.faces.length;t<r;t++)e=this.faces[t],a=e.vertexNormals,3===a.length?(a[0].copy(n[e.a]),a[1].copy(n[e.b]),a[2].copy(n[e.c])):(a[0]=n[e.a].clone(),a[1]=n[e.b].clone(),a[2]=n[e.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t;this.computeFaceNormals();var e=0;for(t=this.faces.length;e<t;e++){var n=this.faces[e],r=n.vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n=0;for(e=this.faces.length;n<e;n++){var r=this.faces[n];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);var i=0;for(t=r.vertexNormals.length;i<t;i++)r.__originalVertexNormals[i]?r.__originalVertexNormals[i].copy(r.vertexNormals[i]):r.__originalVertexNormals[i]=r.vertexNormals[i].clone()}var o=new H;for(o.faces=this.faces,i=0,t=this.morphTargets.length;i<t;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[],r=this.morphNormals[i].faceNormals;var a=this.morphNormals[i].vertexNormals;for(n=0,e=this.faces.length;n<e;n++){var s=new c,l={a:new c,b:new c,c:new c};r.push(s),a.push(l)}}for(a=this.morphNormals[i],o.vertices=this.morphTargets[i].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,e=this.faces.length;n<e;n++)r=this.faces[n],s=a.faceNormals[n],l=a.vertexNormals[n],s.copy(r.normal),l.a.copy(r.vertexNormals[0]),l.b.copy(r.vertexNormals[1]),l.c.copy(r.vertexNormals[2])}for(n=0,e=this.faces.length;n<e;n++)r=this.faces[n],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new y),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(t&&t.isGeometry){var i,o=this.vertices.length,a=this.vertices,s=t.vertices,l=this.faces,c=t.faces,u=this.colors,h=t.colors;void 0===n&&(n=0),void 0!==e&&(i=(new r).getNormalMatrix(e));for(var p=0,d=s.length;p<d;p++){var f=s[p].clone();void 0!==e&&f.applyMatrix4(e),a.push(f)}for(p=0,d=h.length;p<d;p++)u.push(h[p].clone());for(p=0,d=c.length;p<d;p++){s=c[p];var m=s.vertexNormals;for(h=s.vertexColors,u=new S(s.a+o,s.b+o,s.c+o),u.normal.copy(s.normal),void 0!==i&&u.normal.applyMatrix3(i).normalize(),e=0,a=m.length;e<a;e++)f=m[e].clone(),void 0!==i&&f.applyMatrix3(i).normalize(),u.vertexNormals.push(f);for(u.color.copy(s.color),e=0,a=h.length;e<a;e++)f=h[e],u.vertexColors.push(f.clone());u.materialIndex=s.materialIndex+n,l.push(u)}for(p=0,d=t.faceVertexUvs.length;p<d;p++)for(n=t.faceVertexUvs[p],void 0===this.faceVertexUvs[p]&&(this.faceVertexUvs[p]=[]),e=0,a=n.length;e<a;e++){for(i=n[e],o=[],l=0,c=i.length;l<c;l++)o.push(i[l].clone());this.faceVertexUvs[p].push(o)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e={},n=[],r=[],i=Math.pow(10,4),o=0;for(t=this.vertices.length;o<t;o++){var a=this.vertices[o];a=Math.round(a.x*i)+"_"+Math.round(a.y*i)+"_"+Math.round(a.z*i),void 0===e[a]?(e[a]=o,n.push(this.vertices[o]),r[o]=n.length-1):r[o]=r[e[a]]}for(e=[],o=0,t=this.faces.length;o<t;o++)for(i=this.faces[o],i.a=r[i.a],i.b=r[i.b],i.c=r[i.c],i=[i.a,i.b,i.c],a=0;3>a;a++)if(i[a]===i[(a+1)%3]){e.push(o);break}for(o=e.length-1;0<=o;o--)for(i=e[o],this.faces.splice(i,1),r=0,t=this.faceVertexUvs.length;r<t;r++)this.faceVertexUvs[r].splice(i,1);return o=this.vertices.length-n.length,this.vertices=n,o},setFromPoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var r=t[e];this.vertices.push(new c(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));var r,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===e&&(r=[]),a&&a.length===e&&(i=[]),n=0;n<e;n++){var s=t[n]._id;r&&r.push(o[s]),i&&i.push(a[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){function t(t,e,n){return n?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==c[e]||(c[e]=l.length/3,l.push(t.x,t.y,t.z)),c[e]}function n(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==h[e]||(h[e]=u.length,u.push(t.getHex())),h[e]}function r(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]||(d[e]=p.length/2,p.push(t.x,t.y)),d[e]}var i={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),void 0!==this.parameters){var o,a=this.parameters;for(o in a)void 0!==a[o]&&(i[o]=a[o]);return i}for(a=[],o=0;o<this.vertices.length;o++){var s=this.vertices[o];a.push(s.x,s.y,s.z)}s=[];var l=[],c={},u=[],h={},p=[],d={};for(o=0;o<this.faces.length;o++){var f=this.faces[o],m=void 0!==this.faceVertexUvs[0][o],g=0<f.normal.length(),y=0<f.vertexNormals.length,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,_=0<f.vertexColors.length,x=0;x=t(x,0,0),x=t(x,1,!0),x=t(x,2,!1),x=t(x,3,m),x=t(x,4,g),x=t(x,5,y),x=t(x,6,v),x=t(x,7,_),s.push(x),s.push(f.a,f.b,f.c),s.push(f.materialIndex),m&&(m=this.faceVertexUvs[0][o],s.push(r(m[0]),r(m[1]),r(m[2]))),g&&s.push(e(f.normal)),y&&(g=f.vertexNormals,s.push(e(g[0]),e(g[1]),e(g[2]))),v&&s.push(n(f.color)),_&&(f=f.vertexColors,s.push(n(f[0]),n(f[1]),n(f[2])))}return i.data={},i.data.vertices=a,i.data.normals=l,0<u.length&&(i.data.colors=u),0<p.length&&(i.data.uvs=[p]),i.data.faces=s,i},clone:function(){return(new H).copy(this)},copy:function(t){var e,n,r;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var i=t.vertices,o=0;for(e=i.length;o<e;o++)this.vertices.push(i[o].clone());for(i=t.colors,o=0,e=i.length;o<e;o++)this.colors.push(i[o].clone());for(i=t.faces,o=0,e=i.length;o<e;o++)this.faces.push(i[o].clone());for(o=0,e=t.faceVertexUvs.length;o<e;o++){var a=t.faceVertexUvs[o];for(void 0===this.faceVertexUvs[o]&&(this.faceVertexUvs[o]=[]),i=0,n=a.length;i<n;i++){var s=a[i],l=[],c=0;for(r=s.length;c<r;c++)l.push(s[c].clone());this.faceVertexUvs[o].push(l)}}for(c=t.morphTargets,o=0,e=c.length;o<e;o++){if(r={},r.name=c[o].name,void 0!==c[o].vertices)for(r.vertices=[],i=0,n=c[o].vertices.length;i<n;i++)r.vertices.push(c[o].vertices[i].clone());if(void 0!==c[o].normals)for(r.normals=[],i=0,n=c[o].normals.length;i<n;i++)r.normals.push(c[o].normals[i].clone());this.morphTargets.push(r)}for(c=t.morphNormals,o=0,e=c.length;o<e;o++){if(r={},void 0!==c[o].vertexNormals)for(r.vertexNormals=[],i=0,n=c[o].vertexNormals.length;i<n;i++)a=c[o].vertexNormals[i],s={},s.a=a.a.clone(),s.b=a.b.clone(),s.c=a.c.clone(),r.vertexNormals.push(s);if(void 0!==c[o].faceNormals)for(r.faceNormals=[],i=0,n=c[o].faceNormals.length;i<n;i++)r.faceNormals.push(c[o].faceNormals[i].clone());this.morphNormals.push(r)}for(i=t.skinWeights,o=0,e=i.length;o<e;o++)this.skinWeights.push(i[o].clone());for(i=t.skinIndices,o=0,e=i.length;o<e;o++)this.skinIndices.push(i[o].clone());for(i=t.lineDistances,o=0,e=i.length;o<e;o++)this.lineDistances.push(i[o]);return o=t.boundingBox,null!==o&&(this.boundingBox=o.clone()),o=t.boundingSphere,null!==o&&(this.boundingSphere=o.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Is=function(t){function e(e,n,r,i,o,a){t.call(this),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:o,depthSegments:a},this.fromBufferGeometry(new Ps(e,n,r,i,o,a)),this.mergeVertices()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e}(H),Ps=function(t){function e(e,n,r,i,o,a){function s(t,e,n,r,i,o,a,s,g,y,v){var _=o/g,x=a/y,b=o/2,w=a/2,M=s/2;a=g+1;for(var E=y+1,S=o=0,T=new c,A=0;A<E;A++)for(var C=A*x-w,L=0;L<a;L++)T[t]=(L*_-b)*r,T[e]=C*i,T[n]=M,h.push(T.x,T.y,T.z),T[t]=0,T[e]=0,T[n]=0<s?1:-1,p.push(T.x,T.y,T.z),d.push(L/g),d.push(1-A/y),o+=1;for(t=0;t<y;t++)for(e=0;e<g;e++)n=f+e+a*(t+1),r=f+(e+1)+a*(t+1),i=f+(e+1)+a*t,u.push(f+e+a*t,n,i),u.push(n,r,i),S+=6;l.addGroup(m,S,v),m+=S,f+=o}t.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:o,depthSegments:a};var l=this;e=e||1,n=n||1,r=r||1,i=Math.floor(i)||1,o=Math.floor(o)||1,a=Math.floor(a)||1;var u=[],h=[],p=[],d=[],f=0,m=0;s("z","y","x",-1,-1,r,n,e,a,o,0),s("z","y","x",1,-1,r,n,-e,a,o,1),s("x","z","y",1,1,e,r,n,i,a,2),s("x","z","y",1,-1,e,r,-n,i,a,3),s("x","y","z",1,-1,e,n,r,i,o,4),s("x","y","z",-1,-1,e,n,-r,i,o,5),this.setIndex(u),this.setAttribute("position",new k(h,3)),this.setAttribute("normal",new k(p,3)),this.setAttribute("uv",new k(d,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e}(U),Rs={clone:W,merge:q};X.prototype=Object.create(T.prototype),X.prototype.constructor=X,X.prototype.isShaderMaterial=!0,X.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=W(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this},X.prototype.toJSON=function(t){var e=T.prototype.toJSON.call(this,t);for(var n in e.uniforms={},this.uniforms){var r=this.uniforms[n].value;e.uniforms[n]=r&&r.isTexture?{type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}for(var i in 0<Object.keys(this.defines).length&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,t={},this.extensions)!0===this.extensions[i]&&(t[i]=!0);return 0<Object.keys(t).length&&(e.extensions=t),e},Z.prototype=Object.assign(Object.create(d.prototype),{constructor:Z,isCamera:!0,copy:function(t,e){return d.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new c),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){d.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){d.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Y.prototype=Object.assign(Object.create(Z.prototype),{constructor:Y,isPerspectiveCamera:!0,copy:function(t,e){return Z.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){t=.5*this.getFilmHeight()/t,this.fov=2*Vo.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Vo.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Vo.RAD2DEG*Math.atan(Math.tan(.5*Vo.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*Vo.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,e-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}o=this.filmOffset,0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){return t=d.prototype.toJSON.call(this,t),t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),$.prototype=Object.create(d.prototype),$.prototype.constructor=$,J.prototype=Object.create(a.prototype),J.prototype.constructor=J,J.prototype.isWebGLCubeRenderTarget=!0,J.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var n=new f,r=new X({type:"CubemapFromEquirect",uniforms:W({tEquirect:{value:null}}),vertexShader:"varying vec3 vWorldDirection;\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}",side:1,blending:0});return r.uniforms.tEquirect.value=e,e=new j(new Ps(5,5,5),r),n.add(e),new $(1,10,this).update(t,n),e.geometry.dispose(),e.material.dispose(),this},K.prototype=Object.create(i.prototype),K.prototype.constructor=K,K.prototype.isDataTexture=!0;var Os=new y,Ds=new c;Object.assign(Q.prototype,{set:function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,n=0;6>n;n++)e[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){var e=this.planes,n=t.elements;t=n[0];var r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],l=n[6],c=n[7],u=n[8],h=n[9],p=n[10],d=n[11],f=n[12],m=n[13],g=n[14];return n=n[15],e[0].setComponents(o-t,c-a,d-u,n-f).normalize(),e[1].setComponents(o+t,c+a,d+u,n+f).normalize(),e[2].setComponents(o+r,c+s,d+h,n+m).normalize(),e[3].setComponents(o-r,c-s,d-h,n-m).normalize(),e[4].setComponents(o-i,c-l,d-p,n-g).normalize(),e[5].setComponents(o+i,c+l,d+p,n+g).normalize(),this},intersectsObject:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Os.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Os)},intersectsSprite:function(t){return Os.center.set(0,0,0),Os.radius=.7071067811865476,Os.applyMatrix4(t.matrixWorld),this.intersectsSphere(Os)},intersectsSphere:function(t){var e=this.planes,n=t.center;t=-t.radius;for(var r=0;6>r;r++)if(e[r].distanceToPoint(n)<t)return!1;return!0},intersectsBox:function(t){for(var e=this.planes,n=0;6>n;n++){var r=e[n];if(Ds.x=0<r.normal.x?t.max.x:t.min.x,Ds.y=0<r.normal.y?t.max.y:t.min.y,Ds.z=0<r.normal.z?t.max.z:t.min.z,0>r.distanceToPoint(Ds))return!1}return!0},containsPoint:function(t){for(var e=this.planes,n=0;6>n;n++)if(0>e[n].distanceToPoint(t))return!1;return!0}});var Ns={common:{diffuse:{value:new b(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new r},uv2Transform:{value:new r},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new n(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new b(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new b(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new r}},sprite:{diffuse:{value:new b(15658734)},opacity:{value:1},center:{value:new n(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new r}}};nt.prototype=Object.create(H.prototype),nt.prototype.constructor=nt,rt.prototype=Object.create(U.prototype),rt.prototype.constructor=rt;var ks={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Fs={basic:{uniforms:q([Ns.common,Ns.specularmap,Ns.envmap,Ns.aomap,Ns.lightmap,Ns.fog]),vertexShader:ks.meshbasic_vert,fragmentShader:ks.meshbasic_frag},lambert:{uniforms:q([Ns.common,Ns.specularmap,Ns.envmap,Ns.aomap,Ns.lightmap,Ns.emissivemap,Ns.fog,Ns.lights,{emissive:{value:new b(0)}}]),vertexShader:ks.meshlambert_vert,fragmentShader:ks.meshlambert_frag},phong:{uniforms:q([Ns.common,Ns.specularmap,Ns.envmap,Ns.aomap,Ns.lightmap,Ns.emissivemap,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,Ns.fog,Ns.lights,{emissive:{value:new b(0)},specular:{value:new b(1118481)},shininess:{value:30}}]),vertexShader:ks.meshphong_vert,fragmentShader:ks.meshphong_frag},standard:{uniforms:q([Ns.common,Ns.envmap,Ns.aomap,Ns.lightmap,Ns.emissivemap,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,Ns.roughnessmap,Ns.metalnessmap,Ns.fog,Ns.lights,{emissive:{value:new b(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ks.meshphysical_vert,fragmentShader:ks.meshphysical_frag},toon:{uniforms:q([Ns.common,Ns.specularmap,Ns.aomap,Ns.lightmap,Ns.emissivemap,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,Ns.gradientmap,Ns.fog,Ns.lights,{emissive:{value:new b(0)},specular:{value:new b(1118481)},shininess:{value:30}}]),vertexShader:ks.meshtoon_vert,fragmentShader:ks.meshtoon_frag},matcap:{uniforms:q([Ns.common,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,Ns.fog,{matcap:{value:null}}]),vertexShader:ks.meshmatcap_vert,fragmentShader:ks.meshmatcap_frag},points:{uniforms:q([Ns.points,Ns.fog]),vertexShader:ks.points_vert,fragmentShader:ks.points_frag},dashed:{uniforms:q([Ns.common,Ns.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ks.linedashed_vert,fragmentShader:ks.linedashed_frag},depth:{uniforms:q([Ns.common,Ns.displacementmap]),vertexShader:ks.depth_vert,fragmentShader:ks.depth_frag},normal:{uniforms:q([Ns.common,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,{opacity:{value:1}}]),vertexShader:ks.normal_vert,fragmentShader:ks.normal_frag},sprite:{uniforms:q([Ns.sprite,Ns.fog]),vertexShader:ks.sprite_vert,fragmentShader:ks.sprite_frag},background:{uniforms:{uvTransform:{value:new r},t2D:{value:null}},vertexShader:ks.background_vert,fragmentShader:ks.background_frag},cube:{uniforms:q([Ns.envmap,{opacity:{value:1}}]),vertexShader:ks.cube_vert,fragmentShader:ks.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ks.equirect_vert,fragmentShader:ks.equirect_frag},distanceRGBA:{uniforms:q([Ns.common,Ns.displacementmap,{referencePosition:{value:new c},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ks.distanceRGBA_vert,fragmentShader:ks.distanceRGBA_frag},shadow:{uniforms:q([Ns.lights,Ns.fog,{color:{value:new b(0)},opacity:{value:1}}]),vertexShader:ks.shadow_vert,fragmentShader:ks.shadow_frag}};Fs.physical={uniforms:q([Fs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new n(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new b(0)},transparency:{value:0}}]),vertexShader:ks.meshphysical_vert,fragmentShader:ks.meshphysical_frag},mt.prototype=Object.create(i.prototype),mt.prototype.constructor=mt,mt.prototype.isCubeTexture=!0,Object.defineProperty(mt.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),gt.prototype=Object.create(i.prototype),gt.prototype.constructor=gt,gt.prototype.isDataTexture2DArray=!0,yt.prototype=Object.create(i.prototype),yt.prototype.constructor=yt,yt.prototype.isDataTexture3D=!0;var zs=new i,Bs=new gt,Us=new yt,js=new mt,Gs=[],Vs=[],Hs=new Float32Array(16),Ws=new Float32Array(9),qs=new Float32Array(4);te.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),xt(e,t)},ee.prototype.setValue=function(t,e,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(t,e[a.id],n)}};var Xs=/([\w\d_]+)(\])?(\[|\.)?/g;ne.prototype.setValue=function(t,e,n,r){e=this.map[e],void 0!==e&&e.setValue(t,n,r)},ne.prototype.setOptional=function(t,e,n){e=e[n],void 0!==e&&this.setValue(t,n,e)},ne.upload=function(t,e,n,r){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,r)}},ne.seqWithValue=function(t,e){for(var n=[],r=0,i=t.length;r!==i;++r){var o=t[r];o.id in e&&n.push(o)}return n};var Zs=0,Ys=/^[ \t]*#include +<([\w\d./]+)>/gm,$s=/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Js=/#pragma unroll_loop_start[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g,Ks=0;De.prototype=Object.create(T.prototype),De.prototype.constructor=De,De.prototype.isMeshDepthMaterial=!0,De.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Ne.prototype=Object.create(T.prototype),Ne.prototype.constructor=Ne,Ne.prototype.isMeshDistanceMaterial=!0,Ne.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},Ue.prototype=Object.assign(Object.create(Y.prototype),{constructor:Ue,isArrayCamera:!0}),je.prototype=Object.assign(Object.create(d.prototype),{constructor:je,isGroup:!0}),Object.assign(Ge.prototype,{constructor:Ge,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new je,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new je,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(t,e,n){var r=null,i=null,o=this._targetRay,a=this._grip;return t&&(null!==o&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)))),null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),this}}),Object.assign(Ve.prototype,e.prototype),Object.assign(qe.prototype,{isFogExp2:!0,clone:function(){return new qe(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Xe.prototype,{isFog:!0,clone:function(){return new Xe(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Ze.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ze.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var Qs=new c;Object.defineProperties(Ye.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ye.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,n=this.data.count;e<n;e++)Qs.x=this.getX(e),Qs.y=this.getY(e),Qs.z=this.getZ(e),Qs.applyMatrix4(t),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var n=e*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[n+r]);return new C(new this.array.constructor(t),this.itemSize,this.normalized)},toJSON:function(){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var n=e*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[n+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}}),$e.prototype=Object.create(T.prototype),$e.prototype.constructor=$e,$e.prototype.isSpriteMaterial=!0,$e.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var tl,el=new c,nl=new c,rl=new c,il=new n,ol=new n,al=new u,sl=new c,ll=new c,cl=new c,ul=new n,hl=new n,pl=new n;Je.prototype=Object.assign(Object.create(d.prototype),{constructor:Je,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),nl.setFromMatrixScale(this.matrixWorld),al.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),rl.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&nl.multiplyScalar(-rl.z);var r=this.material.rotation;if(0!==r)var i=Math.cos(r),o=Math.sin(r);r=this.center,Ke(sl.set(-.5,-.5,0),rl,r,nl,o,i),Ke(ll.set(.5,-.5,0),rl,r,nl,o,i),Ke(cl.set(.5,.5,0),rl,r,nl,o,i),ul.set(0,0),hl.set(1,0),pl.set(1,1);var a=t.ray.intersectTriangle(sl,ll,cl,!1,el);null===a&&(Ke(ll.set(-.5,.5,0),rl,r,nl,o,i),hl.set(0,1),a=t.ray.intersectTriangle(sl,cl,ll,!1,el),null===a)||(o=t.ray.origin.distanceTo(el),o<t.near||o>t.far||e.push({distance:o,point:el.clone(),uv:x.getUV(el,sl,ll,cl,ul,hl,pl,new n),face:null,object:this}))},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return d.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var dl=new c,fl=new c;Qe.prototype=Object.assign(Object.create(d.prototype),{constructor:Qe,isLOD:!0,copy:function(t){d.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,r=e.length;n<r;n++){var i=e[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var n=this.levels,r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){var e=this.levels;if(0<e.length){for(var n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(0<this.levels.length){dl.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(dl);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){var e=this.levels;if(1<e.length){dl.setFromMatrixPosition(t.matrixWorld),fl.setFromMatrixPosition(this.matrixWorld),t=dl.distanceTo(fl)/t.zoom,e[0].object.visible=!0;for(var n=1,r=e.length;n<r;n++){if(!(t>=e[n].distance))break;e[n-1].object.visible=!1,e[n].object.visible=!0}for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}},toJSON:function(t){t=d.prototype.toJSON.call(this,t),!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var e=this.levels,n=0,r=e.length;n<r;n++){var i=e[n];t.object.levels.push({object:i.object.uuid,distance:i.distance})}return t}}),tn.prototype=Object.assign(Object.create(j.prototype),{constructor:tn,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new o,e=this.geometry.attributes.skinWeight,n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);var i=1/t.manhattanLength();1/0!==i?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){j.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},boneTransform:function(){var t=new c,e=new o,n=new o,r=new c,i=new u;return function(o,a){var s=this.skeleton,l=this.geometry;for(e.fromBufferAttribute(l.attributes.skinIndex,o),n.fromBufferAttribute(l.attributes.skinWeight,o),t.fromBufferAttribute(l.attributes.position,o).applyMatrix4(this.bindMatrix),a.set(0,0,0),o=0;4>o;o++)if(l=n.getComponent(o),0!==l){var c=e.getComponent(o);i.multiplyMatrices(s.bones[c].matrixWorld,s.boneInverses[c]),a.addScaledVector(r.copy(t).applyMatrix4(i),l)}return a.applyMatrix4(this.bindMatrixInverse)}}()});var ml=new u,gl=new u;Object.assign(en.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new u;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){var t,e,n=0;for(e=this.bones.length;n<e;n++)(t=this.bones[n])&&t.matrixWorld.getInverse(this.boneInverses[n]);for(n=0,e=this.bones.length;n<e;n++)(t=this.bones[n])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=t.length;i<o;i++)ml.multiplyMatrices(t[i]?t[i].matrixWorld:gl,e[i]),ml.toArray(n,16*i);void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new en(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),nn.prototype=Object.assign(Object.create(d.prototype),{constructor:nn,isBone:!0});var yl=new u,vl=new u,_l=[],xl=new j;rn.prototype=Object.assign(Object.create(j.prototype),{constructor:rn,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){var n=this.matrixWorld,r=this.count;if(xl.geometry=this.geometry,xl.material=this.material,void 0!==xl.material)for(var i=0;i<r;i++){this.getMatrixAt(i,yl),vl.multiplyMatrices(n,yl),xl.matrixWorld=vl,xl.raycast(t,_l);for(var o=0,a=_l.length;o<a;o++){var s=_l[o];s.instanceId=i,s.object=this,e.push(s)}_l.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),on.prototype=Object.create(T.prototype),on.prototype.constructor=on,on.prototype.isLineBasicMaterial=!0,on.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};var bl=new c,wl=new c,Ml=new u,El=new v,Sl=new y;an.prototype=Object.assign(Object.create(d.prototype),{constructor:an,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)bl.fromBufferAttribute(e,r-1),wl.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=bl.distanceTo(wl);t.setAttribute("lineDistance",new k(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(e=t.vertices,n=t.lineDistances,n[0]=0,r=1,i=e.length;r<i;r++)n[r]=n[r-1],n[r]+=e[r-1].distanceTo(e[r]);return this},raycast:function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Sl.copy(n.boundingSphere),Sl.applyMatrix4(r),Sl.radius+=i,!1!==t.ray.intersectsSphere(Sl)){Ml.getInverse(r),El.copy(t.ray).applyMatrix4(Ml),r=i/((this.scale.x+this.scale.y+this.scale.z)/3),r*=r;var o=new c,a=new c;i=new c;var s=new c,l=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var u=n.index,h=n.attributes.position.array;if(null!==u){u=u.array,n=0;for(var p=u.length-1;n<p;n+=l){var d=u[n+1];o.fromArray(h,3*u[n]),a.fromArray(h,3*d),d=El.distanceSqToSegment(o,a,s,i),d>r||(s.applyMatrix4(this.matrixWorld),d=t.ray.origin.distanceTo(s),d<t.near||d>t.far||e.push({distance:d,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}}else for(n=0,p=h.length/3-1;n<p;n+=l)o.fromArray(h,3*n),a.fromArray(h,3*n+3),d=El.distanceSqToSegment(o,a,s,i),d>r||(s.applyMatrix4(this.matrixWorld),d=t.ray.origin.distanceTo(s),d<t.near||d>t.far||e.push({distance:d,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}else if(n.isGeometry)for(o=n.vertices,a=o.length,n=0;n<a-1;n+=l)d=El.distanceSqToSegment(o[n],o[n+1],s,i),d>r||(s.applyMatrix4(this.matrixWorld),d=t.ray.origin.distanceTo(s),d<t.near||d>t.far||e.push({distance:d,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var n=t[e[0]];if(void 0!==n)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}else t=t.morphTargets,void 0!==t&&0<t.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Tl=new c,Al=new c;sn.prototype=Object.assign(Object.create(an.prototype),{constructor:sn,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[],r=0,i=e.count;r<i;r+=2)Tl.fromBufferAttribute(e,r),Al.fromBufferAttribute(e,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+Tl.distanceTo(Al);t.setAttribute("lineDistance",new k(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(e=t.vertices,n=t.lineDistances,r=0,i=e.length;r<i;r+=2)Tl.copy(e[r]),Al.copy(e[r+1]),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+Tl.distanceTo(Al);return this}}),ln.prototype=Object.assign(Object.create(an.prototype),{constructor:ln,isLineLoop:!0}),cn.prototype=Object.create(T.prototype),cn.prototype.constructor=cn,cn.prototype.isPointsMaterial=!0,cn.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var Cl=new u,Ll=new v,Il=new y,Pl=new c;un.prototype=Object.assign(Object.create(d.prototype),{constructor:un,isPoints:!0,raycast:function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Il.copy(n.boundingSphere),Il.applyMatrix4(r),Il.radius+=i,!1!==t.ray.intersectsSphere(Il))if(Cl.getInverse(r),Ll.copy(t.ray).applyMatrix4(Cl),i/=(this.scale.x+this.scale.y+this.scale.z)/3,i*=i,n.isBufferGeometry){var o=n.index;if(n=n.attributes.position.array,null!==o){var a=o.array;o=0;for(var s=a.length;o<s;o++){var l=a[o];Pl.fromArray(n,3*l),hn(Pl,l,i,r,t,e,this)}}else for(o=0,a=n.length/3;o<a;o++)Pl.fromArray(n,3*o),hn(Pl,o,i,r,t,e,this)}else for(n=n.vertices,o=0,a=n.length;o<a;o++)hn(n[o],o,i,r,t,e,this)},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var n=t[e[0]];if(void 0!==n)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}else t=t.morphTargets,void 0!==t&&0<t.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),pn.prototype=Object.assign(Object.create(i.prototype),{constructor:pn,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),dn.prototype=Object.create(i.prototype),dn.prototype.constructor=dn,dn.prototype.isCompressedTexture=!0,fn.prototype=Object.create(i.prototype),fn.prototype.constructor=fn,fn.prototype.isCanvasTexture=!0,mn.prototype=Object.create(i.prototype),mn.prototype.constructor=mn,mn.prototype.isDepthTexture=!0,gn.prototype=Object.create(U.prototype),gn.prototype.constructor=gn,yn.prototype=Object.create(H.prototype),yn.prototype.constructor=yn,vn.prototype=Object.create(U.prototype),vn.prototype.constructor=vn,_n.prototype=Object.create(H.prototype),_n.prototype.constructor=_n,xn.prototype=Object.create(U.prototype),xn.prototype.constructor=xn,bn.prototype=Object.create(H.prototype),bn.prototype.constructor=bn,wn.prototype=Object.create(xn.prototype),wn.prototype.constructor=wn,Mn.prototype=Object.create(H.prototype),Mn.prototype.constructor=Mn,En.prototype=Object.create(xn.prototype),En.prototype.constructor=En,Sn.prototype=Object.create(H.prototype),Sn.prototype.constructor=Sn,Tn.prototype=Object.create(xn.prototype),Tn.prototype.constructor=Tn,An.prototype=Object.create(H.prototype),An.prototype.constructor=An,Cn.prototype=Object.create(xn.prototype),Cn.prototype.constructor=Cn,Ln.prototype=Object.create(H.prototype),Ln.prototype.constructor=Ln,In.prototype=Object.create(U.prototype),In.prototype.constructor=In,In.prototype.toJSON=function(){var t=U.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},Pn.prototype=Object.create(H.prototype),Pn.prototype.constructor=Pn,Rn.prototype=Object.create(U.prototype),Rn.prototype.constructor=Rn,On.prototype=Object.create(H.prototype),On.prototype.constructor=On,Dn.prototype=Object.create(U.prototype),Dn.prototype.constructor=Dn;var Rl={triangulate:function(t,e,n){n=n||2;var r,i=e&&e.length,o=i?e[0]*n:t.length,a=Nn(t,0,o,n,!0),s=[];if(!a||a.next===a.prev)return s;if(i){var l,c=n;i=[];var u=0;for(l=e.length;u<l;u++){var h=e[u]*c,p=u<l-1?e[u+1]*c:t.length;h=Nn(t,h,p,c,!1),h===h.next&&(h.steiner=!0),i.push(Gn(h))}for(i.sort(Bn),u=0;u<i.length;u++)c=i[u],e=a,(e=Un(c,e))&&(c=$n(e,c),kn(e,e.next),kn(c,c.next)),a=kn(a,a.next)}if(t.length>80*n){var d=r=t[0],f=i=t[1];for(c=n;c<o;c+=n)u=t[c],e=t[c+1],u<d&&(d=u),e<f&&(f=e),u>r&&(r=u),e>i&&(i=e);r=Math.max(r-d,i-f),r=0!==r?1/r:0}return Fn(a,s,n,d,f,r),s}},Ol={area:function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return 0>Ol.area(t)},triangulateShape:function(t,e){var n=[],r=[],i=[];tr(t),er(n,t);var o=t.length;for(e.forEach(tr),t=0;t<e.length;t++)r.push(o),o+=e[t].length,er(n,e[t]);for(e=Rl.triangulate(n,r),t=0;t<e.length;t+=3)i.push(e.slice(t,t+3));return i}};nr.prototype=Object.create(H.prototype),nr.prototype.constructor=nr,nr.prototype.toJSON=function(){var t=H.prototype.toJSON.call(this);return ir(this.parameters.shapes,this.parameters.options,t)},rr.prototype=Object.create(U.prototype),rr.prototype.constructor=rr,rr.prototype.toJSON=function(){var t=U.prototype.toJSON.call(this);return ir(this.parameters.shapes,this.parameters.options,t)};var Dl={generateTopUV:function(t,e,r,i,o){t=e[3*i],i=e[3*i+1];var a=e[3*o];return o=e[3*o+1],[new n(e[3*r],e[3*r+1]),new n(t,i),new n(a,o)]},generateSideWallUV:function(t,e,r,i,o,a){t=e[3*r];var s=e[3*r+1];r=e[3*r+2];var l=e[3*i],c=e[3*i+1];i=e[3*i+2];var u=e[3*o],h=e[3*o+1];o=e[3*o+2];var p=e[3*a],d=e[3*a+1];return e=e[3*a+2],.01>Math.abs(s-c)?[new n(t,1-r),new n(l,1-i),new n(u,1-o),new n(p,1-e)]:[new n(s,1-r),new n(c,1-i),new n(h,1-o),new n(d,1-e)]}};or.prototype=Object.create(H.prototype),or.prototype.constructor=or,ar.prototype=Object.create(rr.prototype),ar.prototype.constructor=ar,sr.prototype=Object.create(H.prototype),sr.prototype.constructor=sr,lr.prototype=Object.create(U.prototype),lr.prototype.constructor=lr,cr.prototype=Object.create(H.prototype),cr.prototype.constructor=cr,ur.prototype=Object.create(U.prototype),ur.prototype.constructor=ur,hr.prototype=Object.create(H.prototype),hr.prototype.constructor=hr,pr.prototype=Object.create(U.prototype),pr.prototype.constructor=pr,dr.prototype=Object.create(H.prototype),dr.prototype.constructor=dr,dr.prototype.toJSON=function(){var t=H.prototype.toJSON.call(this);return mr(this.parameters.shapes,t)},fr.prototype=Object.create(U.prototype),fr.prototype.constructor=fr,fr.prototype.toJSON=function(){var t=U.prototype.toJSON.call(this);return mr(this.parameters.shapes,t)},gr.prototype=Object.create(U.prototype),gr.prototype.constructor=gr,yr.prototype=Object.create(H.prototype),yr.prototype.constructor=yr,vr.prototype=Object.create(U.prototype),vr.prototype.constructor=vr,_r.prototype=Object.create(yr.prototype),_r.prototype.constructor=_r,xr.prototype=Object.create(vr.prototype),xr.prototype.constructor=xr,br.prototype=Object.create(H.prototype),br.prototype.constructor=br,wr.prototype=Object.create(U.prototype),wr.prototype.constructor=wr;var Nl=Object.freeze({__proto__:null,WireframeGeometry:gn,ParametricGeometry:yn,ParametricBufferGeometry:vn,TetrahedronGeometry:bn,TetrahedronBufferGeometry:wn,OctahedronGeometry:Mn,OctahedronBufferGeometry:En,IcosahedronGeometry:Sn,IcosahedronBufferGeometry:Tn,DodecahedronGeometry:An,DodecahedronBufferGeometry:Cn,PolyhedronGeometry:_n,PolyhedronBufferGeometry:xn,TubeGeometry:Ln,TubeBufferGeometry:In,TorusKnotGeometry:Pn,TorusKnotBufferGeometry:Rn,TorusGeometry:On,TorusBufferGeometry:Dn,TextGeometry:or,TextBufferGeometry:ar,SphereGeometry:sr,SphereBufferGeometry:lr,RingGeometry:cr,RingBufferGeometry:ur,PlaneGeometry:nt,PlaneBufferGeometry:rt,LatheGeometry:hr,LatheBufferGeometry:pr,ShapeGeometry:dr,ShapeBufferGeometry:fr,ExtrudeGeometry:nr,ExtrudeBufferGeometry:rr,EdgesGeometry:gr,ConeGeometry:_r,ConeBufferGeometry:xr,CylinderGeometry:yr,CylinderBufferGeometry:vr,CircleGeometry:br,CircleBufferGeometry:wr,BoxGeometry:Is,BoxBufferGeometry:Ps});Mr.prototype=Object.create(T.prototype),Mr.prototype.constructor=Mr,Mr.prototype.isShadowMaterial=!0,Mr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this},Er.prototype=Object.create(X.prototype),Er.prototype.constructor=Er,Er.prototype.isRawShaderMaterial=!0,Sr.prototype=Object.create(T.prototype),Sr.prototype.constructor=Sr,Sr.prototype.isMeshStandardMaterial=!0,Sr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},Tr.prototype=Object.create(Sr.prototype),Tr.prototype.constructor=Tr,Tr.prototype.isMeshPhysicalMaterial=!0,Tr.prototype.copy=function(t){return Sr.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,this.sheen=t.sheen?(this.sheen||new b).copy(t.sheen):null,this.transparency=t.transparency,this},Ar.prototype=Object.create(T.prototype),Ar.prototype.constructor=Ar,Ar.prototype.isMeshPhongMaterial=!0,Ar.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Cr.prototype=Object.create(T.prototype),Cr.prototype.constructor=Cr,Cr.prototype.isMeshToonMaterial=!0,Cr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Lr.prototype=Object.create(T.prototype),Lr.prototype.constructor=Lr,Lr.prototype.isMeshNormalMaterial=!0,Lr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Ir.prototype=Object.create(T.prototype),Ir.prototype.constructor=Ir,Ir.prototype.isMeshLambertMaterial=!0,Ir.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Pr.prototype=Object.create(T.prototype),Pr.prototype.constructor=Pr,Pr.prototype.isMeshMatcapMaterial=!0,Pr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Rr.prototype=Object.create(on.prototype),Rr.prototype.constructor=Rr,Rr.prototype.isLineDashedMaterial=!0,Rr.prototype.copy=function(t){return on.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var kl=Object.freeze({__proto__:null,ShadowMaterial:Mr,SpriteMaterial:$e,RawShaderMaterial:Er,ShaderMaterial:X,PointsMaterial:cn,MeshPhysicalMaterial:Tr,MeshStandardMaterial:Sr,MeshPhongMaterial:Ar,MeshToonMaterial:Cr,MeshNormalMaterial:Lr,MeshLambertMaterial:Ir,MeshDepthMaterial:De,MeshDistanceMaterial:Ne,MeshBasicMaterial:A,MeshMatcapMaterial:Pr,LineDashedMaterial:Rr,LineBasicMaterial:on,Material:T}),Fl={arraySlice:function(t,e,n){return Fl.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=Array(e),r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*e,l=0;l!==e;++l)i[a++]=t[s+l];return i},flattenJSON:function(t,e,n,r){for(var i=1,o=t[0];void 0!==o&&void 0===o[r];)o=t[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{a=o[r],void 0!==a&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[r],void 0!==a&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{a=o[r],void 0!==a&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)}},subclip:function(t,e,n,r,i){i=i||30,t=t.clone(),t.name=e;var o=[];for(e=0;e<t.tracks.length;++e){for(var a=t.tracks[e],s=a.getValueSize(),l=[],c=[],u=0;u<a.times.length;++u){var h=a.times[u]*i;if(!(h<n||h>=r))for(l.push(a.times[u]),h=0;h<s;++h)c.push(a.values[u*s+h])}0!==l.length&&(a.times=Fl.convertArray(l,a.times.constructor),a.values=Fl.convertArray(c,a.values.constructor),o.push(a))}for(t.tracks=o,n=1/0,e=0;e<t.tracks.length;++e)n>t.tracks[e].times[0]&&(n=t.tracks[e].times[0]);for(e=0;e<t.tracks.length;++e)t.tracks[e].shift(-1*n);return t.resetDuration(),t},makeClipAdditive:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=t),(void 0===r||0>=r)&&(r=30);var i=t.tracks.length;for(e/=r,r=0;r<i;++r){var o=n.tracks[r],a=o.ValueTypeName;if("bool"!==a&&"string"!==a){var s=t.tracks.find((function(t){return t.name===o.name&&t.ValueTypeName===a}));if(void 0!==s){var c=o.getValueSize(),u=o.times.length-1;e<=o.times[0]?u=Fl.arraySlice(o.values,0,o.valueSize):e>=o.times[u]?u=Fl.arraySlice(o.values,u*c):(u=o.createInterpolant(),u.evaluate(e),u=u.resultBuffer),"quaternion"===a&&new l(u[0],u[1],u[2],u[3]).normalize().conjugate().toArray(u);for(var h=s.times.length,p=0;p<h;++p){var d=p*c;if("quaternion"===a)l.multiplyQuaternionsFlat(s.values,d,u,0,s.values,d);else for(var f=0;f<c;++f)s.values[d+f]-=u[f]}}}}return t.blendMode=2501,t}};Object.assign(Or.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{n:{r:if(!(t<r)){for(var o=n+2;;){if(void 0===r){if(t<i)break r;return this._cachedIndex=n=e.length,this.afterEnd_(n-1,t,i)}if(n===o)break;if(i=r,r=e[++n],t<r)break e}r=e.length;break n}if(t>=i)break t;for(o=e[1],t<o&&(n=2,i=o),o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===o)break;if(r=i,i=e[--n-1],t>=i)break e}r=n,n=0}for(;n<r;)i=n+r>>>1,t<e[i]?r=i:n=i+1;if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return this._cachedIndex=n=e.length,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize;t*=r;for(var i=0;i!==r;++i)e[i]=n[t+i];return e},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Or.prototype,{beforeStart_:Or.prototype.copySampleValue_,afterEnd_:Or.prototype.copySampleValue_}),Dr.prototype=Object.assign(Object.create(Or.prototype),{constructor:Dr,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,n){var r=this.parameterPositions,i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=t,a=2*e-n;break;case 2402:i=r.length-2,a=e+r[i]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=t,s=2*n-e;break;case 2402:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}t=.5*(n-e),r=this.valueSize,this._weightPrev=t/(e-a),this._weightNext=t/(s-n),this._offsetPrev=i*r,this._offsetNext=o*r},interpolate_:function(t,e,n,r){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;t*=a;var s=t-a,l=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,h=this._weightNext,p=(n-e)/(r-e);for(n=p*p,r=n*p,e=-u*r+2*u*n-u*p,u=(1+u)*r+(-1.5-2*u)*n+(-.5+u)*p+1,p=(-1-h)*r+(1.5+h)*n+.5*p,h=h*r-h*n,n=0;n!==a;++n)i[n]=e*o[l+n]+u*o[s+n]+p*o[t+n]+h*o[c+n];return i}}),Nr.prototype=Object.assign(Object.create(Or.prototype),{constructor:Nr,interpolate_:function(t,e,n,r){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;t*=a;var s=t-a;for(e=(n-e)/(r-e),n=1-e,r=0;r!==a;++r)i[r]=o[s+r]*n+o[t+r]*e;return i}}),kr.prototype=Object.assign(Object.create(Or.prototype),{constructor:kr,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Fr,{toJSON:function(t){var e=t.constructor;if(void 0!==e.toJSON)e=e.toJSON(t);else{e={name:t.name,times:Fl.convertArray(t.times,Array),values:Fl.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}}),Object.assign(Fr.prototype,{constructor:Fr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new kr(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Nr(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Dr(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){switch(t){case 2300:var e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){if(e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;return++o,0===i&&o===r||(i>=o&&(o=Math.max(o,1),i=o-1),t=this.getValueSize(),this.times=Fl.arraySlice(n,i,o),this.values=Fl.arraySlice(this.values,i*t,o*t)),this},validate:function(){var t=!0,e=this.getValueSize();0!==e-Math.floor(e)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times;e=this.values;var r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var i=null,o=0;o!==r;o++){var a=n[o];if("number"===typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),t=!1;break}if(null!==i&&i>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,i),t=!1;break}i=a}if(void 0!==e&&Fl.isTypedArray(e))for(o=0,n=e.length;o!==n;++o)if(r=e[o],isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,r),t=!1;break}return t},optimize:function(){for(var t=Fl.arraySlice(this.times),e=Fl.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),i=1,o=t.length-1,a=1;a<o;++a){var s=!1,l=t[a];if(l!==t[a+1]&&(1!==a||l!==l[0]))if(r)s=!0;else{var c=a*n,u=c-n,h=c+n;for(l=0;l!==n;++l){var p=e[c+l];if(p!==e[u+l]||p!==e[h+l]){s=!0;break}}}if(s){if(a!==i)for(t[i]=t[a],s=a*n,c=i*n,l=0;l!==n;++l)e[c+l]=e[s+l];++i}}if(0<o){for(t[i]=t[o],s=o*n,c=i*n,l=0;l!==n;++l)e[c+l]=e[s+l];++i}return i!==t.length?(this.times=Fl.arraySlice(t,0,i),this.values=Fl.arraySlice(e,0,i*n)):(this.times=t,this.values=e),this},clone:function(){var t=Fl.arraySlice(this.times,0),e=Fl.arraySlice(this.values,0);return t=new this.constructor(this.name,t,e),t.createInterpolant=this.createInterpolant,t}}),zr.prototype=Object.assign(Object.create(Fr.prototype),{constructor:zr,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Br.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Br,ValueTypeName:"color"}),Ur.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Ur,ValueTypeName:"number"}),jr.prototype=Object.assign(Object.create(Or.prototype),{constructor:jr,interpolate_:function(t,e,n,r){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;for(t*=a,e=(n-e)/(r-e),n=t+a;t!==n;t+=4)l.slerpFlat(i,0,o,t-a,o,t,e);return i}}),Gr.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Gr,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new jr(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Vr.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Vr,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Hr.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Hr,ValueTypeName:"vector"}),Object.assign(Wr,{parse:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,o=n.length;i!==o;++i)e.push(Xr(n[i]).scale(r));return new Wr(t.name,t.duration,e,t.blendMode)},toJSON:function(t){var e=[],n=t.tracks;t={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(var r=0,i=n.length;r!==i;++r)e.push(Fr.toJSON(n[r]));return t},CreateFromMorphTargetSequence:function(t,e,n,r){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],l=[];s.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);var c=Fl.getKeyframeOrder(s);s=Fl.sortedArray(s,1,c),l=Fl.sortedArray(l,1,c),r||0!==s[0]||(s.push(i),l.push(l[0])),o.push(new Ur(".morphTargetInfluences["+e[a].name+"]",s,l).scale(1/n))}return new Wr(t,-1,o)},findByName:function(t,e){var n=t;for(Array.isArray(t)||(n=t.geometry&&t.geometry.animations||t.animations),t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],l=s.name.match(i);if(l&&1<l.length){var c=l[1];(l=r[c])||(r[c]=l=[]),l.push(s)}}for(c in t=[],r)t.push(Wr.CreateFromMorphTargetSequence(c,r[c],e,n));return t},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var n=function(t,e,n,r,i){if(0!==n.length){var o=[],a=[];Fl.flattenJSON(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.blendMode;t=t.hierarchy||[];for(var l=0;l<t.length;l++){var c=t[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){o={};for(var u=0;u<c.length;u++)if(c[u].morphTargets)for(var h=0;h<c[u].morphTargets.length;h++)o[c[u].morphTargets[h]]=-1;for(var p in o){var d=[],f=[];for(h=0;h!==c[u].morphTargets.length;++h){var m=c[u];d.push(m.time),f.push(m.morphTarget===p?1:0)}r.push(new Ur(".morphTargetInfluence["+p+"]",d,f))}o=o.length*(a||1)}else u=".bones["+e[l].name+"]",n(Hr,u+".position",c,"pos",r),n(Gr,u+".quaternion",c,"rot",r),n(Hr,u+".scale",c,"scl",r)}return 0===r.length?null:new Wr(i,o,r,s)}}),Object.assign(Wr.prototype,{resetDuration:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Wr(this.name,this.duration,t,this.blendMode)}});var zl={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Bl=new Zr;Object.assign(Yr.prototype,{load:function(){},loadAsync:function(t,e){var n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});var Ul={};$r.prototype=Object.assign(Object.create(Yr.prototype),{constructor:$r,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=zl.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0===Ul[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){n=a[1];var s=!!a[2];a=a[3],a=decodeURIComponent(a),s&&(a=atob(a));try{var l=(this.responseType||"").toLowerCase();switch(l){case"arraybuffer":case"blob":var c=new Uint8Array(a.length);for(s=0;s<a.length;s++)c[s]=a.charCodeAt(s);var u="blob"===l?new Blob([c.buffer],{type:n}):c.buffer;break;case"document":u=(new DOMParser).parseFromString(a,n);break;case"json":u=JSON.parse(a);break;default:u=a}setTimeout((function(){e&&e(u),i.manager.itemEnd(t)}),0)}catch(p){setTimeout((function(){r&&r(p),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{Ul[t]=[],Ul[t].push({onLoad:e,onProgress:n,onError:r});var h=new XMLHttpRequest;for(s in h.open("GET",t,!0),h.addEventListener("load",(function(e){var n=this.response,r=Ul[t];if(delete Ul[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),zl.add(t,n);for(var o=0,a=r.length;o<a;o++){var s=r[o];s.onLoad&&s.onLoad(n)}}else{for(o=0,a=r.length;o<a;o++)s=r[o],s.onError&&s.onError(e);i.manager.itemError(t)}i.manager.itemEnd(t)}),!1),h.addEventListener("progress",(function(e){for(var n=Ul[t],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(e)}}),!1),h.addEventListener("error",(function(e){var n=Ul[t];delete Ul[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),h.addEventListener("abort",(function(e){var n=Ul[t];delete Ul[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(h.responseType=this.responseType),void 0!==this.withCredentials&&(h.withCredentials=this.withCredentials),h.overrideMimeType&&h.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)h.setRequestHeader(s,this.requestHeader[s]);h.send(null)}return i.manager.itemStart(t),h}Ul[t].push({onLoad:e,onProgress:n,onError:r})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Jr.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Jr,load:function(t,e,n,r){var i=this,o=new $r(i.manager);o.setPath(i.path),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)},parse:function(t){for(var e=[],n=0;n<t.length;n++){var r=Wr.parse(t[n]);e.push(r)}return e}}),Kr.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Kr,load:function(t,e,n,r){function i(i){l.load(t[i],(function(t){t=o.parse(t,!0),a[i]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},c+=1,6===c&&(1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,e&&e(s))}),n,r)}var o=this,a=[],s=new dn;s.image=a;var l=new $r(this.manager);if(l.setPath(this.path),l.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,u=0,h=t.length;u<h;++u)i(u);else l.load(t,(function(t){if(t=o.parse(t,!0),t.isCubemap)for(var n=t.mipmaps.length/t.mipmapCount,r=0;r<n;r++){a[r]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)a[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+i]),a[r].format=t.format,a[r].width=t.width,a[r].height=t.height}else s.image.width=t.width,s.image.height=t.height,s.mipmaps=t.mipmaps;1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,e&&e(s)}),n,r);return s}}),Qr.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Qr,load:function(t,e,n,r){var i=this,o=new K,a=new $r(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(t,(function(t){(t=i.parse(t))&&(void 0!==t.image?o.image=t.image:void 0!==t.data&&(o.image.width=t.width,o.image.height=t.height,o.image.data=t.data),o.wrapS=void 0!==t.wrapS?t.wrapS:1001,o.wrapT=void 0!==t.wrapT?t.wrapT:1001,o.magFilter=void 0!==t.magFilter?t.magFilter:1006,o.minFilter=void 0!==t.minFilter?t.minFilter:1006,o.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(o.format=t.format),void 0!==t.type&&(o.type=t.type),void 0!==t.mipmaps&&(o.mipmaps=t.mipmaps,o.minFilter=1008),1===t.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,e&&e(o,t))}),n,r),o}}),ti.prototype=Object.assign(Object.create(Yr.prototype),{constructor:ti,load:function(t,e,n,r){function i(){l.removeEventListener("load",i,!1),l.removeEventListener("error",o,!1),zl.add(t,this),e&&e(this),a.manager.itemEnd(t)}function o(e){l.removeEventListener("load",i,!1),l.removeEventListener("error",o,!1),r&&r(e),a.manager.itemError(t),a.manager.itemEnd(t)}void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var a=this,s=zl.get(t);if(void 0!==s)return a.manager.itemStart(t),setTimeout((function(){e&&e(s),a.manager.itemEnd(t)}),0),s;var l=document.createElementNS("http://www.w3.org/1999/xhtml","img");return l.addEventListener("load",i,!1),l.addEventListener("error",o,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),a.manager.itemStart(t),l.src=t,l}}),ei.prototype=Object.assign(Object.create(Yr.prototype),{constructor:ei,load:function(t,e,n,r){function i(n){a.load(t[n],(function(t){o.images[n]=t,s++,6===s&&(o.needsUpdate=!0,e&&e(o))}),void 0,r)}var o=new mt,a=new ti(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var s=0;for(n=0;n<t.length;++n)i(n);return o}}),ni.prototype=Object.assign(Object.create(Yr.prototype),{constructor:ni,load:function(t,e,n,r){var o=new i,a=new ti(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(n){o.image=n,n=0<t.search(/\.jpe?g($|\?)/i)||0===t.search(/^data:image\/jpeg/),o.format=n?1022:1023,o.needsUpdate=!0,void 0!==e&&e(o)}),n,r),o}}),Object.assign(ri.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){return t=this.getUtoTmapping(t),this.getPoint(t,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n=[],r=this.getPoint(0),i=0;for(n.push(0),e=1;e<=t;e++){var o=this.getPoint(e/t);i+=o.distanceTo(r),n.push(i),r=o}return this.cacheArcLengths=n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n=this.getLengths(),r=n.length;e=e||t*n[r-1];for(var i,o=0,a=r-1;o<=a;)if(t=Math.floor(o+(a-o)/2),i=n[t]-e,0>i)o=t+1;else{if(!(0<i)){a=t;break}a=t-1}return t=a,n[t]===e?t/(r-1):(o=n[t],(t+(e-o)/(n[t+1]-o))/(r-1))},getTangent:function(t,e){var r=t-1e-4;return t+=1e-4,0>r&&(r=0),1<t&&(t=1),r=this.getPoint(r),t=this.getPoint(t),e=e||(r.isVector2?new n:new c),e.copy(t).sub(r).normalize(),e},getTangentAt:function(t,e){return t=this.getUtoTmapping(t),this.getTangent(t,e)},computeFrenetFrames:function(t,e){var n,r=new c,i=[],o=[],a=[],s=new c,l=new u;for(n=0;n<=t;n++){var h=n/t;i[n]=this.getTangentAt(h,new c),i[n].normalize()}o[0]=new c,a[0]=new c,n=Number.MAX_VALUE,h=Math.abs(i[0].x);var p=Math.abs(i[0].y),d=Math.abs(i[0].z);for(h<=n&&(n=h,r.set(1,0,0)),p<=n&&(n=p,r.set(0,1,0)),d<=n&&r.set(0,0,1),s.crossVectors(i[0],r).normalize(),o[0].crossVectors(i[0],s),a[0].crossVectors(i[0],o[0]),n=1;n<=t;n++)o[n]=o[n-1].clone(),a[n]=a[n-1].clone(),s.crossVectors(i[n-1],i[n]),s.length()>Number.EPSILON&&(s.normalize(),r=Math.acos(Vo.clamp(i[n-1].dot(i[n]),-1,1)),o[n].applyMatrix4(l.makeRotationAxis(s,r))),a[n].crossVectors(i[n],o[n]);if(!0===e)for(r=Math.acos(Vo.clamp(o[0].dot(o[t]),-1,1)),r/=t,0<i[0].dot(s.crossVectors(o[0],o[t]))&&(r=-r),n=1;n<=t;n++)o[n].applyMatrix4(l.makeRotationAxis(i[n],r*n)),a[n].crossVectors(i[n],o[n]);return{tangents:i,normals:o,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),ii.prototype=Object.create(ri.prototype),ii.prototype.constructor=ii,ii.prototype.isEllipseCurve=!0,ii.prototype.getPoint=function(t,e){e=e||new n;for(var r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;0>i;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i=i===r?-r:i-r),r=this.aStartAngle+t*i,t=this.aX+this.xRadius*Math.cos(r);var a=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(r=Math.cos(this.aRotation),i=Math.sin(this.aRotation),o=t-this.aX,a-=this.aY,t=o*r-a*i+this.aX,a=o*i+a*r+this.aY),e.set(t,a)},ii.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ii.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},ii.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},oi.prototype=Object.create(ii.prototype),oi.prototype.constructor=oi,oi.prototype.isArcCurve=!0;var jl=new c,Gl=new ai,Vl=new ai,Hl=new ai;si.prototype=Object.create(ri.prototype),si.prototype.constructor=si,si.prototype.isCatmullRomCurve3=!0,si.prototype.getPoint=function(t,e){e=e||new c;var n=this.points,r=n.length;t*=r-(this.closed?0:1);var i=Math.floor(t);if(t-=i,this.closed?i+=0<i?0:(Math.floor(Math.abs(i)/r)+1)*r:0===t&&i===r-1&&(i=r-2,t=1),this.closed||0<i)var o=n[(i-1)%r];else jl.subVectors(n[0],n[1]).add(n[0]),o=jl;var a=n[i%r],s=n[(i+1)%r];if(this.closed||i+2<r?n=n[(i+2)%r]:(jl.subVectors(n[r-1],n[r-2]).add(n[r-1]),n=jl),"centripetal"===this.curveType||"chordal"===this.curveType){var l="chordal"===this.curveType?.5:.25;r=Math.pow(o.distanceToSquared(a),l),i=Math.pow(a.distanceToSquared(s),l),l=Math.pow(s.distanceToSquared(n),l),1e-4>i&&(i=1),1e-4>r&&(r=i),1e-4>l&&(l=i),Gl.initNonuniformCatmullRom(o.x,a.x,s.x,n.x,r,i,l),Vl.initNonuniformCatmullRom(o.y,a.y,s.y,n.y,r,i,l),Hl.initNonuniformCatmullRom(o.z,a.z,s.z,n.z,r,i,l)}else"catmullrom"===this.curveType&&(Gl.initCatmullRom(o.x,a.x,s.x,n.x,this.tension),Vl.initCatmullRom(o.y,a.y,s.y,n.y,this.tension),Hl.initCatmullRom(o.z,a.z,s.z,n.z,this.tension));return e.set(Gl.calc(t),Vl.calc(t),Hl.calc(t)),e},si.prototype.copy=function(t){ri.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},si.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},si.prototype.fromJSON=function(t){ri.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push((new c).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},hi.prototype=Object.create(ri.prototype),hi.prototype.constructor=hi,hi.prototype.isCubicBezierCurve=!0,hi.prototype.getPoint=function(t,e){e=e||new n;var r=this.v0,i=this.v1,o=this.v2,a=this.v3;return e.set(ui(t,r.x,i.x,o.x,a.x),ui(t,r.y,i.y,o.y,a.y)),e},hi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},hi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},hi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},pi.prototype=Object.create(ri.prototype),pi.prototype.constructor=pi,pi.prototype.isCubicBezierCurve3=!0,pi.prototype.getPoint=function(t,e){e=e||new c;var n=this.v0,r=this.v1,i=this.v2,o=this.v3;return e.set(ui(t,n.x,r.x,i.x,o.x),ui(t,n.y,r.y,i.y,o.y),ui(t,n.z,r.z,i.z,o.z)),e},pi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},pi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},pi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},di.prototype=Object.create(ri.prototype),di.prototype.constructor=di,di.prototype.isLineCurve=!0,di.prototype.getPoint=function(t,e){return e=e||new n,1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},di.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},di.prototype.getTangent=function(t,e){return t=e||new n,t.copy(this.v2).sub(this.v1).normalize()},di.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},di.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},di.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},fi.prototype=Object.create(ri.prototype),fi.prototype.constructor=fi,fi.prototype.isLineCurve3=!0,fi.prototype.getPoint=function(t,e){return e=e||new c,1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},fi.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},fi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},fi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},fi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},mi.prototype=Object.create(ri.prototype),mi.prototype.constructor=mi,mi.prototype.isQuadraticBezierCurve=!0,mi.prototype.getPoint=function(t,e){e=e||new n;var r=this.v0,i=this.v1,o=this.v2;return e.set(ci(t,r.x,i.x,o.x),ci(t,r.y,i.y,o.y)),e},mi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},mi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},mi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},gi.prototype=Object.create(ri.prototype),gi.prototype.constructor=gi,gi.prototype.isQuadraticBezierCurve3=!0,gi.prototype.getPoint=function(t,e){e=e||new c;var n=this.v0,r=this.v1,i=this.v2;return e.set(ci(t,n.x,r.x,i.x),ci(t,n.y,r.y,i.y),ci(t,n.z,r.z,i.z)),e},gi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},gi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},gi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},yi.prototype=Object.create(ri.prototype),yi.prototype.constructor=yi,yi.prototype.isSplineCurve=!0,yi.prototype.getPoint=function(t,e){e=e||new n;var r=this.points,i=(r.length-1)*t;t=Math.floor(i),i-=t;var o=r[0===t?t:t-1],a=r[t],s=r[t>r.length-2?r.length-1:t+1];return r=r[t>r.length-3?r.length-1:t+2],e.set(li(i,o.x,a.x,s.x,r.x),li(i,o.y,a.y,s.y,r.y)),e},yi.prototype.copy=function(t){ri.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++)this.points.push(t.points[e].clone());return this},yi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++)t.points.push(this.points[e].toArray());return t},yi.prototype.fromJSON=function(t){ri.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push((new n).fromArray(i))}return this};var Wl=Object.freeze({__proto__:null,ArcCurve:oi,CatmullRomCurve3:si,CubicBezierCurve:hi,CubicBezierCurve3:pi,EllipseCurve:ii,LineCurve:di,LineCurve3:fi,QuadraticBezierCurve:mi,QuadraticBezierCurve3:gi,SplineCurve:yi});vi.prototype=Object.assign(Object.create(ri.prototype),{constructor:vi,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new di(e,t))},getPoint:function(t){var e=t*this.getLength(),n=this.getCurveLengths();for(t=0;t<n.length;){if(n[t]>=e)return e=n[t]-e,t=this.curves[t],n=t.getLength(),t.getPointAt(0===n?0:1-e/n);t++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,n=[],r=0,i=this.curves;r<i.length;r++){var o=i[r];o=o.getPoints(o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t);for(var a=0;a<o.length;a++){var s=o[a];e&&e.equals(s)||(n.push(s),e=s)}}return this.autoClose&&1<n.length&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(t){ri.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=ri.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){ri.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push((new Wl[r.type]).fromJSON(r))}return this}}),_i.prototype=Object.assign(Object.create(vi.prototype),{constructor:_i,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var r=new di(this.currentPoint.clone(),new n(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,r,i){return t=new mi(this.currentPoint.clone(),new n(t,e),new n(r,i)),this.curves.push(t),this.currentPoint.set(r,i),this},bezierCurveTo:function(t,e,r,i,o,a){return t=new hi(this.currentPoint.clone(),new n(t,e),new n(r,i),new n(o,a)),this.curves.push(t),this.currentPoint.set(o,a),this},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t);return e=new yi(e),this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,o){return this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,n,r,i,o),this},absarc:function(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this},ellipse:function(t,e,n,r,i,o,a,s){return this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,n,r,i,o,a,s),this},absellipse:function(t,e,n,r,i,o,a,s){return t=new ii(t,e,n,r,i,o,a,s),0<this.curves.length&&(e=t.getPoint(0),e.equals(this.currentPoint)||this.lineTo(e.x,e.y)),this.curves.push(t),t=t.getPoint(1),this.currentPoint.copy(t),this},copy:function(t){return vi.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=vi.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return vi.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),xi.prototype=Object.assign(Object.create(_i.prototype),{constructor:xi,getPointsHoles:function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){_i.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=_i.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){_i.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push((new _i).fromJSON(r))}return this}}),bi.prototype=Object.assign(Object.create(d.prototype),{constructor:bi,isLight:!0,copy:function(t){return d.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){return t=d.prototype.toJSON.call(this,t),t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),wi.prototype=Object.assign(Object.create(bi.prototype),{constructor:wi,isHemisphereLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Mi.prototype,{_projScreenMatrix:new u,_lightPositionWorld:new c,_lookTarget:new c,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Ei.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Ei,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,n=2*Vo.RAD2DEG*t.angle,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),Mi.prototype.updateMatrices.call(this,t)}}),Si.prototype=Object.assign(Object.create(bi.prototype),{constructor:Si,isSpotLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Ti.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Ti,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);var n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),Ai.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ai,isPointLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Ci.prototype=Object.assign(Object.create(Z.prototype),{constructor:Ci,isOrthographicCamera:!0,copy:function(t,e){return Z.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t;n+=t,t=r+e,e=r-e,null!==this.view&&this.view.enabled&&(r=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i+=r*this.view.offsetX,n=i+r*this.view.width,t-=e*this.view.offsetY,e=t-e*this.view.height),this.projectionMatrix.makeOrthographic(i,n,t,e,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){return t=d.prototype.toJSON.call(this,t),t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Li.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Li,isDirectionalLightShadow:!0,updateMatrices:function(t){Mi.prototype.updateMatrices.call(this,t)}}),Ii.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ii,isDirectionalLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Pi.prototype=Object.assign(Object.create(bi.prototype),{constructor:Pi,isAmbientLight:!0}),Ri.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ri,isRectAreaLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){return t=bi.prototype.toJSON.call(this,t),t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(Oi.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;9>e;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;9>t;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var n=t.x,r=t.y;t=t.z;var i=this.coefficients;return e.copy(i[0]).multiplyScalar(.282095),e.addScaledVector(i[1],.488603*r),e.addScaledVector(i[2],.488603*t),e.addScaledVector(i[3],.488603*n),e.addScaledVector(i[4],1.092548*n*r),e.addScaledVector(i[5],1.092548*r*t),e.addScaledVector(i[6],.315392*(3*t*t-1)),e.addScaledVector(i[7],1.092548*n*t),e.addScaledVector(i[8],.546274*(n*n-r*r)),e},getIrradianceAt:function(t,e){var n=t.x,r=t.y;t=t.z;var i=this.coefficients;return e.copy(i[0]).multiplyScalar(.886227),e.addScaledVector(i[1],1.023328*r),e.addScaledVector(i[2],1.023328*t),e.addScaledVector(i[3],1.023328*n),e.addScaledVector(i[4],.858086*n*r),e.addScaledVector(i[5],.858086*r*t),e.addScaledVector(i[6],.743125*t*t-.247708),e.addScaledVector(i[7],.858086*n*t),e.addScaledVector(i[8],.429043*(n*n-r*r)),e},add:function(t){for(var e=0;9>e;e++)this.coefficients[e].add(t.coefficients[e]);return this},addScaledSH:function(t,e){for(var n=0;9>n;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},scale:function(t){for(var e=0;9>e;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var n=0;9>n;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},equals:function(t){for(var e=0;9>e;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);for(var n=this.coefficients,r=0;9>r;r++)n[r].fromArray(t,e+3*r);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var n=this.coefficients,r=0;9>r;r++)n[r].toArray(t,e+3*r);return t}}),Object.assign(Oi,{getBasisAt:function(t,e){var n=t.x,r=t.y;t=t.z,e[0]=.282095,e[1]=.488603*r,e[2]=.488603*t,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*t,e[6]=.315392*(3*t*t-1),e[7]=1.092548*n*t,e[8]=.546274*(n*n-r*r)}}),Di.prototype=Object.assign(Object.create(bi.prototype),{constructor:Di,isLightProbe:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){return t=bi.prototype.toJSON.call(this,t),t.object.sh=this.sh.toArray(),t}}),Ni.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Ni,load:function(t,e,n,r){var i=this,o=new $r(i.manager);o.setPath(i.path),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)},parse:function(t){function e(t){return void 0===i[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),i[t]}var i=this.textures,a=new kl[t.type];if(void 0!==t.uuid&&(a.uuid=t.uuid),void 0!==t.name&&(a.name=t.name),void 0!==t.color&&a.color.setHex(t.color),void 0!==t.roughness&&(a.roughness=t.roughness),void 0!==t.metalness&&(a.metalness=t.metalness),void 0!==t.sheen&&(a.sheen=(new b).setHex(t.sheen)),void 0!==t.emissive&&a.emissive.setHex(t.emissive),void 0!==t.specular&&a.specular.setHex(t.specular),void 0!==t.shininess&&(a.shininess=t.shininess),void 0!==t.clearcoat&&(a.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(a.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(a.fog=t.fog),void 0!==t.flatShading&&(a.flatShading=t.flatShading),void 0!==t.blending&&(a.blending=t.blending),void 0!==t.combine&&(a.combine=t.combine),void 0!==t.side&&(a.side=t.side),void 0!==t.opacity&&(a.opacity=t.opacity),void 0!==t.transparent&&(a.transparent=t.transparent),void 0!==t.alphaTest&&(a.alphaTest=t.alphaTest),void 0!==t.depthTest&&(a.depthTest=t.depthTest),void 0!==t.depthWrite&&(a.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(a.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(a.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(a.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(a.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(a.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(a.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(a.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(a.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(a.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(a.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(a.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(a.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(a.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(a.rotation=t.rotation),1!==t.linewidth&&(a.linewidth=t.linewidth),void 0!==t.dashSize&&(a.dashSize=t.dashSize),void 0!==t.gapSize&&(a.gapSize=t.gapSize),void 0!==t.scale&&(a.scale=t.scale),void 0!==t.polygonOffset&&(a.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(a.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(a.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(a.skinning=t.skinning),void 0!==t.morphTargets&&(a.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(a.morphNormals=t.morphNormals),void 0!==t.dithering&&(a.dithering=t.dithering),void 0!==t.vertexTangents&&(a.vertexTangents=t.vertexTangents),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.toneMapped&&(a.toneMapped=t.toneMapped),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.vertexColors&&(a.vertexColors="number"===typeof t.vertexColors?0<t.vertexColors:t.vertexColors),void 0!==t.uniforms)for(var s in t.uniforms){var l=t.uniforms[s];switch(a.uniforms[s]={},l.type){case"t":a.uniforms[s].value=e(l.value);break;case"c":a.uniforms[s].value=(new b).setHex(l.value);break;case"v2":a.uniforms[s].value=(new n).fromArray(l.value);break;case"v3":a.uniforms[s].value=(new c).fromArray(l.value);break;case"v4":a.uniforms[s].value=(new o).fromArray(l.value);break;case"m3":a.uniforms[s].value=(new r).fromArray(l.value);case"m4":a.uniforms[s].value=(new u).fromArray(l.value);break;default:a.uniforms[s].value=l.value}}if(void 0!==t.defines&&(a.defines=t.defines),void 0!==t.vertexShader&&(a.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(a.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var h in t.extensions)a.extensions[h]=t.extensions[h];return void 0!==t.shading&&(a.flatShading=1===t.shading),void 0!==t.size&&(a.size=t.size),void 0!==t.sizeAttenuation&&(a.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(a.map=e(t.map)),void 0!==t.matcap&&(a.matcap=e(t.matcap)),void 0!==t.alphaMap&&(a.alphaMap=e(t.alphaMap)),void 0!==t.bumpMap&&(a.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(a.bumpScale=t.bumpScale),void 0!==t.normalMap&&(a.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(a.normalMapType=t.normalMapType),void 0!==t.normalScale&&(s=t.normalScale,!1===Array.isArray(s)&&(s=[s,s]),a.normalScale=(new n).fromArray(s)),void 0!==t.displacementMap&&(a.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(a.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(a.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(a.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(a.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(a.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(a.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(a.specularMap=e(t.specularMap)),void 0!==t.envMap&&(a.envMap=e(t.envMap)),void 0!==t.envMapIntensity&&(a.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(a.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(a.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(a.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(a.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(a.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(a.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(a.gradientMap=e(t.gradientMap)),void 0!==t.clearcoatMap&&(a.clearcoatMap=e(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(a.clearcoatRoughnessMap=e(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(a.clearcoatNormalMap=e(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(a.clearcoatNormalScale=(new n).fromArray(t.clearcoatNormalScale)),a},setTextures:function(t){return this.textures=t,this}});var ql={decodeText:function(t){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(i){return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};ki.prototype=Object.assign(Object.create(U.prototype),{constructor:ki,isInstancedBufferGeometry:!0,copy:function(t){return U.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=U.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),Fi.prototype=Object.assign(Object.create(C.prototype),{constructor:Fi,isInstancedBufferAttribute:!0,copy:function(t){return C.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=C.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),zi.prototype=Object.assign(Object.create(Yr.prototype),{constructor:zi,load:function(t,e,n,r){var i=this,o=new $r(i.manager);o.setPath(i.path),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)},parse:function(t){var e=t.isInstancedBufferGeometry?new ki:new U,n=t.data.index;if(void 0!==n){var r=new Xl[n.type](n.array);e.setIndex(new C(r,1))}for(var i in n=t.data.attributes,n){var o=n[i];r=new Xl[o.type](o.array),r=new(o.isInstancedBufferAttribute?Fi:C)(r,o.itemSize,o.normalized),void 0!==o.name&&(r.name=o.name),e.setAttribute(i,r)}var a=t.data.morphAttributes;if(a)for(i in a){var s=a[i],l=[];n=0;for(var u=s.length;n<u;n++)o=s[n],r=new Xl[o.type](o.array),r=new C(r,o.itemSize,o.normalized),void 0!==o.name&&(r.name=o.name),l.push(r);e.morphAttributes[i]=l}if(t.data.morphTargetsRelative&&(e.morphTargetsRelative=!0),i=t.data.groups||t.data.drawcalls||t.data.offsets,void 0!==i)for(n=0,o=i.length;n!==o;++n)r=i[n],e.addGroup(r.start,r.count,r.materialIndex);return n=t.data.boundingSphere,void 0!==n&&(i=new c,void 0!==n.center&&i.fromArray(n.center),e.boundingSphere=new y(i,n.radius)),t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var Xl={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Bi.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Bi,load:function(t,e,n,r){var i=this,o=""===this.path?ql.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o,o=new $r(i.manager),o.setPath(this.path),o.load(t,(function(n){var o=null;try{o=JSON.parse(n)}catch(a){return void 0!==r&&r(a),void console.error("THREE:ObjectLoader: Can't parse "+t+".",a.message)}n=o.metadata,void 0===n||void 0===n.type||"geometry"===n.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+t):i.parse(o,e)}),n,r)},parse:function(t,e){var n=this.parseShape(t.shapes);n=this.parseGeometries(t.geometries,n);var r=this.parseImages(t.images,(function(){void 0!==e&&e(i)}));r=this.parseTextures(t.textures,r),r=this.parseMaterials(t.materials,r);var i=this.parseObject(t.object,n,r);return t.animations&&(i.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0===e||e(i),i},parseShape:function(t){var e={};if(void 0!==t)for(var n=0,r=t.length;n<r;n++){var i=(new xi).fromJSON(t[n]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var n={};if(void 0!==t)for(var r=new zi,i=0,o=t.length;i<o;i++){var a=t[i];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":var s=new Nl[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Nl[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Nl[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Nl[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Nl[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Nl[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Nl[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Nl[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Nl[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Nl[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Nl[a.type]((new Wl[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Nl[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Nl[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":s=[];for(var l=0,c=a.shapes.length;l<c;l++){var u=e[a.shapes[l]];s.push(u)}s=new Nl[a.type](s,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(s=[],l=0,c=a.shapes.length;l<c;l++)u=e[a.shapes[l]],s.push(u);l=a.options.extrudePath,void 0!==l&&(a.options.extrudePath=(new Wl[l.type]).fromJSON(l)),s=new Nl[a.type](s,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}return n},parseMaterials:function(t,e){var n={},r={};if(void 0!==t){var i=new Ni;i.setTextures(e),e=0;for(var o=t.length;e<o;e++){var a=t[e];if("MultiMaterial"===a.type){for(var s=[],l=0;l<a.materials.length;l++){var c=a.materials[l];void 0===n[c.uuid]&&(n[c.uuid]=i.parse(c)),s.push(n[c.uuid])}r[a.uuid]=s}else void 0===n[a.uuid]&&(n[a.uuid]=i.parse(a)),r[a.uuid]=n[a.uuid]}}return r},parseAnimations:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=Wr.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),e.push(i)}return e},parseImages:function(t,e){function n(t){return r.manager.itemStart(t),o.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}var r=this,i={};if(void 0!==t&&0<t.length){e=new Zr(e);var o=new ti(e);o.setCrossOrigin(this.crossOrigin),e=0;for(var a=t.length;e<a;e++){var s=t[e],l=s.url;if(Array.isArray(l)){i[s.uuid]=[];for(var c=0,u=l.length;c<u;c++){var h=l[c];h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:r.resourcePath+h,i[s.uuid].push(n(h))}}else h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:r.resourcePath+s.url,i[s.uuid]=n(h)}}return i},parseTextures:function(t,e){function n(t,e){return"number"===typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var r={};if(void 0!==t)for(var o=0,a=t.length;o<a;o++){var s=t[o];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var l=Array.isArray(e[s.image])?new mt(e[s.image]):new i(e[s.image]);l.needsUpdate=!0,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,Zl)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Yl),l.wrapT=n(s.wrap[1],Yl)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,$l)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,$l)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),r[s.uuid]=l}return r},parseObject:function(t,e,n){function r(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function i(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,i=t.length;r<i;r++){var o=t[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(n[o])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":var o=new f;void 0!==t.background&&Number.isInteger(t.background)&&(o.background=new b(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?o.fog=new Xe(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(o.fog=new qe(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":o=new Y(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(o.focus=t.focus),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.filmGauge&&(o.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(o.filmOffset=t.filmOffset),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new Ci(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"AmbientLight":o=new Pi(t.color,t.intensity);break;case"DirectionalLight":o=new Ii(t.color,t.intensity);break;case"PointLight":o=new Ai(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new Ri(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new Si(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new wi(t.color,t.groundColor,t.intensity);break;case"LightProbe":o=(new Di).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":o=r(t.geometry);var a=i(t.material);o=new j(o,a);break;case"InstancedMesh":o=r(t.geometry),a=i(t.material);var s=t.instanceMatrix;o=new rn(o,a,t.count),o.instanceMatrix=new C(new Float32Array(s.array),16);break;case"LOD":o=new Qe;break;case"Line":o=new an(r(t.geometry),i(t.material),t.mode);break;case"LineLoop":o=new ln(r(t.geometry),i(t.material));break;case"LineSegments":o=new sn(r(t.geometry),i(t.material));break;case"PointCloud":case"Points":o=new un(r(t.geometry),i(t.material));break;case"Sprite":o=new Je(i(t.material));break;case"Group":o=new je;break;default:o=new d}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(o.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(o.matrixAutoUpdate=t.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.quaternion&&o.quaternion.fromArray(t.quaternion),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(o.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(o.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&o.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(o.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.frustumCulled&&(o.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(o.renderOrder=t.renderOrder),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.layers&&(o.layers.mask=t.layers),void 0!==t.children)for(s=t.children,a=0;a<s.length;a++)o.add(this.parseObject(s[a],e,n));if("LOD"===t.type)for(void 0!==t.autoUpdate&&(o.autoUpdate=t.autoUpdate),t=t.levels,s=0;s<t.length;s++){a=t[s];var l=o.getObjectByProperty("uuid",a.object);void 0!==l&&o.addLevel(l,a.distance)}return o}});var Zl={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Yl={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},$l={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};Ui.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Ui,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=zl.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;fetch(t).then((function(t){return t.blob()})).then((function(t){return void 0===i.options?createImageBitmap(t):createImageBitmap(t,i.options)})).then((function(n){zl.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(ji.prototype,{moveTo:function(t,e){return this.currentPath=new _i,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,i,o){return this.currentPath.bezierCurveTo(t,e,n,r,i,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],o=new xi;o.curves=i.curves,e.push(o)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=e[i],s=e[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(a=e[o],l=-l,s=e[i],c=-c),!(t.y<a.y||t.y>s.y))if(t.y===a.y){if(t.x===a.x)return!0}else{if(i=c*(t.x-a.x)-l*(t.y-a.y),0===i)return!0;0>i||(r=!r)}}else if(t.y===a.y&&(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x))return!0}return r}var i=Ol.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);if(e=[],1===o.length){var a=o[0],s=new xi;return s.curves=a.curves,e.push(s),e}var l=!i(o[0].getPoints());l=t?!l:l,s=[];var c=[],u=[],h=0;c[h]=void 0,u[h]=[];for(var p=0,d=o.length;p<d;p++){a=o[p];var f=a.getPoints(),m=i(f);(m=t?!m:m)?(!l&&c[h]&&h++,c[h]={s:new xi,p:f},c[h].s.curves=a.curves,l&&h++,u[h]=[]):u[h].push({h:a,p:f[0]})}if(!c[0])return n(o);if(1<c.length){for(p=!1,t=[],i=0,o=c.length;i<o;i++)s[i]=[];for(i=0,o=c.length;i<o;i++)for(a=u[i],m=0;m<a.length;m++){for(l=a[m],h=!0,f=0;f<c.length;f++)r(l.p,c[f].p)&&(i!==f&&t.push({froms:i,tos:f,hole:m}),h?(h=!1,s[f].push(l)):p=!0);h&&s[i].push(l)}0<t.length&&(p||(u=s))}for(p=0,i=c.length;p<i;p++)for(s=c[p].s,e.push(s),t=u[p],o=0,a=t.length;o<a;o++)s.holes.push(t[o].h);return e}}),Object.assign(Gi.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);var n=[],r=e;e=this.data;var i=Array.from?Array.from(t):String(t).split("");r/=e.resolution;var o=(e.boundingBox.yMax-e.boundingBox.yMin+e.underlineThickness)*r;t=[];for(var a=0,s=0,l=0;l<i.length;l++){var c=i[l];if("\n"===c)a=0,s-=o;else{var u=c;c=r;var h=a,p=s,d=e,f=d.glyphs[u]||d.glyphs["?"];if(f){if(u=new ji,f.o){d=f._cachedOutline||(f._cachedOutline=f.o.split(" "));for(var m=0,g=d.length;m<g;)switch(d[m++]){case"m":var y=d[m++]*c+h,v=d[m++]*c+p;u.moveTo(y,v);break;case"l":y=d[m++]*c+h,v=d[m++]*c+p,u.lineTo(y,v);break;case"q":var _=d[m++]*c+h,x=d[m++]*c+p,b=d[m++]*c+h,w=d[m++]*c+p;u.quadraticCurveTo(b,w,_,x);break;case"b":_=d[m++]*c+h,x=d[m++]*c+p,b=d[m++]*c+h,w=d[m++]*c+p,y=d[m++]*c+h,v=d[m++]*c+p,u.bezierCurveTo(b,w,y,v,_,x)}}c={offsetX:f.ha*c,path:u}}else console.error('THREE.Font: character "'+u+'" does not exists in font family '+d.familyName+"."),c=void 0;a+=c.offsetX,t.push(c.path)}}for(e=0,i=t.length;e<i;e++)Array.prototype.push.apply(n,t[e].toShapes());return n}}),Vi.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Vi,load:function(t,e,n,r){var i=this,o=new $r(this.manager);o.setPath(this.path),o.load(t,(function(t){try{var n=JSON.parse(t)}catch(r){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}t=i.parse(n),e&&e(t)}),n,r)},parse:function(t){return new Gi(t)}});var Jl,Kl={getContext:function(){return void 0===Jl&&(Jl=new(window.AudioContext||window.webkitAudioContext)),Jl},setContext:function(t){Jl=t}};Hi.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Hi,load:function(t,e,n,r){var i=this,o=new $r(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.load(t,(function(n){try{var o=n.slice(0);Kl.getContext().decodeAudioData(o,(function(t){e(t)}))}catch(a){r?r(a):console.error(a),i.manager.itemError(t)}}),n,r)}}),Wi.prototype=Object.assign(Object.create(Di.prototype),{constructor:Wi,isHemisphereLightProbe:!0,copy:function(t){return Di.prototype.copy.call(this,t),this},toJSON:function(t){return Di.prototype.toJSON.call(this,t)}}),qi.prototype=Object.assign(Object.create(Di.prototype),{constructor:qi,isAmbientLightProbe:!0,copy:function(t){return Di.prototype.copy.call(this,t),this},toJSON:function(t){return Di.prototype.toJSON.call(this,t)}});var Ql=new u,tc=new u;Object.assign(Xi.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,o=e.near*Math.tan(Vo.DEG2RAD*e.fov*.5)/e.zoom;tc.elements[12]=-r,Ql.elements[12]=r,r=-o*e.aspect+i;var a=o*e.aspect+i;n.elements[0]=2*e.near/(a-r),n.elements[8]=(a+r)/(a-r),this.cameraL.projectionMatrix.copy(n),r=-o*e.aspect-i,a=o*e.aspect-i,n.elements[0]=2*e.near/(a-r),n.elements[8]=(a+r)/(a-r),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(tc),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Ql)}}),Object.assign(Zi.prototype,{start:function(){this.oldTime=this.startTime=("undefined"===typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"===typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var ec=new c,nc=new l,rc=new c,ic=new c;Yi.prototype=Object.assign(Object.create(d.prototype),{constructor:Yi,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){d.prototype.updateMatrixWorld.call(this,t),t=this.context.listener;var e=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ec,nc,rc),ic.set(0,0,-1).applyQuaternion(nc),t.positionX){var n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ec.x,n),t.positionY.linearRampToValueAtTime(ec.y,n),t.positionZ.linearRampToValueAtTime(ec.z,n),t.forwardX.linearRampToValueAtTime(ic.x,n),t.forwardY.linearRampToValueAtTime(ic.y,n),t.forwardZ.linearRampToValueAtTime(ic.z,n),t.upX.linearRampToValueAtTime(e.x,n),t.upY.linearRampToValueAtTime(e.y,n),t.upZ.linearRampToValueAtTime(e.z,n)}else t.setPosition(ec.x,ec.y,ec.z),t.setOrientation(ic.x,ic.y,ic.z,e.x,e.y,e.z)}}),$i.prototype=Object.assign(Object.create(d.prototype),{constructor:$i,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl)return this._startedAt=this.context.currentTime+t,t=this.context.createBufferSource(),t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect();console.warn("THREE.Audio: this Audio has no playback control.")}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress%=this.duration||this.buffer.duration),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var oc=new c,ac=new l,sc=new c,lc=new c;Ji.prototype=Object.assign(Object.create($i.prototype),{constructor:Ji,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(d.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying)if(this.matrixWorld.decompose(oc,ac,sc),lc.set(0,0,1).applyQuaternion(ac),t=this.panner,t.positionX){var e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(oc.x,e),t.positionY.linearRampToValueAtTime(oc.y,e),t.positionZ.linearRampToValueAtTime(oc.z,e),t.orientationX.linearRampToValueAtTime(lc.x,e),t.orientationY.linearRampToValueAtTime(lc.y,e),t.orientationZ.linearRampToValueAtTime(lc.z,e)}else t.setPosition(oc.x,oc.y,oc.z),t.setOrientation(lc.x,lc.y,lc.z)}}),Object.assign(Ki.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length}}),Object.assign(Qi.prototype,{accumulate:function(t,e){var n=this.buffer,r=this.valueSize;t=t*r+r;var i=this.cumulativeWeight;if(0===i){for(i=0;i!==r;++i)n[t+i]=n[i];i=e}else i+=e,this._mixBufferRegion(n,t,0,e/i,r);this.cumulativeWeight=i},accumulateAdditive:function(t){var e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){var e=this.valueSize,n=this.buffer;t=t*e+e;var r=this.cumulativeWeight,i=this.cumulativeWeightAdditive,o=this.binding;for(this.cumulativeWeightAdditive=this.cumulativeWeight=0,1>r&&this._mixBufferRegion(n,t,e*this._origIndex,1-r,e),0<i&&this._mixBufferRegionAdditive(n,t,this._addIndex*e,1,e),r=e,i=e+e;r!==i;++r)if(n[r]!==n[r+e]){o.setValue(n,t);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,n=e*this._origIndex;this.binding.getValue(t,n);for(var r=e;r!==n;++r)t[r]=t[n+r%e];this._setIdentity(),this.cumulativeWeightAdditive=this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_setAdditiveIdentityNumeric:function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize;t<e;t++)this.buffer[t]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,r,i){if(.5<=r)for(r=0;r!==i;++r)t[e+r]=t[n+r]},_slerp:function(t,e,n,r){l.slerpFlat(t,e,t,e,t,n,r)},_slerpAdditive:function(t,e,n,r,i){i*=this._workIndex,l.multiplyQuaternionsFlat(t,i,t,e,t,n),l.slerpFlat(t,e,t,e,t,i,r)},_lerp:function(t,e,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[n+a]*r}},_lerpAdditive:function(t,e,n,r,i){for(var o=0;o!==i;++o){var a=e+o;t[a]+=t[n+o]*r}}});var cc=/[\[\]\.:\/]/g,uc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",hc=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),pc=/(WCOD+)?/.source.replace("WCOD",uc),dc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),fc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),mc=new RegExp("^"+hc+pc+dc+fc+"$"),gc=["material","materials","bones"];Object.assign(to.prototype,{getValue:function(t,e){this.bind();var n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(eo,{Composite:to,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new eo.Composite(t,e,n):new eo(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(cc,"")},parseTrackName:function(t){var e=mc.exec(t);if(!e)throw Error("PropertyBinding: Cannot parse trackName: "+t);e={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]};var n=e.nodeName&&e.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var r=e.nodeName.substring(n+1);-1!==gc.indexOf(r)&&(e.nodeName=e.nodeName.substring(0,n),e.objectName=r)}if(null===e.propertyName||0===e.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+t);return e},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var r=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.name===e||i.uuid===e||(i=r(i.children)))return i}return null};if(t=r(t.children))return t}return null}}),Object.assign(eo.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,i=e.propertyIndex;if(t||(this.node=t=eo.findNode(this.rootNode,e.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var o=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(t=t.skeleton.bones,n=0;n<t.length;n++)if(t[n].name===o){o=n;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}if(o=t[r],void 0===o)console.error("THREE.PropertyBinding: Trying to update property for track: "+e.nodeName+"."+r+" but it wasn't found.",t);else{if(e=this.Versioning.None,this.targetObject=t,void 0!==t.needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate),n=this.BindingType.Direct,void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}n=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(n=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(n=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[n],this.setValue=this.SetterByBindingTypeAndVersioning[n][e]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(eo.prototype,{_getValue_unbound:eo.prototype.getValue,_setValue_unbound:eo.prototype.setValue}),Object.assign(no.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],p=h.uuid,d=r[p];if(void 0===d){d=e++,r[p]=d,t.push(h),p=0;for(var f=s;p!==f;++p)a[p].push(new eo(h,i[p],o[p]))}else if(d<n){l=t[d];var m=--n;for(f=t[m],r[f.uuid]=d,t[d]=f,r[p]=m,t[m]=h,p=0,f=s;p!==f;++p){var g=a[p],y=g[d];g[d]=g[m],void 0===y&&(y=new eo(h,i[p],o[p])),g[m]=y}}else t[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=n[l];if(void 0!==c&&c>=e){var u=e++,h=t[u];for(n[h.uuid]=c,t[c]=h,n[l]=u,t[u]=s,s=0,l=i;s!==l;++s){h=r[s];var p=h[c];h[c]=h[u],h[u]=p}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=r[l];if(void 0!==c)if(delete r[l],c<n){l=--n;var u=t[l],h=--e,p=t[h];for(r[u.uuid]=c,t[c]=u,r[p.uuid]=l,t[l]=p,t.pop(),u=0,p=o;u!==p;++u){var d=i[u],f=d[h];d[c]=d[l],d[l]=f,d.pop()}}else for(h=--e,p=t[h],r[p.uuid]=c,t[c]=p,t.pop(),u=0,p=o;u!==p;++u)d=i[u],d[c]=d[h],d.pop()}this.nCachedObjects_=n},subscribe_:function(t,e){var n=this._bindingsIndicesByPath,r=n[t],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=this.nCachedObjects_,c=Array(s.length);for(r=i.length,n[t]=r,o.push(t),a.push(e),i.push(c),n=l,r=s.length;n!==r;++n)c[n]=new eo(s[n],t,e);return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}),Object.assign(ro.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){n=this._clip.duration;var r=t._clip.duration,i=n/r;t.warp(1,r/n,e),this.warp(i,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){var r=this._mixer,i=r.time,o=this._timeScaleInterpolant,a=this.timeScale;return null===o&&(this._timeScaleInterpolant=o=r._lendControlInterpolant()),r=o.parameterPositions,o=o.sampleValues,r[0]=i,r[1]=i+n,o[0]=t/a,o[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,r){if(this.enabled){var i=this._startTime;if(null!==i){if(e=(t-i)*n,0>e||0===n)return;this._startTime=null,e*=n}if(e*=this._updateTimeScale(t),n=this._updateTime(e),t=this._updateWeight(t),0<t)switch(e=this._interpolants,i=this._propertyBindings,this.blendMode){case 2501:for(var o=0,a=e.length;o!==a;++o)e[o].evaluate(n),i[o].accumulateAdditive(t);break;default:for(o=0,a=e.length;o!==a;++o)e[o].evaluate(n),i[o].accumulate(r,t)}}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e},_updateTime:function(t){var e=this.time+t,n=this._clip.duration,r=this.loop,i=this._loopCount,o=2202===r;if(0===t)return-1===i?e:o&&1===(1&i)?n-e:e;if(2200===r)t:{if(-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1)),e>=n)e=n;else{if(!(0>e)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>t?-1:1})}else{if(-1===i&&(0<=t?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=n||0>e){r=Math.floor(e/n),e-=n*r,i+=Math.abs(r);var a=this.repetitions-i;0>=a?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e=0<t?n:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1===a?(t=0>t,this._setEndings(t,!t,o)):this._setEndings(!1,!1,o),this._loopCount=i,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r}))}else this.time=e;if(o&&1===(1&i))return n-e}return e},_setEndings:function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,e,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;return null===o&&(this._weightInterpolant=o=r._lendControlInterpolant()),r=o.parameterPositions,o=o.sampleValues,r[0]=i,o[0]=e,r[1]=i+t,o[1]=n,this}}),io.prototype=Object.assign(Object.create(e.prototype),{constructor:io,_bindAction:function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings;t=t._interpolants;var a=n.uuid,s=this._bindingsByRootAndName,l=s[a];for(void 0===l&&(l={},s[a]=l),s=0;s!==i;++s){var c=r[s],u=c.name,h=l[u];if(void 0===h){if(h=o[s],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,u));continue}h=new Qi(eo.create(n,u,e&&e._propertyBindings[s].binding.parsedPath),c.ValueTypeName,c.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,u)}o[s]=h,t[s].resultBuffer=h.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){return t=t._cacheIndex,null!==t&&t<this._nActiveActions},_addInactiveAction:function(t,e,n){var r=this._actions,i=this._actionsByClip,o=i[e];void 0===o?(o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o):(e=o.knownActions,t._byClipCacheIndex=e.length,e.push(t)),t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null,e=t._clip.uuid,n=this._actionsByClip,r=n[e];var i=r.knownActions,o=i[i.length-1],a=t._byClipCacheIndex;o._byClipCacheIndex=a,i[a]=o,i.pop(),t._byClipCacheIndex=null,delete r.actionByRoot[(t._localRoot||this._root).uuid],0===i.length&&delete n[e],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){t=t._propertyBindings;for(var e=0,n=t.length;e!==n;++e){var r=t[e];0===--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){var r=this._bindingsByRootAndName,i=r[e],o=this._bindings;void 0===i&&(i={},r[e]=i),i[n]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid;n=n.path;var i=this._bindingsByRootAndName,o=i[r],a=e[e.length-1];t=t._cacheIndex,a._cacheIndex=t,e[t]=a,e.pop(),delete o[n],0===Object.keys(o).length&&delete i[r]},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&(n=new Nr(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){var r=e||this._root,i=r.uuid;r="string"===typeof t?Wr.findByName(r,t):t,t=null!==r?r.uuid:t;var o=this._actionsByClip[t],a=null;if(void 0===n&&(n=null!==r?r.blendMode:2500),void 0!==o){if(a=o.actionByRoot[i],void 0!==a&&a.blendMode===n)return a;a=o.knownActions[0],null===r&&(r=a._clip)}return null===r?null:(e=new ro(this,r,e,n),this._bindAction(e,a),this._addInactiveAction(e,t,i),e)},existingAction:function(t,e){var n=e||this._root;return e=n.uuid,n="string"===typeof t?Wr.findByName(n,t):t,t=this._actionsByClip[n?n.uuid:t],void 0!==t&&t.actionByRoot[e]||null},stopAllAction:function(){for(var t=this._actions,e=this._nActiveActions-1;0<=e;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==n;++a)e[a]._update(r,t,i,o);for(t=this._bindings,e=this._nActiveBindings,a=0;a!==e;++a)t[a].apply(o);return this},setTime:function(t){for(var e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions;t=t.uuid;var n=this._actionsByClip,r=n[t];if(void 0!==r){r=r.knownActions;for(var i=0,o=r.length;i!==o;++i){var a=r[i];this._deactivateAction(a);var s=a._cacheIndex,l=e[e.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,l._cacheIndex=s,e[s]=l,e.pop(),this._removeInactiveBindingsForAction(a)}delete n[t]}},uncacheRoot:function(t){t=t.uuid;var e=this._actionsByClip;for(r in e){var n=e[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var r=this._bindingsByRootAndName[t];if(void 0!==r)for(var i in r)t=r[i],t.restoreOriginalState(),this._removeInactiveBinding(t)},uncacheAction:function(t,e){t=this.existingAction(t,e),null!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}}),oo.prototype.clone=function(){return new oo(void 0===this.value.clone?this.value:this.value.clone())},ao.prototype=Object.assign(Object.create(Ze.prototype),{constructor:ao,isInstancedInterleavedBuffer:!0,copy:function(t){return Ze.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(so.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){return n=n||[],co(t,this,n,e),n.sort(lo),n},intersectObjects:function(t,e,n){if(n=n||[],!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var r=0,i=t.length;r<i;r++)co(t[r],this,n,e);return n.sort(lo),n}}),Object.assign(uo.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(t,n),this.phi=Math.acos(Vo.clamp(e/this.radius,-1,1))),this}}),Object.assign(ho.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});var yc=new n;Object.assign(po.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){return e=yc.copy(e).multiplyScalar(.5),this.min.copy(t).sub(e),this.max.copy(t).add(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new n),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new n),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new n),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new n),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return yc.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var vc=new c,_c=new c;Object.assign(fo.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new c),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new c),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new c),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){return vc.subVectors(t,this.start),_c.subVectors(this.end,this.start),t=_c.dot(_c),t=_c.dot(vc)/t,e&&(t=Vo.clamp(t,0,1)),t},closestPointToPoint:function(t,e,n){return t=this.closestPointToPointParameter(t,e),void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new c),this.delta(n).multiplyScalar(t).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),mo.prototype=Object.create(d.prototype),mo.prototype.constructor=mo,mo.prototype.isImmediateRenderObject=!0;var xc=new c;go.prototype=Object.create(d.prototype),go.prototype.constructor=go,go.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},go.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),xc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var bc=new c,wc=new u,Mc=new u;vo.prototype=Object.create(sn.prototype),vo.prototype.constructor=vo,vo.prototype.isSkeletonHelper=!0,vo.prototype.updateMatrixWorld=function(t){var e=this.bones,n=this.geometry,r=n.getAttribute("position");Mc.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<e.length;i++){var a=e[i];a.parent&&a.parent.isBone&&(wc.multiplyMatrices(Mc,a.matrixWorld),bc.setFromMatrixPosition(wc),r.setXYZ(o,bc.x,bc.y,bc.z),wc.multiplyMatrices(Mc,a.parent.matrixWorld),bc.setFromMatrixPosition(wc),r.setXYZ(o+1,bc.x,bc.y,bc.z),o+=2)}n.getAttribute("position").needsUpdate=!0,d.prototype.updateMatrixWorld.call(this,t)},_o.prototype=Object.create(j.prototype),_o.prototype.constructor=_o,_o.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},_o.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var Ec=new c,Sc=new b,Tc=new b;xo.prototype=Object.create(d.prototype),xo.prototype.constructor=xo,xo.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},xo.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");Sc.copy(this.light.color),Tc.copy(this.light.groundColor);for(var n=0,r=e.count;n<r;n++){var i=n<r/2?Sc:Tc;e.setXYZ(n,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(Ec.setFromMatrixPosition(this.light.matrixWorld).negate())},bo.prototype=Object.assign(Object.create(sn.prototype),{constructor:bo,copy:function(t){return sn.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),wo.prototype=Object.create(sn.prototype),wo.prototype.constructor=wo;var Ac=new c,Cc=new c,Lc=new c;Mo.prototype=Object.create(d.prototype),Mo.prototype.constructor=Mo,Mo.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Mo.prototype.update=function(){Ac.setFromMatrixPosition(this.light.matrixWorld),Cc.setFromMatrixPosition(this.light.target.matrixWorld),Lc.subVectors(Cc,Ac),this.lightPlane.lookAt(Cc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Cc),this.targetLine.scale.z=Lc.length()};var Ic=new c,Pc=new Z;Eo.prototype=Object.create(sn.prototype),Eo.prototype.constructor=Eo,Eo.prototype.update=function(){var t=this.geometry,e=this.pointMap;Pc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),So("c",e,t,Pc,0,0,-1),So("t",e,t,Pc,0,0,1),So("n1",e,t,Pc,-1,-1,-1),So("n2",e,t,Pc,1,-1,-1),So("n3",e,t,Pc,-1,1,-1),So("n4",e,t,Pc,1,1,-1),So("f1",e,t,Pc,-1,-1,1),So("f2",e,t,Pc,1,-1,1),So("f3",e,t,Pc,-1,1,1),So("f4",e,t,Pc,1,1,1),So("u1",e,t,Pc,.7,1.1,-1),So("u2",e,t,Pc,-.7,1.1,-1),So("u3",e,t,Pc,0,2,-1),So("cf1",e,t,Pc,-1,0,1),So("cf2",e,t,Pc,1,0,1),So("cf3",e,t,Pc,0,-1,1),So("cf4",e,t,Pc,0,1,1),So("cn1",e,t,Pc,-1,0,-1),So("cn2",e,t,Pc,1,0,-1),So("cn3",e,t,Pc,0,-1,-1),So("cn4",e,t,Pc,0,1,-1),t.getAttribute("position").needsUpdate=!0};var Rc=new m;To.prototype=Object.create(sn.prototype),To.prototype.constructor=To,To.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Rc.setFromObject(this.object),!Rc.isEmpty()){t=Rc.min;var e=Rc.max,n=this.geometry.attributes.position,r=n.array;r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t.x,r[4]=e.y,r[5]=e.z,r[6]=t.x,r[7]=t.y,r[8]=e.z,r[9]=e.x,r[10]=t.y,r[11]=e.z,r[12]=e.x,r[13]=e.y,r[14]=t.z,r[15]=t.x,r[16]=e.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=e.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},To.prototype.setFromObject=function(t){return this.object=t,this.update(),this},To.prototype.copy=function(t){return sn.prototype.copy.call(this,t),this.object=t.object,this},To.prototype.clone=function(){return(new this.constructor).copy(this)},Ao.prototype=Object.create(sn.prototype),Ao.prototype=Object.assign(Object.create(sn.prototype),{constructor:Ao,copy:function(t){return sn.prototype.copy.call(this,t),this.box=t.box.clone(),this}}),Ao.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),d.prototype.updateMatrixWorld.call(this,t))},Co.prototype=Object.create(an.prototype),Co.prototype.constructor=Co,Co.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;1e-8>Math.abs(e)&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=0>e?1:0,this.lookAt(this.plane.normal),d.prototype.updateMatrixWorld.call(this,t)};var Oc,Dc,Nc=new c;Lo.prototype=Object.create(d.prototype),Lo.prototype.constructor=Lo,Lo.prototype.setDirection=function(t){.99999<t.y?this.quaternion.set(0,0,0,1):-.99999>t.y?this.quaternion.set(1,0,0,0):(Nc.set(t.z,0,-t.x).normalize(),this.quaternion.setFromAxisAngle(Nc,Math.acos(t.y)))},Lo.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},Lo.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},Lo.prototype.copy=function(t){return d.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},Lo.prototype.clone=function(){return(new this.constructor).copy(this)},Io.prototype=Object.create(sn.prototype),Io.prototype.constructor=Io;var kc=Math.pow(2,8),Fc=[.125,.215,.35,.446,.526,.582],zc=5+Fc.length,Bc={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Uc=new Ci,jc=function(){for(var t=[],e=[],n=[],r=8,i=0;i<zc;i++){var o=Math.pow(2,r);e.push(o);var a=1/o;4<i?a=Fc[i-8+4-1]:0==i&&(a=0),n.push(a),a=1/(o-1),o=-a/2,a=1+a/2;var s=[o,o,a,o,a,a,o,o,a,a,o,a];o=new Float32Array(108),a=new Float32Array(72);for(var l=new Float32Array(36),c=0;6>c;c++){var u=c%3*2/3-1,h=2<c?0:-1;o.set([u,h,0,u+2/3,h,0,u+2/3,h+1,0,u,h,0,u+2/3,h+1,0,u,h+1,0],18*c),a.set(s,12*c),l.set([c,c,c,c,c,c],6*c)}s=new U,s.setAttribute("position",new C(o,3)),s.setAttribute("uv",new C(a,2)),s.setAttribute("faceIndex",new C(l,1)),t.push(s),4<r&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}(),Gc=jc._lodPlanes,Vc=jc._sizeLods,Hc=jc._sigmas,Wc=null,qc=(1+Math.sqrt(5))/2,Xc=1/qc,Zc=[new c(1,1,1),new c(-1,1,1),new c(1,1,-1),new c(-1,1,-1),new c(0,qc,Xc),new c(0,qc,-Xc),new c(Xc,0,qc),new c(-Xc,0,qc),new c(qc,Xc,0),new c(-qc,Xc,0)];Po.prototype={constructor:Po,fromScene:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=.1),void 0===r&&(r=100),Wc=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),0<e&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i},fromEquirectangular:function(t){return t.magFilter=1003,t.minFilter=1003,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){Wc=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=No(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=Do(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var t=0;t<Gc.length;t++)Gc[t].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Wc),t.scissorTest=!1,t.setSize(t.width,t.height)},_allocateTargets:function(t){var e=void 0!==t&&1009===t.type&&(3e3===t.encoding||3001===t.encoding||3007===t.encoding);e={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:e?t.encoding:3002,depthBuffer:!1,stencilBuffer:!1};var n=Ro(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Ro(e),n},_compileMaterial:function(t){t=new j(Gc[0],t),this._renderer.compile(t,Uc)},_sceneToCubeUV:function(t,e,n,r){e=new Y(90,1,e,n),n=[1,-1,1,1,1,1];var i=[1,1,1,-1,-1,-1],o=this._renderer,a=o.outputEncoding,s=o.toneMapping,l=o.toneMappingExposure,c=o.getClearColor(),u=o.getClearAlpha();o.toneMapping=1,o.toneMappingExposure=1,o.outputEncoding=3e3;var h=t.background;if(h&&h.isColor){h.convertSRGBToLinear();var p=Math.min(Math.max(Math.ceil(Math.log2(Math.max(h.r,h.g,h.b))),-128),127);h=h.multiplyScalar(Math.pow(2,-p)),o.setClearColor(h,(p+128)/255),t.background=null}for(h=0;6>h;h++)p=h%3,0==p?(e.up.set(0,n[h],0),e.lookAt(i[h],0,0)):1==p?(e.up.set(0,0,n[h]),e.lookAt(0,i[h],0)):(e.up.set(0,n[h],0),e.lookAt(0,0,i[h])),Oo(r,p*kc,2<h?kc:0,kc,kc),o.setRenderTarget(r),o.render(t,e);o.toneMapping=s,o.toneMappingExposure=l,o.outputEncoding=a,o.setClearColor(c,u)},_textureToCubeUV:function(t,e){var n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=No()):null==this._equirectShader&&(this._equirectShader=Do());var r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new j(Gc[0],r);r=r.uniforms,r.envMap.value=t,t.isCubeTexture||r.texelSize.value.set(1/t.image.width,1/t.image.height),r.inputEncoding.value=Bc[t.encoding],r.outputEncoding.value=Bc[e.texture.encoding],Oo(e,0,0,3*kc,2*kc),n.setRenderTarget(e),n.render(i,Uc)},_applyPMREM:function(t){var e=this._renderer,n=e.autoClear;e.autoClear=!1;for(var r=1;r<zc;r++)this._blur(t,r-1,r,Math.sqrt(Hc[r]*Hc[r]-Hc[r-1]*Hc[r-1]),Zc[(r-1)%Zc.length]);e.autoClear=n},_blur:function(t,e,n,r,i){var o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)},_halfBlur:function(t,e,n,r,i,o,a){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new j(Gc[r],l);l=l.uniforms;var u=Vc[n]-1;u=isFinite(i)?Math.PI/(2*u):2*Math.PI/39;var h=i/u,p=isFinite(i)?1+Math.floor(3*h):20;20<p&&console.warn("sigmaRadians, "+i+", is too large and will clip, as it requested "+p+" samples when the maximum is set to 20"),i=[];for(var d=0,f=0;20>f;++f){var m=f/h;m=Math.exp(-m*m/2),i.push(m),0==f?d+=m:f<p&&(d+=2*m)}for(f=0;f<i.length;f++)i[f]/=d;l.envMap.value=t.texture,l.samples.value=p,l.weights.value=i,l.latitudinal.value="latitudinal"===o,a&&(l.poleAxis.value=a),l.dTheta.value=u,l.mipInt.value=8-n,l.inputEncoding.value=Bc[t.texture.encoding],l.outputEncoding.value=Bc[t.texture.encoding],t=Vc[r],m=3*Math.max(0,kc-2*t),Oo(e,m,(0===r?0:2*kc)+2*t*(4<r?r-8+4:0),3*t,2*t),s.setRenderTarget(e),s.render(c,Uc)}},ri.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(ri.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(vi.prototype,{createPointsGeometry:function(t){return console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),t=this.getPoints(t),this.createGeometry(t)},createSpacedPointsGeometry:function(t){return console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),t=this.getSpacedPoints(t),this.createGeometry(t)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new H,n=0,r=t.length;n<r;n++){var i=t[n];e.vertices.push(new c(i.x,i.y,i.z||0))}return e}}),Object.assign(_i.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),zo.prototype=Object.create(si.prototype),Bo.prototype=Object.create(si.prototype),Uo.prototype=Object.create(si.prototype),Object.assign(Uo.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),bo.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},vo.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Yr.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ql.extractUrlBase(t)}}),Yr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Bi.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(po.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(m.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(y.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Q.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},fo.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Vo,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Vo.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Vo.ceilPowerOfTwo(t)}}),Object.assign(r.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(u.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new c).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,o)}}),_.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},l.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(v.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(x.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(x,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),x.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),x.getNormal(t,e,n,r)}}),Object.assign(xi.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new nr(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new dr(this,t)}}),Object.assign(n.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(c.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(o.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(H.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(d.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(d.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(j.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(j.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Qe.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(en.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),tn.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(ri.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Y.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(bi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(C.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(C.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(U.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e,n){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new C(e,n)))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(U.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ki.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(so.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Ze.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Ze.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(rr.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(oo.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(T.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new b}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Ar.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(X.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(We.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(We.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?3001:3e3}}}),Object.defineProperties(ke.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(a.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties($i.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new Hi).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Ki.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},$.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Wo.crossOrigin=void 0,Wo.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new ni;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,n,void 0,r),e&&(t.mapping=e),t},Wo.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new ei;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,n,void 0,r),e&&(t.mapping=e),t},Wo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Wo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"117"}})),t.ACESFilmicToneMapping=5,t.AddEquation=100,t.AddOperation=2,t.AdditiveAnimationBlendMode=2501,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=Pi,t.AmbientLightProbe=qi,t.AnimationClip=Wr,t.AnimationLoader=Jr,t.AnimationMixer=io,t.AnimationObjectGroup=no,t.AnimationUtils=Fl,t.ArcCurve=oi,t.ArrayCamera=Ue,t.ArrowHelper=Lo,t.Audio=$i,t.AudioAnalyser=Ki,t.AudioContext=Kl,t.AudioListener=Yi,t.AudioLoader=Hi,t.AxesHelper=Io,t.AxisHelper=function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Io(t)},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BinaryTextureLoader=function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Qr(t)},t.Bone=nn,t.BooleanKeyframeTrack=zr,t.BoundingBoxHelper=function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new To(t,e)},t.Box2=po,t.Box3=m,t.Box3Helper=Ao,t.BoxBufferGeometry=Ps,t.BoxGeometry=Is,t.BoxHelper=To,t.BufferAttribute=C,t.BufferGeometry=U,t.BufferGeometryLoader=zi,t.ByteType=1010,t.Cache=zl,t.Camera=Z,t.CameraHelper=Eo,t.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},t.CanvasTexture=fn,t.CatmullRomCurve3=si,t.CineonToneMapping=4,t.CircleBufferGeometry=wr,t.CircleGeometry=br,t.ClampToEdgeWrapping=1001,t.Clock=Zi,t.ClosedSplineCurve3=zo,t.Color=b,t.ColorKeyframeTrack=Br,t.CompressedTexture=dn,t.CompressedTextureLoader=Kr,t.ConeBufferGeometry=xr,t.ConeGeometry=_r,t.CubeCamera=$,t.CubeGeometry=Is,t.CubeReflectionMapping=301,t.CubeRefractionMapping=302,t.CubeTexture=mt,t.CubeTextureLoader=ei,t.CubeUVReflectionMapping=306,t.CubeUVRefractionMapping=307,t.CubicBezierCurve=hi,t.CubicBezierCurve3=pi,t.CubicInterpolant=Dr,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=ri,t.CurvePath=vi,t.CustomBlending=5,t.CylinderBufferGeometry=vr,t.CylinderGeometry=yr,t.Cylindrical=ho,t.DataTexture=K,t.DataTexture2DArray=gt,t.DataTexture3D=yt,t.DataTextureLoader=Qr,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=Bl,t.DepthFormat=1026,t.DepthStencilFormat=1027,t.DepthTexture=mn,t.DirectionalLight=Ii,t.DirectionalLightHelper=Mo,t.DirectionalLightShadow=Li,t.DiscreteInterpolant=kr,t.DodecahedronBufferGeometry=Cn,t.DodecahedronGeometry=An,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicBufferAttribute=function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new C(t,e).setUsage(35048)},t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=gr,t.EdgesHelper=function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new sn(new gr(t.geometry),new on({color:void 0!==e?e:16777215}))},t.EllipseCurve=ii,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=303,t.EquirectangularRefractionMapping=304,t.Euler=h,t.EventDispatcher=e,t.ExtrudeBufferGeometry=rr,t.ExtrudeGeometry=nr,t.Face3=S,t.Face4=function(t,e,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new S(t,e,n,i,o,a)},t.FaceColors=1,t.FileLoader=$r,t.FlatShading=1,t.Float32Attribute=function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new k(t,e)},t.Float32BufferAttribute=k,t.Float64Attribute=function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new F(t,e)},t.Float64BufferAttribute=F,t.FloatType=1015,t.Fog=Xe,t.FogExp2=qe,t.Font=Gi,t.FontLoader=Vi,t.FrontFaceDirectionCCW=1,t.FrontFaceDirectionCW=0,t.FrontSide=0,t.Frustum=Q,t.GammaEncoding=3007,t.Geometry=H,t.GeometryUtils={merge:function(t,e,n){if(console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh){e.matrixAutoUpdate&&e.updateMatrix();var r=e.matrix;e=e.geometry}t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=bo,t.Group=je,t.HalfFloatType=1016,t.HemisphereLight=wi,t.HemisphereLightHelper=xo,t.HemisphereLightProbe=Wi,t.IcosahedronBufferGeometry=Tn,t.IcosahedronGeometry=Sn,t.ImageBitmapLoader=Ui,t.ImageLoader=ti,t.ImageUtils=Wo,t.ImmediateRenderObject=mo,t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=Fi,t.InstancedBufferGeometry=ki,t.InstancedInterleavedBuffer=ao,t.InstancedMesh=rn,t.Int16Attribute=function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new R(t,e)},t.Int16BufferAttribute=R,t.Int32Attribute=function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new D(t,e)},t.Int32BufferAttribute=D,t.Int8Attribute=function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new L(t,e)},t.Int8BufferAttribute=L,t.IntType=1013,t.InterleavedBuffer=Ze,t.InterleavedBufferAttribute=Ye,t.Interpolant=Or,t.InterpolateDiscrete=2300,t.InterpolateLinear=2301,t.InterpolateSmooth=2302,t.InvertStencilOp=5386,t.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},t.KeepStencilOp=7680,t.KeyframeTrack=Fr,t.LOD=Qe,t.LatheBufferGeometry=pr,t.LatheGeometry=hr,t.Layers=p,t.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=bi,t.LightProbe=Di,t.LightShadow=Mi,t.Line=an,t.Line3=fo,t.LineBasicMaterial=on,t.LineCurve=di,t.LineCurve3=fi,t.LineDashedMaterial=Rr,t.LineLoop=ln,t.LinePieces=1,t.LineSegments=sn,t.LineStrip=0,t.LinearEncoding=3e3,t.LinearFilter=1006,t.LinearInterpolant=Nr,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=1008,t.LinearMipmapNearestFilter=1007,t.LinearToneMapping=1,t.Loader=Yr,t.LoaderUtils=ql,t.LoadingManager=Zr,t.LogLuvEncoding=3003,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=T,t.MaterialLoader=Ni,t.Math=Vo,t.MathUtils=Vo,t.Matrix3=r,t.Matrix4=u,t.MaxEquation=104,t.Mesh=j,t.MeshBasicMaterial=A,t.MeshDepthMaterial=De,t.MeshDistanceMaterial=Ne,t.MeshFaceMaterial=function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},t.MeshLambertMaterial=Ir,t.MeshMatcapMaterial=Pr,t.MeshNormalMaterial=Lr,t.MeshPhongMaterial=Ar,t.MeshPhysicalMaterial=Tr,t.MeshStandardMaterial=Sr,t.MeshToonMaterial=Cr,t.MinEquation=103,t.MirroredRepeatWrapping=1002,t.MixOperation=1,t.MultiMaterial=function(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=1003,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=1005,t.NearestMipmapNearestFilter=1004,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColors=0,t.NoToneMapping=0,t.NormalAnimationBlendMode=2500,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=Ur,t.Object3D=d,t.ObjectLoader=Bi,t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=En,t.OctahedronGeometry=Mn,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=Ci,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=Po,t.ParametricBufferGeometry=vn,t.ParametricGeometry=yn,t.Particle=function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Je(t)},t.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new cn(t)},t.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new un(t,e)},t.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new cn(t)},t.Path=_i,t.PerspectiveCamera=Y,t.Plane=_,t.PlaneBufferGeometry=rt,t.PlaneGeometry=nt,t.PlaneHelper=Co,t.PointCloud=function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new un(t,e)},t.PointCloudMaterial=function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new cn(t)},t.PointLight=Ai,t.PointLightHelper=_o,t.Points=un,t.PointsMaterial=cn,t.PolarGridHelper=wo,t.PolyhedronBufferGeometry=xn,t.PolyhedronGeometry=_n,t.PositionalAudio=Ji,t.PropertyBinding=eo,t.PropertyMixer=Qi,t.QuadraticBezierCurve=mi,t.QuadraticBezierCurve3=gi,t.Quaternion=l,t.QuaternionKeyframeTrack=Gr,t.QuaternionLinearInterpolant=jr,t.REVISION="117",t.RGBADepthPacking=3201,t.RGBAFormat=1023,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=37819,t.RGBA_ASTC_10x5_Format=37816,t.RGBA_ASTC_10x6_Format=37817,t.RGBA_ASTC_10x8_Format=37818,t.RGBA_ASTC_12x10_Format=37820,t.RGBA_ASTC_12x12_Format=37821,t.RGBA_ASTC_4x4_Format=37808,t.RGBA_ASTC_5x4_Format=37809,t.RGBA_ASTC_5x5_Format=37810,t.RGBA_ASTC_6x5_Format=37811,t.RGBA_ASTC_6x6_Format=37812,t.RGBA_ASTC_8x5_Format=37813,t.RGBA_ASTC_8x6_Format=37814,t.RGBA_ASTC_8x8_Format=37815,t.RGBA_BPTC_Format=36492,t.RGBA_ETC2_EAC_Format=37496,t.RGBA_PVRTC_2BPPV1_Format=35843,t.RGBA_PVRTC_4BPPV1_Format=35842,t.RGBA_S3TC_DXT1_Format=33777,t.RGBA_S3TC_DXT3_Format=33778,t.RGBA_S3TC_DXT5_Format=33779,t.RGBDEncoding=3006,t.RGBEEncoding=3002,t.RGBEFormat=1023,t.RGBFormat=1022,t.RGBIntegerFormat=1032,t.RGBM16Encoding=3005,t.RGBM7Encoding=3004,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=37492,t.RGB_PVRTC_2BPPV1_Format=35841,t.RGB_PVRTC_4BPPV1_Format=35840,t.RGB_S3TC_DXT1_Format=33776,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=Er,t.Ray=v,t.Raycaster=so,t.RectAreaLight=Ri,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RepeatWrapping=1e3,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=ur,t.RingGeometry=cr,t.SRGB8_ALPHA8_ASTC_10x10_Format=37851,t.SRGB8_ALPHA8_ASTC_10x5_Format=37848,t.SRGB8_ALPHA8_ASTC_10x6_Format=37849,t.SRGB8_ALPHA8_ASTC_10x8_Format=37850,t.SRGB8_ALPHA8_ASTC_12x10_Format=37852,t.SRGB8_ALPHA8_ASTC_12x12_Format=37853,t.SRGB8_ALPHA8_ASTC_4x4_Format=37840,t.SRGB8_ALPHA8_ASTC_5x4_Format=37841,t.SRGB8_ALPHA8_ASTC_5x5_Format=37842,t.SRGB8_ALPHA8_ASTC_6x5_Format=37843,t.SRGB8_ALPHA8_ASTC_6x6_Format=37844,t.SRGB8_ALPHA8_ASTC_8x5_Format=37845,t.SRGB8_ALPHA8_ASTC_8x6_Format=37846,t.SRGB8_ALPHA8_ASTC_8x8_Format=37847,t.Scene=f,t.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}},t.ShaderChunk=ks,t.ShaderLib=Fs,t.ShaderMaterial=X,t.ShadowMaterial=Mr,t.Shape=xi,t.ShapeBufferGeometry=fr,t.ShapeGeometry=dr,t.ShapePath=ji,t.ShapeUtils=Ol,t.ShortType=1011,t.Skeleton=en,t.SkeletonHelper=vo,t.SkinnedMesh=tn,t.SmoothShading=2,t.Sphere=y,t.SphereBufferGeometry=lr,t.SphereGeometry=sr,t.Spherical=uo,t.SphericalHarmonics3=Oi,t.SphericalReflectionMapping=305,t.Spline=Uo,t.SplineCurve=yi,t.SplineCurve3=Bo,t.SpotLight=Si,t.SpotLightHelper=go,t.SpotLightShadow=Ei,t.Sprite=Je,t.SpriteMaterial=$e,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=35044,t.StaticReadUsage=35045,t.StereoCamera=Xi,t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=Vr,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=wn,t.TetrahedronGeometry=bn,t.TextBufferGeometry=ar,t.TextGeometry=or,t.Texture=i,t.TextureLoader=ni,t.TorusBufferGeometry=Dn,t.TorusGeometry=On,t.TorusKnotBufferGeometry=Rn,t.TorusKnotGeometry=Pn,t.Triangle=x,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=In,t.TubeGeometry=Ln,t.UVMapping=300,t.Uint16Attribute=function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new O(t,e)},t.Uint16BufferAttribute=O,t.Uint32Attribute=function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new N(t,e)},t.Uint32BufferAttribute=N,t.Uint8Attribute=function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new I(t,e)},t.Uint8BufferAttribute=I,t.Uint8ClampedAttribute=function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new P(t,e)},t.Uint8ClampedBufferAttribute=P,t.Uncharted2ToneMapping=3,t.Uniform=oo,t.UniformsLib=Ns,t.UniformsUtils=Rs,t.UnsignedByteType=1009,t.UnsignedInt248Type=1020,t.UnsignedIntType=1014,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShort565Type=1019,t.UnsignedShortType=1012,t.VSMShadowMap=3,t.Vector2=n,t.Vector3=c,t.Vector4=o,t.VectorKeyframeTrack=Hr,t.Vertex=function(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new c(t,e,n)},t.VertexColors=2,t.VideoTexture=pn,t.WebGLCubeRenderTarget=J,t.WebGLMultisampleRenderTarget=s,t.WebGLRenderTarget=a,t.WebGLRenderTargetCube=function(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new J(t,n)},t.WebGLRenderer=We,t.WebGLUtils=Be,t.WireframeGeometry=gn,t.WireframeHelper=function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new sn(new gn(t.geometry),new on({color:void 0!==e?e:16777215}))},t.WrapAroundEnding=2402,t.XHRLoader=function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new $r(t)},t.ZeroCurvatureEnding=2400,t.ZeroFactor=200,t.ZeroSlopeEnding=2401,t.ZeroStencilOp=0,t.sRGBEncoding=3001,Object.defineProperty(t,"__esModule",{value:!0})}))},"7dd7":function(t,e,n){const r=n("2413"),i=n("5330"),o=n("ecba"),a=n("00a3"),s=n("e133"),l=n("9724");t.exports=function(t){const e=new i(t,{type:s.geojsonTypes.FEATURE,properties:{},geometry:{type:s.geojsonTypes.LINE_STRING,coordinates:[]}});let n=0;return t._test&&(t._test.line=e),t.store.add(e),{start:function(){t.store.clearSelected(),a.disable(t),t.ui.queueMapClasses({mouse:s.cursors.ADD}),t.ui.setActiveButton(s.types.LINE),this.on("mousemove",r.true,i=>{e.updateCoordinate(n,i.lngLat.lng,i.lngLat.lat),r.isVertex(i)&&t.ui.queueMapClasses({mouse:s.cursors.POINTER})}),this.on("click",r.true,r=>{if(n>0&&o(r,e.coordinates[n-1]))return t.events.changeMode(s.modes.SIMPLE_SELECT,{featureIds:[e.id]});t.ui.queueMapClasses({mouse:s.cursors.ADD}),e.updateCoordinate(n,r.lngLat.lng,r.lngLat.lat),n++}),this.on("click",r.isVertex,()=>t.events.changeMode(s.modes.SIMPLE_SELECT,{featureIds:[e.id]})),this.on("keyup",r.isEscapeKey,()=>{t.store.delete([e.id],{silent:!0}),t.events.changeMode(s.modes.SIMPLE_SELECT)}),this.on("keyup",r.isEnterKey,()=>{t.events.changeMode(s.modes.SIMPLE_SELECT,{featureIds:[e.id]})}),t.events.actionable({combineFeatures:!1,uncombineFeatures:!1,trash:!0})},stop(){a.enable(t),t.ui.setActiveButton(),void 0!==t.store.get(e.id)&&(e.removeCoordinate(""+n),e.isValid()?t.map.fire(s.events.CREATE,{features:[e.toGeoJSON()]}):(t.store.delete([e.id],{silent:!0}),t.events.changeMode(s.modes.SIMPLE_SELECT,{},{silent:!0})))},render(t,n){const r=t.properties.id===e.id;if(t.properties.active=r?s.activeStates.ACTIVE:s.activeStates.INACTIVE,!r)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=s.meta.FEATURE,t.geometry.coordinates.length>=3&&n(l(e.id,t.geometry.coordinates[t.geometry.coordinates.length-2],""+(t.geometry.coordinates.length-2),!1)),n(t))},trash(){t.store.delete([e.id],{silent:!0}),t.events.changeMode(s.modes.SIMPLE_SELECT)}}}},"7f7f":function(t,e,n){(function(t,r){var i=function(){var t=function(t,e,n,r){for(n=n||{},r=t.length;r--;n[t[r]]=e);return n},e=[1,12],n=[1,13],r=[1,9],i=[1,10],o=[1,11],a=[1,14],s=[1,15],l=[14,18,22,24],c=[18,22],u=[22,24],h={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(t,e,n,r,i,o,a){var s=o.length-1;switch(i){case 1:this.$=t.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(t);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=o[s-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=o[s-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[o[s-2],o[s]];break;case 16:this.$={},this.$[o[s][0]]=o[s][1];break;case 17:this.$=o[s-2],void 0!==o[s-2][o[s][0]]&&(this.$.__duplicateProperties__||Object.defineProperty(this.$,"__duplicateProperties__",{value:[],enumerable:!1}),this.$.__duplicateProperties__.push(o[s][0])),o[s-2][o[s][0]]=o[s][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[o[s]];break;case 21:this.$=o[s-2],o[s-2].push(o[s]);break}},table:[{3:5,4:e,5:6,6:n,7:3,8:r,9:4,10:i,11:o,12:1,13:2,15:7,16:8,17:a,23:s},{1:[3]},{14:[1,16]},t(l,[2,7]),t(l,[2,8]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,3]),t(l,[2,4]),t(l,[2,5]),t([14,18,21,22,24],[2,1]),t(l,[2,2]),{3:20,4:e,18:[1,17],19:18,20:19},{3:5,4:e,5:6,6:n,7:3,8:r,9:4,10:i,11:o,13:23,15:7,16:8,17:a,23:s,24:[1,21],25:22},{1:[2,6]},t(l,[2,13]),{18:[1,24],22:[1,25]},t(c,[2,16]),{21:[1,26]},t(l,[2,18]),{22:[1,28],24:[1,27]},t(u,[2,20]),t(l,[2,14]),{3:20,4:e,20:29},{3:5,4:e,5:6,6:n,7:3,8:r,9:4,10:i,11:o,13:30,15:7,16:8,17:a,23:s},t(l,[2,19]),{3:5,4:e,5:6,6:n,7:3,8:r,9:4,10:i,11:o,13:31,15:7,16:8,17:a,23:s},t(c,[2,17]),t(c,[2,15]),t(u,[2,21])],defaultActions:{16:[2,6]},parseError:function(t,e){if(!e.recoverable){function n(t,e){this.message=t,this.hash=e}throw n.prototype=Error,new n(t,e)}this.trace(t)},parse:function(t){var e=this,n=[0],r=[null],i=[],o=this.table,a="",s=0,l=0,c=0,u=2,h=1,p=i.slice.call(arguments,1),d=Object.create(this.lexer),f={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(f.yy[m]=this.yy[m]);d.setInput(t,f.yy),f.yy.lexer=d,f.yy.parser=this,"undefined"==typeof d.yylloc&&(d.yylloc={});var g=d.yylloc;i.push(g);var y=d.options&&d.options.ranges;"function"===typeof f.yy.parseError?this.parseError=f.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;var v,_,x,b,w,M,E,S,T,A=function(){var t;return t=d.lex()||h,"number"!==typeof t&&(t=e.symbols_[t]||t),t},C={};while(1){if(x=n[n.length-1],this.defaultActions[x]?b=this.defaultActions[x]:(null!==v&&"undefined"!=typeof v||(v=A()),b=o[x]&&o[x][v]),"undefined"===typeof b||!b.length||!b[0]){var L="";for(M in T=[],o[x])this.terminals_[M]&&M>u&&T.push("'"+this.terminals_[M]+"'");L=d.showPosition?"Parse error on line "+(s+1)+":\n"+d.showPosition()+"\nExpecting "+T.join(", ")+", got '"+(this.terminals_[v]||v)+"'":"Parse error on line "+(s+1)+": Unexpected "+(v==h?"end of input":"'"+(this.terminals_[v]||v)+"'"),this.parseError(L,{text:d.match,token:this.terminals_[v]||v,line:d.yylineno,loc:g,expected:T})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+v);switch(b[0]){case 1:n.push(v),r.push(d.yytext),i.push(d.yylloc),n.push(b[1]),v=null,_?(v=_,_=null):(l=d.yyleng,a=d.yytext,s=d.yylineno,g=d.yylloc,c>0&&c--);break;case 2:if(E=this.productions_[b[1]][1],C.$=r[r.length-E],C._$={first_line:i[i.length-(E||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(E||1)].first_column,last_column:i[i.length-1].last_column},y&&(C._$.range=[i[i.length-(E||1)].range[0],i[i.length-1].range[1]]),w=this.performAction.apply(C,[a,l,s,f.yy,b[1],r,i].concat(p)),"undefined"!==typeof w)return w;E&&(n=n.slice(0,-1*E*2),r=r.slice(0,-1*E),i=i.slice(0,-1*E)),n.push(this.productions_[b[1]][0]),r.push(C.$),i.push(C._$),S=o[n[n.length-2]][n[n.length-1]],n.push(S);break;case 3:return!0}}return!0}},p=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,n=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var n,r,i;if(this.options.backtrack_lexer&&(i={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(i.yylloc.range=this.yylloc.range.slice(0))),r=t[0].match(/(?:\r\n?|\n).*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in i)this[o]=i[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if(n=this._input.match(this.rules[i[o]]),n&&(!e||n[0].length>e[0].length)){if(e=n,r=o,this.options.backtrack_lexer){if(t=this.test_match(n,i[o]),!1!==t)return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?(t=this.test_match(e,i[r]),!1!==t&&t):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){var t=this.conditionStack.length-1;return t>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions["INITIAL"].rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,n,r){switch(n){case 0:break;case 1:return 6;case 2:return e.yytext=e.yytext.substr(1,e.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return t}();function d(){this.yy={}}return h.lexer=p,d.prototype=h,h.Parser=d,new d}();e.parser=i,e.Parser=i.Parser,e.parse=function(){return i.parse.apply(i,arguments)},e.main=function(r){r[1]||(console.log("Usage: "+r[0]+" FILE"),t.exit(1));var i=n("3e8f").readFileSync(n("df7c").normalize(r[1]),"utf8");return e.parser.parse(i)},n.c[n.s]===r&&e.main(t.argv.slice(1))}).call(this,n("4362"),n("62e4")(t))},"80c3":function(t,e,n){const r=n("7bc4"),i=n("93b5"),o=n("b258");function a(t,e,n){this.map=t,this.camera=e,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=n||new r.Group,this.world.position.x=this.world.position.y=o.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1,this.state={translateCenter:(new r.Matrix4).makeTranslation(o.WORLD_SIZE/2,-o.WORLD_SIZE/2,0),worldSizeRatio:o.TILE_SIZE/o.WORLD_SIZE,worldSize:o.TILE_SIZE*this.map.transform.scale};let i=this;this.map.on("move",(function(){i.updateCamera()})).on("resize",(function(){i.setupCamera()})),this.setupCamera()}a.prototype={setupCamera:function(){this.state.fov=this.map.transform._fov;const t=this.map.transform;this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix(),this.halfFov=this.state.fov/2;const e={x:t.width/2,y:t.height/2},n=.5/Math.tan(this.halfFov)*t.height,i=t._maxPitch*Math.PI/180;this.acuteAngle=Math.PI/2-i,this.state.cameraToCenterDistance=n,this.state.offset=e,this.state.cameraTranslateZ=(new r.Matrix4).makeTranslation(0,0,this.state.cameraToCenterDistance),this.state.maxFurthestDistance=.95*this.state.cameraToCenterDistance*(Math.cos(this.acuteAngle)*Math.sin(this.halfFov)/Math.sin(Math.max(.01,Math.min(Math.PI-.01,this.acuteAngle-this.halfFov)))+1),this.updateCamera()},updateCamera:function(t){if(!this.camera)return void console.log("nocamera");const e=this.map.transform,n=Math.PI/2+e._pitch;this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*e.height,this.state.cameraTranslateZ=(new r.Matrix4).makeTranslation(0,0,this.cameraToCenterDistance);const o=Math.sin(this.halfFov)*this.state.cameraToCenterDistance/Math.sin(Math.PI-n-this.halfFov),a=Math.cos(Math.PI/2-e._pitch),s=a*o+this.state.cameraToCenterDistance,l=1.01*s,c=e.height/50,u=Math.max(c*a,c),h=e.height,p=e.width;this.camera instanceof r.OrthographicCamera?this.camera.projectionMatrix=i.makeOrthographicMatrix(p/-2,p/2,h/2,h/-2,u,l):this.camera.projectionMatrix=i.makePerspectiveMatrix(this.state.fov,p/h,u,l);let d=this.calcCameraMatrix(e._pitch,e.angle);this.camera.matrixWorld.copy(d);let f=e.scale*this.state.worldSizeRatio,m=new r.Matrix4,g=new r.Matrix4,y=new r.Matrix4;m.makeScale(f,f,f);let v=e.x||e.point.x,_=e.y||e.point.y;g.makeTranslation(-v,_,0),y.makeRotationZ(Math.PI),this.world.matrix=(new r.Matrix4).premultiply(y).premultiply(this.state.translateCenter).premultiply(m).premultiply(g)},calcCameraMatrix(t,e,n){const i=this.map.transform,o=void 0===t?i._pitch:t,a=void 0===e?i.angle:e,s=void 0===n?this.state.cameraTranslateZ:n;return(new r.Matrix4).premultiply(s).premultiply((new r.Matrix4).makeRotationX(o)).premultiply((new r.Matrix4).makeRotationZ(a))}},t.exports=a},8309:function(t,e,n){const r=n("a53c"),i=function(t,e){r.call(this,t,e)};i.prototype=Object.create(r.prototype),i.prototype.isValid=function(){return"number"===typeof this.coordinates[0]&&"number"===typeof this.coordinates[1]},i.prototype.updateCoordinate=function(t,e,n){this.coordinates=3===arguments.length?[e,n]:[t,e],this.changed()},i.prototype.getCoordinate=function(){return this.getCoordinates()},t.exports=i},8949:function(t,e,n){const r=n("7bc4"),i=n("80c3"),o=n("93b5"),a=n("cd37"),s=n("b258"),l=n("a4f5"),c=n("4338"),u=n("0d02"),h=n("4ab9"),p=n("5cc9"),d=n("bc0e"),f=n("f767"),m=n("cae9"),g=n("137c"),y=n("d56d"),v=n("5502"),_=n("5734");function x(t,e,n){this.init(t,e,n)}x.prototype={repaint:function(){this.map.repaint=!0},init:function(t,e,n){this.options=o._validate(n||{},b),this.map=t,this.map.tb=this,this.objects=new l,this.renderer=new r.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,canvas:t.getCanvas(),context:e}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.outputEncoding=r.sRGBEncoding,this.renderer.autoClear=!1,this.labelRenderer=new v(this.map),this.scene=new r.Scene,this.world=new r.Group,this.world.name="world",this.scene.add(this.world),this.objectsCache=new Map,this.zoomLayers=[],this.fov=this.options.fov,this.orthographic=this.options.orthographic||!1,this.raycaster=new r.Raycaster,this.raycaster.layers.set(0),this.mapCenter=this.map.getCenter(),this.mapCenterUnits=o.projectToWorld([this.mapCenter.lng,this.mapCenter.lat]),this.lightDateTime=new Date,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition,this.rotationStep=5,this.gridStep=6,this.altitudeStep=.1,this.lights=this.initLights,this.options.defaultLights&&this.defaultLights(),this.options.realSunlight&&this.realSunlight(this.options.realSunlightHelper),this.enableSelectingFeatures=this.options.enableSelectingFeatures||!1,this.enableSelectingObjects=this.options.enableSelectingObjects||!1,this.enableDraggingObjects=this.options.enableDraggingObjects||!1,this.enableRotatingObjects=this.options.enableRotatingObjects||!1,this.enableTooltips=this.options.enableTooltips||!1,this.multiLayer=this.options.multiLayer||!1,this.map.on("style.load",(function(){this.tb.zoomLayers=[],this.tb.options.multiLayer&&this.addLayer({id:"threebox_layer",type:"custom",renderingMode:"3d",map:this,onAdd:function(t,e){},render:function(t,e){this.map.tb.update()}})})),this.map.on("load",(function(){let e;this.selectedObject,this.selectedFeature,this.draggedObject,this.overedObject,this.overedFeature;let n,r=this.getCanvasContainer();this.getCanvasContainer().style.cursor="default";let i,a,s,l,c=[];function u(t){var e=r.getBoundingClientRect();return{x:t.originalEvent.clientX-e.left-r.clientLeft,y:t.originalEvent.clientY-e.top-r.clientTop}}this.unselectObject=function(){this.selectedObject.selected=!1,this.selectedObject=null},this.outObject=function(){this.overedObject.over=!1,this.overedObject=null},this.unselectFeature=function(t){"undefined"!=typeof t.id&&(this.setFeatureState({source:t.source,sourceLayer:t.sourceLayer,id:t.id},{select:!1}),this.removeTooltip(t),t=this.queryRenderedFeatures({layers:[t.layer.id],filter:["==",["id"],t.id]})[0],t&&this.fire("SelectedFeatureChange",{detail:t}),this.selectedFeature=null)},this.selectFeature=function(t){this.selectedFeature=t,this.setFeatureState({source:this.selectedFeature.source,sourceLayer:this.selectedFeature.sourceLayer,id:this.selectedFeature.id},{select:!0}),this.selectedFeature=this.queryRenderedFeatures({layers:[this.selectedFeature.layer.id],filter:["==",["id"],this.selectedFeature.id]})[0],this.addTooltip(this.selectedFeature),this.fire("SelectedFeatureChange",{detail:this.selectedFeature})},this.outFeature=function(e){this.overedFeature&&"undefined"!=typeof this.overedFeature&&this.overedFeature.id!=e&&(t.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!1}),this.removeTooltip(this.overedFeature),this.overedFeature=null)},this.addTooltip=function(t){if(!this.tb.enableTooltips)return;let e=this.tb.getFeatureCenter(t),n=this.tb.tooltip({text:t.properties.name||t.id||t.type,mapboxStyle:!0,feature:t});n.setCoords(e),this.tb.add(n,t.layer.id),t.tooltip=n,t.tooltip.tooltip.visible=!0},this.removeTooltip=function(t){t.tooltip&&(t.tooltip.visibility=!1,this.tb.remove(t.tooltip),t.tooltip=null)},t.onContextMenu=function(t){alert("contextMenu")},this.onClick=function(e){let n,r=[];if(t.tb.enableSelectingObjects&&(r=this.tb.queryRenderedFeatures(e.point)),n="object"==typeof r[0],n){let t=x.prototype.findParent3DObject(r[0]);if(t){if(this.selectedFeature&&this.unselectFeature(this.selectedFeature),this.selectedObject){if(this.selectedObject.uuid!=t.uuid)this.selectedObject.selected=!1,t.selected=!0,this.selectedObject=t;else if(this.selectedObject.uuid==t.uuid)return void this.unselectObject()}else this.selectedObject=t,this.selectedObject.selected=!0;this.selectedObject.dispatchEvent(new CustomEvent("Wireframed",{detail:this.selectedObject,bubbles:!0,cancelable:!0})),this.selectedObject.dispatchEvent(new CustomEvent("IsPlayingChanged",{detail:this.selectedObject,bubbles:!0,cancelable:!0})),this.repaint=!0,e.preventDefault()}}else{let n=[];if(t.tb.enableSelectingFeatures&&(n=this.queryRenderedFeatures(e.point)),n.length>0&&"fill-extrusion"==n[0].layer.type&&"undefined"!=typeof n[0].id)if(this.selectedObject&&this.unselectObject(),this.selectedFeature){if(this.selectedFeature.id!=n[0].id)this.unselectFeature(this.selectedFeature),this.selectFeature(n[0]);else if(this.selectedFeature.id==n[0].id)return void this.unselectFeature(this.selectedFeature)}else this.selectFeature(n[0])}},this.onMouseMove=function(r){let o,c=u(r);if(this.getCanvasContainer().style.cursor="default",r.originalEvent.altKey&&this.draggedObject){if(!t.tb.enableRotatingObjects)return;e="rotate",this.getCanvasContainer().style.cursor="move";Math.min(n.x,c.x),Math.max(n.x,c.x),Math.min(n.y,c.y),Math.max(n.y,c.y);let r={x:0,y:0,z:Math.round(l[2]+~~((c.x-n.x)/this.tb.rotationStep)%360*this.tb.rotationStep%360)};return this.draggedObject.setRotation(r),void this.draggedObject.addHelp("rot: "+r.z+"&#176;")}if(r.originalEvent.shiftKey&&this.draggedObject){if(!t.tb.enableDraggingObjects)return;e="translate",this.getCanvasContainer().style.cursor="move";let n=r.lngLat,o=[Number((n.lng+i).toFixed(this.tb.gridStep)),Number((n.lat+a).toFixed(this.tb.gridStep)),this.draggedObject.modelHeight];return this.draggedObject.setCoords(o),void this.draggedObject.addHelp("lng: "+o[0]+"&#176;, lat: "+o[1]+"&#176;")}if(r.originalEvent.ctrlKey&&this.draggedObject){if(!t.tb.enableDraggingObjects)return;e="altitude",this.getCanvasContainer().style.cursor="move";let n=r.point.y*this.tb.altitudeStep,i=[this.draggedObject.coordinates[0],this.draggedObject.coordinates[1],Number((-n-s).toFixed(this.tb.gridStep))];return this.draggedObject.setCoords(i),void this.draggedObject.addHelp("alt: "+i[2]+"m")}let h=[];if(t.tb.enableSelectingObjects&&(h=this.tb.queryRenderedFeatures(r.point)),o="object"==typeof h[0],o){let t=x.prototype.findParent3DObject(h[0]);t&&(this.outFeature(this.overedFeature),this.getCanvasContainer().style.cursor="pointer",this.selectedObject&&t.uuid==this.selectedObject.uuid||(this.overedObject&&this.overedObject.uuid!=t.uuid&&this.outObject(),t.over=!0,this.overedObject=t),this.repaint=!0,r.preventDefault())}else{this.overedObject&&this.outObject();let e=[];t.tb.enableSelectingFeatures&&(e=this.queryRenderedFeatures(r.point)),e.length>0&&(this.outFeature(e[0]),"fill-extrusion"==e[0].layer.type&&"undefined"!=typeof e[0].id&&(this.selectedFeature&&this.selectedFeature.id==e[0].id||(this.getCanvasContainer().style.cursor="pointer",this.overedFeature=e[0],this.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!0}),this.overedFeature=t.queryRenderedFeatures({layers:[this.overedFeature.layer.id],filter:["==",["id"],this.overedFeature.id]})[0],this.addTooltip(this.overedFeature))))}},this.onMouseDown=function(e){(e.originalEvent.shiftKey||e.originalEvent.altKey||e.originalEvent.ctrlKey)&&0===e.originalEvent.button&&this.selectedObject&&(t.tb.enableDraggingObjects||t.tb.enableRotatingObjects)&&(e.preventDefault(),t.getCanvasContainer().style.cursor="move",t.once("mouseup",this.onMouseUp),this.draggedObject=this.selectedObject,n=u(e),c=this.draggedObject.coordinates,l=o.degreeify(this.draggedObject.rotation),i=c[0]-e.lngLat.lng,a=c[1]-e.lngLat.lat,s=-this.draggedObject.modelHeight-e.point.y*this.tb.altitudeStep)},this.onMouseUp=function(t){this.getCanvasContainer().style.cursor="default",this.off("mouseup",this.onMouseUp),this.off("mouseout",this.onMouseUp),this.dragPan.enable(),this.draggedObject&&(this.draggedObject.dispatchEvent(new CustomEvent("ObjectDragged",{detail:{draggedObject:this.draggedObject,draggedAction:e},bubbles:!0,cancelable:!0})),this.draggedObject.removeHelp(),this.draggedObject=null,e=null)},this.onMouseOut=function(t){if(this.overedFeature){let e=this.queryRenderedFeatures(t.point);e.length>0&&this.overedFeature.id!=e[0].id&&(this.getCanvasContainer().style.cursor="default",this.outFeature(e[0]))}},this.onZoom=function(t){this.tb.zoomLayers.forEach(t=>{this.tb.toggleLayer(t)}),this.tb.world.children.filter(t=>null!=t.fixedZoom).forEach(t=>{t.setObjectScale(this.transform.scale)})};let h=!1,p=!1,d=17,f=91,m=16,g=83;function y(t){t.which!==d&&t.which!==f||(h=!0),t.which===m&&(p=!0);let e=this.selectedObject;if(p&&t.which===g&&e){let t=o.toDecimal;if(e.help)e.removeHelp();else{let n=e.modelSize,r=1;"meters"!==e.userData.units&&(r=o.projectedUnitsPerMeter(e.coordinates[1]),r||(r=1),r=t(r,7)),e.addHelp("size(m): "+t(n.x/r,3)+" W, "+t(n.y/r,3)+" L, "+t(n.z/r,3)+" H"),this.repaint=!0}return!1}}function v(t){t.which!=d&&t.which!=f||(h=!1),t.which===m&&(p=!1)}this.on("click",this.onClick),this.on("mousemove",this.onMouseMove),this.on("mouseout",this.onMouseOut),this.on("mousedown",this.onMouseDown),this.on("zoom",this.onZoom),document.addEventListener("keydown",y.bind(this),!0),document.addEventListener("keyup",v.bind(this))}))},get fov(){return this.options.fov},set fov(t){this.camera instanceof r.PerspectiveCamera&&this.options.fov!==t&&(this.map.transform.fov=t,this.camera.fov=this.map.transform.fov,this.cameraSync.setupCamera(),this.map.repaint=!0,this.options.fov=t)},get orthographic(){return this.options.orthographic},set orthographic(t){const e=this.map.getCanvas().clientHeight,n=this.map.getCanvas().clientWidth;t?(this.map.transform.fov=0,this.camera=new r.OrthographicCamera(n/-2,n/2,e/2,e/-2,.1,1e21)):(this.map.transform.fov=this.fov,this.camera=new r.PerspectiveCamera(this.map.transform.fov,n/e,.1,1e21)),this.camera.layers.enable(0),this.camera.layers.enable(1),this.cameraSync=new i(this.map,this.camera,this.world),this.map.repaint=!0,this.options.orthographic=t},sphere:function(t){return this.setDefaultView(t,this.options),u(t,this.world)},line:g,label:p,tooltip:d,tube:function(t){return this.setDefaultView(t,this.options),y(t,this.world)},extrusion:function(t){return this.setDefaultView(t,this.options),h(t)},Object3D:function(t){return this.setDefaultView(t,this.options),m(t)},loadObj:async function(t,e){this.setDefaultView(t,this.options);let n=this.objectsCache.get(t.obj);n?n.promise.then(n=>{e(n.duplicate(t))}).catch(e=>{this.objectsCache.delete(t.obj),console.error("Could not load model file: "+t.obj)}):this.objectsCache.set(t.obj,{promise:new Promise(async(n,r)=>{f(t,e,async t=>{t.duplicate?n(t.duplicate()):r(t)})})})},material:function(t){return c(t)},initLights:{ambientLight:null,dirLight:null,dirLightBack:null,dirLightHelper:null,hemiLight:null,pointLight:null},utils:o,SunCalc:a,Constants:s,projectToWorld:function(t){return this.utils.projectToWorld(t)},unprojectFromWorld:function(t){return this.utils.unprojectFromWorld(t)},projectedUnitsPerMeter:function(t){return this.utils.projectedUnitsPerMeter(t)},getFeatureCenter:function(t,e,n){return o.getFeatureCenter(t,e,n)},getObjectHeightOnFloor:function(t,e,n){return o.getObjectHeightOnFloor(t,e,n)},queryRenderedFeatures:function(t){let e=new r.Vector2;e.x=t.x/this.map.transform.width*2-1,e.y=1-t.y/this.map.transform.height*2,this.raycaster.setFromCamera(e,this.camera);let n=this.raycaster.intersectObjects(this.world.children,!0);return n},findParent3DObject:function(t){var e;return t.object.traverseAncestors((function(t){t.parent&&"Group"==t.parent.type&&t.userData.obj&&(e=t)})),e},setLayoutProperty:function(t,e,n){this.map.setLayoutProperty(t,e,n),null===n||void 0===n||"visibility"!==e||this.world.children.forEach((function(e){e.layer===t&&(e.visibility=n)}))},setLayerZoomRange:function(t,e,n){this.map.getLayer(t)&&(this.map.setLayerZoomRange(t,e,n),this.zoomLayers.includes(t)||this.zoomLayers.push(t),this.toggleLayer(t))},setLayerHeigthProperty:function(t,e){let n=this.map.getLayer(t);if(n)if("fill-extrusion"==n.type){let t=this.map.getStyle().sources[n.source].data,r=t.features;r.forEach((function(t){t.properties.level=e})),this.map.getSource(n.source).setData(t)}else"custom"==n.type&&this.world.children.forEach((function(n){let r=n.userData.feature;if(r&&r.layer===t){let t=this.tb.getFeatureCenter(r,n,e);n.setCoords(t)}}))},setStyle:function(t,e){this.clear().then(()=>{this.map.setStyle(t,e)})},toggleLayer:function(t,e=!0){let n=this.map.getLayer(t);if(n){if(!e)return void this.toggle(n.id,!1);let t=this.map.getZoom();if(n.minzoom&&t<n.minzoom)return void this.toggle(n.id,!1);if(n.maxzoom&&t>=n.maxzoom)return void this.toggle(n.id,!1);this.toggle(n.id,!0)}},toggle:function(t,e){this.setLayoutProperty(t,"visibility",e?"visible":"none"),this.labelRenderer.toggleLabels(t,e)},update:function(){this.map.repaint&&(this.map.repaint=!1);var t=Date.now();this.objects.animationManager.update(t),this.updateLightHelper(),this.renderer.state.reset(),this.options.realSunlight&&this.renderer.state.setBlending(r.NormalBlending),this.renderer.render(this.scene,this.camera),this.labelRenderer.render(this.scene,this.camera),!1===this.options.passiveRendering&&this.map.triggerRepaint()},add:function(t,e,n){if(!this.enableTooltips&&t.tooltip&&(t.tooltip.visibility=!1),this.world.add(t),e){t.layer=e,t.source=n;let r=this.map.getLayer(e);if(r){let e=r.visibility,n="undefined"===typeof e;t.visibility=!(!n&&"visible"!==e)}}},remove:function(t){this.map.selectedObject&&t.uuid==this.map.selectedObject.uuid&&this.map.unselectObject(),this.map.draggedObject&&t.uuid==this.map.draggedObject.uuid&&(this.map.draggedObject=null),t.dispose&&t.dispose(),this.world.remove(t),t=null},clear:async function(t=null,e=!1){return new Promise((n,r)=>{let i=[];this.world.children.forEach((function(t){i.push(t)}));for(let e=0;e<i.length;e++){let n=i[e];n.layer!==t&&t||this.remove(n)}e&&this.objectsCache.forEach(t=>{t.promise.then(t=>{t.dispose(),t=null})}),n("clear")})},removeLayer:function(t){this.clear(t,!0).then(()=>{this.map.removeLayer(t)})},getSunPosition:function(t,e){return a.getPosition(t,e[1],e[0])},getSunTimes:function(t,e){return a.getTimes(t,e[1],e[0],e[2]?e[2]:0)},setBuildingShadows:function(t){if(this.map.getLayer(t.buildingsLayerId)){let e=new _(t,this);this.map.addLayer(e,t.buildingsLayerId)}else console.warn("The layer '"+t.buildingsLayerId+"' does not exist in the map.")},setSunlight:function(t=new Date,e){if(!this.lights.dirLight||!this.options.realSunlight)return void console.warn("To use setSunlight it's required to set realSunlight : true in Threebox initial options.");var n=new Date(t.getTime());if(e?e.lng&&e.lat?this.mapCenter=e:this.mapCenter={lng:e[0],lat:e[1]}:this.mapCenter=this.map.getCenter(),this.lightDateTime&&this.lightDateTime.getTime()===n.getTime()&&this.lightLng===this.mapCenter.lng&&this.lightLat===this.mapCenter.lat)return;this.lightDateTime=n,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition=this.getSunPosition(n,[this.mapCenter.lng,this.mapCenter.lat]);let r=this.sunPosition.altitude,i=Math.PI+this.sunPosition.azimuth,o=s.WORLD_SIZE/2,a=Math.sin(r),l=Math.cos(r),c=Math.cos(i)*l,u=Math.sin(i)*l;this.lights.dirLight.position.set(u,c,a),this.lights.dirLight.position.multiplyScalar(o),this.lights.dirLight.intensity=Math.max(a,-.15),this.lights.dirLight.updateMatrixWorld(),this.updateLightHelper(),this.map.loaded()&&this.map.setLight({anchor:"map",position:[1.5,180+180*this.sunPosition.azimuth/Math.PI,90-180*this.sunPosition.altitude/Math.PI],"position-transition":{duration:0},color:`hsl(40, ${50*Math.cos(this.sunPosition.altitude)}%, ${96*Math.sin(this.sunPosition.altitude)}%)`},{duration:0})},updateLightHelper:function(){this.lights.dirLightHelper&&(this.lights.dirLightHelper.position.setFromMatrixPosition(this.lights.dirLight.matrixWorld),this.lights.dirLightHelper.updateMatrix(),this.lights.dirLightHelper.update())},dispose:async function(){return console.log(this.memory()),new Promise(t=>{t(this.clear(null,!0).then(t=>(this.map.remove(),this.map={},this.scene.remove(this.world),this.scene.dispose(),this.world.children=[],this.world=null,this.objectsCache.clear(),this.labelRenderer.dispose(),console.log(this.memory()),this.renderer.dispose(),t)))})},defaultLights:function(){this.lights.ambientLight=new r.AmbientLight(new r.Color("hsl(0, 0%, 100%)"),.75),this.scene.add(this.lights.ambientLight),this.lights.dirLightBack=new r.DirectionalLight(new r.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLightBack.position.set(30,100,100),this.scene.add(this.lights.dirLightBack),this.lights.dirLight=new r.DirectionalLight(new r.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLight.position.set(-30,100,-100),this.scene.add(this.lights.dirLight)},realSunlight:function(t=!1){this.renderer.shadowMap.enabled=!0,this.lights.dirLight=new r.DirectionalLight(16777215,1),this.scene.add(this.lights.dirLight),t&&(this.lights.dirLightHelper=new r.DirectionalLightHelper(this.lights.dirLight,5),this.scene.add(this.lights.dirLightHelper));let e=1e3,n=2,i=8192;this.lights.dirLight.castShadow=!0,this.lights.dirLight.shadow.radius=n,this.lights.dirLight.shadow.mapSize.width=i,this.lights.dirLight.shadow.mapSize.height=i,this.lights.dirLight.shadow.camera.top=this.lights.dirLight.shadow.camera.right=e,this.lights.dirLight.shadow.camera.bottom=this.lights.dirLight.shadow.camera.left=-e,this.lights.dirLight.shadow.camera.near=1,this.lights.dirLight.shadow.camera.visible=!0,this.lights.dirLight.shadow.camera.far=4e8,this.lights.hemiLight=new r.HemisphereLight(new r.Color(16777215),new r.Color(16777215),.6),this.lights.hemiLight.color.setHSL(.661,.96,.12),this.lights.hemiLight.groundColor.setHSL(.11,.96,.14),this.lights.hemiLight.position.set(0,0,50),this.scene.add(this.lights.hemiLight),this.setSunlight()},setDefaultView:function(t,e){t.bbox=t.bbox&&e.enableSelectingObjects,t.tooltip=t.tooltip&&e.enableTooltips,t.mapScale=this.map.transform.scale},memory:function(){return this.renderer.info.memory},programs:function(){return this.renderer.info.programs.length},version:"2.1.8"};var b={defaultLights:!1,realSunlight:!1,realSunlightHelper:!1,passiveRendering:!0,preserveDrawingBuffer:!1,enableSelectingFeatures:!1,enableSelectingObjects:!1,enableDraggingObjects:!1,enableRotatingObjects:!1,enableTooltips:!1,multiLayer:!1,orthographic:!1,fov:s.FOV_DEGREES};t.exports=x},"8d7b":function(t,e,n){const r=n("5e67"),i=n("3cd1"),o=n("d125"),a=n("e133"),s={[a.modes.SIMPLE_SELECT]:n("6bfd"),[a.modes.DIRECT_SELECT]:n("07de"),[a.modes.DRAW_POINT]:n("8dc9"),[a.modes.DRAW_LINE_STRING]:n("7dd7"),[a.modes.DRAW_POLYGON]:n("caf2"),[a.modes.STATIC]:n("d0eb")};t.exports=function(t){let e={};const n={};let l=a.modes.SIMPLE_SELECT,c=r(s.simple_select(t),t);n.drag=function(n){o(e,{point:n.point,time:(new Date).getTime()})?n.originalEvent.stopPropagation():(t.ui.queueMapClasses({mouse:a.cursors.DRAG}),c.drag(n))},n.mousemove=function(e){const r=void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which;if(1===r)return n.drag(e);const o=i(e,t);e.featureTarget=o,c.mousemove(e)},n.mousedown=function(n){e={time:(new Date).getTime(),point:n.point};const r=i(n,t);n.featureTarget=r,c.mousedown(n)},n.mouseup=function(n){const r=i(n,t);n.featureTarget=r,o(e,{point:n.point,time:(new Date).getTime()})?c.click(n):c.mouseup(n)},n.mouseout=function(t){c.mouseout(t)};const u=t=>!(8===t||46===t||t>=48&&t<=57);function h(e,n,i={}){c.stop();const o=s[e];if(void 0===o)throw new Error(e+" is not valid");l=e;const u=o(t,n);c=r(u,t),i.silent||t.map.fire(a.events.MODE_CHANGE,{mode:e}),t.store.setDirty(),t.store.render()}n.keydown=function(e){8!==e.keyCode&&46!==e.keyCode||!t.options.controls.trash?u(e.keyCode)?c.keydown(e):49===e.keyCode&&t.options.controls.point?h(a.modes.DRAW_POINT):50===e.keyCode&&t.options.controls.line_string?h(a.modes.DRAW_LINE_STRING):51===e.keyCode&&t.options.controls.polygon&&h(a.modes.DRAW_POLYGON):(e.preventDefault(),c.trash())},n.keyup=function(t){u(t.keyCode)&&c.keyup(t)},n.zoomend=function(){t.store.changeZoom()},n.data=function(e){if("style"===e.dataType){const{setup:e,map:n,options:r,store:i}=t,o=!!r.styles.find(t=>n.getLayer(t.id));o||(e.addLayers(),i.setDirty(),i.render())}};const p={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function d(e){let n=!1;Object.keys(e).forEach(t=>{if(void 0===p[t])throw new Error("Invalid action type");p[t]!==e[t]&&(n=!0),p[t]=e[t]}),n&&t.map.fire(a.events.ACTIONABLE,{actions:p})}const f={changeMode:h,actionable:d,currentModeName:function(){return l},currentModeRender:function(t,e){return c.render(t,e)},fire:function(t,e){n[t]&&n[t](e)},addEventListeners:function(){t.map.on("mousemove",n.mousemove),t.map.on("mousedown",n.mousedown),t.map.on("mouseup",n.mouseup),t.map.on("data",n.data),t.container.addEventListener("mouseout",n.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",n.keydown),t.container.addEventListener("keyup",n.keyup))},removeEventListeners:function(){t.map.off("mousemove",n.mousemove),t.map.off("mousedown",n.mousedown),t.map.off("mouseup",n.mouseup),t.map.off("data",n.data),t.container.removeEventListener("mouseout",n.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",n.keydown),t.container.removeEventListener("keyup",n.keyup))},trash:function(t){c.trash(t)},combineFeatures:function(){c.combineFeatures()},uncombineFeatures:function(){c.uncombineFeatures()},getMode:function(){return l}};return f}},"8dc9":function(t,e,n){const r=n("2413"),i=n("8309"),o=n("e133");t.exports=function(t){const e=new i(t,{type:o.geojsonTypes.FEATURE,properties:{},geometry:{type:o.geojsonTypes.POINT,coordinates:[]}});function n(){t.events.changeMode(o.modes.SIMPLE_SELECT),t.store.delete([e.id],{silent:!0})}function a(n){t.ui.queueMapClasses({mouse:o.cursors.MOVE}),e.updateCoordinate("",n.lngLat.lng,n.lngLat.lat),t.map.fire(o.events.CREATE,{features:[e.toGeoJSON()]}),t.events.changeMode(o.modes.SIMPLE_SELECT,{featureIds:[e.id]})}return t._test&&(t._test.point=e),t.store.add(e),{start(){t.store.clearSelected(),t.ui.queueMapClasses({mouse:o.cursors.ADD}),t.ui.setActiveButton(o.types.POINT),this.on("click",r.true,a),this.on("keyup",r.isEscapeKey,n),this.on("keyup",r.isEnterKey,n),t.events.actionable({combineFeatures:!1,uncombineFeatures:!1,trash:!0})},stop(){t.ui.setActiveButton(),e.getCoordinate().length||t.store.delete([e.id],{silent:!0})},render(t,n){const r=t.properties.id===e.id;if(t.properties.active=r?o.activeStates.ACTIVE:o.activeStates.INACTIVE,!r)return n(t)},trash(){n()}}}},"8fe5":function(t,e,n){const r=n("7bc4");r.ColladaLoader=function(t){r.Loader.call(this,t)},r.ColladaLoader.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:r.ColladaLoader,load:function(t,e,n,i){var o=this,a=""===o.path?r.LoaderUtils.extractUrlBase(t):o.path,s=new r.FileLoader(o.manager);s.setPath(o.path),s.load(t,(function(n){try{e(o.parse(n,a))}catch(r){i?i(r):console.error(r),o.manager.itemError(t)}}),n,i)},options:{set convertUpAxis(t){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(t,e){function n(t,e){for(var n=[],r=t.childNodes,i=0,o=r.length;i<o;i++){var a=r[i];a.nodeName===e&&n.push(a)}return n}function i(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=e[r];return n}function o(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=parseFloat(e[r]);return n}function a(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=parseInt(e[r]);return n}function s(t){return t.substring(1)}function l(){return"three_default_"+Se++}function c(t){return 0===Object.keys(t).length}function u(t){return{unit:h(n(t,"unit")[0]),upAxis:p(n(t,"up_axis")[0])}}function h(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}function p(t){return void 0!==t?t.textContent:"Y_UP"}function d(t,e,r,i){var o=n(t,e)[0];if(void 0!==o)for(var a=n(o,r),s=0;s<a.length;s++)i(a[s])}function f(t,e){for(var n in t){var r=t[n];r.build=e(t[n])}}function m(t,e){return void 0!==t.build||(t.build=e(t)),t.build}function g(t){for(var e={sources:{},samplers:{},channels:{}},n=!1,i=0,o=t.childNodes.length;i<o;i++){var a,s=t.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"source":a=s.getAttribute("id"),e.sources[a]=wt(s);break;case"sampler":a=s.getAttribute("id"),e.samplers[a]=y(s);break;case"channel":a=s.getAttribute("target"),e.channels[a]=v(s);break;case"animation":g(s),n=!0;break;default:console.log(s)}}!1===n&&(Te.animations[t.getAttribute("id")||r.MathUtils.generateUUID()]=e)}function y(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=s(i.getAttribute("source")),a=i.getAttribute("semantic");e.inputs[a]=o;break}}return e}function v(t){var e={},n=t.getAttribute("target"),r=n.split("/"),i=r.shift(),o=r.shift(),a=-1!==o.indexOf("("),l=-1!==o.indexOf(".");if(l)r=o.split("."),o=r.shift(),e.member=r.shift();else if(a){var c=o.split("(");o=c.shift();for(var u=0;u<c.length;u++)c[u]=parseInt(c[u].replace(/\)/,""));e.indices=c}return e.id=i,e.sid=o,e.arraySyntax=a,e.memberSyntax=l,e.sampler=s(t.getAttribute("source")),e}function _(t){var e=[],n=t.channels,r=t.samplers,i=t.sources;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o],s=r[a.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT,u=i[l],h=i[c],p=b(a,u,h);T(p,e)}return e}function x(t){return m(Te.animations[t],_)}function b(t,e,n){var r,i,o,a,s,l,c=Te.nodes[t.id],u=se(c.id),h=c.transforms[t.sid],p=c.matrix.clone().transpose(),d={};switch(h){case"matrix":for(o=0,a=e.array.length;o<a;o++)if(r=e.array[o],i=o*n.stride,void 0===d[r]&&(d[r]={}),!0===t.arraySyntax){var f=n.array[i],m=t.indices[0]+4*t.indices[1];d[r][m]=f}else for(s=0,l=n.stride;s<l;s++)d[r][s]=n.array[i+s];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h);break}var g=w(d,p),y={name:u.uuid,keyframes:g};return y}function w(t,e){var n=[];for(var r in t)n.push({time:parseFloat(r),value:t[r]});n.sort(o);for(var i=0;i<16;i++)A(n,i,e.elements[i]);return n;function o(t,e){return t.time-e.time}}var M=new r.Vector3,E=new r.Vector3,S=new r.Quaternion;function T(t,e){for(var n=t.keyframes,i=t.name,o=[],a=[],s=[],l=[],c=0,u=n.length;c<u;c++){var h=n[c],p=h.time,d=h.value;$t.fromArray(d).transpose(),$t.decompose(M,S,E),o.push(p),a.push(M.x,M.y,M.z),s.push(S.x,S.y,S.z,S.w),l.push(E.x,E.y,E.z)}return a.length>0&&e.push(new r.VectorKeyframeTrack(i+".position",o,a)),s.length>0&&e.push(new r.QuaternionKeyframeTrack(i+".quaternion",o,s)),l.length>0&&e.push(new r.VectorKeyframeTrack(i+".scale",o,l)),e}function A(t,e,n){var r,i,o,a=!0;for(i=0,o=t.length;i<o;i++)r=t[i],void 0===r.value[e]?r.value[e]=null:a=!1;if(!0===a)for(i=0,o=t.length;i<o;i++)r=t[i],r.value[e]=n;else C(t,e)}function C(t,e){for(var n,r,i=0,o=t.length;i<o;i++){var a=t[i];if(null===a.value[e]){if(n=L(t,i,e),r=I(t,i,e),null===n){a.value[e]=r.value[e];continue}if(null===r){a.value[e]=n.value[e];continue}P(a,n,r,e)}}}function L(t,e,n){while(e>=0){var r=t[e];if(null!==r.value[n])return r;e--}return null}function I(t,e,n){while(e<t.length){var r=t[e];if(null!==r.value[n])return r;e++}return null}function P(t,e,n,r){n.time-e.time!==0?t.value[r]=(t.time-e.time)*(n.value[r]-e.value[r])/(n.time-e.time)+e.value[r]:t.value[r]=e.value[r]}function R(t){for(var e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":e.animations.push(s(i.getAttribute("url")));break}}Te.clips[t.getAttribute("id")]=e}function O(t){for(var e=[],n=t.name,i=t.end-t.start||-1,o=t.animations,a=0,s=o.length;a<s;a++)for(var l=x(o[a]),c=0,u=l.length;c<u;c++)e.push(l[c]);return new r.AnimationClip(n,i,e)}function D(t){return m(Te.clips[t],O)}function N(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":e.id=s(i.getAttribute("source")),e.skin=k(i);break;case"morph":e.id=s(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}Te.controllers[t.getAttribute("id")]=e}function k(t){for(var e={sources:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=o(i.textContent);break;case"source":var a=i.getAttribute("id");e.sources[a]=wt(i);break;case"joints":e.joints=F(i);break;case"vertex_weights":e.vertexWeights=z(i);break}}return e}function F(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),a=s(i.getAttribute("source"));e.inputs[o]=a;break}}return e}function z(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),l=s(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));e.inputs[o]={id:l,offset:c};break;case"vcount":e.vcount=a(i.textContent);break;case"v":e.v=a(i.textContent);break}}return e}function B(t){var e={id:t.id},n=Te.geometries[e.id];return void 0!==t.skin&&(e.skin=U(t.skin),n.sources.skinIndices=e.skin.indices,n.sources.skinWeights=e.skin.weights),e}function U(t){var e,n,i,o=4,a={joints:[],indices:{array:[],stride:o},weights:{array:[],stride:o}},s=t.sources,l=t.vertexWeights,c=l.vcount,u=l.v,h=l.inputs.JOINT.offset,p=l.inputs.WEIGHT.offset,d=t.sources[t.joints.inputs.JOINT],f=t.sources[t.joints.inputs.INV_BIND_MATRIX],m=s[l.inputs.WEIGHT.id].array,g=0;for(e=0,i=c.length;e<i;e++){var y=c[e],v=[];for(n=0;n<y;n++){var _=u[g+h],x=u[g+p],b=m[x];v.push({index:_,weight:b}),g+=2}for(v.sort(S),n=0;n<o;n++){var w=v[n];void 0!==w?(a.indices.array.push(w.index),a.weights.array.push(w.weight)):(a.indices.array.push(0),a.weights.array.push(0))}}for(t.bindShapeMatrix?a.bindMatrix=(new r.Matrix4).fromArray(t.bindShapeMatrix).transpose():a.bindMatrix=(new r.Matrix4).identity(),e=0,i=d.array.length;e<i;e++){var M=d.array[e],E=(new r.Matrix4).fromArray(f.array,e*f.stride).transpose();a.joints.push({name:M,boneInverse:E})}return a;function S(t,e){return e.weight-t.weight}}function j(t){return m(Te.controllers[t],B)}function G(t){var e={init_from:n(t,"init_from")[0].textContent};Te.images[t.getAttribute("id")]=e}function V(t){return void 0!==t.build?t.build:t.init_from}function H(t){var e=Te.images[t];return void 0!==e?m(e,V):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function W(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":e.profile=q(i);break}}Te.effects[t.getAttribute("id")]=e}function q(t){for(var e={surfaces:{},samplers:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":X(i,e);break;case"technique":e.technique=$(i);break;case"extra":e.extra=nt(i);break}}return e}function X(t,e){for(var n=t.getAttribute("sid"),r=0,i=t.childNodes.length;r<i;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"surface":e.surfaces[n]=Z(o);break;case"sampler2D":e.samplers[n]=Y(o);break}}}function Z(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"init_from":e.init_from=i.textContent;break}}return e}function Y(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"source":e.source=i.textContent;break}}return e}function $(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=i.nodeName,e.parameters=J(i);break}}return e}function J(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[i.nodeName]=K(i);break;case"transparent":e[i.nodeName]={opaque:i.getAttribute("opaque"),data:K(i)};break}}return e}function K(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"color":e[i.nodeName]=o(i.textContent);break;case"float":e[i.nodeName]=parseFloat(i.textContent);break;case"texture":e[i.nodeName]={id:i.getAttribute("texture"),extra:Q(i)};break}}return e}function Q(t){for(var e={technique:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"extra":tt(i,e);break}}return e}function tt(t,e){for(var n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":et(i,e);break}}}function et(t,e){for(var n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?e.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?e.technique[i.nodeName]=0:e.technique[i.nodeName]=parseInt(i.textContent);break}}}function nt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":e.technique=rt(i);break}}return e}function rt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"double_sided":e[i.nodeName]=parseInt(i.textContent);break}}return e}function it(t){return t}function ot(t){return m(Te.effects[t],it)}function at(t){for(var e={name:t.getAttribute("name")},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":e.url=s(i.getAttribute("url"));break}}Te.materials[t.getAttribute("id")]=e}function st(t){var e,n=t.slice(2+(t.lastIndexOf(".")-1>>>0));switch(n=n.toLowerCase(),n){case"tga":e=xe;break;default:e=we}return e}function lt(t){var e,n=ot(t.url),i=n.profile.technique,o=n.profile.extra;switch(i.type){case"phong":case"blinn":e=new r.MeshPhongMaterial;break;case"lambert":e=new r.MeshLambertMaterial;break;default:e=new r.MeshBasicMaterial;break}function a(t){var e=n.profile.samplers[t.id],i=null;if(void 0!==e){var o=n.profile.surfaces[e.source];i=H(o.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=H(t.id);if(null!==i){var a=st(i);if(void 0!==a){var s=a.load(i),l=t.extra;if(void 0!==l&&void 0!==l.technique&&!1===c(l.technique)){var u=l.technique;s.wrapS=u.wrapU?r.RepeatWrapping:r.ClampToEdgeWrapping,s.wrapT=u.wrapV?r.RepeatWrapping:r.ClampToEdgeWrapping,s.offset.set(u.offsetU||0,u.offsetV||0),s.repeat.set(u.repeatU||1,u.repeatV||1)}else s.wrapS=r.RepeatWrapping,s.wrapT=r.RepeatWrapping;return s}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}e.name=t.name||"";var s=i.parameters;for(var l in s){var u=s[l];switch(l){case"diffuse":u.color&&e.color.fromArray(u.color),u.texture&&(e.map=a(u.texture));break;case"specular":u.color&&e.specular&&e.specular.fromArray(u.color),u.texture&&(e.specularMap=a(u.texture));break;case"bump":u.texture&&(e.normalMap=a(u.texture));break;case"ambient":u.texture&&(e.lightMap=a(u.texture));break;case"shininess":u.float&&e.shininess&&(e.shininess=u.float);break;case"emission":u.color&&e.emissive&&e.emissive.fromArray(u.color),u.texture&&(e.emissiveMap=a(u.texture));break}}var h=s["transparent"],p=s["transparency"];if(void 0===p&&h&&(p={float:1}),void 0===h&&p&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&p)if(h.data.texture)e.transparent=!0;else{var d=h.data.color;switch(h.opaque){case"A_ONE":e.opacity=d[3]*p.float;break;case"RGB_ZERO":e.opacity=1-d[0]*p.float;break;case"A_ZERO":e.opacity=1-d[3]*p.float;break;case"RGB_ONE":e.opacity=d[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}e.opacity<1&&(e.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(e.side=r.DoubleSide),e}function ct(t){return m(Te.materials[t],lt)}function ut(t){for(var e={name:t.getAttribute("name")},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"optics":e.optics=ht(i);break}}Te.cameras[t.getAttribute("id")]=e}function ht(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"technique_common":return pt(n)}}return{}}function pt(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":e.technique=r.nodeName,e.parameters=dt(r);break}}return e}function dt(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[r.nodeName]=parseFloat(r.textContent);break}}return e}function ft(t){var e;switch(t.optics.technique){case"perspective":e=new r.PerspectiveCamera(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var n=t.optics.parameters.ymag,i=t.optics.parameters.xmag,o=t.optics.parameters.aspect_ratio;i=void 0===i?n*o:i,n=void 0===n?i/o:n,i*=.5,n*=.5,e=new r.OrthographicCamera(-i,i,n,-n,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new r.PerspectiveCamera;break}return e.name=t.name||"",e}function mt(t){var e=Te.cameras[t];return void 0!==e?m(e,ft):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function gt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique_common":e=yt(i);break}}Te.lights[t.getAttribute("id")]=e}function yt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=i.nodeName,e.parameters=vt(i)}}return e}function vt(t){for(var e={},n=0,i=t.childNodes.length;n<i;n++){var a=t.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"color":var s=o(a.textContent);e.color=(new r.Color).fromArray(s);break;case"falloff_angle":e.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var l=parseFloat(a.textContent);e.distance=l?Math.sqrt(1/l):0;break}}return e}function _t(t){var e;switch(t.technique){case"directional":e=new r.DirectionalLight;break;case"point":e=new r.PointLight;break;case"spot":e=new r.SpotLight;break;case"ambient":e=new r.AmbientLight;break}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function xt(t){var e=Te.lights[t];return void 0!==e?m(e,_t):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function bt(t){var e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(t,"mesh")[0];if(void 0!==r){for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];if(1===o.nodeType){var a=o.getAttribute("id");switch(o.nodeName){case"source":e.sources[a]=wt(o);break;case"vertices":e.vertices=Mt(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(Et(o));break;default:console.log(o)}}}Te.geometries[t.getAttribute("id")]=e}}function wt(t){for(var e={array:[],stride:3},r=0;r<t.childNodes.length;r++){var a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"float_array":e.array=o(a.textContent);break;case"Name_array":e.array=i(a.textContent);break;case"technique_common":var s=n(a,"accessor")[0];void 0!==s&&(e.stride=parseInt(s.getAttribute("stride")));break}}return e}function Mt(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];1===r.nodeType&&(e[r.getAttribute("semantic")]=s(r.getAttribute("source")))}return e}function Et(t){for(var e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=s(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),h=u>0?l+u:l;e.inputs[h]={id:o,offset:c},e.stride=Math.max(e.stride,c+1),"TEXCOORD"===l&&(e.hasUV=!0);break;case"vcount":e.vcount=a(i.textContent);break;case"p":e.p=a(i.textContent);break}}return e}function St(t){for(var e={},n=0;n<t.length;n++){var r=t[n];void 0===e[r.type]&&(e[r.type]=[]),e[r.type].push(r)}return e}function Tt(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];!0===i.hasUV&&e++}e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function At(t){var e={},n=t.sources,r=t.vertices,i=t.primitives;if(0===i.length)return{};var o=St(i);for(var a in o){var s=o[a];Tt(s),e[a]=Ct(s,n,r)}return e}function Ct(t,e,n){for(var i={},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:0},u={array:[],stride:4},h={array:[],stride:4},p=new r.BufferGeometry,d=[],f=0,m=0;m<t.length;m++){var g=t[m],y=g.inputs,v=0;switch(g.type){case"lines":case"linestrips":v=2*g.count;break;case"triangles":v=3*g.count;break;case"polylist":for(var _=0;_<g.count;_++){var x=g.vcount[_];switch(x){case 3:v+=3;break;case 4:v+=6;break;default:v+=3*(x-2);break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var b in p.addGroup(f,v,m),f+=v,g.material&&d.push(g.material),y){var w=y[b];switch(b){case"VERTEX":for(var M in n){var E=n[M];switch(M){case"POSITION":var S=o.array.length;if(Lt(g,e[E],w.offset,o.array),o.stride=e[E].stride,e.skinWeights&&e.skinIndices&&(Lt(g,e.skinIndices,w.offset,u.array),Lt(g,e.skinWeights,w.offset,h.array)),!1===g.hasUV&&!0===t.uvsNeedsFix){v=(o.array.length-S)/o.stride;for(var T=0;T<v;T++)s.array.push(0,0)}break;case"NORMAL":Lt(g,e[E],w.offset,a.array),a.stride=e[E].stride;break;case"COLOR":Lt(g,e[E],w.offset,c.array),c.stride=e[E].stride;break;case"TEXCOORD":Lt(g,e[E],w.offset,s.array),s.stride=e[E].stride;break;case"TEXCOORD1":Lt(g,e[E],w.offset,l.array),s.stride=e[E].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',M)}}break;case"NORMAL":Lt(g,e[w.id],w.offset,a.array),a.stride=e[w.id].stride;break;case"COLOR":Lt(g,e[w.id],w.offset,c.array),c.stride=e[w.id].stride;break;case"TEXCOORD":Lt(g,e[w.id],w.offset,s.array),s.stride=e[w.id].stride;break;case"TEXCOORD1":Lt(g,e[w.id],w.offset,l.array),l.stride=e[w.id].stride;break}}}return o.array.length>0&&p.setAttribute("position",new r.Float32BufferAttribute(o.array,o.stride)),a.array.length>0&&p.setAttribute("normal",new r.Float32BufferAttribute(a.array,a.stride)),c.array.length>0&&p.setAttribute("color",new r.Float32BufferAttribute(c.array,c.stride)),s.array.length>0&&p.setAttribute("uv",new r.Float32BufferAttribute(s.array,s.stride)),l.array.length>0&&p.setAttribute("uv2",new r.Float32BufferAttribute(l.array,l.stride)),u.array.length>0&&p.setAttribute("skinIndex",new r.Float32BufferAttribute(u.array,u.stride)),h.array.length>0&&p.setAttribute("skinWeight",new r.Float32BufferAttribute(h.array,h.stride)),i.data=p,i.type=t[0].type,i.materialKeys=d,i}function Lt(t,e,n,r){var i=t.p,o=t.stride,a=t.vcount;function s(t){for(var e=i[t+n]*c,o=e+c;e<o;e++)r.push(l[e])}var l=e.array,c=e.stride;if(void 0!==t.vcount)for(var u=0,h=0,p=a.length;h<p;h++){var d=a[h];if(4===d){var f=u+0*o,m=u+1*o,g=u+2*o,y=u+3*o;s(f),s(m),s(y),s(m),s(g),s(y)}else if(3===d){f=u+0*o,m=u+1*o,g=u+2*o;s(f),s(m),s(g)}else if(d>4)for(var v=1,_=d-2;v<=_;v++){f=u+0*o,m=u+o*v,g=u+o*(v+1);s(f),s(m),s(g)}u+=o*d}else for(h=0,p=i.length;h<p;h+=o)s(h)}function It(t){return m(Te.geometries[t],At)}function Pt(t){for(var e={name:t.getAttribute("name")||"",joints:{},links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":Dt(r,e);break}}Te.kinematicsModels[t.getAttribute("id")]=e}function Rt(t){return void 0!==t.build?t.build:t}function Ot(t){return m(Te.kinematicsModels[t],Rt)}function Dt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":e.joints[r.getAttribute("sid")]=Nt(r);break;case"link":e.links.push(Ft(r));break}}}function Nt(t){for(var e,n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":e=kt(r);break}}return e}function kt(t,e){e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new r.Vector3,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"axis":var a=o(i.textContent);e.axis.fromArray(a);break;case"limits":var s=i.getElementsByTagName("max")[0],l=i.getElementsByTagName("min")[0];e.limits.max=parseFloat(s.textContent),e.limits.min=parseFloat(l.textContent);break}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function Ft(t){for(var e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":e.attachments.push(zt(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(Bt(r));break}}return e}function zt(t){for(var e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":e.links.push(Ft(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(Bt(r));break}}return e}function Bt(t){var e={type:t.nodeName},n=o(t.textContent);switch(e.type){case"matrix":e.obj=new r.Matrix4,e.obj.fromArray(n).transpose();break;case"translate":e.obj=new r.Vector3,e.obj.fromArray(n);break;case"rotate":e.obj=new r.Vector3,e.obj.fromArray(n),e.angle=r.MathUtils.degToRad(n[3]);break}return e}function Ut(t){for(var e={name:t.getAttribute("name")||"",rigidBodies:{}},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"rigid_body":e.rigidBodies[r.getAttribute("name")]={},jt(r,e.rigidBodies[r.getAttribute("name")]);break}}Te.physicsModels[t.getAttribute("id")]=e}function jt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":Gt(r,e);break}}}function Gt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":e.inertia=o(r.textContent);break;case"mass":e.mass=o(r.textContent)[0];break}}}function Vt(t){for(var e={bindJointAxis:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":e.bindJointAxis.push(Ht(r));break}}Te.kinematicsScenes[s(t.getAttribute("url"))]=e}function Ht(t){for(var e={target:t.getAttribute("target").split("/").pop()},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var i=r.getElementsByTagName("param")[0];e.axis=i.textContent;var o=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=o.substr(0,o.length-1);break}}return e}function Wt(t){return void 0!==t.build?t.build:t}function qt(t){return m(Te.kinematicsScenes[t],Wt)}function Xt(){var t=Object.keys(Te.kinematicsModels)[0],e=Object.keys(Te.kinematicsScenes)[0],n=Object.keys(Te.visualScenes)[0];if(void 0!==t&&void 0!==e){for(var i=Ot(t),o=qt(e),a=he(n),s=o.bindJointAxis,l={},c=0,u=s.length;c<u;c++){var h=s[c],p=ge.querySelector('[sid="'+h.target+'"]');if(p){var d=p.parentElement;m(h.jointIndex,d)}}var f=new r.Matrix4;Ee={joints:i&&i.joints,getJointValue:function(t){var e=l[t];if(e)return e.position;console.warn("THREE.ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){var n=l[t];if(n){var i=n.joint;if(e>i.limits.max||e<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{var o=n.object,a=i.axis,s=n.transforms;$t.identity();for(var c=0;c<s.length;c++){var u=s[c];if(u.sid&&-1!==u.sid.indexOf(t))switch(i.type){case"revolute":$t.multiply(f.makeRotationAxis(a,r.MathUtils.degToRad(e)));break;case"prismatic":$t.multiply(f.makeTranslation(a.x*e,a.y*e,a.z*e));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type);break}else switch(u.type){case"matrix":$t.multiply(u.obj);break;case"translate":$t.multiply(f.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":$t.scale(u.obj);break;case"rotate":$t.multiply(f.makeRotationAxis(u.obj,u.angle));break}}o.matrix.copy($t),o.matrix.decompose(o.position,o.quaternion,o.scale),l[t].position=e}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}function m(t,e){var n=e.getAttribute("name"),r=i.joints[t];a.traverse((function(i){i.name===n&&(l[t]={object:i,transforms:Zt(e),joint:r,position:r.zeroPosition})}))}}function Zt(t){for(var e=[],n=ge.querySelector('[id="'+t.id+'"]'),i=0;i<n.childNodes.length;i++){var a=n.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"matrix":var s=o(a.textContent),l=(new r.Matrix4).fromArray(s).transpose();e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"translate":case"scale":s=o(a.textContent);var c=(new r.Vector3).fromArray(s);e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:c});break;case"rotate":s=o(a.textContent),c=(new r.Vector3).fromArray(s);var u=r.MathUtils.degToRad(s[3]);e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:c,angle:u});break}}return e}function Yt(t){for(var e=t.getElementsByTagName("node"),n=0;n<e.length;n++){var r=e[n];!1===r.hasAttribute("id")&&r.setAttribute("id",l())}}var $t=new r.Matrix4,Jt=new r.Vector3;function Kt(t){for(var e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new r.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"node":e.nodes.push(i.getAttribute("id")),Kt(i);break;case"instance_camera":e.instanceCameras.push(s(i.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(Qt(i));break;case"instance_light":e.instanceLights.push(s(i.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(Qt(i));break;case"instance_node":e.instanceNodes.push(s(i.getAttribute("url")));break;case"matrix":var a=o(i.textContent);e.matrix.multiply($t.fromArray(a).transpose()),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"translate":a=o(i.textContent);Jt.fromArray(a),e.matrix.multiply($t.makeTranslation(Jt.x,Jt.y,Jt.z)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"rotate":a=o(i.textContent);var l=r.MathUtils.degToRad(a[3]);e.matrix.multiply($t.makeRotationAxis(Jt.fromArray(a),l)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"scale":a=o(i.textContent);e.matrix.scale(Jt.fromArray(a)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"extra":break;default:console.log(i)}}return ae(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):Te.nodes[e.id]=e,e}function Qt(t){for(var e={id:s(t.getAttribute("url")),materials:{},skeletons:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"bind_material":for(var i=r.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var a=i[o],l=a.getAttribute("symbol"),c=a.getAttribute("target");e.materials[l]=s(c)}break;case"skeleton":e.skeletons.push(s(r.textContent));break;default:break}}return e}function te(t,e){var n,i,o=[],a=[];for(n=0;n<t.length;n++){var s=t[n];if(ae(s))p=se(s),ee(p,e,o);else if(ue(s))for(var l=Te.visualScenes[s],c=l.children,u=0;u<c.length;u++){var h=c[u];if("JOINT"===h.type){var p=se(h.id);ee(p,e,o)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(n=0;n<e.length;n++)for(u=0;u<o.length;u++)if(i=o[u],i.bone.name===e[n].name){a[n]=i,i.processed=!0;break}for(n=0;n<o.length;n++)i=o[n],!1===i.processed&&(a.push(i),i.processed=!0);var d=[],f=[];for(n=0;n<a.length;n++)i=a[n],d.push(i.bone),f.push(i.boneInverse);return new r.Skeleton(d,f)}function ee(t,e,n){t.traverse((function(t){if(!0===t.isBone){for(var i,o=0;o<e.length;o++){var a=e[o];if(a.name===t.name){i=a.boneInverse;break}}void 0===i&&(i=new r.Matrix4),n.push({bone:t,boneInverse:i,processed:!1})}}))}function ne(t){for(var e=[],n=t.matrix,i=t.nodes,o=t.type,a=t.instanceCameras,s=t.instanceControllers,l=t.instanceLights,c=t.instanceGeometries,u=t.instanceNodes,h=0,p=i.length;h<p;h++)e.push(se(i[h]));for(h=0,p=a.length;h<p;h++){var d=mt(a[h]);null!==d&&e.push(d.clone())}for(h=0,p=s.length;h<p;h++)for(var f=s[h],m=j(f.id),g=It(m.id),y=oe(g,f.materials),v=f.skeletons,_=m.skin.joints,x=te(v,_),b=0,w=y.length;b<w;b++){var M=y[b];M.isSkinnedMesh&&(M.bind(x,m.skin.bindMatrix),M.normalizeSkinWeights()),e.push(M)}for(h=0,p=l.length;h<p;h++){var E=xt(l[h]);null!==E&&e.push(E.clone())}for(h=0,p=c.length;h<p;h++)for(f=c[h],g=It(f.id),y=oe(g,f.materials),b=0,w=y.length;b<w;b++)e.push(y[b]);for(h=0,p=u.length;h<p;h++)e.push(se(u[h]).clone());if(0===i.length&&1===e.length)M=e[0];else{M="JOINT"===o?new r.Bone:new r.Group;for(h=0;h<e.length;h++)M.add(e[h])}return M.name="JOINT"===o?t.sid:t.name,M.matrix.copy(n),M.matrix.decompose(M.position,M.quaternion,M.scale),M}var re=new r.MeshBasicMaterial({color:16711935});function ie(t,e){for(var n=[],r=0,i=t.length;r<i;r++){var o=e[t[r]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[r]),n.push(re)):n.push(ct(o))}return n}function oe(t,e){var n=[];for(var i in t){var o=t[i],a=ie(o.materialKeys,e);0===a.length&&("lines"===i||"linestrips"===i?a.push(new r.LineBasicMaterial):a.push(new r.MeshPhongMaterial));var s=void 0!==o.data.attributes.skinIndex;if(s)for(var l=0,c=a.length;l<c;l++)a[l].skinning=!0;var u,h=1===a.length?a[0]:a;switch(i){case"lines":u=new r.LineSegments(o.data,h);break;case"linestrips":u=new r.Line(o.data,h);break;case"triangles":case"polylist":u=s?new r.SkinnedMesh(o.data,h):new r.Mesh(o.data,h);break}n.push(u)}return n}function ae(t){return void 0!==Te.nodes[t]}function se(t){return m(Te.nodes[t],ne)}function le(t){var e={name:t.getAttribute("name"),children:[]};Yt(t);for(var r=n(t,"node"),i=0;i<r.length;i++)e.children.push(Kt(r[i]));Te.visualScenes[t.getAttribute("id")]=e}function ce(t){var e=new r.Group;e.name=t.name;for(var n=t.children,i=0;i<n.length;i++){var o=n[i];e.add(se(o.id))}return e}function ue(t){return void 0!==Te.visualScenes[t]}function he(t){return m(Te.visualScenes[t],ce)}function pe(t){var e=n(t,"instance_visual_scene")[0];return he(s(e.getAttribute("url")))}function de(){var t=Te.clips;if(!0===c(t)){if(!1===c(Te.animations)){var e=[];for(var n in Te.animations)for(var i=x(n),o=0,a=i.length;o<a;o++)e.push(i[o]);Me.push(new r.AnimationClip("default",-1,e))}}else for(var n in t)Me.push(D(n))}function fe(t){var e="",n=[t];while(n.length){var r=n.shift();r.nodeType===Node.TEXT_NODE?e+=r.textContent:(e+="\n",n.push.apply(n,r.childNodes))}return e.trim()}if(0===t.length)return{scene:new r.Scene};var me=(new DOMParser).parseFromString(t,"application/xml"),ge=n(me,"COLLADA")[0],ye=me.getElementsByTagName("parsererror")[0];if(void 0!==ye){var ve,_e=n(ye,"div")[0];return ve=_e?_e.textContent:fe(ye),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",ve),null}ge.getAttribute("version");var xe,be=u(n(ge,"asset")[0]),we=new r.TextureLoader(this.manager);we.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin),r.TGALoader&&(xe=new r.TGALoader(this.manager),xe.setPath(this.resourcePath||e));var Me=[],Ee={},Se=0,Te={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};d(ge,"library_animations","animation",g),d(ge,"library_animation_clips","animation_clip",R),d(ge,"library_controllers","controller",N),d(ge,"library_images","image",G),d(ge,"library_effects","effect",W),d(ge,"library_materials","material",at),d(ge,"library_cameras","camera",ut),d(ge,"library_lights","light",gt),d(ge,"library_geometries","geometry",bt),d(ge,"library_nodes","node",Kt),d(ge,"library_visual_scenes","visual_scene",le),d(ge,"library_kinematics_models","kinematics_model",Pt),d(ge,"library_physics_models","physics_model",Ut),d(ge,"scene","instance_kinematics_scene",Vt),f(Te.animations,_),f(Te.clips,O),f(Te.controllers,B),f(Te.images,V),f(Te.effects,it),f(Te.materials,lt),f(Te.cameras,ft),f(Te.lights,_t),f(Te.geometries,At),f(Te.visualScenes,ce),de(),Xt();var Ae=pe(n(ge,"scene")[0]);return"Z_UP"===be.upAxis&&Ae.quaternion.setFromEuler(new r.Euler(-Math.PI/2,0,0)),Ae.scale.multiplyScalar(be.unit),{animations:Me,kinematics:Ee,library:Te,scene:Ae}}}),t.exports=r.ColladaLoader},"916e":function(t,e,n){"use strict";function r(t,e){this.x=t,this.y=e}t.exports=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(t){return t instanceof r?t:Array.isArray(t)?new r(t[0],t[1]):t}},"93b5":function(t,e,n){var r=n("7bc4"),i=n("b258"),o=n("182d"),a={prettyPrintMatrix:function(t){for(var e=0;e<4;e++){var n=[t[e],t[e+4],t[e+8],t[e+12]];console.log(n.map((function(t){return t.toFixed(4)})))}},makePerspectiveMatrix:function(t,e,n,i){var o=new r.Matrix4,a=1/Math.tan(t/2),s=1/(n-i),l=[a/e,0,0,0,0,a,0,0,0,0,(i+n)*s,-1,0,0,2*i*n*s,0];return o.elements=l,o},makeOrthographicMatrix:function(t,e,n,i,o,a){var s=new r.Matrix4;const l=1/(e-t),c=1/(n-i),u=1/(a-o),h=(e+t)*l,p=(n+i)*c,d=o*u;var f=[2*l,0,0,0,0,2*c,0,0,0,0,-1*u,0,-h,-p,-d,1];return s.elements=f,s},radify:function(t){function e(t){return t=t||0,2*Math.PI*t/360}return"object"===typeof t?t.length>0?t.map((function(t){return e(t)})):[e(t.x),e(t.y),e(t.z)]:e(t)},degreeify:function(t){function e(t){return t=t||0,360*t/(2*Math.PI)}return"object"===typeof t?[e(t.x),e(t.y),e(t.z)]:e(t)},projectToWorld:function(t){var e=[-i.MERCATOR_A*i.DEG2RAD*t[0]*i.PROJECTION_WORLD_SIZE,-i.MERCATOR_A*Math.log(Math.tan(.25*Math.PI+.5*i.DEG2RAD*t[1]))*i.PROJECTION_WORLD_SIZE];if(t[2]){var n=this.projectedUnitsPerMeter(t[1]);e.push(t[2]*n)}else e.push(0);var o=new r.Vector3(e[0],e[1],e[2]);return o},projectedUnitsPerMeter:function(t){return Math.abs(i.WORLD_SIZE/Math.cos(i.DEG2RAD*t)/i.EARTH_CIRCUMFERENCE)},_circumferenceAtLatitude:function(t){return i.EARTH_CIRCUMFERENCE*Math.cos(t*Math.PI/180)},mercatorZfromAltitude:function(t,e){return t/this._circumferenceAtLatitude(e)},_scaleVerticesToMeters:function(t,e){for(var n=this.projectedUnitsPerMeter(t[1]),r=(this.projectToWorld(t),0);r<e.length;r++)e[r].multiplyScalar(n);return e},projectToScreen:function(t){console.log("WARNING: Projecting to screen coordinates is not yet implemented")},unprojectFromScreen:function(t){console.log("WARNING: unproject is not yet implemented")},unprojectFromWorld:function(t){var e=[-t.x/(i.MERCATOR_A*i.DEG2RAD*i.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(t.y/(i.PROJECTION_WORLD_SIZE*-i.MERCATOR_A)))-Math.PI/4)/i.DEG2RAD],n=this.projectedUnitsPerMeter(e[1]),r=t.z||0;return e.push(r/n),e},toScreenPosition:function(t,e){var n=new r.Vector3,i=.5*renderer.context.canvas.width,o=.5*renderer.context.canvas.height;return t.updateMatrixWorld(),n.setFromMatrixPosition(t.matrixWorld),n.project(e),n.x=n.x*i+i,n.y=-n.y*o+o,{x:n.x,y:n.y}},getFeatureCenter:function(t,e,n){let r=[],i=0,o=0,a=0,s=[...t.geometry.coordinates[0]];return"Point"===t.geometry.type?r=[...s[0]]:("MultiPolygon"===t.geometry.type&&(s=s[0]),s.splice(-1,1),s.forEach((function(t){i+=t[0],o+=t[1]})),r=[i/s.length,o/s.length]),a=this.getObjectHeightOnFloor(t,e,n),r.length<3?r.push(a):r[2]=a,r},getObjectHeightOnFloor:function(t,e,n=t.properties.level||0){let r=n*(t.properties.levelHeight||0),i=t.properties.base_height||t.properties.min_height||0,o=e&&e.model?0:t.properties.height-i,a=o+i,s=r+a;return s},_flipMaterialSides:function(t){},normalizeVertices(t){var e=new r.Geometry;for(let r of t)e.vertices.push(r);e.computeBoundingSphere();var n=e.boundingSphere.center,i=(e.boundingSphere.radius,t.map((function(t){var e=t.sub(n);return e})));return{vertices:i,position:n}},flattenVectors(t){var e=[];for(let n of t)e.push(n.x,n.y,n.z);return e},lnglatsToWorld:function(t){var e=t.map((function(t){var e=a.projectToWorld(t),n=new r.Vector3(e.x,e.y,e.z);return n}));return e},extend:function(t,e){for(let n in e)t[n]=e[n]},clone:function(t){var e={};for(let n in t)e[n]=t[n];return e},clamp:function(t,e,n){return Math.min(n,Math.max(e,t))},types:{rotation:function(t,e){t||(t=0),"number"===typeof t&&(t={z:t});var n=this.applyDefault([t.x,t.y,t.z],e),r=a.radify(n);return r},scale:function(t,e){return t||(t=1),"number"===typeof t?[t,t,t]:this.applyDefault([t.x,t.y,t.z],e)},applyDefault:function(t,e){var n=t.map((function(t,n){return t=t||e[n],t}));return n}},toDecimal:function(t,e){return Number(t.toFixed(e))},equal:function(t,e){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;if(0==n.length&&0==r.length&&n!==r)return!1;for(const i of n){const n=t[i],r=e[i],o=this.isObject(n)&&this.isObject(r);if(o&&!equal(n,r)||!o&&n!==r)return!1}return!0},isObject:function(t){return null!=t&&"object"===typeof t},curveToLine:(t,e)=>{let{width:n,color:i}=e,o=(new r.BufferGeometry).setFromPoints(t.getPoints(100)),a=new r.LineBasicMaterial({color:i,linewidth:n}),s=new r.Line(o,a);return s},curvesToLines:t=>{var e=[16711680,2031360,2490623],n=t.map((t,n)=>{let r={width:3,color:e[n]||"purple"},i=curveToLine(t,r);return i});return n},_validate:function(t,e){t=t||{};var n={};a.extend(n,t);for(let r of Object.keys(e))if(void 0===t[r]){if(null===e[r])return void console.error(r+" is required");n[r]=e[r]}else n[r]=t[r];return n},Validator:new o,exposedMethods:["projectToWorld","projectedUnitsPerMeter","extend","unprojectFromWorld"]};t.exports=a},"95ed":function(t,e,n){var r=n("3a0e"),i=n("ae6f"),o=n("b44c");t.exports=function(t){if(!t)return[];var e=i(r(t)),n=[];return e.features.forEach((function(t){t.geometry&&(n=n.concat(o(t.geometry.coordinates)))})),n}},"95f0":function(t,e,n){const r=n("a53c"),i=function(t,e){r.call(this,t,e),this.coordinates=this.coordinates.map(t=>t.slice(0,-1))};i.prototype=Object.create(r.prototype),i.prototype.isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(t=>t.length>2)},i.prototype.incomingCoords=function(t){this.coordinates=t.map(t=>t.slice(0,-1)),this.changed()},i.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},i.prototype.addCoordinate=function(t,e,n){this.changed();const r=t.split(".").map(t=>parseInt(t,10)),i=this.coordinates[r[0]];i.splice(r[1],0,[e,n])},i.prototype.removeCoordinate=function(t){this.changed();const e=t.split(".").map(t=>parseInt(t,10)),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},i.prototype.getCoordinate=function(t){const e=t.split(".").map(t=>parseInt(t,10)),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},i.prototype.getCoordinates=function(){return this.coordinates.map(t=>t.concat([t[0]]))},i.prototype.updateCoordinate=function(t,e,n){this.changed();const r=t.split("."),i=parseInt(r[0],10),o=parseInt(r[1],10);void 0===this.coordinates[i]&&(this.coordinates[i]=[]),this.coordinates[i][o]=[e,n]},t.exports=i},9724:function(t,e,n){const r=n("e133");t.exports=function(t,e,n,i){return{type:r.geojsonTypes.FEATURE,properties:{meta:r.meta.VERTEX,parent:t,coord_path:n,active:i?r.activeStates.ACTIVE:r.activeStates.INACTIVE},geometry:{type:r.geojsonTypes.POINT,coordinates:e}}}},a3c1:function(t,e,n){const r=n("7bc4");r.GLTFLoader=function(){function t(t){r.Loader.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.pluginCallbacks=[],this.register((function(t){return new s(t)}))}function e(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}t.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:t,load:function(t,e,n,i){var o,a=this;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.LoaderUtils.extractUrlBase(t),a.manager.itemStart(t);var s=function(e){i?i(e):console.error(e),a.manager.itemError(t),a.manager.itemEnd(t)},l=new r.FileLoader(a.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),"use-credentials"===a.crossOrigin&&l.setWithCredentials(!0),l.load(t,(function(n){try{a.parse(n,o,(function(n){e(n),a.manager.itemEnd(t)}),s)}catch(r){s(r)}}),n,s)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},register:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},unregister:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},parse:function(t,e,s,c){var u,f={},y={};if("string"===typeof t)u=t;else{var v=r.LoaderUtils.decodeText(new Uint8Array(t,0,4));if(v===l){try{f[n.KHR_BINARY_GLTF]=new h(t)}catch(S){return void(c&&c(S))}u=f[n.KHR_BINARY_GLTF].content}else u=r.LoaderUtils.decodeText(new Uint8Array(t))}var _=JSON.parse(u);if(void 0===_.asset||_.asset.version[0]<2)c&&c(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var x=new k(_,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});x.fileLoader.setRequestHeader(this.requestHeader);for(var b=0;b<this.pluginCallbacks.length;b++){var w=this.pluginCallbacks[b](x);y[w.name]=w,f[w.name]=!0}if(_.extensionsUsed)for(b=0;b<_.extensionsUsed.length;++b){var M=_.extensionsUsed[b],E=_.extensionsRequired||[];switch(M){case n.KHR_LIGHTS_PUNCTUAL:f[M]=new o(_);break;case n.KHR_MATERIALS_UNLIT:f[M]=new a;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[M]=new m;break;case n.KHR_DRACO_MESH_COMPRESSION:f[M]=new p(_,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:f[M]=new i(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:f[M]=new d;break;case n.KHR_MESH_QUANTIZATION:f[M]=new g;break;default:E.indexOf(M)>=0&&void 0===y[M]&&console.warn('THREE.GLTFLoader: Unknown extension "'+M+'".')}}x.setExtensions(f),x.setPlugins(y),x.parse(s,c)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=t}function o(t){this.name=n.KHR_LIGHTS_PUNCTUAL;var e=t.extensions&&t.extensions[n.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=e.lights||[]}function a(){this.name=n.KHR_MATERIALS_UNLIT}function s(t){this.parser=t,this.name=n.KHR_MATERIALS_CLEARCOAT}o.prototype.loadLight=function(t){var e,n=this.lightDefs[t],i=new r.Color(16777215);void 0!==n.color&&i.fromArray(n.color);var o=void 0!==n.range?n.range:0;switch(n.type){case"directional":e=new r.DirectionalLight(i),e.target.position.set(0,0,-1),e.add(e.target);break;case"point":e=new r.PointLight(i),e.distance=o;break;case"spot":e=new r.SpotLight(i),e.distance=o,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,e.angle=n.spot.outerConeAngle,e.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,e.target.position.set(0,0,-1),e.add(e.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return e.position.set(0,0,0),e.decay=2,void 0!==n.intensity&&(e.intensity=n.intensity),e.name=n.name||"light_"+t,Promise.resolve(e)},a.prototype.getMaterialType=function(){return r.MeshBasicMaterial},a.prototype.extendParams=function(t,e,n){var i=[];t.color=new r.Color(1,1,1),t.opacity=1;var o=e.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){var a=o.baseColorFactor;t.color.fromArray(a),t.opacity=a[3]}void 0!==o.baseColorTexture&&i.push(n.assignTexture(t,"map",o.baseColorTexture))}return Promise.all(i)},s.prototype.getMaterialType=function(){return r.MeshPhysicalMaterial},s.prototype.extendMaterialParams=function(t,e){var n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(e.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&o.push(n.assignTexture(e,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(e.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&o.push(n.assignTexture(e,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(o.push(n.assignTexture(e,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var s=a.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new r.Vector2(s,s)}return Promise.all(o)};var l="glTF",c=12,u={JSON:1313821514,BIN:5130562};function h(t){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,c);if(this.header={magic:r.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==l)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var i=new DataView(t,c),o=0;while(o<i.byteLength){var a=i.getUint32(o,!0);o+=4;var s=i.getUint32(o,!0);if(o+=4,s===u.JSON){var h=new Uint8Array(t,c+o,a);this.content=r.LoaderUtils.decodeText(h)}else if(s===u.BIN){var p=c+o;this.body=t.slice(p,p+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function p(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function d(){this.name=n.KHR_TEXTURE_TRANSFORM}function f(t){r.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),s={specular:{value:(new r.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(t){for(var r in s)t.uniforms[r]=s[r];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),t.fragmentShader=t.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_pars_fragment>",e),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_pars_fragment>",n),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_fragment>",i),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_fragment>",o),t.fragmentShader=t.fragmentShader.replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(t){s.specular.value=t}},specularMap:{get:function(){return s.specularMap.value},set:function(t){s.specularMap.value=t}},glossiness:{get:function(){return s.glossiness.value},set:function(t){s.glossiness.value=t}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(t){s.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function m(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return f},extendParams:function(t,e,n){var i=e.extensions[this.name];t.color=new r.Color(1,1,1),t.opacity=1;var o=[];if(Array.isArray(i.diffuseFactor)){var a=i.diffuseFactor;t.color.fromArray(a),t.opacity=a[3]}if(void 0!==i.diffuseTexture&&o.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new r.Color(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new r.Color(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var s=i.specularGlossinessTexture;o.push(n.assignTexture(t,"glossinessMap",s)),o.push(n.assignTexture(t,"specularMap",s))}return Promise.all(o)},createMaterial:function(t){var e=new f(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=r.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function g(){this.name=n.KHR_MESH_QUANTIZATION}function y(t,e,n,i){r.Interpolant.call(this,t,e,n,i)}p.prototype.decodePrimitive=function(t,e){var n=this.json,r=this.dracoLoader,i=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},s={},l={};for(var c in o){var u=M[c]||c.toLowerCase();a[u]=o[c]}for(c in t.attributes){u=M[c]||c.toLowerCase();if(void 0!==o[c]){var h=n.accessors[t.attributes[c]],p=_[h.componentType];l[u]=p,s[u]=!0===h.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){r.decodeDracoFile(t,(function(t){for(var n in t.attributes){var r=t.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}e(t)}),a,l)}))}))},d.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},f.prototype=Object.create(r.MeshStandardMaterial.prototype),f.prototype.constructor=f,f.prototype.copy=function(t){return r.MeshStandardMaterial.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},y.prototype=Object.create(r.Interpolant.prototype),y.prototype.constructor=y,y.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r,o=0;o!==r;o++)e[o]=n[i+o];return e},y.prototype.beforeStart_=y.prototype.copySampleValue_,y.prototype.afterEnd_=y.prototype.copySampleValue_,y.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=r-e,u=(n-e)/c,h=u*u,p=h*u,d=t*l,f=d-l,m=-2*p+3*h,g=p-h,y=1-m,v=g-h+u,_=0;_!==a;_++){var x=o[f+_+a],b=o[f+_+s]*c,w=o[d+_+a],M=o[d+_]*c;i[_]=y*x+v*b+m*w+g*M}return i};var v={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x={9728:r.NearestFilter,9729:r.LinearFilter,9984:r.NearestMipmapNearestFilter,9985:r.LinearMipmapNearestFilter,9986:r.NearestMipmapLinearFilter,9987:r.LinearMipmapLinearFilter},b={33071:r.ClampToEdgeWrapping,33648:r.MirroredRepeatWrapping,10497:r.RepeatWrapping},w={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},E={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},S={CUBICSPLINE:void 0,LINEAR:r.InterpolateLinear,STEP:r.InterpolateDiscrete},T={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},A={"image/png":r.RGBAFormat,"image/jpeg":r.RGBFormat};function C(t,e){return"string"!==typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function L(t){return void 0===t["DefaultMaterial"]&&(t["DefaultMaterial"]=new r.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.FrontSide})),t["DefaultMaterial"]}function I(t,e,n){for(var r in n.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function P(t,e){void 0!==e.extras&&("object"===typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function R(t,e,n){for(var r=!1,i=!1,o=0,a=e.length;o<a;o++){var s=e[o];if(void 0!==s.POSITION&&(r=!0),void 0!==s.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(t);var l=[],c=[];for(o=0,a=e.length;o<a;o++){s=e[o];if(r){var u=void 0!==s.POSITION?n.getDependency("accessor",s.POSITION):t.attributes.position;l.push(u)}if(i){u=void 0!==s.NORMAL?n.getDependency("accessor",s.NORMAL):t.attributes.normal;c.push(u)}}return Promise.all([Promise.all(l),Promise.all(c)]).then((function(e){var n=e[0],o=e[1];return r&&(t.morphAttributes.position=n),i&&(t.morphAttributes.normal=o),t.morphTargetsRelative=!0,t}))}function O(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){var i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)t.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function D(t){var e,r=t.extensions&&t.extensions[n.KHR_DRACO_MESH_COMPRESSION];return e=r?"draco:"+r.bufferView+":"+r.indices+":"+N(r.attributes):t.indices+":"+N(t.attributes)+":"+t.mode,e}function N(t){for(var e="",n=Object.keys(t).sort(),r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function k(t,n){this.json=t||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new e,this.associations=new Map,this.primitiveCache={},this.useImageBitmap="undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent),this.useImageBitmap?this.textureLoader=new r.ImageBitmapLoader(this.options.manager):this.textureLoader=new r.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new r.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function F(t,e,n){var i=e.attributes,o=new r.Box3;if(void 0!==i.POSITION){var a=n.json.accessors[i.POSITION],s=a.min,l=a.max;if(void 0!==s&&void 0!==l){o.set(new r.Vector3(s[0],s[1],s[2]),new r.Vector3(l[0],l[1],l[2]));var c=e.targets;if(void 0!==c){for(var u=new r.Vector3,h=new r.Vector3,p=0,d=c.length;p<d;p++){var f=c[p];if(void 0!==f.POSITION){a=n.json.accessors[f.POSITION],s=a.min,l=a.max;void 0!==s&&void 0!==l?(h.setX(Math.max(Math.abs(s[0]),Math.abs(l[0]))),h.setY(Math.max(Math.abs(s[1]),Math.abs(l[1]))),h.setZ(Math.max(Math.abs(s[2]),Math.abs(l[2]))),u.max(h)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(u)}t.boundingBox=o;var m=new r.Sphere;o.getCenter(m.center),m.radius=o.min.distanceTo(o.max)/2,t.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function z(t,e,n){var r=e.attributes,i=[];function o(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(var a in r){var s=M[a]||a.toLowerCase();s in t.attributes||i.push(o(r[a],s))}if(void 0!==e.indices&&!t.index){var l=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(l)}return P(t,e),F(t,e,n),Promise.all(i).then((function(){return void 0!==e.targets?R(t,e.targets,n):t}))}function B(t,e){var n=t.getIndex();if(null===n){var i=[],o=t.getAttribute("position");if(void 0===o)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var a=0;a<o.count;a++)i.push(a);t.setIndex(i),n=t.getIndex()}var s=n.count-2,l=[];if(e===r.TriangleFanDrawMode)for(a=1;a<=s;a++)l.push(n.getX(0)),l.push(n.getX(a)),l.push(n.getX(a+1));else for(a=0;a<s;a++)a%2===0?(l.push(n.getX(a)),l.push(n.getX(a+1)),l.push(n.getX(a+2))):(l.push(n.getX(a+2)),l.push(n.getX(a+1)),l.push(n.getX(a)));l.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=t.clone();return c.setIndex(l),c}return k.prototype.setExtensions=function(t){this.extensions=t},k.prototype.setPlugins=function(t){this.plugins=t},k.prototype.parse=function(t,e){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(e){var o={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};I(i,o,r),P(o,r),t(o)})).catch(e)},k.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],r={},i={},o=0,a=e.length;o<a;o++)for(var s=e[o].joints,l=0,c=s.length;l<c;l++)t[s[l]].isBone=!0;for(var u=0,h=t.length;u<h;u++){var p=t[u];void 0!==p.mesh&&(void 0===r[p.mesh]&&(r[p.mesh]=i[p.mesh]=0),r[p.mesh]++,void 0!==p.skin&&(n[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=i},k.prototype._invokeOne=function(t){var e=Object.values(this.plugins);e.push(this);for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}},k.prototype._invokeAll=function(t){var e=Object.values(this.plugins);e.unshift(this);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r]));return Promise.all(n)},k.prototype.getDependency=function(t,e){var r=t+":"+e,i=this.cache.get(r);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this.loadTexture(e);break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;case"light":i=this.extensions[n.KHR_LIGHTS_PUNCTUAL].loadLight(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,i)}return i},k.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e},k.prototype.loadBuffer=function(t){var e=this.json.buffers[t],r=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(t,n){r.load(C(e.uri,i.path),t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},k.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))},k.prototype.loadAccessor=function(t){var e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var o=[];return void 0!==i.bufferView?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),void 0!==i.sparse&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then((function(t){var o,a,s=t[0],l=w[i.type],c=_[i.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,p=i.byteOffset||0,d=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,f=!0===i.normalized;if(d&&d!==h){var m=Math.floor(p/d),g="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+m+":"+i.count,y=e.cache.get(g);y||(o=new c(s,m*d,i.count*d/u),y=new r.InterleavedBuffer(o,d/u),e.cache.add(g,y)),a=new r.InterleavedBufferAttribute(y,l,p%d/u,f)}else o=null===s?new c(i.count*l):new c(s,p,i.count*l),a=new r.BufferAttribute(o,l,f);if(void 0!==i.sparse){var v=w.SCALAR,x=_[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,M=i.sparse.values.byteOffset||0,E=new x(t[1],b,i.sparse.count*v),S=new c(t[2],M,i.sparse.count*l);null!==s&&(a=new r.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(var T=0,A=E.length;T<A;T++){var C=E[T];if(a.setX(C,S[T*l]),l>=2&&a.setY(C,S[T*l+1]),l>=3&&a.setZ(C,S[T*l+2]),l>=4&&a.setW(C,S[T*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))},k.prototype.loadTexture=function(t){var e,i=this,o=this.json,a=this.options,s=this.useImageBitmap,l=this.textureLoader,c=self.URL||self.webkitURL,u=o.textures[t],h=u.extensions||{};e=h[n.MSFT_TEXTURE_DDS]?o.images[h[n.MSFT_TEXTURE_DDS].source]:o.images[u.source];var p=e.uri,d=!1;return void 0!==e.bufferView&&(p=i.getDependency("bufferView",e.bufferView).then((function(t){d=!0;var n=new Blob([t],{type:e.mimeType});return p=c.createObjectURL(n),p}))),Promise.resolve(p).then((function(t){var e=a.manager.getHandler(t);return e||(e=h[n.MSFT_TEXTURE_DDS]?i.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:l),new Promise((function(n,i){var o=n;s&&(o=function(t){n(new r.CanvasTexture(t))}),e.load(C(t,a.path),o,void 0,i)}))})).then((function(n){!0===d&&c.revokeObjectURL(p),n.flipY=!1,u.name&&(n.name=u.name),e.mimeType in A&&(n.format=A[e.mimeType]);var a=o.samplers||{},s=a[u.sampler]||{};return n.magFilter=x[s.magFilter]||r.LinearFilter,n.minFilter=x[s.minFilter]||r.LinearMipmapLinearFilter,n.wrapS=b[s.wrapS]||r.RepeatWrapping,n.wrapT=b[s.wrapT]||r.RepeatWrapping,i.associations.set(n,{type:"textures",index:t}),n}))},k.prototype.assignTexture=function(t,e,i){var o=this;return this.getDependency("texture",i.index).then((function(a){if(!a.isCompressedTexture)switch(e){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":a.format=r.RGBFormat;break}if(void 0===i.texCoord||0==i.texCoord||"aoMap"===e&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+e+" not yet supported."),o.extensions[n.KHR_TEXTURE_TRANSFORM]){var s=void 0!==i.extensions?i.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var l=o.associations.get(a);a=o.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(a,s),o.associations.set(a,l)}}t[e]=a}))},k.prototype.assignFinalMaterial=function(t){var e=t.geometry,n=t.material,i=void 0!==e.attributes.tangent,o=void 0!==e.attributes.color,a=void 0===e.attributes.normal,s=!0===t.isSkinnedMesh,l=Object.keys(e.morphAttributes).length>0,c=l&&void 0!==e.morphAttributes.normal;if(t.isPoints){var u="PointsMaterial:"+n.uuid,h=this.cache.get(u);h||(h=new r.PointsMaterial,r.Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(u,h)),n=h}else if(t.isLine){u="LineBasicMaterial:"+n.uuid;var p=this.cache.get(u);p||(p=new r.LineBasicMaterial,r.Material.prototype.copy.call(p,n),p.color.copy(n.color),this.cache.add(u,p)),n=p}if(i||o||a||s||l){u="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),s&&(u+="skinning:"),i&&(u+="vertex-tangents:"),o&&(u+="vertex-colors:"),a&&(u+="flat-shading:"),l&&(u+="morph-targets:"),c&&(u+="morph-normals:");var d=this.cache.get(u);d||(d=n.clone(),s&&(d.skinning=!0),i&&(d.vertexTangents=!0),o&&(d.vertexColors=!0),a&&(d.flatShading=!0),l&&(d.morphTargets=!0),c&&(d.morphNormals=!0),this.cache.add(u,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),n.normalScale&&!i&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!i&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),t.material=n},k.prototype.getMaterialType=function(){return r.MeshStandardMaterial},k.prototype.loadMaterial=function(t){var e,i=this,o=this.json,a=this.extensions,s=o.materials[t],l={},c=s.extensions||{},u=[];if(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=h.getMaterialType(),u.push(h.extendParams(l,s,i))}else if(c[n.KHR_MATERIALS_UNLIT]){var p=a[n.KHR_MATERIALS_UNLIT];e=p.getMaterialType(),u.push(p.extendParams(l,s,i))}else{var d=s.pbrMetallicRoughness||{};if(l.color=new r.Color(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){var m=d.baseColorFactor;l.color.fromArray(m),l.opacity=m[3]}void 0!==d.baseColorTexture&&u.push(i.assignTexture(l,"map",d.baseColorTexture)),l.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,l.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(u.push(i.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),u.push(i.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),u.push(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,l)})))}!0===s.doubleSided&&(l.side=r.DoubleSide);var g=s.alphaMode||T.OPAQUE;return g===T.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,g===T.MASK&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&e!==r.MeshBasicMaterial&&(u.push(i.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new r.Vector2(1,1),void 0!==s.normalTexture.scale&&l.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&e!==r.MeshBasicMaterial&&(u.push(i.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&e!==r.MeshBasicMaterial&&(l.emissive=(new r.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&e!==r.MeshBasicMaterial&&u.push(i.assignTexture(l,"emissiveMap",s.emissiveTexture)),Promise.all(u).then((function(){var o;return o=e===f?a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new e(l),s.name&&(o.name=s.name),o.map&&(o.map.encoding=r.sRGBEncoding),o.emissiveMap&&(o.emissiveMap.encoding=r.sRGBEncoding),P(o,s),i.associations.set(o,{type:"materials",index:t}),s.extensions&&I(a,o,s),o}))},k.prototype.loadGeometries=function(t){var e=this,i=this.extensions,o=this.primitiveCache;function a(t){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return z(n,t,e)}))}for(var s=[],l=0,c=t.length;l<c;l++){var u,h=t[l],p=D(h),d=o[p];if(d)s.push(d.promise);else u=h.extensions&&h.extensions[n.KHR_DRACO_MESH_COMPRESSION]?a(h):z(new r.BufferGeometry,h,e),o[p]={primitive:h,promise:u},s.push(u)}return Promise.all(s)},k.prototype.loadMesh=function(t){for(var e=this,n=this.json,i=n.meshes[t],o=i.primitives,a=[],s=0,l=o.length;s<l;s++){var c=void 0===o[s].material?L(this.cache):this.getDependency("material",o[s].material);a.push(c)}return a.push(e.loadGeometries(o)),Promise.all(a).then((function(n){for(var a=n.slice(0,n.length-1),s=n[n.length-1],l=[],c=0,u=s.length;c<u;c++){var h,p=s[c],d=o[c],f=a[c];if(d.mode===v.TRIANGLES||d.mode===v.TRIANGLE_STRIP||d.mode===v.TRIANGLE_FAN||void 0===d.mode)h=!0===i.isSkinnedMesh?new r.SkinnedMesh(p,f):new r.Mesh(p,f),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),d.mode===v.TRIANGLE_STRIP?h.geometry=B(h.geometry,r.TriangleStripDrawMode):d.mode===v.TRIANGLE_FAN&&(h.geometry=B(h.geometry,r.TriangleFanDrawMode));else if(d.mode===v.LINES)h=new r.LineSegments(p,f);else if(d.mode===v.LINE_STRIP)h=new r.Line(p,f);else if(d.mode===v.LINE_LOOP)h=new r.LineLoop(p,f);else{if(d.mode!==v.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new r.Points(p,f)}Object.keys(h.geometry.morphAttributes).length>0&&O(h,i),h.name=i.name||"mesh_"+t,s.length>1&&(h.name+="_"+c),P(h,i),e.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];var m=new r.Group;for(c=0,u=l.length;c<u;c++)m.add(l[c]);return m}))},k.prototype.loadCamera=function(t){var e,n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new r.PerspectiveCamera(r.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new r.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=n.name),P(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},k.prototype.loadSkin=function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))},k.prototype.loadAnimation=function(t){for(var e=this.json,n=e.animations[t],i=[],o=[],a=[],s=[],l=[],c=0,u=n.channels.length;c<u;c++){var h=n.channels[c],p=n.samplers[h.sampler],d=h.target,f=void 0!==d.node?d.node:d.id,m=void 0!==n.parameters?n.parameters[p.input]:p.input,g=void 0!==n.parameters?n.parameters[p.output]:p.output;i.push(this.getDependency("node",f)),o.push(this.getDependency("accessor",m)),a.push(this.getDependency("accessor",g)),s.push(p),l.push(d)}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(s),Promise.all(l)]).then((function(e){for(var i=e[0],o=e[1],a=e[2],s=e[3],l=e[4],c=[],u=0,h=i.length;u<h;u++){var p=i[u],d=o[u],f=a[u],m=s[u],g=l[u];if(void 0!==p){var v;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,E[g.path]){case E.weights:v=r.NumberKeyframeTrack;break;case E.rotation:v=r.QuaternionKeyframeTrack;break;case E.position:case E.scale:default:v=r.VectorKeyframeTrack;break}var _=p.name?p.name:p.uuid,x=void 0!==m.interpolation?S[m.interpolation]:r.InterpolateLinear,b=[];E[g.path]===E.weights?p.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&b.push(t.name?t.name:t.uuid)})):b.push(_);var w=f.array;if(f.normalized){var M;if(w.constructor===Int8Array)M=1/127;else if(w.constructor===Uint8Array)M=1/255;else if(w.constructor==Int16Array)M=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");M=1/65535}for(var T=new Float32Array(w.length),A=0,C=w.length;A<C;A++)T[A]=w[A]*M;w=T}for(A=0,C=b.length;A<C;A++){var L=new v(b[A]+"."+E[g.path],d.array,w,x);"CUBICSPLINE"===m.interpolation&&(L.createInterpolant=function(t){return new y(this.times,this.values,this.getValueSize()/3,t)},L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(L)}}}var I=n.name?n.name:"animation_"+t;return new r.AnimationClip(I,void 0,c)}))},k.prototype.loadNode=function(t){var e=this.json,i=this.extensions,o=this,a=e.meshReferences,s=e.meshUses,l=e.nodes[t];return function(){var t=[];return void 0!==l.mesh&&t.push(o.getDependency("mesh",l.mesh).then((function(t){var e;if(a[l.mesh]>1){var n=s[l.mesh]++;e=t.clone(),e.name+="_instance_"+n}else e=t;return void 0!==l.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,n=l.weights.length;e<n;e++)t.morphTargetInfluences[e]=l.weights[e]})),e}))),void 0!==l.camera&&t.push(o.getDependency("camera",l.camera)),l.extensions&&l.extensions[n.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[n.KHR_LIGHTS_PUNCTUAL].light&&t.push(o.getDependency("light",l.extensions[n.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)}().then((function(e){var n;if(n=!0===l.isBone?new r.Bone:e.length>1?new r.Group:1===e.length?e[0]:new r.Object3D,n!==e[0])for(var a=0,s=e.length;a<s;a++)n.add(e[a]);if(l.name&&(n.userData.name=l.name,n.name=r.PropertyBinding.sanitizeNodeName(l.name)),P(n,l),l.extensions&&I(i,n,l),void 0!==l.matrix){var c=new r.Matrix4;c.fromArray(l.matrix),n.applyMatrix4(c)}else void 0!==l.translation&&n.position.fromArray(l.translation),void 0!==l.rotation&&n.quaternion.fromArray(l.rotation),void 0!==l.scale&&n.scale.fromArray(l.scale);return o.associations.set(n,{type:"nodes",index:t}),n}))},k.prototype.loadScene=function(){function t(e,n,i,o){var a=i.nodes[e];return o.getDependency("node",e).then((function(t){return void 0===a.skin?t:o.getDependency("skin",a.skin).then((function(t){e=t;for(var n=[],r=0,i=e.joints.length;r<i;r++)n.push(o.getDependency("node",e.joints[r]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(t.isMesh){for(var i=[],o=[],a=0,s=n.length;a<s;a++){var l=n[a];if(l){i.push(l);var c=new r.Matrix4;void 0!==e.inverseBindMatrices&&c.fromArray(e.inverseBindMatrices.array,16*a),o.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[a])}t.bind(new r.Skeleton(i,o),t.matrixWorld)}})),t}));var e})).then((function(e){n.add(e);var r=[];if(a.children)for(var s=a.children,l=0,c=s.length;l<c;l++){var u=s[l];r.push(t(u,e,i,o))}return Promise.all(r)}))}return function(e){var n=this.json,i=this.extensions,o=this.json.scenes[e],a=this,s=new r.Group;o.name&&(s.name=o.name),P(s,o),o.extensions&&I(i,s,o);for(var l=o.nodes||[],c=[],u=0,h=l.length;u<h;u++)c.push(t(l[u],s,n,a));return Promise.all(c).then((function(){return s}))}}(),t}(),t.exports=r.GLTFLoader},a454:function(t,e,n){const r=n("8d7b"),i=n("6e61"),o=n("0172"),a=n("e133");t.exports=function(t){t.events=r(t),t.map=null,t.container=null,t.store=null,t.ui=o(t);let e=null;const n={onRemove:function(){return n.removeLayers(),t.ui.removeButtons(),t.events.removeEventListeners(),t.map=null,t.container=null,t.store=null,e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this},onAdd:function(r){t.map=r,t.container=r.getContainer(),t.store=new i(t),e=t.ui.addButtons(),t.options.boxSelect&&(r.boxZoom.disable(),r.dragPan.disable(),r.dragPan.enable());let o=null;const a=()=>{r.off("load",a),clearInterval(o),n.addLayers(),t.events.addEventListeners()};return r.loaded()?a():(r.on("load",a),o=setInterval(()=>{r.loaded()&&a()},16)),e},addLayers:function(){t.map.addSource(a.sources.COLD,{data:{type:a.geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(a.sources.HOT,{data:{type:a.geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach(e=>{t.map.addLayer(e)}),t.store.render()},removeLayers:function(){t.options.styles.forEach(e=>{t.map.removeLayer(e.id)}),t.map.removeSource(a.sources.COLD),t.map.removeSource(a.sources.HOT)}};return t.setup=n,n}},a4f5:function(t,e,n){const r=n("93b5"),i=(n("4338"),n("7bc4")),a=n("c7bf"),s=n("2788");function l(){}l.prototype={line:function(t){t=r._validate(t,this._defaults.line);var e=r.lnglatsToWorld(t.geometry),n=r.normalizeVertices(e),o=r.flattenVectors(n.vertices),a=new Float32Array(o),s=new i.BufferGeometry;s.setAttribute("position",new i.BufferAttribute(a,3));var l=new i.LineBasicMaterial({color:16711680,linewidth:21}),c=new i.Line(s,l);return c.options=options||{},c.position.copy(n.position),c},extrusion:function(t){},unenroll:function(t,e){var n=this;e||n.animationManager.unenroll(t)},_addMethods:function(t,e){var n=this;const o="label",a="tooltip",c="help",u="shadowPlane";if(e);else{function h(t,e,n,i){let o=r.radify(i);t.position.sub(e),t.position.applyAxisAngle(n,o),t.position.add(e),t.rotateOnAxis(n,o),tb.map.repaint=!0}t.coordinates||(t.coordinates=[0,0,0]),Object.defineProperty(t,"model",{get(){return t.getObjectByName("model")}}),Object.defineProperty(t,"animations",{get(){const e=t.model;return e?e.animations:null}}),n.animationManager.enroll(t),t.setCoords=function(e){return t.userData.topMargin&&t.userData.feature&&(e[2]+=((t.userData.feature.properties.height||0)-(t.userData.feature.properties.base_height||t.userData.feature.properties.min_height||0))*(t.userData.topMargin||0)),t.coordinates=e,t.set({position:e}),t},t.setTranslate=function(e){return t.set({translate:e}),t},t.setRotation=function(e){"number"===typeof e&&(e={z:e});var n={x:r.radify(e.x)||t.rotation.x,y:r.radify(e.y)||t.rotation.y,z:r.radify(e.z)||t.rotation.z};t._setObject({rotation:[n.x,n.y,n.z]})},t.calculateAdjustedPosition=function(e,n,i){let o=e.slice(),a=r.unprojectFromWorld(t.modelSize);return i?(o[0]-=0!=n.x?a[0]/n.x:0,o[1]-=0!=n.y?a[1]/n.y:0,o[2]-=0!=n.z?a[2]/n.z:0):(o[0]+=0!=n.x?a[0]/n.x:0,o[1]+=0!=n.y?a[1]/n.y:0,o[2]+=0!=n.z?a[2]/n.z:0),o},t.setRotationAxis=function(e){"number"===typeof e&&(e={z:e});let n=t.modelBox(),r=new i.Vector3(n.max.x,n.max.y,n.min.z);0!=e.x&&h(t,r,new i.Vector3(0,0,1),e.x),0!=e.y&&h(t,r,new i.Vector3(0,0,1),e.y),0!=e.z&&h(t,r,new i.Vector3(0,0,1),e.z)},Object.defineProperty(t,"scaleGroup",{get(){return t.getObjectByName("scaleGroup")}}),Object.defineProperty(t,"boxGroup",{get(){return t.getObjectByName("boxGroup")}}),Object.defineProperty(t,"boundingBox",{get(){return t.getObjectByName("boxModel")}}),Object.defineProperty(t,"boundingBoxShadow",{get(){return t.getObjectByName("boxShadow")}}),t.drawBoundingBox=function(){let e=t.box3(),n=new i.Group;n.name="boxGroup",n.updateMatrixWorld(!0);let r=new i.Box3Helper(e,l.prototype._defaults.colors.yellow);r.name="boxModel",n.add(r),r.layers.disable(0);let o=e.clone();o.max.z=o.min.z;let a=new i.Box3Helper(o,l.prototype._defaults.colors.black);a.name="boxShadow",n.add(a),a.layers.disable(0),n.visible=!1,t.scaleGroup.add(n),t.setBoundingBoxShadowFloor()},t.setBoundingBoxShadowFloor=function(){if(t.boundingBoxShadow){let e=-t.modelHeight,n=t.rotation,r=t.boundingBoxShadow;r.box.max.z=r.box.min.z=e,r.rotation.y=n.y,r.rotation.x=-n.x}},t.setAnchor=function(e){const n=t.box3(),r=n.getCenter(new i.Vector3);switch(t.none={x:0,y:0,z:0},t.center={x:r.x,y:r.y,z:n.min.z},t.bottom={x:r.x,y:n.max.y,z:n.min.z},t.bottomLeft={x:n.max.x,y:n.max.y,z:n.min.z},t.bottomRight={x:n.min.x,y:n.max.y,z:n.min.z},t.top={x:r.x,y:n.min.y,z:n.min.z},t.topLeft={x:n.max.x,y:n.min.y,z:n.min.z},t.topRight={x:n.min.x,y:n.min.y,z:n.min.z},t.left={x:n.max.x,y:r.y,z:n.min.z},t.right={x:n.min.x,y:r.y,z:n.min.z},e){case"center":t.anchor=t.center;break;case"top":t.anchor=t.top;break;case"top-left":t.anchor=t.topLeft;break;case"top-right":t.anchor=t.topRight;break;case"left":t.anchor=t.left;break;case"right":t.anchor=t.right;break;case"bottom":t.anchor=t.bottom;break;case"bottom-left":default:t.anchor=t.bottomLeft;break;case"bottom-right":t.anchor=t.bottomRight;break;case"auto":case"none":t.anchor=t.none}t.model.position.set(-t.anchor.x,-t.anchor.y,-t.anchor.z)},t.setCenter=function(e){if(e&&(0!=e.x||0!=e.y||0!=e.z)){let n=t.getSize();t.anchor={x:t.anchor.x-n.x*e.x,y:t.anchor.y-n.y*e.y,z:t.anchor.z-n.z*e.z},t.model.position.set(-t.anchor.x,-t.anchor.y,-t.anchor.z)}},Object.defineProperty(t,"label",{get(){return t.getObjectByName(o)}}),Object.defineProperty(t,"tooltip",{get(){return t.getObjectByName(a)}}),Object.defineProperty(t,"help",{get(){return t.getObjectByName(c)}}),Object.defineProperty(t,"visibility",{get(){return t.visible},set(e){let n=e;if("visible"==e||1==e)n=!0,t.label&&(t.label.visible=n);else{if("none"!=e&&0!=e)return;n=!1,t.label&&t.label.alwaysVisible&&(t.label.visible=n),t.tooltip&&(t.tooltip.visible=n)}t.visible!=n&&(t.visible=n,t.model&&t.model.traverse((function(e){"Mesh"!=e.type&&"SkinnedMesh"!=e.type||(n&&t.raycasted?e.layers.enable(0):e.layers.disable(0)),"LineSegments"==e.type&&e.layers.disableAll()})))}}),t.addLabel=function(e,n,r,i){e&&t.drawLabelHTML(e,n,r,i)},t.removeLabel=function(){t.removeCSS2D(o)},t.drawLabelHTML=function(e,r=!1,i=t.anchor,a=.5){let s=n.drawLabelHTML(e,l.prototype._defaults.label.cssClass),c=t.addCSS2D(s,o,i,a);return c.alwaysVisible=r,c.visible=r,c},t.addTooltip=function(e,n,r,i=!0,o=1){let s=t.addHelp(e,a,n,r,o);s.visible=!1,s.custom=i},t.removeTooltip=function(){t.removeCSS2D(a)},t.addHelp=function(e,r=c,i=!1,o=t.anchor,a=0){let s=n.drawTooltip(e,i),l=t.addCSS2D(s,r,o,a);return l.visible=!0,l},t.removeHelp=function(){t.removeCSS2D(c)},t.addCSS2D=function(e,n,r=t.anchor,o=1){if(e){const a=t.box3(),l=a.getSize(new i.Vector3);let c={x:a.max.x,y:a.max.y,z:a.min.z};t.removeCSS2D(n);let u=new s.CSS2DObject(e);return u.name=n,u.position.set(.5*-l.x-t.model.position.x-r.x+c.x,.5*-l.y-t.model.position.y-r.y+c.y,l.z*o),u.visible=!1,t.scaleGroup.add(u),u}},t.removeCSS2D=function(e){let n=t.getObjectByName(e);if(n){n.dispose();let e=t.scaleGroup.children;e.splice(e.indexOf(n),1)}},Object.defineProperty(t,"shadowPlane",{get(){return t.getObjectByName(u)}});let e=!1;Object.defineProperty(t,"castShadow",{get(){return e},set(n){if(t.model&&e!==n){if(t.model.traverse((function(t){t.isMesh&&(t.castShadow=!0)})),n){const e=t.modelSize,r=[e.x,e.y,e.z,t.modelHeight],o=10*Math.max(...r),a=new i.PlaneBufferGeometry(o,o),s=new i.ShadowMaterial;s.opacity=.5;let l=new i.Mesh(a,s);l.name=u,l.layers.enable(1),l.layers.disable(0),l.receiveShadow=n,t.add(l)}else t.traverse((function(e){e.isMesh&&e.material instanceof i.ShadowMaterial&&t.remove(e)}));e=n}}}),t.setReceiveShadowFloor=function(){if(t.castShadow){let e=t.shadowPlane,n=e.position,r=e.rotation;if(n.z=-t.modelHeight,r.y=t.rotation.y,r.x=-t.rotation.x,"meters"===t.userData.units){const r=t.modelSize,i=[r.x,r.y,r.z,-n.z],o=10*Math.max(...i),a=o/e.geometry.parameters.width;e.scale.set(a,a,a)}}};let d=!1;Object.defineProperty(t,"receiveShadow",{get(){return d},set(e){t.model&&d!==e&&(t.model.traverse((function(t){t.isMesh&&(t.receiveShadow=!0)})),d=e)}});let f=!1;Object.defineProperty(t,"wireframe",{get(){return f},set(e){t.model&&f!==e&&(t.model.traverse((function(t){if("Mesh"==t.type||"SkinnedMesh"==t.type){let n=[];if(Array.isArray(t.material)?n=t.material:n.push(t.material),e)t.userData.materials=n,t.material=l.prototype._defaults.materials.wireframeMaterial,t.material.opacity=e?.5:1,t.material.wireframe=e,t.material.transparent=e;else{let e=t.userData.materials;t.material=e.length>1?e:e[0],t.userData.materials=null}e?(t.layers.disable(0),t.layers.enable(1)):(t.layers.disable(1),t.layers.enable(0))}"LineSegments"==t.type&&t.layers.disableAll()})),f=e,t.dispatchEvent(new CustomEvent("Wireframed",{detail:t,bubbles:!0,cancelable:!0})))}});let m=!1;Object.defineProperty(t,"selected",{get(){return m},set(e){e?(t.userData.bbox&&!t.boundingBox&&t.drawBoundingBox(),t.boxGroup&&(t.boundingBox.material=l.prototype._defaults.materials.boxSelectedMaterial,t.boundingBox.parent.visible=!0,t.boundingBox.layers.enable(1),t.boundingBoxShadow.layers.enable(1)),t.label&&!t.label.alwaysVisible&&(t.label.visible=!0)):(t.boxGroup&&t.remove(t.boxGroup),t.label&&!t.label.alwaysVisible&&(t.label.visible=!1),t.removeHelp()),t.tooltip&&(t.tooltip.visible=e),m!=e&&(m=e,t.dispatchEvent(new CustomEvent("SelectedChange",{detail:t,bubbles:!0,cancelable:!0})))}});let g=!0;Object.defineProperty(t,"raycasted",{get(){return g},set(e){t.model&&g!==e&&(t.model.traverse((function(t){"Mesh"!=t.type&&"SkinnedMesh"!=t.type||(e?(t.layers.disable(1),t.layers.enable(0)):(t.layers.disable(0),t.layers.enable(1)))})),g=e)}});let y=!1;Object.defineProperty(t,"over",{get(){return y},set(e){e?(t.selected||(t.userData.bbox&&!t.boundingBox&&t.drawBoundingBox(),t.userData.tooltip&&!t.tooltip&&t.addTooltip(t.uuid,!0,t.anchor,!1),t.boxGroup&&(t.boundingBox.material=l.prototype._defaults.materials.boxOverMaterial,t.boundingBox.parent.visible=!0,t.boundingBox.layers.enable(1),t.boundingBoxShadow.layers.enable(1))),t.label&&!t.label.alwaysVisible&&(t.label.visible=!0),t.dispatchEvent(new CustomEvent("ObjectMouseOver",{detail:t,bubbles:!0,cancelable:!0}))):(t.selected||(t.boxGroup&&(t.remove(t.boxGroup),t.tooltip&&!t.tooltip.custom&&t.removeTooltip()),t.label&&!t.label.alwaysVisible&&(t.label.visible=!1)),t.dispatchEvent(new CustomEvent("ObjectMouseOut",{detail:t,bubbles:!0,cancelable:!0}))),t.tooltip&&(t.tooltip.visible=e||t.selected),y=e}}),t.box3=function(){let e;if(t.updateMatrix(),t.updateMatrixWorld(!0,!0),t.model){let n=t.clone(!0),r=t.model.clone();if(e=(new i.Box3).setFromObject(r),t.parent){let o=new i.Matrix4,a=new i.Matrix4;t.matrix.extractRotation(o),o.getInverse(a),n.setRotationFromMatrix(a),e=(new i.Box3).setFromObject(r)}}return e},t.modelBox=function(){return t.box3()},t.getSize=function(){return t.box3().getSize(new i.Vector3(0,0,0))};let v=!1;Object.defineProperty(t,"modelSize",{get(){return v=t.getSize(),v},set(t){v!=t&&(v=t)}}),Object.defineProperty(t,"modelHeight",{get(){let e=t.coordinates[2]||0;return"scene"===t.userData.units&&(e*=t.unitsPerMeter/t.scale.x),e}}),Object.defineProperty(t,"unitsPerMeter",{get(){return Number(r.projectedUnitsPerMeter(t.coordinates[1]).toFixed(7))}});function p(t){return Math.pow(2,t)}Object.defineProperty(t,"fixedZoom",{get(){return t.userData.fixedZoom},set(e){t.userData.fixedZoom!==e&&(t.userData.fixedZoom=e,t.userData.units=e?"scene":"meters")}}),t.setFixedZoom=function(e){if(null!=t.fixedZoom){e||(e=t.userData.mapScale);let n=p(t.fixedZoom);if(n>e){let r=n/e;t.scale.set(r,r,r)}else t.scale.set(1,1,1)}},t.setScale=function(e){if("meters"!==t.userData.units||t.fixedZoom)t.fixedZoom?(e&&(t.userData.mapScale=e),t.setFixedZoom(t.userData.mapScale)):t.scale.set(1,1,1);else{let e=t.unitsPerMeter;t.scale.set(e,e,e)}},t.setObjectScale=function(e){t.setScale(e),t.setBoundingBoxShadowFloor(),t.setReceiveShadowFloor()}}t.add=function(e){return t.scaleGroup.add(e),e.position.z=t.coordinates[2]?-t.coordinates[2]:0,e},t.remove=function(e){e&&(e.traverse(t=>{if(t.geometry&&t.geometry.dispose(),t.material)if(t.material.isMaterial)d(t.material);else for(const e of t.material)d(e);t.dispose&&t.dispose()}),t.scaleGroup.remove(e),tb.map.repaint=!0)},t.duplicate=function(e){let i=t.clone(!0);if(i.getObjectByName("model").animations=t.animations,i.userData.feature&&(e&&e.feature&&(i.userData.feature=e.feature),i.userData.feature.properties.uuid=i.uuid),n._addMethods(i),!e||r.equal(e.scale,t.userData.scale))return i.copyAnchor(t),i;{i.userData=e,i.userData.isGeoGroup=!0,i.remove(i.boxGroup);const t=r.types.rotation(e.rotation,[0,0,0]),n=r.types.scale(e.scale,[1,1,1]);return i.model.position.set(0,0,0),i.model.rotation.set(t[0],t[1],t[2]),i.model.scale.set(n[0],n[1],n[2]),i.setAnchor(e.anchor),i.setCenter(e.adjustment),i}},t.copyAnchor=function(e){t.anchor=e.anchor,t.none={x:0,y:0,z:0},t.center=e.center,t.bottom=e.bottom,t.bottomLeft=e.bottomLeft,t.bottomRight=e.bottomRight,t.top=e.top,t.topLeft=e.topLeft,t.topRight=e.topRight,t.left=e.left,t.right=e.right},t.dispose=function(){l.prototype.unenroll(t),t.traverse(t=>{if((!t.parent||"world"!=t.parent.name)&&"threeboxObject"!==t.name){if(t.geometry&&t.geometry.dispose(),t.material)if(t.material.isMaterial)d(t.material);else for(const e of t.material)d(e);t.dispose&&t.dispose()}}),t.children=[]};const d=t=>{t.dispose();for(const r of Object.keys(t)){const e=t[r];e&&"object"===typeof e&&"minFilter"in e&&e.dispose()}let e=t,n=e.map||e.alphaMap||e.aoMap||e.bumpMap||e.displacementMap||e.emissiveMap||e.envMap||e.lightMap||e.metalnessMap||e.normalMap||e.roughnessMap;n&&(e.map&&e.map.dispose(),e.alphaMap&&e.alphaMap.dispose(),e.aoMap&&e.aoMap.dispose(),e.bumpMap&&e.bumpMap.dispose(),e.displacementMap&&e.displacementMap.dispose(),e.emissiveMap&&e.emissiveMap.dispose(),e.envMap&&e.envMap.dispose(),e.lightMap&&e.lightMap.dispose(),e.metalnessMap&&e.metalnessMap.dispose(),e.normalMap&&e.normalMap.dispose(),e.roughnessMap&&e.roughnessMap.dispose())};return t},_makeGroup:function(t,e){let n=new i.Group;n.name="scaleGroup",n.add(t);var r=new i.Group;r.userData=e||{},r.userData.isGeoGroup=!0,r.userData.feature&&(r.userData.feature.properties.uuid=r.uuid);var a=n.length;if(a)for(o of n)r.add(o);else r.add(n);return r.name="threeboxObject",r},animationManager:new a,drawTooltip:function(t,e=!1){if(t){let n;if(e){let e=document.createElement("div");e.className="mapboxgl-popup-content";let r=document.createElement("strong");r.innerHTML=t,e.appendChild(r);let i=document.createElement("div");i.className="mapboxgl-popup-tip";let o=document.createElement("div");o.className="marker mapboxgl-popup-anchor-bottom",o.appendChild(i),o.appendChild(e),n=document.createElement("div"),n.className+="label3D",n.appendChild(o)}else n=document.createElement("span"),n.className=this._defaults.tooltip.cssClass,n.innerHTML=t;return n}},drawLabelHTML:function(t,e){let n=document.createElement("div");return n.className+=e,n.innerHTML="string"==typeof t?t:t.outerHTML,n},_defaults:{colors:{red:new i.Color(16711680),yellow:new i.Color(16776960),green:new i.Color(65280),black:new i.Color(0)},materials:{wireframeMaterial:new i.LineBasicMaterial({color:new i.Color(16777215)}),boxNormalMaterial:new i.LineBasicMaterial({color:new i.Color(16711680)}),boxOverMaterial:new i.LineBasicMaterial({color:new i.Color(16776960)}),boxSelectedMaterial:new i.LineBasicMaterial({color:new i.Color(65280)})},line:{geometry:null,color:"black",width:1,opacity:1},label:{htmlElement:null,cssClass:" label3D",alwaysVisible:!1,topMargin:-.5},tooltip:{text:"",cssClass:"toolTip text-xs",mapboxStyle:!1,topMargin:0,feature:null},sphere:{position:[0,0,0],radius:1,sides:20,units:"scene",material:"MeshBasicMaterial",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},tube:{geometry:null,radius:1,sides:6,units:"scene",material:"MeshBasicMaterial",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0},loadObj:{type:null,obj:null,units:"scene",scale:1,rotation:0,defaultAnimation:0,anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},Object3D:{obj:null,units:"scene",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},extrusion:{coordinates:[[[]]],geometryOptions:{},height:100,materials:null,scale:1,rotation:0,units:"scene",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0}},geometries:{line:["LineString"],tube:["LineString"],sphere:["Point"]}},t.exports=l},a53c:function(t,e,n){const r=n("55b1"),i=n("e133"),o=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||r(),this.type=e.geometry.type};o.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},o.prototype.incomingCoords=function(t){this.setCoordinates(t)},o.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},o.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},o.prototype.setProperty=function(t,e){this.properties[t]=e},o.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:i.geojsonTypes.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},o.prototype.internal=function(t){const e={id:this.id,meta:i.meta.FEATURE,"meta:type":this.type,active:i.activeStates.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(const n in this.properties)e["user_"+n]=this.properties[n];return{type:i.geojsonTypes.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}},t.exports=o},aa44:function(t,e,n){var r=n("e364");function i(t,e){var n=[],i=0,o=10,a=6;function s(t){if(e&&!1===e.noDuplicateMembers||!t.__duplicateProperties__||n.push({message:"An object contained duplicate members, making parsing ambigous: "+t.__duplicateProperties__.join(", "),line:t.__line__}),!c(t,"type","string"))if(E[t.type])t&&E[t.type](t);else{var r=S[t.type.toLowerCase()];void 0!==r?n.push({message:"Expected "+r+" but got "+t.type+" (case sensitive)",line:t.__line__}):n.push({message:"The type "+t.type+" is unknown",line:t.__line__})}}function l(t,e){return t.every((function(t){return null!==t&&typeof t===e}))}function c(t,e,r){if("undefined"===typeof t[e])return n.push({message:'"'+e+'" member required',line:t.__line__});if("array"===r){if(!Array.isArray(t[e]))return n.push({message:'"'+e+'" member should be an array, but is an '+typeof t[e]+" instead",line:t.__line__})}else{if("object"===r&&t[e]&&"Object"!==t[e].constructor.name)return n.push({message:'"'+e+'" member should be '+r+", but is an "+t[e].constructor.name+" instead",line:t.__line__});if(r&&typeof t[e]!==r)return n.push({message:'"'+e+'" member should be '+r+", but is an "+typeof t[e]+" instead",line:t.__line__})}}function u(t){if(d(t),f(t),void 0!==t.properties&&n.push({message:'FeatureCollection object cannot contain a "properties" member',line:t.__line__}),void 0!==t.coordinates&&n.push({message:'FeatureCollection object cannot contain a "coordinates" member',line:t.__line__}),!c(t,"features","array")){if(!l(t.features,"object"))return n.push({message:"Every feature must be an object",line:t.__line__});t.features.forEach(M)}}function h(t,r){if(!Array.isArray(t))return n.push({message:"position should be an array, is a "+typeof t+" instead",line:t.__line__||r});if(t.length<2)return n.push({message:"position must have 2 or more elements",line:t.__line__||r});if(t.length>3)return n.push({message:"position should not have more than 3 elements",line:t.__line__||r});if(!l(t,"number"))return n.push({message:"each element in a position must be a number",line:t.__line__||r});if(e&&e.precisionWarning){if(i===o)return i+=1,n.push({message:"truncated warnings: we've encountered coordinate precision warning "+o+" times, no more warnings will be reported",level:"message",line:t.__line__||r});i<o&&t.forEach((function(e){var o=0,s=String(e).split(".")[1];if(void 0!==s&&(o=s.length),o>a)return i+=1,n.push({message:"precision of coordinates should be reduced",level:"message",line:t.__line__||r})}))}}function p(t,e,r,i){if(void 0===i&&void 0!==t.__line__&&(i=t.__line__),0===r)return h(t,i);if(1===r&&e)if("LinearRing"===e){if(!Array.isArray(t[t.length-1]))return n.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:i}),!0;if(t.length<4&&n.push({message:"a LinearRing of coordinates needs to have four or more positions",line:i}),t.length&&(t[t.length-1].length!==t[0].length||!t[t.length-1].every((function(e,n){return t[0][n]===e}))))return n.push({message:"the first and last positions in a LinearRing of coordinates must be the same",line:i}),!0}else if("Line"===e&&t.length<2)return n.push({message:"a line needs to have two or more coordinates to be valid",line:i});if(Array.isArray(t)){var o=t.map((function(t){return p(t,e,r-1,t.__line__||i)}));return o.some((function(t){return t}))}n.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:i})}function d(t){if(t.crs){var e="urn:ogc:def:crs:OGC:1.3:CRS84";"object"===typeof t.crs&&t.crs.properties&&t.crs.properties.name===e?n.push({message:"old-style crs member is not recommended, this object is equivalent to the default and should be removed",line:t.__line__}):n.push({message:"old-style crs member is not recommended",line:t.__line__})}}function f(t){if(t.bbox)return Array.isArray(t.bbox)?(l(t.bbox,"number")||n.push({message:"each element in a bbox member must be a number",line:t.bbox.__line__}),4!==t.bbox.length&&6!==t.bbox.length&&n.push({message:"bbox must contain 4 elements (for 2D) or 6 elements (for 3D)",line:t.bbox.__line__}),n.length):void n.push({message:"bbox member must be an array of numbers, but is a "+typeof t.bbox,line:t.__line__})}function m(t){void 0!==t.properties&&n.push({message:'geometry object cannot contain a "properties" member',line:t.__line__}),void 0!==t.geometry&&n.push({message:'geometry object cannot contain a "geometry" member',line:t.__line__}),void 0!==t.features&&n.push({message:'geometry object cannot contain a "features" member',line:t.__line__})}function g(t){d(t),f(t),m(t),c(t,"coordinates","array")||h(t.coordinates)}function y(t){d(t),f(t),c(t,"coordinates","array")||p(t.coordinates,"LinearRing",2)||r(t,n)}function v(t){d(t),f(t),c(t,"coordinates","array")||p(t.coordinates,"LinearRing",3)||r(t,n)}function _(t){d(t),f(t),c(t,"coordinates","array")||p(t.coordinates,"Line",1)}function x(t){d(t),f(t),c(t,"coordinates","array")||p(t.coordinates,"Line",2)}function b(t){d(t),f(t),c(t,"coordinates","array")||p(t.coordinates,"",1)}function w(t){d(t),f(t),c(t,"geometries","array")||(l(t.geometries,"object")||n.push({message:"The geometries array in a GeometryCollection must contain only geometry objects",line:t.__line__}),1===t.geometries.length&&n.push({message:"GeometryCollection with a single geometry should be avoided in favor of single part or a single object of multi-part type",line:t.geometries.__line__}),t.geometries.forEach((function(e){e&&("GeometryCollection"===e.type&&n.push({message:"GeometryCollection should avoid nested geometry collections",line:t.geometries.__line__}),s(e))})))}function M(t){d(t),f(t),void 0!==t.id&&"string"!==typeof t.id&&"number"!==typeof t.id&&n.push({message:'Feature "id" member must have a string or number value',line:t.__line__}),void 0!==t.features&&n.push({message:'Feature object cannot contain a "features" member',line:t.__line__}),void 0!==t.coordinates&&n.push({message:'Feature object cannot contain a "coordinates" member',line:t.__line__}),"Feature"!==t.type&&n.push({message:"GeoJSON features must have a type=feature member",line:t.__line__}),c(t,"properties","object"),c(t,"geometry","object")||t.geometry&&s(t.geometry)}var E={Point:g,Feature:M,MultiPoint:b,LineString:_,MultiLineString:x,FeatureCollection:u,GeometryCollection:w,Polygon:y,MultiPolygon:v},S=Object.keys(E).reduce((function(t,e){return t[e.toLowerCase()]=e,t}),{});return"object"!==typeof t||null===t||void 0===t?(n.push({message:"The root of a GeoJSON object must be an object.",line:0}),n):(s(t),n.forEach((function(t){({}).hasOwnProperty.call(t,"line")&&void 0===t.line&&delete t.line})),n)}t.exports.hint=i},ae6f:function(t,e){function n(t,e){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce((function(t,e){return t.concat(n(e))}),[]),t;case"Feature":return n(t.geometry).map((function(e){return{type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e}}));case"MultiPoint":return t.coordinates.map((function(t){return{type:"Point",coordinates:t}}));case"MultiPolygon":return t.coordinates.map((function(t){return{type:"Polygon",coordinates:t}}));case"MultiLineString":return t.coordinates.map((function(t){return{type:"LineString",coordinates:t}}));case"GeometryCollection":return t.geometries;case"Point":case"Polygon":case"LineString":return[t];default:return t}}t.exports=n},b258:function(t,e){const n=1024e3,r=.1/180*Math.PI,i=Math.atan(3/4),o=6371008.8,a=40075017;t.exports={WORLD_SIZE:n,PROJECTION_WORLD_SIZE:n/(o*Math.PI*2),MERCATOR_A:o,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_RADIUS:o,EARTH_CIRCUMFERENCE:2*Math.PI*o,EARTH_CIRCUMFERENCE_EQUATOR:a,FOV_ORTHO:r,FOV:i,FOV_DEGREES:180*i/Math.PI,TILE_SIZE:512}},b44c:function(t,e){t.exports=function(t,e){return n(t);function n(t){return Array.isArray(t)&&t.length&&"number"===typeof t[0]?[t]:t.reduce((function(t,e){return Array.isArray(e)&&Array.isArray(e[0])?t.concat(n(e)):(t.push(e),t)}),[])}}},b8c8:function(t,e,n){"use strict";
/*!
 * vue-range-slider v1.0.3
 * (c) 2016-2018 xwpongithub
 * Released under the MIT License.
 */var r=function(){var t="undefined"!==typeof window&&window.devicePixelRatio||1;return function(e){return Math.round(e*t)/t}}(),i=function(){for(var t=navigator.userAgent.toLowerCase(),e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!1,r=0;r<e.length;r++)if(t.indexOf(e[r].toLowerCase())>0){n=!0;break}return n}();function o(t){return Array.prototype.isArray?Array.isArray(t):t instanceof Array||"[object Array]"===Object.prototype.toString.call(t)}function a(t,e){return Object.prototype.toString.call(t)!==Object.prototype.toString.call(e)||(o(t)&&t.length===e.length?t.some((function(t,n){return t!==e[n]})):t!==e)}var s=document.createElement("div").style,l=function(){var t={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var e in t)if(void 0!==s[t[e]])return e;return!1}();function c(t){return!1!==l&&("standard"===l?"transitionEnd"===t?"transitionend":t:l+t.charAt(0).toUpperCase()+t.substr(1))}function u(t,e,n,r){t.addEventListener(e,n,{passive:!1,capture:!!r})}function h(t,e,n,r){t.removeEventListener(e,n,{passive:!1,capture:!!r})}var p=c("transform"),d=c("transitionDuration"),f=c("transitionEnd"),m="touchstart",g="touchmove",y="touchend",v="touchcancel",_="mousedown",x="mousemove",b="mouseup",w="mouseleave",M="keydown",E="keyup",S="resize",T={name:"vue-range-slider",props:{show:{type:Boolean,default:!0},value:{type:[String,Number,Array,Object],default:0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},width:{type:[Number,String],default:"auto"},height:{type:[Number,String],default:6},dotSize:{type:Number,default:16},dotWidth:{type:Number,required:!1},dotHeight:{type:Number,required:!1},stopPropagation:{type:Boolean,default:!1},eventType:{type:String,default:"auto"},realTime:{type:Boolean,default:!1},tooltip:{type:[String,Boolean],default:"always",validator:function(t){return["hover","always"].indexOf(t)>-1}},direction:{type:String,default:"horizontal",validator:function(t){return["horizontal","vertical"].indexOf(t)>-1}},reverse:{type:Boolean,default:!1},disabled:{type:[Boolean,Array],default:!1},piecewiseLabel:{type:Boolean,default:!1},piecewise:{type:Boolean,default:!1},processDraggable:{type:Boolean,default:!1},clickable:{type:Boolean,default:!0},fixed:{type:Boolean,default:!1},debug:{type:Boolean,default:!0},minRange:{type:Number},maxRange:{type:Number},tooltipMerge:{type:Boolean,default:!0},startAnimation:{type:Boolean,default:!1},lazy:{type:Boolean,default:!1},enableCross:{type:Boolean,default:!0},speed:{type:Number,default:.5},useKeyboard:{type:Boolean,default:!1},actionsKeyboard:{type:Array,default:function(){return[function(t){return t-1},function(t){return t+1}]}},data:Array,formatter:[String,Function],mergeFormatter:[String,Function],tooltipDir:[Array,String],tooltipStyle:[Array,Object,Function],sliderStyle:[Array,Object,Function],focusStyle:[Array,Object,Function],disabledStyle:Object,processStyle:Object,bgStyle:Object,piecewiseStyle:Object,piecewiseActiveStyle:Object,disabledDotStyle:[Array,Object,Function],labelStyle:Object,labelActiveStyle:Object},data:function(){return{currentValue:0,size:0,fixedValue:0,focusSlider:0,currentSlider:0,flag:!1,processFlag:!1,processSign:!1,keydownFlag:!1,focusFlag:!1,dragFlag:!1,crossFlag:!1,isComponentExists:!0,isMounted:!1}},render:function(t){var e=this,n=[];if(this.isRange){var r=t("div",{ref:"dot0",staticClass:"slider-dot",class:[this.tooltipStatus,{"slider-dot-focus":this.focusFlag&&0===this.focusSlider,"slider-dot-dragging":this.flag&&0===this.currentSlider,"slider-dot-disabled":!this.boolDisabled&&this.disabledArray[0]}],style:[this.dotStyles,!this.boolDisabled&&this.disabledArray[0]?this.disabledDotStyles[0]:null,this.sliderStyles[0],this.focusFlag&&0===this.focusSlider?this.focusStyles[0]:null]},[t("div",{ref:"tooltip0",staticClass:"slider-tooltip-wrap",class:"slider-tooltip-".concat(this.tooltipDirection[0])},[this._t("tooltip",[t("span",{staticClass:"slider-tooltip",style:this.tooltipStyles[0]},this.formatter?this.formatting(this.val[0]):this.val[0])],{value:this.val[0],index:0,disabled:!this.boolDisabled&&this.disabledArray[0]})])]);n.push(r);var i=t("div",{ref:"dot1",staticClass:"slider-dot",class:[this.tooltipStatus,{"slider-dot-focus":this.focusFlag&&1===this.focusSlider,"slider-dot-dragging":this.flag&&1===this.currentSlider,"slider-dot-disabled":!this.boolDisabled&&this.disabledArray[1]}],style:[this.dotStyles,!this.boolDisabled&&this.disabledArray[1]?this.disabledDotStyles[1]:null,this.sliderStyles[1],this.focusFlag&&1===this.focusSlider?this.focusStyles[1]:null]},[t("div",{ref:"tooltip1",staticClass:"slider-tooltip-wrap",class:"slider-tooltip-".concat(this.tooltipDirection[1])},[this._t("tooltip",[t("span",{staticClass:"slider-tooltip",style:this.tooltipStyles[1]},this.formatter?this.formatting(this.val[1]):this.val[1])],{value:this.val[1],index:1,disabled:!this.boolDisabled&&this.disabledArray[1]})])]);n.push(i)}else{var o=t("div",{ref:"dot",staticClass:"slider-dot",class:[this.tooltipStatus,{"slider-dot-focus":this.focusFlag&&0===this.focusSlider,"slider-dot-dragging":this.flag&&0===this.currentSlider}],style:[this.dotStyles,this.sliderStyles,this.focusFlag&&0===this.focusSlider?this.focusStyles:null]},[t("div",{staticClass:"slider-tooltip-wrap",class:"slider-tooltip-".concat(this.tooltipDirection)},[this._t("tooltip",[t("span",{staticClass:"slider-tooltip",style:this.tooltipStyles},this.formatter?this.formatting(this.val):this.val)],{value:this.val})])]);n.push(o)}var a=this.piecewiseDotWrap.length,s=t("ul",{staticClass:"slider-piecewise"},this._l(this.piecewiseDotWrap,(function(n,r){var i=[];e.piecewise&&i.push(t("span",{staticClass:"piecewise-dot",style:[e.piecewiseStyle,n.inRange?e.piecewiseActiveStyle:null]}));var o=[];return e.piecewiseLabel&&o.push(t("span",{staticClass:"piecewise-label",style:[e.labelStyle,n.inRange?e.labelActiveStyle:null]},n.label)),t("li",{key:r,staticClass:"piecewise-item",style:[e.piecewiseDotStyle,n.style]},[e._t("piecewise",i,{label:n.label,index:r,first:0===r,last:r===a-1,active:n.inRange}),e._t("label",o,{label:n.label,index:r,first:0===r,last:r===a-1,active:n.inRange})])})));n.push(s);var l=t("div",{ref:"process",staticClass:"slider-process",class:{"slider-process-draggable":this.isRange&&this.processDraggable},style:this.processStyle,on:{click:function(t){return e.processClick(t)}}},[t("div",{ref:"mergedTooltip",staticClass:"merged-tooltip slider-tooltip-wrap",class:"slider-tooltip-".concat(this.isRange?this.tooltipDirection[0]:this.tooltipDirection),style:this.tooltipMergedPosition},[this._t("tooltip",[t("span",{staticClass:"slider-tooltip",style:this.tooltipStyles},this.mergeFormatter?this.mergeFormatting(this.val[0],this.val[1]):this.formatter?this.val[0]===this.val[1]?this.formatting(this.val[0]):"".concat(this.formatting(this.val[0])," - ").concat(this.formatting(this.val[1])):this.val[0]===this.val[1]?this.val[0]:"".concat(this.val[0]," - ").concat(this.val[1]))],{value:this.val,merge:!0})])]);return n.push(l),this.isRange||this.data||n.push(t("input",{staticClass:"slider-input",attrs:{type:"range",min:this.min,max:this.max},domProps:{value:this.val},on:{input:function(t){return e.val=t.target.value}}})),t("div",{ref:"wrap",staticClass:"vue-range-slider slider-component",class:[this.flowDirection,this.disabledClass,this.stateClass,{"slider-has-label":this.piecewiseLabel}],style:[this.wrapStyles,this.boolDisabled?this.disabledStyle:null],directives:[{name:"show",value:this.show}],on:{click:function(t){return e.wrapClick(t)}}},[t("div",{ref:"elem",staticClass:"slider",style:[this.elemStyles,this.bgStyle],attrs:{"aria-hidden":!0}},n)])},computed:{val:{get:function(){return this.data?this.isRange?[this.data[this.currentValue[0]],this.data[this.currentValue[1]]]:this.data[this.currentValue]:this.currentValue},set:function(t){if(this.data)if(this.isRange){var e=this.data.indexOf(t[0]),n=this.data.indexOf(t[1]);e>-1&&n>-1&&(this.currentValue=[e,n])}else{var r=this.data.indexOf(t);r>-1&&(this.currentValue=r)}else this.currentValue=t}},currentIndex:function(){return this.isRange?this.data?this.currentValue:[this.getIndexByValue(this.currentValue[0]),this.getIndexByValue(this.currentValue[1])]:this.getIndexByValue(this.currentValue)},tooltipMergedPosition:function(){if(!this.isMounted)return{};var t=this.tooltipDirection[0],e=this.$refs.dot0;if(e){var n={};return"vertical"===this.direction?n[t]="-".concat(this.dotHeightVal/2-this.width/2+9,"px"):(n[t]="-".concat(this.dotWidthVal/2-this.height/2+9,"px"),n["left"]="50%"),n}},tooltipDirection:function(){var t=this.tooltipDir||("vertical"===this.direction?"left":"top");return o(t)?this.isRange?t:t[1]:this.isRange?[t,t]:t},piecewiseDotWrap:function(){if(!this.piecewise&&!this.piecewiseLabel)return!1;for(var t=[],e=0;e<=this.total;e++){var n="vertical"===this.direction?{bottom:"".concat(this.gap*e-this.width/2,"px"),left:0}:{left:"".concat(this.gap*e-this.height/2,"px"),top:0},r=this.reverse?this.total-e:e,i=this.data?this.data[r]:this.spacing*r+this.min;t.push({style:n,label:this.formatter?this.formatting(i):i,inRange:r>=this.indexRange[0]&&r<=this.indexRange[1]})}return t},total:function(){return this.data?this.data.length-1:(Math.floor((this.maximum-this.minimum)*this.multiple)%(this.step*this.multiple)!==0&&this.printError("Prop[step] is illegal, Please make sure that the step can be divisible"),(this.maximum-this.minimum)/this.step)},piecewiseDotStyle:function(){return"vertical"===this.direction?{width:"".concat(this.width,"px"),height:"".concat(this.width,"px")}:{width:"".concat(this.height,"px"),height:"".concat(this.height,"px")}},dotStyles:function(){return"vertical"===this.direction?{width:"".concat(this.dotWidthVal,"px"),height:"".concat(this.dotHeightVal,"px"),left:"".concat(-(this.dotWidthVal-this.width)/2,"px")}:{width:"".concat(this.dotWidthVal,"px"),height:"".concat(this.dotHeightVal,"px"),top:"".concat(-(this.dotHeightVal-this.height)/2,"px")}},sliderStyles:function(){return o(this.sliderStyle)?this.isRange?this.sliderStyle:this.sliderStyle[1]:"function"===typeof this.sliderStyle?this.sliderStyle(this.val,this.currentIndex):this.isRange?[this.sliderStyle,this.sliderStyle]:this.sliderStyle},tooltipStyles:function(){return o(this.tooltipStyle)?this.isRange?this.tooltipStyle:this.tooltipStyle[1]:"function"===typeof this.tooltipStyle?this.tooltipStyle(this.val,this.currentIndex):this.isRange?[this.tooltipStyle,this.tooltipStyle]:this.tooltipStyle},focusStyles:function(){return o(this.focusStyle)?this.isRange?this.focusStyle:this.focusStyle[1]:"function"===typeof this.focusStyle?this.focusStyle(this.val,this.currentIndex):this.isRange?[this.focusStyle,this.focusStyle]:this.focusStyle},elemStyles:function(){return"vertical"===this.direction?{width:"".concat(this.width,"px"),height:"100%"}:{height:"".concat(this.height,"px")}},wrapStyles:function(){return"vertical"===this.direction?{height:"number"===typeof this.height?"".concat(this.height,"px"):this.height,padding:"".concat(this.dotHeightVal/2,"px ").concat(this.dotWidthVal/2,"px")}:{width:"number"===typeof this.width?"".concat(this.width,"px"):this.width,padding:"".concat(this.dotHeightVal/2,"px ").concat(this.dotWidthVal/2,"px")}},stateClass:function(){return{"slider-state-process-drag":this.processFlag,"slider-state-drag":this.flag&&!this.processFlag&&!this.keydownFlag,"slider-state-focus":this.focusFlag}},tooltipStatus:function(){return"hover"===this.tooltip&&this.flag?"slider-always":this.tooltip?"slider-".concat(this.tooltip):""},tooltipClass:function(){return["slider-tooltip-".concat(this.tooltipDirection),"slider-tooltip"]},minimum:function(){return this.data?0:this.min},maximum:function(){return this.data?this.data.length-1:this.max},multiple:function(){var t="".concat(this.step).split(".")[1];return t?Math.pow(10,t.length):1},indexRange:function(){return this.isRange?this.currentIndex:[0,this.currentIndex]},spacing:function(){return this.data?1:this.step},gap:function(){return this.size/this.total},dotWidthVal:function(){return"number"===typeof this.dotWidth?this.dotWidth:this.dotSize},dotHeightVal:function(){return"number"===typeof this.dotHeight?this.dotHeight:this.dotSize},disabledArray:function(){return o(this.disabled)?this.disabled:[this.disabled,this.disabled]},boolDisabled:function(){return this.disabledArray.every((function(t){return!0===t}))},disabledClass:function(){return this.boolDisabled?"slider-disabled":""},flowDirection:function(){return"slider-".concat(this.direction+(this.reverse?"-reverse":""))},isRange:function(){return o(this.value)},isDisabled:function(){return"none"===this.eventType||this.boolDisabled},isFixed:function(){return this.fixed||this.minRange},position:function(){return this.isRange?[(this.currentValue[0]-this.minimum)/this.spacing*this.gap,(this.currentValue[1]-this.minimum)/this.spacing*this.gap]:(this.currentValue-this.minimum)/this.spacing*this.gap},limit:function(){return this.isRange?this.isFixed?[[0,(this.total-this.fixedValue)*this.gap],[this.fixedValue*this.gap,this.size]]:[[0,this.position[1]],[this.position[0],this.size]]:[0,this.size]},valueLimit:function(){return this.isRange?this.isFixed?[[this.minimum,this.maximum-this.fixedValue*(this.spacing*this.multiple)/this.multiple],[this.minimum+this.fixedValue*(this.spacing*this.multiple)/this.multiple,this.maximum]]:[[this.minimum,this.currentValue[1]],[this.currentValue[0],this.maximum]]:[this.minimum,this.maximum]},idleSlider:function(){return 0===this.currentSlider?1:0},slider:function(){return this.isRange?[this.$refs.dot0,this.$refs.dot1]:this.$refs.dot}},methods:{setValue:function(t,e,n){var r=this;if(a(this.val,t)){var i=this.limitValue(t);this.val=this.isRange?i.concat():i,this.computedFixedValue(),this.syncValue(e)}this.$nextTick((function(){return r.setPosition(n)}))},setIndex:function(t){var e;o(t)&&this.isRange?(e=this.data?[this.data[t[0]],this.data[t[1]]]:[this.getValueByIndex(t[0]),this.getValueByIndex(t[1])],this.setValue(e)):(t=this.getValueByIndex(t),this.isRange&&(this.currentSlider=t>(this.currentValue[1]-this.currentValue[0])/2+this.currentValue[0]?1:0),this.setCurrentValue(t))},wrapClick:function(t){if(this.isDisabled||!this.clickable||this.processFlag||this.dragFlag)return!1;var e=this.getPos(t);if(this.isRange)if(this.disabledArray.every((function(t){return!1===t})))this.currentSlider=e>(this.position[1]-this.position[0])/2+this.position[0]?1:0;else if(this.disabledArray[0]){if(e<this.position[0])return!1;this.currentSlider=1}else if(this.disabledArray[1]){if(e>this.position[1])return!1;this.currentSlider=0}if(this.disabledArray[this.currentSlider])return!1;if(this.setValueOnPos(e),this.isRange&&this.tooltipMerge){var n=setInterval(this.handleOverlapTooltip,16.7);setTimeout((function(){return window.clearInterval(n)}),1e3*this.speed)}},processClick:function(t){this.fixed&&t.stopPropagation()},syncValue:function(t){var e=this.isRange?this.val.concat():this.val;this.$emit("input",e),this.keydownFlag&&this.$emit("on-keypress",e),t||this.$emit("slide-end",e)},getPos:function(t){return this.realTime&&this.getStaticData(),"vertical"===this.direction?this.reverse?t.pageY-this.offset:this.size-(t.pageY-this.offset):this.reverse?this.size-(t.pageX-this.offset):t.pageX-this.offset},setValueOnPos:function(t,e){var n=this.isRange?this.limit[this.currentSlider]:this.limit,r=this.isRange?this.valueLimit[this.currentSlider]:this.valueLimit,i=Math.round(t/this.gap);if(t>=n[0]&&t<=n[1]){var o=this.getValueByIndex(i);this.setTransform(t),this.setCurrentValue(o,e),this.isRange&&(this.fixed||this.isLessRange(t,i))&&(this.setTransform(t+this.fixedValue*this.gap*(0===this.currentSlider?1:-1),!0),this.setCurrentValue((o*this.multiple+this.fixedValue*this.spacing*this.multiple*(0===this.currentSlider?1:-1))/this.multiple,e,!0))}else{var a=t<n[0]?0:1,s=0===a?1:0;this.setTransform(n[a]),this.setCurrentValue(r[a]),this.isRange&&(this.fixed||this.isLessRange(t,i))?(this.setTransform(this.limit[this.idleSlider][a],!0),this.setCurrentValue(this.valueLimit[this.idleSlider][a],e,!0)):!this.isRange||!this.enableCross&&!this.crossFlag||this.isFixed||this.disabledArray[a]||this.currentSlider!==s||(this.focusSlider=a,this.currentSlider=a)}this.crossFlag=!1},setCurrentValue:function(t,e,n){var r=n?this.idleSlider:this.currentSlider;if(t<this.minimum||t>this.maximum)return!1;this.isRange?a(this.currentValue[r],t)&&(this.currentValue.splice(r,1,t),this.lazy&&this.flag||this.syncValue()):a(this.currentValue,t)&&(this.currentValue=t,this.lazy&&this.flag||this.syncValue()),e||this.setPosition()},setPosition:function(t){this.flag||this.setTransitionTime(void 0===t?this.speed:t),this.isRange?(this.setTransform(this.position[0],1===this.currentSlider),this.setTransform(this.position[1],0===this.currentSlider)):this.setTransform(this.position),this.flag||this.setTransitionTime(0)},setTransform:function(t,e){var n=e?this.idleSlider:this.currentSlider,i=r(("vertical"===this.direction?this.dotHeightVal/2-t:t-this.dotWidthVal/2)*(this.reverse?-1:1)),o="vertical"===this.direction?"translateY(".concat(i,"px)"):"translateX(".concat(i,"px)"),a=this.fixed?"".concat(this.fixedValue*this.gap,"px"):"".concat(0===n?this.position[1]-t:t-this.position[0],"px"),s=this.fixed?"".concat(0===n?t:t-this.fixedValue*this.gap,"px"):"".concat(0===n?t:this.position[0],"px");this.isRange?(this.slider[n].style[p]=o,"vertical"===this.direction?(this.$refs.process.style.height=a,this.$refs.process.style[this.reverse?"top":"bottom"]=s):(this.$refs.process.style.width=a,this.$refs.process.style[this.reverse?"right":"left"]=s)):(this.slider.style[p]=o,"vertical"===this.direction?(this.$refs.process.style.height="".concat(t,"px"),this.$refs.process.style[this.reverse?"top":"bottom"]=0):(this.$refs.process.style.width="".concat(t,"px"),this.$refs.process.style[this.reverse?"right":"left"]=0))},setTransitionTime:function(t){if(t||this.$refs.process.offsetWidth,this.isRange){for(var e=this.slider.length,n=0;n<e;n++)this.slider[n].style[d]="".concat(t,"s");this.$refs.process.style[d]="".concat(t,"s")}else this.slider.style[d]="".concat(t,"s"),this.$refs.process.style[d]="".concat(t,"s")},computedFixedValue:function(){if(!this.isFixed)return this.fixedValue=0,!1;this.fixedValue=this.currentIndex[1]-this.currentIndex[0],this.fixedValue=Math.max(this.fixed?this.currentIndex[1]-this.currentIndex[0]:0,this.minRange||0)},limitValue:function(t){var e=this;if(this.data)return t;var n=function(n){return n<e.min?(e.printError("The value of the slider is ".concat(t,", the minimum value is ").concat(e.min,", the value of this slider can not be less than the minimum value")),e.min):n>e.max?(e.printError("The value of the slider is ".concat(t,", the maximum value is ").concat(e.max,", the value of this slider can not be greater than the maximum value")),e.max):n};return this.isRange?t.map((function(t){return n(t)})):n(t)},getStaticData:function(){this.$refs.elem&&(this.size="vertical"===this.direction?this.$refs.elem.offsetHeight:this.$refs.elem.offsetWidth,this.offset="vertical"===this.direction?this.$refs.elem.getBoundingClientRect().top+window.pageYOffset||document.documentElement.scrollTop:this.$refs.elem.getBoundingClientRect().left)},handleOverlapTooltip:function(){var t=this.tooltipDirection[0]===this.tooltipDirection[1];if(this.isRange&&t){var e=this.reverse?this.$refs.tooltip1:this.$refs.tooltip0,n=this.reverse?this.$refs.tooltip0:this.$refs.tooltip1,r=e.getBoundingClientRect(),i=n.getBoundingClientRect(),o=r.right,a=i.left,s=r.top,l=i.top+i.height,c="horizontal"===this.direction&&o>a,u="vertical"===this.direction&&l>s;c||u?this.handleDisplayMergedTooltip(!0):this.handleDisplayMergedTooltip(!1)}},handleDisplayMergedTooltip:function(t){var e=this.$refs.tooltip0,n=this.$refs.tooltip1,r=this.$refs.process.getElementsByClassName("merged-tooltip")[0];t?(e.style.visibility="hidden",n.style.visibility="hidden",r.style.visibility="visible"):(e.style.visibility="visible",n.style.visibility="visible",r.style.visibility="hidden")},isLessRange:function(t,e){if(!this.isRange||!this.minRange&&!this.maxRange)return!1;var n=0===this.currentSlider?this.currentIndex[1]-e:e-this.currentIndex[0];return this.minRange&&n<=this.minRange?(this.fixedValue=this.minRange,!0):this.maxRange&&n>=this.maxRange?(this.fixedValue=this.maxRange,!0):(this.computedFixedValue(),!1)},getValueByIndex:function(t){return(this.spacing*this.multiple*t+this.minimum*this.multiple)/this.multiple},getIndexByValue:function(t){return Math.round((t-this.minimum)*this.multiple)/(this.spacing*this.multiple)},formatting:function(t){return"string"===typeof this.formatter?this.formatter.replace(/{value}/,t):this.formatter(t)},mergeFormatting:function(t,e){return"string"===typeof this.mergeFormatter?this.mergeFormatter.replace(/{(value1|value2)}/g,(function(n,r){return"value1"===r?t:e})):this.mergeFormatter(t,e)},_start:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(this.disabledArray[e])return!1;if(this.stopPropagation&&t.stopPropagation(),this.isRange){if(this.currentSlider=e,n){if(!this.processDraggable)return!1;this.processFlag=!0,this.processSign={pos:this.position,start:this.getPos(t.targetTouches&&t.targetTouches[0]?t.targetTouches[0]:t)}}this.enableCross||this.val[0]!==this.val[1]||(this.crossFlag=!0)}!n&&this.useKeyboard&&(this.focusFlag=!0,this.focusSlider=e),this.flag=!0,this.$emit("drag-start",this)},_move:function(t){if(t.preventDefault(),this.stopPropagation&&t.stopPropagation(),!this.flag)return!1;t.targetTouches&&t.targetTouches[0]&&(t=t.targetTouches[0]),this.processFlag?(this.currentSlider=0,this.setValueOnPos(this.processSign.pos[0]+this.getPos(t)-this.processSign.start,!0),this.currentSlider=1,this.setValueOnPos(this.processSign.pos[1]+this.getPos(t)-this.processSign.start,!0)):(this.dragFlag=!0,this.setValueOnPos(this.getPos(t),!0)),this.isRange&&this.tooltipMerge&&this.handleOverlapTooltip()},_end:function(t){var e=this;if(this.stopPropagation&&t.stopPropagation(),!this.flag)return!1;this.$emit("drag-end",this),this.lazy&&a(this.val,this.value)&&this.syncValue(),this.flag=!1,this.$nextTick((function(){e.crossFlag=!1,e.dragFlag=!1,e.processFlag=!1})),this.setPosition()},blurSlider:function(t){var e=this.isRange?this.$refs["dot".concat(this.focusSlider)]:this.$refs.dot;if(!e||e===t.target)return!1;this.focusFlag=!1},handleKeydown:function(t){if(t.preventDefault(),t.stopPropagation(),!this.useKeyboard)return!1;var e=t.which||t.keyCode;switch(e){case 37:case 40:this.keydownFlag=!0,this.flag=!0,this.changeFocusSlider(this.actionsKeyboard[0]);break;case 38:case 39:this.keydownFlag=!0,this.flag=!0,this.changeFocusSlider(this.actionsKeyboard[1]);break;default:break}},handleKeyup:function(){this.keydownFlag&&(this.keydownFlag=!1,this.flag=!1)},changeFocusSlider:function(t){var e=this;if(this.isRange){var n=this.currentIndex.map((function(n,r){if(r===e.focusSlider||e.fixed){var i=t(n),o=e.fixed?e.valueLimit[r]:[0,e.total];if(i<=o[1]&&i>=o[0])return i}return n}));n[0]>n[1]&&(this.focusSlider=0===this.focusSlider?1:0,n=n.reverse()),this.setIndex(n)}else this.setIndex(t(this.currentIndex))},bindEvents:function(){var t=this;this.processStartFn=function(e){t._start(e,0,!0)},this.dot0StartFn=function(e){t._start(e,0)},this.dot1StartFn=function(e){t._start(e,1)},i?(u(this.$refs.process,m,this.processStartFn),u(document,g,this._move),u(document,y,this._end),u(document,v,this._end),this.isRange?(u(this.$refs.dot0,m,this.dot0StartFn),u(this.$refs.dot1,m,this.dot1StartFn)):u(this.$refs.dot,m,this._start)):(u(this.$refs.process,_,this.processStartFn),u(document,_,this.blurSlider),u(document,x,this._move),u(document,b,this._end),u(document,w,this._end),this.isRange?(u(this.$refs.dot0,_,this.dot0StartFn),u(this.$refs.dot1,_,this.dot1StartFn)):u(this.$refs.dot,_,this._start)),u(document,M,this.handleKeydown),u(document,E,this.handleKeyup),u(window,S,this.refresh),this.isRange&&this.tooltipMerge&&(u(this.$refs.dot0,f,this.handleOverlapTooltip),u(this.$refs.dot1,f,this.handleOverlapTooltip))},unbindEvents:function(){i?(h(this.$refs.process,m,this.processStartFn),h(document,g,this._move),h(document,y,this._end),h(document,v,this._end),this.isRange?(h(this.$refs.dot0,m,this.dot0StartFn),h(this.$refs.dot1,m,this.dot1StartFn)):h(this.$refs.dot,m,this._start)):(h(this.$refs.process,_,this.processStartFn),h(document,_,this.blurSlider),h(document,x,this._move),h(document,b,this._end),h(document,w,this._end),this.isRange?(h(this.$refs.dot0,_,this.dot0StartFn),h(this.$refs.dot1,_,this.dot1StartFn)):h(this.$refs.dot,_,this._start)),h(document,M,this.handleKeydown),h(document,E,this.handleKeyup),h(window,S,this.refresh),this.isRange&&this.tooltipMerge&&(h(this.$refs.dot0,f,this.handleOverlapTooltip),h(this.$refs.dot1,f,this.handleOverlapTooltip))},refresh:function(){this.$refs.elem&&(this.getStaticData(),this.computedFixedValue(),this.setPosition(),this.unbindEvents(),this.bindEvents())},printError:function(t){this.debug&&console.error("[VueSlider error]: ".concat(t))}},mounted:function(){var t=this;if(this.isComponentExists=!0,"undefined"===typeof window||"undefined"===typeof document)return this.printError("window or document is undefined, can not be initialization.");this.$nextTick((function(){t.getStaticData(),t.setValue(t.limitValue(t.value),!0,t.startAnimation?t.speed:0),t.bindEvents(),t.isRange&&t.tooltipMerge&&!t.startAnimation&&t.handleOverlapTooltip()})),this.isMounted=!0},watch:{value:function(t){this.flag||this.setValue(t,!0)},show:function(t){t&&!this.size&&this.$nextTick(this.refresh)},max:function(t){if(t<this.min)return this.printError("The maximum value can not be less than the minimum value.");var e=this.limitValue(this.val);this.setValue(e),this.refresh()},min:function(t){if(t>this.max)return this.printError("The minimum value can not be greater than the maximum value.");var e=this.limitValue(this.val);this.setValue(e),this.refresh()},fixed:function(){this.computedFixedValue()},minRange:function(){this.computedFixedValue()}},beforeDestroy:function(){this.isComponentExists=!1,this.unbindEvents(),this.refresh()},deactivated:function(){this.isComponentExists=!1,this.unbindEvents(),this.refresh()}},A="1.0.3";T.version=A,T.install=function(t){t.component(T.name,T)},"undefined"!==typeof window&&window.Vue&&window.Vue.use(T),e["a"]=T},baed:function(t,e,n){const r=n("53a8"),i=n("e133"),o={defaultMode:i.modes.SIMPLE_SELECT,keybindings:!0,clickBuffer:2,boxSelect:!0,displayControlsDefault:!0,styles:n("2466"),controls:{},userProperties:!1},a={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},s={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function l(t,e){return t.map(t=>t.source?t:r(t,{id:`${t.id}.${e}`,source:"hot"===e?i.sources.HOT:i.sources.COLD}))}t.exports=function(t={}){let e=r(t);return t.controls||(e.controls={}),!1===t.displayControlsDefault?e.controls=r(s,t.controls):e.controls=r(a,t.controls),e=r(o,e),e.styles=l(e.styles,"cold").concat(l(e.styles,"hot")),e}},bc0e:function(t,e,n){const r=n("93b5"),i=n("a4f5"),o=n("2788");n("7bc4");function a(t){if(t=r._validate(t,i.prototype._defaults.tooltip),t.text){let n=i.prototype.drawTooltip(t.text,t.mapboxStyle),r=new o.CSS2DObject(n);r.visible=!1,r.name="tooltip";var e=i.prototype._makeGroup(r,t);return i.prototype._addMethods(e),e}}t.exports=a},c2f7:function(t,e,n){const r=n("7bc4");r.MTLLoader=function(t){r.Loader.call(this,t)},r.MTLLoader.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:r.MTLLoader,load:function(t,e,n,i){var o=this,a=""===this.path?r.LoaderUtils.extractUrlBase(t||""):this.path,s=new r.FileLoader(this.manager);s.setPath(this.path),s.load(t,(function(n){try{e(o.parse(n,a))}catch(r){i?i(r):console.error(r),o.manager.itemError(t)}}),n,i)},setMaterialOptions:function(t){return this.materialOptions=t,this},parse:function(t,e){for(var n=t.split("\n"),i={},o=/\s+/,a={},s=0;s<n.length;s++){var l=n[s];if(l=l.trim(),0!==l.length&&"#"!==l.charAt(0)){var c=l.indexOf(" "),u=c>=0?l.substring(0,c):l;u=u.toLowerCase();var h=c>=0?l.substring(c+1):"";if(h=h.trim(),"newmtl"===u)i={name:h},a[h]=i;else if("ka"===u||"kd"===u||"ks"===u||"ke"===u){var p=h.split(o,3);i[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else i[u]=h}}var d=new r.MTLLoader.MaterialCreator(this.resourcePath||e,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(a),d}}),r.MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:r.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:r.RepeatWrapping},r.MTLLoader.MaterialCreator.prototype={constructor:r.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(t){return this.crossOrigin=t,this},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var n in t){var r=t[n],i={};for(var o in e[n]=i,r){var a=!0,s=r[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(a=!1);break;default:break}a&&(i[l]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,n=this.materialsInfo[t],i={name:t,side:this.side};function o(t,e){return"string"!==typeof e||""===e?"":/^https?:\/\//i.test(e)?e:t+e}function a(t,n){if(!i[t]){var r=e.getTextureParams(n,i),a=e.loadTexture(o(e.baseUrl,r.url));a.repeat.copy(r.scale),a.offset.copy(r.offset),a.wrapS=e.wrap,a.wrapT=e.wrap,i[t]=a}}for(var s in n){var l,c=n[s];if(""!==c)switch(s.toLowerCase()){case"kd":i.color=(new r.Color).fromArray(c);break;case"ks":i.specular=(new r.Color).fromArray(c);break;case"ke":i.emissive=(new r.Color).fromArray(c);break;case"map_kd":a("map",c);break;case"map_ks":a("specularMap",c);break;case"map_ke":a("emissiveMap",c);break;case"norm":a("normalMap",c);break;case"map_bump":case"bump":a("bumpMap",c);break;case"map_d":a("alphaMap",c),i.transparent=!0;break;case"ns":i.shininess=parseFloat(c);break;case"d":l=parseFloat(c),l<1&&(i.opacity=l,i.transparent=!0);break;case"tr":l=parseFloat(c),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(i.opacity=1-l,i.transparent=!0);break;default:break}}return this.materials[t]=new r.MeshPhongMaterial(i),this.materials[t]},getTextureParams:function(t,e){var n,i={scale:new r.Vector2(1,1),offset:new r.Vector2(0,0)},o=t.split(/\s+/);return n=o.indexOf("-bm"),n>=0&&(e.bumpScale=parseFloat(o[n+1]),o.splice(n,2)),n=o.indexOf("-s"),n>=0&&(i.scale.set(parseFloat(o[n+1]),parseFloat(o[n+2])),o.splice(n,4)),n=o.indexOf("-o"),n>=0&&(i.offset.set(parseFloat(o[n+1]),parseFloat(o[n+2])),o.splice(n,4)),i.url=o.join(" ").trim(),i},loadTexture:function(t,e,n,i,o){var a,s=void 0!==this.manager?this.manager:r.DefaultLoadingManager,l=s.getHandler(t);return null===l&&(l=new r.TextureLoader(s)),l.setCrossOrigin&&l.setCrossOrigin(this.crossOrigin),a=l.load(t,n,i,o),void 0!==e&&(a.mapping=e),a}},t.exports=r.MTLLoader},c413:function(t,e,n){var r=n("7f7f"),i=n("aa44");function o(t,e){var n,o=[];if("object"===typeof t)n=t;else{if("string"!==typeof t)return[{message:"Expected string or object as input",line:0}];try{n=r.parse(t)}catch(l){var a=l.message.match(/line (\d+)/),s=parseInt(a[1],10);return[{line:s-1,message:l.message,error:l}]}}return o=o.concat(i.hint(n,e)),o}t.exports.hint=o},c7bf:function(t,e,n){const r=n("7bc4"),i=n("93b5");function o(t){this.map=t,this.enrolledObjects=[],this.previousFrameTime}o.prototype={unenroll:function(t){this.enrolledObjects.splice(this.enrolledObjects.indexOf(t),1)},enroll:function(t){if(t.clock=new r.Clock,t.hasDefaultAnimation=!1,t.defaultAction,t.actions=[],t.mixer,t.animations&&t.animations.length>0){t.hasDefaultAnimation=!0;let n=t.userData.defaultAnimation?t.userData.defaultAnimation:0;t.mixer=new r.AnimationMixer(t),e(n)}function e(e){for(let n=0;n<t.animations.length;n++){e>t.animations.length&&console.log("The animation index "+e+" doesn't exist for this object");let r=t.animations[n],i=t.mixer.clipAction(r);t.actions.push(i),e===n?(t.defaultAction=i,i.setEffectiveWeight(1)):i.setEffectiveWeight(0),i.play()}}let n=!1;Object.defineProperty(t,"isPlaying",{get(){return n},set(e){n!=e&&(n=e,t.dispatchEvent(new CustomEvent("IsPlayingChanged",{detail:t,bubbles:!0,cancelable:!0})))}}),this.enrolledObjects.push(t),t.animationQueue=[],t.set=function(e){if(e.duration>0){let n={start:Date.now(),expiration:Date.now()+e.duration,endState:{}};i.extend(e,n);let o=e.coords,a=e.rotation,s=e.scale||e.scaleX||e.scaleY||e.scaleZ;if(a){let n=t.rotation;e.startRotation=[n.x,n.y,n.z],e.endState.rotation=i.types.rotation(e.rotation,e.startRotation),e.rotationPerMs=e.endState.rotation.map((function(t,n){return(t-e.startRotation[n])/e.duration}))}if(s){let n=t.scale;e.startScale=[n.x,n.y,n.z],e.endState.scale=i.types.scale(e.scale,e.startScale),e.scalePerMs=e.endState.scale.map((function(t,n){return(t-e.startScale[n])/e.duration}))}o&&(e.pathCurve=new r.CatmullRomCurve3(i.lnglatsToWorld([t.coordinates,e.coords])));let l={type:"set",parameters:e};this.animationQueue.push(l),tb.map.repaint=!0}else this.stop(),e.rotation=i.radify(e.rotation),this._setObject(e);return this},t.animationMethod=null,t.stop=function(e){return t.mixer&&(t.isPlaying=!1,cancelAnimationFrame(t.animationMethod)),this.animationQueue=[],this},t.followPath=function(t,e){let n={type:"followPath",parameters:i._validate(t,a.followPath)};return i.extend(n.parameters,{pathCurve:new r.CatmullRomCurve3(i.lnglatsToWorld(t.path)),start:Date.now(),expiration:Date.now()+n.parameters.duration,cb:e}),this.animationQueue.push(n),tb.map.repaint=!0,this},t._setObject=function(e){t.setScale();let n=e.position,o=e.rotation,a=e.scale,s=e.worldCoordinates,l=e.quaternion,c=e.translate,u=e.worldTranslate;if(n){this.coordinates=n;let t=i.projectToWorld(n);this.position.copy(t)}if(c){this.coordinates=[this.coordinates[0]+c[0],this.coordinates[1]+c[1],this.coordinates[2]+c[2]];let t=i.projectToWorld(c);this.position.copy(t),e.position=this.coordinates}if(u){this.translateX(u.x),this.translateY(u.y),this.translateZ(u.z);let t=i.unprojectFromWorld(this.position);this.coordinates=e.position=t}if(o&&(this.rotation.set(o[0],o[1],o[2]),e.rotation=new r.Vector3(o[0],o[1],o[2])),a&&(this.scale.set(a[0],a[1],a[2]),e.scale=this.scale),l&&(this.quaternion.setFromAxisAngle(l[0],l[1]),e.rotation=l[0].multiplyScalar(l[1])),s){this.position.copy(s);let t=i.unprojectFromWorld(s);this.coordinates=e.position=t}this.setBoundingBoxShadowFloor(),this.setReceiveShadowFloor(),this.updateMatrixWorld(),tb.map.repaint=!0,this.dispatchEvent(new CustomEvent("ObjectChanged",{detail:{object:this,action:{position:e.position,rotation:e.rotation,scale:e.scale}},bubbles:!0,cancelable:!0}))},t.playDefault=function(e){if(t.mixer&&t.hasDefaultAnimation){let n={start:Date.now(),expiration:Date.now()+e.duration,endState:{}};i.extend(e,n),t.mixer.timeScale=e.speed||1;let r={type:"playDefault",parameters:e};return this.animationQueue.push(r),tb.map.repaint=!0,this}},t.playAnimation=function(n){t.mixer&&(n.animation&&e(n.animation),t.playDefault(n))},t.pauseAllActions=function(){t.mixer&&t.actions.forEach((function(t){t.paused=!0}))},t.unPauseAllActions=function(){t.mixer&&t.actions.forEach((function(t){t.paused=!1}))},t.deactivateAllActions=function(){t.mixer&&t.actions.forEach((function(t){t.stop()}))},t.activateAllActions=function(){t.mixer&&t.actions.forEach((function(t){t.play()}))},t.idle=function(){return t.mixer&&t.mixer.update(.01),tb.map.repaint=!0,this}},update:function(t){void 0===this.previousFrameTime&&(this.previousFrameTime=t);if(!this.enrolledObjects)return!1;for(let e=this.enrolledObjects.length-1;e>=0;e--){let n=this.enrolledObjects[e];if(n.animationQueue&&0!==n.animationQueue.length)for(let e=n.animationQueue.length-1;e>=0;e--){let i=n.animationQueue[e];if(!i)continue;let o=i.parameters;if(!o.expiration)return n.animationQueue.splice(e,1),void(n.animationQueue[e]&&(n.animationQueue[e].parameters.start=t));let a=t>=o.expiration;if(a)o.expiration=!1,"playDefault"===i.type?n.stop():(o.endState&&n._setObject(o.endState),"undefined"!=typeof o.cb&&o.cb());else{let e=(t-o.start)/o.duration;if("set"===i.type){let t={};o.pathCurve&&(t.worldCoordinates=o.pathCurve.getPoint(e)),o.rotationPerMs&&(t.rotation=o.startRotation.map((function(t,n){return t+o.rotationPerMs[n]*e*o.duration}))),o.scalePerMs&&(t.scale=o.startScale.map((function(t,n){return t+o.scalePerMs[n]*e*o.duration}))),n._setObject(t)}if("followPath"===i.type){let t=o.pathCurve.getPointAt(e),i={worldCoordinates:t};if(o.trackHeading){let t=o.pathCurve.getTangentAt(e).normalize(),n=new r.Vector3(0,0,0),a=new r.Vector3(0,1,0);n.crossVectors(a,t).normalize();let s=Math.acos(a.dot(t));i.quaternion=[n,s]}n._setObject(i)}"playDefault"===i.type&&(n.activateAllActions(),n.isPlaying=!0,n.animationMethod=requestAnimationFrame(this.update),n.mixer.update(n.clock.getDelta()),tb.map.repaint=!0)}}}this.previousFrameTime=t}};const a={followPath:{path:null,duration:1e3,trackHeading:!0}};t.exports=o},c8ba:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}t.exports=n},ca6a:function(t,e,n){const r=n("916e");function i(t,e){const n=e.getBoundingClientRect();return new r(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)}t.exports=i},cae9:function(t,e,n){const r=n("a4f5"),i=n("93b5");function o(t){t=i._validate(t,r.prototype._defaults.Object3D);let e=t.obj;const n=i.types.rotation(t.rotation,[0,0,0]),o=i.types.scale(t.scale,[1,1,1]);e.rotation.set(n[0],n[1],n[2]),e.scale.set(o[0],o[1],o[2]),e.name="model";let a=r.prototype._makeGroup(e,t);return t.obj.name="model",r.prototype._addMethods(a),a.setAnchor(t.anchor),a.setCenter(t.adjustment),a.raycasted=t.raycasted,a.visibility=!0,a}t.exports=o},caf2:function(t,e,n){const r=n("2413"),i=n("95f0"),o=n("00a3"),a=n("e133"),s=n("ecba"),l=n("9724");t.exports=function(t){const e=new i(t,{type:a.geojsonTypes.FEATURE,properties:{},geometry:{type:a.geojsonTypes.POLYGON,coordinates:[[]]}});let n=0;return t._test&&(t._test.polygon=e),t.store.add(e),{start(){t.store.clearSelected(),o.disable(t),t.ui.queueMapClasses({mouse:a.cursors.ADD}),t.ui.setActiveButton(a.types.POLYGON),this.on("mousemove",r.true,i=>{e.updateCoordinate("0."+n,i.lngLat.lng,i.lngLat.lat),r.isVertex(i)&&t.ui.queueMapClasses({mouse:a.cursors.POINTER})}),this.on("click",r.true,r=>{if(n>0&&s(r,e.coordinates[0][n-1]))return t.events.changeMode(a.modes.SIMPLE_SELECT,{featureIds:[e.id]});t.ui.queueMapClasses({mouse:a.cursors.ADD}),e.updateCoordinate("0."+n,r.lngLat.lng,r.lngLat.lat),n++}),this.on("click",r.isVertex,()=>t.events.changeMode(a.modes.SIMPLE_SELECT,{featureIds:[e.id]})),this.on("keyup",r.isEscapeKey,()=>{t.store.delete([e.id],{silent:!0}),t.events.changeMode(a.modes.SIMPLE_SELECT)}),this.on("keyup",r.isEnterKey,()=>{t.events.changeMode(a.modes.SIMPLE_SELECT,{featureIds:[e.id]})}),t.events.actionable({combineFeatures:!1,uncombineFeatures:!1,trash:!0})},stop:function(){t.ui.queueMapClasses({mouse:a.cursors.NONE}),o.enable(t),t.ui.setActiveButton(),void 0!==t.store.get(e.id)&&(e.removeCoordinate("0."+n),e.isValid()?t.map.fire(a.events.CREATE,{features:[e.toGeoJSON()]}):(t.store.delete([e.id],{silent:!0}),t.events.changeMode(a.modes.SIMPLE_SELECT,{},{silent:!0})))},render(t,n){const r=t.properties.id===e.id;if(t.properties.active=r?a.activeStates.ACTIVE:a.activeStates.INACTIVE,!r)return n(t);if(0===t.geometry.coordinates.length)return;const i=t.geometry.coordinates[0].length;if(i<3)return;if(t.properties.meta=a.meta.FEATURE,i>4){n(l(e.id,t.geometry.coordinates[0][0],"0.0",!1));const r=t.geometry.coordinates[0].length-3;n(l(e.id,t.geometry.coordinates[0][r],"0."+r,!1))}if(i>3)return n(t);const o=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];return n({type:a.geojsonTypes.FEATURE,properties:t.properties,geometry:{coordinates:o,type:a.geojsonTypes.LINE_STRING}})},trash(){t.store.delete([e.id],{silent:!0}),t.events.changeMode(a.modes.SIMPLE_SELECT)}}}},cafc:function(t,e,n){const r=n("e133");t.exports=function(t,e,n,i){const o=e.geometry.coordinates,a=n.geometry.coordinates;if(o[1]>r.LAT_RENDERED_MAX||o[1]<r.LAT_RENDERED_MIN||a[1]>r.LAT_RENDERED_MAX||a[1]<r.LAT_RENDERED_MIN)return null;const s=i.project([o[0],o[1]]),l=i.project([a[0],a[1]]),c=i.unproject([(s.x+l.x)/2,(s.y+l.y)/2]);return{type:r.geojsonTypes.FEATURE,properties:{meta:r.meta.MIDPOINT,parent:t,lng:c.lng,lat:c.lat,coord_path:n.properties.coord_path},geometry:{type:r.geojsonTypes.POINT,coordinates:[c.lng,c.lat]}}}},cd37:function(t,e){(function(){"use strict";var e=Math.PI,n=Math.sin,r=Math.cos,i=Math.tan,o=Math.asin,a=Math.atan2,s=Math.acos,l=e/180,c=864e5,u=2440588,h=2451545;function p(t){return t.valueOf()/c-.5+u}function d(t){return new Date((t+.5-u)*c)}function f(t){return p(t)-h}var m=23.4397*l;function g(t,e){return a(n(t)*r(m)-i(e)*n(m),r(t))}function y(t,e){return o(n(e)*r(m)+r(e)*n(m)*n(t))}function v(t,e,o){return a(n(t),r(t)*n(e)-i(o)*r(e))}function _(t,e,i){return o(n(e)*n(i)+r(e)*r(i)*r(t))}function x(t,e){return l*(280.16+360.9856235*t)-e}function b(t){return t<0&&(t=0),2967e-7/Math.tan(t+.00312536/(t+.08901179))}function w(t){return l*(357.5291+.98560028*t)}function M(t){var r=l*(1.9148*n(t)+.02*n(2*t)+3e-4*n(3*t)),i=102.9372*l;return t+r+i+e}function E(t){var e=w(t),n=M(e);return{dec:y(n,0),ra:g(n,0)}}var S={getPosition:function(t,e,n){var r=l*-n,i=l*e,o=f(t),a=E(o),s=x(o,r)-a.ra;return{azimuth:v(s,i,a.dec),altitude:_(s,i,a.dec)}},toJulian:function(t){return p(t)}},T=S.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];S.addTime=function(t,e,n){T.push([t,e,n])};var A=9e-4;function C(t,n){return Math.round(t-A-n/(2*e))}function L(t,n,r){return A+(t+n)/(2*e)+r}function I(t,e,r){return h+t+.0053*n(e)-.0069*n(2*r)}function P(t,e,i){return s((n(t)-n(e)*n(i))/(r(e)*r(i)))}function R(t){return-2.076*Math.sqrt(t)/60}function O(t,e,n,r,i,o,a){var s=P(t,n,r),l=L(s,e,i);return I(l,o,a)}function D(t){var e=l*(218.316+13.176396*t),i=l*(134.963+13.064993*t),o=l*(93.272+13.22935*t),a=e+6.289*l*n(i),s=5.128*l*n(o),c=385001-20905*r(i);return{ra:g(a,s),dec:y(a,s),dist:c}}function N(t,e){return new Date(t.valueOf()+e*c/24)}S.getTimes=function(t,e,n,r){r=r||0;var i,o,a,s,c,u,h=l*-n,p=l*e,m=R(r),g=f(t),v=C(g,h),_=L(0,h,v),x=w(_),b=M(x),E=y(b,0),S=I(_,x,b),A={solarNoon:d(S),nadir:d(S-.5)};for(i=0,o=T.length;i<o;i+=1)a=T[i],s=(a[0]+m)*l,c=O(s,h,p,E,v,x,b),u=S-(c-S),A[a[1]]=d(u),A[a[2]]=d(c);return A},S.getMoonPosition=function(t,e,o){var s=l*-o,c=l*e,u=f(t),h=D(u),p=x(u,s)-h.ra,d=_(p,c,h.dec),m=a(n(p),i(c)*r(h.dec)-n(h.dec)*r(p));return d+=b(d),{azimuth:v(p,c,h.dec),altitude:d,distance:h.dist,parallacticAngle:m}},S.getMoonIllumination=function(t){var e=f(t||new Date),i=E(e),o=D(e),l=149598e3,c=s(n(i.dec)*n(o.dec)+r(i.dec)*r(o.dec)*r(i.ra-o.ra)),u=a(l*n(c),o.dist-l*r(c)),h=a(r(i.dec)*n(i.ra-o.ra),n(i.dec)*r(o.dec)-r(i.dec)*n(o.dec)*r(i.ra-o.ra));return{fraction:(1+r(u))/2,phase:.5+.5*u*(h<0?-1:1)/Math.PI,angle:h}},S.getMoonTimes=function(t,e,n,r){var i=new Date(t);r?i.setUTCHours(0,0,0,0):i.setHours(0,0,0,0);for(var o,a,s,c,u,h,p,d,f,m,g,y,v,_=.133*l,x=S.getMoonPosition(i,e,n).altitude-_,b=1;b<=24;b+=2){if(o=S.getMoonPosition(N(i,b),e,n).altitude-_,a=S.getMoonPosition(N(i,b+1),e,n).altitude-_,u=(x+a)/2-o,h=(a-x)/2,p=-h/(2*u),d=(u*p+h)*p+o,f=h*h-4*u*o,m=0,f>=0&&(v=Math.sqrt(f)/(2*Math.abs(u)),g=p-v,y=p+v,Math.abs(g)<=1&&m++,Math.abs(y)<=1&&m++,g<-1&&(g=y)),1===m?x<0?s=b+g:c=b+g:2===m&&(s=b+(d<0?y:g),c=b+(d<0?g:y)),s&&c)break;x=a}var w={};return s&&(w.rise=N(i,s)),c&&(w.set=N(i,c)),s||c||(w[d>0?"alwaysUp":"alwaysDown"]=!0),w},t.exports=S})()},d0eb:function(t,e){t.exports=function(t){return{stop:function(){},start:function(){t.events.actionable({combineFeatures:!1,uncombineFeatures:!1,trash:!1})},render:function(t,e){e(t)}}}},d125:function(t,e,n){const r=n("300a"),i=4,o=12,a=500;t.exports=function(t,e,n={}){const s=null!=n.fineTolerance?n.fineTolerance:i,l=null!=n.grossTolerance?n.grossTolerance:o,c=null!=n.interval?n.interval:a;t.point=t.point||e.point,t.time=t.time||e.time;const u=r(t.point,e.point);return u<s||u<l&&e.time-t.time<c}},d56d:function(t,e,n){const r=n("93b5"),o=n("4338"),a=n("a4f5"),s=n("7bc4"),l=n("cae9");function c(t,e){t=r._validate(t,a.prototype._defaults.tube);let n=r.lnglatsToWorld(t.geometry),i=r.normalizeVertices(n),u=c.prototype.defineCrossSection(t),h=c.prototype.buildVertices(u,i.vertices,e),p=c.prototype.buildFaces(h,i.vertices,t),d=o(t),f=new s.Mesh(p,d);return new l({obj:f,units:t.units,anchor:t.anchor,adjustment:t.adjustment,bbox:t.bbox,tooltip:t.tooltip,raycasted:t.raycasted})}c.prototype={buildVertices:function(t,e,n){var r=new s.PlaneBufferGeometry(99999999999,9999999999),o=new s.MeshBasicMaterial({color:16777215,side:s.DoubleSide});o.opacity=0;var a=new s.Mesh(r,o),l=new s.Geometry,c=!1,u=[e[0].clone().normalize()];for(i in e){var h;i=parseFloat(i),e[i+1]&&(h=(new s.Vector3).subVectors(e[i+1],e[i]).normalize()),u.push(h)}for(i in u.push(new s.Vector3),e){i=parseFloat(i);var p=e[i],d=u[i],f=u[i+1],m=d.clone().add(f).normalize();if(0===i?m=f:i===e.length-1&&(m=d),c){let t=[];a.position.copy(p),a.lookAt(m.clone().add(p)),a.updateMatrixWorld(),c.forEach((function(e){let n=new s.Raycaster(e,d),r=n.intersectObject(a)[0];r?(l.vertices.push(r.point),t.push(r.point)):console.error("Tube geometry failed at vertex "+i+". Consider reducing tube radius, or smoothening out the sharp angle at this vertex")})),c=t}else{let e=t.clone();e.lookAt(m),e.vertices.forEach((function(t){l.vertices.push(t.add(p))})),c=e.vertices}}return n.remove(a),l},defineCrossSection:function(t){let e=new s.Geometry,n=t.sides;for(let r=0;r<n;r++){let i=t.radius,o=(r+.5)/n*Math.PI;e.vertices.push(new s.Vector3(-Math.sin(2*o),Math.cos(2*o),0).multiplyScalar(i))}return e},buildFaces:function(t,e,n){for(let i in e){i=parseFloat(i);e[i];if(i<e.length-1)for(let e=0;e<n.sides;e++){let r=i*n.sides+e,o=i*n.sides+(e+1)%n.sides,a=r+n.sides,l=o+n.sides,c=new s.Face3(a,r,o),u=new s.Face3(a,o,l);t.faces.push(c,u)}}let r=t.vertices.length;for(let i=0;i+2<n.sides;i++){let e=new s.Face3(0,i+2,i+1),n=new s.Face3(r-1,r-1-(i+2),r-1-(i+1));t.faces.push(e,n)}t.computeFaceNormals();(new s.BufferGeometry).fromGeometry(t);return t}},t.exports=c},d7df:function(t,e,n){const r=n("9724"),i=n("cafc"),o=n("e133");function a(t,e={},n=null){const{type:s,coordinates:l}=t.geometry,c=t.properties&&t.properties.id;let u=[];function h(t,n){let o="",a=null;t.forEach((t,s)=>{const l=void 0!==n&&null!==n?`${n}.${s}`:String(s),h=r(c,t,l,p(l));if(e.midpoints&&a){const t=i(c,a,h,e.map);t&&u.push(t)}a=h;const d=JSON.stringify(t);o!==d&&u.push(h),0===s&&(o=d)})}function p(t){return!!e.selectedPaths&&-1!==e.selectedPaths.indexOf(t)}function d(){const n=s.replace(o.geojsonTypes.MULTI_PREFIX,"");l.forEach((r,i)=>{const s={type:o.geojsonTypes.FEATURE,properties:t.properties,geometry:{type:n,coordinates:r}};u=u.concat(a(s,e,i))})}return s===o.geojsonTypes.POINT?u.push(r(c,l,n,p(n))):s===o.geojsonTypes.POLYGON?l.forEach((t,e)=>{h(t,null!==n?`${n}.${e}`:String(e))}):s===o.geojsonTypes.LINE_STRING?h(l,n):0===s.indexOf(o.geojsonTypes.MULTI_PREFIX)&&d(),u}t.exports=a},df7c:function(t,e,n){(function(t){function n(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function r(t){"string"!==typeof t&&(t+="");var e,n=0,r=-1,i=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!i){n=e+1;break}}else-1===r&&(i=!1,r=e+1);return-1===r?"":t.slice(n,r)}function i(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}e.resolve=function(){for(var e="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var a=o>=0?arguments[o]:t.cwd();if("string"!==typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,r="/"===a.charAt(0))}return e=n(i(e.split("/"),(function(t){return!!t})),!r).join("/"),(r?"/":"")+e||"."},e.normalize=function(t){var r=e.isAbsolute(t),a="/"===o(t,-1);return t=n(i(t.split("/"),(function(t){return!!t})),!r).join("/"),t||r||(t="."),t&&a&&(t+="/"),(r?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(i(t,(function(t,e){if("string"!==typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))},e.relative=function(t,n){function r(t){for(var e=0;e<t.length;e++)if(""!==t[e])break;for(var n=t.length-1;n>=0;n--)if(""!==t[n])break;return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var i=r(t.split("/")),o=r(n.split("/")),a=Math.min(i.length,o.length),s=a,l=0;l<a;l++)if(i[l]!==o[l]){s=l;break}var c=[];for(l=s;l<i.length;l++)c.push("..");return c=c.concat(o.slice(s)),c.join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){if("string"!==typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),n=47===e,r=-1,i=!0,o=t.length-1;o>=1;--o)if(e=t.charCodeAt(o),47===e){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":t.slice(0,r)},e.basename=function(t,e){var n=r(t);return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){"string"!==typeof t&&(t+="");for(var e=-1,n=0,r=-1,i=!0,o=0,a=t.length-1;a>=0;--a){var s=t.charCodeAt(a);if(47!==s)-1===r&&(i=!1,r=a+1),46===s?-1===e?e=a:1!==o&&(o=1):-1!==e&&(o=-1);else if(!i){n=a+1;break}}return-1===e||-1===r||0===o||1===o&&e===r-1&&e===n+1?"":t.slice(e,r)};var o="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,n("4362"))},e133:function(t,e){t.exports={classes:{CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources:{HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},cursors:{ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types:{POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes:{FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes:{DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},events:{CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions:{MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},meta:{FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates:{ACTIVE:"true",INACTIVE:"false"},LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}},e192:function(t,e,n){(function(e,n){t.exports=n()})(0,(function(){"use strict";var t,e,n;function r(r,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),n=i(a),"undefined"!==typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}return r(["exports"],(function(t){var e=n;function n(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var r=i;function i(t,e){this.x=t,this.y=e}i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t};var o="undefined"!=typeof self?self:{};function a(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!a(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!a(t[n],e[n]))return!1;return!0}return t===e}const s=Math.pow(2,53)-1,l=Math.PI/180,c=180/Math.PI;function u(t){return t*l}function h(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function p(t,n,r,i){const o=new e(t,n,r,i);return function(t){return o.solve(t)}}const d=p(.25,.1,.25,1);function f(t,e,n){return Math.min(n,Math.max(e,t))}function m(t,e,n){const r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function g(t){const e=[];for(const n in t)e.push(t[n]);return e}function y(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}let v=1;function _(){return v++}function x(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function b(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function w(t,e){t.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function M(t,e){return-1!==t.indexOf(e,t.length-e.length)}function E(t,e,n){const r={};for(const i in t)r[i]=e.call(n||this,t[i],i,t);return r}function S(t,e,n){const r={};for(const i in t)e.call(n||this,t[i],i,t)&&(r[i]=t[i]);return r}function T(t){return Array.isArray(t)?t.map(T):"object"==typeof t&&t?E(t,T):t}const A={};function C(t){A[t]||("undefined"!=typeof console&&console.warn(t),A[t]=!0)}function L(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function I(t){let e=0;for(let n,r,i=0,o=t.length,a=o-1;i<o;a=i++)n=t[i],r=t[a],e+=(r.x-n.x)*(n.y+r.y);return e}function P(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function R(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,r,i)=>{const o=r||i;return e[n]=!o||o.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let O,D,N=null;function k(t){if(null==N){const e=t.navigator?t.navigator.userAgent:null;N=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return N}function F(t){try{const e=o[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}let z,B=!1;const U={now:()=>void 0!==z?z:o.performance.now(),setErrorState(){B=!0},setNow(t){z=t},restoreNow(){z=void 0},frame(t){if(B)return{cancel:()=>{}};const e=o.requestAnimationFrame(t);return{cancel:()=>o.cancelAnimationFrame(e)}},getImageData(t,e=0){const n=o.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(O||(O=o.document.createElement("a")),O.href=t,O.href),get devicePixelRatio(){return o.devicePixelRatio},get prefersReducedMotion(){return!!o.matchMedia&&(null==D&&(D=o.matchMedia("(prefers-reduced-motion: reduce)")),D.matches)}};let j;const G={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==j){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{j=null!=Object({NODE_ENV:"production",BASE_URL:"/site-divider/"}).API_URL_REGEX?new RegExp(Object({NODE_ENV:"production",BASE_URL:"/site-divider/"}).API_URL_REGEX):t}catch(e){j=t}}return j},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(t){!q&&W&&(X?Z(t):H=t)}};let H,W,q=!1,X=!1;function Z(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,W),t.isContextLost())return;V.supported=!0}catch(t){}t.deleteTexture(e),q=!0}o.document&&(W=o.document.createElement("img"),W.onload=function(){H&&Z(H),H=null,X=!0},W.onerror=function(){q=!0,H=null},W.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Y="01";function $(t){return 0===t.indexOf("mapbox:")}function J(t){return G.API_URL_REGEX.test(t)}const K=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Q(t){const e=t.match(K);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function tt(t){const e=t.params.length?"?"+t.params.join("&"):"";return`${t.protocol}://${t.authority}${t.path}${e}`}function et(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(o.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(t){return null}}class nt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=et(G.ACCESS_TOKEN);let n="";return n=e&&e.u?o.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode(Number("0x"+e)))):G.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${n}`:"mapbox.eventData:"+n}fetchEventData(){const t=F("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{const t=o.localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const r=o.localStorage.getItem(n);r&&(this.anonId=r)}catch(t){C("Unable to read from LocalStorage")}}saveEventData(){const t=F("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{o.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&o.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){C("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,n,r){if(!G.EVENTS_URL)return;const i=Q(G.EVENTS_URL);i.params.push("access_token="+(r||G.ACCESS_TOKEN||""));const o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.0.1",skuId:Y,userId:this.anonId},a=e?y(o,e):o,s={url:tt(i),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=Mt(s,t=>{this.pendingRequest=null,n(t),this.saveEventData(),this.processRequests(r)})}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const rt=new class extends nt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){G.EVENTS_URL&&G.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>$(t)||J(t))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=et(G.ACCESS_TOKEN),n=e?e.u:G.ACCESS_TOKEN;let r=n!==this.eventData.tokenU;b(this.anonId)||(this.anonId=x(),r=!0);const i=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(i),n=(i-this.eventData.lastSuccess)/864e5;r=r||n>=1||n<-1||t.getDate()!==e.getDate()}else r=!0;if(!r)return this.processRequests();this.postEvent(i,{"enabled.telemetry":!1},t=>{t||(this.eventData.lastSuccess=i,this.eventData.tokenU=n)},t)}},it=rt.postTurnstileEvent.bind(rt),ot=new class extends nt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,r){this.skuToken=e,this.errorCb=r,G.EVENTS_URL&&(n||G.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),b(this.anonId)||(this.anonId=x()),this.postEvent(n,{skuToken:this.skuToken},t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t))}},at=ot.postMapLoadEvent.bind(ot),st=new class extends nt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,r){if(!G.API_URL||!G.SESSION_PATH)return;const i=Q(G.API_URL+G.SESSION_PATH);i.params.push("sku="+(e||"")),i.params.push("access_token="+(r||G.ACCESS_TOKEN||""));const o={url:tt(i),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Et(o,t=>{this.pendingRequest=null,n(t),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,n,r){this.skuToken=e,this.errorCb=r,G.SESSION_PATH&&G.API_URL&&(n||G.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error("NO_ACCESS_TOKEN")))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t)}},lt=st.getSessionAPI.bind(st);let ct,ut,ht=500,pt=50;function dt(){o.caches&&!ct&&(ct=o.caches.open("mapbox-tiles"))}function ft(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let mt,gt=1/0;function yt(){return null==mt&&(mt=o.OffscreenCanvas&&new o.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof o.createImageBitmap),mt}const vt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(vt);class _t extends Error{constructor(t,e,n){401===e&&J(n)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xt=P()?()=>self.worker&&self.worker.referrer:()=>("blob:"===o.location.protocol?o.parent:o).location.href,bt=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(xt())&&!/^\w+:/.test(n))){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty("signal"))return function(t,e){const n=new o.AbortController,r=new o.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:xt(),signal:n.signal});let i=!1,a=!1;const s=(l=r.url).indexOf("sku=")>0&&J(l);var l;"json"===t.type&&r.headers.set("Accept","application/json");const c=(n,i,l)=>{if(a)return;if(n&&"SecurityError"!==n.message&&C(n),i&&l)return u(i);const c=Date.now();o.fetch(r).then(n=>{if(n.ok){const t=s?n.clone():null;return u(n,t,c)}return e(new _t(n.statusText,n.status,t.url))}).catch(t=>{20!==t.code&&e(new Error(t.message))})},u=(n,s,l)=>{("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then(t=>{a||(s&&l&&function(t,e,n){if(dt(),!ct)return;const r={status:e.status,statusText:e.statusText,headers:new o.Headers};e.headers.forEach((t,e)=>r.headers.set(e,t));const i=R(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===ut)try{new Response(new ReadableStream),ut=!0}catch(t){ut=!1}ut?e(t.body):t.blob().then(e)}(e,e=>{const n=new o.Response(e,r);dt(),ct&&ct.then(e=>e.put(ft(t.url),n)).catch(t=>C(t.message))}))}(r,s,l),i=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))}).catch(t=>{a||e(new Error(t.message))})};return s?function(t,e){if(dt(),!ct)return e(null);const n=ft(t.url);ct.then(t=>{t.match(n).then(r=>{const i=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),n=R(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(r);t.delete(n),i&&t.put(n,r.clone()),e(null,r,i)}).catch(e)}).catch(e)}(r,c):c(null,null),{cancel:()=>{a=!0,i||n.abort()}}}(t,e);if(P()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){const n=new o.XMLHttpRequest;n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer");for(const r in t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=()=>{e(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new _t(n.statusText,n.status,t.url))},n.send(t.body),{cancel:()=>n.abort()}}(t,e)},wt=function(t,e){return bt(y(t,{type:"arrayBuffer"}),e)},Mt=function(t,e){return bt(y(t,{method:"POST"}),e)},Et=function(t,e){return bt(y(t,{method:"GET"}),e)};function St(t){const e=o.document.createElement("a");return e.href=t,e.protocol===o.document.location.protocol&&e.host===o.document.location.host}const Tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let At,Ct;At=[],Ct=0;const Lt=function(t,e){if(V.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ct>=G.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return At.push(n),n}Ct++;let n=!1;const r=()=>{if(!n)for(n=!0,Ct--;At.length&&Ct<G.MAX_PARALLEL_IMAGE_REQUESTS;){const t=At.shift(),{requestParameters:e,callback:n,cancelled:r}=t;r||(t.cancel=Lt(e,n).cancel)}},i=wt(t,(t,n,i,a)=>{r(),t?e(t):n&&(yt()?function(t,e){const n=new o.Blob([new Uint8Array(t)],{type:"image/png"});o.createImageBitmap(n).then(t=>{e(null,t)}).catch(t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(n,e):function(t,e,n,r){const i=new o.Image,a=o.URL;i.onload=()=>{e(null,i),a.revokeObjectURL(i.src),i.onload=null,o.requestAnimationFrame(()=>{i.src=Tt})},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const s=new o.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=n,i.expires=r,i.src=t.byteLength?a.createObjectURL(s):Tt}(n,e,i,a))});return{cancel:()=>{i.cancel(),r()}}};function It(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Pt(t,e,n){if(n&&n[t]){const r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}class Rt{constructor(t,e={}){y(this,e),this.type=t}}class Ot extends Rt{constructor(t,e={}){super("error",y({error:t},e))}}class Dt{on(t,e){return this._listeners=this._listeners||{},It(t,e,this._listeners),this}off(t,e){return Pt(t,e,this._listeners),Pt(t,e,this._oneTimeListeners),this}once(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},It(t,e,this._oneTimeListeners),this}fire(t,e){"string"==typeof t&&(t=new Rt(t,e||{}));const n=t.type;if(this.listens(n)){t.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of r)Pt(n,o,this._oneTimeListeners),o.call(this,t);const i=this._eventedParent;i&&(y(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(t))}else t instanceof Ot&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var Nt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class kt{constructor(t,e,n,r){this.message=(t?t+": ":"")+n,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)}}function Ft(t){const e=t.value;return e?[new kt(t.key,e,"constants have been deprecated as of v8")]:[]}function zt(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}function Bt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ut(t){if(Array.isArray(t))return t.map(Ut);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Ut(t[n]);return e}return Bt(t)}class jt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Gt{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[n,r]of e)this.bindings[n]=r}concat(t){return new Gt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Vt={kind:"null"},Ht={kind:"number"},Wt={kind:"string"},qt={kind:"boolean"},Xt={kind:"color"},Zt={kind:"object"},Yt={kind:"value"},$t={kind:"collator"},Jt={kind:"formatted"},Kt={kind:"resolvedImage"};function Qt(t,e){return{kind:"array",itemType:t,N:e}}function te(t){if("array"===t.kind){const e=te(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ee=[Vt,Ht,Wt,qt,Xt,Jt,Zt,Qt(Yt),Kt];function ne(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ne(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of ee)if(!ne(t,e))return null}return`Expected ${te(t)} but found ${te(e)} instead.`}function re(t,e){return e.some(e=>e.kind===t.kind)}function ie(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function oe(t,e){return t(e={exports:{}},e.exports),e.exports}var ae=oe((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return r("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=s.indexOf("("),c=s.indexOf(")");if(-1!==l&&c+1===s.length){var u=s.substr(0,l),h=s.substr(l+1,c-(l+1)).split(","),p=1;switch(u){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[r(255*a(y,g,d+1/3)),r(255*a(y,g,d)),r(255*a(y,g,d-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor;class se{constructor(t,e,n,r=1){this.r=t,this.g=e,this.b=n,this.a=r}static parse(t){if(!t)return;if(t instanceof se)return t;if("string"!=typeof t)return;const e=ae(t);return e?new se(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,n,r]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(n)},${r})`}toArray(){const{r:t,g:e,b:n,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*n/r,r]}}se.black=new se(0,0,0,1),se.white=new se(1,1,1,1),se.transparent=new se(0,0,0,0),se.red=new se(1,0,0,1),se.blue=new se(0,0,1,1);class le{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ce{constructor(t,e,n,r,i){this.text=t,this.image=e,this.scale=n,this.fontStack=r,this.textColor=i}}class ue{constructor(t){this.sections=t}static fromString(t){return new ue([new ce(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof ue?t:ue.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const n={};e.fontStack&&(n["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(n["font-scale"]=e.scale),e.textColor&&(n["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(n)}return t}}class he{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new he({name:t,available:!1}):null}serialize(){return["image",this.name]}}function pe(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function de(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof se)return!0;if(t instanceof le)return!0;if(t instanceof ue)return!0;if(t instanceof he)return!0;if(Array.isArray(t)){for(const e of t)if(!de(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!de(t[e]))return!1;return!0}return!1}function fe(t){if(null===t)return Vt;if("string"==typeof t)return Wt;if("boolean"==typeof t)return qt;if("number"==typeof t)return Ht;if(t instanceof se)return Xt;if(t instanceof le)return $t;if(t instanceof ue)return Jt;if(t instanceof he)return Kt;if(Array.isArray(t)){const e=t.length;let n;for(const r of t){const t=fe(r);if(n){if(n===t)continue;n=Yt;break}n=t}return Qt(n||Yt,e)}return Zt}function me(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof se||t instanceof ue||t instanceof he?t.toString():JSON.stringify(t)}class ge{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!de(t[1]))return e.error("invalid value");const n=t[1];let r=fe(n);const i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new ge(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof se?["rgba"].concat(this.value.toArray()):this.value instanceof ue?this.value.serialize():this.value}}class ye{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ve={string:Wt,number:Ht,boolean:qt,object:Zt};class _e{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,r=1;const i=t[0];if("array"===i){let i,o;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in ve)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);i=ve[n],r++}else i=Yt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],r++}n=Qt(i,o)}else n=ve[i];const o=[];for(;r<t.length;r++){const n=e.parse(t[r],r,Yt);if(!n)return null;o.push(n)}return new _e(n,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!ne(this.type,fe(n)))return n;if(e===this.args.length-1)throw new ye(`Expected value to be of type ${te(this.type)}, but found ${te(fe(n))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map(t=>t.serialize()))}}class xe{constructor(t){this.type=Jt,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const r=[];let i=!1;for(let o=1;o<=t.length-1;++o){const n=t[o];if(i&&"object"==typeof n&&!Array.isArray(n)){i=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,Ht),!t))return null;let o=null;if(n["text-font"]&&(o=e.parse(n["text-font"],1,Qt(Wt)),!o))return null;let a=null;if(n["text-color"]&&(a=e.parse(n["text-color"],1,Xt),!a))return null;const s=r[r.length-1];s.scale=t,s.font=o,s.textColor=a}else{const n=e.parse(t[o],1,Yt);if(!n)return null;const a=n.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:n,scale:null,font:null,textColor:null})}}return new xe(r)}evaluate(t){return new ue(this.sections.map(e=>{const n=e.content.evaluate(t);return fe(n)===Kt?new ce("",n,null,null,null):new ce(me(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const n={};e.scale&&(n["font-scale"]=e.scale.serialize()),e.font&&(n["text-font"]=e.font.serialize()),e.textColor&&(n["text-color"]=e.textColor.serialize()),t.push(n)}return t}}class be{constructor(t){this.type=Kt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Wt);return n?new be(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=he.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const we={"to-boolean":qt,"to-color":Xt,"to-number":Ht,"to-string":Wt};class Me{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const r=we[n],i=[];for(let o=1;o<t.length;o++){const n=e.parse(t[o],o,Yt);if(!n)return null;i.push(n)}return new Me(r,i)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,n;for(const r of this.args){if(e=r.evaluate(t),n=null,e instanceof se)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:pe(e[0],e[1],e[2],e[3]),!n))return new se(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ye(n||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new ye(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?ue.fromString(me(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?he.fromString(me(this.args[0].evaluate(t))):me(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new xe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new be(this.args[0]).serialize();const t=["to-"+this.type.kind];return this.eachChild(e=>{t.push(e.serialize())}),t}}const Ee=["Unknown","Point","LineString","Polygon"];class Se{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ee[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=se.parse(t)),e}}class Te{constructor(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,e){const n=t[0],r=Te.definitions[n];if(!r)return e.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,a=o.filter(([e])=>!Array.isArray(e)||e.length===t.length-1);let s=null;for(const[l,c]of a){s=new Ze(e.registry,e.path,null,e.scope);const r=[];let o=!1;for(let e=1;e<t.length;e++){const n=t[e],i=Array.isArray(l)?l[e-1]:l.type,a=s.parse(n,1+r.length,i);if(!a){o=!0;break}r.push(a)}if(!o)if(Array.isArray(l)&&l.length!==r.length)s.error(`Expected ${l.length} arguments, but found ${r.length} instead.`);else{for(let t=0;t<r.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=r[t];s.concat(t+1).checkSubtype(e,n.type)}if(0===s.errors.length)return new Te(n,i,c,r)}}if(1===a.length)e.errors.push(...s.errors);else{const n=(a.length?a:o).map(([t])=>{return e=t,Array.isArray(e)?`(${e.map(te).join(", ")})`:`(${te(e.type)}...)`;var e}).join(" | "),r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],1+r.length);if(!n)return null;r.push(te(n.type))}e.error(`Expected arguments of type ${n}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){Te.definitions=e;for(const n in e)t[n]=Te}}class Ae{constructor(t,e,n){this.type=$t,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,qt);if(!r)return null;const i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,qt);if(!i)return null;let o=null;return n.locale&&(o=e.parse(n.locale,1,Wt),!o)?null:new Ae(r,i,o)}evaluate(t){return new le(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Ce(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Le(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ie(t,e){const n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function Pe(t,e,n){const r=t[0]-e[0],i=t[1]-e[1],o=t[0]-n[0],a=t[1]-n[1];return r*a-o*i==0&&r*o<=0&&i*a<=0}function Re(t,e){let n=!1;for(let a=0,s=e.length;a<s;a++){const s=e[a];for(let e=0,a=s.length;e<a-1;e++){if(Pe(t,s[e],s[e+1]))return!1;(i=s[e])[1]>(r=t)[1]!=(o=s[e+1])[1]>r[1]&&r[0]<(o[0]-i[0])*(r[1]-i[1])/(o[1]-i[1])+i[0]&&(n=!n)}}var r,i,o;return n}function Oe(t,e){for(let n=0;n<e.length;n++)if(Re(t,e[n]))return!0;return!1}function De(t,e,n,r){const i=r[0]-n[0],o=r[1]-n[1],a=(t[0]-n[0])*o-i*(t[1]-n[1]),s=(e[0]-n[0])*o-i*(e[1]-n[1]);return a>0&&s<0||a<0&&s>0}function Ne(t,e,n){for(const c of n)for(let n=0;n<c.length-1;++n)if(0!=(s=[(a=c[n+1])[0]-(o=c[n])[0],a[1]-o[1]])[0]*(l=[(i=e)[0]-(r=t)[0],i[1]-r[1]])[1]-s[1]*l[0]&&De(r,i,o,a)&&De(o,a,r,i))return!0;var r,i,o,a,s,l;return!1}function ke(t,e){for(let n=0;n<t.length;++n)if(!Re(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Ne(t[n],t[n+1],e))return!1;return!0}function Fe(t,e){for(let n=0;n<e.length;n++)if(ke(t,e[n]))return!0;return!1}function ze(t,e,n){const r=[];for(let i=0;i<t.length;i++){const o=[];for(let r=0;r<t[i].length;r++){const a=Ie(t[i][r],n);Ce(e,a),o.push(a)}r.push(o)}return r}function Be(t,e,n){const r=[];for(let i=0;i<t.length;i++){const o=ze(t[i],e,n);r.push(o)}return r}function Ue(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){const e=.5*r;let i=t[0]-n[0]>e?-r:n[0]-t[0]>e?r:0;0===i&&(i=t[0]-n[2]>e?-r:n[2]-t[0]>e?r:0),t[0]+=i}Ce(e,t)}function je(t,e,n,r){const i=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[];for(const s of t)for(const t of s){const r=[t.x+o[0],t.y+o[1]];Ue(r,e,n,i),a.push(r)}return a}function Ge(t,e,n,r){const i=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[];for(const l of t){const t=[];for(const n of l){const r=[n.x+o[0],n.y+o[1]];Ce(e,r),t.push(r)}a.push(t)}if(e[2]-e[0]<=i/2){(s=e)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const t of a)for(const r of t)Ue(r,e,n,i)}var s;return a}class Ve{constructor(t,e){this.type=qt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(de(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const n=e.features[t].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Ve(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Ve(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Ve(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){const o=ze(e.coordinates,r,i),a=je(t.geometry(),n,r,i);if(!Le(n,r))return!1;for(const t of a)if(!Re(t,o))return!1}if("MultiPolygon"===e.type){const o=Be(e.coordinates,r,i),a=je(t.geometry(),n,r,i);if(!Le(n,r))return!1;for(const t of a)if(!Oe(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){const o=ze(e.coordinates,r,i),a=Ge(t.geometry(),n,r,i);if(!Le(n,r))return!1;for(const t of a)if(!ke(t,o))return!1}if("MultiPolygon"===e.type){const o=Be(e.coordinates,r,i),a=Ge(t.geometry(),n,r,i);if(!Le(n,r))return!1;for(const t of a)if(!Fe(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function He(t){if(t instanceof Te){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ve)return!1;let e=!0;return t.eachChild(t=>{e&&!He(t)&&(e=!1)}),e}function We(t){if(t instanceof Te&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!We(t)&&(e=!1)}),e}function qe(t,e){if(t instanceof Te&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(t=>{n&&!qe(t,e)&&(n=!1)}),n}class Xe{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new Xe(n,e.scope.get(n)):e.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ze{constructor(t,e=[],n,r=new Gt,i=[]){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=r,this.errors=i,this.expectedType=n}parse(t,e,n,r,i={}){return e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)}_parse(t,e){function n(t,e,n){return"assert"===n?new _e(e,[t]):"coerce"===n?new Me(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[r];if(i){let r=i.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else r=n(r,t,e.typeAnnotation||"coerce");else r=n(r,t,e.typeAnnotation||"assert")}if(!(r instanceof ge)&&"resolvedImage"!==r.type.kind&&function t(e){if(e instanceof Xe)return t(e.boundExpression);if(e instanceof Te&&"error"===e.name)return!1;if(e instanceof Ae)return!1;if(e instanceof Ve)return!1;const n=e instanceof Me||e instanceof _e;let r=!0;return e.eachChild(e=>{r=n?r&&t(e):r&&e instanceof ge}),!!r&&He(e)&&qe(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}(r)){const e=new Se;try{r=new ge(r.type,r.evaluate(e))}catch(t){return this.error(t.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,n){const r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new Ze(this.registry,r,e||null,i,this.errors)}error(t,...e){const n=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new jt(n,t))}checkSubtype(t,e){const n=ne(t,e);return n&&this.error(n),n}}function Ye(t,e){const n=t.length-1;let r,i,o=0,a=n,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),r=t[s],i=t[s+1],r<=e){if(s===n||e<i)return s;o=s+1}else{if(!(r>e))throw new ye("Input is not a number.");a=s-1}return 0}class $e{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[r,i]of n)this.labels.push(r),this.outputs.push(i)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,Ht);if(!n)return null;const r=[];let i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(let o=1;o<t.length;o+=2){const n=1===o?-1/0:t[o],a=t[o+1],s=o,l=o+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=e.parse(a,l,i);if(!c)return null;i=i||c.type,r.push([n,c])}return new $e(i,n,r)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);const i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[Ye(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}function Je(t,e,n){return t*(1-n)+e*n}var Ke=Object.freeze({__proto__:null,number:Je,color:function(t,e,n){return new se(Je(t.r,e.r,n),Je(t.g,e.g,n),Je(t.b,e.b,n),Je(t.a,e.a,n))},array:function(t,e,n){return t.map((t,r)=>Je(t,e[r],n))}});const Qe=6/29*3*(6/29),tn=Math.PI/180,en=180/Math.PI;function nn(t){return t>.008856451679035631?Math.pow(t,1/3):t/Qe+4/29}function rn(t){return t>6/29?t*t*t:Qe*(t-4/29)}function on(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function an(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function sn(t){const e=an(t.r),n=an(t.g),r=an(t.b),i=nn((.4124564*e+.3575761*n+.1804375*r)/.95047),o=nn((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-nn((.0193339*e+.119192*n+.9503041*r)/1.08883)),alpha:t.a}}function ln(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*rn(e),n=.95047*rn(n),r=1.08883*rn(r),new se(on(3.2404542*n-1.5371385*e-.4985314*r),on(-.969266*n+1.8760108*e+.041556*r),on(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function cn(t,e,n){const r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const un={forward:sn,reverse:ln,interpolate:function(t,e,n){return{l:Je(t.l,e.l,n),a:Je(t.a,e.a,n),b:Je(t.b,e.b,n),alpha:Je(t.alpha,e.alpha,n)}}},hn={forward:function(t){const{l:e,a:n,b:r}=sn(t),i=Math.atan2(r,n)*en;return{h:i<0?i+360:i,c:Math.sqrt(n*n+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*tn,n=t.c;return ln({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:cn(t.h,e.h,n),c:Je(t.c,e.c,n),l:Je(t.l,e.l,n),alpha:Je(t.alpha,e.alpha,n)}}};var pn=Object.freeze({__proto__:null,lab:un,hcl:hn});class dn{constructor(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(const[o,a]of i)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(t,n,r,i){let o=0;if("exponential"===t.name)o=fn(n,t.base,r,i);else if("linear"===t.name)o=fn(n,1,r,i);else if("cubic-bezier"===t.name){const a=t.controlPoints;o=new e(a[0],a[1],a[2],a[3]).solve(fn(n,1,r,i))}return o}static parse(t,e){let[n,r,i,...o]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);{const t=r.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(i=e.parse(i,2,Ht),!i)return null;const a=[];let s=null;"interpolate-hcl"===n||"interpolate-lab"===n?s=Xt:e.expectedType&&"value"!==e.expectedType.kind&&(s=e.expectedType);for(let l=0;l<o.length;l+=2){const t=o[l],n=o[l+1],r=l+3,i=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(a.length&&a[a.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=e.parse(n,i,s);if(!c)return null;s=s||c.type,a.push([t,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new dn(s,n,r,i,a):e.error(`Type ${te(s)} is not interpolatable.`)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);const i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);const o=Ye(e,r),a=dn.interpolationFactor(this.interpolation,r,e[o],e[o+1]),s=n[o].evaluate(t),l=n[o+1].evaluate(t);return"interpolate"===this.operator?Ke[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?hn.reverse(hn.interpolate(hn.forward(s),hn.forward(l),a)):un.reverse(un.interpolate(un.forward(s),un.forward(l),a))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e}}function fn(t,e,n,r){const i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}class mn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let n=null;const r=e.expectedType;r&&"value"!==r.kind&&(n=r);const i=[];for(const a of t.slice(1)){const t=e.parse(a,1+i.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,i.push(t)}const o=r&&i.some(t=>ne(r,t.type));return new mn(o?Yt:n,i)}evaluate(t){let e,n=null,r=0;for(const i of this.args)if(r++,n=i.evaluate(t),n&&n instanceof he&&!n.available&&(e||(e=n.name),n=null,r===this.args.length&&(n=e)),null!==n)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class gn{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let i=1;i<t.length-1;i+=2){const r=t[i];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,i);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=e.parse(t[i+1],i+1);if(!o)return null;n.push([r,o])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return r?new gn(n,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,n]of this.bindings)t.push(e,n.serialize());return t.push(this.result.serialize()),t}}class yn{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Ht),r=e.parse(t[2],2,Qt(e.expectedType||Yt));return n&&r?new yn(r.type.itemType,n,r):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new ye(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new ye(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new ye(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vn{constructor(t,e){this.type=qt,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Yt),r=e.parse(t[2],2,Yt);return n&&r?re(n.type,[qt,Wt,Ht,Vt,Yt])?new vn(n,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(n.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!ie(e,["boolean","string","number","null"]))throw new ye(`Expected first argument to be of type boolean, string, number or null, but found ${te(fe(e))} instead.`);if(!ie(n,["string","array"]))throw new ye(`Expected second argument to be of type array or string, but found ${te(fe(n))} instead.`);return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class _n{constructor(t,e,n){this.type=Ht,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Yt),r=e.parse(t[2],2,Yt);if(!n||!r)return null;if(!re(n.type,[qt,Wt,Ht,Vt,Yt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(n.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Ht);return i?new _n(n,r,i):null}return new _n(n,r)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!ie(e,["boolean","string","number","null"]))throw new ye(`Expected first argument to be of type boolean, string, number or null, but found ${te(fe(e))} instead.`);if(!ie(n,["string","array"]))throw new ye(`Expected second argument to be of type array or string, but found ${te(fe(n))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return n.indexOf(e,r)}return n.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class xn{constructor(t,e,n,r,i,o){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const i={},o=[];for(let l=2;l<t.length-1;l+=2){let a=t[l];const s=t[l+1];Array.isArray(a)||(a=[a]);const c=e.concat(l);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,fe(t)))return null}else n=fe(t);if(void 0!==i[String(t)])return c.error("Branch labels must be unique.");i[String(t)]=o.length}const u=e.parse(s,l,r);if(!u)return null;r=r||u.type,o.push(u)}const a=e.parse(t[1],1,Yt);if(!a)return null;const s=e.parse(t[t.length-1],t.length-1,r);return s?"value"!==a.type.kind&&e.concat(1).checkSubtype(n,a.type)?null:new xn(n,r,a,i,o,s):null}evaluate(t){const e=this.input.evaluate(t);return(fe(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),n=[],r={};for(const o of e){const t=r[this.cases[o]];void 0===t?(r[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[t][1].push(o)}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[o,a]of n)t.push(1===a.length?i(a[0]):a.map(i)),t.push(this.outputs[o].serialize());return t.push(this.otherwise.serialize()),t}}class bn{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r=[];for(let o=1;o<t.length-1;o+=2){const i=e.parse(t[o],o,qt);if(!i)return null;const a=e.parse(t[o+1],o+1,n);if(!a)return null;r.push([i,a]),n=n||a.type}const i=e.parse(t[t.length-1],t.length-1,n);return i?new bn(n,r,i):null}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class wn{constructor(t,e,n,r){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Yt),r=e.parse(t[2],2,Ht);if(!n||!r)return null;if(!re(n.type,[Qt(Yt),Wt,Yt]))return e.error(`Expected first argument to be of type array or string, but found ${te(n.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Ht);return i?new wn(n.type,n,r,i):null}return new wn(n.type,n,r)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!ie(e,["string","array"]))throw new ye(`Expected first argument to be of type array or string, but found ${te(fe(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(n,r)}return e.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Mn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function En(t,e,n,r){return 0===r.compare(e,n)}function Sn(t,e,n){const r="=="!==t&&"!="!==t;return class i{constructor(t,e,n){this.type=qt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let o=e.parse(t[1],1,Yt);if(!o)return null;if(!Mn(n,o.type))return e.concat(1).error(`"${n}" comparisons are not supported for type '${te(o.type)}'.`);let a=e.parse(t[2],2,Yt);if(!a)return null;if(!Mn(n,a.type))return e.concat(2).error(`"${n}" comparisons are not supported for type '${te(a.type)}'.`);if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error(`Cannot compare types '${te(o.type)}' and '${te(a.type)}'.`);r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new _e(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new _e(o.type,[a])));let s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(s=e.parse(t[3],3,$t),!s)return null}return new i(o,a,s)}evaluate(i){const o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const e=fe(o),n=fe(a);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new ye(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${n.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=fe(o),n=fe(a);if("string"!==t.kind||"string"!==n.kind)return e(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):e(i,o,a)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild(t=>{e.push(t.serialize())}),e}}}const Tn=Sn("==",(function(t,e,n){return e===n}),En),An=Sn("!=",(function(t,e,n){return e!==n}),(function(t,e,n,r){return!En(0,e,n,r)})),Cn=Sn("<",(function(t,e,n){return e<n}),(function(t,e,n,r){return r.compare(e,n)<0})),Ln=Sn(">",(function(t,e,n){return e>n}),(function(t,e,n,r){return r.compare(e,n)>0})),In=Sn("<=",(function(t,e,n){return e<=n}),(function(t,e,n,r){return r.compare(e,n)<=0}));class Pn{constructor(t,e,n,r,i){this.type=Wt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Ht);if(!n)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=e.parse(r.locale,1,Wt),!i))return null;let o=null;if(r.currency&&(o=e.parse(r.currency,1,Wt),!o))return null;let a=null;if(r["min-fraction-digits"]&&(a=e.parse(r["min-fraction-digits"],1,Ht),!a))return null;let s=null;return r["max-fraction-digits"]&&(s=e.parse(r["max-fraction-digits"],1,Ht),!s)?null:new Pn(n,i,o,a,s)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Rn{constructor(t){this.type=Ht,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error(`Expected argument of type string or array, but found ${te(n.type)} instead.`):new Rn(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ye(`Expected value to be of type string or array, but found ${te(fe(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}}const On={"==":Tn,"!=":An,">":Ln,"<":Cn,">=":Sn(">=",(function(t,e,n){return e>=n}),(function(t,e,n,r){return r.compare(e,n)>=0})),"<=":In,array:_e,at:yn,boolean:_e,case:bn,coalesce:mn,collator:Ae,format:xe,image:be,in:vn,"index-of":_n,interpolate:dn,"interpolate-hcl":dn,"interpolate-lab":dn,length:Rn,let:gn,literal:ge,match:xn,number:_e,"number-format":Pn,object:_e,slice:wn,step:$e,string:_e,"to-boolean":Me,"to-color":Me,"to-number":Me,"to-string":Me,var:Xe,within:Ve};function Dn(t,[e,n,r,i]){e=e.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);const o=i?i.evaluate(t):1,a=pe(e,n,r,o);if(a)throw new ye(a);return new se(e/255*o,n/255*o,r/255*o,o)}function Nn(t,e){return t in e}function kn(t,e){const n=e[t];return void 0===n?null:n}function Fn(t){return{type:t}}function zn(t){return{result:"success",value:t}}function Bn(t){return{result:"error",value:t}}function Un(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function jn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Gn(t){return!!t.expression&&t.expression.interpolated}function Vn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Hn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Wn(t){return t}function qn(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Xn(t,e,n,r,i){return qn(typeof n===i?r[n]:void 0,t.default,e.default)}function Zn(t,e,n){if("number"!==Vn(n))return qn(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const i=Ye(t.stops.map(t=>t[0]),n);return t.stops[i][1]}function Yn(t,e,n){const r=void 0!==t.base?t.base:1;if("number"!==Vn(n))return qn(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const o=Ye(t.stops.map(t=>t[0]),n),a=function(t,e,n,r){const i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],l=t.stops[o+1][1];let c=Ke[e.type]||Wn;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=pn[t.colorSpace];c=(t,n)=>e.reverse(e.interpolate(e.forward(t),e.forward(n),a))}return"function"==typeof s.evaluate?{evaluate(...t){const e=s.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==n)return c(e,n,a)}}:c(s,l,a)}function $n(t,e,n){return"color"===e.type?n=se.parse(n):"formatted"===e.type?n=ue.fromString(n.toString()):"resolvedImage"===e.type?n=he.fromString(n.toString()):Vn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),qn(n,t.default,e.default)}Te.register(On,{error:[{kind:"error"},[Wt],(t,[e])=>{throw new ye(e.evaluate(t))}],typeof:[Wt,[Yt],(t,[e])=>te(fe(e.evaluate(t)))],"to-rgba":[Qt(Ht,4),[Xt],(t,[e])=>e.evaluate(t).toArray()],rgb:[Xt,[Ht,Ht,Ht],Dn],rgba:[Xt,[Ht,Ht,Ht,Ht],Dn],has:{type:qt,overloads:[[[Wt],(t,[e])=>Nn(e.evaluate(t),t.properties())],[[Wt,Zt],(t,[e,n])=>Nn(e.evaluate(t),n.evaluate(t))]]},get:{type:Yt,overloads:[[[Wt],(t,[e])=>kn(e.evaluate(t),t.properties())],[[Wt,Zt],(t,[e,n])=>kn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Yt,[Wt],(t,[e])=>kn(e.evaluate(t),t.featureState||{})],properties:[Zt,[],t=>t.properties()],"geometry-type":[Wt,[],t=>t.geometryType()],id:[Yt,[],t=>t.id()],zoom:[Ht,[],t=>t.globals.zoom],"heatmap-density":[Ht,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ht,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Ht,[],t=>t.globals.skyRadialProgress||0],accumulated:[Yt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Ht,Fn(Ht),(t,e)=>{let n=0;for(const r of e)n+=r.evaluate(t);return n}],"*":[Ht,Fn(Ht),(t,e)=>{let n=1;for(const r of e)n*=r.evaluate(t);return n}],"-":{type:Ht,overloads:[[[Ht,Ht],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Ht],(t,[e])=>-e.evaluate(t)]]},"/":[Ht,[Ht,Ht],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Ht,[Ht,Ht],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Ht,[Ht],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ht,[Ht],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ht,[Ht],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ht,[Ht],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ht,[Ht],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ht,[Ht],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ht,[Ht],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ht,Fn(Ht),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[Ht,Fn(Ht),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[Ht,[Ht],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ht,[Ht],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ht,[Ht],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ht,[Ht],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[qt,[Wt,Yt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[qt,[Yt],(t,[e])=>t.id()===e.value],"filter-type-==":[qt,[Wt],(t,[e])=>t.geometryType()===e.value],"filter-<":[qt,[Wt,Yt],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r<i}],"filter-id-<":[qt,[Yt],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[qt,[Wt,Yt],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r>i}],"filter-id->":[qt,[Yt],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[qt,[Wt,Yt],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[qt,[Yt],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[qt,[Wt,Yt],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[qt,[Yt],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[qt,[Yt],(t,[e])=>e.value in t.properties()],"filter-has-id":[qt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[qt,[Qt(Wt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[qt,[Qt(Yt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[qt,[Wt,Qt(Yt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[qt,[Wt,Qt(Yt)],(t,[e,n])=>function(t,e,n,r){for(;n<=r;){const i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:qt,overloads:[[[qt,qt],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Fn(qt),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:qt,overloads:[[[qt,qt],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Fn(qt),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[qt,[qt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[qt,[Wt],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Wt,[Wt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Wt,[Wt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Wt,Fn(Yt),(t,e)=>e.map(e=>me(e.evaluate(t))).join("")],"resolved-locale":[Wt,[$t],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Jn{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Se,this._defaultValue=e?function(t){return"color"===t.type&&Hn(t.default)?new se(0,0,0,0):"color"===t.type?se.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,r,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,r,i,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new ye(`Expected value to be one of ${Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Kn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in On}function Qn(t,e){const n=new Ze(On,[],e?function(t){const e={color:Xt,string:Wt,number:Ht,enum:Wt,boolean:qt,formatted:Jt,resolvedImage:Kt};return"array"===t.type?Qt(e[t.value]||Yt,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?zn(new Jn(r,e)):Bn(n.errors)}class tr{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!We(e.expression)}evaluateWithoutErrorHandling(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)}evaluate(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)}}class er{constructor(t,e,n,r){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!We(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)}evaluate(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)}interpolationFactor(t,e,n){return this.interpolationType?dn.interpolationFactor(this.interpolationType,t,e,n):0}}function nr(t,e){if("error"===(t=Qn(t,e)).result)return t;const n=t.value.expression,r=He(n);if(!r&&!Un(e))return Bn([new jt("","data expressions not supported")]);const i=qe(n,["zoom"]);if(!i&&!jn(e))return Bn([new jt("","zoom expressions not supported")]);const o=function t(e){let n=null;if(e instanceof gn)n=t(e.result);else if(e instanceof mn){for(const r of e.args)if(n=t(r),n)break}else(e instanceof $e||e instanceof dn)&&e.input instanceof Te&&"zoom"===e.input.name&&(n=e);return n instanceof jt||e.eachChild(e=>{const r=t(e);r instanceof jt?n=r:!n&&r?n=new jt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new jt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}(n);return o||i?o instanceof jt?Bn([o]):o instanceof dn&&!Gn(e)?Bn([new jt("",'"interpolate" expressions cannot be used with this property')]):zn(o?new er(r?"camera":"composite",t.value,o.labels,o instanceof dn?o.interpolation:void 0):new tr(r?"constant":"source",t.value)):Bn([new jt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rr{constructor(t,e){this._parameters=t,this._specification=e,zt(this,function t(e,n){const r="color"===n.type,i=e.stops&&"object"==typeof e.stops[0][0],o=i||!(i||void 0!==e.property),a=e.type||(Gn(n)?"exponential":"interval");if(r&&((e=zt({},e)).stops&&(e.stops=e.stops.map(t=>[t[0],se.parse(t[1])])),e.default=se.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!pn[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);let s,l,c;if("exponential"===a)s=Yn;else if("interval"===a)s=Zn;else if("categorical"===a){s=Xn,l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];c=typeof e.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);s=$n}if(i){const r={},i=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],o=n[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),r[o].stops.push([n[0].value,n[1]])}const o=[];for(const e of i)o.push([r[e].zoom,t(r[e],n)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:dn.interpolationFactor.bind(void 0,a),zoomStops:o.map(t=>t[0]),evaluate:({zoom:t},r)=>Yn({stops:o,base:e.base},n,t).evaluate(t,r)}}if(o){const t="exponential"===a?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:dn.interpolationFactor.bind(void 0,t),zoomStops:e.stops.map(t=>t[0]),evaluate:({zoom:t})=>s(e,n,t,l,c)}}return{kind:"source",evaluate(t,r){const i=r&&r.properties?r.properties[e.property]:void 0;return void 0===i?qn(e.default,n.default):s(e,n,i,l,c)}}}(this._parameters,this._specification))}static deserialize(t){return new rr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ir(t){const e=t.key,n=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec;let s=[];const l=Vn(n);if("object"!==l)return[new kt(e,n,`object expected, ${l} found`)];for(const c in n){const t=c.split(".")[0],l=r[t]||r["*"];let u;if(i[t])u=i[t];else if(r[t])u=Ir;else if(i["*"])u=i["*"];else{if(!r["*"]){s.push(new kt(e,n[c],`unknown property "${c}"`));continue}u=Ir}s=s.concat(u({key:(e?e+".":e)+c,value:n[c],valueSpec:l,style:o,styleSpec:a,object:n,objectKey:c},n))}for(const c in r)i[c]||r[c].required&&void 0===r[c].default&&void 0===n[c]&&s.push(new kt(e,n,`missing required property "${c}"`));return s}function or(t){const e=t.value,n=t.valueSpec,r=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Ir;if("array"!==Vn(e))return[new kt(o,e,`array expected, ${Vn(e)} found`)];if(n.length&&e.length!==n.length)return[new kt(o,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new kt(o,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===Vn(n.value)&&(s=n.value);let l=[];for(let c=0;c<e.length;c++)l=l.concat(a({array:e,arrayIndex:c,value:e[c],valueSpec:s,style:r,styleSpec:i,key:`${o}[${c}]`}));return l}function ar(t){const e=t.key,n=t.value,r=t.valueSpec;let i=Vn(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new kt(e,n,`number expected, ${i} found`)]:"minimum"in r&&n<r.minimum?[new kt(e,n,`${n} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&n>r.maximum?[new kt(e,n,`${n} is greater than the maximum value ${r.maximum}`)]:[]}function sr(t){const e=t.valueSpec,n=Bt(t.value.type);let r,i,o,a={};const s="categorical"!==n&&void 0===t.value.property,l=!s,c="array"===Vn(t.value.stops)&&"array"===Vn(t.value.stops[0])&&"object"===Vn(t.value.stops[0][0]),u=ir({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new kt(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const r=t.value;return e=e.concat(or({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Vn(r)&&0===r.length&&e.push(new kt(t.key,r,"array must have at least one stop")),e},default:function(t){return Ir({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&s&&u.push(new kt(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||u.push(new kt(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Gn(t.valueSpec)&&u.push(new kt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Un(t.valueSpec)?u.push(new kt(t.key,t.value,"property functions not supported")):s&&!jn(t.valueSpec)&&u.push(new kt(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==t.value.property||u.push(new kt(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const r=t.value,s=t.key;if("array"!==Vn(r))return[new kt(s,r,`array expected, ${Vn(r)} found`)];if(2!==r.length)return[new kt(s,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Vn(r[0]))return[new kt(s,r,`object expected, ${Vn(r[0])} found`)];if(void 0===r[0].zoom)return[new kt(s,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new kt(s,r,"object stop key must have value")];if(o&&o>Bt(r[0].zoom))return[new kt(s,r[0].zoom,"stop zoom values must appear in ascending order")];Bt(r[0].zoom)!==o&&(o=Bt(r[0].zoom),i=void 0,a={}),n=n.concat(ir({key:s+"[0]",value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:ar,value:p}}))}else n=n.concat(p({key:s+"[0]",value:r[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},r));return Kn(Ut(r[1]))?n.concat([new kt(s+"[1]",r[1],"expressions are not allowed in function stops.")]):n.concat(Ir({key:s+"[1]",value:r[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const s=Vn(t.value),l=Bt(t.value),c=null!==t.value?t.value:o;if(r){if(s!==r)return[new kt(t.key,c,`${s} stop domain type must match previous stop domain type ${r}`)]}else r=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new kt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){let r=`number expected, ${s} found`;return Un(e)&&void 0===n&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new kt(t.key,c,r)]}return"categorical"!==n||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===s&&void 0!==i&&l<i?[new kt(t.key,c,"stop domain values must appear in ascending order")]:(i=l,"categorical"===n&&l in a?[new kt(t.key,c,"stop domain values must be unique")]:(a[l]=!0,[])):[new kt(t.key,c,"integer expected, found "+l)]}}function lr(t){const e=("property"===t.expressionContext?nr:Qn)(Ut(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new kt(`${t.key}${e.key}`,t.value,e.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new kt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!We(n))return[new kt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!We(n))return[new kt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!qe(n,["zoom","feature-state"]))return[new kt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!He(n))return[new kt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cr(t){const e=t.key,n=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Bt(n))&&i.push(new kt(e,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(r.values).indexOf(Bt(n))&&i.push(new kt(e,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),i}function ur(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ur(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const hr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function pr(t){if(null==t)return{filter:()=>!0,needGeometry:!1};ur(t)||(t=fr(t));const e=Qn(t,hr);if("error"===e.result)throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));return{filter:(t,n,r)=>e.value.evaluate(t,n,{},r),needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(t)}}function dr(t,e){return t<e?-1:t>e?1:0}function fr(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?mr(t[1],t[2],"=="):"!="===e?vr(mr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?mr(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(fr))):"all"===e?["all"].concat(t.slice(1).map(fr)):"none"===e?["all"].concat(t.slice(1).map(fr).map(vr)):"in"===e?gr(t[1],t.slice(2)):"!in"===e?vr(gr(t[1],t.slice(2))):"has"===e?yr(t[1]):"!has"===e?vr(yr(t[1])):"within"!==e||t;var n}function mr(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function gr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(dr)]]:["filter-in-small",t,["literal",e]]}}function yr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function vr(t){return["!",t]}function _r(t){return ur(Ut(t.value))?lr(zt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){const n=e.value,r=e.key;if("array"!==Vn(n))return[new kt(r,n,`array expected, ${Vn(n)} found`)];const i=e.styleSpec;let o,a=[];if(n.length<1)return[new kt(r,n,"filter array must have at least 1 element")];switch(a=a.concat(cr({key:r+"[0]",value:n[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),Bt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Bt(n[1])&&a.push(new kt(r,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&a.push(new kt(r,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(o=Vn(n[1]),"string"!==o&&a.push(new kt(r+"[1]",n[1],`string expected, ${o} found`)));for(let t=2;t<n.length;t++)o=Vn(n[t]),"$type"===Bt(n[1])?a=a.concat(cr({key:`${r}[${t}]`,value:n[t],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&a.push(new kt(`${r}[${t}]`,n[t],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let i=1;i<n.length;i++)a=a.concat(t({key:`${r}[${i}]`,value:n[i],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=Vn(n[1]),2!==n.length?a.push(new kt(r,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==o&&a.push(new kt(r+"[1]",n[1],`string expected, ${o} found`));break;case"within":o=Vn(n[1]),2!==n.length?a.push(new kt(r,n,`filter array for "${n[0]}" operator must have 2 elements`)):"object"!==o&&a.push(new kt(r+"[1]",n[1],`object expected, ${o} found`))}return a}(t)}function xr(t,e){const n=t.key,r=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[`${e}_${t.layerType}`];if(!s)return[];const l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&s[l[1]]&&s[l[1]].transition)return Ir({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});const c=t.valueSpec||s[a];if(!c)return[new kt(n,o,`unknown property "${a}"`)];let u;if("string"===Vn(o)&&Un(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new kt(n,o,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&h.push(new kt(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Hn(Ut(o))&&"identity"===Bt(o.type)&&h.push(new kt(n,o,'"text-font" does not support identity functions'))),h.concat(Ir({key:t.key,value:o,valueSpec:c,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function br(t){return xr(t,"paint")}function wr(t){return xr(t,"layout")}function Mr(t){let e=[];const n=t.value,r=t.key,i=t.style,o=t.styleSpec;n.type||n.ref||e.push(new kt(r,n,'either "type" or "ref" is required'));let a=Bt(n.type);const s=Bt(n.ref);if(n.id){const o=Bt(n.id);for(let a=0;a<t.arrayIndex;a++){const t=i.layers[a];Bt(t.id)===o&&e.push(new kt(r,n.id,`duplicate layer id "${n.id}", previously used at line ${t.id.__line__}`))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&e.push(new kt(r,n[t],`"${t}" is prohibited for ref layers`))}),i.layers.forEach(e=>{Bt(e.id)===s&&(t=e)}),t?t.ref?e.push(new kt(r,n.ref,"ref cannot reference another ref layer")):a=Bt(t.type):e.push(new kt(r,n.ref,`ref layer "${s}" not found`))}else if("background"!==a&&"sky"!==a)if(n.source){const t=i.sources&&i.sources[n.source],o=t&&Bt(t.type);t?"vector"===o&&"raster"===a?e.push(new kt(r,n.source,`layer "${n.id}" requires a raster source`)):"raster"===o&&"raster"!==a?e.push(new kt(r,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==a?e.push(new kt(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==a||!n.paint||!n.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new kt(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new kt(r,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new kt(r,n.source,`source "${n.source}" not found`))}else e.push(new kt(r,n,'missing required property "source"'));return e=e.concat(ir({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ir({key:r+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:_r,layout:t=>ir({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>wr(zt({layerType:a},t))}}),paint:t=>ir({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>br(zt({layerType:a},t))}})}})),e}function Er(t){const e=t.value,n=t.key,r=Vn(e);return"string"!==r?[new kt(n,e,`string expected, ${r} found`)]:[]}const Sr={promoteId:function({key:t,value:e}){if("string"===Vn(e))return Er({key:t,value:e});{const n=[];for(const r in e)n.push(...Er({key:`${t}.${r}`,value:e[r]}));return n}}};function Tr(t){const e=t.value,n=t.key,r=t.styleSpec,i=t.style;if(!e.type)return[new kt(n,e,'"type" is required')];const o=Bt(e.type);let a;switch(o){case"vector":case"raster":case"raster-dem":return a=ir({key:n,value:e,valueSpec:r["source_"+o.replace("-","_")],style:t.style,styleSpec:r,objectElementValidators:Sr}),a;case"geojson":if(a=ir({key:n,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:Sr}),e.cluster)for(const t in e.clusterProperties){const[r,i]=e.clusterProperties[t],o="string"==typeof r?[r,["accumulated"],["get",t]]:r;a.push(...lr({key:`${n}.${t}.map`,value:i,expressionContext:"cluster-map"})),a.push(...lr({key:`${n}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return ir({key:n,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return ir({key:n,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new kt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cr({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function Ar(t){const e=t.value,n=t.styleSpec,r=n.light,i=t.style;let o=[];const a=Vn(e);if(void 0===e)return o;if("object"!==a)return o=o.concat([new kt("light",e,`object expected, ${a} found`)]),o;for(const s in e){const t=s.match(/^(.*)-transition$/);o=o.concat(t&&r[t[1]]&&r[t[1]].transition?Ir({key:s,value:e[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?Ir({key:s,value:e[s],valueSpec:r[s],style:i,styleSpec:n}):[new kt(s,e[s],`unknown property "${s}"`)])}return o}function Cr(t){const e=t.value,n=t.key,r=t.style,i=t.styleSpec,o=i.terrain;let a=[];const s=Vn(e);if(void 0===e)return a;if("object"!==s)return a=a.concat([new kt("terrain",e,`object expected, ${s} found`)]),a;for(const l in e){const t=l.match(/^(.*)-transition$/);a=a.concat(t&&o[t[1]]&&o[t[1]].transition?Ir({key:l,value:e[l],valueSpec:i.transition,style:r,styleSpec:i}):o[l]?Ir({key:l,value:e[l],valueSpec:o[l],style:r,styleSpec:i}):[new kt(l,e[l],`unknown property "${l}"`)])}if(e.source){const t=r.sources&&r.sources[e.source],i=t&&Bt(t.type);t?"raster-dem"!==i&&a.push(new kt(n,e.source,`terrain cannot be used with a source of type ${i}, it only be used with a "raster-dem" source type`)):a.push(new kt(n,e.source,`source "${e.source}" not found`))}else a.push(new kt(n,e,'terrain is missing required property "source"'));return a}const Lr={"*":()=>[],array:or,boolean:function(t){const e=t.value,n=t.key,r=Vn(e);return"boolean"!==r?[new kt(n,e,`boolean expected, ${r} found`)]:[]},number:ar,color:function(t){const e=t.key,n=t.value,r=Vn(n);return"string"!==r?[new kt(e,n,`color expected, ${r} found`)]:null===ae(n)?[new kt(e,n,`color expected, "${n}" found`)]:[]},constants:Ft,enum:cr,filter:_r,function:sr,layer:Mr,object:ir,source:Tr,light:Ar,terrain:Cr,string:Er,formatted:function(t){return 0===Er(t).length?[]:lr(t)},resolvedImage:function(t){return 0===Er(t).length?[]:lr(t)}};function Ir(t){const e=t.value,n=t.valueSpec,r=t.styleSpec;return n.expression&&Hn(Bt(e))?sr(t):n.expression&&Kn(Ut(e))?lr(t):n.type&&Lr[n.type]?Lr[n.type](t):ir(zt({},t,{valueSpec:n.type?r[n.type]:n}))}function Pr(t){const e=t.value,n=t.key,r=Er(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new kt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new kt(n,e,'"glyphs" url must include a "{range}" token'))),r}function Rr(t,e=Nt){let n=[];return n=n.concat(Ir({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Pr,"*":()=>[]}})),t.constants&&(n=n.concat(Ft({key:"constants",value:t.constants,style:t,styleSpec:e}))),Or(n)}function Or(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function Dr(t){return function(...e){return Or(t.apply(this,e))}}Rr.source=Dr(Tr),Rr.light=Dr(Ar),Rr.terrain=Dr(Cr),Rr.layer=Dr(Mr),Rr.filter=Dr(_r),Rr.paintProperty=Dr(br),Rr.layoutProperty=Dr(wr);const Nr=Rr,kr=Nr.light,Fr=Nr.paintProperty,zr=Nr.layoutProperty;function Br(t,e){let n=!1;if(e&&e.length)for(const r of e)t.fire(new Ot(new Error(r.message))),n=!0;return n}var Ur=jr;function jr(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];r.push(a===s?null:i.subarray(a,s))}var l=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var u=n/e*t;this.min=-u,this.max=t+u}jr.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},jr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},jr.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},jr.prototype.query=function(t,e,n,r,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,r,this._queryCell,s,{},i),s},jr.prototype._queryCell=function(t,e,n,r,i,o,a,s){var l=this.cells[i];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===a[p]){var d=4*p;(s?s(u[d+0],u[d+1],u[d+2],u[d+3]):t<=u[d+2]&&e<=u[d+3]&&n>=u[d+0]&&r>=u[d+1])?(a[p]=!0,o.push(c[p])):a[p]=!1}}},jr.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(n),h=this._convertToCellCoord(r),p=l;p<=u;p++)for(var d=c;d<=h;d++){var f=this.d*d+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&i.call(this,t,e,n,r,f,o,a,s))return}},jr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},jr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},jr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};const{ImageData:Gr,ImageBitmap:Vr}=o,Hr={};function Wr(t,e,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Hr[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Wr("Object",Object),Ur.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Ur.deserialize=function(t){return new Ur(t.buffer)},Wr("Grid",Ur),Wr("Color",se),Wr("Error",Error),Wr("ResolvedImage",he),Wr("StylePropertyFunction",rr),Wr("StyleExpression",Jn,{omit:["_evaluator"]}),Wr("ZoomDependentExpression",er),Wr("ZoomConstantExpression",tr),Wr("CompoundExpression",Te,{omit:["_evaluate"]});for(const Yh in On)On[Yh]._classRegistryKey||Wr("Expression_"+Yh,On[Yh]);function qr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Xr(t){return Vr&&t instanceof Vr}function Zr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(qr(t)||Xr(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof Gr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const r of t)n.push(Zr(r,e));return n}if("object"==typeof t){const n=t.constructor,r=n._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class");const i=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const n in t){if(!t.hasOwnProperty(n))continue;if(Hr[r].omit.indexOf(n)>=0)continue;const o=t[n];i[n]=Hr[r].shallow.indexOf(n)>=0?o:Zr(o,e)}t instanceof Error&&(i.message=t.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(i.$name=r),i}throw new Error("can't serialize object of type "+typeof t)}function Yr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||qr(t)||Xr(t)||ArrayBuffer.isView(t)||t instanceof Gr)return t;if(Array.isArray(t))return t.map(Yr);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=Hr[e];if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);const r=Object.create(n.prototype);for(const i of Object.keys(t)){if("$name"===i)continue;const n=t[i];r[i]=Hr[e].shallow.indexOf(i)>=0?n:Yr(n)}return r}throw new Error("can't deserialize object of type "+typeof t)}class $r{constructor(){this.first=!0}update(t,e){const n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}const Jr={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Kr(t){for(const e of t)if(ei(e.charCodeAt(0)))return!0;return!1}function Qr(t){for(const e of t)if(!ti(e.charCodeAt(0)))return!1;return!0}function ti(t){return!(Jr.Arabic(t)||Jr["Arabic Supplement"](t)||Jr["Arabic Extended-A"](t)||Jr["Arabic Presentation Forms-A"](t)||Jr["Arabic Presentation Forms-B"](t))}function ei(t){return!(746!==t&&747!==t&&(t<4352||!(Jr["Bopomofo Extended"](t)||Jr.Bopomofo(t)||Jr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Jr["CJK Compatibility Ideographs"](t)||Jr["CJK Compatibility"](t)||Jr["CJK Radicals Supplement"](t)||Jr["CJK Strokes"](t)||!(!Jr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Jr["CJK Unified Ideographs Extension A"](t)||Jr["CJK Unified Ideographs"](t)||Jr["Enclosed CJK Letters and Months"](t)||Jr["Hangul Compatibility Jamo"](t)||Jr["Hangul Jamo Extended-A"](t)||Jr["Hangul Jamo Extended-B"](t)||Jr["Hangul Jamo"](t)||Jr["Hangul Syllables"](t)||Jr.Hiragana(t)||Jr["Ideographic Description Characters"](t)||Jr.Kanbun(t)||Jr["Kangxi Radicals"](t)||Jr["Katakana Phonetic Extensions"](t)||Jr.Katakana(t)&&12540!==t||!(!Jr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Jr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Jr["Unified Canadian Aboriginal Syllabics"](t)||Jr["Unified Canadian Aboriginal Syllabics Extended"](t)||Jr["Vertical Forms"](t)||Jr["Yijing Hexagram Symbols"](t)||Jr["Yi Syllables"](t)||Jr["Yi Radicals"](t))))}function ni(t){return!(ei(t)||function(t){return!!(Jr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Jr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Jr["Letterlike Symbols"](t)||Jr["Number Forms"](t)||Jr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Jr["Control Pictures"](t)&&9251!==t||Jr["Optical Character Recognition"](t)||Jr["Enclosed Alphanumerics"](t)||Jr["Geometric Shapes"](t)||Jr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Jr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Jr["CJK Symbols and Punctuation"](t)||Jr.Katakana(t)||Jr["Private Use Area"](t)||Jr["CJK Compatibility Forms"](t)||Jr["Small Form Variants"](t)||Jr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function ri(t){return t>=1424&&t<=2303||Jr["Arabic Presentation Forms-A"](t)||Jr["Arabic Presentation Forms-B"](t)}function ii(t,e){return!(!e&&ri(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Jr.Khmer(t))}function oi(t){for(const e of t)if(ri(e.charCodeAt(0)))return!0;return!1}let ai=null,si="unavailable",li=null;const ci=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(si="error"),ai&&ai(t)};function ui(){hi.fire(new Rt("pluginStateChange",{pluginStatus:si,pluginURL:li}))}const hi=new Dt,pi=function(){return si},di=function(){if("deferred"!==si||!li)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");si="loading",ui(),li&&wt({url:li},t=>{t?ci(t):(si="loaded",ui())})},fi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>"loaded"===si||null!=fi.applyArabicShaping,isLoading:()=>"loading"===si,setState(t){si=t.pluginStatus,li=t.pluginURL},isParsed:()=>null!=fi.applyArabicShaping&&null!=fi.processBidirectionalText&&null!=fi.processStyledBidirectionalText,getPluginURL:()=>li};class mi{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $r,this.transition={})}isSupportedScript(t){return function(t,e){for(const n of t)if(!ii(n.charCodeAt(0),e))return!1;return!0}(t,fi.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}}}class gi{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Hn(t))return new rr(t,e);if(Kn(t)){const n=nr(t,e);if("error"===n.result)throw new Error(n.value.map(t=>`${t.key}: ${t.message}`).join(", "));return n.value}{let n=t;return"string"==typeof t&&"color"===e.type&&(n=se.parse(t)),{kind:"constant",evaluate:()=>n}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)}}class yi{constructor(t){this.property=t,this.value=new gi(t,void 0)}transitioned(t,e){return new _i(this.property,this.value,e,y({},t.transition,this.transition),t.now)}untransitioned(){return new _i(this.property,this.value,null,{},0)}}class vi{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return T(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new yi(this._values[t].property)),this._values[t].value=new gi(this._values[t].property,null===e?void 0:T(e))}getTransition(t){return T(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new yi(this._values[t].property)),this._values[t].transition=T(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n);const r=this.getTransition(e);void 0!==r&&(t[e+"-transition"]=r)}return t}transitioned(t,e){const n=new xi(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].transitioned(t,e._values[r]);return n}untransitioned(){const t=new xi(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class _i{constructor(t,e,n,r,i){this.property=t,this.value=e,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)}possiblyEvaluate(t,e,n){const r=t.now||0,i=this.value.possiblyEvaluate(t,e,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(t,e,n);{const a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,n),i,h(a))}}return i}}class xi{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,n){const r=new Mi(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(t,e,n);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class bi{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return T(this._values[t].value)}setValue(t,e){this._values[t]=new gi(this._values[t].property,null===e?void 0:T(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n)}return t}possiblyEvaluate(t,e,n){const r=new Mi(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(t,e,n);return r}}class wi{constructor(t,e,n){this.property=t,this.value=e,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,n,r){return this.property.evaluate(this.value,this.parameters,t,e,n,r)}}class Mi{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ei{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,n){const r=Ke[this.specification.type];return r?r(t,e,n):t}}class Si{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,n,r){return new wi(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,r)}:t.expression,e)}interpolate(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new wi(this,{kind:"constant",value:void 0},t.parameters);const r=Ke[this.specification.type];return r?new wi(this,{kind:"constant",value:r(t.value.value,e.value.value,n)},t.parameters):t}evaluate(t,e,n,r,i,o){return"constant"===t.kind?t.value:t.evaluate(e,n,r,i,o)}}class Ti extends Si{possiblyEvaluate(t,e,n,r){if(void 0===t.value)return new wi(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const i=t.expression.evaluate(e,null,{},n,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,e);return new wi(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){const n=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new wi(this,{kind:"constant",value:n},e)}return new wi(this,t.expression,e)}evaluate(t,e,n,r,i,o){if("source"===t.kind){const a=t.evaluate(e,n,r,i,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,r),t.evaluate({zoom:Math.floor(e.zoom)},n,r),t.evaluate({zoom:Math.floor(e.zoom)+1},n,r),e):t.value}_calculate(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class Ai{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,r){if(void 0!==t.value){if("constant"===t.expression.kind){const i=t.expression.evaluate(e,null,{},n,r);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new mi(Math.floor(e.zoom-1),e)),t.expression.evaluate(new mi(Math.floor(e.zoom),e)),t.expression.evaluate(new mi(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class Ci{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,r){return!!t.expression.evaluate(e,null,{},n,r)}interpolate(){return!1}}class Li{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const n=t[e];n.specification.overridable&&this.overridableProperties.push(e);const r=this.defaultPropertyValues[e]=new gi(n,void 0),i=this.defaultTransitionablePropertyValues[e]=new yi(n);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}}}function Ii(t,e){return 256*(t=f(Math.floor(t),0,255))+f(Math.floor(e),0,255)}Wr("DataDrivenProperty",Si),Wr("DataConstantProperty",Ei),Wr("CrossFadedDataDrivenProperty",Ti),Wr("CrossFadedProperty",Ai),Wr("ColorRampProperty",Ci);const Pi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ri{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Oi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Di(t,e=1){let n=0,r=0;return{members:t.map(t=>{const i=Pi[t.type].BYTES_PER_ELEMENT,o=n=Ni(n,Math.max(e,i)),a=t.components||1;return r=Math.max(r,i),n+=i*a,{name:t.name,type:t.type,components:a,offset:o}}),size:Ni(n,Math.max(r,e)),alignment:e}}function Ni(t,e){return Math.ceil(t/e)*e}class ki extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=n,t}}ki.prototype.bytesPerElement=4,Wr("StructArrayLayout2i4",ki);class Fi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)}emplace(t,e,n,r,i){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,t}}Fi.prototype.bytesPerElement=8,Wr("StructArrayLayout4i8",Fi);class zi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,n,r,i,o,a)}emplace(t,e,n,r,i,o,a,s){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=n,this.uint8[c+4]=r,this.uint8[c+5]=i,this.uint8[c+6]=o,this.uint8[c+7]=a,this.float32[u+2]=s,t}}zi.prototype.bytesPerElement=12,Wr("StructArrayLayout2i4ub1f12",zi);class Bi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=n,t}}Bi.prototype.bytesPerElement=8,Wr("StructArrayLayout2f8",Bi);class Ui extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,a,s,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,r,i,o,a,s,l,c)}emplace(t,e,n,r,i,o,a,s,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}Ui.prototype.bytesPerElement=20,Wr("StructArrayLayout10ui20",Ui);class ji extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,a,s,l,c,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,n,r,i,o,a,s,l,c,u,h)}emplace(t,e,n,r,i,o,a,s,l,c,u,h,p){const d=12*t;return this.int16[d+0]=e,this.int16[d+1]=n,this.int16[d+2]=r,this.int16[d+3]=i,this.uint16[d+4]=o,this.uint16[d+5]=a,this.uint16[d+6]=s,this.uint16[d+7]=l,this.int16[d+8]=c,this.int16[d+9]=u,this.int16[d+10]=h,this.int16[d+11]=p,t}}ji.prototype.bytesPerElement=24,Wr("StructArrayLayout4i4ui4i24",ji);class Gi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)}emplace(t,e,n,r){const i=3*t;return this.float32[i+0]=e,this.float32[i+1]=n,this.float32[i+2]=r,t}}Gi.prototype.bytesPerElement=12,Wr("StructArrayLayout3f12",Gi);class Vi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Vi.prototype.bytesPerElement=4,Wr("StructArrayLayout1ul4",Vi);class Hi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,a,s,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,r,i,o,a,s,l,c)}emplace(t,e,n,r,i,o,a,s,l,c,u){const h=16*t,p=8*t;return this.int16[h+0]=e,this.int16[h+1]=n,this.float32[p+1]=r,this.float32[p+2]=i,this.float32[p+3]=o,this.float32[p+4]=a,this.int16[h+10]=s,this.uint32[p+6]=l,this.uint16[h+14]=c,this.uint16[h+15]=u,t}}Hi.prototype.bytesPerElement=32,Wr("StructArrayLayout2i4f1i1ul2ui32",Hi);class Wi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)}emplace(t,e,n,r,i,o,a){const s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t}}Wi.prototype.bytesPerElement=12,Wr("StructArrayLayout2i2i2i12",Wi);class qi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,r,i)}emplace(t,e,n,r,i,o){const a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=r,this.int16[s+6]=i,this.int16[s+7]=o,t}}qi.prototype.bytesPerElement=16,Wr("StructArrayLayout2f1f2i16",qi);class Xi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)}emplace(t,e,n,r,i){const o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[a+1]=r,this.float32[a+2]=i,t}}Xi.prototype.bytesPerElement=12,Wr("StructArrayLayout2ub2f12",Xi);class Zi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)}emplace(t,e,n,r){const i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,this.uint16[i+2]=r,t}}Zi.prototype.bytesPerElement=6,Wr("StructArrayLayout3ui6",Zi);class Yi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m,g)}emplace(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m,g,y){const v=24*t,_=12*t,x=48*t;return this.int16[v+0]=e,this.int16[v+1]=n,this.uint16[v+2]=r,this.uint16[v+3]=i,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[v+10]=l,this.uint16[v+11]=c,this.uint16[v+12]=u,this.float32[_+7]=h,this.float32[_+8]=p,this.uint8[x+36]=d,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[_+10]=g,this.int16[v+22]=y,t}}Yi.prototype.bytesPerElement=48,Wr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Yi);class $i extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m,g,y,v,_,x,b,w,M,E,S,T,A){const C=this.length;return this.resize(C+1),this.emplace(C,t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m,g,y,v,_,x,b,w,M,E,S,T,A)}emplace(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m,g,y,v,_,x,b,w,M,E,S,T,A,C){const L=34*t,I=17*t;return this.int16[L+0]=e,this.int16[L+1]=n,this.int16[L+2]=r,this.int16[L+3]=i,this.int16[L+4]=o,this.int16[L+5]=a,this.int16[L+6]=s,this.int16[L+7]=l,this.uint16[L+8]=c,this.uint16[L+9]=u,this.uint16[L+10]=h,this.uint16[L+11]=p,this.uint16[L+12]=d,this.uint16[L+13]=f,this.uint16[L+14]=m,this.uint16[L+15]=g,this.uint16[L+16]=y,this.uint16[L+17]=v,this.uint16[L+18]=_,this.uint16[L+19]=x,this.uint16[L+20]=b,this.uint16[L+21]=w,this.uint16[L+22]=M,this.uint32[I+12]=E,this.float32[I+13]=S,this.float32[I+14]=T,this.float32[I+15]=A,this.float32[I+16]=C,t}}$i.prototype.bytesPerElement=68,Wr("StructArrayLayout8i15ui1ul4f68",$i);class Ji extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Ji.prototype.bytesPerElement=4,Wr("StructArrayLayout1f4",Ji);class Ki extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)}emplace(t,e,n,r){const i=3*t;return this.int16[i+0]=e,this.int16[i+1]=n,this.int16[i+2]=r,t}}Ki.prototype.bytesPerElement=6,Wr("StructArrayLayout3i6",Ki);class Qi extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)}emplace(t,e,n,r){const i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=n,this.uint16[i+3]=r,t}}Qi.prototype.bytesPerElement=8,Wr("StructArrayLayout1ul2ui8",Qi);class to extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,t}}to.prototype.bytesPerElement=4,Wr("StructArrayLayout2ui4",to);class eo extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}eo.prototype.bytesPerElement=2,Wr("StructArrayLayout1ui2",eo);class no extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)}emplace(t,e,n,r,i){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,t}}no.prototype.bytesPerElement=16,Wr("StructArrayLayout4f16",no);class ro extends Ri{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.float32[this._pos4+1]}get y1(){return this._structArray.float32[this._pos4+2]}get x2(){return this._structArray.float32[this._pos4+3]}get y2(){return this._structArray.float32[this._pos4+4]}get padding(){return this._structArray.int16[this._pos2+10]}get featureIndex(){return this._structArray.uint32[this._pos4+6]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+14]}get bucketIndex(){return this._structArray.uint16[this._pos2+15]}get anchorPoint(){return new r(this.anchorPointX,this.anchorPointY)}}ro.prototype.size=32;class io extends Hi{get(t){return new ro(this,t)}}Wr("CollisionBoxArray",io);class oo extends Ri{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}oo.prototype.size=48;class ao extends Yi{get(t){return new oo(this,t)}}Wr("PlacedSymbolArray",ao);class so extends Ri{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}so.prototype.size=68;class lo extends $i{get(t){return new so(this,t)}}Wr("SymbolInstanceArray",lo);class co extends Ji{getoffsetX(t){return this.float32[1*t+0]}}Wr("GlyphOffsetArray",co);class uo extends Ki{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Wr("SymbolLineVertexArray",uo);class ho extends Ri{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ho.prototype.size=8;class po extends Qi{get(t){return new ho(this,t)}}Wr("FeatureIndexArray",po);const fo=Di([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var mo=oe((function(t){t.exports=function(t,e){var n,r,i,o,a,s,l,c;for(r=t.length-(n=3&t.length),i=e,a=3432918353,s=461845907,c=0;c<r;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),go=oe((function(t){t.exports=function(t,e){for(var n,r=t.length,i=e^r,o=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),yo=mo,vo=go;yo.murmur3=mo,yo.murmur2=vo;class _o{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,n,r){this.ids.push(xo(t)),this.positions.push(e,n,r)}getPositions(t){const e=xo(t);let n=0,r=this.ids.length-1;for(;n<r;){const t=n+r>>1;this.ids[t]>=e?r=t:n=t+1}const i=[];for(;this.ids[n]===e;)i.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return i}static serialize(t,e){const n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,n,r,i){for(;r<i;){const o=e[r+i>>1];let a=r-1,s=i+1;for(;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;bo(e,a,s),bo(n,3*a,3*s),bo(n,3*a+1,3*s+1),bo(n,3*a+2,3*s+2)}s-r<i-s?(t(e,n,r,s),r=s+1):(t(e,n,s+1,i),i=s)}}(n,r,0,n.length-1),e&&e.push(n.buffer,r.buffer),{ids:n,positions:r}}static deserialize(t){const e=new _o;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function xo(t){const e=+t;return!isNaN(e)&&e<=s?e:yo(String(t))}function bo(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}Wr("FeaturePositionMap",_o);class wo{constructor(t,e){this.gl=t.gl,this.location=e}}class Mo extends wo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Eo extends wo{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class So extends wo{constructor(t,e){super(t,e),this.current=se.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const To=new Float32Array(16),Ao=new Float32Array(9);function Co(t){return[Ii(255*t.r,255*t.g),Ii(255*t.b,255*t.a)]}class Lo{constructor(t,e,n){this.value=t,this.uniformNames=e.map(t=>"u_"+t),this.type=n}setUniform(t,e,n){t.set(n.constantOr(this.value))}getBinding(t,e,n){return"color"===this.type?new So(t,e):new Mo(t,e)}}class Io{constructor(t,e){this.uniformNames=e.map(t=>"u_"+t),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,n,r){const i="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&t.set(i)}getBinding(t,e,n){return"u_pattern"===n.substr(0,9)?new Eo(t,e):new Mo(t,e)}}class Po{constructor(t,e,n,r){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(t,e,n,r,i){const o=this.paintVertexArray.length,a=this.expression.evaluate(new mi(0),e,{},r,[],i);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)}updatePaintArray(t,e,n,r){const i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(t,e,i)}_setPaintValue(t,e,n){if("color"===this.type){const r=Co(n);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r[0],r[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ro{constructor(t,e,n,r,i,o){this.expression=t,this.uniformNames=e.map(t=>`u_${t}_t`),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(t,e,n,r,i){const o=this.expression.evaluate(new mi(this.zoom),e,{},r,[],i),a=this.expression.evaluate(new mi(this.zoom+1),e,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)}updatePaintArray(t,e,n,r){const i=this.expression.evaluate({zoom:this.zoom},n,r),o=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(t,e,i,o)}_setPaintValue(t,e,n,r){if("color"===this.type){const i=Co(n),o=Co(r);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i[0],i[1],o[0],o[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=f(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(r)}getBinding(t,e,n){return new Mo(t,e)}}class Oo{constructor(t,e,n,r,i,o){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i}populatePaintArray(t,e,n){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],n)}updatePaintArray(t,e,n,r,i){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],i)}_setPaintValues(t,e,n,r){if(!r||!n)return;const{min:i,mid:o,max:a}=n,s=r[i],l=r[o],c=r[a];if(s&&l&&c)for(let u=t;u<e;u++)this.zoomInPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,fo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,fo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Do{constructor(t,e,n=(()=>!0)){this.binders={},this._buffers=[];const r=[];for(const i in t.paint._values){if(!n(i))continue;const o=t.paint.get(i);if(!(o instanceof wi&&Un(o.property.specification)))continue;const a=ko(i,t.type),s=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===s.kind)this.binders[i]=h?new Io(s.value,a):new Lo(s.value,a,l),r.push("/u_"+i);else if("source"===s.kind||h){const n=Fo(i,l,"source");this.binders[i]=h?new Oo(s,l,c,e,n,t.id):new Po(s,a,l,n),r.push("/a_"+i)}else{const t=Fo(i,l,"composite");this.binders[i]=new Ro(s,a,l,c,e,t),r.push("/z_"+i)}}this.cacheKey=r.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Po||e instanceof Ro?e.maxValue:0}populatePaintArrays(t,e,n,r,i){for(const o in this.binders){const a=this.binders[o];(a instanceof Po||a instanceof Ro||a instanceof Oo)&&a.populatePaintArray(t,e,n,r,i)}}setConstantPatternPositions(t,e){for(const n in this.binders){const r=this.binders[n];r instanceof Io&&r.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,n,r,i){let o=!1;for(const a in t){const s=e.getPositions(a);for(const e of s){const s=n.feature(e.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof Po||l instanceof Ro||l instanceof Oo)&&!0===l.expression.isStateDependent){const c=r.paint.get(n);l.expression=c.value,l.updatePaintArray(e.start,e.end,s,t[a],i),o=!0}}}}return o}defines(){const t=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Lo||n instanceof Io)&&t.push(...n.uniformNames.map(t=>"#define HAS_UNIFORM_"+t))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof Po||n instanceof Ro)for(let e=0;e<n.paintVertexAttributes.length;e++)t.push(n.paintVertexAttributes[e].name);else if(n instanceof Oo)for(let e=0;e<fo.members.length;e++)t.push(fo.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof Lo||n instanceof Io||n instanceof Ro)for(const e of n.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const n=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Lo||i instanceof Io||i instanceof Ro)for(const o of i.uniformNames)if(e[o]){const a=i.getBinding(t,e[o],o);n.push({name:o,property:r,binding:a})}}return n}setUniforms(t,e,n,r){for(const{name:i,property:o,binding:a}of e)this.binders[o].setUniform(a,r,n.get(o),i)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const n=this.binders[e];if(t&&n instanceof Oo){const e=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(n instanceof Po||n instanceof Ro)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const e in this.binders){const n=this.binders[e];(n instanceof Po||n instanceof Ro||n instanceof Oo)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Po||e instanceof Ro||e instanceof Oo)&&e.destroy()}}}class No{constructor(t,e,n=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new Do(r,e,n);this.needsUpload=!1,this._featureMap=new _o,this._bufferOffset=0}populatePaintArrays(t,e,n,r,i,o){for(const a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,r,i,o);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,n,r){for(const i of n)this.needsUpload=this.programConfigurations[i.id].updatePaintArrays(t,this._featureMap,e,i,r)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ko(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Fo(t,e,n){const r={color:{source:Bi,composite:no},number:{source:Ji,composite:Bi}},i=function(t){return{"line-pattern":{source:Ui,composite:Ui},"fill-pattern":{source:Ui,composite:Ui},"fill-extrusion-pattern":{source:Ui,composite:Ui}}[t]}(t);return i&&i[n]||r[e][n]}Wr("ConstantBinder",Lo),Wr("CrossFadedConstantBinder",Io),Wr("SourceExpressionBinder",Po),Wr("CrossFadedCompositeBinder",Oo),Wr("CompositeExpressionBinder",Ro),Wr("ProgramConfiguration",Do,{omit:["_buffers"]}),Wr("ProgramConfigurationSet",No);class zo extends Dt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new bi(e.layout)),e.paint)){this._transitionablePaint=new vi(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mi(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,n={}){null!=e&&this._validate(zr,`layers.${this.id}.layout.${t}`,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return M(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,n={}){if(null!=e&&this._validate(Fr,`layers.${this.id}.paint.${t}`,t,e,n))return!1;if(M(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;{const n=this._transitionablePaint._values[t],r="cross-faded-data-driven"===n.property.specification["property-type"],i=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const a=this._transitionablePaint._values[t].value;return a.isDataDriven()||i||r||this._handleOverridablePaintPropertyUpdate(t,o,a)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,e,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),S(t,(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,n,r,i={}){return(!i||!1!==i.validate)&&Br(this,t.call(Nr,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:Nt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof wi&&Un(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const Bo=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Uo}=Bo;class jo{constructor(t=[]){this.segments=t}prepareSegment(t,e,n,r){let i=this.segments[this.segments.length-1];return t>jo.MAX_VERTEX_ARRAY_LENGTH&&C(`Max vertices per segment is ${jo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!i||i.vertexLength+t>jo.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,n,r){return new jo([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])}}jo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wr("SegmentVector",jo);const Go=Math.pow(2,14)-1,Vo=-Go-1;function Ho(t){const e=8192/t.extent,n=t.loadGeometry();for(let r=0;r<n.length;r++){const t=n[r];for(let n=0;n<t.length;n++){const r=t[n],i=Math.round(r.x*e),o=Math.round(r.y*e);r.x=f(i,Vo,Go),r.y=f(o,Vo,Go),(i<r.x||i>r.x+1||o<r.y||o>r.y+1)&&C("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Wo(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ho(t):[]}}function qo(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}class Xo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ki,this.indexArray=new Zi,this.segments=new jo,this.programConfigurations=new No(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){const r=this.layers[0],i=[];let o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(const{feature:a,id:s,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Wo(a,t);if(!this.layers[0]._featureFilter.filter(new mi(this.zoom),e,n))continue;const r=o?o.evaluate(e,{},n):void 0,u={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:t?e.geometry:Ho(a),patterns:{},sortKey:r};i.push(u)}o&&i.sort((t,e)=>t.sortKey-e.sortKey);for(const a of i){const{geometry:r,index:i,sourceLayerIndex:o}=a,s=t[i].feature;this.addFeature(a,r,i,n),e.featureIndex.insert(s,r,i,o,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Uo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,r){for(const i of e)for(const e of i){const n=e.x,r=e.y;if(n<0||n>=8192||r<0||r>=8192)continue;const i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),o=i.vertexLength;qo(this.layoutVertexArray,n,r,-1,-1),qo(this.layoutVertexArray,n,r,1,-1),qo(this.layoutVertexArray,n,r,1,1),qo(this.layoutVertexArray,n,r,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),i.vertexLength+=4,i.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},r)}}function Zo(t,e){for(let n=0;n<t.length;n++)if(ra(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(ra(t,e[n]))return!0;return!!Ko(t,e)}function Yo(t,e,n){return!!ra(t,e)||!!ta(e,t,n)}function $o(t,e){if(1===t.length)return na(e,t[0]);for(let n=0;n<e.length;n++){const r=e[n];for(let e=0;e<r.length;e++)if(ra(t,r[e]))return!0}for(let n=0;n<t.length;n++)if(na(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ko(t,e[n]))return!0;return!1}function Jo(t,e,n){if(t.length>1){if(Ko(t,e))return!0;for(let r=0;r<e.length;r++)if(ta(e[r],t,n))return!0}for(let r=0;r<t.length;r++)if(ta(t[r],e,n))return!0;return!1}function Ko(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const r=t[n],i=t[n+1];for(let t=0;t<e.length-1;t++)if(Qo(r,i,e[t],e[t+1]))return!0}return!1}function Qo(t,e,n,r){return L(t,n,r)!==L(e,n,r)&&L(t,e,n)!==L(t,e,r)}function ta(t,e,n){const r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(let i=1;i<e.length;i++)if(ea(t,e[i-1],e[i])<r)return!0;return!1}function ea(t,e,n){const r=e.distSqr(n);if(0===r)return t.distSqr(e);const i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(i<0?e:i>1?n:n.sub(e)._mult(i)._add(e))}function na(t,e){let n,r,i,o=!1;for(let a=0;a<t.length;a++){n=t[a];for(let t=0,a=n.length-1;t<n.length;a=t++)r=n[t],i=n[a],r.y>e.y!=i.y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o)}return o}function ra(t,e){let n=!1;for(let r=0,i=t.length-1;r<t.length;i=r++){const o=t[r],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function ia(t,e,n,i,o){for(const r of t)if(e<=r.x&&n<=r.y&&i>=r.x&&o>=r.y)return!0;const a=[new r(e,n),new r(e,o),new r(i,o),new r(i,n)];if(t.length>2)for(const r of a)if(ra(t,r))return!0;for(let r=0;r<t.length-1;r++)if(oa(t[r],t[r+1],a))return!0;return!1}function oa(t,e,n){const r=n[0],i=n[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return!1;const o=L(t,e,n[0]);return o!==L(t,e,n[1])||o!==L(t,e,n[2])||o!==L(t,e,n[3])}function aa(t,e,n){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).getMaxValue(t)}function sa(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function la(t,e,n,i,o){if(!e[0]&&!e[1])return t;const a=r.convert(e)._mult(o);"viewport"===n&&a._rotate(-i);const s=[];for(let r=0;r<t.length;r++)s.push(t[r].sub(a));return s}function ca(t,e,n,i){const o=r.convert(t)._mult(i);return"viewport"===e&&o._rotate(-n),o}Wr("CircleBucket",Xo,{omit:["layers"]});const ua=new Li({"circle-sort-key":new Si(Nt.layout_circle["circle-sort-key"])});var ha={paint:new Li({"circle-radius":new Si(Nt.paint_circle["circle-radius"]),"circle-color":new Si(Nt.paint_circle["circle-color"]),"circle-blur":new Si(Nt.paint_circle["circle-blur"]),"circle-opacity":new Si(Nt.paint_circle["circle-opacity"]),"circle-translate":new Ei(Nt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ei(Nt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ei(Nt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ei(Nt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Si(Nt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Si(Nt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Si(Nt.paint_circle["circle-stroke-opacity"])}),layout:ua},pa="undefined"!=typeof Float32Array?Float32Array:Array;function da(){var t=new pa(9);return pa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function fa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ma(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*h+w*m,t[1]=_*i+x*l+b*p+w*g,t[2]=_*o+x*c+b*d+w*y,t[3]=_*a+x*u+b*f+w*v,t[4]=(_=n[4])*r+(x=n[5])*s+(b=n[6])*h+(w=n[7])*m,t[5]=_*i+x*l+b*p+w*g,t[6]=_*o+x*c+b*d+w*y,t[7]=_*a+x*u+b*f+w*v,t[8]=(_=n[8])*r+(x=n[9])*s+(b=n[10])*h+(w=n[11])*m,t[9]=_*i+x*l+b*p+w*g,t[10]=_*o+x*c+b*d+w*y,t[11]=_*a+x*u+b*f+w*v,t[12]=(_=n[12])*r+(x=n[13])*s+(b=n[14])*h+(w=n[15])*m,t[13]=_*i+x*l+b*p+w*g,t[14]=_*o+x*c+b*d+w*y,t[15]=_*a+x*u+b*f+w*v,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ga=ma;function ya(){var t=new pa(3);return pa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function va(t){var e=new pa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _a(t){return Math.hypot(t[0],t[1],t[2])}function xa(t,e,n){var r=new pa(3);return r[0]=t,r[1]=e,r[2]=n,r}function ba(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function wa(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ma(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Ea(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function Sa(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Ta(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Aa(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],l=n[2];return t[0]=i*l-o*s,t[1]=o*a-r*l,t[2]=r*s-i*a,t}function Ca(t,e,n){var r=n[0],i=n[1],o=n[2],a=e[0],s=e[1],l=e[2],c=i*l-o*s,u=o*a-r*l,h=r*s-i*a,p=i*h-o*u,d=o*c-r*h,f=r*u-i*c,m=2*n[3];return u*=m,h*=m,d*=2,f*=2,t[0]=a+(c*=m)+(p*=2),t[1]=s+u+d,t[2]=l+h+f,t}var La,Ia=wa,Pa=_a;function Ra(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function Oa(){var t=new pa(4);return pa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Da(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Na(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+a*s,t[1]=i*l+o*s,t[2]=o*l-i*s,t[3]=a*l-r*s,t}ya(),La=new pa(4),pa!=Float32Array&&(La[0]=0,La[1]=0,La[2]=0,La[3]=0),ya(),xa(1,0,0),xa(0,1,0),Oa(),Oa(),da();class ka{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(t,e,n){const r=Math.pow(2,n),i=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(n=>{const i=Ra([],n,t),o=1/i[3]/e*r;return function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}(i,i,[o,o,1/i[3],o])}),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(t=>{const e=Sa([],Aa([],Ia([],i[t[0]],i[t[1]]),Ia([],i[t[2]],i[t[1]]))),n=-Ta(e,i[t[1]]);return e.concat(n)});return new ka(i,o)}}class Fa{constructor(t,e){this.min=t,this.max=e,this.center=Ma([],ba([],this.min,this.max),.5)}quadrant(t){const e=[t%2==0,t<2],n=va(this.min),r=va(this.max);for(let i=0;i<e.length;i++)n[i]=e[i]?this.min[i]:this.center[i],r[i]=e[i]?this.center[i]:this.max[i];return r[2]=this.max[2],new Fa(n,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(t){const e=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let n=!0;for(let o=0;o<t.planes.length;o++){const a=t.planes[o];let s=0;for(let t=0;t<e.length;t++)s+=(r=a)[0]*(i=e[t])[0]+r[1]*i[1]+r[2]*i[2]+r[3]*i[3]>=0;if(0===s)return 0;s!==e.length&&(n=!1)}var r,i;if(n)return 2;for(let o=0;o<3;o++){let e=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<t.points.length;r++){const i=t.points[r][o]-this.min[o];e=Math.min(e,i),n=Math.max(n,i)}if(n<0||e>this.max[o]-this.min[o])return 0}return 1}}function za(t,e,n){const i=Ra([],[t.x,t.y,e,1],n);return new r(i[0]/i[3],i[1]/i[3])}const Ba=xa(0,0,0),Ua=xa(0,0,1);function ja(t,e){const n=ya();return Ba[2]=e,t.intersectsPlane(Ba,Ua,n),new r(n[0],n[1])}class Ga extends Xo{}function Va(t,{width:e,height:n},r,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==e*n*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(e*n*r);return t.width=e,t.height=n,t.data=i,t}function Ha(t,{width:e,height:n},r){if(e===t.width&&n===t.height)return;const i=Va({},{width:e,height:n},r);Wa(t,i,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,n)},r),t.width=e,t.height=n,t.data=i.data}function Wa(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const a=t.data,s=e.data;for(let l=0;l<i.height;l++){const c=((n.y+l)*t.width+n.x)*o,u=((r.y+l)*e.width+r.x)*o;for(let t=0;t<i.width*o;t++)s[u+t]=a[c+t]}return e}Wr("HeatmapBucket",Ga,{omit:["layers"]});class qa{constructor(t,e){Va(this,t,1,e)}resize(t){Ha(this,t,1)}clone(){return new qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,r,i){Wa(t,e,n,r,i,1)}}class Xa{constructor(t,e){Va(this,t,4,e)}resize(t){Ha(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Xa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,r,i){Wa(t,e,n,r,i,4)}}Wr("AlphaImage",qa),Wr("RGBAImage",Xa);var Za={paint:new Li({"heatmap-radius":new Si(Nt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Si(Nt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ei(Nt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ci(Nt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ei(Nt.paint_heatmap["heatmap-opacity"])})};function Ya(t){const e={},n=t.resolution||256,r=t.clips?t.clips.length:1,i=t.image||new Xa({width:n,height:r}),o=(n,r,o)=>{e[t.evaluationKey]=o;const a=t.expression.evaluate(e);i.data[n+r+0]=Math.floor(255*a.r/a.a),i.data[n+r+1]=Math.floor(255*a.g/a.a),i.data[n+r+2]=Math.floor(255*a.b/a.a),i.data[n+r+3]=Math.floor(255*a.a)};if(t.clips)for(let a=0,s=0;a<r;++a,s+=4*n)for(let e=0,r=0;e<n;e++,r+=4){const i=e/(n-1),{start:l,end:c}=t.clips[a];o(s,r,l*(1-i)+c*i)}else for(let a=0,s=0;a<n;a++,s+=4)o(0,s,a/(n-1));return i}var $a={paint:new Li({"hillshade-illumination-direction":new Ei(Nt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ei(Nt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ei(Nt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ei(Nt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ei(Nt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ei(Nt.paint_hillshade["hillshade-accent-color"])})};const Ja=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ka}=Ja;var Qa=es,ts=es;function es(t,e,n){n=n||2;var r,i,o,a,s,l,c,u=e&&e.length,h=u?e[0]*n:t.length,p=ns(t,0,h,n,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=ns(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(ds(a));for(s.sort(cs),i=0;i<s.length;i++)us(s[i],n),n=rs(n,n.next);return n}(t,e,p,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var f=n;f<h;f+=n)(s=t[f])<r&&(r=s),(l=t[f+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-r,a-i))?1/c:0}return is(p,d,n,r,i,c),d}function ns(t,e,n,r,i){var o,a;if(i===Ts(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Ms(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Ms(o,t[o],t[o+1],a);return a&&ys(a,a.next)&&(Es(a),a=a.next),a}function rs(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!ys(r,r.next)&&0!==gs(r.prev,r,r.next))r=r.next;else{if(Es(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function is(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=ps(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,l,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,o);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?as(t,r,i,o):os(t))e.push(s.i/n),e.push(t.i/n),e.push(l.i/n),Es(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?is(t=ss(rs(t),e,n),e,n,r,i,o,2):2===a&&ls(t,e,n,r,i,o):is(rs(t),e,n,r,i,o,1);break}}}function os(t){var e=t.prev,n=t,r=t.next;if(gs(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(fs(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&gs(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function as(t,e,n,r){var i=t.prev,o=t,a=t.next;if(gs(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=ps(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),u=ps(s,l,e,n,r),h=t.prevZ,p=t.nextZ;h&&h.z>=c&&p&&p.z<=u;){if(h!==t.prev&&h!==t.next&&fs(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&gs(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&fs(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&gs(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&fs(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&gs(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=u;){if(p!==t.prev&&p!==t.next&&fs(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&gs(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function ss(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!ys(i,o)&&vs(i,r,r.next,o)&&bs(i,o)&&bs(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Es(r),Es(r.next),r=t=o),r=r.next}while(r!==t);return rs(r)}function ls(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&ms(a,s)){var l=ws(a,s);return a=rs(a,a.next),l=rs(l,l.next),is(a,e,n,r,i,o),void is(l,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function cs(t,e){return t.x-e.x}function us(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var l,c=n,u=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&fs(o<h?i:a,o,u,h,o<h?a:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),bs(r,t)&&(l<p||l===p&&(r.x>n.x||r.x===n.x&&hs(n,r)))&&(n=r,p=l)),r=r.next}while(r!==c);return n}(t,e)){var n=ws(e,t);rs(e,e.next),rs(n,n.next)}}function hs(t,e){return gs(t.prev,t,e.prev)<0&&gs(e.next,t,t.next)<0}function ps(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ds(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function fs(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function ms(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&vs(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(bs(t,e)&&bs(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(gs(t.prev,t,e.prev)||gs(t,e.prev,e))||ys(t,e)&&gs(t.prev,t,t.next)>0&&gs(e.prev,e,e.next)>0)}function gs(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ys(t,e){return t.x===e.x&&t.y===e.y}function vs(t,e,n,r){var i=xs(gs(t,e,n)),o=xs(gs(t,e,r)),a=xs(gs(n,r,t)),s=xs(gs(n,r,e));return i!==o&&a!==s||!(0!==i||!_s(t,n,e))||!(0!==o||!_s(t,r,e))||!(0!==a||!_s(n,t,r))||!(0!==s||!_s(n,e,r))}function _s(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function xs(t){return t>0?1:t<0?-1:0}function bs(t,e){return gs(t.prev,t,t.next)<0?gs(t,e,t.next)>=0&&gs(t,t.prev,e)>=0:gs(t,e,t.prev)<0||gs(t,t.next,e)<0}function ws(t,e){var n=new Ss(t.i,t.x,t.y),r=new Ss(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ms(t,e,n,r){var i=new Ss(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Es(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ss(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ts(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function As(t,e,n,r,i){!function t(e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-s*c/a+u)),Math.min(i,Math.floor(n+(a-s)*c/a+u)),o)}var h=e[n],p=r,d=i;for(Cs(e,r,n),o(e[i],h)>0&&Cs(e,r,i);p<d;){for(Cs(e,p,d),p++,d--;o(e[p],h)<0;)p++;for(;o(e[d],h)>0;)d--}0===o(e[r],h)?Cs(e,r,d):Cs(e,++d,i),d<=n&&(r=d+1),n<=d&&(i=d-1)}}(t,e,n||0,r||t.length-1,i||Ls)}function Cs(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function Ls(t,e){return t<e?-1:t>e?1:0}function Is(t,e){const n=t.length;if(n<=1)return[t];const r=[];let i,o;for(let a=0;a<n;a++){const e=I(t[a]);0!==e&&(t[a].area=Math.abs(e),void 0===o&&(o=e<0),o===e<0?(i&&r.push(i),i=[t[a]]):i.push(t[a]))}if(i&&r.push(i),e>1)for(let a=0;a<r.length;a++)r[a].length<=e||(As(r[a],e,1,r[a].length-1,Ps),r[a]=r[a].slice(0,e));return r}function Ps(t,e){return e.area-t.area}function Rs(t,e,n){const r=n.patternDependencies;let i=!1;for(const o of e){const e=o.paint.get(t+"-pattern");e.isConstant()||(i=!0);const n=e.constantOr(null);n&&(i=!0,r[n.to]=!0,r[n.from]=!0)}return i}function Os(t,e,n,r,i){const o=i.patternDependencies;for(const a of e){const e=a.paint.get(t+"-pattern").value;if("constant"!==e.kind){let t=e.evaluate({zoom:r-1},n,{},i.availableImages),s=e.evaluate({zoom:r},n,{},i.availableImages),l=e.evaluate({zoom:r+1},n,{},i.availableImages);t=t&&t.name?t.name:t,s=s&&s.name?s.name:s,l=l&&l.name?l.name:l,o[t]=!0,o[s]=!0,o[l]=!0,n.patterns[a.id]={min:t,mid:s,max:l}}}return n}es.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(Ts(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(Ts(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var l=0;for(a=0;a<r.length;a+=3){var c=r[a]*n,u=r[a+1]*n,h=r[a+2]*n;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},es.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n},Qa.default=ts;class Ds{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ki,this.indexArray=new Zi,this.indexArray2=new to,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new jo,this.segments2=new jo,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.hasPattern=Rs("fill",this.layers,e);const r=this.layers[0].layout.get("fill-sort-key"),i=[];for(const{feature:o,id:a,index:s,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Wo(o,t);if(!this.layers[0]._featureFilter.filter(new mi(this.zoom),c,n))continue;const u=r?r.evaluate(c,{},n,e.availableImages):void 0,h={id:a,properties:o.properties,type:o.type,sourceLayerIndex:l,index:s,geometry:t?c.geometry:Ho(o),patterns:{},sortKey:u};i.push(h)}r&&i.sort((t,e)=>t.sortKey-e.sortKey);for(const o of i){const{geometry:r,index:i,sourceLayerIndex:a}=o;if(this.hasPattern){const t=Os("fill",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,r,i,n,{});e.featureIndex.insert(t[i].feature,r,i,a,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,e,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ka),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,n,r,i){for(const o of Is(e,500)){let t=0;for(const s of o)t+=s.length;const e=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=e.vertexLength,r=[],i=[];for(const s of o){if(0===s.length)continue;s!==o[0]&&i.push(r.length/2);const t=this.segments2.prepareSegment(s.length,this.layoutVertexArray,this.indexArray2),e=t.vertexLength;this.layoutVertexArray.emplaceBack(s[0].x,s[0].y),this.indexArray2.emplaceBack(e+s.length-1,e),r.push(s[0].x),r.push(s[0].y);for(let n=1;n<s.length;n++)this.layoutVertexArray.emplaceBack(s[n].x,s[n].y),this.indexArray2.emplaceBack(e+n-1,e+n),r.push(s[n].x),r.push(s[n].y);t.vertexLength+=s.length,t.primitiveLength+=s.length}const a=Qa(r,i);for(let o=0;o<a.length;o+=3)this.indexArray.emplaceBack(n+a[o],n+a[o+1],n+a[o+2]);e.vertexLength+=t,e.primitiveLength+=a.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)}}Wr("FillBucket",Ds,{omit:["layers","patternFeatures"]});const Ns=new Li({"fill-sort-key":new Si(Nt.layout_fill["fill-sort-key"])});var ks={paint:new Li({"fill-antialias":new Ei(Nt.paint_fill["fill-antialias"]),"fill-opacity":new Si(Nt.paint_fill["fill-opacity"]),"fill-color":new Si(Nt.paint_fill["fill-color"]),"fill-outline-color":new Si(Nt.paint_fill["fill-outline-color"]),"fill-translate":new Ei(Nt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ei(Nt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ti(Nt.paint_fill["fill-pattern"])}),layout:Ns};const Fs=Di([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zs=Di([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Bs}=Fs;var Us=js;function js(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(Gs,this,e)}function Gs(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Vs(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)r+=((n=t[a]).x-(e=t[i]).x)*(e.y+n.y);return r}js.types=["Unknown","Point","LineString","Polygon"],js.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,o=0,a=0,s=0,l=[];t.pos<n;){if(o<=0){var c=t.readVarint();i=7&c,o=c>>3}if(o--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&l.push(e),e=[]),e.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&l.push(e),l},js.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();n=7&u,r=u>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,l,s,c]},js.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),c=js.types[this.type];function u(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=Vs(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(l),r=0;r<l.length;r++)for(i=0;i<l[r].length;i++)u(l[r][i])}1===l.length?l=l[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Hs=Ws;function Ws(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(qs,this,e),this.length=this._features.length}function qs(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function Xs(t,e,n){if(3===t){var r=new Hs(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}Ws.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Us(this._pbf,e,this.extent,this._keys,this._values)};var Zs={VectorTile:function(t,e){this.layers=t.readFields(Xs,{},e)},VectorTileFeature:Us,VectorTileLayer:Hs};const Ys=Zs.VectorTileFeature.types,$s=Math.pow(2,13);function Js(t,e,n,r,i,o,a,s){t.emplaceBack((e<<1)+a,(n<<1)+o,(Math.floor(r*$s)<<1)+i,Math.round(s))}class Ks{constructor(){this.acc=new r(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(t.x,t.y),this.max=new r(t.x,t.y))}append(t,e){this.currentPolyCount.edges++,this.acc._add(t);let n=!!this.borders;const r=this.min,i=this.max;t.x<r.x?(r.x=t.x,n=!0):t.x>i.x&&(i.x=t.x,n=!0),t.y<r.y?(r.y=t.y,n=!0):t.y>i.y&&(i.y=t.y,n=!0),((0===t.x||8192===t.x)&&t.x===e.x)!=((0===t.y||8192===t.y)&&t.y===e.y)&&this.processBorderOverlap(t,e),n&&this.checkBorderIntersection(t,e)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,Je(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>8192!=t.x>8192&&this.addBorderIntersection(1,Je(e.y,t.y,(8192-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,Je(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>8192!=t.y>8192&&this.addBorderIntersection(3,Je(e.x,t.x,(8192-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[t];e<n[0]&&(n[0]=e),e>n[1]&&(n[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const n=0===t.x?0:1;this.addBorderIntersection(n,e.y),this.addBorderIntersection(n,t.y)}else{const n=0===t.y?2:3;this.addBorderIntersection(n,e.x),this.addBorderIntersection(n,t.x)}}centroid(){const t=this.polyCount.reduce((t,e)=>t+e.edges,0);return 0!==t?this.acc.div(t)._round():new r(0,0)}span(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,e)=>t+ +(e[0]!==Number.MAX_VALUE),0)}}class Qs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Fi,this.centroidVertexArray=new to,this.indexArray=new Zi,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new jo,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=t.enableTerrain}populate(t,e,n){this.features=[],this.hasPattern=Rs("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(t){const e=Math.exp(Math.PI*(1-t.y/(1<<t.z)*2));return 80150034*e/(e*e+1)/8192/(1<<t.z)}(n);for(const{feature:r,id:i,index:o,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,s=Wo(r,t);if(!this.layers[0]._featureFilter.filter(new mi(this.zoom),s,n))continue;const l={id:i,sourceLayerIndex:a,index:o,geometry:t?s.geometry:Ho(r),properties:r.properties,type:r.type,patterns:{}};this.hasPattern?this.features.push(Os("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,o,n,{}),e.featureIndex.insert(r,l.geometry,o,a,this.index)}this.sortBorders()}addFeatures(t,e,n){for(const r of this.features){const{geometry:t}=r;this.addFeature(r,t,r.index,e,n)}this.sortBorders()}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,zs.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,r,i){const o=this.enableTerrain&&t.properties&&t.properties.hasOwnProperty("type")&&t.properties.hasOwnProperty("height")&&"Polygon"===Ys[t.type]?new Ks:null;for(const s of Is(e,500)){let e=0,n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===s.length||(a=s[0]).every(t=>t.x<=0)||a.every(t=>t.x>=8192)||a.every(t=>t.y<=0)||a.every(t=>t.y>=8192))continue;for(let t=0;t<s.length;t++){const r=s[t];if(0===r.length)continue;e+=r.length;let i=0;o&&o.startRing(r[0]);for(let t=0;t<r.length;t++){const e=r[t];if(t>=1){const a=r[t-1];if(!tl(e,a)){o&&o.append(e,a),n.vertexLength+4>jo.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=e.sub(a)._perp(),r=t.x/(Math.abs(t.x)+Math.abs(t.y)),s=t.y>0?1:0,l=a.dist(e);i+l>32768&&(i=0),Js(this.layoutVertexArray,e.x,e.y,r,s,0,0,i),Js(this.layoutVertexArray,e.x,e.y,r,s,0,1,i),i+=l,Js(this.layoutVertexArray,a.x,a.y,r,s,0,0,i),Js(this.layoutVertexArray,a.x,a.y,r,s,0,1,i);const c=n.vertexLength;this.indexArray.emplaceBack(c,c+2,c+1),this.indexArray.emplaceBack(c+1,c+2,c+3),n.vertexLength+=4,n.primitiveLength+=2}}}}if(n.vertexLength+e>jo.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==Ys[t.type])continue;const r=[],i=[],l=n.vertexLength;for(let t=0;t<s.length;t++){const e=s[t];if(0!==e.length){e!==s[0]&&i.push(r.length/2);for(let t=0;t<e.length;t++){const n=e[t];Js(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),r.push(n.x),r.push(n.y),o&&o.currentPolyCount.top++}}}const c=Qa(r,i);for(let t=0;t<c.length;t+=3)this.indexArray.emplaceBack(l+c[t],l+c[t+2],l+c[t+1]);n.primitiveLength+=c.length/3,n.vertexLength+=e}var a;if(o&&o.polyCount.length>0){if(o.borders){o.vertexArrayOffset=this.centroidVertexArray.length;const t=o.borders,e=this.featuresOnBorder.push(o)-1;for(let n=0;n<4;n++)t[n][0]!==Number.MAX_VALUE&&this.borders[n].push(e)}this.encodeCentroid(o.borders?void 0:o.centroid(),o)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((e,n)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[n].borders[t][0])}encodeCentroid(t,e,n=!0){let r,i;if(t)if(0!==t.y){const n=e.span()._mult(this.tileToMeter);r=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(n.x/10)),i=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(n.y/10))}else r=Math.ceil(7.3*t.x),i=0;else r=0,i=+n;let o=n?this.centroidVertexArray.length:e.vertexArrayOffset;for(const a of e.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*a.edges+a.top);for(let t=0;t<2*a.edges;t++)this.centroidVertexArray.emplace(o++,0,i),this.centroidVertexArray.emplace(o++,r,i);for(let t=0;t<a.top;t++)this.centroidVertexArray.emplace(o++,r,i)}}}function tl(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}Wr("FillExtrusionBucket",Qs,{omit:["layers","features"]}),Wr("PartMetadata",Ks);var el={paint:new Li({"fill-extrusion-opacity":new Ei(Nt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Si(Nt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ei(Nt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ei(Nt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ti(Nt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Si(Nt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Si(Nt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ei(Nt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function nl(t,e){return t.x*e.x+t.y*e.y}function rl(t,e){if(1===t.length){let n=0;const r=e[n++];let i;for(;!i||r.equals(i);)if(i=e[n++],!i)return 1/0;for(;n<e.length;n++){const o=e[n],a=t[0],s=i.sub(r),l=o.sub(r),c=a.sub(r),u=nl(s,s),h=nl(s,l),p=nl(l,l),d=nl(c,s),f=nl(c,l),m=u*p-h*h,g=(p*d-h*f)/m,y=(u*f-h*d)/m,v=r.z*(1-g-y)+i.z*g+o.z*y;if(isFinite(v))return v}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}const il=Di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ol}=il,al=Di([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:sl}=al,ll=Zs.VectorTileFeature.types,cl=Math.cos(Math.PI/180*37.5);class ul{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new zi,this.layoutVertexArray2=new Bi,this.indexArray=new Zi,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new jo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.hasPattern=Rs("line",this.layers,e);const r=this.layers[0].layout.get("line-sort-key"),i=[];for(const{feature:o,id:a,index:s,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,e=Wo(o,t);if(!this.layers[0]._featureFilter.filter(new mi(this.zoom),e,n))continue;const c=r?r.evaluate(e,{},n):void 0,u={id:a,properties:o.properties,type:o.type,sourceLayerIndex:l,index:s,geometry:t?e.geometry:Ho(o),patterns:{},sortKey:c};i.push(u)}r&&i.sort((t,e)=>t.sortKey-e.sortKey);for(const o of i){const{geometry:r,index:i,sourceLayerIndex:a}=o;if(this.hasPattern){const t=Os("line",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,r,i,n,{});e.featureIndex.insert(t[i].feature,r,i,a,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,e,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,sl)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ol),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,n,r,i){const o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const u of e)this.addLine(u,t,a,s,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)}addLine(t,e,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const a="Polygon"===ll[e.type];let s=t.length;for(;s>=2&&t[s-1].equals(t[s-2]);)s--;let l=0;for(;l<s-1&&t[l].equals(t[l+1]);)l++;if(s<(a?3:2))return;"bevel"===n&&(i=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let h,p=void 0,d=void 0,f=void 0,m=void 0;this.e1=this.e2=-1,a&&(h=t[s-2],m=t[l].sub(h)._unit()._perp());for(let g=l;g<s;g++){if(d=g===s-1?a?t[l+1]:void 0:t[g+1],d&&t[g].equals(d))continue;m&&(f=m),h&&(p=h),h=t[g],m=d?d.sub(h)._unit()._perp():f,f=f||m;let e=f.add(m);0===e.x&&0===e.y||e._unit();const y=f.x*m.x+f.y*m.y,v=e.x*m.x+e.y*m.y,_=0!==v?1/v:1/0,x=2*Math.sqrt(2-2*v),b=v<cl&&p&&d,w=f.x*m.y-f.y*m.x>0;if(b&&g>l){const t=h.dist(p);if(t>2*c){const e=h.sub(h.sub(p)._mult(c/t)._round());this.updateDistance(p,e),this.addCurrentVertex(e,f,0,0,u),p=e}}const M=p&&d;let E=M?n:a?"butt":r;if(M&&"round"===E&&(_<o?E="miter":_<=2&&(E="fakeround")),"miter"===E&&_>i&&(E="bevel"),"bevel"===E&&(_>2&&(E="flipbevel"),_<i&&(E="miter")),p&&this.updateDistance(p,h),"miter"===E)e._mult(_),this.addCurrentVertex(h,e,0,0,u);else if("flipbevel"===E){if(_>100)e=m.mult(-1);else{const t=_*f.add(m).mag()/f.sub(m).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,e,0,0,u),this.addCurrentVertex(h,e.mult(-1),0,0,u)}else if("bevel"===E||"fakeround"===E){const t=-Math.sqrt(_*_-1),e=w?t:0,n=w?0:t;if(p&&this.addCurrentVertex(h,f,e,n,u),"fakeround"===E){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*t*t+(.848013+y*(.215638*y-1.06021)))}const r=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,r.x,r.y,!1,w,0,u)}}d&&this.addCurrentVertex(h,m,-e,-n,u)}else if("butt"===E)this.addCurrentVertex(h,e,0,0,u);else if("square"===E){const t=p?1:-1;this.addCurrentVertex(h,e,t,t,u)}else"round"===E&&(p&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),d&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&g<s-1){const t=h.dist(d);if(t>2*c){const e=h.add(d.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,n,r,i,o=!1){const a=e.y*r-e.x,s=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,o,!1,n,i),this.addHalfVertex(t,a,s,o,!0,-r,i)}addHalfVertex({x:t,y:e},n,r,i,o,a,s){this.layoutVertexArray.emplaceBack((t<<1)+(i?1:0),(e<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*r)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);const l=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),s.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}Wr("LineBucket",ul,{omit:["layers","patternFeatures"]});const hl=new Li({"line-cap":new Ei(Nt.layout_line["line-cap"]),"line-join":new Si(Nt.layout_line["line-join"]),"line-miter-limit":new Ei(Nt.layout_line["line-miter-limit"]),"line-round-limit":new Ei(Nt.layout_line["line-round-limit"]),"line-sort-key":new Si(Nt.layout_line["line-sort-key"])});var pl={paint:new Li({"line-opacity":new Si(Nt.paint_line["line-opacity"]),"line-color":new Si(Nt.paint_line["line-color"]),"line-translate":new Ei(Nt.paint_line["line-translate"]),"line-translate-anchor":new Ei(Nt.paint_line["line-translate-anchor"]),"line-width":new Si(Nt.paint_line["line-width"]),"line-gap-width":new Si(Nt.paint_line["line-gap-width"]),"line-offset":new Si(Nt.paint_line["line-offset"]),"line-blur":new Si(Nt.paint_line["line-blur"]),"line-dasharray":new Ai(Nt.paint_line["line-dasharray"]),"line-pattern":new Ti(Nt.paint_line["line-pattern"]),"line-gradient":new Ci(Nt.paint_line["line-gradient"])}),layout:hl};const dl=new class extends Si{possiblyEvaluate(t,e){return e=new mi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,r){return e=y({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,r)}}(pl.paint.properties["line-width"].specification);function fl(t,e){return e>0?e+2*t:t}dl.useIntegerZoom=!0;const ml=Di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gl=Di([{name:"a_projected_pos",components:3,type:"Float32"}],4),yl=(Di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),vl=Di([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]),_l=(Di([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),xl=Di([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function bl(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new mi(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:r}=n;let i=0;for(;i<e.length&&e[i]<=t;)i++;i=Math.max(0,i-1);let o=i;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const a=e[i],s=e[o];return"composite"===n.kind?{kind:"composite",minZoom:a,maxZoom:s,interpolationType:r}:{kind:"camera",minZoom:a,maxZoom:s,minSize:n.evaluate(new mi(a)),maxSize:n.evaluate(new mi(s)),interpolationType:r}}}function wl(t,{uSize:e,uSizeT:n},{lowerSize:r,upperSize:i}){return"source"===t.kind?r/128:"composite"===t.kind?Je(r/128,i/128,n):e}function Ml(t,e){let n=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:i,minZoom:o,maxZoom:a}=t,s=i?f(dn.interpolationFactor(i,e,o,a),0,1):0;"camera"===t.kind?r=Je(t.minSize,t.maxSize,s):n=s}return{uSizeT:n,uSize:r}}Di([{name:"triangle",components:3,type:"Uint16"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Di([{type:"Float32",name:"offsetX"}]),Di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var El=Object.freeze({__proto__:null,getSizeData:bl,evaluateSizeForFeature:wl,evaluateSizeForZoom:Ml,SIZE_PACK_FACTOR:128});function Sl(t,e,n){return t.sections.forEach(t=>{t.text=function(t,e,n){const r=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),fi.applyArabicShaping&&(t=fi.applyArabicShaping(t)),t}(t.text,e,n)}),t}const Tl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Al=function(t,e,n,r,i){var o,a,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,h=n?i-1:0,p=n?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=s;u>0;o=256*o+t[e+h],h+=p,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=r;u>0;a=256*a+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),o-=c}return(d?-1:1)*a*Math.pow(2,o-r)},Cl=function(t,e,n,r,i,o){var a,s,l,c=8*o-i-1,u=(1<<c)-1,h=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(e*l-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+d]=255&s,d+=f,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;t[n+d]=255&a,d+=f,a/=256,c-=8);t[n+d-f]|=128*m},Ll=Il;function Il(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Il.Varint=0,Il.Fixed64=1,Il.Bytes=2,Il.Fixed32=5;var Pl="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Rl(t){return t.type===Il.Bytes?t.readVarint()+t.pos:t.pos+1}function Ol(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Dl(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function Nl(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function kl(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Fl(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function zl(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Bl(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Ul(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function jl(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Gl(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Vl(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Hl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Wl(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function ql(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Xl(t,e,n){1===t&&n.readMessage(Zl,e)}function Zl(t,e,n){if(3===t){const{id:t,bitmap:r,width:i,height:o,left:a,top:s,advance:l}=n.readMessage(Yl,{});e.push({id:t,bitmap:new qa({width:i+6,height:o+6},r),metrics:{width:i,height:o,left:a,top:s,advance:l}})}}function Yl(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function $l(t){let e=0,n=0;for(const a of t)e+=a.w*a.h,n=Math.max(n,a.w);t.sort((t,e)=>e.h-t.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let i=0,o=0;for(const a of t)for(let t=r.length-1;t>=0;t--){const e=r[t];if(!(a.w>e.w||a.h>e.h)){if(a.x=e.x,a.y=e.y,o=Math.max(o,a.y+a.h),i=Math.max(i,a.x+a.w),a.w===e.w&&a.h===e.h){const e=r.pop();t<r.length&&(r[t]=e)}else a.h===e.h?(e.x+=a.w,e.w-=a.w):a.w===e.w?(e.y+=a.h,e.h-=a.h):(r.push({x:e.x+a.w,y:e.y,w:e.w-a.w,h:a.h}),e.y+=a.h,e.h-=a.h);break}}return{w:i,h:o,fill:e/(i*o)||0}}Il.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Hl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ql(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Hl(this.buf,this.pos)+4294967296*Hl(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=Hl(this.buf,this.pos)+4294967296*ql(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Al(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Al(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return Ol(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return Ol(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return Ol(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return Ol(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return Ol(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return Ol(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Pl?function(t,e,n){return Pl.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,l=t[i],c=null,u=l>239?4:l>223?3:l>191?2:1;if(i+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[i+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((c=(15&l)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),i+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Il.Bytes)return t.push(this.readVarint(e));var n=Rl(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Il.Bytes)return t.push(this.readSVarint());var e=Rl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Il.Bytes)return t.push(this.readBoolean());var e=Rl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Il.Bytes)return t.push(this.readFloat());var e=Rl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Il.Bytes)return t.push(this.readDouble());var e=Rl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Il.Bytes)return t.push(this.readFixed32());var e=Rl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Il.Bytes)return t.push(this.readSFixed32());var e=Rl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Il.Bytes)return t.push(this.readFixed64());var e=Rl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Il.Bytes)return t.push(this.readSFixed64());var e=Rl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Il.Varint)for(;this.buf[this.pos++]>127;);else if(e===Il.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Il.Fixed32)this.pos+=4;else{if(e!==Il.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Wl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Wl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Wl(this.buf,-1&t,this.pos),Wl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Wl(this.buf,-1&t,this.pos),Wl(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Dl(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Cl(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Cl(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&Dl(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Il.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Nl,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,kl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Bl,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Fl,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,zl,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Ul,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,jl,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Gl,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Vl,e)},writeBytesField:function(t,e){this.writeTag(t,Il.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Il.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Il.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Il.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Il.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Il.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Il.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Il.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Il.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Il.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Jl{constructor(t,{pixelRatio:e,version:n,stretchX:r,stretchY:i,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=i,this.content=o,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Kl{constructor(t,e){const n={},r={};this.haveRenderCallbacks=[];const i=[];this.addImages(t,n,i),this.addImages(e,r,i);const{w:o,h:a}=$l(i),s=new Xa({width:o||1,height:a||1});for(const l in t){const e=t[l],r=n[l].paddedRect;Xa.copy(e.data,s,{x:0,y:0},{x:r.x+1,y:r.y+1},e.data)}for(const l in e){const t=e[l],n=r[l].paddedRect,i=n.x+1,o=n.y+1,a=t.data.width,c=t.data.height;Xa.copy(t.data,s,{x:0,y:0},{x:i,y:o},t.data),Xa.copy(t.data,s,{x:0,y:c-1},{x:i,y:o-1},{width:a,height:1}),Xa.copy(t.data,s,{x:0,y:0},{x:i,y:o+c},{width:a,height:1}),Xa.copy(t.data,s,{x:a-1,y:0},{x:i-1,y:o},{width:1,height:c}),Xa.copy(t.data,s,{x:0,y:0},{x:i+a,y:o},{width:1,height:c})}this.image=s,this.iconPositions=n,this.patternPositions=r}addImages(t,e,n){for(const r in t){const i=t[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),e[r]=new Jl(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)}patchUpdatedImage(t,e,n){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,i]=t.tl;n.update(e.data,void 0,{x:r,y:i})}}Wr("ImagePosition",Jl),Wr("ImageAtlas",Kl);const Ql={horizontal:1,vertical:2,horizontalOnly:3};class tc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const n=new tc;return n.scale=t||1,n.fontStack=e,n}static forImage(t){const e=new tc;return e.imageName=t,e}}class ec{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const n=new ec;for(let r=0;r<t.sections.length;r++){const i=t.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,e)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let n=0;n<t.length;n++){const r=t.charCodeAt(n+1)||null,i=t.charCodeAt(n-1)||null;e+=r&&ni(r)&&!Tl[t[n+1]]||i&&ni(i)&&!Tl[t[n-1]]||!Tl[t[n]]?t[n]:Tl[t[n]]}return e}(this.text)}trim(){let t=0;for(let n=0;n<this.text.length&&rc[this.text.charCodeAt(n)];n++)t++;let e=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&rc[this.text.charCodeAt(n)];n--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const n=new ec;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(tc.forText(t.scale,t.fontStack||e));const n=this.sections.length-1;for(let r=0;r<t.text.length;++r)this.sectionIndex.push(n)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void C("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(tc.forImage(e)),this.sectionIndex.push(this.sections.length-1)):C("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function nc(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m){const g=ec.fromFeature(t,i);let y;h===Ql.vertical&&g.verticalizePunctuation();const{processBidirectionalText:v,processStyledBidirectionalText:_}=fi;if(v&&1===g.sections.length){y=[];const t=v(g.toString(),cc(g,c,o,e,r,d,f));for(const e of t){const t=new ec;t.text=e,t.sections=g.sections;for(let n=0;n<e.length;n++)t.sectionIndex.push(0);y.push(t)}}else if(_){y=[];const t=_(g.text,g.sectionIndex,cc(g,c,o,e,r,d,f));for(const e of t){const t=new ec;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const n=[],r=t.text;let i=0;for(const o of e)n.push(t.substring(i,o)),i=o;return i<r.length&&n.push(t.substring(i,r.length)),n}(g,cc(g,c,o,e,r,d,f));const x=[],b={positionedLines:x,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,n,r,i,o,a,s,l,c,u,h){let p=0,d=-17,f=0,m=0;const g="right"===s?1:"left"===s?0:.5;let y=0;for(const w of i){w.trim();const i=w.getMaxScale(),a=24*(i-1),s={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=s;const _=s.positionedGlyphs;let x=0;if(!w.length()){d+=o,++y;continue}for(let o=0;o<w.length();o++){const s=w.getSection(o),f=w.getSectionIndex(o),m=w.getCharCode(o);let g=0,y=null,b=null,M=null,E=24;const S=!(l===Ql.horizontal||!u&&!ei(m)||u&&(rc[m]||(v=m,Jr.Arabic(v)||Jr["Arabic Supplement"](v)||Jr["Arabic Extended-A"](v)||Jr["Arabic Presentation Forms-A"](v)||Jr["Arabic Presentation Forms-B"](v))));if(s.imageName){const e=r[s.imageName];if(!e)continue;M=s.imageName,t.iconsInText=t.iconsInText||!0,b=e.paddedRect;const n=e.displaySize;s.scale=24*s.scale/h,y={width:n[0],height:n[1],left:1,top:-3,advance:S?n[1]:n[0]},g=a+(24-n[1]*s.scale),E=y.advance;const o=S?n[0]*s.scale-24*i:n[1]*s.scale-24*i;o>0&&o>x&&(x=o)}else{const t=n[s.fontStack],r=t&&t[m];if(r&&r.rect)b=r.rect,y=r.metrics;else{const t=e[s.fontStack],n=t&&t[m];if(!n)continue;y=n.metrics}g=24*(i-s.scale)}S?(t.verticalizable=!0,_.push({glyph:m,imageName:M,x:p,y:d+g,vertical:S,scale:s.scale,fontStack:s.fontStack,sectionIndex:f,metrics:y,rect:b}),p+=E*s.scale+c):(_.push({glyph:m,imageName:M,x:p,y:d+g,vertical:S,scale:s.scale,fontStack:s.fontStack,sectionIndex:f,metrics:y,rect:b}),p+=y.advance*s.scale+c)}0!==_.length&&(f=Math.max(p-c,f),hc(_,0,_.length-1,g,x)),p=0;const b=o*i+x;s.lineOffset=Math.max(x,a),d+=b,m=Math.max(b,m),++y}var v;const _=d- -17,{horizontalAlign:x,verticalAlign:b}=uc(a);(function(t,e,n,r,i,o,a,s,l){const c=(e-n)*i;let u=0;u=o!==a?-s*r- -17:(-r*l+.5)*a;for(const h of t)for(const t of h.positionedGlyphs)t.x+=c,t.y+=u})(t.positionedLines,g,x,b,f,m,o,_,i.length),t.top+=-b*_,t.bottom=t.top+_,t.left+=-x*f,t.right=t.left+f}(b,e,n,r,y,a,s,l,h,c,p,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const rc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ic={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function oc(t,e,n,r,i,o){if(e.imageName){const t=r[e.imageName];return t?t.displaySize[0]*e.scale*24/o+i:0}{const r=n[e.fontStack],o=r&&r[t];return o?o.metrics.advance*e.scale+i:0}}function ac(t,e,n,r){const i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function sc(t,e,n){let r=0;return 10===t&&(r-=1e4),n&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function lc(t,e,n,r,i,o){let a=null,s=ac(e,n,i,o);for(const l of r){const t=ac(e-l.x,n,i,o)+l.badness;t<=s&&(a=l,s=t)}return{index:t,x:e,priorBreak:a,badness:s}}function cc(t,e,n,r,i,o,a){if("point"!==o)return[];if(!t)return[];const s=[],l=function(t,e,n,r,i,o){let a=0;for(let s=0;s<t.length();s++){const n=t.getSection(s);a+=oc(t.getCharCode(s),n,r,i,e,o)}return a/Math.max(1,Math.ceil(a/n))}(t,e,n,r,i,a),c=t.text.indexOf("")>=0;let u=0;for(let p=0;p<t.length();p++){const n=t.getSection(p),o=t.getCharCode(p);if(rc[o]||(u+=oc(o,n,r,i,e,a)),p<t.length()-1){const e=!((h=o)<11904||!(Jr["Bopomofo Extended"](h)||Jr.Bopomofo(h)||Jr["CJK Compatibility Forms"](h)||Jr["CJK Compatibility Ideographs"](h)||Jr["CJK Compatibility"](h)||Jr["CJK Radicals Supplement"](h)||Jr["CJK Strokes"](h)||Jr["CJK Symbols and Punctuation"](h)||Jr["CJK Unified Ideographs Extension A"](h)||Jr["CJK Unified Ideographs"](h)||Jr["Enclosed CJK Letters and Months"](h)||Jr["Halfwidth and Fullwidth Forms"](h)||Jr.Hiragana(h)||Jr["Ideographic Description Characters"](h)||Jr["Kangxi Radicals"](h)||Jr["Katakana Phonetic Extensions"](h)||Jr.Katakana(h)||Jr["Vertical Forms"](h)||Jr["Yi Radicals"](h)||Jr["Yi Syllables"](h)));(ic[o]||e||n.imageName)&&s.push(lc(p+1,u,l,s,sc(o,t.getCharCode(p+1),e&&c),!1))}}var h;return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(lc(t.length(),u,l,s,0,!0))}function uc(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function hc(t,e,n,r,i){if(!r&&!i)return;const o=t[n],a=(t[n].x+o.metrics.advance*o.scale)*r;for(let s=e;s<=n;s++)t[s].x-=a,t[s].y+=i}function pc(t,e,n){const{horizontalAlign:r,verticalAlign:i}=uc(n),o=e[0]-t.displaySize[0]*r,a=e[1]-t.displaySize[1]*i;return{image:t,top:a,bottom:a+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function dc(t,e,n,r,i,o){const a=t.image;let s;if(a.content){const t=a.content,e=a.pixelRatio||1;s=[t[0]/e,t[1]/e,a.displaySize[0]-t[2]/e,a.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,p,d;"width"===n||"both"===n?(d=i[0]+l-r[3],h=i[0]+c+r[1]):(d=i[0]+(l+c-a.displaySize[0])/2,h=d+a.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===n||"both"===n?(u=i[1]+f-r[0],p=i[1]+m+r[2]):(u=i[1]+(f+m-a.displaySize[1])/2,p=u+a.displaySize[1]),{image:a,top:u,right:h,bottom:p,left:d,collisionPadding:s}}class fc extends r{constructor(t,e,n,r){super(t,e),this.angle=n,void 0!==r&&(this.segment=r)}clone(){return new fc(this.x,this.y,this.angle,this.segment)}}function mc(t,e,n,r,i){if(void 0===e.segment)return!0;let o=e,a=e.segment+1,s=0;for(;s>-n/2;){if(a--,a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;const l=[];let c=0;for(;s<n/2;){const e=t[a],n=t[a+1];if(!n)return!1;let o=t[a-1].angleTo(e)-e.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:o}),c+=o;s-l[0].distance>r;)c-=l.shift().angleDelta;if(c>i)return!1;a++,s+=e.dist(n)}return!0}function gc(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function yc(t,e,n){return t?.6*e*n:0}function vc(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function _c(t,e,n,r,i,o){const a=yc(n,i,o),s=vc(n,r)*o;let l=0;const c=gc(t)/2;for(let u=0;u<t.length-1;u++){const n=t[u],r=t[u+1],i=n.dist(r);if(l+i>c){const o=(c-l)/i,h=Je(n.x,r.x,o),p=Je(n.y,r.y,o),d=new fc(h,p,r.angleTo(n),u);return d._round(),!a||mc(t,d,s,a,e)?d:void 0}l+=i}}function xc(t,e,n,r,i,o,a,s,l){const c=yc(r,o,a),u=vc(r,i),h=u*a,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),function t(e,n,r,i,o,a,s,l,c){const u=a/2,h=gc(e);let p=0,d=n-r,f=[];for(let m=0;m<e.length-1;m++){const t=e[m],n=e[m+1],s=t.dist(n),l=n.angleTo(t);for(;d+r<p+s;){d+=r;const g=(d-p)/s,y=Je(t.x,n.x,g),v=Je(t.y,n.y,g);if(y>=0&&y<c&&v>=0&&v<c&&d-u>=0&&d+u<=h){const t=new fc(y,v,l,m);t._round(),i&&!mc(e,t,a,i,o)||f.push(t)}}p+=s}return l||f.length||s||(f=t(e,p/2,r,i,o,a,s,!0,c)),f}(t,p?e/2*s%e:(u/2+2*o)*a*s%e,e,c,n,h,p,!1,l)}function bc(t,e,n,i,o){const a=[];for(let s=0;s<t.length;s++){const l=t[s];let c;for(let t=0;t<l.length-1;t++){let s=l[t],u=l[t+1];s.x<e&&u.x<e||(s.x<e?s=new r(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<e&&(u=new r(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<n&&u.y<n||(s.y<n?s=new r(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round():u.y<n&&(u=new r(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round()),s.x>=i&&u.x>=i||(s.x>=i?s=new r(i,s.y+(i-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=i&&(u=new r(i,s.y+(i-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=o&&u.y>=o||(s.y>=o?s=new r(s.x+(o-s.y)/(u.y-s.y)*(u.x-s.x),o)._round():u.y>=o&&(u=new r(s.x+(o-s.y)/(u.y-s.y)*(u.x-s.x),o)._round()),c&&s.equals(c[c.length-1])||(c=[s],a.push(c)),c.push(u)))))}}return a}function wc(t,e,n,i){const o=[],a=t.image,s=a.pixelRatio,l=a.paddedRect.w-2,c=a.paddedRect.h-2,u=t.right-t.left,h=t.bottom-t.top,p=a.stretchX||[[0,l]],d=a.stretchY||[[0,c]],f=(t,e)=>t+e[1]-e[0],m=p.reduce(f,0),g=d.reduce(f,0),y=l-m,v=c-g;let _=0,x=m,b=0,w=g,M=0,E=y,S=0,T=v;if(a.content&&i){const t=a.content;_=Mc(p,0,t[0]),b=Mc(d,0,t[1]),x=Mc(p,t[0],t[2]),w=Mc(d,t[1],t[3]),M=t[0]-_,S=t[1]-b,E=t[2]-t[0]-x,T=t[3]-t[1]-w}const A=(i,o,l,c)=>{const p=Sc(i.stretch-_,x,u,t.left),d=Tc(i.fixed-M,E,i.stretch,m),f=Sc(o.stretch-b,w,h,t.top),y=Tc(o.fixed-S,T,o.stretch,g),v=Sc(l.stretch-_,x,u,t.left),A=Tc(l.fixed-M,E,l.stretch,m),C=Sc(c.stretch-b,w,h,t.top),L=Tc(c.fixed-S,T,c.stretch,g),I=new r(p,f),P=new r(v,f),R=new r(v,C),O=new r(p,C),D=new r(d/s,y/s),N=new r(A/s,L/s),k=e*Math.PI/180;if(k){const t=Math.sin(k),e=Math.cos(k),n=[e,-t,t,e];I._matMult(n),P._matMult(n),O._matMult(n),R._matMult(n)}const F=i.stretch+i.fixed,z=o.stretch+o.fixed;return{tl:I,tr:P,bl:O,br:R,tex:{x:a.paddedRect.x+1+F,y:a.paddedRect.y+1+z,w:l.stretch+l.fixed-F,h:c.stretch+c.fixed-z},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:N,minFontScaleX:E/s/u,minFontScaleY:T/s/h,isSDF:n}};if(i&&(a.stretchX||a.stretchY)){const t=Ec(p,y,m),e=Ec(d,v,g);for(let n=0;n<t.length-1;n++){const r=t[n],i=t[n+1];for(let t=0;t<e.length-1;t++)o.push(A(r,e[t],i,e[t+1]))}}else o.push(A({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function Mc(t,e,n){let r=0;for(const i of t)r+=Math.max(e,Math.min(n,i[1]))-Math.max(e,Math.min(n,i[0]));return r}function Ec(t,e,n){const r=[{fixed:-1,stretch:0}];for(const[i,o]of t){const t=r[r.length-1];r.push({fixed:i-t.stretch,stretch:t.stretch}),r.push({fixed:i-t.stretch,stretch:t.stretch+(o-i)})}return r.push({fixed:e+1,stretch:n}),r}function Sc(t,e,n,r){return t/e*n+r}function Tc(t,e,n,r){return t-e*n/r}Wr("Anchor",fc);class Ac{constructor(t=[],e=Cc){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,r=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r}_down(t){const{data:e,compare:n}=this,r=this.length>>1,i=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const a=r+1;if(a<this.length&&n(e[a],o)<0&&(r=a,o=e[a]),n(o,i)>=0)break;e[t]=o,t=r}e[t]=i}}function Cc(t,e){return t<e?-1:t>e?1:0}function Lc(t,e=1,n=!1){let i=1/0,o=1/0,a=-1/0,s=-1/0;const l=t[0];for(let r=0;r<l.length;r++){const t=l[r];(!r||t.x<i)&&(i=t.x),(!r||t.y<o)&&(o=t.y),(!r||t.x>a)&&(a=t.x),(!r||t.y>s)&&(s=t.y)}const c=Math.min(a-i,s-o);let u=c/2;const h=new Ac([],Ic);if(0===c)return new r(i,o);for(let r=i;r<a;r+=c)for(let e=o;e<s;e+=c)h.push(new Pc(r+u,e+u,u,t));let p=function(t){let e=0,n=0,r=0;const i=t[0];for(let o=0,a=i.length,s=a-1;o<a;s=o++){const t=i[o],a=i[s],l=t.x*a.y-a.x*t.y;n+=(t.x+a.x)*l,r+=(t.y+a.y)*l,e+=3*l}return new Pc(n/e,r/e,0,t)}(t),d=h.length;for(;h.length;){const r=h.pop();(r.d>p.d||!p.d)&&(p=r,n&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-p.d<=e||(u=r.h/2,h.push(new Pc(r.p.x-u,r.p.y-u,u,t)),h.push(new Pc(r.p.x+u,r.p.y-u,u,t)),h.push(new Pc(r.p.x-u,r.p.y+u,u,t)),h.push(new Pc(r.p.x+u,r.p.y+u,u,t)),d+=4)}return n&&(console.log("num probes: "+d),console.log("best distance: "+p.d)),p.p}function Ic(t,e){return e.max-t.max}function Pc(t,e,n,i){this.p=new r(t,e),this.h=n,this.d=function(t,e){let n=!1,r=1/0;for(let i=0;i<e.length;i++){const o=e[i];for(let e=0,i=o.length,a=i-1;e<i;a=e++){const i=o[e],s=o[a];i.y>t.y!=s.y>t.y&&t.x<(s.x-i.x)*(t.y-i.y)/(s.y-i.y)+i.x&&(n=!n),r=Math.min(r,ea(t,i,s))}}return(n?1:-1)*Math.sqrt(r)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const Rc=Number.POSITIVE_INFINITY;function Oc(t,e){return e[1]!==Rc?function(t,e,n){let r=0,i=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,i]}(t,e[0],e[1]):function(t,e){let n=0,r=0;e<0&&(e=0);const i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}return[n,r]}(t,e[0])}function Dc(t,e,n,r,i,o,a,s){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const l=t.layers[0].layout,c=t.layers[0]._unevaluatedLayout._values,u={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:n}=t.textSizeData;u.compositeTextSizes=[c["text-size"].possiblyEvaluate(new mi(e),a),c["text-size"].possiblyEvaluate(new mi(n),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:n}=t.iconSizeData;u.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new mi(e),a),c["icon-size"].possiblyEvaluate(new mi(n),a)]}u.layoutTextSize=c["text-size"].possiblyEvaluate(new mi(s+1),a),u.layoutIconSize=c["icon-size"].possiblyEvaluate(new mi(s+1),a),u.textMaxSize=c["text-size"].possiblyEvaluate(new mi(18),a);const h=24*l.get("text-line-height"),p="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),d=l.get("text-keep-upright"),f=l.get("text-size");for(const m of t.features){const o=l.get("text-font").evaluate(m,{},a).join(","),s=f.evaluate(m,{},a),c=u.layoutTextSize.evaluate(m,{},a),g=(u.layoutIconSize.evaluate(m,{},a),{horizontal:{},vertical:void 0}),y=m.text;let v,_=[0,0];if(y){const r=y.toString(),u=24*l.get("text-letter-spacing").evaluate(m,{},a),f=Qr(r)?u:0,v=l.get("text-anchor").evaluate(m,{},a),x=l.get("text-variable-anchor");if(!x){const t=l.get("text-radial-offset").evaluate(m,{},a);_=t?Oc(v,[24*t,Rc]):l.get("text-offset").evaluate(m,{},a).map(t=>24*t)}let b=p?"center":l.get("text-justify").evaluate(m,{},a);const w=l.get("symbol-placement"),M="point"===w?24*l.get("text-max-width").evaluate(m,{},a):0,E=()=>{t.allowVerticalPlacement&&Kr(r)&&(g.vertical=nc(y,e,n,i,o,M,h,v,"left",f,_,Ql.vertical,!0,w,c,s))};if(!p&&x){const t="auto"===b?x.map(t=>Nc(t)):[b];let r=!1;for(let a=0;a<t.length;a++){const l=t[a];if(!g.horizontal[l])if(r)g.horizontal[l]=g.horizontal[0];else{const t=nc(y,e,n,i,o,M,h,"center",l,f,_,Ql.horizontal,!1,w,c,s);t&&(g.horizontal[l]=t,r=1===t.positionedLines.length)}}E()}else{"auto"===b&&(b=Nc(v));const t=nc(y,e,n,i,o,M,h,v,b,f,_,Ql.horizontal,!1,w,c,s);t&&(g.horizontal[b]=t),E(),Kr(r)&&p&&d&&(g.vertical=nc(y,e,n,i,o,M,h,v,b,f,_,Ql.vertical,!1,w,c,s))}}let x=!1;if(m.icon&&m.icon.name){const e=r[m.icon.name];e&&(v=pc(i[m.icon.name],l.get("icon-offset").evaluate(m,{},a),l.get("icon-anchor").evaluate(m,{},a)),x=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&C("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const b=zc(g.horizontal)||g.vertical;t.iconsInText=!!b&&b.iconsInText,(b||v)&&kc(t,m,g,v,r,u,c,0,_,x,a)}o&&t.generateCollisionDebugBuffers(s,t.collisionBoxArray)}function Nc(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kc(t,e,n,r,i,o,a,s,l,c,h){let p=o.textMaxSize.evaluate(e,{},h);void 0===p&&(p=a);const d=t.layers[0].layout,f=d.get("icon-offset").evaluate(e,{},h),m=zc(n.horizontal),g=a/24,y=t.tilePixelRatio*g,v=t.tilePixelRatio*p/24,_=t.tilePixelRatio*d.get("symbol-spacing"),x=d.get("text-padding")*t.tilePixelRatio,b=d.get("icon-padding")*t.tilePixelRatio,w=u(d.get("text-max-angle")),M="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),E="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),S=d.get("symbol-placement"),T=_/2,A=d.get("icon-text-fit");let L;r&&"none"!==A&&(t.allowVerticalPlacement&&n.vertical&&(L=dc(r,n.vertical,A,d.get("icon-text-fit-padding"),f,g)),m&&(r=dc(r,m,A,d.get("icon-text-fit-padding"),f,g)));const I=(s,u)=>{u.x<0||u.x>=8192||u.y<0||u.y>=8192||function(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m,g,y,v,_,x,b,w,M,E){const S=t.addToLineVertexArray(e,n);let T,A,L,I,P,R,O,D=0,N=0,k=0,F=0,z=-1,B=-1;const U={};let j=yo(""),G=0,V=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?[G,V]=s.layout.get("text-offset").evaluate(x,{},M).map(t=>24*t):(G=24*s.layout.get("text-radial-offset").evaluate(x,{},M),V=Rc),t.allowVerticalPlacement&&r.vertical){const t=r.vertical;if(f)R=Uc(t),a&&(O=Uc(a));else{const n=s.layout.get("text-rotate").evaluate(x,{},M)+90;L=Bc(l,e,c,u,h,t,0,d,n),a&&(I=Bc(l,e,c,u,h,a,0,y,n))}}if(i){const n=s.layout.get("icon-rotate").evaluate(x,{},M),r="none"!==s.layout.get("icon-text-fit"),o=wc(i,n,w,r),p=a?wc(a,n,w,r):void 0;A=Bc(l,e,c,u,h,i,0,y,n),D=4*o.length;const d=t.iconSizeData;let f=null;"source"===d.kind?(f=[128*s.layout.get("icon-size").evaluate(x,{},M)],f[0]>32640&&C(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".')):"composite"===d.kind&&(f=[128*b.compositeIconSizes[0].evaluate(x,{},M),128*b.compositeIconSizes[1].evaluate(x,{},M)],(f[0]>32640||f[1]>32640)&&C(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".')),t.addSymbols(t.icon,o,f,_,v,x,!1,e,S.lineStartIndex,S.lineLength,-1,M),z=t.icon.placedSymbolArray.length-1,p&&(N=4*p.length,t.addSymbols(t.icon,p,f,_,v,x,Ql.vertical,e,S.lineStartIndex,S.lineLength,-1,M),B=t.icon.placedSymbolArray.length-1)}for(const C in r.horizontal){const n=r.horizontal[C];T||(j=yo(n.text),f?P=Uc(n):T=Bc(l,e,c,u,h,n,0,d,s.layout.get("text-rotate").evaluate(x,{},M)));const i=1===n.positionedLines.length;if(k+=Fc(t,e,n,o,s,f,x,m,S,r.vertical?Ql.horizontal:Ql.horizontalOnly,i?Object.keys(r.horizontal):[C],U,z,b,M),i)break}r.vertical&&(F+=Fc(t,e,r.vertical,o,s,f,x,m,S,Ql.vertical,["vertical"],U,B,b,M));let H=-1;const W=(t,e)=>t?Math.max(t,e):e;H=W(P,H),H=W(R,H),H=W(O,H);const q=H>-1?1:0;q&&(H*=E/24),t.glyphOffsetArray.length>=Yc.MAX_GLYPHS&&C("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical||-1,z,B,j,void 0!==T?T:t.collisionBoxArray.length,void 0!==T?T+1:t.collisionBoxArray.length,void 0!==L?L:t.collisionBoxArray.length,void 0!==L?L+1:t.collisionBoxArray.length,void 0!==A?A:t.collisionBoxArray.length,void 0!==A?A+1:t.collisionBoxArray.length,I||t.collisionBoxArray.length,I?I+1:t.collisionBoxArray.length,c,k,F,D,N,q,0,p,G,V,H)}(t,u,s,n,r,i,L,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,y,x,M,l,0,b,E,f,e,o,c,h,a)};if("line"===S)for(const u of bc(e.geometry,0,0,8192,8192)){const e=xc(u,_,w,n.vertical||m,r,24,v,t.overscaling,8192);for(const n of e){const e=m;e&&jc(t,e.text,T,n)||I(u,n)}}else if("line-center"===S){for(const u of e.geometry)if(u.length>1){const t=_c(u,w,n.vertical||m,r,24,v);t&&I(u,t)}}else if("Polygon"===e.type)for(const u of Is(e.geometry,0)){const t=Lc(u,16);I(u[0],new fc(t.x,t.y,0))}else if("LineString"===e.type)for(const u of e.geometry)I(u,new fc(u[0].x,u[0].y,0));else if("Point"===e.type)for(const u of e.geometry)for(const t of u)I([t],new fc(t.x,t.y,0))}function Fc(t,e,n,i,o,a,s,l,c,u,h,p,d,f,m){const g=function(t,e,n,i,o,a,s,l){const c=i.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,u=[];for(const h of e.positionedLines)for(const t of h.positionedGlyphs){if(!t.rect)continue;const i=t.rect||{};let a=4,p=!0,d=1,f=0;const m=(o||l)&&t.vertical,g=t.metrics.advance*t.scale/2;if(l&&e.verticalizable){const e=24*(t.scale-1),n=(24-t.metrics.width*t.scale)/2;f=h.lineOffset/2-(t.imageName?-n:e)}if(t.imageName){const e=s[t.imageName];p=e.sdf,d=e.pixelRatio,a=1/d}const y=o?[t.x+g,t.y]:[0,0];let v=o?[0,0]:[t.x+g+n[0],t.y+n[1]-f],_=[0,0];m&&(_=v,v=[0,0]);const x=(t.metrics.left-a)*t.scale-g+v[0],b=(-t.metrics.top-a)*t.scale+v[1],w=x+i.w*t.scale/d,M=b+i.h*t.scale/d,E=new r(x,b),S=new r(w,b),T=new r(x,M),A=new r(w,M);if(m){const e=new r(-g,g- -17),n=-Math.PI/2,i=12-g,o=new r(22-i,-(t.imageName?i:0)),a=new r(..._);E._rotateAround(n,e)._add(o)._add(a),S._rotateAround(n,e)._add(o)._add(a),T._rotateAround(n,e)._add(o)._add(a),A._rotateAround(n,e)._add(o)._add(a)}if(c){const t=Math.sin(c),e=Math.cos(c),n=[e,-t,t,e];E._matMult(n),S._matMult(n),T._matMult(n),A._matMult(n)}const C=new r(0,0),L=new r(0,0);u.push({tl:E,tr:S,bl:T,br:A,tex:i,writingMode:e.writingMode,glyphOffset:y,sectionIndex:t.sectionIndex,isSDF:p,pixelOffsetTL:C,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}return u}(0,n,l,o,a,s,i,t.allowVerticalPlacement),y=t.textSizeData;let v=null;"source"===y.kind?(v=[128*o.layout.get("text-size").evaluate(s,{},m)],v[0]>32640&&C(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".')):"composite"===y.kind&&(v=[128*f.compositeTextSizes[0].evaluate(s,{},m),128*f.compositeTextSizes[1].evaluate(s,{},m)],(v[0]>32640||v[1]>32640)&&C(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".')),t.addSymbols(t.text,g,v,l,a,s,u,e,c.lineStartIndex,c.lineLength,d,m);for(const r of h)p[r]=t.text.placedSymbolArray.length-1;return 4*g.length}function zc(t){for(const e in t)return t[e];return null}function Bc(t,e,n,i,o,a,s,l,c){let h=a.top,p=a.bottom,d=a.left,f=a.right;const m=a.collisionPadding;if(m&&(d-=m[0],h-=m[1],f+=m[2],p+=m[3]),c){const t=new r(d,h),e=new r(f,h),n=new r(d,p),i=new r(f,p),o=u(c);t._rotate(o),e._rotate(o),n._rotate(o),i._rotate(o),d=Math.min(t.x,e.x,n.x,i.x),f=Math.max(t.x,e.x,n.x,i.x),h=Math.min(t.y,e.y,n.y,i.y),p=Math.max(t.y,e.y,n.y,i.y)}return t.emplaceBack(e.x,e.y,d,h,f,p,l,n,i,o),t.length-1}function Uc(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function jc(t,e,n,r){const i=t.compareText;if(e in i){const t=i[e];for(let e=t.length-1;e>=0;e--)if(r.dist(t[e])<n)return!0}else i[e]=[];return i[e].push(r),!1}const Gc=Zs.VectorTileFeature.types,Vc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hc(t,e,n,r,i,o,a,s,l,c,u,h,p){const d=s?Math.min(32640,Math.round(s[0])):0,f=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*r),Math.round(32*i),o,a,(d<<1)+(l?1:0),f,16*c,16*u,256*h,256*p)}function Wc(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function qc(t){for(const e of t.sections)if(oi(e.text))return!0;return!1}class Xc{constructor(t){this.layoutVertexArray=new ji,this.indexArray=new Zi,this.programConfigurations=t,this.segments=new jo,this.dynamicLayoutVertexArray=new Gi,this.opacityVertexArray=new Vi,this.placedSymbolArray=new ao}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ml.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,gl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Vc,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Wr("SymbolBuffers",Xc);class Zc{constructor(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new jo,this.collisionVertexArray=new Xi,this.collisionVertexArrayExt=new Gi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,yl.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,vl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wr("CollisionBuffers",Zc);class Yc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fa([]),this.placementViewportMatrix=fa([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bl(this.zoom,e["text-size"]),this.iconSizeData=bl(this.zoom,e["icon-size"]);const n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map(t=>Ql[t])),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=t.sourceID}createArrays(){this.text=new Xc(new No(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Xc(new No(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new co,this.lineVertexArray=new uo,this.symbolInstances=new lo}calculateGlyphDependencies(t,e,n,r,i){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(n||r)&&i){const n=Tl[t.charAt(o)];n&&(e[n.charCodeAt(0)]=!0)}}populate(t,e,n){const r=this.layers[0],i=r.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),l=("constant"!==a.value.kind||a.value.value instanceof ue&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),c="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,u=i.get("symbol-sort-key");if(this.features=[],!l&&!c)return;const h=e.iconDependencies,p=e.glyphDependencies,d=e.availableImages,f=new mi(this.zoom);for(const{feature:m,id:g,index:y,sourceLayerIndex:v}of t){const t=r._featureFilter.needGeometry,e=Wo(m,t);if(!r._featureFilter.filter(f,e,n))continue;let a,s;if(t||(e.geometry=Ho(m)),l){const t=r.getValueAndResolveTokens("text-field",e,n,d),i=ue.factory(t);qc(i)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===pi()||this.hasRTLText&&fi.isParsed())&&(a=Sl(i,r,e))}if(c){const t=r.getValueAndResolveTokens("icon-image",e,n,d);s=t instanceof he?t:he.fromString(t)}if(!a&&!s)continue;const _=this.sortFeaturesByKey?u.evaluate(e,{},n):void 0;if(this.features.push({id:g,text:a,icon:s,index:y,sourceLayerIndex:v,geometry:e.geometry,properties:m.properties,type:Gc[m.type],sortKey:_}),s&&(h[s.name]=!0),a){const t=o.evaluate(e,{},n).join(","),r="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ql.vertical)>=0;for(const e of a.sections)if(e.image)h[e.image.name]=!0;else{const n=Kr(a.toString()),i=e.fontStack||t,o=p[i]=p[i]||{};this.calculateGlyphDependencies(e.text,o,r,this.allowVerticalPlacement,n)}}}"line"===i.get("symbol-placement")&&(this.features=function(t){const e={},n={},r=[];let i=0;function o(e){r.push(t[e]),i++}function a(t,e,i){const o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(t,n,i){const o=e[n];return delete e[n],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function l(t,e,n){const r=n?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,p=u.text?u.text.toString():null;if(!p){o(c);continue}const d=l(p,h),f=l(p,h,!0);if(d in n&&f in e&&n[d]!==e[f]){const t=s(d,f,h),i=a(d,f,r[t].geometry);delete e[d],delete n[f],n[l(p,r[i].geometry,!0)]=i,r[t].geometry=null}else d in n?a(d,f,h):f in e?s(d,f,h):(o(c),e[d]=i-1,n[f]=i-1)}return r.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}update(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const n=this.lineVertexArray.length;if(void 0!==t.segment){let n=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]);const i={};for(let o=t.segment+1;o<e.length;o++)i[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:n},o<e.length-1&&(n+=e[o+1].dist(e[o]));for(let o=t.segment||0;o>=0;o--)i[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:r},o>0&&(r+=e[o-1].dist(e[o]));for(let t=0;t<e.length;t++){const e=i[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,e,n,r,i,o,a,s,l,c,u,h){const p=t.indexArray,d=t.layoutVertexArray,f=t.segments.prepareSegment(4*e.length,d,p,this.canOverlap?o.sortKey:void 0),m=this.glyphOffsetArray.length,g=f.vertexLength,y=this.allowVerticalPlacement&&a===Ql.vertical?Math.PI/2:0,v=o.text&&o.text.sections;for(let _=0;_<e.length;_++){const{tl:r,tr:i,bl:a,br:l,tex:c,pixelOffsetTL:u,pixelOffsetBR:m,minFontScaleX:g,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:M}=e[_],E=f.vertexLength,S=b[1];Hc(d,s.x,s.y,r.x,S+r.y,c.x,c.y,n,w,u.x,u.y,g,x),Hc(d,s.x,s.y,i.x,S+i.y,c.x+c.w,c.y,n,w,m.x,u.y,g,x),Hc(d,s.x,s.y,a.x,S+a.y,c.x,c.y+c.h,n,w,u.x,m.y,g,x),Hc(d,s.x,s.y,l.x,S+l.y,c.x+c.w,c.y+c.h,n,w,m.x,m.y,g,x),Wc(t.dynamicLayoutVertexArray,s,y),p.emplaceBack(E,E+1,E+2),p.emplaceBack(E+1,E+2,E+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),_!==e.length-1&&M===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(d.length,o,o.index,{},h,v&&v[M])}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,l,c,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,u)}_commitLayoutVertex(t,e,n,r,i){t.emplaceBack(e.x,e.y,n,r,Math.round(i.x),Math.round(i.y))}_addCollisionDebugVertices(t,e,n,i,o){const a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),s=a.vertexLength,l=o.anchorX,c=o.anchorY;for(let r=0;r<4;r++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(e,-t.padding,-t.padding),n.collisionVertexArrayExt.emplaceBack(e,t.padding,-t.padding),n.collisionVertexArrayExt.emplaceBack(e,t.padding,t.padding),n.collisionVertexArrayExt.emplaceBack(e,-t.padding,t.padding),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(t.x1,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(t.x2,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(t.x2,t.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,l,c,new r(t.x1,t.y2)),a.vertexLength+=4;const u=n.indexArray;u.emplaceBack(s,s+1),u.emplaceBack(s+1,s+2),u.emplaceBack(s+2,s+3),u.emplaceBack(s+3,s),a.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,n,r,i,o){for(let a=r;a<i;a++){const r=n.get(a),i=this.getSymbolInstanceTextSize(t,o,e,a);this._addCollisionDebugVertices(r,i,this.textCollisionBox,r.anchorPoint,o)}}_addIconDebugCollisionBoxes(t,e,n,r,i,o){for(let a=r;a<i;a++){const r=n.get(a),i=this.getSymbolInstanceIconSize(t,e,a);this._addCollisionDebugVertices(r,i,this.iconCollisionBox,r.anchorPoint,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zc(Wi,_l.members,to),this.iconCollisionBox=new Zc(Wi,_l.members,to);const n=Ml(this.iconSizeData,t),r=Ml(this.textSizeData,t);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,n,r){const i=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:r),o=wl(this.textSizeData,t,i)/24;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,n){const r=this.icon.placedSymbolArray.get(n),i=wl(this.iconSizeData,t,r);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(t,e,n){t.emplaceBack(e,-n,-n),t.emplaceBack(e,n,-n),t.emplaceBack(e,n,n),t.emplaceBack(e,-n,n)}_updateTextDebugCollisionBoxes(t,e,n,r,i,o){for(let a=r;a<i;a++){const r=n.get(a),i=this.getSymbolInstanceTextSize(t,o,e,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,r.padding)}}_updateIconDebugCollisionBoxes(t,e,n,r,i){for(let o=r;o<i;o++){const r=n.get(o),i=this.getSymbolInstanceIconSize(t,e,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,r.padding)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Ml(this.iconSizeData,t),r=Ml(this.textSizeData,t);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,n,r,i,o,a,s,l){const c={};for(let u=e;u<n;u++){const e=t.get(u);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let u=r;u<i;u++){const e=t.get(u);c.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalTextFeatureIndex=e.featureIndex;break}for(let u=o;u<a;u++){const e=t.get(u);c.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.iconFeatureIndex=e.featureIndex;break}for(let u=s;u<l;u++){const e=t.get(u);c.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalIconFeatureIndex=e.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const n=t.placedSymbolArray.get(e),r=n.vertexStartIndex+4*n.numGlyphs;for(let i=n.vertexStartIndex;i<r;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),n=Math.cos(t),r=[],i=[],o=[];for(let a=0;a<this.symbolInstances.length;++a){o.push(a);const t=this.symbolInstances.get(a);r.push(0|Math.round(e*t.anchorX+n*t.anchorY)),i.push(t.featureIndex)}return o.sort((t,e)=>r[t]-r[e]||i[e]-i[t]),o}addToSortKeyRanges(t,e){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((t,e,n)=>{t>=0&&n.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)}),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Wr("SymbolBucket",Yc,{omit:["layers","collisionBoxArray","features","compareText"]}),Yc.MAX_GLYPHS=65535,Yc.addDynamicAttributes=Wc;const $c=new Li({"symbol-placement":new Ei(Nt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ei(Nt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ei(Nt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Si(Nt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ei(Nt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ei(Nt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ei(Nt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ei(Nt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ei(Nt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Si(Nt.layout_symbol["icon-size"]),"icon-text-fit":new Ei(Nt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ei(Nt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Si(Nt.layout_symbol["icon-image"]),"icon-rotate":new Si(Nt.layout_symbol["icon-rotate"]),"icon-padding":new Ei(Nt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ei(Nt.layout_symbol["icon-keep-upright"]),"icon-offset":new Si(Nt.layout_symbol["icon-offset"]),"icon-anchor":new Si(Nt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ei(Nt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ei(Nt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ei(Nt.layout_symbol["text-rotation-alignment"]),"text-field":new Si(Nt.layout_symbol["text-field"]),"text-font":new Si(Nt.layout_symbol["text-font"]),"text-size":new Si(Nt.layout_symbol["text-size"]),"text-max-width":new Si(Nt.layout_symbol["text-max-width"]),"text-line-height":new Ei(Nt.layout_symbol["text-line-height"]),"text-letter-spacing":new Si(Nt.layout_symbol["text-letter-spacing"]),"text-justify":new Si(Nt.layout_symbol["text-justify"]),"text-radial-offset":new Si(Nt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ei(Nt.layout_symbol["text-variable-anchor"]),"text-anchor":new Si(Nt.layout_symbol["text-anchor"]),"text-max-angle":new Ei(Nt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ei(Nt.layout_symbol["text-writing-mode"]),"text-rotate":new Si(Nt.layout_symbol["text-rotate"]),"text-padding":new Ei(Nt.layout_symbol["text-padding"]),"text-keep-upright":new Ei(Nt.layout_symbol["text-keep-upright"]),"text-transform":new Si(Nt.layout_symbol["text-transform"]),"text-offset":new Si(Nt.layout_symbol["text-offset"]),"text-allow-overlap":new Ei(Nt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ei(Nt.layout_symbol["text-ignore-placement"]),"text-optional":new Ei(Nt.layout_symbol["text-optional"])});var Jc={paint:new Li({"icon-opacity":new Si(Nt.paint_symbol["icon-opacity"]),"icon-color":new Si(Nt.paint_symbol["icon-color"]),"icon-halo-color":new Si(Nt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Si(Nt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Si(Nt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ei(Nt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ei(Nt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Si(Nt.paint_symbol["text-opacity"]),"text-color":new Si(Nt.paint_symbol["text-color"],{runtimeType:Xt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Si(Nt.paint_symbol["text-halo-color"]),"text-halo-width":new Si(Nt.paint_symbol["text-halo-width"]),"text-halo-blur":new Si(Nt.paint_symbol["text-halo-blur"]),"text-translate":new Ei(Nt.paint_symbol["text-translate"]),"text-translate-anchor":new Ei(Nt.paint_symbol["text-translate-anchor"])}),layout:$c};class Kc{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Vt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wr("FormatSectionOverride",Kc,{omit:["defaultValue"]});class Qc extends zo{constructor(t){super(t,Jc)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const n of t)e.indexOf(n)<0&&e.push(n);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,n,r){const i=this.layout.get(t).evaluate(e,{},n,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Kn(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(e,n)=>n in t?String(t[n]):"")}(e.properties,i)}createBucket(t){return new Yc(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Jc.paint.overridableProperties){if(!Qc.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),n=new Kc(e),r=new Jn(n,e.property.specification);let i=null;i="constant"===e.value.kind||"source"===e.value.kind?new tr("source",r):new er("composite",r,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new wi(e.property,i,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven())&&Qc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const n=t.get("text-field"),r=Jc.paint.properties[e];let i=!1;const o=t=>{for(const e of t)if(r.overrides&&r.overrides.hasOverride(e))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof ue)o(n.value.value.sections);else if("source"===n.value.kind){const t=e=>{i||(e instanceof ge&&fe(e.value)===Jt?o(e.value.sections):e instanceof xe?o(e.sections):e.eachChild(t))},e=n.value;e._styleExpression&&t(e._styleExpression.expression)}return i}getProgramConfiguration(t){return new Do(this,t)}}var tu={paint:new Li({"background-color":new Ei(Nt.paint_background["background-color"]),"background-pattern":new Ai(Nt.paint_background["background-pattern"]),"background-opacity":new Ei(Nt.paint_background["background-opacity"])})},eu={paint:new Li({"raster-opacity":new Ei(Nt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ei(Nt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ei(Nt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ei(Nt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ei(Nt.paint_raster["raster-saturation"]),"raster-contrast":new Ei(Nt.paint_raster["raster-contrast"]),"raster-resampling":new Ei(Nt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ei(Nt.paint_raster["raster-fade-duration"])})};class nu extends zo{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var ru={paint:new Li({"sky-type":new Ei(Nt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ei(Nt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ei(Nt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ei(Nt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ei(Nt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ci(Nt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ei(Nt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ei(Nt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ei(Nt.paint_sky["sky-opacity"])})};function iu(t,e,n){const r=xa(0,0,1),i=Da(Oa());return function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);t[0]=r*l-o*s,t[1]=i*l+a*s,t[2]=o*l+r*s,t[3]=a*l-i*s}(i,i,n?-u(t)+Math.PI:u(t)),Na(i,i,-u(e)),Ca(r,r,i),Sa(r,r)}const ou={circle:class extends zo{constructor(t){super(t,ha)}createBucket(t){return new Xo(t)}queryRadius(t){const e=t;return aa("circle-radius",this,e)+aa("circle-stroke-width",this,e)+sa(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,r,i,o,a,s){const l="map"===this.paint.get("circle-pitch-alignment");if(l&&t.queryGeometry.isAboveHorizon)return!1;const c=ca(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),h=l?u*t.pixelToTileUnitsFactor:u;for(const p of r)for(const e of p){const n=e.add(c),r=s&&o.elevation?o.elevation.exaggeration()*s.getElevationAt(n.x,n.y,!0):0,i=l?n:za(n,r,a),u=l?t.tilespaceRays.map(t=>ja(t,r)):t.queryGeometry.screenGeometry;let p=h;const d=Ra([],[e.x,e.y,r,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?p*=d[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(p*=o.cameraToCenterDistance/d[3]),Yo(u,i,p))return!0}return!1}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Do(this,t)}},heatmap:class extends zo{createBucket(t){return new Ga(t)}constructor(t){super(t,Za),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ya({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Do(this,t)}},hillshade:class extends zo{constructor(t){super(t,$a)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new Do(this,t)}},fill:class extends zo{constructor(t){super(t,ks)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new Do(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ds(t)}queryRadius(){return sa(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,r,i,o){return!t.queryGeometry.isAboveHorizon&&$o(la(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends zo{constructor(t){super(t,el)}createBucket(t){return new Qs(t)}queryRadius(){return sa(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Do(this,t)}queryIntersectsFeature(t,e,n,i,o,a,s){const l=ca(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,t.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(e,n),u=this.paint.get("fill-extrusion-base").evaluate(e,n),h=t.queryGeometry.screenGeometry,p=function(t,e,n,i,o){const a=[],s=[],l=o[8]*e,c=o[9]*e,u=o[10]*e,h=o[11]*e,p=o[8]*n,d=o[9]*n,f=o[10]*n,m=o[11]*n;for(const g of t){const t=[],e=[];for(const n of g){const a=n.x+i.x,s=n.y+i.y,g=o[0]*a+o[4]*s+o[12],y=o[1]*a+o[5]*s+o[13],v=o[2]*a+o[6]*s+o[14],_=o[3]*a+o[7]*s+o[15],x=v+u,b=_+h,w=g+p,M=y+d,E=v+f,S=_+m,T=new r((g+l)/b,(y+c)/b);T.z=x/b,t.push(T);const A=new r(w/S,M/S);A.z=E/S,e.push(A)}a.push(t),s.push(e)}return[a,s]}(i,u,c,l,s);return function(t,e,n){let r=1/0;$o(n,e)&&(r=rl(n,e[0]));for(let i=0;i<e.length;i++){const o=e[i],a=t[i];for(let t=0;t<o.length-1;t++){const e=o[t],i=[e,o[t+1],a[t+1],a[t],e];Zo(n,i)&&(r=Math.min(r,rl(n,i)))}}return r!==1/0&&r}(p[0],p[1],h)}},line:class extends zo{constructor(t){super(t,pl),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof $e,this.gradientVersion=(this.gradientVersion+1)%s)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=dl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new ul(t)}getProgramIds(){const t=this.paint.get("line-dasharray"),e=this.paint.get("line-pattern").constantOr(1),n=this.paint.get("line-gradient");return[e?"linePattern":t?"lineSDF":n?"lineGradient":"line"]}getProgramConfiguration(t){return new Do(this,t)}queryRadius(t){const e=t,n=fl(aa("line-width",this,e),aa("line-gap-width",this,e)),r=aa("line-offset",this,e);return n/2+Math.abs(r)+sa(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,o,a){if(t.queryGeometry.isAboveHorizon)return!1;const s=la(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,t.pixelToTileUnitsFactor),l=t.pixelToTileUnitsFactor/2*fl(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(i=function(t,e){const n=[],i=new r(0,0);for(let r=0;r<t.length;r++){const o=t[r],a=[];for(let t=0;t<o.length;t++){const n=o[t-1],r=o[t],s=o[t+1],l=0===t?i:r.sub(n)._unit()._perp(),c=t===o.length-1?i:s.sub(r)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),a.push(u._mult(e)._add(r))}n.push(a)}return n}(i,c*t.pixelToTileUnitsFactor)),function(t,e,n){for(let r=0;r<e.length;r++){const i=e[r];if(t.length>=3)for(let e=0;e<i.length;e++)if(ra(t,i[e]))return!0;if(Jo(t,i,n))return!0}return!1}(s,i,l)}isTileClipped(){return!0}},symbol:Qc,background:class extends zo{constructor(t){super(t,tu)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends zo{constructor(t){super(t,eu)}getProgramIds(){return["raster"]}},sky:class extends zo{constructor(t){super(t,ru),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ya({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const n=this.paint.get("sky-type");if("atmosphere"===n){const n=this.paint.get("sky-atmosphere-sun"),r=!n,i=t.style.light,o=i.properties.get("position");return r&&"viewport"===i.properties.get("anchor")&&C("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?iu(o.azimuthal,90-o.polar,e):iu(n[0],90-n[1],e)}if("gradient"===n){const t=this.paint.get("sky-gradient-center");return iu(t[0],90-t[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}},{HTMLImageElement:au,HTMLCanvasElement:su,HTMLVideoElement:lu,ImageData:cu,ImageBitmap:uu}=o;class hu{constructor(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)}update(t,e,n){const{width:r,height:i}=t,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),{context:a}=this,{gl:s}=a;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[r,i],t instanceof au||t instanceof su||t instanceof lu||t instanceof cu||uu&&t instanceof uu?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{const{x:e,y:o}=n||{x:0,y:0};t instanceof au||t instanceof su||t instanceof lu||t instanceof cu||uu&&t instanceof uu?s.texSubImage2D(s.TEXTURE_2D,0,e,o,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,e,o,r,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)}bind(t,e,n){const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),n!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=i.LINEAR),t!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class pu{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const du=o.performance;class fu{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},du.mark(this._marks.start)}finish(){du.mark(this._marks.end);let t=du.getEntriesByName(this._marks.measure);return 0===t.length&&(du.measure(this._marks.measure,this._marks.start,this._marks.end),t=du.getEntriesByName(this._marks.measure),du.clearMarks(this._marks.start),du.clearMarks(this._marks.end),du.clearMeasures(this._marks.measure)),t}}class mu{constructor(){this.tasks={},this.taskQueue=[],w(["process"],this),this.invoker=new pu(this.process),this.nextId=0}add(t,e){const n=this.nextId++;return this.tasks[n]={fn:t,metadata:e,priority:gu(e),id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){P();try{if(this.taskQueue=this.taskQueue.filter(t=>!!this.tasks[t]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let r=0;r<this.taskQueue.length;r++){const n=this.tasks[this.taskQueue[r]];n.priority<e&&(e=n.priority,t=r)}if(null===t)return null;const n=this.taskQueue[t];return this.taskQueue.splice(t,1),n}remove(){this.invoker.remove()}}function gu({type:t,isSymbolTile:e,zoom:n}){return n=n||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-n:"maybePrepare"===t&&e?400-n:500:200-n:100-n}class yu{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof vu?new vu(t.lng,t.lat):vu.convert(t),this}setSouthWest(t){return this._sw=t instanceof vu?new vu(t.lng,t.lat):vu.convert(t),this}extend(t){const e=this._sw,n=this._ne;let r,i;if(t instanceof vu)r=t,i=t;else{if(!(t instanceof yu))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(yu.convert(t)):this.extend(vu.convert(t)):this;if(r=t._sw,i=t._ne,!r||!i)return this}return e||n?(e.lng=Math.min(r.lng,e.lng),e.lat=Math.min(r.lat,e.lat),n.lng=Math.max(i.lng,n.lng),n.lat=Math.max(i.lat,n.lat)):(this._sw=new vu(r.lng,r.lat),this._ne=new vu(i.lng,i.lat)),this}getCenter(){return new vu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vu(this.getWest(),this.getNorth())}getSouthEast(){return new vu(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:n}=vu.convert(t);let r=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&r}static convert(t){return!t||t instanceof yu?t:new yu(t)}}class vu{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vu(m(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))}toBounds(t=0){const e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new yu(new vu(this.lng-n,this.lat-e),new vu(this.lng+n,this.lat+e))}static convert(t){if(t instanceof vu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new vu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new vu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _u=2*Math.PI*6371008.8;function xu(t){return _u*Math.cos(t*Math.PI/180)}function bu(t){return(180+t)/360}function wu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Mu(t,e){return t/xu(e)}function Eu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Su(t,e){return t*xu(Eu(e))}class Tu{constructor(t,e,n=0){this.x=+t,this.y=+e,this.z=+n}static fromLngLat(t,e=0){const n=vu.convert(t);return new Tu(bu(n.lng),wu(n.lat),Mu(e,n.lat))}toLngLat(){return new vu(360*this.x-180,Eu(this.y))}toAltitude(){return Su(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/_u*(t=Eu(this.y),1/Math.cos(t*Math.PI/180));var t}}function Au(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Cu{constructor(t,e,n){this.z=t,this.x=e,this.y=n,this.key=Pu(0,t,t,e,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const n=(i=this.y,o=this.z,a=Au(256*(r=this.x),256*(i=Math.pow(2,o)-i-1),o),s=Au(256*(r+1),256*(i+1),o),a[0]+","+a[1]+","+s[0]+","+s[1]);var r,i,o,a,s;const l=function(t,e,n){let r,i="";for(let o=t;o>0;o--)r=1<<o-1,i+=(e&r?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",n)}getTilePoint(t){const e=Math.pow(2,this.z);return new r(8192*(t.x*e-this.x),8192*(t.y*e-this.y))}getTileVec3(t){const e=Math.pow(2,this.z);return xa(8192*(t.x*e-this.x),8192*(t.y*e-this.y),Su(t.z,t.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Lu{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Pu(t,e.z,e.z,e.x,e.y)}}class Iu{constructor(t,e,n,r,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Cu(n,+r,+i),this.key=0===e&&t===n?this.canonical.key:Pu(e,t,n,r,i)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new Iu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Iu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return Pu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-t;return Pu(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Iu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Iu(e,this.wrap,e,n,r),new Iu(e,this.wrap,e,n+1,r),new Iu(e,this.wrap,e,n,r+1),new Iu(e,this.wrap,e,n+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Iu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Iu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Tu(t.x-this.wrap,t.y))}getTileVec3(t){return this.canonical.getTileVec3(new Tu(t.x-this.wrap,t.y,t.z))}}function Pu(t,e,n,r,i){const o=1<<Math.min(n,22);let a=o*(i%o)+r%o;return t&&n<22&&(a+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*a+n)+(e-n)}Wr("CanonicalTileID",Cu),Wr("OverscaledTileID",Iu,{omit:["posMatrix"]});class Ru{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Ou{constructor(t,e,n,r,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=r,this.properties=t.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}var Du=Di([{name:"a_pos",type:"Int16",components:2}]);class Nu{constructor(t,e,n){this.tileID=t,this.uid=_(),this.uses=0,this.tileSize=e,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<U.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const n={};if(!e)return n;for(const r of t){const t=r.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){r.layers=t,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)n[e.id]=r}}return n}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Yc){if(this.hasSymbolBuckets=!0,!n)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Yc&&e.hasRTLText){this.hasRTLText=!0,fi.isLoading()||fi.isLoaded()||"deferred"!==pi()||di();break}}this.queryPadding=0;for(const t in this.buckets){const n=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(t).queryRadius(n))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new io}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const n in this.buckets){const e=this.buckets[n];e.uploadPending()&&e.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hu(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hu(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,n,r,i,o,a,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:a,transform:o,params:i},t,e,n):{}}querySourceFeatures(t,e){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const r=n.loadVTLayers(),i=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(!o)return;const a=pr(e&&e.filter),{z:s,x:l,y:c}=this.tileID.canonical,u={z:s,x:l,y:c};for(let h=0;h<o.length;h++){const e=o.feature(h);if(a.needGeometry){const t=Wo(e,!0);if(!a.filter(new mi(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!a.filter(new mi(this.tileID.overscaledZ),e))continue;const r=n.getId(e,i),p=new Ou(e,s,l,c,r);p.tile=u,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=R(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let n=!1;if(this.expirationTime>t)n=!1;else if(e)if(this.expirationTime<e)n=!0;else{const r=this.expirationTime-e;r?this.expirationTime=t+Math.max(r,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){if(!e.style.hasLayer(r))continue;const i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=t[o];if(!a||!s||0===Object.keys(s).length)continue;i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(i)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<U.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=U.now()+t}setDependencies(t,e){const n={};for(const r of e)n[r]=!0;this.dependencies[t]=n}hasDependency(t,e){for(const n of t){const t=this.dependencies[n];if(t)for(const n of e)if(t[n])return!0}return!1}clearQueryDebugViz(){}}class ku{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,n){const r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},y(this.stateChanges[t][r],n),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])n[e]||(this.deletedStates[t][r][e]=null)}else for(const i in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][i]&&delete this.deletedStates[t][r][i]}removeFeatureState(t,e,n){if(null===this.deletedStates[t])return;const r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(n in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][n]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}getState(t,e){const n=String(e),r=y({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const n=this.deletedStates[t][e];if(null===n)return{};for(const t in n)delete r[t]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const n={};for(const r in this.stateChanges){this.state[r]=this.state[r]||{};const t={};for(const e in this.stateChanges[r])this.state[r][e]||(this.state[r][e]={}),y(this.state[r][e],this.stateChanges[r][e]),t[e]=this.state[r][e];n[r]=t}for(const r in this.deletedStates){this.state[r]=this.state[r]||{};const t={};if(null===this.deletedStates[r])for(const e in this.state[r])t[e]={},this.state[r][e]={};else for(const e in this.deletedStates[r]){if(null===this.deletedStates[r][e])this.state[r][e]={};else for(const t of Object.keys(this.deletedStates[r][e]))delete this.state[r][e][t];t[e]=this.state[r][e]}n[r]=n[r]||{},y(n[r],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const r in t)t[r].setFeatureState(n,e)}}class Fu{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const n=this.toIdx(t,e);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function zu(t,e,n,r){let i=0,o=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(r[a])<1e-15){if(n[a]<t[a]||n[a]>e[a])return null}else{const s=1/r[a];let l=(t[a]-n[a])*s,c=(e[a]-n[a])*s;if(l>c){const t=l;l=c,c=t}if(l>i&&(i=l),c<o&&(o=c),i>o)return null}return i}function Bu(t,e,n,r,i,o,a,s,l,c,u){const h=r-t,p=i-e,d=o-n,f=a-t,m=s-e,g=l-n,y=u[1]*g-u[2]*m,v=u[2]*f-u[0]*g,_=u[0]*m-u[1]*f,x=h*y+p*v+d*_;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-t,M=c[1]-e,E=c[2]-n,S=(w*y+M*v+E*_)*b;if(S<0||S>1)return null;const T=M*d-E*p,A=E*h-w*d,C=w*p-M*h,L=(u[0]*T+u[1]*A+u[2]*C)*b;return L<0||S+L>1?null:(f*T+m*A+g*C)*b}function Uu(t,e,n){return(t-e)/(n-e)}function ju(t,e,n,r,i,o,a,s,l){const c=1<<n,u=o-r,h=a-i,p=(t+1)/c*u+r,d=(e+0)/c*h+i,f=(e+1)/c*h+i;s[0]=(t+0)/c*u+r,s[1]=d,l[0]=p,l[1]=f}class Gu{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),n=[];let r=Math.ceil(Math.pow(2,e));const i=1/r,o=(t,e,n,r,i)=>{const o=r?1:0,a=(t+1)*n-o,s=e*n,l=(e+1)*n-o;i[0]=t*n,i[1]=s,i[2]=a,i[3]=l};let a=new Fu(r);const s=[];for(let l=0;l<r*r;l++){o(l%r,Math.floor(l/r),i,!1,s);const e=Hu(s[0],s[1],t),n=Hu(s[2],s[1],t),c=Hu(s[2],s[3],t),u=Hu(s[0],s[3],t);a.minimums.push(Math.min(e,n,c,u)),a.maximums.push(Math.max(e,n,c,u)),a.leaves.push(1)}for(n.push(a),r/=2;r>=1;r/=2){const t=n[n.length-1];a=new Fu(r);for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),2,!0,s);const n=t.getElevation(s[0],s[1]),i=t.getElevation(s[2],s[1]),l=t.getElevation(s[2],s[3]),c=t.getElevation(s[0],s[3]),u=t.isLeaf(s[0],s[1]),h=t.isLeaf(s[2],s[1]),p=t.isLeaf(s[2],s[3]),d=t.isLeaf(s[0],s[3]),f=Math.min(n.min,i.min,l.min,c.min),m=Math.max(n.max,i.max,l.max,c.max),g=u&&h&&p&&d;a.maximums.push(m),a.minimums.push(f),a.leaves.push(m-f<=5&&g?1:0)}n.push(a)}return n}(this.dem),n=e.length-1,r=e[n];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(e,0,0,n,0)}raycastRoot(t,e,n,r,i,o,a=1){return zu([t,e,-100],[n,r,this.maximums[0]*a],i,o)}raycast(t,e,n,r,i,o,a=1){if(!this.nodeCount)return null;const s=this.raycastRoot(t,e,n,r,i,o,a);if(null==s)return null;const l=[],c=[],u=[],h=[],p=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:s,t:d,nodex:f,nodey:m,depth:g}=p.pop();if(this.leaves[s]){ju(f,m,g,t,e,n,r,u,h);const s=1<<g,l=(f+0)/s,c=(f+1)/s,p=(m+0)/s,y=(m+1)/s,v=Hu(l,p,this.dem)*a,_=Hu(c,p,this.dem)*a,x=Hu(c,y,this.dem)*a,b=Hu(l,y,this.dem)*a,w=Bu(u[0],u[1],v,h[0],u[1],_,h[0],h[1],x,i,o),M=Bu(h[0],h[1],x,u[0],h[1],b,u[0],u[1],v,i,o),E=Math.min(null!==w?w:Number.MAX_VALUE,null!==M?M:Number.MAX_VALUE);if(E!==Number.MAX_VALUE)return E;{const t=Ea([],i,o,d);if(Vu(v,_,b,x,Uu(t[0],u[0],h[0]),Uu(t[1],u[1],h[1]))>=t[2])return d}continue}let y=0;for(let p=0;p<this._siblingOffset.length;p++){ju((f<<1)+this._siblingOffset[p][0],(m<<1)+this._siblingOffset[p][1],g+1,t,e,n,r,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[s]+p]*a;const d=zu(u,h,i,o);if(null!=d){const t=d;l[p]=t;let e=!1;for(let n=0;n<y&&!e;n++)t>=l[c[n]]&&(c.splice(n,0,p),e=!0);e||(c[y]=p),y++}}for(let t=0;t<y;t++){const e=c[t];p.push({idx:this.childOffsets[s]+e,t:l[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,n){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,n,r,i){if(1===t[r].isLeaf(e,n))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const o=r-1,a=t[o];let s,l=0;for(let c=0;c<this._siblingOffset.length;c++){const t=2*e+this._siblingOffset[c][0],r=2*n+this._siblingOffset[c][1],i=a.getElevation(t,r),o=a.isLeaf(t,r),u=this._addNode(i.min,i.max,o);o&&(l|=1<<c),s||(s=u)}for(let c=0;c<this._siblingOffset.length;c++)l&1<<c||this._construct(t,2*e+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],o,s+c)}}function Vu(t,e,n,r,i,o){return Je(Je(t,n,o),Je(e,r,o),i)}function Hu(t,e,n){const r=n.dim,i=f(t*r-.5,0,r-1),o=f(e*r-.5,0,r-1),a=Math.floor(i),s=Math.floor(o),l=Math.min(a+1,r-1),c=Math.min(s+1,r-1);return Vu(n.get(a,s),n.get(l,s),n.get(a,c),n.get(l,c),i-a,o-s)}const Wu={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class qu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,n,r=!1,i=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return C(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const o=this.dim=e.height-2;if(this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox",this.borderReady=r,!r){for(let t=0;t<o;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(o,t)]=this.data[this._idx(o-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,o)]=this.data[this._idx(t,o-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(o,-1)]=this.data[this._idx(o-1,0)],this.data[this._idx(-1,o)]=this.data[this._idx(0,o-1)],this.data[this._idx(o,o)]=this.data[this._idx(o-1,o-1)],i&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Gu(this)}get(t,e){const n=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])}static getUnpackVector(t){return Wu[t]}get unpackVector(){return Wu[this.encoding]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,n){return(256*t*256+256*e+n)/10-1e4}_unpackTerrarium(t,e,n){return 256*t+e+n/256-32768}static pack(t,e){const n=[0,0,0,0],r=qu.getUnpackVector(e);let i=Math.floor((t+r[3])/r[2]);return n[2]=i%256,i=Math.floor(i/256),n[1]=i%256,i=Math.floor(i/256),n[0]=i,n}getPixels(){return new Xa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,i=e*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(e){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}const s=-e*this.dim,l=-n*this.dim;for(let c=o;c<a;c++)for(let e=r;e<i;e++)this.data[this._idx(e,c)]=t.data[this._idx(e+s,c+l)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Wr("DEMData",qu),Wr("DemMinMaxQuadTree",Gu,{omit:["dem"]});class Xu{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,n){const r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const i={value:e,timeout:void 0};if(void 0!==n&&(i.timeout=setTimeout(()=>{this.remove(t,i)},n)),this.data[r].push(i),this.order.push(r),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const n=t.wrapped().key,r=void 0===e?0:this.data[n].indexOf(e),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const n in this.data)for(const r of this.data[n])t(r.value)||e.push(r);for(const n of e)this.remove(n.value.tileID,n)}}class Zu{constructor(t,e,n){this.context=t;const r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $u{constructor(t,e,n,r){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;const i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let n=0;n<this.attributes.length;n++){const r=e.attributes[this.attributes[n].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,e,n){for(let r=0;r<this.attributes.length;r++){const i=this.attributes[r],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[Yu[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ju{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ku extends Ju{getDefault(){return se.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Qu extends Ju{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class th extends Ju{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class eh extends Ju{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class nh extends Ju{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class rh extends Ju{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ih extends Ju{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class oh extends Ju{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ah extends Ju{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class sh extends Ju{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class lh extends Ju{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class ch extends Ju{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class uh extends Ju{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class hh extends Ju{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ph extends Ju{getDefault(){return se.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class dh extends Ju{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class fh extends Ju{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class mh extends Ju{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class gh extends Ju{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class yh extends Ju{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class vh extends Ju{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class _h extends Ju{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class xh extends Ju{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class bh extends Ju{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wh extends Ju{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Mh extends Ju{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Eh extends Ju{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Sh extends Ju{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Th extends Ju{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ah extends Ju{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ch extends Ju{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Lh extends Ju{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Ih extends Lh{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ph extends Lh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Rh{constructor(t,e,n,r){this.context=t,this.width=e,this.height=n;const i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Ih(t,i),r&&(this.depthAttachment=new Ph(t,i))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Oh{constructor(t,e,n){this.func=t,this.mask=e,this.range=n}}Oh.ReadOnly=!1,Oh.ReadWrite=!0,Oh.disabled=new Oh(519,Oh.ReadOnly,[0,1]);class Dh{constructor(t,e,n,r,i,o){this.test=t,this.ref=e,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o}}Dh.disabled=new Dh({func:519,mask:0},0,0,7680,7680,7680);class Nh{constructor(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n}}Nh.Replace=[1,0],Nh.disabled=new Nh(Nh.Replace,se.transparent,[!1,!1,!1,!1]),Nh.unblended=new Nh(Nh.Replace,se.transparent,[!0,!0,!0,!0]),Nh.alphaBlended=new Nh([1,771],se.transparent,[!0,!0,!0,!0]);class kh{constructor(t,e,n){this.enable=t,this.mode=e,this.frontFace=n}}kh.disabled=new kh(!1,1029,2305),kh.backCCW=new kh(!0,1029,2305),kh.backCW=new kh(!0,1029,2304),kh.frontCW=new kh(!0,1028,2304),kh.frontCCW=new kh(!0,1028,2305);class Fh extends Dt{constructor(t,e,n){super(),this.id=t,this._onlySymbols=n,e.on("data",t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),e.on("error",()=>{this._sourceErrored=!0}),this._source=e,this._tiles={},this._cache=new Xu(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ku}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}}getIds(){return g(this._tiles).map(t=>t.tileID).sort(zh).map(t=>t.key)}getRenderableIds(t){const e=[];for(const n in this._tiles)this._isIdRenderable(+n,t)&&e.push(this._tiles[n]);return t?e.sort((t,e)=>{const n=t.tileID,i=e.tileID,o=new r(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),a=new r(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||a.y-o.y||a.x-o.x}).map(t=>t.tileID.key):e.map(t=>t.tileID).sort(zh).map(t=>t.key)}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))}_tileLoaded(t,e,n,r){if(r)return t.state="errored",void(404!==r.status?this._source.fire(new Ot(r,{tile:t})):this.update(this.transform));t.timeAdded=U.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Rt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let r=0;r<e.length;r++){const i=e[r];if(t.neighboringTiles&&t.neighboringTiles[i]){const e=this.getTileByID(i);n(t,e),n(e,t)}}function n(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let n=e.tileID.canonical.x-t.tileID.canonical.x;const r=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,n,r){for(const i in this._tiles){let o=this._tiles[i];if(r[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)continue;let a=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(a=t)}let s=a;for(;s.overscaledZ>e;)if(s=s.scaledTo(s.overscaledZ-1),t[s.key]){r[a.key]=a;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(let n=t.overscaledZ-1;n>=e;n--){const e=t.scaledTo(n),r=this._getLoadedTile(e);if(r)return r}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const n=Math.ceil(t.width/e)+1,r=Math.ceil(t.height/e)+1,i=Math.floor(n*r*5),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(o)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const n in this._tiles){const r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,e,n){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let r;this.updateCacheSize(t,e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new Iu(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(r=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,useElevationData:!!this.transform.elevation&&!this.usedForTerrain}),this._source.hasTile&&(r=r.filter(t=>this._source.hasTile(t)))):r=[];const i=this._updateRetainedTiles(r);if(Bh(this._source.type)&&0!==r.length){const t={},e={},n=Object.keys(i);for(const r of n){const n=i[r],o=this._tiles[r];if(!o||o.fadeEndTime&&o.fadeEndTime<=U.now())continue;const a=this.findLoadedParent(n,Math.max(n.overscaledZ-Fh.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),t[a.tileID.key]=a.tileID),e[r]=n}const o=r[r.length-1].overscaledZ;for(const r in this._tiles){const t=this._tiles[r];if(i[r]||!t.hasData())continue;let n=t.tileID;for(;n.overscaledZ>o;){n=n.scaledTo(n.overscaledZ-1);const o=this._tiles[n.key];if(o&&o.hasData()&&e[n.key]){i[r]=t.tileID;break}}}for(const r in t)i[r]||(this._coveredTiles[r]=!0,i[r]=t[r])}for(const a in i)this._tiles[a].clearFadeHold();const o=function(t,e){const n=[];for(const r in t)r in e||n.push(r);return n}(this._tiles,i);for(const a of o){const t=this._tiles[a];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+a)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const n={},r=t[t.length-1].overscaledZ,i=t[0].overscaledZ,o=Math.max(i-Fh.maxOverzooming,this._source.minzoom),a=Math.max(i+Fh.maxUnderzooming,this._source.minzoom),s={};for(const l of t){const t=this._addTile(l);e[l.key]=l,t.hasData()||r<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,r,a,e);for(const l of t){let t=this._tiles[l.key];if(t.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const t=l.children(this._source.maxzoom)[0],n=this.getTile(t);if(n&&n.hasData()){e[t.key]=t;continue}}else{const t=l.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let r=t.wasRequested();for(let i=l.overscaledZ-1;i>=o;--i){const o=l.scaledTo(i);if(n[o.key])break;if(n[o.key]=!0,t=this.getTile(o),!t&&r&&(t=this._addTile(o)),t&&(e[o.key]=o,r=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let n,r=this._tiles[t].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}e.push(r.key);const t=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(t),n)break;r=t}for(const t of e)this._loadedParentTiles[t]=n}}_addTile(t){let e=this._tiles[t.key];if(e)return e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const n=Boolean(e);return n||(e=new Nu(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,n||this._source.fire(new Rt("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},n))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._cache.reset()}tilesIn(t,e,n){const r=[],i=this.transform;if(!i)return r;for(const o in this._tiles){const a=this._tiles[o];if(n&&a.clearQueryDebugViz(),a.holdingForFade())continue;const s=t.containsTile(a,i,e);s&&r.push(s)}return r}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map(t=>this._tiles[t].tileID);for(const n of e)n.posMatrix=this.transform.calculatePosMatrix(n.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(Bh(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=U.now())return!0}return!1}setFeatureState(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)}removeFeatureState(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,n){const r=this._tiles[t];r&&r.setDependencies(e,n)}reloadTilesForDependencies(t,e){for(const n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(t,e))}}function zh(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Bh(t){return"raster"===t||"image"===t||"video"===t}Fh.maxOverzooming=10,Fh.maxUnderzooming=3;class Uh{constructor(t,e,n){this._dem=t,this._scale=e,this._offset=n}static create(t,e,n){const r=n||t.findDEMTileFor(e);if(!r||!r.dem)return;const i=r.dem,o=r.tileID,a=1<<e.canonical.z-o.canonical.z;return new Uh(i,r.tileSize/8192/a,[(e.canonical.x/a-o.canonical.x)*i.dim,(e.canonical.y/a-o.canonical.y)*i.dim])}getElevationAt(t,e,n){const r=t*this._scale+this._offset[0],i=e*this._scale+this._offset[1],o=Math.floor(r),a=Math.floor(i),s=this._dem;return n?Je(Je(s.get(o,a),s.get(o,a+1),i-a),Je(s.get(o+1,a),s.get(o+1,a+1),i-a),r-o):s.get(o,a)}}class jh{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ur(8192,16,0),this.featureIndexArray=new po,this.promoteId=e}insert(t,e,n,r,i){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);const a=this.grid;for(let s=0;s<e.length;s++){const t=e[s],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const r=t[e];n[0]=Math.min(n[0],r.x),n[1]=Math.min(n[1],r.y),n[2]=Math.max(n[2],r.x),n[3]=Math.max(n[3],r.y)}n[0]<8192&&n[1]<8192&&n[2]>=0&&n[3]>=0&&a.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Zs.VectorTile(new Ll(this.rawTileData)).layers,this.sourceLayerCoder=new Ru(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,n,r){this.loadVTLayers();const i=t.params||{},o=pr(i.filter),a=t.tileResult,s=t.transform,l=a.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,(t,e,n,r)=>ia(a.bufferedTilespaceGeometry,t,e,n,r));c.sort(Vh);let u=null;s.elevation&&c.length>0&&(u=Uh.create(s.elevation,this.tileID));const h={};let p;for(let d=0;d<c.length;d++){const s=c[d];if(s===p)continue;p=s;const l=this.featureIndexArray.get(s);let f=null;this.loadMatchingFeature(h,l.bucketIndex,l.sourceLayerIndex,l.featureIndex,o,i.layers,i.availableImages,e,n,r,(e,n,r)=>(f||(f=Ho(e)),n.queryIntersectsFeature(a,e,r,f,this.z,t.transform,t.pixelPosMatrix,u)))}return h}loadMatchingFeature(t,e,n,r,i,o,a,s,l,c,u){const h=this.bucketLayerIDs[e];if(o&&!function(t,e){for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,h))return;const p=this.sourceLayerCoder.decode(n),d=this.vtLayers[p].feature(r);if(i.needGeometry){const t=Wo(d,!0);if(!i.filter(new mi(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new mi(this.tileID.overscaledZ),d))return;const f=this.getId(d,p);for(let m=0;m<h.length;m++){const e=h[m];if(o&&o.indexOf(e)<0)continue;const n=s[e];if(!n)continue;let i={};void 0!==f&&c&&(i=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const p=y({},l[e]);p.paint=Gh(p.paint,n.paint,d,i,a),p.layout=Gh(p.layout,n.layout,d,i,a);const g=!u||u(d,n,i);if(!g)continue;const v=new Ou(d,this.z,this.x,this.y,f);v.layer=p;let _=t[e];void 0===_&&(_=t[e]=[]),_.push({featureIndex:r,feature:v,intersectionZ:g})}}lookupSymbolFeatures(t,e,n,r,i,o,a,s){const l={};this.loadVTLayers();const c=pr(i);for(const u of t)this.loadMatchingFeature(l,n,r,u,c,o,a,s,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const n of e)if(t===n)return!0;return!1}getId(t,e){let n=t.id;return this.promoteId&&(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof n&&(n=Number(n))),n}}function Gh(t,e,n,r,i){return E(t,(t,o)=>{const a=e instanceof Mi?e.get(o):null;return a&&a.evaluate?a.evaluate(n,r,i):a})}function Vh(t,e){return e-t}Wr("FeatureIndex",jh,{omit:["rawTileData","sourceLayerCoder"]});class Hh{constructor(t){const e={},n=[];for(const a in t){const r=t[a],i=e[a]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const o={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};n.push(o),i[t]={rect:o,metrics:e.metrics}}}const{w:r,h:i}=$l(n),o=new qa({width:r||1,height:i||1});for(const a in t){const n=t[a];for(const t in n){const r=n[+t];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const i=e[a][t].rect;qa.copy(r.bitmap,o,{x:0,y:0},{x:i.x+1,y:i.y+1},r.bitmap)}}this.image=o,this.positions=e}}Wr("GlyphAtlas",Hh);class Wh{constructor(t){this.tileID=new Iu(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile}parse(t,e,n,r,i){this.status="parsing",this.data=t,this.collisionBoxArray=new io;const o=new Ru(Object.keys(t.layers).sort()),a=new jh(this.tileID,this.promoteId);a.bucketLayerIDs=[];const s={},l={featureIndex:a,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},c=e.familiesBySource[this.source];for(const g in c){const e=t.layers[g];if(!e)continue;let r=!1,i=!1;for(const t of c[g])"symbol"===t[0].type?r=!0:i=!0;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!i)continue;1===e.version&&C(`Vector tile source "${this.source}" layer "${g}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const u=o.encode(g),h=[];for(let t=0;t<e.length;t++){const n=e.feature(t),r=a.getId(n,g);h.push({feature:n,id:r,index:t,sourceLayerIndex:u})}for(const t of c[g]){const e=t[0];void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(qh(t,this.zoom,n),(s[e.id]=e.createBucket({index:a.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:u,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(h,l,this.tileID.canonical),a.bucketLayerIDs.push(t.map(t=>t.id)))}}let u,h,p,d;const f={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},m=E(l.glyphDependencies,t=>Object.keys(t).map(Number));Object.keys(m).length?r.send("getGlyphs",{uid:this.uid,stacks:m},(t,e)=>{u||(u=t,h=e,_.call(this))},void 0,void 0,f):h={};const y=Object.keys(l.iconDependencies);y.length?r.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},(t,e)=>{u||(u=t,p=e,_.call(this))},void 0,void 0,f):p={};const v=Object.keys(l.patternDependencies);function _(){if(u)return i(u);if(h&&p&&d){const t=new Hh(h),e=new Kl(p,d);for(const r in s){const i=s[r];i instanceof Yc?(qh(i.layers,this.zoom,n),Dc(i,h,t.positions,p,e.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):i.hasPattern&&(i instanceof ul||i instanceof Ds||i instanceof Qs)&&(qh(i.layers,this.zoom,n),i.addFeatures(l,this.tileID.canonical,e.patternPositions))}this.status="done",i(null,{buckets:g(s).filter(t=>!t.isEmpty()),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:e,glyphMap:this.returnDependencies?h:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?t.positions:null})}}v.length?r.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},(t,e)=>{u||(u=t,d=e,_.call(this))},void 0,void 0,f):d={},_.call(this)}}function qh(t,e,n){const r=new mi(e);for(const i of t)i.recalculate(r,n)}class Xh{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,r){const i=this.entries[t]=this.entries[t]||{callbacks:[]};if(i.result){const[t,n]=i.result;return this.scheduler?this.scheduler.add(()=>{r(t,n)},e):r(t,n),()=>{}}return i.callbacks.push(r),i.cancel||(i.cancel=n((n,r)=>{i.result=[n,r];for(const t of i.callbacks)this.scheduler?this.scheduler.add(()=>{t(n,r)},e):t(n,r);setTimeout(()=>delete this.entries[t],3e3)})),()=>{i.result||(i.callbacks=i.callbacks.filter(t=>t!==r),i.callbacks.length||(i.cancel(),delete this.entries[t]))}}}function Zh(t,e,n){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},e=>{const r=wt(t.request,(t,r,i,o)=>{t?e(t):r&&e(null,{vectorTile:n?void 0:new Zs.VectorTile(new Ll(r)),rawData:r,cacheControl:i,expires:o})});return()=>{r.cancel(),e()}},e)}t.AUTH_ERR_MSG="NO_ACCESS_TOKEN",t.Aabb=Fa,t.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},w(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=P()?t:o,this.scheduler=new mu}send(t,e,n,r,i=!1,o){const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[a]=n);const s=k(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Zr(e,s)},s),{cancel:()=>{n&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[n];delete this.cancelCallbacks[n],t&&t.cancel()}else if(P()||e.mustQueue){const t=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),t&&t.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Yr(e.error)):n(null,Yr(e.data)))}else{const n=k(this.globalScope)?void 0:[],r=e.hasCallback?(e,r)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?Zr(e):null,data:Zr(r,n)},n)}:t=>{},i=Yr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,i,r);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],i.source)[t[1]](i,r)}else r(new Error("Could not find function "+e.type))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.AlphaImage=qa,t.CanonicalTileID=Cu,t.Color=se,t.ColorMode=Nh,t.Context=class{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ku(this),this.clearDepth=new Qu(this),this.clearStencil=new th(this),this.colorMask=new eh(this),this.depthMask=new nh(this),this.stencilMask=new rh(this),this.stencilFunc=new ih(this),this.stencilOp=new oh(this),this.stencilTest=new ah(this),this.depthRange=new sh(this),this.depthTest=new lh(this),this.depthFunc=new ch(this),this.blend=new uh(this),this.blendFunc=new hh(this),this.blendColor=new ph(this),this.blendEquation=new dh(this),this.cullFace=new fh(this),this.cullFaceSide=new mh(this),this.frontFace=new gh(this),this.program=new yh(this),this.activeTexture=new vh(this),this.viewport=new _h(this),this.bindFramebuffer=new xh(this),this.bindRenderbuffer=new bh(this),this.bindTexture=new wh(this),this.bindVertexBuffer=new Mh(this),this.bindElementBuffer=new Eh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Sh(this),this.pixelStoreUnpack=new Th(this),this.pixelStoreUnpackPremultiplyAlpha=new Ah(this),this.pixelStoreUnpackFlipY=new Ch(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new Zu(this,t,e)}createVertexBuffer(t,e,n){return new $u(this,t,e,n)}createRenderbuffer(t,e,n){const r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),i}createFramebuffer(t,e,n){return new Rh(this,t,e,n)}clear({color:t,depth:e,stencil:n}){const r=this.gl;let i=0;t&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==n&&(i|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),r.clear(i)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a(t.blendFunction,Nh.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}},t.CullFaceMode=kh,t.DEMData=qu,t.DataConstantProperty=Ei,t.DedupedRequest=Xh,t.DepthMode=Oh,t.DepthStencilAttachment=class extends Ph{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}},t.EXTENT=8192,t.Elevation=class{getAtPoint(t,e=0){const n=this._source();if(!n)return e;if(t.y<0||t.y>1)return e;const r=n.getSource().maxzoom,i=1<<r,o=Math.floor(t.x),a=t.x-o,s=new Iu(r,o,r,Math.floor(a*i),Math.floor(t.y*i)),l=this.findDEMTileFor(s);if(!l||!l.dem)return e;const c=l.dem,u=1<<l.tileID.canonical.z,h=(a*u-l.tileID.canonical.x)*c.dim,p=(t.y*u-l.tileID.canonical.y)*c.dim,d=Math.floor(h),f=Math.floor(p);return this.exaggeration()*Je(Je(c.get(d,f),c.get(d,f+1),p-f),Je(c.get(d+1,f),c.get(d+1,f+1),p-f),h-d)}getAtTileOffset(t,e,n){const r=1<<t.canonical.z;return this.getAtPoint(new Tu(t.wrap+(t.canonical.x+e/8192)/r,(t.canonical.y+n/8192)/r))}getForTilePoints(t,e,n,r){const i=Uh.create(this,t,r);return!!i&&(e.forEach(t=>{t[2]=this.exaggeration()*i.getElevationAt(t[0],t[1],n)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,r=e.tileID,i=1<<t.canonical.z-r.canonical.z;let o=t.canonical.x/i-r.canonical.x,a=t.canonical.y/i-r.canonical.y,s=0;for(let l=0;l<t.canonical.z-r.canonical.z&&!n.leaves[s];l++){o*=2,a*=2;const t=2*Math.floor(a)+Math.floor(o);s=n.childOffsets[s]+t,o%=1,a%=1}return{min:this.exaggeration()*n.minimums[s],max:this.exaggeration()*n.maximums[s]}}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=Ot,t.EvaluationParameters=mi,t.Event=Rt,t.Evented=Dt,t.Frustum=ka,t.ImagePosition=Jl,t.LngLat=vu,t.LngLatBounds=yu,t.MAX_SAFE_INTEGER=s,t.MercatorCoordinate=Tu,t.ONE_EM=24,t.OverscaledTileID=Iu,t.Point=r,t.Point$1=r,t.Properties=Li,t.RGBAImage=Xa,t.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,n){const r=Ta(e,this.dir);if(Math.abs(r)<1e-6)return!1;const i=Ta(Ia(ya(),t,this.pos),e)/r;return function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]}(n,Ea(ya(),this.pos,this.dir,i)),!0}},t.RequestManager=class{constructor(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Y,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!$(t))return t;const n=Q(t);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!$(t))return t;const n=Q(t);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!$(t))return t;const n=Q(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,r){const i=Q(t);return $(t)?(i.path=`/styles/v1${i.path}/sprite${e}${n}`,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=`${e}${n}`,tt(i))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!$(t))return t;const r=Q(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==r.authority&&512===n?"@2x":""}${V.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${G.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${G.TILE_URL_VERSION}${r.path}`);const i=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(r.params)||G.ACCESS_TOKEN;return G.REQUIRE_ACCESS_TOKEN&&i&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,i)}canonicalizeTileURL(t,e){const n=Q(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let r="mapbox://";n.path.match(/^\/raster\/v1\//)?r+="raster/"+n.path.replace(`/${G.RASTER_URL_PREFIX}/`,""):r+="tiles/"+n.path.replace(`/${G.TILE_URL_VERSION}/`,"");let i=n.params;return e&&(i=i.filter(t=>!t.match(/^access_token=/))),i.length&&(r+="?"+i.join("&")),r}canonicalizeTileset(t,e){const n=!!e&&$(e),r=[];for(const i of t.tiles||[])J(i)?r.push(this.canonicalizeTileURL(i,n)):r.push(i);return r}_makeAPIURL(t,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=Q(G.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!G.REQUIRE_ACCESS_TOKEN)return tt(t);if(!(e=e||G.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params=t.params.filter(t=>-1===t.indexOf("access_token")),t.params.push("access_token="+e),tt(t)}},t.RequestPerformance=fu,t.ResourceType=vt,t.SegmentVector=jo,t.SourceCache=Fh,t.StencilMode=Dh,t.StructArrayLayout1ui2=eo,t.StructArrayLayout2f1f2i16=qi,t.StructArrayLayout2i4=ki,t.StructArrayLayout3f12=Gi,t.StructArrayLayout3ui6=Zi,t.StructArrayLayout4i8=Fi,t.Texture=hu,t.Tile=Nu,t.Transitionable=vi,t.Uniform1f=Mo,t.Uniform1i=class extends wo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.Uniform2f=class extends wo{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.Uniform3f=class extends wo{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.Uniform4f=Eo,t.UniformColor=So,t.UniformMatrix3f=class extends wo{constructor(t,e){super(t,e),this.current=Ao}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},t.UniformMatrix4f=class extends wo{constructor(t,e){super(t,e),this.current=To}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.UnwrappedTileID=Lu,t.ValidationError=kt,t.VectorTileWorkerSource=class{constructor(t,e,n,r){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=r||Zh,this.loading={},this.loaded={},this.deduped=new Xh(t.scheduler)}loadTile(t,e){const n=t.uid,r=!!(t&&t.request&&t.request.collectResourceTiming)&&new fu(t.request),i=this.loading[n]=new Wh(t);i.abort=this.loadVectorData(t,(t,o)=>{const a=!this.loading[n];if(delete this.loading[n],a||t||!o)return i.status="done",a||(this.loaded[n]=i),e(t);const s=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);const c={};if(r){const t=r.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}i.vectorTile=o.vectorTile||new Zs.VectorTile(new Ll(s)),i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,n)=>{if(t||!n)return e(t);e(null,y({rawTileData:s.slice(0)},n,l,c))}),this.loaded=this.loaded||{},this.loaded[n]=i})}reloadTile(t,e){const n=this.loaded,r=t.uid,i=this;if(n&&n[r]){const o=n[r];o.showCollisionBoxes=t.showCollisionBoxes,o.enableTerrain=!!t.enableTerrain;const a=(t,n)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,i.layerIndex,this.availableImages,i.actor,r)),e(t,n)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}}abortTile(t,e){const n=t.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,r=t.uid;n&&n[r]&&delete n[r],e()}},t.WritingMode=Ql,t.ZoomHistory=$r,t.add=ba,t.addDynamicAttributes=Wc,t.altitudeFromMercatorZ=Su,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);let r=t.length;const i=new Array(t.length);let o=null;t.forEach((t,a)=>{e(t,(t,e)=>{t&&(o=t),i[a]=e,0==--r&&n(o,i)})})},t.bezier=p,t.bindAll=w,t.browser=U,t.bufferConvexPolygon=function(t,e){const n=[];for(let r=0;r<t.length;r++){const i=m(r-1,-1,t.length-1),o=m(r+1,-1,t.length-1),a=t[r],s=t[o],l=t[i].sub(a).unit(),c=s.sub(a).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));n.push(a.add(h))}return n},t.cacheEntryPossiblyAdded=function(t){gt++,gt>pt&&(t.getActor().send("enforceCacheSizeLimit",ht),gt=0)},t.clamp=f,t.clearTileCache=function(t){const e=o.caches.delete("mapbox-tiles");t&&e.catch(t).then(()=>t())},t.clipLine=bc,t.clone=function(t){var e=new pa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=T,t.collisionCircleLayout=xl,t.config=G,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.create=function(){var t=new pa(16);return pa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=da,t.create$2=function(){var t=new pa(4);return pa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createExpression=Qn,t.createLayout=Di,t.createStyleLayer=function(t){return"custom"===t.type?new nu(t):new ou[t.type](t)},t.cross=Aa,t.deepEqual=a,t.degToRad=u,t.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},t.dot=Ta,t.ease=d,t.easeCubicInOut=h,t.emitValidationErrors=Br,t.endsWith=M,t.enforceCacheSizeLimit=function(t){dt(),ct&&ct.then(e=>{e.keys().then(n=>{for(let r=0;r<n.length-t;r++)e.delete(n[r])})})},t.evaluateSizeForFeature=wl,t.evaluateSizeForZoom=Ml,t.evaluateVariableOffset=Oc,t.evented=hi,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.extend=y,t.featureFilter=pr,t.filterObject=S,t.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,l=i+i,c=n*a,u=r*a,h=r*s,p=i*a,d=i*s,f=i*l,m=o*a,g=o*s,y=o*l;return t[0]=1-h-f,t[1]=u+y,t[2]=p-g,t[3]=0,t[4]=u-y,t[5]=1-c-f,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=uc,t.getAnchorJustification=Nc,t.getArrayBuffer=wt,t.getBounds=function(t){let e=1/0,n=1/0,i=-1/0,o=-1/0;for(const r of t)e=Math.min(e,r.x),n=Math.min(n,r.y),i=Math.max(i,r.x),o=Math.max(o,r.y);return{min:new r(e,n),max:new r(i,o)}},t.getImage=Lt,t.getJSON=function(t,e){return bt(y(t,{type:"json"}),e)},t.getMapSessionAPI=lt,t.getRTLTextPluginStatus=pi,t.getReferrer=xt,t.getVideo=function(t,e){const n=o.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let r=0;r<t.length;r++){const e=o.document.createElement("source");St(t[r])||(n.crossOrigin="Anonymous"),e.src=t[r],n.appendChild(e)}return{cancel:()=>{}}},t.identity=fa,t.identity$1=Da,t.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],v=n*s-r*a,_=n*l-i*a,x=n*c-o*a,b=r*l-i*s,w=r*c-o*s,M=i*c-o*l,E=u*m-h*f,S=u*g-p*f,T=u*y-d*f,A=h*g-p*m,C=h*y-d*m,L=p*y-d*g,I=v*L-_*C+x*A+b*T-w*S+M*E;return I?(t[0]=(s*L-l*C+c*A)*(I=1/I),t[1]=(i*C-r*L-o*A)*I,t[2]=(m*M-g*w+y*b)*I,t[3]=(p*w-h*M-d*b)*I,t[4]=(l*T-a*L-c*S)*I,t[5]=(n*L-i*T+o*S)*I,t[6]=(g*x-f*M-y*_)*I,t[7]=(u*M-p*x+d*_)*I,t[8]=(a*C-s*T+c*E)*I,t[9]=(r*T-n*C-o*E)*I,t[10]=(f*w-m*x+y*v)*I,t[11]=(h*x-u*w-d*v)*I,t[12]=(s*S-a*A-l*E)*I,t[13]=(n*A-r*S+i*E)*I,t[14]=(m*_-f*b-g*v)*I,t[15]=(u*b-h*_+p*v)*I,t):null},t.isChar=Jr,t.isMapboxURL=$,t.latFromMercatorY=Eu,t.len=Pa,t.length=_a,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.loadVectorTile=Zh,t.makeRequest=bt,t.mercatorXfromLng=bu,t.mercatorYfromLat=wu,t.mercatorZfromAltitude=Mu,t.mul=ga,t.mul$1=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},t.multiply=ma,t.mvt=Zs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=Sa,t.normalize$1=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t},t.number=Je,t.offscreenCanvasSupported=yt,t.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),l=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*l,t[14]=(a+o)*c,t[15]=1,t},t.parseGlyphPBF=function(t){return new Ll(t).readFields(Xl,[])},t.pbf=Ll,t.perspective=function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+r)*(o=1/(r-i)),t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){const n={};for(let r=0;r<e.length;r++){const i=e[r];i in t&&(n[i]=t[i])}return n},t.plugin=fi,t.polygonIntersectsBox=ia,t.polygonIntersectsPolygon=Zo,t.polygonizeBounds=function(t,e,n=0){const i=new r(n,n),o=t.sub(i),a=e.add(i);return[o,new r(a.x,o.y),a,new r(o.x,a.y),o]},t.posAttributes=Du,t.postMapLoadEvent=at,t.postTurnstileEvent=it,t.potpack=$l,t.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.radToDeg=function(t){return t*c},t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(t){return t({pluginStatus:si,pluginURL:li}),hi.on("pluginStateChange",t),t},t.renderColorRamp=Ya,t.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+o*s,t[1]=i*l+a*s,t[2]=r*-s+o*l,t[3]=i*-s+a*l,t},t.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+u*r,t[6]=s*i+h*r,t[7]=l*i+p*r,t[8]=c*i-o*r,t[9]=u*i-a*r,t[10]=h*i-s*r,t[11]=p*i-l*r,t},t.rotateX$1=Na,t.rotateY=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=a*i-u*r,t[2]=s*i-h*r,t[3]=l*i-p*r,t[8]=o*r+c*i,t[9]=a*r+u*i,t[10]=s*r+h*i,t[11]=l*r+p*i,t},t.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+u*r,t[2]=s*i+h*r,t[3]=l*i+p*r,t[4]=c*i-o*r,t[5]=u*i-a*r,t[6]=h*i-s*r,t[7]=p*i-l*r,t},t.rotateZ$1=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*s,t[1]=i*l-r*s,t[2]=o*l+a*s,t[3]=a*l-o*s,t},t.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scale$2=Ma,t.scaleAndAdd=Ea,t.setCacheLimits=function(t,e){ht=t,pt=e},t.setRTLTextPlugin=function(t,e,n=!1){if("deferred"===si||"loading"===si||"loaded"===si)throw new Error("setRTLTextPlugin cannot be called multiple times.");li=U.resolveURL(t),si="deferred",ai=e,ui(),n||di()},t.styleSpec=Nt,t.sub=Ia,t.subtract=wa,t.symbolSize=El,t.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},t.transformMat4=Ra,t.transformQuat=Ca,t.translate=function(t,e,n){var r,i,o,a,s,l,c,u,h,p,d,f,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=r=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=r*m+s*g+h*y+e[12],t[13]=i*m+l*g+p*y+e[13],t[14]=o*m+c*g+d*y+e[14],t[15]=a*m+u*g+f*y+e[15]),t},t.triggerPluginCompletionEvent=ci,t.uniqueId=_,t.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateLight=kr,t.validateStyle=Nr,t.values=g,t.vectorTile=Zs,t.version="2.0.1",t.warnOnce=C,t.webpSupported=V,t.window=o,t.wrap=m})),r(["./shared"],(function(t){function e(t){const n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){let n="[";for(const r of t)n+=e(r)+",";return n+"]"}const r=Object.keys(t).sort();let i="{";for(let o=0;o<r.length;o++)i+=`${JSON.stringify(r[o])}:${e(t[r[o]])},`;return i+"}"}function n(n){let r="";for(const i of t.refProperties)r+="/"+e(n[i]);return r}class r{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,r){for(const n of e){this._layerConfigs[n.id]=n;const e=this._layers[n.id]=t.createStyleLayer(n);e._featureFilter=t.featureFilter(e.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const t of r)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const i=function(t,e){const r={};for(let o=0;o<t.length;o++){const i=e&&e[t[o].id]||n(t[o]);e&&(e[t[o].id]=i);let a=r[i];a||(a=r[i]=[]),a.push(t[o])}const i=[];for(const n in r)i.push(r[n]);return i}(t.values(this._layerConfigs),this.keyCache);for(const t of i){const e=t.map(t=>this._layers[t.id]),n=e[0];if("none"===n.visibility)continue;const r=n.source||"";let i=this.familiesBySource[r];i||(i=this.familiesBySource[r]={});const o=n.sourceLayer||"_geojsonTileLayer";let a=i[o];a||(a=i[o]=[]),a.push(e)}}}const{ImageBitmap:i}=t.window;class o{loadTile(e,n){const{uid:r,encoding:o,rawImageData:a,padding:s,buildQuadTree:l}=e,c=i&&a instanceof i?this.getImageData(a,s):a;n(null,new t.DEMData(r,c,o,s<1,l))}getImageData(e,n){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const r=this.offscreenCanvasContext.getImageData(-n,-n,e.width+2*n,e.height+2*n);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:r.width,height:r.height},r.data)}}function a(t,e){if(0!==t.length){s(t[0],e);for(var n=1;n<t.length;n++)s(t[n],!e)}}function s(t,e){for(var n=0,r=0,i=t.length,o=i-1;r<i;o=r++)n+=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]);n>=0!=!!e&&t.reverse()}const l=t.vectorTile.VectorTileFeature.prototype.toGeoJSON;class c{constructor(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const n of this._feature.geometry)e.push([new t.Point$1(n[0],n[1])]);return e}{const e=[];for(const n of this._feature.geometry){const r=[];for(const e of n)r.push(new t.Point$1(e[0],e[1]));e.push(r)}return e}}toGeoJSON(t,e,n){return l.call(this,t,e,n)}}class u{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e}feature(t){return new c(this._features[t])}}var h=t.vectorTile.VectorTileFeature,p=d;function d(t,e){this.options=e||{},this.features=t,this.length=t.length}function f(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}d.prototype.feature=function(t){return new f(this.features[t],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++)i.push(new t.Point$1(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),n=Math.max(n,l.x),r=Math.min(r,l.y),i=Math.max(i,l.y)}return[e,r,n,i]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=y,g=p;function y(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,v,t.layers[n])}(e,n),n.finish()}function v(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)r.feature=t.feature(n),e.writeMessage(2,_,r);var i=r.keys;for(n=0;n<i.length;n++)e.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)e.writeMessage(4,E,o[n])}function _(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,x,t),e.writeVarintField(3,n.type),e.writeMessage(4,M,n)}function x(t,e){var n=t.feature,r=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in n.properties){var l=o[s];void 0===l&&(r.push(s),o[s]=l=r.length-1),e.writeVarint(l);var c=n.properties[s],u=typeof c;"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,p=a[h];void 0===p&&(i.push(c),a[h]=p=i.length-1),e.writeVarint(p)}}function b(t,e){return(e<<3)+(7&t)}function w(t){return t<<1^t>>31}function M(t,e){for(var n=t.loadGeometry(),r=t.type,i=0,o=0,a=n.length,s=0;s<a;s++){var l=n[s],c=1;1===r&&(c=l.length),e.writeVarint(b(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&e.writeVarint(b(2,u-1));var p=l[h].x-i,d=l[h].y-o;e.writeVarint(w(p)),e.writeVarint(w(d)),i+=p,o+=d}3===r&&e.writeVarint(b(7,1))}}function E(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function S(t,e,n,r){T(t,n,r),T(e,2*n,2*r),T(e,2*n+1,2*r+1)}function T(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function A(t,e,n,r){const i=t-n,o=e-r;return i*i+o*o}m.fromVectorTileJs=y,m.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var r in t)n[r]=new p(t[r].features,e),n[r].name=r,n[r].version=e.version,n[r].extent=e.extent;return y({layers:n})},m.GeoJSONWrapper=g;const C=t=>t[0],L=t=>t[1];class I{constructor(t,e=C,n=L,r=64,i=Float64Array){this.nodeSize=r,this.points=t;const o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length);for(let l=0;l<t.length;l++)a[l]=l,s[2*l]=e(t[l]),s[2*l+1]=n(t[l]);!function t(e,n,r,i,o,a){if(o-i<=r)return;const s=i+o>>1;!function t(e,n,r,i,o,a){for(;o>i;){if(o-i>600){const s=o-i+1,l=r-i+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);t(e,n,r,Math.max(i,Math.floor(r-l*u/s+h)),Math.min(o,Math.floor(r+(s-l)*u/s+h)),a)}const s=n[2*r+a];let l=i,c=o;for(S(e,n,i,r),n[2*o+a]>s&&S(e,n,i,o);l<c;){for(S(e,n,l,c),l++,c--;n[2*l+a]<s;)l++;for(;n[2*c+a]>s;)c--}n[2*i+a]===s?S(e,n,i,c):(c++,S(e,n,c,o)),c<=r&&(i=c+1),r<=c&&(o=c-1)}}(e,n,s,i,o,a%2),t(e,n,r,i,s-1,a+1),t(e,n,r,s+1,o,a+1)}(a,s,r,0,a.length-1,0)}range(t,e,n,r){return function(t,e,n,r,i,o,a){const s=[0,t.length-1,0],l=[];let c,u;for(;s.length;){const h=s.pop(),p=s.pop(),d=s.pop();if(p-d<=a){for(let a=d;a<=p;a++)c=e[2*a],u=e[2*a+1],c>=n&&c<=i&&u>=r&&u<=o&&l.push(t[a]);continue}const f=Math.floor((d+p)/2);c=e[2*f],u=e[2*f+1],c>=n&&c<=i&&u>=r&&u<=o&&l.push(t[f]);const m=(h+1)%2;(0===h?n<=c:r<=u)&&(s.push(d),s.push(f-1),s.push(m)),(0===h?i>=c:o>=u)&&(s.push(f+1),s.push(p),s.push(m))}return l}(this.ids,this.coords,t,e,n,r,this.nodeSize)}within(t,e,n){return function(t,e,n,r,i,o){const a=[0,t.length-1,0],s=[],l=i*i;for(;a.length;){const c=a.pop(),u=a.pop(),h=a.pop();if(u-h<=o){for(let i=h;i<=u;i++)A(e[2*i],e[2*i+1],n,r)<=l&&s.push(t[i]);continue}const p=Math.floor((h+u)/2),d=e[2*p],f=e[2*p+1];A(d,f,n,r)<=l&&s.push(t[p]);const m=(c+1)%2;(0===c?n-i<=d:r-i<=f)&&(a.push(h),a.push(p-1),a.push(m)),(0===c?n+i>=d:r+i>=f)&&(a.push(p+1),a.push(u),a.push(m))}return s}(this.ids,this.coords,t,e,n,this.nodeSize)}}const P={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t};class R{constructor(t){this.options=U(Object.create(P),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:n,maxZoom:r,nodeSize:i}=this.options;e&&console.time("total time");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;let a=[];for(let s=0;s<t.length;s++)t[s].geometry&&a.push(D(t[s],s));this.trees[r+1]=new I(a,j,G,i,Float32Array),e&&console.timeEnd(o);for(let s=r;s>=n;s--){const t=+Date.now();a=this._cluster(a,s),this.trees[s]=new I(a,j,G,i,Float32Array),e&&console.log("z%d: %d clusters in %dms",s,a.length,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let n=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let i=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){const t=this.getClusters([n,r,180,o],e),a=this.getClusters([-180,r,i,o],e);return t.concat(a)}const a=this.trees[this._limitZoom(e)],s=a.range(F(n),z(o),F(i),z(r)),l=[];for(const c of s){const t=a.points[c];l.push(t.numPoints?N(t):this.points[t.index])}return l}getChildren(t){const e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);const o=i.points[e];if(!o)throw new Error(r);const a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=i.within(o.x,o.y,a),l=[];for(const c of s){const e=i.points[c];e.parentId===t&&l.push(e.numPoints?N(e):this.points[e.index])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,n){const r=[];return this._appendLeaves(r,t,e=e||10,n=n||0,0),r}getTile(t,e,n){const r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),{extent:o,radius:a}=this.options,s=a/o,l=(n-s)/i,c=(n+1+s)/i,u={features:[]};return this._addTileFeatures(r.range((e-s)/i,l,(e+1+s)/i,c),r.points,e,n,i,u),0===e&&this._addTileFeatures(r.range(1-s/i,l,1,c),r.points,i,n,i,u),e===i-1&&this._addTileFeatures(r.range(0,l,s/i,c),r.points,-1,n,i,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e}_appendLeaves(t,e,n,r,i){const o=this.getChildren(e);for(const a of o){const e=a.properties;if(e&&e.cluster?i+e.point_count<=r?i+=e.point_count:i=this._appendLeaves(t,e.cluster_id,n,r,i):i<r?i++:t.push(a),t.length===n)break}return i}_addTileFeatures(t,e,n,r,i,o){for(const a of t){const t=e[a],s=t.numPoints,l={type:1,geometry:[[Math.round(this.options.extent*(t.x*i-n)),Math.round(this.options.extent*(t.y*i-r))]],tags:s?k(t):this.points[t.index].properties};let c;s?c=t.id:this.options.generateId?c=t.index:this.points[t.index].id&&(c=this.points[t.index].id),void 0!==c&&(l.id=c),o.features.push(l)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const n=[],{radius:r,extent:i,reduce:o,minPoints:a}=this.options,s=r/(i*Math.pow(2,e));for(let l=0;l<t.length;l++){const r=t[l];if(r.zoom<=e)continue;r.zoom=e;const i=this.trees[e+1],c=i.within(r.x,r.y,s),u=r.numPoints||1;let h=u;for(const t of c){const n=i.points[t];n.zoom>e&&(h+=n.numPoints||1)}if(h>=a){let t=r.x*u,a=r.y*u,s=o&&u>1?this._map(r,!0):null;const p=(l<<5)+(e+1)+this.points.length;for(const n of c){const l=i.points[n];if(l.zoom<=e)continue;l.zoom=e;const c=l.numPoints||1;t+=l.x*c,a+=l.y*c,l.parentId=p,o&&(s||(s=this._map(r,!0)),o(s,this._map(l)))}r.parentId=p,n.push(O(t/h,a/h,p,h,s))}else if(n.push(r),h>1)for(const t of c){const r=i.points[t];r.zoom<=e||(r.zoom=e,n.push(r))}}return n}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?U({},t.properties):t.properties;const n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?U({},r):r}}function O(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function D(t,e){const[n,r]=t.geometry.coordinates;return{x:F(n),y:z(r),zoom:1/0,index:e,parentId:-1}}function N(t){return{type:"Feature",id:t.id,properties:k(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),B(t.y)]}};var e}function k(t){const e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return U(U({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function F(t){return t/360+.5}function z(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function B(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function U(t,e){for(const n in e)t[n]=e[n];return t}function j(t){return t.x}function G(t){return t.y}function V(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var l=((t-n)*a+(e-r)*s)/(a*a+s*s);l>1?(n=i,r=o):l>0&&(n+=a*l,r+=s*l)}return(a=t-n)*a+(s=e-r)*s}function H(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)W(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)W(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)W(t,e[r][i])}(i),i}function W(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function q(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],l=e.id;if(n.promoteId?l=e.properties[n.promoteId]:n.generateId&&(l=r||0),"Point"===o)X(i,s);else if("MultiPoint"===o)for(var c=0;c<i.length;c++)X(i[c],s);else if("LineString"===o)Z(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<i.length;c++)Z(i[c],s=[],a,!1),t.push(H(l,"LineString",s,e.properties));return}Y(i,s,a,!1)}else if("Polygon"===o)Y(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)q(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<i.length;c++){var u=[];Y(i[c],u,a,!0),s.push(u)}}t.push(H(l,o,s,e.properties))}}function X(t,e){e.push($(t[0])),e.push(J(t[1])),e.push(0)}function Z(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var l=$(t[s][0]),c=J(t[s][1]);e.push(l),e.push(c),e.push(0),s>0&&(a+=r?(i*c-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(c-o,2))),i=l,o=c}var u=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,a=i,s=r-n>>1,l=r-n,c=e[n],u=e[n+1],h=e[r],p=e[r+1],d=n+3;d<r;d+=3){var f=V(e[d],e[d+1],c,u,h,p);if(f>a)o=d,a=f;else if(f===a){var m=Math.abs(d-s);m<l&&(o=d,l=m)}}a>i&&(o-n>3&&t(e,n,o,i),e[o+2]=a,r-o>3&&t(e,o,r,i))}(e,0,u,n),e[u+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function Y(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];Z(t[i],o,n,r),e.push(o)}}function $(t){return t/360+.5}function J(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function K(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,p=u.type,d=0===i?u.minX:u.minY,f=0===i?u.maxX:u.maxY;if(d>=n&&f<r)l.push(u);else if(!(f<n||d>=r)){var m=[];if("Point"===p||"MultiPoint"===p)Q(h,m,n,r,i);else if("LineString"===p)tt(h,m,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===p)nt(h,m,n,r,i,!1);else if("Polygon"===p)nt(h,m,n,r,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var y=[];nt(h[g],y,n,r,i,!0),y.length&&m.push(y)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(H(u.id,p,m[g],u.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(H(u.id,p,m,u.tags))}}}return l.length?l:null}function Q(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function tt(t,e,n,r,i,o,a){for(var s,l,c=et(t),u=0===i?it:ot,h=t.start,p=0;p<t.length-3;p+=3){var d=t[p],f=t[p+1],m=t[p+2],g=t[p+3],y=t[p+4],v=0===i?d:f,_=0===i?g:y,x=!1;a&&(s=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-y,2))),v<n?_>n&&(l=u(c,d,f,g,y,n),a&&(c.start=h+s*l)):v>r?_<r&&(l=u(c,d,f,g,y,r),a&&(c.start=h+s*l)):rt(c,d,f,m),_<n&&v>=n&&(l=u(c,d,f,g,y,n),x=!0),_>r&&v<=r&&(l=u(c,d,f,g,y,r),x=!0),!o&&x&&(a&&(c.end=h+s*l),e.push(c),c=et(t)),a&&(h+=s)}var b=t.length-3;d=t[b],f=t[b+1],m=t[b+2],(v=0===i?d:f)>=n&&v<=r&&rt(c,d,f,m),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&rt(c,c[0],c[1],c[2]),c.length&&e.push(c)}function et(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function nt(t,e,n,r,i,o){for(var a=0;a<t.length;a++)tt(t[a],e,n,r,i,o,!1)}function rt(t,e,n,r){t.push(e),t.push(n),t.push(r)}function it(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function ot(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function at(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=st(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(st(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var l=[],c=0;c<o.geometry[s].length;c++)l.push(st(o.geometry[s][c],e));i.push(l)}n.push(H(o.id,a,i,o.tags))}return n}function st(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function lt(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var l=t.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(ct(c[r],c[r+1],e,o,a,s));else for(r=0;r<c.length;r++){var h=[];for(i=0;i<c[r].length;i+=2)h.push(ct(c[r][i],c[r][i+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function ct(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function ut(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,ht(a,t[s],o,i);var l=t[s].minX,c=t[s].minY,u=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),c<a.minY&&(a.minY=c),u>a.maxX&&(a.maxX=u),h>a.maxY&&(a.maxY=h)}return a}function ht(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)pt(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)pt(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var c=i[l];for(s=0;s<c.length;s++)pt(a,c[s],t,n,!0,0===s)}if(a.length){var u=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=i.start/i.size,u.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(p.id=e.id),t.features.push(p)}}function pt(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>a)&&(n.numSimplified++,s.push(e[l]),s.push(e[l+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function dt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)q(n,t.features[r],e,r);else q(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var n=e.buffer/e.extent,r=t,i=K(t,1,-1-n,n,0,-1,2,e),o=K(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=K(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=at(i,1).concat(r)),o&&(r=r.concat(at(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ft(t,e,n){return 32*((1<<t)*n+e)+t}function mt(t,e){const n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return e(null,null);const i=new u(r.features);let o=m(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}dt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},dt.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],l=this.options,c=l.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var u=1<<e,h=ft(e,n,r),p=this.tiles[h];if(!p&&(c>1&&console.time("creation"),p=this.tiles[h]=ut(t,e,n,r,l),this.tileCoords.push({z:e,x:n,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,i){if(e===l.maxZoom||e===i)continue;var f=1<<i-e;if(n!==Math.floor(o/f)||r!==Math.floor(a/f))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){c>1&&console.time("clipping");var m,g,y,v,_,x,b=.5*l.buffer/l.extent,w=.5-b,M=.5+b,E=1+b;m=g=y=v=null,_=K(t,u,n-b,n+M,0,p.minX,p.maxX,l),x=K(t,u,n+w,n+E,0,p.minX,p.maxX,l),t=null,_&&(m=K(_,u,r-b,r+M,1,p.minY,p.maxY,l),g=K(_,u,r+w,r+E,1,p.minY,p.maxY,l),_=null),x&&(y=K(x,u,r-b,r+M,1,p.minY,p.maxY,l),v=K(x,u,r+w,r+E,1,p.minY,p.maxY,l),x=null),c>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*n,2*r),s.push(g||[],e+1,2*n,2*r+1),s.push(y||[],e+1,2*n+1,2*r),s.push(v||[],e+1,2*n+1,2*r+1)}}},dt.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=ft(t,e=(e%a+a)%a,n);if(this.tiles[s])return lt(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var l,c=t,u=e,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[ft(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?lt(this.tiles[s],i):null):null};class gt extends t.VectorTileWorkerSource{constructor(t,e,n,r){super(t,e,n,mt),r&&(this.loadGeoJSON=r)}loadData(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const e=this._pendingCallback,n=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const r=!!(n&&n.request&&n.request.collectResourceTiming)&&new t.RequestPerformance(n.request);this.loadGeoJSON(n,(i,o)=>{if(i||!o)return e(i);if("object"!=typeof o)return e(new Error(`Input data given to '${n.source}' is not a valid GeoJSON object.`));{!function t(e,n){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)t(e.features[r],n);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],n);else if("Feature"===i)t(e.geometry,n);else if("Polygon"===i)a(e.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)a(e.coordinates[r],n);return e}(o,!0);try{if(n.filter){const e=t.createExpression(n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));const r=o.features.filter(t=>e.value.evaluate({zoom:0},t));o={type:"FeatureCollection",features:r}}this._geoJSONIndex=n.cluster?new R(function({superclusterOptions:e,clusterProperties:n}){if(!n||!e)return e;const r={},i={},o={accumulated:null,zoom:0},a={properties:null},s=Object.keys(n);for(const l of s){const[e,o]=n[l],a=t.createExpression(o),s=t.createExpression("string"==typeof e?[e,["accumulated"],["get",l]]:e);r[l]=a.value,i[l]=s.value}return e.map=t=>{a.properties=t;const e={};for(const n of s)e[n]=r[n].evaluate(o,a);return e},e.reduce=(t,e)=>{a.properties=e;for(const n of s)o.accumulated=t[n],t[n]=i[n].evaluate(o,a)},e}(n)).load(o.features):function(t,e){return new dt(t,e)}(o,n.geojsonVtOptions)}catch(i){return e(i)}this.loaded={};const s={};if(r){const t=r.finish();t&&(s.resourceTiming={},s.resourceTiming[n.source]=JSON.parse(JSON.stringify(t)))}e(null,s)}})}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}reloadTile(t,e){const n=this.loaded;return n&&n[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}removeSource(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class yt{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:gt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}checkIfReady(t,e,n){n()}setReferrer(t,e){this.referrer=e}setImages(t,e,n){this.availableImages[t]=e;for(const r in this.workerSources[t]){const n=this.workerSources[t][r];for(const t in n)n[t].availableImages=e}n()}enableTerrain(t,e,n){this.terrain=e,n()}setLayers(t,e,n){this.getLayerIndex(t).replace(e),n()}updateLayers(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()}loadTile(e,n,r){const i=this.enableTerrain?t.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(e,n.type,n.source).loadTile(i,r)}loadDEMTile(e,n,r){const i=this.enableTerrain?t.extend({buildQuadTree:this.terrain},n):n;this.getDEMWorkerSource(e,n.source).loadTile(i,r)}reloadTile(e,n,r){const i=this.enableTerrain?t.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(e,n.type,n.source).reloadTile(i,r)}abortTile(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)}removeTile(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)}removeSource(t,e,n){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,n):n()}loadWorkerSource(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}}syncRTLPluginState(e,n,r){try{t.plugin.setState(n);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const n=t.plugin.isParsed();r(n?void 0:new Error("RTL Text Plugin failed to import scripts from "+e),n)}}catch(t){r(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e}getWorkerSource(t,e,n){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:(e,n,r,i,o,a)=>{this.actor.send(e,n,r,t,i,a)},scheduler:this.actor.scheduler},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][n]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new o),this.demWorkerSources[t][e]}enforceCacheSizeLimit(e,n){t.enforceCacheSizeLimit(n)}getWorkerPerformanceMetrics(t,e,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new yt(self)),yt})),r(["./shared"],(function(t){var e=n;function n(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===r[e=t&&t.failIfMajorPerformanceCaveat]&&(r[e]=function(t){var e,r=function(t){var e=document.createElement("canvas"),r=Object.create(n.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,e.getContext("webgl",r)||e.getContext("experimental-webgl",r)}(t);if(!r)return!1;try{e=r.createShader(r.VERTEX_SHADER)}catch(t){return!1}return!(!e||r.isContextLost())&&(r.shaderSource(e,"void main() {}"),r.compileShader(e),!0===r.getShaderParameter(e,r.COMPILE_STATUS))}(e)),r[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}(t)}var r={};n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const i={create:function(e,n,r){const i=t.window.document.createElement(e);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},o=t.window.document&&t.window.document.documentElement.style,a=o&&void 0!==o.userSelect?"userSelect":"WebkitUserSelect";let s;i.disableDrag=function(){o&&a&&(s=o[a],o[a]="none")},i.enableDrag=function(){o&&a&&(o[a]=s)},i.setTransform=function(t,e){t.style.transform=e};let l=!1;try{const e=Object.defineProperty({},"passive",{get(){l=!0}});t.window.addEventListener("test",e,e),t.window.removeEventListener("test",e,e)}catch(t){l=!1}i.addEventListener=function(t,e,n,r={}){t.addEventListener(e,n,"passive"in r&&l?r:r.capture)},i.removeEventListener=function(t,e,n,r={}){t.removeEventListener(e,n,"passive"in r&&l?r:r.capture)};const c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function u(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}i.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout(()=>{t.window.removeEventListener("click",c,!0)},0)},i.mousePos=function(e,n){const r=e.getBoundingClientRect();return new t.Point(n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop)},i.touchPos=function(e,n){const r=e.getBoundingClientRect(),i=[];for(let o=0;o<n.length;o++)i.push(new t.Point(n[o].clientX-r.left-e.clientLeft,n[o].clientY-r.top-e.clientTop));return i},i.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},i.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};class h extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(e,n){let r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(t,e){if(!t)return!0;let n=0;for(const r of t){if(r[0]<n||r[1]<r[0]||e<r[1])return!1;n=r[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let n=!0;if(!this.isLoaded())for(const r of t)this.images[r]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,n){const r={};for(const i of e){this.images[i]||this.fire(new t.Event("styleimagemissing",{id:i}));const e=this.images[i];e?r[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,r)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{const n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},i=new t.ImagePosition(n,r);this.patterns[e]={bin:n,position:i}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:n,h:r}=t.potpack(e),i=this.atlasImage;i.resize({width:n||1,height:r||1});for(const o in this.patterns){const{bin:e}=this.patterns[o],n=e.x+1,r=e.y+1,a=this.images[o].data,s=a.width,l=a.height;t.RGBAImage.copy(a,i,{x:0,y:0},{x:n,y:r},{width:s,height:l}),t.RGBAImage.copy(a,i,{x:0,y:l-1},{x:n,y:r-1},{width:s,height:1}),t.RGBAImage.copy(a,i,{x:0,y:0},{x:n,y:r+l},{width:s,height:1}),t.RGBAImage.copy(a,i,{x:s-1,y:0},{x:n-1,y:r},{width:1,height:l}),t.RGBAImage.copy(a,i,{x:0,y:0},{x:n+s,y:r},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t){if(this.callbackDispatchedThisFrame[e])continue;this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];u(t)&&this.updateImage(e,t)}}}var p=m,d=m,f=1e20;function m(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(t,e,n,r,i,o,a){for(var s=0;s<e;s++){for(var l=0;l<n;l++)r[l]=t[l*e+s];for(y(r,i,o,a,n),l=0;l<n;l++)t[l*e+s]=i[l]}for(l=0;l<n;l++){for(s=0;s<e;s++)r[s]=t[l*e+s];for(y(r,i,o,a,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(i[s])}}function y(t,e,n,r,i){n[0]=0,r[0]=-f,r[1]=+f;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+f}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}m.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=e.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?f:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?f:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},p.default=d;class v{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(e,n){const r=[];for(const t in e)for(const n of e[t])r.push({stack:t,id:n});t.asyncAll(r,({stack:t,id:e},n)=>{let r=this.entries[t];r||(r=this.entries[t]={glyphs:{},requests:{},ranges:{}});let i=r.glyphs[e];if(void 0!==i)return void n(null,{stack:t,id:e,glyph:i});if(i=this._tinySDF(r,t,e),i)return r.glyphs[e]=i,void n(null,{stack:t,id:e,glyph:i});const o=Math.floor(e/256);if(256*o>65535)return void n(new Error("glyphs > 65535 not supported"));if(r.ranges[o])return void n(null,{stack:t,id:e,glyph:i});let a=r.requests[o];a||(a=r.requests[o]=[],v.loadGlyphRange(t,o,this.url,this.requestManager,(t,e)=>{if(e){for(const t in e)this._doesCharSupportLocalGlyph(+t)||(r.glyphs[+t]=e[+t]);r.ranges[o]=!0}for(const n of a)n(t,e);delete r.requests[o]})),a.push((r,i)=>{r?n(r):i&&n(null,{stack:t,id:e,glyph:i[e]||null})})},(t,e)=>{if(t)n(t);else if(e){const t={};for(const{stack:n,id:r,glyph:i}of e)(t[n]||(t[n]={}))[r]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics};n(null,t)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))}_tinySDF(e,n,r){const i=this.localIdeographFontFamily;if(!i)return;if(!this._doesCharSupportLocalGlyph(r))return;let o=e.tinySDF;if(!o){let t="400";/bold/i.test(n)?t="900":/medium/i.test(n)?t="500":/light/i.test(n)&&(t="200"),o=e.tinySDF=new v.TinySDF(24,3,8,.25,i,t)}return{id:r,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}}v.loadGlyphRange=function(e,n,r,i,o){const a=256*n,s=a+255,l=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${a}-${s}`),t.ResourceType.Glyphs);t.getArrayBuffer(l,(e,n)=>{if(e)o(e);else if(n){const e={};for(const r of t.parseGlyphPBF(n))e[r.id]=r;o(null,e)}})},v.TinySDF=p;const _=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new class{constructor(){this.specification=t.styleSpec.light.position}possiblyEvaluate(e,n){return function([e,n,r]){const i=t.degToRad(n+90),o=t.degToRad(r);return{x:e*Math.cos(i)*Math.sin(o),y:e*Math.sin(i)*Math.sin(o),z:e*Math.cos(o),azimuthal:n,polar:r}}(e.expression.evaluate(n))}interpolate(e,n,r){return{x:t.number(e.x,n.x,r),y:t.number(e.y,n.y,r),z:t.number(e.z,n.z,r),azimuthal:t.number(e.azimuthal,n.azimuthal,r),polar:t.number(e.polar,n.polar,r)}}},color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)});class x extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(_),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(t.validateLight,e,n))for(const r in e){const n=e[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),n):this._transitionable.setValue(r,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))}}const b=new t.Properties({source:new t.DataConstantProperty(t.styleSpec.terrain.source),exaggeration:new t.DataConstantProperty(t.styleSpec.terrain.exaggeration)});class w extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(b),this.set(e),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(e){for(const n in e){const r=e[n];t.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-"-transition".length),r):this._transitionable.setValue(n,r)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}class M{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]}getDashRanges(t,e,n){const r=[];let i=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,a=!0;r.push({left:i,right:o,isDash:a,zeroLength:0===t[0]});let s=t[0];for(let l=1;l<t.length;l++){a=!a;const e=t[l];i=s*n,s+=e,o=s*n,r.push({left:i,right:o,isDash:a,zeroLength:0===e})}return r}addRoundDash(t,e,n){const r=e/2;for(let i=-n;i<=n;i++){const e=this.width*(this.nextRow+n+i);let o=0,a=t[o];for(let s=0;s<this.width;s++){s/a.right>1&&(a=t[++o]);const l=Math.abs(s-a.left),c=Math.abs(s-a.right),u=Math.min(l,c);let h;const p=i/n*(r+1);if(a.isDash){const t=r-Math.abs(p);h=Math.sqrt(u*u+t*t)}else h=r-Math.sqrt(u*u+p*p);this.data[e+s]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let a=t.length-1;a>=0;--a){const e=t[a],n=t[a+1];e.zeroLength?t.splice(a,1):n&&n.isDash===e.isDash&&(n.left=e.left,t.splice(a,1))}const e=t[0],n=t[t.length-1];e.isDash===n.isDash&&(e.left=n.left-this.width,n.right=e.right+this.width);const r=this.width*this.nextRow;let i=0,o=t[i];for(let a=0;a<this.width;a++){a/o.right>1&&(o=t[++i]);const e=Math.abs(a-o.left),n=Math.abs(a-o.right),s=Math.min(e,n);this.data[r+a]=Math.max(0,Math.min(255,(o.isDash?s:-s)+128))}}addDash(e,n){const r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let s=0;s<e.length;s++)e[s]<0&&(t.warnOnce("Negative value is found in line dasharray, replacing values with 0"),e[s]=0),o+=e[s];if(0!==o){const t=this.width/o,i=this.getDashRanges(e,this.width,t);n?this.addRoundDash(i,t,r):this.addRegularDash(i)}const a={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=i,this.dirty=!0,a}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}class E{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const r=this.workerPool.acquire(this.id);for(let t=0;t<r.length;t++){const e=new E.Actor(r[t],n,this.id);e.name="Worker "+t,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,r){t.asyncAll(this.actors,(t,r)=>{t.send(e,n,r)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function S(e,n,r){return n*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}E.Actor=t.Actor;class T{constructor(t,e,n,r){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(t=>r.pointCoordinate3D(t)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(e,n){let r,i;if(e instanceof t.Point||"number"==typeof e[0]){const o=t.Point.convert(e);r=[t.Point.convert(e)],i=n.isPointAboveHorizon(o)}else{const o=t.Point.convert(e[0]),a=t.Point.convert(e[1]);r=[o,a],i=t.polygonizeBounds(o,a).every(t=>n.isPointAboveHorizon(t))}return new T(r,n.getCameraPoint(),i,n)}bufferedScreenGeometry(e){return t.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const n=[this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0].add(new t.Point(1,0)):this.screenBounds[1],this.cameraPoint];return t.bufferConvexPolygon(n,e)}containsTile(e,n,r){const i=e.queryPadding+1,o=r?this._bufferedCameraMercator(i,n).map(t=>e.tileID.getTilePoint(t)):this._bufferedScreenMercator(i,n).map(t=>e.tileID.getTilePoint(t)),a=this.screenGeometryMercator.map(t=>e.tileID.getTileVec3(t)),s=a.map(e=>new t.Point(e[0],e[1])),l=n.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),c=e.tileID.getTileVec3(l),u=a.map(e=>{const n=t.sub(e,e,c);return t.normalize(n,n),new t.Ray(c,n)}),h=S(e,1,n.zoom);if(t.polygonIntersectsBox(o,0,0,t.EXTENT,t.EXTENT))return{queryGeometry:this,tilespaceGeometry:s,tilespaceRays:u,bufferedTilespaceGeometry:o,bufferedTilespaceBounds:(p=t.getBounds(o),p.min.x=t.clamp(p.min.x,0,t.EXTENT),p.min.y=t.clamp(p.min.y,0,t.EXTENT),p.max.x=t.clamp(p.max.x,0,t.EXTENT),p.max.y=t.clamp(p.max.y,0,t.EXTENT),p),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:h};var p}_bufferedScreenMercator(t,e){const n=A(t);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{const r=this.bufferedScreenGeometry(t).map(t=>e.pointCoordinate3D(t));return this._screenRaycastCache[n]=r,r}}_bufferedCameraMercator(t,e){const n=A(t);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{const r=this.bufferedCameraGeometry(t).map(t=>e.pointCoordinate3D(t));return this._cameraRaycastCache[n]=r,r}}}function A(t){return 100*t|0}function C(e,n,r){const i=function(i,o){if(i)return r(i);if(o){const i=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(i.vectorLayers=o.vector_layers,i.vectorLayerIds=i.vectorLayers.map(t=>t.id)),i.tiles=n.canonicalizeTileset(i,e.url),r(null,i)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame(()=>i(null,e))}class L{constructor(e,n,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=r||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<a}}class I extends t.Evented{constructor(e,n,r,i){super(),this.id=e,this.dispatcher=r,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(e,n)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(t.extend(this,n),n.bounds&&(this.tileBounds=new L(n.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(n.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,n){const r=t.browser.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(r,i)=>{if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(i){this.map._refreshExpiredTiles&&e.setExpiryData(i),delete i.cacheControl,delete i.expires;const r=this.map.painter.context,o=r.gl;e.texture=this.map.painter.getTileTexture(i.width),e.texture?e.texture.update(i,{useMipmap:!0}):(e.texture=new t.Texture(r,i,o.RGBA,{useMipmap:!0}),e.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),r.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),n(null)}})}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}var P=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class R extends t.Evented{constructor(t,e,n,r){super(),this.id=t,this.dispatcher=n,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=e}load(e,n){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(r,i)=>{this._loaded=!0,r?this.fire(new t.ErrorEvent(r)):i&&(this.image=i,e&&(this.coordinates=e),n&&n(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(e){this.coordinates=e;const n=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){let n=1/0,r=1/0,i=-1/0,o=-1/0;for(const t of e)n=Math.min(n,t.x),r=Math.min(r,t.y),i=Math.max(i,t.x),o=Math.max(o,t.y);const a=Math.max(i-n,o-r),s=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),l=Math.pow(2,s);return new t.CanonicalTileID(s,Math.floor((n+i)/2*l),Math.floor((r+o)/2*l))}(n),this.minzoom=this.maxzoom=this.tileID.z;const r=n.map(t=>this.tileID.getTilePoint(t)._round());return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,P.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const O={vector:class extends t.Evented{constructor(e,n,r,i){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(n,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=C(this._options,this.map._requestManager,(e,n)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(t.extend(this,n),n.bounds&&(this.tileBounds=new L(n.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t();const e=this.map.style._getSourceCaches(this.id);for(const n of e)n.clearTiles();this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}loadTile(e,n){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile};if(i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",i,o.bind(this));else if(e.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",i,o.bind(this));else{const n=t.loadVectorTile.call({deduped:this._deduped},i,(t,n)=>{t||!n?o.call(this,t):(i.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},e.actor&&e.actor.send("loadTile",i,o.bind(this)))},!0);e.request={cancel:n}}function o(r,i){return delete e.request,e.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:I,"raster-dem":class extends I{constructor(e,n,r,i){super(e,n,r,i),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(e,n){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function i(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;const n=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported(),r=1-(o.width-t.prevPowerOfTwo(o.width))/2;r<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const a=n?o:t.browser.getImageData(o,r),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding,padding:r};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this))}_getNeighboringTiles(e){const n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+r)%r,s=n.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(l[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends t.Evented{constructor(e,n,r,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(i),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,this._resourceTiming=[],void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?Math.min(n.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.EXTENT,radius:(n.clusterRadius||50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}load(){this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(e=>{if(e)return void this.fire(new t.ErrorEvent(e));const n={dataType:"source",sourceDataType:"metadata"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(n.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new t.Event("data",n))})}onAdd(t){this.map=t,this.load()}setData(e){return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(e=>{if(e)return void this.fire(new t.ErrorEvent(e));const n={dataType:"source",sourceDataType:"content"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(n.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new t.Event("data",n))}),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},r),this}_updateWorkerData(e){this._loaded=!1;const n=t.extend({},this.workerOptions),r=this._data;"string"==typeof r?(n.request=this.map._requestManager.transformRequest(t.browser.resolveURL(r),t.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(r),this.actor.send(this.type+".loadData",n,(t,r)=>{this._removed||r&&r.abandoned||(this._loaded=!0,r&&r.resourceTiming&&r.resourceTiming[this.id]&&(this._resourceTiming=r.resourceTiming[this.id].slice(0)),this.actor.send(this.type+".coalesce",{source:n.source},null),e(t))})}loaded(){return this._loaded}loadTile(e,n){const r=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(r,{type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(t,i)=>(delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(i,this.map.painter,"reloadTile"===r),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends R{constructor(t,e,n,r){super(t,e,n,r),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,t.ResourceType.Source).url);t.getVideo(this.urls,(e,n)=>{this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,P.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:R,canvas:class extends R{constructor(e,n,r,i){super(e,n,r,i),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+e,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+e,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+e,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+e,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+e,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,r=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,P.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,r.RGBA,{premultiply:!0});for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}},D=function(e,n,r,i){const o=new O[n.type](e,n,r,i);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function N(e,n){const r=t.identity([]);return t.scale(r,r,[.5*e.width,.5*-e.height,1]),t.translate(r,r,[1,-1,0]),t.multiply(r,r,e.calculatePosMatrix(n.toUnwrapped()))}function k(t,e,n,r,i,o,a,s=!1){const l=t.tilesIn(r,a,s);l.sort(z);const c=[];for(const h of l)c.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,n,t._state,h,i,o,N(t.transform,h.tile.tileID),s)});const u=function(t){const e={},n={};for(const r of t){const t=r.queryResults,i=r.wrappedTileID,o=n[i]=n[i]||{};for(const n in t){const r=t[n],i=o[n]=o[n]||{},a=e[n]=e[n]||[];for(const t of r)i[t.featureIndex]||(i[t.featureIndex]=!0,a.push(t))}}return e}(c);for(const h in u)u[h].forEach(e=>{const n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r});return u}function F(t,e){const n=t.getRenderableIds().map(e=>t.getTileByID(e)),r=[],i={};for(let o=0;o<n.length;o++){const t=n[o],a=t.tileID.canonical.key;i[a]||(i[a]=!0,t.querySourceFeatures(r,e))}return r}function z(t,e){const n=t.tileID,r=e.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}function B(){return null!=Mi.workerClass?new Mi.workerClass:new t.window.Worker(Mi.workerUrl)}const U="mapboxgl_preloaded_worker_pool";class j{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<j.workerCount;)this.workers.push(new B);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[U]}numActive(){return Object.keys(this.active).length}}let G;function V(){return G||(G=new j),G}function H(e,n){const r={};for(const t in e)"ref"!==t&&(r[t]=e[t]);return t.refProperties.forEach(t=>{t in n&&(r[t]=n[t])}),r}function W(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=H(t[n],e[t[n].ref]));return t}j.workerCount=2;const q={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain"};function X(t,e,n){n.push({command:q.addSource,args:[t,e[t]]})}function Z(t,e,n){e.push({command:q.removeSource,args:[t]}),n[t]=!0}function Y(t,e,n,r){Z(t,n,r),X(t,e,n)}function $(e,n,r){let i;for(i in e[r])if(e[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;return!0}function J(e,n,r,i,o,a){let s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}))}function K(t){return t.id}function Q(t,e){return t[e.id]=e,t}class tt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);let n=1,r=this._distances[n];const i=e*this.paddedLength+this.padding;for(;r<i&&n<this._distances.length;)r=this._distances[++n];const o=n-1,a=this._distances[o],s=r-a,l=s>0?(i-a)/s:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}class et{constructor(t,e,n){const r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}insertCircle(t,e,n,r){this._forEachCell(e-r,n-r,e+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(r)}_insertBoxCell(t,e,n,r,i,o){this.boxCells[i].push(o)}_insertCircleCell(t,e,n,r,i,o){this.circleCells[i].push(o)}_query(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];const a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],n=this.circles[3*t+1],r=this.circles[3*t+2];a.push({key:this.circleKeys[t],x1:e-r,y1:n-r,x2:e+r,y2:n+r})}return o?a.filter(o):a}return this._forEachCell(t,e,n,r,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a}_queryCircle(t,e,n,r,i){const o=t-n,a=t+n,s=e-n,l=e+n;if(a<0||o>this.width||l<0||s>this.height)return!r&&[];const c=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,c,{hitTest:r,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},i),r?c.length>0:c}query(t,e,n,r,i){return this._query(t,e,n,r,!1,i)}hitTest(t,e,n,r,i){return this._query(t,e,n,r,!0,i)}hitTestCircle(t,e,n,r){return this._queryCircle(t,e,n,!0,r)}_queryCell(t,e,n,r,i,o,a,s){const l=a.seenUids,c=this.boxCells[i];if(null!==c){const i=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=i[c+2]&&e<=i[c+3]&&n>=i[c+0]&&r>=i[c+1]&&(!s||s(this.boxKeys[u]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:i[c],y1:i[c+1],x2:i[c+2],y2:i[c+3]})}}}const u=this.circleCells[i];if(null!==u){const i=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(i[u],i[u+1],i[u+2],t,e,n,r)&&(!s||s(this.circleKeys[c]))){if(a.hitTest)return o.push(!0),!0;{const t=i[u],e=i[u+1],n=i[u+2];o.push({key:this.circleKeys[c],x1:t-n,y1:e-n,x2:t+n,y2:e+n})}}}}}_queryCellCircle(t,e,n,r,i,o,a,s){const l=a.circle,c=a.seenUids,u=this.boxCells[i];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const n=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[n+0],t[n+1],t[n+2],t[n+3])&&(!s||s(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[i];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const n=3*e;if(this._circlesCollide(t[n],t[n+1],t[n+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,n,r,i,o,a,s){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r);for(let p=l;p<=u;p++)for(let l=c;l<=h;l++)if(i.call(this,t,e,n,r,this.xCellCount*l+p,o,a,s))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,n,r,i,o){const a=r-t,s=i-e,l=n+o;return l*l>a*a+s*s}_circleAndRectCollide(t,e,n,r,i,o,a){const s=(o-r)/2,l=Math.abs(t-(r+s));if(l>s+n)return!1;const c=(a-i)/2,u=Math.abs(e-(i+c));if(u>c+n)return!1;if(l<=s||u<=c)return!0;const h=l-s,p=u-c;return h*h+p*p<=n*n}}function nt(e,n,r,i,o){const a=t.create();return n?(t.scale(a,a,[1/o,1/o,1]),r||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function rt(e,n,r,i,o){if(n){const n=t.clone(e);return t.scale(n,n,[o,o,1]),r||t.rotateZ(n,n,-i.angle),n}return i.glCoordMatrix}function it(e,n,r=0){const i=[e.x,e.y,r,1];r?t.transformMat4(i,i,n):mt(i,i,n);const o=i[3];return{point:new t.Point(i[0]/o,i[1]/o),signedDistanceFromCamera:o}}function ot(t,e){return Math.min(.5+t/e*.5,1.5)}function at(t,e){const n=t[0]/t[3],r=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&r>=-e[1]&&r<=e[1]}function st(e,n,r,i,o,a,s,l,c){const u=i?e.textSizeData:e.iconSizeData,h=t.evaluateSizeForZoom(u,r.transform.zoom),p=[256/r.width*2+1,256/r.height*2+1],d=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;d.clear();const f=e.lineVertexArray,m=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,g=r.transform.width/r.transform.height;let y=!1;for(let v=0;v<m.length;v++){const i=m.get(v);if(i.hidden||i.writingMode===t.WritingMode.vertical&&!y){ft(i.numGlyphs,d);continue}y=!1;const _=c?c({x:i.anchorX,y:i.anchorY}):0,x=[i.anchorX,i.anchorY,_,1];if(t.transformMat4(x,x,n),!at(x,p)){ft(i.numGlyphs,d);continue}const b=ot(r.transform.cameraToCenterDistance,x[3]),w=t.evaluateSizeForFeature(u,h,i),M=s?w/b:w*b,E=new t.Point(i.anchorX,i.anchorY),S=it(E,o,_);if(S.signedDistanceFromCamera<=0){ft(i.numGlyphs,d);continue}const T=S.point;let A={};const C=s?null:c,L=ut(i,M,!1,l,n,o,a,e.glyphOffsetArray,f,d,T,E,A,g,C);y=L.useVertical,C&&L.needsFlipping&&(A={}),(L.notEnoughRoom||y||L.needsFlipping&&ut(i,M,!0,l,n,o,a,e.glyphOffsetArray,f,d,T,E,A,g,C).notEnoughRoom)&&ft(i.numGlyphs,d)}i?e.text.dynamicLayoutVertexBuffer.updateData(d):e.icon.dynamicLayoutVertexBuffer.updateData(d)}function lt(t,e,n,r,i,o,a,s,l,c,u,h,p){const d=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,m=s.lineStartIndex+s.lineLength,g=e.getoffsetX(s.glyphStartIndex),y=e.getoffsetX(d-1),v=pt(t*g,n,r,i,o,a,s.segment,f,m,l,c,u,h,p,!0);if(!v)return null;const _=pt(t*y,n,r,i,o,a,s.segment,f,m,l,c,u,h,p,!0);return _?{first:v,last:_}:null}function ct(e,n,r,i){return e===t.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function ut(e,n,r,i,o,a,s,l,c,u,h,p,d,f,m){const g=n/24,y=e.lineOffsetX*g,v=e.lineOffsetY*g;let _;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,n=e.lineStartIndex,o=e.lineStartIndex+e.lineLength,u=lt(g,l,y,v,r,h,p,e,c,a,d,m);if(!u)return{notEnoughRoom:!0};const x=it(u.first.point,s).point,b=it(u.last.point,s).point;if(i&&!r){const t=ct(e.writingMode,x,b,f);if(t)return t}_=[u.first];for(let i=e.glyphStartIndex+1;i<t-1;i++)_.push(pt(g*l.getoffsetX(i),y,v,r,h,p,e.segment,n,o,c,a,d,m));_.push(u.last)}else{if(i&&!r){const n=it(p,o).point,r=e.lineStartIndex+e.segment+1,i=new t.Point(c.getx(r),c.gety(r)),a=it(i,o),s=a.signedDistanceFromCamera>0?a.point:ht(p,i,n,1,o),l=ct(e.writingMode,n,s,f);if(l)return l}const n=pt(g*l.getoffsetX(e.glyphStartIndex),y,v,r,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,a,d,m);if(!n)return{notEnoughRoom:!0};_=[n]}for(const x of _)t.addDynamicAttributes(u,x.point,x.angle);return{}}function ht(t,e,n,r,i,o){const a=t.add(t.sub(e)._unit()),s=it(a,i,o?o(a):0).point,l=n.sub(s);return n.add(l._mult(r/l.mag()))}function pt(e,n,r,i,o,a,s,l,c,u,h,p,d,f,m){const g=i?e-n:e+n;let y=g>0?1:-1,v=0;i&&(y*=-1,v=Math.PI),y<0&&(v+=Math.PI);let _=y>0?l+s:l+s+1,x=o,b=o,w=0,M=0;const E=Math.abs(g),S=[],T=[];let A=a;const C=()=>{const e=_-y;return 0===w?a:new t.Point(u.getx(e),u.gety(e))},L=()=>ht(C(),A,b,E-w+1,h,d);for(;w+M<=E;){if(_+=y,_<l||_>=c)return null;if(b=x,S.push(x),f&&T.push(A||C()),x=p[_],void 0===x){A=new t.Point(u.getx(_),u.gety(_));const e=it(A,h,d?d(A):0);x=e.signedDistanceFromCamera>0?p[_]=e.point:L()}else A=null;w+=M,M=b.dist(x)}m&&d&&(A=A||new t.Point(u.getx(_),u.gety(_)),p[_]=x=void 0===p[_]?x:L(),M=b.dist(x));const I=(E-w)/M,P=x.sub(b),R=P.mult(I)._add(b);r&&R._add(P._unit()._perp()._mult(r*y));const O=v+Math.atan2(x.y-b.y,x.x-b.x);return S.push(R),f&&(A=A||new t.Point(u.getx(_),u.gety(_)),T.push(function(e,n,r){const i=1-r;return new t.Point(e.x*i+n.x*r,e.y*i+n.y*r)}(T.length>0?T[T.length-1]:A,A,I))),{point:R,angle:O,path:S,tilePath:T}}const dt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ft(t,e){for(let n=0;n<t;n++){const t=e.length;e.resize(t+4),e.float32.set(dt,3*t)}}function mt(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t[3]=n[3]*r+n[7]*i+n[15],t}class gt{constructor(t,e=new et(t.width+200,t.height+200,25),n=new et(t.width+200,t.height+200,25)){this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200}placeCollisionBox(t,e,n,r,i,o,a){const s=this.projectAndGetPerspectiveRatio(o,e.anchorPointX,e.anchorPointY,e.elevation),l=i*s.perspectiveRatio,c=(e.x1*t+n.x-e.padding)*l+s.point.x,u=(e.y1*t+n.y-e.padding)*l+s.point.y,h=(e.x2*t+n.x+e.padding)*l+s.point.x,p=(e.y2*t+n.y+e.padding)*l+s.point.y,d=s.perspectiveRatio<=.55;return!this.isInsideGrid(c,u,h,p)||!r&&this.grid.hitTest(c,u,h,p,a)||d?{box:[],offscreen:!1}:{box:[c,u,h,p],offscreen:this.isOffscreen(c,u,h,p)}}placeCollisionCircles(e,n,r,i,o,a,s,l,c,u,h,p,d,f){const m=[],g=this.transform.elevation,y=g?t=>g.getAtTileOffset(f,t.x,t.y):t=>0,v=new t.Point(n.anchorX,n.anchorY),_=y(v),x=it(v,a,_),b=ot(this.transform.cameraToCenterDistance,x.signedDistanceFromCamera),w=(u?o/b:o*b)/t.ONE_EM,M=it(v,s,_).point,E=x.signedDistanceFromCamera>0?lt(w,i,n.lineOffsetX*w,n.lineOffsetY*w,!1,M,v,n,r,s,{},g&&!u?y:null,u&&!!g):null;let S=!1,T=!1,A=!0;if(E){const n=.5*p*b+d,r=new t.Point(-100,-100),i=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),o=new tt,a=E.first,s=E.last;let u=[];for(let t=a.path.length-1;t>=1;t--)u.push(a.path[t]);for(let t=1;t<s.path.length;t++)u.push(s.path[t]);const f=2.5*n;if(l){const t=u.map(g?(t,e)=>{const n=y(e<a.path.length-1?a.tilePath[a.path.length-1-e]:s.tilePath[e-a.path.length+2]);return it(t,l,n)}:t=>it(t,l));u=t.some(t=>t.signedDistanceFromCamera<=0)?[]:t.map(t=>t.point)}let v=[];if(u.length>0){const e=u[0].clone(),n=u[0].clone();for(let t=1;t<u.length;t++)e.x=Math.min(e.x,u[t].x),e.y=Math.min(e.y,u[t].y),n.x=Math.max(n.x,u[t].x),n.y=Math.max(n.y,u[t].y);v=e.x>=r.x&&n.x<=i.x&&e.y>=r.y&&n.y<=i.y?[u]:n.x<r.x||e.x>i.x||n.y<r.y||e.y>i.y?[]:t.clipLine([u],r.x,r.y,i.x,i.y)}for(const t of v){o.reset(t,.25*n);let r=0;r=o.length<=.5*n?1:Math.ceil(o.paddedLength/f)+1;for(let t=0;t<r;t++){const i=t/Math.max(r-1,1),a=o.lerp(i),s=a.x+100,l=a.y+100;m.push(s,l,n,0);const u=s-n,p=l-n,d=s+n,f=l+n;if(A=A&&this.isOffscreen(u,p,d,f),T=T||this.isInsideGrid(u,p,d,f),!e&&this.grid.hitTestCircle(s,l,n,h)&&(S=!0,!c))return{circles:[],offscreen:!1,collisionDetected:S}}}}return{circles:!c&&S||!T?[]:m,offscreen:A,collisionDetected:S}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let r=1/0,i=1/0,o=-1/0,a=-1/0;for(const u of e){const e=new t.Point(u.x+100,u.y+100);r=Math.min(r,e.x),i=Math.min(i,e.y),o=Math.max(o,e.x),a=Math.max(a,e.y),n.push(e)}const s=this.grid.query(r,i,o,a).concat(this.ignoredGrid.query(r,i,o,a)),l={},c={};for(const u of s){const e=u.key;if(void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]={}),l[e.bucketInstanceId][e.featureIndex])continue;const r=[new t.Point(u.x1,u.y1),new t.Point(u.x2,u.y1),new t.Point(u.x2,u.y2),new t.Point(u.x1,u.y2)];t.polygonIntersectsPolygon(n,r)&&(l[e.bucketInstanceId][e.featureIndex]=!0,void 0===c[e.bucketInstanceId]&&(c[e.bucketInstanceId]=[]),c[e.bucketInstanceId].push(e.featureIndex))}return c}insertCollisionBox(t,e,n,r,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,n,r,i){const o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:i};for(let s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])}projectAndGetPerspectiveRatio(e,n,r,i){const o=[n,r,0,1];return i?(o[2]=i,t.transformMat4(o,o,e)):mt(o,o,e),{point:new t.Point((o[0]/o[3]+1)/2*this.transform.width+100,(-o[1]/o[3]+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/o[3]*.5,1.5)}}isOffscreen(t,e,n,r){return n<100||t>=this.screenRightBoundary||r<100||e>this.screenBottomBoundary}isInsideGrid(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e}}class yt{constructor(t,e,n,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class vt{constructor(t,e,n,r,i){this.text=new yt(t?t.text:null,e,n,i),this.icon=new yt(t?t.icon:null,e,r,i)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _t{constructor(t,e,n){this.text=t,this.icon=e,this.skipFade=n}}class xt{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class bt{constructor(t,e,n,r,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i}}class wt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Mt(e,n,r,i,o){const{horizontalAlign:a,verticalAlign:s}=t.getAnchorAlignment(e),l=-(a-.5)*n,c=-(s-.5)*r,u=t.evaluateVariableOffset(e,i);return new t.Point(l+u[0]*o,c+u[1]*o)}function Et(e,n,r,i,o){const a=new t.Point(e,n);return r&&a._rotate(i?o:-o),a}class St{constructor(t,e,n,r){this.transform=t.clone(),this.collisionIndex=new gt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new wt(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,r,i){const o=r.getBucket(n),a=r.latestFeatureIndex;if(!o||!a||n.id!==o.layerIds[0])return;const s=r.collisionBoxArray,l=o.layers[0].layout,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p="map"===l.get("text-pitch-alignment"),d="map"===l.get("text-rotation-alignment"),f=S(r,1,this.transform.zoom),m=nt(h,p,d,this.transform,f);let g=null;if(p){const e=rt(h,p,d,this.transform,f);g=t.multiply([],this.transform.labelPlaneMatrix,e)}this.retainedQueryData[o.bucketInstanceId]=new bt(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);const y={bucket:o,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(const t of o.sortKeyRanges){const{sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i}=t;e.push({sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:y})}attemptAnchorPlacement(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m,g,y){const v=[h.textOffset0,h.textOffset1],_=d.getSymbolInstanceTextSize(g,h,this.transform.zoom,p),x=Mt(t,n,r,v,i),b=this.collisionIndex.placeCollisionBox(_,e,Et(x.x,x.y,o,a,this.transform.angle),u,s,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(d.getSymbolInstanceIconSize(y,this.transform.zoom,p),m,Et(x.x,x.y,o,a,this.transform.angle),u,s,l,c.predicate).box.length)&&b.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(e=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:v,width:n,height:r,anchor:t,textBoxScale:i,prevAnchor:e},this.markUsedJustification(d,t,h,f),d.allowVerticalPlacement&&(this.markUsedOrientation(d,f,h),this.placedOrientations[h.crossTileID]=f),{shift:x,placedGlyphBoxes:b}}}placeLayerBucketPart(e,n,r){const{bucket:i,layout:o,posMatrix:a,textLabelPlaneMatrix:s,labelToScreenMatrix:l,textPixelRatio:c,holdingForFade:u,collisionBoxArray:h,partiallyEvaluatedTextSize:p,partiallyEvaluatedIconSize:d,collisionGroup:f}=e.parameters,m=o.get("text-optional"),g=o.get("icon-optional"),y=o.get("text-allow-overlap"),v=o.get("icon-allow-overlap"),_="map"===o.get("text-rotation-alignment"),x="map"===o.get("text-pitch-alignment"),b="none"!==o.get("icon-text-fit"),w="viewport-y"===o.get("symbol-z-order"),M=y&&(v||!i.hasIconData()||g),E=v&&(y||!i.hasTextData()||m);!i.collisionArrays&&h&&i.deserializeCollisionBoxes(h),r&&i.updateCollisionDebugBuffers(this.transform.zoom,h);const S=(e,h,w)=>{if(n[e.crossTileID])return;if(u)return void(this.placements[e.crossTileID]=new _t(!1,!1,!1));let S=!1,T=!1,A=!0,C=null,L={box:null,offscreen:null},I={box:null,offscreen:null},P=null,R=null,O=null,D=0,N=0,k=0;w.textFeatureIndex?D=w.textFeatureIndex:e.useRuntimeCollisionCircles&&(D=e.featureIndex),w.verticalTextFeatureIndex&&(N=w.verticalTextFeatureIndex);const F=t=>{(this.transform.elevation||t.elevation)&&(t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[i.bucketInstanceId].tileID,t.anchorPointX,t.anchorPointY):0)},z=w.textBox;if(z){F(z);const n=n=>{let r=t.WritingMode.horizontal;if(i.allowVerticalPlacement&&!n&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,r=t,this.markUsedOrientation(i,r,e))}return r},r=(n,r)=>{if(i.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&w.verticalTextBox){for(const e of i.writingModes)if(e===t.WritingMode.vertical?(L=r(),I=L):L=n(),L&&L.box&&L.box.length)break}else L=n()};if(o.get("text-variable-anchor")){let s=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[e.crossTileID]){const t=this.prevPlacement.variableOffsets[e.crossTileID];s.indexOf(t.anchor)>0&&(s=s.filter(e=>e!==t.anchor),s.unshift(t.anchor))}const l=(t,n,r)=>{const o=e.textBoxScale,l=(t.x2-t.x1)*o+2*t.padding,u=(t.y2-t.y1)*o+2*t.padding,m=b&&!v?n:null;m&&F(m);let g={box:[],offscreen:!1};const w=y?2*s.length:s.length;for(let y=0;y<w;++y){const n=this.attemptAnchorPlacement(s[y%s.length],t,l,u,o,_,x,c,a,f,y>=s.length,e,h,i,r,m,p,d);if(n&&(g=n.placedGlyphBoxes,g&&g.box&&g.box.length)){S=!0,C=n.shift;break}}return g};r(()=>l(z,w.iconBox,t.WritingMode.horizontal),()=>{const n=w.verticalTextBox;return n&&F(n),i.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&e.numVerticalGlyphVertices>0&&n?l(n,w.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}}),L&&(S=L.box,A=L.offscreen);const u=n(L&&L.box);if(!S&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(i,t.anchor,e,u))}}else{const o=(n,r)=>{const o=i.getSymbolInstanceTextSize(p,e,this.transform.zoom,h),s=this.collisionIndex.placeCollisionBox(o,n,new t.Point(0,0),y,c,a,f.predicate);return s&&s.box&&s.box.length&&(this.markUsedOrientation(i,r,e),this.placedOrientations[e.crossTileID]=r),s};r(()=>o(z,t.WritingMode.horizontal),()=>{const n=w.verticalTextBox;return i.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?(F(n),o(n,t.WritingMode.vertical)):{box:null,offscreen:null}}),n(L&&L.box&&L.box.length)}}if(P=L,S=P&&P.box&&P.box.length>0,A=P&&P.offscreen,e.useRuntimeCollisionCircles){const n=i.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),c=t.evaluateSizeForFeature(i.textSizeData,p,n),u=o.get("text-padding");R=this.collisionIndex.placeCollisionCircles(y,n,i.lineVertexArray,i.glyphOffsetArray,c,a,s,l,r,x,f.predicate,e.collisionCircleDiameter,u,this.retainedQueryData[i.bucketInstanceId].tileID),S=y||R.circles.length>0&&!R.collisionDetected,A=A&&R.offscreen}if(w.iconFeatureIndex&&(k=w.iconFeatureIndex),w.iconBox){const e=e=>{F(e);const n=b&&C?Et(C.x,C.y,_,x,this.transform.angle):new t.Point(0,0),r=i.getSymbolInstanceIconSize(d,this.transform.zoom,h);return this.collisionIndex.placeCollisionBox(r,e,n,v,c,a,f.predicate)};I&&I.box&&I.box.length&&w.verticalIconBox?(O=e(w.verticalIconBox),T=O.box.length>0):(O=e(w.iconBox),T=O.box.length>0),A=A&&O.offscreen}const B=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,U=g||0===e.numIconVertices;if(B||U?U?B||(T=T&&S):S=T&&S:T=S=T&&S,S&&P&&P.box&&this.collisionIndex.insertCollisionBox(P.box,o.get("text-ignore-placement"),i.bucketInstanceId,I&&I.box&&N?N:D,f.ID),T&&O&&this.collisionIndex.insertCollisionBox(O.box,o.get("icon-ignore-placement"),i.bucketInstanceId,k,f.ID),R&&(S&&this.collisionIndex.insertCollisionCircles(R.circles,o.get("text-ignore-placement"),i.bucketInstanceId,D,f.ID),r)){const t=i.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new xt);for(let n=0;n<R.circles.length;n+=4)e.circles.push(R.circles[n+0]),e.circles.push(R.circles[n+1]),e.circles.push(R.circles[n+2]),e.circles.push(R.collisionDetected?1:0)}this.placements[e.crossTileID]=new _t(S||M,T||E,A||i.justReloaded),n[e.crossTileID]=!0};if(w){const t=i.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];S(i.symbolInstances.get(n),n,i.collisionArrays[n])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)S(i.symbolInstances.get(t),t,i.collisionArrays[t]);if(r&&i.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[i.bucketInstanceId];t.invert(e.invProjMatrix,a),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}i.justReloaded=!1}markUsedJustification(e,n,r,i){let o;o=i===t.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];const a=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const t of a)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:r.crossTileID)}markUsedOrientation(e,n,r){const i=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,a=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const t of a)e.text.placedSymbolArray.get(t).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const r=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(const s in this.placements){const t=this.placements[s],e=i[s];e?(this.opacities[s]=new vt(e,r,t.text,t.icon),n=n||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[s]=new vt(null,r,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(const s in i){const t=i[s];if(!this.opacities[s]){const e=new vt(t,r,!1,!1);e.isHidden()||(this.opacities[s]=e,n=n||t.text.placed||t.icon.placed)}}for(const s in o)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=o[s]);for(const s in a)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=a[s]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const n={};for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,n,r.collisionBoxArray)}}updateBucketOpacities(e,n,r){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const i=e.layers[0].layout,o=new vt(null,0,!1,!1,!0),a=i.get("text-allow-overlap"),s=i.get("icon-allow-overlap"),l=i.get("text-variable-anchor"),c="map"===i.get("text-rotation-alignment"),u="map"===i.get("text-pitch-alignment"),h="none"!==i.get("icon-text-fit"),p=new vt(null,0,a&&(s||!e.hasIconData()||i.get("icon-optional")),s&&(a||!e.hasTextData()||i.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const d=(t,e,n)=>{for(let r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(n)};for(let f=0;f<e.symbolInstances.length;f++){const r=e.symbolInstances.get(f),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:a,crossTileID:s}=r;let m=this.opacities[s];n[s]?m=o:m||(m=p,this.opacities[s]=m),n[s]=!0;const g=r.numIconVertices>0,y=this.placedOrientations[r.crossTileID],v=y===t.WritingMode.vertical,_=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(i>0||a>0){const t=Dt(m.text);d(e.text,i,v?Nt:t),d(e.text,a,_?Nt:t);const n=m.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach(t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=n||v?1:0)}),r.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=n||_?1:0);const o=this.variableOffsets[r.crossTileID];o&&this.markUsedJustification(e,o.anchor,r,y);const s=this.placedOrientations[r.crossTileID];s&&(this.markUsedJustification(e,"left",r,s),this.markUsedOrientation(e,s,r))}if(g){const t=Dt(m.icon),n=!(h&&r.verticalPlacedIconSymbolIndex&&v);r.placedIconSymbolIndex>=0&&(d(e.icon,r.numIconVertices,n?t:Nt),e.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=m.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,r.numVerticalIconVertices,n?Nt:t),e.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const n=e.collisionArrays[f];if(n){let r=new t.Point(0,0);if(n.textBox||n.verticalTextBox){let t=!0;if(l){const e=this.variableOffsets[s];e?(r=Mt(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),c&&r._rotate(u?this.transform.angle:-this.transform.angle)):t=!1}n.textBox&&Tt(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||v,r.x,r.y),n.verticalTextBox&&Tt(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||_,r.x,r.y)}const i=Boolean(!_&&n.verticalIconBox);n.iconBox&&Tt(e.iconCollisionBox.collisionVertexArray,m.icon.placed,i,h?r.x:0,h?r.y:0),n.verticalIconBox&&Tt(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!i,h?r.x:0,h?r.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t}setStale(){this.stale=!0}}function Tt(t,e,n,r,i){t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0)}const At=Math.pow(2,25),Ct=Math.pow(2,24),Lt=Math.pow(2,17),It=Math.pow(2,16),Pt=Math.pow(2,9),Rt=Math.pow(2,8),Ot=Math.pow(2,1);function Dt(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*At+e*Ct+n*Lt+e*It+n*Pt+e*Rt+n*Ot+e}const Nt=0;class kt{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,n,r,i){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1}}class Ft{constructor(t,e,n,r,i,o,a){this.placement=new St(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,n,r){const i=t.browser.now(),o=()=>{const e=t.browser.now()-i;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const t=n[e[this._currentPlacementIndex]],i=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=i)&&(!t.maxzoom||t.maxzoom>i)){if(this._inProgressLayer||(this._inProgressLayer=new kt(t)),this._inProgressLayer.continuePlacement(r[t.source],this.placement,this._showCollisionBoxes,t,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const zt=512/t.EXTENT/2;class Bt{constructor(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(let r=0;r<e.length;r++){const n=e.get(r),i=n.key;this.indexedSymbolInstances[i]||(this.indexedSymbolInstances[i]=[]),this.indexedSymbolInstances[i].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}}getScaledCoordinates(e,n){const r=zt/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*r)}}findMatches(t,e,n){const r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let i=0;i<t.length;i++){const o=t.get(i);if(o.crossTileID)continue;const a=this.indexedSymbolInstances[o.key];if(!a)continue;const s=this.getScaledCoordinates(o,e);for(const t of a)if(Math.abs(t.coord.x-s.x)<=r&&Math.abs(t.coord.y-s.y)<=r&&!n[t.crossTileID]){n[t.crossTileID]=!0,o.crossTileID=t.crossTileID;break}}}}class Ut{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class jt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const n in this.indexes){const t=this.indexes[n],r={};for(const n in t){const i=t[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),r[i.tileID.key]=i}this.indexes[n]=r}this.lng=t}addBucket(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let i=0;i<e.symbolInstances.length;i++)e.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const r=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,r)}else{const o=n[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,r)}}for(let i=0;i<e.symbolInstances.length;i++){const t=e.symbolInstances.get(i);t.crossTileID||(t.crossTileID=n.generate(),r[t.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Bt(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const n in e.indexedSymbolInstances)for(const r of e.indexedSymbolInstances[n])delete this.usedCrossTileIDs[t][r.crossTileID]}removeStaleBuckets(t){let e=!1;for(const n in this.indexes){const r=this.indexes[n];for(const i in r)t[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],e=!0)}return e}}class Gt{constructor(){this.layerIndexes={},this.crossTileIDs=new Ut,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,n){let r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new jt);let i=!1;const o={};r.handleWrapJump(n);for(const a of e){const e=a.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(a.tileID,e,this.crossTileIDs)&&(i=!0),o[e.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const n in this.layerIndexes)e[n]||delete this.layerIndexes[n]}}const Vt=(e,n)=>t.emitValidationErrors(e,n&&n.filter(t=>"source.canvas"!==t.identifier)),Ht=t.pick(q,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain"]),Wt=t.pick(q,["setCenter","setZoom","setBearing","setPitch"]),qt=function(){const e={},n=t.styleSpec.$version;for(const r in t.styleSpec.$root){const i=t.styleSpec.$root[r];if(i.required){let t=null;t="version"===r?n:"array"===i.type?[]:{},null!=t&&(e[r]=t)}}return e}();class Xt extends t.Evented{constructor(e,n={}){super(),this.map=e,this.dispatcher=new E(V(),this),this.imageManager=new h,this.imageManager.setEventedParent(this),this.glyphManager=new v(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new M(256,512),this.crossTileSymbolIndex=new Gt,this._layers={},this._num3DLayers=0,this._serializedLayers={},this._order=[],this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const r=this;this._rtlTextPluginCallback=Xt.registerForPluginStateChange(e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,n)=>{if(t.triggerPluginCompletionEvent(e),n&&n.every(t=>t))for(const t in r._sourceCaches){const e=r._sourceCaches[t],n=e.getSource().type;"vector"!==n&&"geojson"!==n||e.reload()}})}),this.on("data",t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getSource(t.sourceId);if(e&&e.vectorLayerIds)for(const n in this._layers){const t=this._layers[n];t.source===e.id&&this._validateLayer(t)}})}loadURL(e,n={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);const i=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(i,(e,n)=>{this._request=null,e?this.fire(new t.ErrorEvent(e)):n&&this._load(n,r)})}loadJSON(e,n={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame(()=>{this._request=null,this._load(e,!1!==n.validate)})}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(qt,!1)}_load(e,n){if(n&&Vt(this,t.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e;for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);const r=W(this.stylesheet.layers);this._order=r.map(t=>t.id),this._layers={},this._serializedLayers={};for(let i of r)i=t.createStyleLayer(i),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize(),i.is3D()&&this._num3DLayers++;this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new x(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}_loadSprite(e){this._spriteRequest=function(e,n,r){let i,o,a;const s=t.browser.devicePixelRatio>1?"@2x":"";let l=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(t,e)=>{l=null,a||(a=t,i=e,u())}),c=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(t,e)=>{c=null,a||(a=t,o=e,u())});function u(){if(a)r(a);else if(i&&o){const e=t.browser.getImageData(o),n={};for(const r in i){const{width:o,height:a,x:s,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:p,content:d}=i[r],f=new t.RGBAImage({width:o,height:a});t.RGBAImage.copy(e,f,{x:s,y:l},{x:0,y:0},{width:o,height:a}),n[r]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:p,content:d}}r(null,n)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,(e,n)=>{if(this._spriteRequest=null,e)this.fire(new t.ErrorEvent(e));else if(n)for(const t in n)this.imageManager.addImage(t,n[t]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))})}_validateLayer(e){const n=this.getSource(e.source);if(!n)return;const r=e.sourceLayer;r&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const n of t){const t=this._layers[n];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(!this._loaded)return;const n=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(t.length||n.length)&&this._updateWorkerLayers(t,n);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const r in this._updatedPaintProps)this._layers[r].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const r={};for(const t in this._sourceCaches){const e=this._sourceCaches[t];r[t]=e.used,e.used=!1}for(const t of this._order){const n=this._layers[t];if(n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)){const t=this._getLayerSourceCache(n);t&&(t.used=!0)}const r=this.map.painter;if(r){const t=n.getProgramIds();if(!t)continue;const i=n.getProgramConfiguration(e.zoom);for(const e of t)r.useProgram(e,i)}}for(const i in r){const e=this._sourceCaches[i];r[i]!==e.used&&e.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),Vt(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=W(e.layers);const n=function(e,n){if(!e)return[{command:q.setStyle,args:[n]}];let r=[];try{if(!t.deepEqual(e.version,n.version))return[{command:q.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||r.push({command:q.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||r.push({command:q.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||r.push({command:q.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||r.push({command:q.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||r.push({command:q.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||r.push({command:q.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||r.push({command:q.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||r.push({command:q.setLight,args:[n.light]});const i={},o=[];!function(e,n,r,i){let o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Z(o,r,i));for(o in n)n.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],n[o])||("geojson"===e[o].type&&"geojson"===n[o].type&&$(e,n,o)?r.push({command:q.setGeoJSONSourceData,args:[o,n[o].data]}):Y(o,n,r,i)):X(o,n,r))}(e.sources,n.sources,o,i);const a=[];e.layers&&e.layers.forEach(t=>{i[t.source]?r.push({command:q.removeLayer,args:[t.id]}):a.push(t)});let s=e.terrain;s&&i[s.source]&&(r.push({command:q.setTerrain,args:[void 0]}),s=void 0),r=r.concat(o),t.deepEqual(s,n.terrain)||r.push({command:q.setTerrain,args:[n.terrain]}),function(e,n,r){n=n||[];const i=(e=e||[]).map(K),o=n.map(K),a=e.reduce(Q,{}),s=n.reduce(Q,{}),l=i.slice(),c=Object.create(null);let u,h,p,d,f,m,g;for(u=0,h=0;u<i.length;u++)p=i[u],s.hasOwnProperty(p)?h++:(r.push({command:q.removeLayer,args:[p]}),l.splice(l.indexOf(p,h),1));for(u=0,h=0;u<o.length;u++)p=o[o.length-1-u],l[l.length-1-u]!==p&&(a.hasOwnProperty(p)?(r.push({command:q.removeLayer,args:[p]}),l.splice(l.lastIndexOf(p,l.length-h),1)):h++,m=l[l.length-u],r.push({command:q.addLayer,args:[s[p],m]}),l.splice(l.length-u,0,p),c[p]=!0);for(u=0;u<o.length;u++)if(p=o[u],d=a[p],f=s[p],!c[p]&&!t.deepEqual(d,f))if(t.deepEqual(d.source,f.source)&&t.deepEqual(d["source-layer"],f["source-layer"])&&t.deepEqual(d.type,f.type)){for(g in J(d.layout,f.layout,r,p,null,q.setLayoutProperty),J(d.paint,f.paint,r,p,null,q.setPaintProperty),t.deepEqual(d.filter,f.filter)||r.push({command:q.setFilter,args:[p,f.filter]}),t.deepEqual(d.minzoom,f.minzoom)&&t.deepEqual(d.maxzoom,f.maxzoom)||r.push({command:q.setLayerZoomRange,args:[p,f.minzoom,f.maxzoom]}),d)d.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?J(d[g],f[g],r,p,g.slice(6),q.setPaintProperty):t.deepEqual(d[g],f[g])||r.push({command:q.setLayerProperty,args:[p,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!d.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?J(d[g],f[g],r,p,g.slice(6),q.setPaintProperty):t.deepEqual(d[g],f[g])||r.push({command:q.setLayerProperty,args:[p,g,f[g]]}))}else r.push({command:q.removeLayer,args:[p]}),m=l[l.lastIndexOf(p)+1],r.push({command:q.addLayer,args:[f,m]})}(a,n.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:q.setStyle,args:[n]}]}return r}(this.serialize(),e).filter(t=>!(t.command in Wt));if(0===n.length)return!1;const r=n.filter(t=>!(t.command in Ht));if(r.length>0)throw new Error(`Unimplemented: ${r.map(t=>t.command).join(", ")}.`);return n.forEach(t=>{"setTransition"!==t.command&&this[t.command].apply(this,t.args)}),this.stylesheet=e,!0}addImage(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,r={}){if(this._checkLoaded(),void 0!==this.getSource(e))throw new Error("There is already a source with this ID");if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,r))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const i=D(e,n,this.dispatcher,this);i.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:i.serialize(),sourceId:e}));const o=n=>{const r=(n?"symbol:":"other:")+e,o=this._sourceCaches[r]=new t.SourceCache(r,i,n);(n?this._symbolSourceCaches:this._otherSourceCaches)[e]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),i.onAdd&&i.onAdd(this.map),this._changed=!0}removeSource(e){this._checkLoaded();const n=this.getSource(e);if(void 0===n)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const r=this._getSourceCaches(e);for(const i of r)delete this._sourceCaches[i.id],delete this._updatedSources[i.id],i.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles();delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getSource(t).setData(e),this._changed=!0}getSource(t){const e=this._getSourceCache(t);return e&&e.getSource()}addLayer(e,n,r={}){this._checkLoaded();const i=e.id;if(this.getLayer(i))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" already exists on this map`)));let o;if("custom"===e.type){if(Vt(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize(),o.is3D()&&this._num3DLayers++}const a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o;const s=this._getLayerSourceCache(o);if(this._removedLayers[i]&&o.source&&s&&"custom"!==o.type){const t=this._removedLayers[i];delete this._removedLayers[i],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",s.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const r=this._order.indexOf(e);this._order.splice(r,1);const i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)));n.setEventedParent(null),n.is3D()&&this._num3DLayers--;const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(e,n,r){this._checkLoaded();const i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(e,n,r={}){this._checkLoaded();const i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,`layers.${i.id}.filter`,n,null,r)||(i.filter=t.clone$1(n),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){return t.clone$1(this.getLayer(e).filter)}setLayoutProperty(e,n,r,i={}){this._checkLoaded();const o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,n){const r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(e,n,r,i={}){this._checkLoaded();const o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(n),r)||(o.setPaintProperty(n,r,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(e,n){this._checkLoaded();const r=e.source,i=e.sourceLayer,o=this.getSource(r);if(void 0===o)return void this.fire(new t.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const a=o.type;if("geojson"===a&&i)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!i)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));const s=this._getSourceCaches(r);for(const t of s)t.setFeatureState(i,e.id,n)}removeFeatureState(e,n){this._checkLoaded();const r=e.source,i=this.getSource(r);if(void 0===i)return void this.fire(new t.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const o=i.type,a="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!a)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const s=this._getSourceCaches(r);for(const t of s)t.removeFeatureState(a,e.id,n)}getFeatureState(e){this._checkLoaded();const n=e.source,r=e.sourceLayer,i=this.getSource(n);if(void 0!==i){if("vector"!==i.type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(n)[0].getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e,layers:this._serializeLayers(this._order)},t=>void 0!==t)}_updateLayer(t){this._updatedLayers[t.id]=!0;const e=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&e&&"raster"!==e.getSource().type&&(this._updatedSources[t.source]="reload",e.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,n={},r=[];for(let o=this._order.length-1;o>=0;o--){const i=this._order[o];if(e(i)){n[i]=o;for(const e of t){const t=e[i];if(t)for(const e of t)r.push(e)}}}r.sort((t,e)=>e.intersectionZ-t.intersectionZ);const i=[];for(let o=this._order.length-1;o>=0;o--){const a=this._order[o];if(e(a))for(let t=r.length-1;t>=0;t--){const e=r[t].feature;if(n[e.layer.id]<o)break;i.push(e),r.pop()}else for(const e of t){const t=e[a];if(t)for(const e of t)i.push(e.feature)}}return i}queryRenderedFeatures(e,n,r){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of n.layers){const n=this._layers[e];if(!n)return this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];i[n.source]=!0}}const o=[];n.availableImages=this._availableImages;const a=n&&n.layers?n.layers.some(t=>{const e=this.getLayer(t);return e&&e.is3D()}):this.has3DLayers(),s=T.createFromScreenPoints(e,r);for(const t in this._sourceCaches){const e=this._sourceCaches[t].getSource().id;n.layers&&!i[e]||o.push(k(this._sourceCaches[t],this._layers,this._serializedLayers,s,n,r,a,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,n,r,i,o,a){const s={},l=o.queryRenderedSymbols(r),c=[];for(const u of Object.keys(l).map(Number))c.push(a[u]);c.sort(z);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],e,u.bucketIndex,u.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(const t in n){const e=s[t]=s[t]||[],r=n[t];r.sort((t,e)=>{const n=u.featureSortOrder;if(n){const r=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-r}return e.featureIndex-t.featureIndex});for(const t of r)e.push(t)}}for(const u in s)s[u].forEach(e=>{const r=e.feature,i=n(t[u]).getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=i});return s}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),s.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const r=this._getSourceCaches(e);let i=[];for(const t of r)i=i.concat(F(t,n));return i}addSourceType(t,e,n){return Xt.getSourceType(t)?n(new Error(`A source type called "${t}" already exists.`)):(Xt.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const r=this.light.getLight();let i=!1;for(const a in e)if(!t.deepEqual(e[a],r[a])){i=!0;break}if(!i)return;const o={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(o)}setTerrain(e){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),void this._force3DLayerUpdate();if("object"==typeof e.source){const n="terrain-dem-src";this.addSource(n,e.source),e=t.clone$1(e),e=t.extend(e,{source:n})}if(!this._validate(t.validateStyle.terrain,"terrain",e))if(this.terrain){const n=this.terrain,r=n.get();for(const i in e)if(!t.deepEqual(e[i],r[i])){n.set(e),this.stylesheet.terrain=e;const r={now:t.browser.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(r);break}}else this._createTerrain(e)}_createTerrain(e){const n=this.terrain=new w(e);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const r={now:t.browser.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(r)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_validate(e,n,r,i,o={}){return(!o||!1!==o.validate)&&Vt(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:r,styleSpec:t.styleSpec},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const e=this._getSourceCaches(t);for(const n of e)n.clearTiles()}_reloadSource(t){const e=this._getSourceCaches(t);for(const n of e)n.resume(),n.reload()}_updateSources(t){for(const e in this._sourceCaches)this._sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,n,r,i,o=!1){let a=!1,s=!1;const l={};for(const t of this._order){const n=this._layers[t];if("symbol"!==n.type)continue;if(!l[n.source]){const t=this._getLayerSourceCache(n);if(!t)continue;l[n.source]=t.getRenderableIds(!0).map(e=>t.getTileByID(e)).sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const r=this.crossTileSymbolIndex.addLayer(n,l[n.source],e.center.lng);a=a||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Ft(e,this._order,o,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();const r=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};r(this._otherSourceCaches[e.source]),r(this._symbolSourceCaches[e.source])}getGlyphs(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)}getResource(e,n,r){return t.makeRequest(n,r)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}has3DLayers(){return this._num3DLayers>0}}Xt.getSourceType=function(t){return O[t]},Xt.setSourceType=function(t,e){O[t]=e},Xt.registerForPluginStateChange=t.registerForPluginStateChange;var Zt="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Yt={};Yt=Ae("","#ifdef TERRAIN\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*word/7.3;}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0);const $t=Ae("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nconst float PI=3.141592653589793;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const float PI=3.141592653589793;const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Jt=Ae("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Kt=Ae("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Qt=Ae("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),te=Ae("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ee=Ae("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}"),ne=Ae("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),re=Ae("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ie=Ae("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),oe=Ae("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),ae=Ae("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),se=Ae("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),le=Ae("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ce=Ae("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),ue=Ae("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);gl_Position=mix(u_matrix*vec4(pos_nx.xy,h,1),AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(pos_nx.xy,t > 0.0 ? height : base,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),he=Ae("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);gl_Position=mix(u_matrix*vec4(pos_nx.xy,h,1),AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(pos_nx.xy,z,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),pe=Ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),de=Ae("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),fe=Ae("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);}"),me=Ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);}"),ge=Ae("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),ye=Ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),ve=Ae("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),_e=Ae("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),xe=Ae("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),be=Ae("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),we=Ae("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;const float skirtOffset=24575.0;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);}"),Me=Ae("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),Ee=Ae("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(vec3(p.xyx)*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;color.rgb+=rnd/255.0;return color;}float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Zt),Se=Ae("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(vec3(p.xyx)*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;color.rgb+=rnd/255.0;return color;}void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5))*u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Zt),Te=Ae("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}");function Ae(t,e,n){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),o=t.match(/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=e.match(/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g);let s=a?a.concat(o):o;n||(s=Yt.staticUniforms.concat(s));const l={};return{fragmentSource:t=t.replace(r,(t,e,n,r,i)=>(l[i]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nvarying ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = u_${i};\n#endif\n`)),vertexSource:e=e.replace(r,(t,e,n,r,i)=>{const o="float"===r?"vec2":"vec4",a=i.match(/color/)?"color":o;return l[i]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${n} ${o} a_${i};\nvarying ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = unpack_mix_${a}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${n} ${o} a_${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = unpack_mix_${a}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`}),staticAttributes:i,staticUniforms:s}}var Ce=Object.freeze({__proto__:null,get preludeTerrain(){return Yt},prelude:$t,background:Jt,backgroundPattern:Kt,circle:Qt,clippingMask:te,heatmap:ee,heatmapTexture:ne,collisionBox:re,collisionCircle:ie,debug:oe,fill:ae,fillOutline:se,fillOutlinePattern:le,fillPattern:ce,fillExtrusion:ue,fillExtrusionPattern:he,hillshadePrepare:pe,hillshade:de,line:fe,lineGradient:me,linePattern:ge,lineSDF:ye,raster:ve,symbolIcon:_e,symbolSDF:xe,symbolTextAndIcon:be,terrainRaster:we,terrainDepth:Me,skybox:Ee,skyboxGradient:Se,skyboxCapture:Te});class Le{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,n,r,i,o,a,s){this.context=t;let l=this.boundPaintVertexBuffers.length!==r.length;for(let c=0;!l&&c<r.length;c++)this.boundPaintVertexBuffers[c]!==r[c]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!l&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,n,r,i,o,a,s)}freshBind(t,e,n,r,i,o,a){let s;const l=t.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=c.currentNumAttributes||0;for(let t=l;t<s;t++)u.disableVertexAttribArray(t)}e.enableAttributes(u,t);for(const h of n)h.enableAttributes(u,t);o&&o.enableAttributes(u,t),a&&a.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,i);for(const h of n)h.bind(),h.setVertexAttribPointers(u,t,i);o&&(o.bind(),o.setVertexAttribPointers(u,t,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(u,t,i)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ie(e,n){const r=Math.pow(2,n.canonical.z),i=n.canonical.y;return[new t.MercatorCoordinate(0,i/r).toLngLat().lat,new t.MercatorCoordinate(0,(i+1)/r).toLngLat().lat]}function Pe(e,n,r,i,o,a,s){const l=e.context,c=l.gl,u=r.fbo;if(!u)return;e.prepareDrawTile(n);const h=e.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const p=((t,e,n,r)=>{const i=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),a=n.paint.get("hillshade-accent-color");let s=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(s-=t.transform.angle);const l=!t.options.moving;return{u_matrix:r||t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:Ie(0,e.tileID),u_light:[n.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}})(e,r,i,e.terrain?n.posMatrix:null);h.draw(l,c.TRIANGLES,o,a,s,t.CullFaceMode.disabled,p,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}function Re(e,n,r){if(!n.needsDEMTextureUpload)return;const i=e.context,o=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(r.stride);const a=r.getPixels();n.demTexture?n.demTexture.update(a,{premultiply:!1}):n.demTexture=new t.Texture(i,a,o.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Oe(e,n,r,i,o,a){const s=e.context,l=s.gl;if(!n.dem)return;const c=n.dem;if(s.activeTexture.set(l.TEXTURE1),Re(e,n,c),!n.demTexture)return;n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;s.activeTexture.set(l.TEXTURE0);let h=n.fbo;if(!h){const e=new t.Texture(s,{width:u,height:u,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=n.fbo=s.createFramebuffer(u,u,!0),h.colorAttachment.set(e.texture)}s.bindFramebuffer.set(h.framebuffer),s.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,i,o,a,t.CullFaceMode.disabled,((e,n)=>{const r=n.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.unpackVector}})(n.tileID,c),r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}const De=(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image0:new t.Uniform1i(e,n.u_image0),u_skirt_height:new t.Uniform1f(e,n.u_skirt_height)}),Ne=(t,e)=>({u_matrix:t,u_image0:0,u_skirt_height:e}),ke=new class{constructor(){this.operations={}}newMorphing(t,e,n,r,i){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==n.tileID.key&&(e.queued=n)}else this.operations[t]={startTime:r,phase:0,duration:i,from:e,to:n,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const n=this.operations[e];for(n.phase=(t-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},Fe={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ze(e,n,r,i,o){const a=e.context,s=a.gl;let l=e.useProgram("terrainRaster"),c=0;const u=e.colorModeForRenderPass(),h=new t.DepthMode(s.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);ke.update(o);const p=e.transform,d=6*Math.pow(1.5,22-p.zoom)*n.exaggeration();var f,m,g;for(const y of i){const i=r.getTile(y),v=t.StencilMode.disabled,_=n.prevTerrainTileForTile[y.key],x=n.terrainTileForTile[y.key];g=x,null!=(m=_)&&null!=g&&m.hasData()&&g.hasData()&&null!=m.demTexture&&null!=g.demTexture&&m.tileID.key!==g.tileID.key&&ke.newMorphing(y.key,_,x,o,250),a.activeTexture.set(s.TEXTURE0),i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);const b=ke.getMorphValuesForProxy(y.key),w=b?1:0;let M;b&&(M={morphing:{srcDemTile:b.from,dstDemTile:b.to,phase:t.easeCubicInOut(b.phase)}});const E=Ne(y.posMatrix,Be(y.canonical,p.renderWorldCopies)?d/10:d);c!==(f=w)&&(l=e.useProgram("terrainRaster",null,Fe[f]),c=f),n.setupElevationDraw(i,l,M),l.draw(a,s.TRIANGLES,h,v,u,t.CullFaceMode.backCCW,E,"terrain_raster",n.gridBuffer,n.gridIndexBuffer,n.gridSegments)}}function Be(t,e){const n=1<<t.z;return!e&&(0===t.x||t.x===n-1)||0===t.y||t.y===n-1}const Ue=t=>({u_matrix:t});function je(e,n,r,i,o){if(o>0){const a=t.browser.now(),s=(a-e.timeAdded)/o,l=n?(a-n.timeAdded)/o:-1,c=r.getSource(),u=i.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),p=h&&e.refreshedUponExpiration?1:t.clamp(h?s:1-l,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const Ge={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ve extends t.SourceCache{constructor(t){const e=D("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new E(V(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,n,r){if(e.freezeTileCoverage)return;this.transform=e;const i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,useElevationData:!0}).reduce((n,r)=>{if(n[r.key]="",!this._tiles[r.key]){const n=new t.Tile(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom);n.state="loaded",this._tiles[r.key]=n}return n},{});for(const t in this._tiles)t in i||(this.freeFBO(t),this._tiles[t].state="unloaded",delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];void 0!==e&&(this.renderCachePool.push(e),delete this.proxyCachedFBO[t])}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class He extends t.OverscaledTileID{constructor(t,e,n){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.posMatrix=n}}class We extends t.Elevation{constructor(e,n){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,i,o]=function(e){const n=new t.StructArrayLayout4i8,r=new t.StructArrayLayout3ui6;n.reserve(17161),r.reserve(33800);const i=t.EXTENT/128,o=t.EXTENT+i/2,a=o+i;for(let l=-i;l<a;l+=i)for(let e=-i;e<a;e+=i){const r=e<0||e>o||l<0||l>o?24575:0,i=t.clamp(Math.round(e),0,t.EXTENT),a=t.clamp(Math.round(l),0,t.EXTENT);n.emplaceBack(i+r,a,i,a)}const s=(t,e)=>{const n=131*e+t;r.emplaceBack(n+1,n,n+131),r.emplaceBack(n+131,n+131+1,n+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)s(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)s(e,t),s(t,e)}),[n,r,32768]}(),a=e.context;this.gridBuffer=a.createVertexBuffer(r,P.members),this.gridIndexBuffer=a.createIndexBuffer(i),this.gridSegments=t.SegmentVector.simpleSegment(0,0,r.length,i.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ve(n.map),this.orthoMatrix=t.create(),t.ortho(this.orthoMatrix,0,t.EXTENT,0,t.EXTENT,0,1);const s=a.gl;this._overlapStencilMode=new t.StencilMode({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,n.on("data",this._onStyleDataEvent.bind(this))}update(e,n,r){if(e&&e.terrain){this.style!==e&&(e.on("data",this._onStyleDataEvent.bind(this)),this.style=e),this.enabled=!0;const i=e.terrain.properties;this.sourceCache=e._getSourceCache(i.get("source")),this._exaggeration=i.get("exaggeration");const o=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.sourceCache.getSource().tileSize/128,r=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(n,e*r,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),n.updateElevation(!r),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(n),this._depthDone=!1,this._emptyDEMTextureDirty=!0}else this._disable()}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this.proxySourceCache.deallocRenderCache(),this.painter.style))for(const t in this.painter.style._sourceCaches)this.painter.style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPoint(t.MercatorCoordinate.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const i=this.painter.options;this.drapeFirst=(i.zooming||i.moving||i.rotating||!!this.forceDrapeFirst)&&!this._invalidateRenderCache,this._invalidateRenderCache=!1;const o=this.proxyCoords=n.getIds().map(t=>{const e=n.getTileByID(t).tileID;return e.posMatrix=r.calculatePosMatrix(e.toUnwrapped()),e});!function(e,n){const r=n.transform.pointCoordinate(n.transform.getCameraPoint()),i=new t.Point(r.x,r.y);e.sort((e,n)=>{if(n.overscaledZ-e.overscaledZ)return n.overscaledZ-e.overscaledZ;const r=new t.Point(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.Point(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),a=i.mult(1<<e.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(r)-a.distSqr(o)})}(o,this.painter),this._previousZoom=r.zoom;const a=this.proxyToSource||{};this.proxyToSource={},o.forEach(t=>{this.proxyToSource[t.key]={}}),this.terrainTileForTile={};const s=this.painter.style._sourceCaches;for(const t in s){const n=s[t];if(!n.used)continue;if(n!==this.sourceCache&&(this._findCoveringTileCache[n.id]={}),this._setupProxiedCoordsForOrtho(n,e[t],a),n.usedForTerrain)continue;const r=e[t];n.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[n.id]=o.map(t=>new He(t,t.key,this.orthoMatrix)),this._assignTerrainTiles(o),this._prepareDEMTextures(),this._setupRenderCache(a),this.drapeFirstPending=this.drapeFirst,this.renderingToTexture=!1,this._initFBOPool(),this._updateTimestamp=t.browser.now();const l={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const n=e.tileID.key;n in l||(this._visibleDemTiles.push(e),l[n]=n)}}_assignTerrainTiles(t){this._initializing||t.forEach(t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)})}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const n in this.terrainTileForTile){const r=this.terrainTileForTile[n],i=r.dem;!i||r.demTexture&&!r.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),Re(this.painter,r,i))}}_prepareDemTileUniforms(t,e,n,r){if(!e||null==e.demTexture)return!1;const i=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-i.z),a=r||"";return n["u_dem_tl"+a]=[i.x*o%1,i.y*o%1],n["u_dem_scale"+a]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce((e,n)=>{if(!n.dem)return e;const r=n.dem.tree.minimums[0];return r>0&&t++,e+r},0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,n=e.gl;e.activeTexture.set(n.TEXTURE2);const r=this._getLoadedAreaMinimum(),i={width:1,height:1,data:new Uint8Array(t.DEMData.pack(r,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(i,{premultiply:!1}):o=this._emptyDEMTexture=new t.Texture(e,i,n.RGBA,{premultiply:!1}),o}setupElevationDraw(e,n,r){const i=this.painter.context,o=i.gl,a=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var s;a.u_dem_size=this.sourceCache.getSource().tileSize,a.u_exaggeration=this.exaggeration();let l=null,c=null,u=1;if(r&&r.morphing){const t=r.morphing.srcDemTile,n=r.morphing.dstDemTile;u=r.morphing.phase,t&&n&&(this._prepareDemTileUniforms(e,t,a,"_prev")&&(c=t),this._prepareDemTileUniforms(e,n,a)&&(l=n))}if(c&&l?(i.activeTexture.set(o.TEXTURE2),l.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),i.activeTexture.set(o.TEXTURE4),c.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),a.u_dem_lerp=u):(l=this.terrainTileForTile[e.tileID.key],i.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(e,l,a)?l.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST)),r&&r.useDepthForOcclusion&&(i.activeTexture.set(o.TEXTURE3),this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),r&&r.useMeterToDem&&l){const e=(1<<l.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=e}r&&r.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),n.setTerrainUniformValues(i,a)}renderLayer(t,e){return"translucent"!==this.painter.renderPass?(this._depthDone||"symbol"!==t.type&&"circle"!==t.type||this.drawDepth(),!0):this.drapeFirst&&this.drapeFirstPending?(this.render(),this.drapeFirstPending=!1,!0):!!this._isLayerDrapedOverTerrain(t)&&(this.drapeFirst&&!this.renderingToTexture||this.render(),!0)}render(){this.renderingToTexture=!0;const e=this.painter,n=this.painter.context,r=this.proxySourceCache,i=this.proxiedCoords[r.id],o=()=>{n.bindFramebuffer.set(null),n.viewport.set([0,0,e.width,e.height]),this.renderingToTexture=!1},a=e.currentLayer;let s=a,l=[];const c=e.style._order;let u=0;for(let h=0;h<i.length;h++){const p=i[h],d=r.getTileByID(p.proxyTileKey),f=r.proxyCachedFBO[p.key],m=this.currentFBO=void 0!==f?r.renderCache[f]:this.pool[u++];if(d.texture=m.tex,void 0!==f&&!m.dirty){l.push(d.tileID);continue}let g;for(n.bindFramebuffer.set(m.fb.framebuffer),this.renderedToTile=!1,m.dirty&&(n.clear({color:t.Color.transparent}),m.dirty=!1),e.currentLayer=a;e.currentLayer<c.length;e.currentLayer++){const t=e.style._layers[c[e.currentLayer]],r=t.isHidden(e.transform.zoom),i=this._isLayerDrapedOverTerrain(t);if(this.drapeFirst&&!i)continue;if(e.currentLayer>s){if(!r&&!i)break;s++}if(r)continue;const o=this.painter.style._getLayerSourceCache(t),a=o?this.proxyToSource[p.key][o.id]:[p];if(!a)continue;const l=a;n.viewport.set([0,0,m.fb.width,m.fb.height]),g!==(o?o.id:null)&&(this._setupStencil(a,t,o),g=o?o.id:null),e.renderLayer(e,o,t,l)}m.dirty=this.renderedToTile,this.renderedToTile&&l.push(d.tileID),5===u&&(u=0,l.length>0&&(o(),ze(e,this,r,l,this._updateTimestamp),this.renderingToTexture=!0,l=[]))}o(),l.length>0&&ze(e,this,r,l,this._updateTimestamp),e.currentLayer=this.drapeFirst?-1:s}raycast(t,e,n){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter(t=>t.dem).map(r=>{const i=r.tileID,o=Math.pow(2,i.overscaledZ),{x:a,y:s}=i.canonical,l=a/o,c=(a+1)/o,u=s/o,h=(s+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:r.dem.tree.raycastRoot(l,u,c,h,t,e,n),tile:r}});r.sort((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE));for(const i of r){if(null==i.t)return null;const r=i.tile.dem.tree.raycast(i.minx,i.miny,i.maxx,i.maxy,t,e,n);if(null!=r)return r}return null}_createFBO(){const e=this.painter.context,n=e.gl,r=this.drapeBufferSize;e.activeTexture.set(n.TEXTURE0);const i=new t.Texture(e,{width:r[0],height:r[1],data:null},n.RGBA);i.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=e.createFramebuffer(r[0],r[1],!1);return o.colorAttachment.set(i.texture),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:i,dirty:!1,ref:1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){return!this.drapeFirst||this.painter.style._order.some(t=>{const e=this.painter.style._layers[t],n=!e.isHidden(this.painter.transform.zoom),r=e.getCrossfadeParameters();return"custom"!==e.type&&!n&&!!r&&1!==r.t})}_clearRasterFadeFromRenderCache(){for(const t in this.painter.style._sourceCaches)if(!(this.painter.style._sourceCaches[t]._source instanceof I))return;for(let t=0;t<this.painter.style._order.length;++t){const e=this.painter.style._layers[this.painter.style._order[t]],n=e.isHidden(this.painter.transform.zoom),r=this.painter.style._getLayerSourceCache(e);if("raster"!==e.type||n||!r)continue;const i=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e){const e=je(r.getTile(t),r.findLoadedParent(t,0),r,this.painter.transform,i);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(r.id,t)}}}}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()){if(e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={},e.renderCachePool=e.renderCachePool.concat(t)}return}this._clearRasterFadeFromRenderCache();const n=this.proxyCoords,r=this._tilesDirty;for(let i=n.length-1;i>=0;i--){const o=n[i];if(e.getTileByID(o.key),void 0!==e.proxyCachedFBO[o.key]){const n=t[o.key],i=this.proxyToSource[o.key];let a=0;for(const t in i){const e=i[t],o=n[t];if(!o||o.length!==e.length||e.some((e,n)=>e!==o[n]||r[t]&&r[t].hasOwnProperty(e.key))){a=-1;break}++a}e.renderCache[e.proxyCachedFBO[o.key]].dirty=a<0||a!==Object.values(n).length}else{let t=e.renderCachePool.pop();void 0===t&&e.renderCache.length<50&&(t=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==t&&(e.proxyCachedFBO[o.key]=t,e.renderCache[t].dirty=!0)}}this._tilesDirty={}}_setupStencil(e,n,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,o=i.gl;if(e.length<=1)return void(this._overlapStencilType=!1);const a=this.currentFBO,s=a.fb;let l;if(n.isTileClipped())l=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);l=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}if(!s.depthAttachment){const e=i.createRenderbuffer(i.gl.DEPTH_STENCIL,s.width,s.height);s.depthAttachment=new t.DepthStencilAttachment(i,s.framebuffer),s.depthAttachment.set(e),i.clear({stencil:0})}a.ref+l>255&&(i.clear({stencil:0}),a.ref=0),a.ref+=l,this._overlapStencilMode.ref=a.ref,n.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(e,n){const r=this.painter,i=this.painter.context,o=i.gl;r._tileClippingMaskIDs={},i.setColorMode(t.ColorMode.disabled),i.setDepthMode(t.DepthMode.disabled);const a=r.useProgram("clippingMask");for(const s of e){const e=r._tileClippingMaskIDs[s.key]=--n;a.draw(i,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,Ue(s.posMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(e){const n=this.painter.transform;if(e.x<0||e.x>n.width||e.y<0||e.y>n.height)return null;const r=[e.x,e.y,1,1];t.transformMat4(r,r,n.pixelMatrixInverse),t.scale$1(r,r,1/r[3]),r[0]/=n.worldSize,r[1]/=n.worldSize;const i=n._camera.position,o=t.mercatorZfromAltitude(1,n.center.lat),a=[i[0],i[1],i[2]/o,0],s=t.subtract([],r.slice(0,3),a);t.normalize(s,s);const l=this.raycast(a,s,this._exaggeration);return null!==l&&l?(t.scaleAndAdd(a,a,s,l),a[3]=a[2],a[2]*=o,a):null}drawDepth(){const e=this.painter,n=e.context,r=this.proxySourceCache,i=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===i&&this._depthFBO.height===o||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const e=n.gl,r=n.createFramebuffer(i,o,!0);n.activeTexture.set(e.TEXTURE0);const a=new t.Texture(n,{width:i,height:o,data:null},e.RGBA);a.bind(e.NEAREST,e.CLAMP_TO_EDGE),r.colorAttachment.set(a.texture);const s=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,i,o);r.depthAttachment.set(s),this._depthFBO=r,this._depthTexture=a}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,i,o]),function(e,n,r,i){const o=e.context,a=o.gl;o.clear({depth:1});const s=e.useProgram("terrainDepth"),l=new t.DepthMode(a.LESS,t.DepthMode.ReadWrite,e.depthRangeFor3D);for(const c of i){const e=r.getTile(c),i=Ne(c.posMatrix,0);n.setupElevationDraw(e,s),s.draw(o,a.TRIANGLES,l,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,i,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}(e,this,r,this.proxyCoords),n.bindFramebuffer.set(null),n.viewport.set([0,0,e.width,e.height]),this._depthDone=!0}_isLayerDrapedOverTerrain(t){return!!this.enabled&&Ge.hasOwnProperty(t.type)}_setupProxiedCoordsForOrtho(t,e,n){if(t.getSource()instanceof R)return this._setupProxiedCoordsForImageSource(t,e,n);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],i=this.proxyCoords;for(let a=0;a<i.length;a++){const e=i[a],o=this._findTileCoveringTileID(e,t);if(o){const i=this._createProxiedId(e,o,n[e.key]&&n[e.key][t.id]);r.push(i),this.proxyToSource[e.key][t.id]=[i]}}let o=!1;for(let a=0;a<e.length;a++){const i=t.getTile(e[a]);if(!i||!i.hasData())continue;const s=this._findTileCoveringTileID(i.tileID,this.proxySourceCache);if(s&&s.tileID.canonical.z!==i.tileID.canonical.z){const e=this.proxyToSource[s.tileID.key][t.id],a=this._createProxiedId(s.tileID,i,n[s.tileID.key]&&n[s.tileID.key][t.id]);e?e.splice(e.length-1,0,a):this.proxyToSource[s.tileID.key][t.id]=[a],r.push(a),o=!0}}this._sourceTilesOverlap[t.id]=o}_setupProxiedCoordsForImageSource(e,n,r){if(!e.getSource().loaded())return;const i=this.proxiedCoords[e.id]=[],o=this.proxyCoords,a=e.getSource(),s=new t.Point(a.tileID.x,a.tileID.y)._div(1<<a.tileID.z),l=a.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce((t,e)=>(t.min.x=Math.min(t.min.x,e.x-s.x),t.min.y=Math.min(t.min.y,e.y-s.y),t.max.x=Math.max(t.max.x,e.x-s.x),t.max.y=Math.max(t.max.y,e.y-s.y),t),{min:new t.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,n)=>{const r=e.wrap+e.canonical.x/(1<<e.canonical.z),i=e.canonical.y/(1<<e.canonical.z),o=t.EXTENT/(1<<e.canonical.z),a=n.wrap+n.canonical.x/(1<<n.canonical.z),s=n.canonical.y/(1<<n.canonical.z);return r+o<a+l.min.x||r>a+l.max.x||i+o<s+l.min.y||i>s+l.max.y};for(let t=0;t<o.length;t++){const a=o[t];for(let t=0;t<n.length;t++){const o=e.getTile(n[t]);if(!o||!o.hasData())continue;if(c(a,o.tileID))continue;const s=this._createProxiedId(a,o,r[a.key]&&r[a.key][e.id]),l=this.proxyToSource[a.key][e.id];l?l.push(s):this.proxyToSource[a.key][e.id]=[s],i.push(s)}}}_createProxiedId(e,n,r){let i=this.orthoMatrix;if(r){const t=r.find(t=>t.key===n.tileID.key);if(t)return t}if(n.tileID.key!==e.key){const r=e.canonical.z-n.tileID.canonical.z;let o,a,s;i=t.create();const l=n.tileID.wrap-e.wrap<<e.overscaledZ;r>0?(o=t.EXTENT>>r,a=o*((n.tileID.canonical.x<<r)-e.canonical.x+l),s=o*((n.tileID.canonical.y<<r)-e.canonical.y)):(o=t.EXTENT<<-r,a=t.EXTENT*(n.tileID.canonical.x-(e.canonical.x+l<<-r)),s=t.EXTENT*(n.tileID.canonical.y-(e.canonical.y<<-r))),t.ortho(i,0,o,0,o,0,1),t.translate(i,i,[a,s,0])}return new He(n.tileID,e.key,i)}_findTileCoveringTileID(e,n){let r=n.getTile(e);if(r&&r.hasData())return r;const i=this._findCoveringTileCache[n.id],o=i[e.key];if(r=o?n.getTileByID(o):null,r&&r.hasData()||null===o)return r;let a=r?r.tileID:e,s=a.overscaledZ;const l=n.getSource().minzoom,c=[];if(!o){const i=n.getSource().maxzoom;if(e.canonical.z>=i){const r=e.canonical.z-i;n.getSource().reparseOverscaled?(s=Math.max(e.canonical.z+2,n.transform.tileZoom),a=new t.OverscaledTileID(s,e.wrap,i,e.canonical.x>>r,e.canonical.y>>r)):0!==r&&(s=i,a=new t.OverscaledTileID(s,e.wrap,i,e.canonical.x>>r,e.canonical.y>>r))}a.key!==e.key&&(c.push(a.key),r=n.getTile(a))}const u=t=>{c.forEach(e=>{i[e]=t}),c.length=0};for(s-=1;s>=l&&(!r||!r.hasData());s--){r&&u(r.tileID.key);const t=a.calculateScaledKey(s);if(r=n.getTileByID(t),r&&r.hasData())break;const e=i[t];if(null===e)break;void 0===e?c.push(t):r=n.getTileByID(e)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile||(this.renderedToTile=!0)}_clearRenderCacheForTile(t,e){let n=this._tilesDirty[t];n||(n=this._tilesDirty[t]={}),n[e.key]=!0}}function qe(t){const e=[];for(let n=0;n<t.length;n++){if(null===t[n])continue;const r=t[n].split(" ");e.push(r.pop())}return e}class Xe{static cacheKey(t,e,n){let r=`${t}${n?n.cacheKey:""}`;for(const i of e)r+="/"+i;return r}constructor(e,n,r,i,o,a){const s=e.gl;this.program=s.createProgram();const l=qe(r.staticAttributes),c=i?i.getBinderAttributes():[],u=l.concat(c),h=r.staticUniforms?qe(r.staticUniforms):[],p=i?i.getBinderUniforms():[],d=h.concat(p),f=[];for(const t of d)f.indexOf(t)<0&&f.push(t);let m=i?i.defines():[];m=m.concat(a.map(t=>"#define "+t));const g=m.concat($t.fragmentSource,r.fragmentSource).join("\n"),y=m.concat($t.vertexSource,Yt.vertexSource,r.vertexSource).join("\n"),v=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(v,g),s.compileShader(v),s.attachShader(this.program,v);const _=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(_,y),s.compileShader(_),s.attachShader(this.program,_),this.attributes={};const x={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(s.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);s.linkProgram(this.program),s.deleteShader(_),s.deleteShader(v);for(let t=0;t<f.length;t++){const e=f[t];if(e&&!x[e]){const t=s.getUniformLocation(this.program,e);t&&(x[e]=t)}}this.fixedUniforms=o(e,x),this.binderUniforms=i?i.getUniforms(e,x):[],-1!==a.indexOf("TERRAIN")&&(this.terrainUniforms=((e,n)=>({u_dem:new t.Uniform1i(e,n.u_dem),u_dem_prev:new t.Uniform1i(e,n.u_dem_prev),u_dem_unpack:new t.Uniform4f(e,n.u_dem_unpack),u_dem_tl:new t.Uniform2f(e,n.u_dem_tl),u_dem_scale:new t.Uniform1f(e,n.u_dem_scale),u_dem_tl_prev:new t.Uniform2f(e,n.u_dem_tl_prev),u_dem_scale_prev:new t.Uniform1f(e,n.u_dem_scale_prev),u_dem_size:new t.Uniform1f(e,n.u_dem_size),u_dem_lerp:new t.Uniform1f(e,n.u_dem_lerp),u_exaggeration:new t.Uniform1f(e,n.u_exaggeration),u_depth:new t.Uniform1i(e,n.u_depth),u_depth_size_inv:new t.Uniform2f(e,n.u_depth_size_inv),u_meter_to_dem:new t.Uniform1f(e,n.u_meter_to_dem),u_label_plane_matrix_inv:new t.UniformMatrix4f(e,n.u_label_plane_matrix_inv)}))(e,x))}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)n[t].set(e[t])}}draw(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m){const g=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(r),t.setColorMode(i),t.setCullFace(o);for(const v in this.fixedUniforms)this.fixedUniforms[v].set(a[v]);d&&d.setUniforms(t,this.binderUniforms,h,{zoom:p});const y={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[e];for(const v of u.get()){const n=v.vaos||(v.vaos={});(n[s]||(n[s]=new Le)).bind(t,this,l,d?d.getPaintVertexBuffers():[],c,v.vertexOffset,f,m),g.drawElements(e,v.primitiveLength*y,g.UNSIGNED_SHORT,v.primitiveOffset*y*2)}}}function Ze(t,e,n){const r=1/S(n,1,e.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=o*(n.tileID.canonical.x+n.tileID.wrap*i),s=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}const Ye=(e,n,r,i)=>{const o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],l=t.create$1();"viewport"===o.properties.get("anchor")&&(t.fromRotation(l,-n.transform.angle),t.transformMat3(s,s,l));const c=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+r,u_opacity:i}},$e=(e,n,r,i,o,a,s)=>t.extend(Ye(e,n,r,i),Ze(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8}),Je=t=>({u_matrix:t}),Ke=(e,n,r,i)=>t.extend(Je(e),Ze(r,n,i)),Qe=(t,e)=>({u_matrix:t,u_world:e}),tn=(e,n,r,i,o)=>t.extend(Ke(e,n,r,i),{u_world:o}),en=(e,n,r,i)=>{const o=e.transform;let a;if("map"===i.paint.get("circle-pitch-alignment")){const t=S(r,1,o.zoom);a=[t,t]}else a=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_matrix:e.translatePosMatrix(n.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},nn=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e},rn=(e,n,r)=>{const i=t.EXTENT/r.tileSize;return{u_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/i,n.pixelsToGLUnits[1]/i]}},on=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),an=(t,e,n,r)=>({u_matrix:t,u_extrude_scale:S(e,1,n),u_intensity:r}),sn=(e,n,r,i)=>{const o=e.transform;return{u_matrix:pn(e,n,r,i),u_ratio:1/S(n,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},ln=(e,n,r,i,o)=>t.extend(sn(e,n,r,i),{u_image:0,u_image_height:o}),cn=(e,n,r,i,o)=>{const a=e.transform,s=hn(n,a);return{u_matrix:pn(e,n,r,o),u_texsize:n.imageAtlasTexture.size,u_ratio:1/S(n,1,a.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[s,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},un=(e,n,r,i,o,a)=>{const s=e.lineAtlas,l=hn(n,e.transform),c="round"===r.layout.get("line-cap"),u=s.getDash(i.from,c),h=s.getDash(i.to,c),p=u.width*o.fromScale,d=h.width*o.toScale;return t.extend(sn(e,n,r,a),{u_patternscale_a:[l/p,-u.height/2],u_patternscale_b:[l/d,-h.height/2],u_sdfgamma:s.width/(256*Math.min(p,d)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:o.t})};function hn(t,e){return 1/S(t,1,e.tileZoom)}function pn(t,e,n,r){return t.translatePosMatrix(r||e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const dn=(t,e,n,r,i)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:fn(i.paint.get("raster-hue-rotate"))};var o,a};function fn(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const mn=(t,e,n,r,i,o,a,s,l,c)=>{const u=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:u.width/u.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0}},gn=(e,n,r,i,o,a,s,l,c,u,h)=>{const p=o.transform;return t.extend(mn(e,n,r,i,o,a,s,l,c,u),{u_gamma_scale:i?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},yn=(e,n,r,i,o,a,s,l,c,u)=>t.extend(gn(e,n,r,i,o,a,s,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1}),vn=(t,e,n)=>({u_matrix:t,u_opacity:e,u_color:n}),_n=(e,n,r,i,o,a)=>t.extend(function(t,e,n,r){const i=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),{width:a,height:s}=n.imageManager.getPixelSize(),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[a,s],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/S(r,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(i,a,r,o),{u_matrix:e,u_opacity:n}),xn={fillExtrusion:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}),fillExtrusionPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}),fill:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),fillPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),fillOutline:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}),fillOutlinePattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),circle:(e,n)=>({u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),collisionBox:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale)}),collisionCircle:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}),debug:(e,n)=>({u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}),clippingMask:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),heatmap:(e,n)=>({u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),heatmapTexture:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}),hillshade:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}),hillshadePrepare:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}),line:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}),lineGradient:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}),linePattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),lineSDF:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}),raster:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}),symbolIcon:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}),symbolSDF:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}),symbolTextAndIcon:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}),background:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}),backgroundPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}),terrainRaster:De,terrainDepth:De,skybox:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_sun_direction:new t.Uniform3f(e,n.u_sun_direction),u_cubemap:new t.Uniform1i(e,n.u_cubemap),u_opacity:new t.Uniform1f(e,n.u_opacity),u_temporal_offset:new t.Uniform1f(e,n.u_temporal_offset)}),skyboxGradient:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_center_direction:new t.Uniform3f(e,n.u_center_direction),u_radius:new t.Uniform1f(e,n.u_radius),u_opacity:new t.Uniform1f(e,n.u_opacity),u_temporal_offset:new t.Uniform1f(e,n.u_temporal_offset)}),skyboxCapture:(e,n)=>({u_matrix_3f:new t.UniformMatrix3f(e,n.u_matrix_3f),u_sun_direction:new t.Uniform3f(e,n.u_sun_direction),u_sun_intensity:new t.Uniform1f(e,n.u_sun_intensity),u_color_tint_r:new t.Uniform4f(e,n.u_color_tint_r),u_color_tint_m:new t.Uniform4f(e,n.u_color_tint_m),u_luminance:new t.Uniform1f(e,n.u_luminance)})};let bn;function wn(e,n,r,i,o,a,s){const l=e.context,c=l.gl,u=e.useProgram("collisionBox"),h=[];let p=0,d=0;for(let x=0;x<i.length;x++){const f=i[x],m=n.getTile(f),g=m.getBucket(r);if(!g)continue;let y=f.posMatrix;0===o[0]&&0===o[1]||(y=e.translatePosMatrix(f.posMatrix,m,o,a));const v=s?g.textCollisionBox:g.iconCollisionBox,_=g.collisionCircleArray;if(_.length>0){const n=t.create(),r=y;t.mul(n,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(n,n,g.placementViewportMatrix),h.push({circleArray:_,circleOffset:d,transform:r,invTransform:n}),p+=_.length/4,d=p}v&&(e.terrain&&e.terrain.setupElevationDraw(m,u),u.draw(l,c.LINES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,rn(y,e.transform,m),r.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,e.transform.zoom,null,v.collisionVertexBuffer,v.collisionVertexBufferExt))}if(!s||!h.length)return;const f=e.useProgram("collisionCircle"),m=new t.StructArrayLayout2f1f2i16;m.resize(4*p),m._trim();let g=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const n=4*e,r=t.circleArray[n+0],i=t.circleArray[n+1],o=t.circleArray[n+2],a=t.circleArray[n+3];m.emplace(g++,r,i,o,a,0),m.emplace(g++,r,i,o,a,1),m.emplace(g++,r,i,o,a,2),m.emplace(g++,r,i,o,a,3)}(!bn||bn.length<2*p)&&(bn=function(e){const n=2*e,r=new t.StructArrayLayout3ui6;r.resize(n),r._trim();for(let t=0;t<n;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(p));const y=l.createIndexBuffer(bn,!0),v=l.createVertexBuffer(m,t.collisionCircleLayout.members,!0);for(const x of h){const n={u_matrix:x.transform,u_inv_matrix:x.invTransform,u_camera_to_center_distance:(_=e.transform).cameraToCenterDistance,u_viewport_size:[_.width,_.height]};f.draw(l,c.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,n,r.id,v,y,t.SegmentVector.simpleSegment(0,2*x.circleOffset,x.circleArray.length,x.circleArray.length/2),null,e.transform.zoom,null,null,null)}var _;v.destroy(),y.destroy()}const Mn=t.identity(new Float32Array(16));function En(e,n,r,i,o,a){const{horizontalAlign:s,verticalAlign:l}=t.getAnchorAlignment(e),c=-(s-.5)*n,u=-(l-.5)*r,h=t.evaluateVariableOffset(e,i);return new t.Point((c/o+h[0])*a,(u/o+h[1])*a)}function Sn(e,n,r,i,o,a,s,l,c,u,h,p){const d=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,m=e.icon.dynamicLayoutVertexArray,g={};f.clear();for(let y=0;y<d.length;y++){const m=d.get(y),v=e.allowVerticalPlacement&&!m.placedOrientation,_=m.hidden||!m.crossTileID||v?null:i[m.crossTileID];if(_){const i=new t.Point(m.anchorX,m.anchorY),d=p(i),y=it(i,r?l:s,d),v=ot(a.cameraToCenterDistance,y.signedDistanceFromCamera);let x=o.evaluateSizeForFeature(e.textSizeData,u,m)*v/t.ONE_EM;r&&(x*=e.tilePixelRatio/c);const{width:b,height:w,anchor:M,textOffset:E,textBoxScale:S}=_,T=En(M,b,w,E,S,x),A=r?it(i.add(T),s,d).point:y.point.add(n?T.rotate(-a.angle):T),C=e.allowVerticalPlacement&&m.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<m.numGlyphs;e++)t.addDynamicAttributes(f,A,C);h&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:A,angle:C})}else ft(m.numGlyphs,f)}if(h){m.clear();const n=e.icon.placedSymbolArray;for(let e=0;e<n.length;e++){const r=n.get(e);if(r.hidden)ft(r.numGlyphs,m);else{const n=g[e];if(n)for(let e=0;e<r.numGlyphs;e++)t.addDynamicAttributes(m,n.shiftedAnchor,n.angle);else ft(r.numGlyphs,m)}}e.icon.dynamicLayoutVertexBuffer.updateData(m)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function Tn(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function An(e,n,r,i,o,a,s,l,c,u,h,p){const d=e.context,f=d.gl,m=e.transform,g="map"===l,y="map"===c,v=g&&"point"!==r.layout.get("symbol-placement"),_=g&&!y&&!v,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),M=r.layout.get("text-variable-anchor"),E=[],T=e.terrain&&y?["PITCH_WITH_MAP_TERRAIN"]:null;for(const A of i){const i=n.getTile(A),l=i.getBucket(r);if(!l)continue;const c=o?l.text:l.icon;if(!c||!c.segments.get().length)continue;const h=c.programConfigurations.get(r.id),p=o||l.sdfIcons,d=o?l.textSizeData:l.iconSizeData,w=y||0!==m.pitch,C=e.useProgram(Tn(p,o,l),h,T),L=t.evaluateSizeForZoom(d,m.zoom);let I,P,R,O,D=[0,0],N=null;if(o){if(P=i.glyphAtlasTexture,R=f.LINEAR,I=i.glyphAtlasTexture.size,l.iconsInText){D=i.imageAtlasTexture.size,N=i.imageAtlasTexture;const t="composite"===d.kind||"camera"===d.kind;O=w||e.options.rotating||e.options.zooming||t?f.LINEAR:f.NEAREST}}else{const t=1!==r.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;P=i.imageAtlasTexture,R=p||e.options.rotating||e.options.zooming||t||w?f.LINEAR:f.NEAREST,I=i.imageAtlasTexture.size}const k=S(i,1,e.transform.zoom),F=nt(A.posMatrix,y,g,e.transform,k),z=e.terrain&&y&&v?t.invert(new Float32Array(16),F):Mn,B=rt(A.posMatrix,y,g,e.transform,k),U=M&&l.hasTextData(),j="none"!==r.layout.get("icon-text-fit")&&U&&l.hasIconData();if(v){const t=m.elevation;st(l,A.posMatrix,e,o,F,B,y,u,t?e=>t.getAtTileOffset(A,e.x,e.y):null)}const G=e.translatePosMatrix(A.posMatrix,i,a,s),V=v||o&&M||j?Mn:F,H=e.translatePosMatrix(B,i,a,s,!0),W=p&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let q;q=p?l.iconsInText?yn(d.kind,L,_,y,e,G,V,H,I,D):gn(d.kind,L,_,y,e,G,V,H,o,I,!0):mn(d.kind,L,_,y,e,G,V,H,o,I);const X={program:C,buffers:c,uniformValues:q,atlasTexture:P,atlasTextureIcon:N,atlasInterpolation:R,atlasInterpolationIcon:O,isSDF:p,hasHalo:W,tile:i,labelPlaneMatrixInv:z};if(x&&l.canOverlap){b=!0;const e=c.segments.get();for(const n of e)E.push({segments:new t.SegmentVector([n]),sortKey:n.sortKey,state:X})}else E.push({segments:c.segments,sortKey:0,state:X})}b&&E.sort((t,e)=>t.sortKey-e.sortKey);for(const t of E){const n=t.state;if(e.terrain&&e.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:n.labelPlaneMatrixInv}),d.activeTexture.set(f.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,f.CLAMP_TO_EDGE),n.atlasTextureIcon&&(d.activeTexture.set(f.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),n.isSDF){const i=n.uniformValues;n.hasHalo&&(i.u_is_halo=1,Cn(n.buffers,t.segments,r,e,n.program,w,h,p,i)),i.u_is_halo=0}Cn(n.buffers,t.segments,r,e,n.program,w,h,p,n.uniformValues)}}function Cn(e,n,r,i,o,a,s,l,c){const u=i.context;o.draw(u,u.gl.TRIANGLES,a,s,l,t.CullFaceMode.disabled,c,r.id,e.layoutVertexBuffer,e.indexBuffer,n,r.paint,i.transform.zoom,e.programConfigurations.get(r.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function Ln(e,n,r,i,o,a,s){const l=e.context.gl,c=r.paint.get("fill-pattern"),u=c&&c.constantOr(1),h=r.getCrossfadeParameters();let p,d,f,m,g;s?(d=u&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",p=l.LINES):(d=u?"fillPattern":"fill",p=l.TRIANGLES);for(const y of i){const i=n.getTile(y);if(u&&!i.patternsLoaded())continue;const v=i.getBucket(r);if(!v)continue;e.prepareDrawTile(y);const _=v.programConfigurations.get(r.id),x=e.useProgram(d,_);u&&(e.context.activeTexture.set(l.TEXTURE0),i.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers(h));const b=c.constantOr(null);if(b&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[b.to.toString()],n=t.patternPositions[b.from.toString()];e&&n&&_.setConstantPatternPositions(e,n)}const w=e.translatePosMatrix(y.posMatrix,i,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(s){m=v.indexBuffer2,g=v.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===d&&u?tn(w,e,h,i,t):Qe(w,t)}else m=v.indexBuffer,g=v.segments,f=u?Ke(w,e,h,i):Je(w);x.draw(e.context,p,o,e.stencilModeForClipping(y),a,t.CullFaceMode.disabled,f,r.id,v.layoutVertexBuffer,m,g,r.paint,e.transform.zoom,_)}}function In(e,n,r,i,o,a,s){const l=e.context,c=l.gl,u=r.paint.get("fill-extrusion-pattern"),h=u.constantOr(1),p=r.getCrossfadeParameters(),d=r.paint.get("fill-extrusion-opacity");for(const f of i){const i=n.getTile(f),m=i.getBucket(r);if(!m)continue;const g=m.programConfigurations.get(r.id),y=e.useProgram(h?"fillExtrusionPattern":"fillExtrusion",g);if(e.terrain){const t=e.terrain;if(!m.enableTerrain)continue;if(t.setupElevationDraw(i,y,{useMeterToDem:!0}),Pn(l,n,f,m,r,t),!m.centroidVertexBuffer){const t=y.attributes.a_centroid_pos;void 0!==t&&c.vertexAttrib2f(t,0,0)}}h&&(e.context.activeTexture.set(c.TEXTURE0),i.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),g.updatePaintBuffers(p));const v=u.constantOr(null);if(v&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[v.to.toString()],n=t.patternPositions[v.from.toString()];e&&n&&g.setConstantPatternPositions(e,n)}const _=e.translatePosMatrix(f.posMatrix,i,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),x=r.paint.get("fill-extrusion-vertical-gradient"),b=h?$e(_,e,x,d,f,p,i):Ye(_,e,x,d);y.draw(l,l.gl.TRIANGLES,o,a,s,t.CullFaceMode.backCCW,b,r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,r.paint,e.transform.zoom,g,e.terrain?m.centroidVertexBuffer:null)}}function Pn(e,n,r,i,o,a){const s=[e=>{let n=e.canonical.x-1,r=e.wrap;return n<0&&(n=(1<<e.canonical.z)-1,r--),new t.OverscaledTileID(e.overscaledZ,r,e.canonical.z,n,e.canonical.y)},e=>{let n=e.canonical.x+1,r=e.wrap;return n===1<<e.canonical.z&&(n=0,r++),new t.OverscaledTileID(e.overscaledZ,r,e.canonical.z,n,e.canonical.y)},e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],l=t=>{const e=n.getSource().maxzoom;for(const r of[0,-1,1]){if(t.overscaledZ+r<e)continue;if(r>0&&t.overscaledZ<e)continue;const i=n.getTileByID(t.calculateScaledKey(t.overscaledZ+r));if(i&&i.hasData()){const t=i.getBucket(o);if(t)return t}}},c=[0,0,0],u=(e,n)=>(c[0]=Math.min(e.min.y,n.min.y),c[1]=Math.max(e.max.y,n.max.y),c[2]=t.EXTENT-n.min.x>e.max.x?n.min.x-t.EXTENT:e.max.x,c),h=(e,n)=>(c[0]=Math.min(e.min.x,n.min.x),c[1]=Math.max(e.max.x,n.max.x),c[2]=t.EXTENT-n.min.y>e.max.y?n.min.y-t.EXTENT:e.max.y,c),p=[(t,e)=>u(t,e),(t,e)=>u(e,t),(t,e)=>h(t,e),(t,e)=>h(e,t)],d=new t.Point(0,0);let f,m,g;const y=(e,n,i,o,s)=>{const l=[[o?i:e,o?e:i,0],[o?i:n,o?n:i,0]],c=s<0?t.EXTENT+s:s,u=[o?c:(e+n)/2,o?(e+n)/2:c,0];return 0===i&&s<0||0!==i&&s>0?a.getForTilePoints(g,[u],!0,m):l.push(u),a.getForTilePoints(r,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/a.exaggeration()};for(let v=0;v<4;v++){const e=i.borders[v];if(0===e.length&&(i.borderDone[v]=!0),i.borderDone[v])continue;const n=g=s[v](r),o=l(n);if(!o||!o.enableTerrain)continue;if(m=a.findDEMTileFor(n),!m||!m.dem)continue;if(!f){const t=a.findDEMTileFor(r);if(!t||!t.dem)return;f=t}const c=(v<2?1:5)-v,u=o.borders[c];let h=0;for(let r=0;r<e.length;r++){const n=i.featuresOnBorder[e[r]],a=n.borders[v];let s;for(;h<u.length&&(s=o.featuresOnBorder[u[h]],!(s.borders[c][1]>a[0]+3));)o.borderDone[c]||o.encodeCentroid(void 0,s,!1),h++;if(s&&h<u.length){const e=h;let r=0;for(;!(s.borders[c][0]>a[1]-3)&&(r++,++h!==u.length);)s=o.featuresOnBorder[u[h]];if(s=o.featuresOnBorder[u[e]],n.intersectsCount()>1||s.intersectsCount()>1||1!==r){1!==r&&(h=e),i.encodeCentroid(void 0,n,!1),o.borderDone[c]||o.encodeCentroid(void 0,s,!1);continue}const l=p[v](n,s),f=v%2?t.EXTENT-1:0;d.x=y(l[0],Math.min(t.EXTENT-1,l[1]),f,v<2,l[2]),d.y=0,i.encodeCentroid(d,n,!1),o.borderDone[c]||o.encodeCentroid(d,s,!1)}else i.encodeCentroid(void 0,n,!1)}i.borderDone[v]=i.needsCentroidUpdate=!0,o.borderDone[c]||(o.borderDone[c]=o.needsCentroidUpdate=!0)}(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(e)}const Rn=new t.Color(1,0,0,1),On=new t.Color(0,1,0,1),Dn=new t.Color(0,0,1,1),Nn=new t.Color(1,0,1,1),kn=new t.Color(0,1,1,1);function Fn(t,e,n,r){Bn(t,0,e+n/2,t.transform.width,n,r)}function zn(t,e,n,r){Bn(t,e-n/2,0,n,t.transform.height,r)}function Bn(e,n,r,i,o,a){const s=e.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}function Un(e,n,r){const i=e.context,o=i.gl,a=r.posMatrix,s=e.useProgram("debug"),l=n.getTileByID(r.key);e.terrain&&e.terrain.setupElevationDraw(l,s);const c=t.DepthMode.disabled,u=t.StencilMode.disabled,h=e.colorModeForRenderPass();i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(i,o.LINE_STRIP,c,u,h,t.CullFaceMode.disabled,on(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);const p=l.latestRawTileData,d=Math.floor((p&&p.byteLength||0)/1024),f=n.getTile(r).tileSize,m=512/Math.min(f,512)*(r.overscaledZ/e.transform.zoom)*.5;let g=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(g+=" => "+r.overscaledZ),function(t,e){t.initDebugOverlayCanvas();const n=t.debugOverlayCanvas,r=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,`${g} ${d}kb`),s.draw(i,o.TRIANGLES,c,u,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,on(a,t.Color.transparent,m),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}const jn=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Gn}=jn;function Vn(t,e,n,r){t.emplaceBack(e,n,r)}class Hn{constructor(e){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,Vn(this.vertexArray,-1,-1,1),Vn(this.vertexArray,1,-1,1),Vn(this.vertexArray,-1,1,1),Vn(this.vertexArray,1,1,1),Vn(this.vertexArray,-1,-1,-1),Vn(this.vertexArray,1,-1,-1),Vn(this.vertexArray,-1,1,-1),Vn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Gn),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function Wn(e,n,r,i,o,a){const s=e.gl,l=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),u=n.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,n,r,i)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:n,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}))(t.fromMat4([],i),o,u,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,n.skyboxTexture,0),r.draw(e,s.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const qn={symbol:function(e,n,r,i,o){if("translucent"!==e.renderPass)return;const a=t.StencilMode.disabled,s=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,n,r,i,o,a,s){const l=n.transform,c="map"===o,u="map"===a;for(const h of e){const e=i.getTile(h),o=e.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;const a=t.evaluateSizeForZoom(o.textSizeData,l.zoom),p=S(e,1,n.transform.zoom),d=nt(h.posMatrix,u,c,n.transform,p),f="none"!==r.layout.get("icon-text-fit")&&o.hasIconData();if(a){const n=Math.pow(2,l.zoom-e.tileID.overscaledZ),r=l.elevation;Sn(o,c,u,s,t.symbolSize,l,d,h.posMatrix,n,a,f,r?t=>r.getAtTileOffset(h,t.x,t.y):t=>0)}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&An(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&An(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),n.map.showCollisionBoxes&&(wn(e,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),wn(e,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(e,n,r,i){if("translucent"!==e.renderPass)return;const o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===a.constantOr(1)||0===s.constantOr(1)))return;const c=e.context,u=c.gl,h=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),p=t.StencilMode.disabled,d=e.colorModeForRenderPass(),f=[];for(let m=0;m<i.length;m++){const o=i[m],a=n.getTile(o),s=a.getBucket(r);if(!s)continue;const c=s.programConfigurations.get(r.id),u=nn(r),h={programConfiguration:c,program:e.useProgram("circle",c,u),layoutVertexBuffer:s.layoutVertexBuffer,indexBuffer:s.indexBuffer,uniformValues:en(e,o,a,r),tile:a};if(l){const e=s.segments.get();for(const n of e)f.push({segments:new t.SegmentVector([n]),sortKey:n.sortKey,state:h})}else f.push({segments:s.segments,sortKey:0,state:h})}l&&f.sort((t,e)=>t.sortKey-e.sortKey);for(const m of f){const{programConfiguration:n,program:i,layoutVertexBuffer:o,indexBuffer:a,uniformValues:s,tile:l}=m.state,f=m.segments;e.terrain&&e.terrain.setupElevationDraw(l,i,{useDepthForOcclusion:!0}),i.draw(c,u.TRIANGLES,h,p,d,t.CullFaceMode.disabled,s,r.id,o,a,f,r.paint,e.transform.zoom,n)}},heatmap:function(e,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,a=o.gl,s=t.StencilMode.disabled,l=new t.ColorMode([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){const r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{const o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,r){const i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(t,e,o,i)}}(o,e,r),o.clear({color:t.Color.transparent});for(let c=0;c<i.length;c++){const u=i[c];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),p=h.getBucket(r);if(!p)continue;const d=p.programConfigurations.get(r.id),f=e.useProgram("heatmap",d),{zoom:m}=e.transform;e.terrain&&e.terrain.setupElevationDraw(h,f),f.draw(o,a.TRIANGLES,t.DepthMode.disabled,s,l,t.CullFaceMode.disabled,an(u.posMatrix,h,m,r.paint.get("heatmap-intensity")),r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,r.paint,e.transform.zoom,d)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){const r=e.context,i=r.gl,o=n.heatmapFbo;if(!o)return;r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);let a=n.colorRampTexture;a||(a=n.colorRampTexture=new t.Texture(r,n.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,((e,n,r,i)=>{const o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);const a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}})(e,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}(e,r))},line:function(e,n,r,i){if("translucent"!==e.renderPass)return;const o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0===o.constantOr(1)||0===a.constantOr(1))return;const s=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),l=e.colorModeForRenderPass(),c=r.paint.get("line-dasharray"),u=r.paint.get("line-pattern"),h=u.constantOr(1),p=r.paint.get("line-gradient"),d=r.getCrossfadeParameters(),f=h?"linePattern":c?"lineSDF":p?"lineGradient":"line",m=e.context,g=m.gl;let y=!0;for(const v of i){const i=n.getTile(v);if(h&&!i.patternsLoaded())continue;const o=i.getBucket(r);if(!o)continue;e.prepareDrawTile(v);const a=o.programConfigurations.get(r.id),_=e.context.program.get(),x=e.useProgram(f,a),b=y||x.program!==_,w=u.constantOr(null);if(w&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[w.to.toString()],n=t.patternPositions[w.from.toString()];e&&n&&a.setConstantPatternPositions(e,n)}const M=e.terrain?v.posMatrix:null,E=h?cn(e,i,r,d,M):c?un(e,i,r,c,d,M):p?ln(e,i,r,M,o.lineClipsArray.length):sn(e,i,r,M);if(h)m.activeTexture.set(g.TEXTURE0),i.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),a.updatePaintBuffers(d);else if(c&&(b||e.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(m);else if(p){const i=o.gradients[r.id];let a=i.texture;if(r.gradientVersion!==i.version){let s=256;if(r.stepInterpolant){const r=n.getSource().maxzoom,i=v.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-v.canonical.z):1;s=t.clamp(t.nextPowerOfTwo(o.maxLineLength/t.EXTENT*1024*i),256,m.maxTextureSize)}i.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:i.gradient||void 0,clips:o.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new t.Texture(m,i.gradient,g.RGBA),i.version=r.gradientVersion,a=i.texture}m.activeTexture.set(g.TEXTURE0),a.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}x.draw(m,g.TRIANGLES,s,e.stencilModeForClipping(v),l,t.CullFaceMode.disabled,E,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,r.paint,e.transform.zoom,a,o.layoutVertexBuffer2),y=!1}},fill:function(e,n,r,i){const o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0===a.constantOr(1))return;const s=e.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const o=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);Ln(e,n,r,i,o,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const o=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);Ln(e,n,r,i,o,s,!0)}},"fill-extrusion":function(e,n,r,i){const o=r.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===e.renderPass){const a=new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==o||r.paint.get("fill-extrusion-pattern").constantOr(1))In(e,n,r,i,a,t.StencilMode.disabled,t.ColorMode.disabled),In(e,n,r,i,a,e.stencilModeFor3D(),e.colorModeForRenderPass());else{const o=e.colorModeForRenderPass();In(e,n,r,i,a,t.StencilMode.disabled,o)}}},hillshade:function(e,n,r,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const o=e.context,a=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),s=e.colorModeForRenderPass(),l=e.terrain&&e.terrain.renderingToTexture,[c,u]="translucent"!==e.renderPass||l?[{},i]:e.stencilConfigForOverlap(i);for(const h of u){const i=n.getTile(h);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)Oe(e,i,r,a,t.StencilMode.disabled,s);else if("translucent"===e.renderPass){const t=l&&e.terrain?e.terrain.stencilModeForRTTOverlap(h):c[h.overscaledZ];Pe(e,h,i,r,a,t,s)}}o.viewport.set([0,0,e.width,e.height])},raster:function(e,n,r,i,o,a){if("translucent"!==e.renderPass)return;if(0===r.paint.get("raster-opacity"))return;if(!i.length)return;const s=e.context,l=s.gl,c=n.getSource(),u=e.useProgram("raster"),h=e.colorModeForRenderPass(),p=e.terrain&&e.terrain.renderingToTexture,[d,f]=c instanceof R||p?[{},i]:e.stencilConfigForOverlap(i),m=f[f.length-1].overscaledZ,g=!e.options.moving;for(const y of f){const i=p?t.DepthMode.disabled:e.depthModeForSublayer(y.overscaledZ-m,1===r.paint.get("raster-opacity")?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,l.LESS),o=n.getTile(y);if(p&&(!o||!o.hasData()))continue;const f=p?y.posMatrix:e.transform.calculatePosMatrix(y.toUnwrapped(),g),v=e.terrain&&p?e.terrain.stencilModeForRTTOverlap(y):d[y.overscaledZ],_=a?0:r.paint.get("raster-fade-duration");o.registerFadeDuration(_);const x=n.findLoadedParent(y,0),b=je(o,x,n,e.transform,_);let w,M;e.terrain&&e.terrain.prepareDrawTile(y);const E="nearest"===r.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;s.activeTexture.set(l.TEXTURE0),o.texture.bind(E,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),s.activeTexture.set(l.TEXTURE1),x?(x.texture.bind(E,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-o.tileID.overscaledZ),M=[o.tileID.canonical.x*w%1,o.tileID.canonical.y*w%1]):o.texture.bind(E,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST);const S=dn(f,M||[0,0],w||1,b,r);c instanceof R?u.draw(s,l.TRIANGLES,i,t.StencilMode.disabled,h,t.CullFaceMode.disabled,S,r.id,c.boundsBuffer,e.quadTriangleIndexBuffer,c.boundsSegments):u.draw(s,l.TRIANGLES,i,v,h,t.CullFaceMode.disabled,S,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}},background:function(e,n,r,i){const o=r.paint.get("background-color"),a=r.paint.get("background-opacity");if(0===a)return;const s=e.context,l=s.gl,c=e.transform,u=c.tileSize,h=r.paint.get("background-pattern");if(e.isPatternMissing(h))return;const p=!h&&1===o.a&&1===a&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==p)return;const d=t.StencilMode.disabled,f=e.depthModeForSublayer(0,"opaque"===p?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),m=e.colorModeForRenderPass(),g=e.useProgram(h?"backgroundPattern":"background"),y=i||c.coveringTiles({tileSize:u});h&&(s.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context));const v=r.getCrossfadeParameters();for(const _ of y){const n=i?_.posMatrix:e.transform.calculatePosMatrix(_.toUnwrapped());e.prepareDrawTile(_);const c=h?_n(n,a,e,h,{tileID:_,tileSize:u},v):vn(n,a,o);g.draw(s,l.TRIANGLES,f,d,m,t.CullFaceMode.disabled,c,r.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}},sky:function(e,n,r){const i=r.paint.get("sky-opacity");if(0===i)return;const o=e.context,a=r.paint.get("sky-type"),s=new t.DepthMode(o.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),l=e.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===e.renderPass?r.needsSkyboxCapture(e)&&(function(e,n,r,i){const o=e.context,a=o.gl;let s=n.skyboxFbo;if(!s){s=n.skyboxFbo=o.createFramebuffer(32,32,!1),n.skyboxGeometry=new Hn(o),n.skyboxTexture=o.gl.createTexture(),a.bindTexture(a.TEXTURE_CUBE_MAP,n.skyboxTexture),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR);for(let t=0;t<6;++t)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,a.RGBA,32,32,0,a.RGBA,a.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(s.framebuffer),o.viewport.set([0,0,32,32]);const l=n.getCenter(e,!0),c=e.useProgram("skyboxCapture"),u=new Float64Array(16);t.identity(u),t.rotateY(u,u,.5*-Math.PI),Wn(o,n,c,u,l,0),t.identity(u),t.rotateY(u,u,.5*Math.PI),Wn(o,n,c,u,l,1),t.identity(u),t.rotateX(u,u,.5*-Math.PI),Wn(o,n,c,u,l,2),t.identity(u),t.rotateX(u,u,.5*Math.PI),Wn(o,n,c,u,l,3),t.identity(u),Wn(o,n,c,u,l,4),t.identity(u),t.rotateY(u,u,Math.PI),Wn(o,n,c,u,l,5),o.viewport.set([0,0,e.width,e.height])}(e,r),r.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,n,r,i,o){const a=e.context,s=a.gl,l=e.transform,c=e.useProgram("skybox");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,n.skyboxTexture);const u=((t,e,n,r,i)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:r,u_temporal_offset:i}))(l.skyboxMatrix,n.getCenter(e,!1),0,i,o);c.draw(a,s.TRIANGLES,r,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,u,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(e,r,s,i,l):"gradient"===a&&"sky"===e.renderPass&&function(e,n,r,i,o){const a=e.context,s=a.gl,l=e.transform,c=e.useProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new Hn(a)),a.activeTexture.set(s.TEXTURE0);let u=n.colorRampTexture;u||(u=n.colorRampTexture=new t.Texture(a,n.colorRamp,s.RGBA)),u.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=((e,n,r,i,o)=>({u_matrix:e,u_color_ramp:0,u_center_direction:n,u_radius:t.degToRad(r),u_opacity:i,u_temporal_offset:o}))(l.skyboxMatrix,n.getCenter(e,!1),n.paint.get("sky-gradient-radius"),i,o);c.draw(a,s.TRIANGLES,r,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(e,r,s,i,l)},debug:function(t,e,n){for(let r=0;r<n.length;r++)Un(t,e,n[r])},custom:function(e,n,r){const i=e.context,o=r.implementation;if("offscreen"===e.renderPass){const t=o.prerender;t&&(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),t.call(o,i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(t.StencilMode.disabled);const n="3d"===o.renderingMode?new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.DepthMode.ReadOnly);i.setDepthMode(n),o.render(i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}};class Xn{constructor(e,n){this.context=new t.Context(e),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Gt,this.gpuTimers={},this.frameCounter=0}updateTerrain(t,e){const n=!!t&&!!t.terrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new We(this,t));const r=this._terrain;this.transform.elevation=n?r:null,r.update(t,this.transform,e)}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,n){if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style._order)this.style._layers[t].resize()}setup(){const e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,P.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);const s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);const l=this.context.gl;this.stencilClearMode=new t.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.window.performance.now())}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=t.create();t.ortho(r,0,this.width,this.height,0,0,1),t.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,Ue(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n,r){if(!(n&&this.currentStencilSource!==n.id&&e.isTileClipped()&&r&&r.length))return;this.currentStencilSource=n.id;const i=this.context,o=i.gl;this.nextStencilID+r.length>256&&this.clearStencil(),i.setColorMode(t.ColorMode.disabled),i.setDepthMode(t.DepthMode.disabled);const a=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const s of r){const e=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;a.draw(i,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,Ue(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new t.StencilMode({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const n=this.context.gl;return new t.StencilMode({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,r=e.sort((t,e)=>e.overscaledZ-t.overscaledZ),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const e={};for(let r=0;r<o;r++)e[r+i]=new t.StencilMode({func:n.GEQUAL,mask:255},r+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[e,r]}return[{[i]:t.StencilMode.disabled},r]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new t.ColorMode([e.CONSTANT_COLOR,e.ONE],new t.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(e,n,r){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.DepthMode(r||this.context.gl.LEQUAL,n,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();const r=this.style._order,i=this.style._sourceCaches;for(const t in i){const e=i[t];e.used&&e.prepare(this.context)}const o={},a={},s={};for(const t in i){const e=i[t];o[t]=e.getVisibleCoordinates(),a[t]=o[t].slice().reverse(),s[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<r.length;t++)if(this.style._layers[r[t]].is3D()){this.opaquePassCutoff=t;break}this.terrain&&(this.terrain.updateTileBinding(s),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const t of r){const n=this.style._layers[t],r=e._getLayerSourceCache(n);if(!n.hasOffscreenPass()||n.isHidden(this.transform.zoom))continue;const i=r?a[r.id]:void 0;("custom"===n.type||n.isSky()||i&&i.length)&&this.renderLayer(this,r,n,i)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[r[this.currentLayer]],n=e._getLayerSourceCache(t);if(this.terrain&&this.terrain.renderLayer(t,n)||t.isSky())continue;const i=n?a[n.id]:void 0;this._renderTileClippingMasks(t,n,i),this.renderLayer(this,n,t,i)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=this.style._layers[r[this.currentLayer]],n=e._getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,n,t,n?a[n.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=this.style._layers[r[this.currentLayer]],n=e._getLayerSourceCache(t);if(this.terrain&&this.terrain.renderLayer(t,n)||t.isSky())continue;const i=n?("symbol"===t.type?s:a)[n.id]:void 0;this._renderTileClippingMasks(t,n,n?o[n.id]:void 0),this.renderLayer(this,n,t,i)}if(this.options.showTileBoundaries||this.options.showQueryGeometry){let n=null;t.values(this.style._layers).forEach(t=>{const r=e._getLayerSourceCache(t);r&&!t.isHidden(this.transform.zoom)&&(!n||n.getSource().maxzoom<r.getSource().maxzoom)&&(n=r)}),n&&this.options.showTileBoundaries&&qn.debug(this,n,n.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;Fn(t,t.transform.height-(e.top||0),3,Rn),Fn(t,e.bottom||0,3,On),zn(t,e.left||0,3,Dn),zn(t,t.transform.width-(e.right||0),3,Nn);const n=t.transform.centerPoint;!function(t,e,n,r){Bn(t,e-1,n-10,2,20,r),Bn(t,e-10,n-1,20,2,r)}(t,n.x,t.transform.height-n.y,kn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%t.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||r&&r.length)&&(this.id=n.id,this.gpuTimingStart(n),qn[n.type](t,e,n,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;let n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const e={};for(const n in t){const r=t[n],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),e[n]=o}return e}translatePosMatrix(e,n,r,i,o){if(!r[0]&&!r[1])return e;const a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){const t=Math.sin(a),e=Math.cos(a);r=[r[0]*e-r[1]*t,r[0]*t+r[1]*e]}const s=[o?r[0]:S(n,r[0],this.transform.zoom),o?r[1]:S(n,r[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,s),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,e=[];return this.terrain&&!this.terrain.renderingToTexture&&e.push("TERRAIN"),t&&e.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&e.push("OVERDRAW_INSPECTOR"),e}useProgram(t,e,n){this.cache=this.cache||{};const r=n||[],i=this.currentGlobalDefines().concat(r),o=Xe.cacheKey(t,i,e);return this.cache[o]||(this.cache[o]=new Xe(this.context,t,Ce[t],e,xn[t],i)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}}class Zn{constructor(t=0,e=0,n=0,r=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=r}interpolate(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,r)),this}getCenter(e,n){const r=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.Point(r,i)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Zn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Yn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function $n(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]}function Jn(e,n){const r=Yn(e,3);t.fromQuat(e,n),$n(e,3,r)}function Kn(t,e){$n(t,3,[e[0],e[1],e[2],1])}function Qn(e,n){const r=t.identity$1([]);return t.rotateZ$1(r,r,-n),t.rotateX$1(r,r,-e),r}function tr(e,n){const r=[e[0],e[1],0],i=[n[0],n[1],0];if(t.length(r)>=1e-15){const e=t.normalize([],r);t.scale$2(i,e,t.dot(i,e)),n[0]=i[0],n[1]=i[1]}const o=t.cross([],n,e);if(t.len(o)<1e-15)return null;const a=Math.atan2(-o[1],o[0]);return Qn(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),a)}class er{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){this._position=this._renderWorldCopies?function(e){if(!e)return;const n=Array.isArray(e)?new t.MercatorCoordinate(e[0],e[1],e[2]):e;return n.x=t.wrap(n.x,0,1),n}(e):e}lookAtPoint(e,n){if(this.orientation=null,!this.position)return;const r=this._elevation?this._elevation.getAtPoint(t.MercatorCoordinate.fromLngLat(e)):0,i=this.position,o=t.MercatorCoordinate.fromLngLat(e,r),a=[o.x-i.x,o.y-i.y,o.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=tr(a,n)}setPitchBearing(e,n){this.orientation=Qn(t.degToRad(e),t.degToRad(-n))}}class nr{constructor(e,n){this._transform=t.identity([]),this._orientation=t.identity$1([]),n&&(this._orientation=n,Jn(this._transform,this._orientation)),e&&Kn(this._transform,e)}get mercatorPosition(){const e=this.position;return new t.MercatorCoordinate(e[0],e[1],e[2])}get position(){const t=Yn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){Kn(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,Jn(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=Qn(t,e),Jn(this._transform,this._orientation)}forward(){const t=Yn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=Yn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=Yn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(e,n){const r=new Float64Array(16);return t.invert(r,this.getWorldToCamera(e,n)),r}getWorldToCamera(e,n){const r=new Float64Array(16),i=new Float64Array(4),o=this.position;return t.conjugate(i,this._orientation),t.scale$2(o,o,-e),t.fromQuat(r,i),t.translate(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=n,r[9]*=n,r[10]*=n,r[11]*=n,r}getCameraToClipPerspective(e,n,r,i){const o=new Float64Array(16);return t.perspective(o,e,n,r,i),o}clone(){return new nr([...this.position],[...this.orientation])}}class rr{constructor(e,n,r,i,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Zn,this._posMatrixCache={},this._alignedPosMatrixCache={},this._camera=new nr,this._centerAltitude=0,this.cameraElevationReference="ground"}clone(){const t=new rr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const e=this._elevation.getAtPoint(t.MercatorCoordinate.fromLngLat(this.center),-1);return-1===e?(this._cameraZoom=null,!1):(this._centerAltitude=e,!0)}_updateCameraOnTerrain(){const e=this.cameraToCenterDistance/this.worldSize,n=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(n+e)}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const e=this._cameraZoom,n=this._elevation.getAtPoint(t.MercatorCoordinate.fromLngLat(this.center)),r=t.mercatorZfromAltitude(n,this.center.lat),i=this._mercatorZfromZoom(e),o=this._mercatorZfromZoom(this._maxZoom),a=Math.max(i-r,o);this._setZoom(this._zoomFromMercatorZ(a))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let r;r=e.z<this._camera.position[2]?[n.x,n.y,n.z]:[e.x,e.y,e.z];const i=t.length(t.sub([],this._camera.position,r));return t.clamp(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let n=!1;if(e.orientation&&!t.exactEquals(e.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(e.orientation)),e.position){const r=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(r,this._camera.position)||(this._setCameraPosition(r),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,n=new er;return n.position=new t.MercatorCoordinate(e[0],e[1],e[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this._renderWorldCopies,n}_setCameraOrientation(e){if(!t.length$1(e))return!1;t.normalize$1(e,e);const n=t.transformQuat([],[0,0,-1],e),r=t.transformQuat([],[0,-1,0],e);if(r[2]<0)return!1;const i=tr(n,r);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(e){const n=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;e[2]=t.clamp(e[2],i/r,i/n),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const r=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),l=Math.floor(Math.max(r.x,i.x,o.x,a.x)),c=1;for(let u=s-c;u<=l+c;u++)0!==u&&n.push(new t.UnwrappedTileID(u,e))}return n}coveringTiles(e){let n=this.coveringZoomLevel(e);const r=n,i=!!e.useElevationData;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const o=t.MercatorCoordinate.fromLngLat(this.center),a=1<<n,s=[a*o.x,a*o.y,0],l=t.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),c=this.pointCoordinate(this.getCameraPoint()),u=a*t.mercatorZfromAltitude(1,this.center.lat),h=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),p=[a*c.x,a*c.y,h],d=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),f=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?n:0,m=this.elevation?1e4*this.elevation.exaggeration():0,g=e=>({aabb:new t.Aabb([e*a,0,-m],[(e+1)*a,a,m]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),y=[],v=[],_=n,x=e.reparseOverscaled?r:n,b=(t,e)=>{if(!this._elevation)return;const n=this._elevation.getMinMaxForTile(e);n&&(t.min[2]=n.min,t.max[2]=n.max,t.center[2]=(t.min[2]+t.max[2])/2)},w=t=>t*t,M=w((h-this._centerAltitude)*u),E=(t,e)=>{if(e*w(.707)<t)return 1;const n=Math.sqrt(e/t);return n/(1/.707+(Math.pow(1.1,n-1/.707+1)-1)/(1.1-1)-1)};if(this._renderWorldCopies)for(let t=1;t<=3;t++)y.push(g(-t)),y.push(g(t));for(y.push(g(0));y.length>0;){const r=y.pop(),o=r.x,a=r.y;let c=r.fullyVisible;if(!c){const t=r.aabb.intersects(l);if(0===t)continue;c=2===t}let h=!0;if(f<=r.zoom&&r.zoom<_){const t=r.aabb.distanceX(p),e=r.aabb.distanceY(p);let n=M;i&&(n=w(r.aabb.distanceZ(p)*u));const o=t*t+e*e+n;h=o<w((1<<_-r.zoom)*d*E(Math.max(n,M),o))}if(r.zoom!==_&&h)for(let e=0;e<4;e++){const n=(o<<1)+e%2,s=(a<<1)+(e>>1),l=r.aabb.quadrant(e);let u=null;i&&r.zoom>_-6&&(u=new t.OverscaledTileID(r.zoom+1===_?x:r.zoom+1,r.wrap,r.zoom+1,n,s),b(l,u)),y.push({aabb:l,zoom:r.zoom+1,x:n,y:s,wrap:r.wrap,fullyVisible:c,tileID:u})}else{const i=r.zoom===_?x:r.zoom;if(e.minzoom&&e.minzoom>i)continue;const l=s[0]-(.5+o+(r.wrap<<r.zoom))*(1<<n-r.zoom),c=s[1]-.5-a,u=r.tileID?r.tileID:new t.OverscaledTileID(i,r.wrap,r.zoom,o,a);v.push({tileID:u,distanceSq:l*l+c*c})}}return v.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)}unproject(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(e,n){const r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(r.x-i.x),o.y-(r.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(t){this.center=this.coordinateLocation(t),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e){return t.MercatorCoordinate.fromLngLat(e)}coordinateLocation(t){return t.toLngLat()}pointRayIntersection(e,n){const r=null!=n?n:this._centerAltitude,i=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.transformMat4(i,i,this.pixelMatrixInverse),t.transformMat4(o,o,this.pixelMatrixInverse);const a=o[3];t.scale$1(i,i,1/i[3]),t.scale$1(o,o,1/a);const s=i[2],l=o[2];return{p0:i,p1:o,t:s===l?0:(r-s)/(l-s)}}screenPointToMercatorRay(e){const n=[e.x,e.y,0,1],r=[e.x,e.y,1,1];return t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(r,r,this.pixelMatrixInverse),t.scale$1(n,n,1/n[3]),t.scale$1(r,r,1/r[3]),n[2]=t.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,r[2]=t.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,t.scale$1(n,n,1/this.worldSize),t.scale$1(r,r,1/this.worldSize),new t.Ray([n[0],n[1],n[2]],t.normalize([],t.sub([],r,n)))}rayIntersectionCoordinate(e){const{p0:n,p1:r,t:i}=e,o=t.mercatorZfromAltitude(n[2],this._center.lat),a=t.mercatorZfromAltitude(r[2],this._center.lat);return new t.MercatorCoordinate(t.number(n[0],r[0],i)/this.worldSize,t.number(n[1],r[1],i)/this.worldSize,t.number(o,a,i))}pointCoordinate(e){const n=this.horizonLineFromTop(!1),r=new t.Point(e.x,Math.max(n,e.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(r))}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);const n=this.elevation;let r=this.elevation.pointCoordinate(e);if(r)return new t.MercatorCoordinate(r[0],r[1],r[2]);let i=0,o=this.horizonLineFromTop();if(e.y>o)return this.pointCoordinate(e);const a=.02*o,s=e.clone();for(let l=0;l<10&&o-i>a;l++){s.y=t.number(i,o,.66);const e=n.pointCoordinate(s);e?(o=s.y,r=e):i=s.y}return r?new t.MercatorCoordinate(r[0],r[1],r[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const e=this.horizonLineFromTop();return t.y<e}}_coordinatePoint(e,n){const r=n&&this.elevation?this.elevation.getAtPoint(e,this._centerAltitude):this._centerAltitude,i=[e.x*this.worldSize,e.y*this.worldSize,r+e.toAltitude(),1];return t.transformMat4(i,i,this.pixelMatrix),i[3]>0?new t.Point(i[0]/i[3],i[1]/i[3]):new t.Point(Number.MAX_VALUE,Number.MAX_VALUE)}getBounds(){return this._terrainEnabled()?this._getBounds3D():(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))}_getBounds3D(){const e=this.elevation,n=e.visibleDemTiles.reduce((t,e)=>{if(e.dem){const n=e.dem.tree;t.min=Math.min(t.min,n.minimums[0]),t.max=Math.max(t.max,n.maximums[0])}return t},{min:Number.MAX_VALUE,max:0});n.min*=e.exaggeration(),n.max*=e.exaggeration();const r=this.horizonLineFromTop();return[new t.Point(0,r),new t.Point(this.width,r),new t.Point(this.width,this.height),new t.Point(0,this.height)].reduce((t,e)=>t.extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(e,n.min)))).extend(this.coordinateLocation(this.rayIntersectionCoordinate(this.pointRayIntersection(e,n.max)))),new t.LngLatBounds)}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,n=this.height/2-.97*e;return t?Math.max(0,n):n}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,n=!1){const r=e.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];const o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,l=t.identity(new Float64Array(16));return t.translate(l,l,[s*a,o.y*a,0]),t.scale(l,l,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(l,n?this.alignedProjMatrix:this.projMatrix,l),i[r]=new Float32Array(l),i[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const n=this._camera.position,r=this._camera.forward();if(n.z<=0||r[2]>=0)return;const i=t.mercatorZfromAltitude(1,this._center.lat);n[2]/=i,r[2]/=i,t.normalize(r,r);const o=e.raycast(n,r,e.exaggeration());if(o){const e=t.scaleAndAdd([],n,r,o),i=new t.MercatorCoordinate(e[0],e[1],t.mercatorZfromAltitude(e[2],t.latFromMercatorY(e[1]))),a=this._camera.position,s=i.z+t.length([i.x-a[0],i.y-a[1],i.z-a[2]]);this._cameraZoom=this._zoomFromMercatorZ(s),this._centerAltitude=i.toAltitude(),this._center=i.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const n=e.getAtPoint(this._camera.mercatorPosition),r=this._minimumHeightOverTerrain()*Math.cos(t.degToRad(this._maxPitch)),i=t.mercatorZfromAltitude(n,this._center.lat),o=this._camera.position[2]-i;if(o<r){const e=t.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),n=this._camera.mercatorPosition,i=[e.x-n.x,e.y-n.y,e.z-n.z],a=t.length(i);i[2]-=r-o;const s=t.length(i);if(0===s)return;t.scale$2(i,i,a/s),this._camera.position=[e.x-i[0],e.y-i[1],e.z-i[2]],this._camera.orientation=tr(i,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,n,r,i,o=-90,a=90,s=-180,l=180;const c=this.size,u=this._unmodified;if(this.latRange){const n=this.latRange;o=t.mercatorYfromLat(n[1])*this.worldSize,a=t.mercatorYfromLat(n[0])*this.worldSize,e=a-o<c.y?c.y/(a-o):0}if(this.lngRange){const e=this.lngRange;s=t.mercatorXfromLng(e[0])*this.worldSize,l=t.mercatorXfromLng(e[1])*this.worldSize,n=l-s<c.x?c.x/(l-s):0}const h=this.point,p=Math.max(n||0,e||0);if(p)return this.center=this.unproject(new t.Point(n?(l+s)/2:h.x,e?(a+o)/2:h.y)),this.zoom+=this.scaleZoom(p),this._unmodified=u,void(this._constraining=!1);if(this.latRange){const t=h.y,e=c.y/2;t-e<o&&(i=o+e),t+e>a&&(i=a-e)}if(this.lngRange){const t=h.x,e=c.x/2;t-e<s&&(r=s+e),t+e>l&&(r=l-e)}void 0===r&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==r?r:h.x,void 0!==i?i:h.y))),this._constrainCameraAltitude(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){const e=(t,e)=>Math.log2(t/(this.tileSize*Math.abs(e[1]-e[0])));let n=0;if(this.latRange){const r=this.latRange;n=e(this.height,[t.mercatorYfromLat(r[0]),t.mercatorYfromLat(r[1])])}let r=0;if(this.lngRange){const n=this.lngRange;r=e(this.width,[t.mercatorXfromLng(n[0]),t.mercatorXfromLng(n[1])])}return Math.max(n,r)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const n=t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;this._updateCameraState();const r=Math.PI/2+this._pitch,i=this.fovAboveCenter,o=this._camera.position[2]*this.worldSize/Math.cos(this._pitch),a=Math.sin(i)*o/Math.sin(t.clamp(Math.PI-r-i,.01,Math.PI-.01)),s=this.point,l=s.x,c=s.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*a+o),h=this.height/50,p=this._camera.getWorldToCamera(this.worldSize,n),d=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,h,u);d[8]=2*-e.x/this.width,d[9]=2*e.y/this.height;let f=t.mul([],d,p);this.mercatorMatrix=t.scale([],f,[this.worldSize,this.worldSize,this.worldSize/n]),this.projMatrix=f,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);const m=new Float32Array(16);t.identity(m),t.scale(m,m,[1,-1,1]),t.rotateX(m,m,this._pitch),t.rotateZ(m,m,this.angle);const g=t.perspective(new Float32Array(16),this._fov,this.width/this.height,h,u);g[8]=2*-e.x/this.width,g[9]=2*e.y/this.height,this.skyboxMatrix=t.multiply(m,g,m);const y=this.width%2/2,v=this.height%2/2,_=Math.cos(this.angle),x=Math.sin(this.angle),b=l-Math.round(l)+_*y+x*v,w=c-Math.round(c)+_*v+x*y,M=new Float64Array(f);if(t.translate(M,M,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=M,f=t.create(),t.scale(f,f,[this.width/2,-this.height/2,1]),t.translate(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=t.create(),t.scale(f,f,[1,-1,1]),t.translate(f,f,[-1,-1,0]),t.scale(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),f=t.invert(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const e=this._camera.forward(),n=this.cameraToCenterDistance,r=this.point,i=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-t.mercatorZfromAltitude(this._centerAltitude,this.center.lat),o=this.cameraToCenterDistance/i;this._camera.position=[r.x/this.worldSize-e[0]*n/o,r.y/this.worldSize-e[1]*n/o,t.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-e[2]*n/o]}_translateCameraConstrained(e){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=e[2];let i=1;r>0&&(i=Math.min((n-this._camera.position[2])/r,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,e,i),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,n=this._camera.forward(),{pitch:r,bearing:i}=this._camera.getPitchBearing(),o=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat),a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),s=Math.max((e[2]-o)/Math.cos(r),a),l=this._zoomFromMercatorZ(s);t.scaleAndAdd(e,e,n,s),this._pitch=t.clamp(r,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(i,-Math.PI,Math.PI),this._setZoom(t.clamp(l,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new t.MercatorCoordinate(e[0],e[1],e[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!!this._elevation}isHorizonVisibleForPoints(e,n){const r=Math.min(e.x,n.x),i=Math.max(e.x,n.x),o=Math.min(e.y,n.y),a=Math.max(e.y,n.y),s=[new t.Point(r,o),new t.Point(i,a),new t.Point(r,a),new t.Point(i,o)],l=this._renderWorldCopies?-3:0,c=this._renderWorldCopies?4:1;for(const t of s){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const n=this.rayIntersectionCoordinate(e);if(n.x<l||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new t.Point(0,0),new t.Point(this.width,this.height))}zoomDeltaToMovement(e,n){const r=t.length(t.sub([],this._camera.position,e)),i=this._zoomFromMercatorZ(r)+n;return r-this._mercatorZfromZoom(i)}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))}}class ir{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(t,e){let n=!1,r=null;const i=()=>{r=null,n&&(t(),r=setTimeout(i,300),n=!1)};return()=>(n=!0,r||i(),r)}(this._updateHashUnthrottled.bind(this))}addTo(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,l=this._map.getBearing(),c=this._map.getPitch();let u="";if(u+=e?`/${a}/${s}/${r}`:`${r}/${s}/${a}`,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/"+Math.round(c)),this._hashName){const e=this._hashName;let n=!1;const r=t.window.location.hash.slice(1).split("&").map(t=>{const r=t.split("=")[0];return r===e?(n=!0,`${r}=${u}`):t}).filter(t=>t);return n||r.push(`${e}=${u}`),"#"+r.join("&")}return"#"+u}_getCurrentHash(){const e=t.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(t=>t.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(t=>isNaN(t))){const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,e)}}const or={linearity:.3,easing:t.bezier(0,0,.3,1)},ar=t.extend({deceleration:2500,maxSpeed:1400},or),sr=t.extend({deceleration:20,maxSpeed:1400},or),lr=t.extend({deceleration:1e3,maxSpeed:360},or),cr=t.extend({deceleration:1e3,maxSpeed:90},or);class ur{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=t.browser.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)n.zoom+=t.zoomDelta||0,n.bearing+=t.bearingDelta||0,n.pitch+=t.pitchDelta||0,t.panDelta&&n.pan._add(t.panDelta),t.around&&(n.around=t.around),t.pinchAround&&(n.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(n.pan.mag()){const o=pr(n.pan.mag(),r,t.extend({},ar,e||{}));i.offset=n.pan.mult(o.amount/n.pan.mag()),i.center=this._map.transform.center,hr(i,o)}if(n.zoom){const t=pr(n.zoom,r,sr);i.zoom=this._map.transform.zoom+t.amount,hr(i,t)}if(n.bearing){const e=pr(n.bearing,r,lr);i.bearing=this._map.transform.bearing+t.clamp(e.amount,-179,179),hr(i,e)}if(n.pitch){const t=pr(n.pitch,r,cr);i.pitch=this._map.transform.pitch+t.amount,hr(i,t)}if(i.zoom||i.bearing){const t=void 0===n.pinchAround?n.around:n.pinchAround;i.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),t.extend(i,{noMoveStart:!0})}}function hr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function pr(e,n,r){const{maxSpeed:i,linearity:o,deceleration:a}=r,s=t.clamp(e*o/(n/1e3),-i,i),l=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}class dr extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,r,o={}){const a=i.mousePos(n.getCanvasContainer(),r),s=n.unproject(a);super(e,t.extend({point:a,lngLat:s,originalEvent:r},o)),this._defaultPrevented=!1,this.target=n}}class fr extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,r){const o="touchend"===e?r.changedTouches:r.touches,a=i.touchPos(n.getCanvasContainer(),o),s=a.map(t=>n.unproject(t)),l=a.reduce((t,e,n,r)=>t.add(e.div(r.length)),new t.Point(0,0));super(e,{points:a,point:l,lngLats:s,lngLat:n.unproject(l),originalEvent:r}),this._defaultPrevented=!1}}class mr extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,n){super(t,{originalEvent:n}),this._defaultPrevented=!1}}class gr{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new mr(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new dr(t.type,this._map,t))}mouseup(t){this._map.fire(new dr(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new dr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new dr(t.type,this._map,t))}mouseover(t){this._map.fire(new dr(t.type,this._map,t))}mouseout(t){this._map.fire(new dr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new fr(t.type,this._map,t))}touchmove(t){this._map.fire(new fr(t.type,this._map,t))}touchend(t){this._map.fire(new fr(t.type,this._map,t))}touchcancel(t){this._map.fire(new fr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new dr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new dr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vr{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(i.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const n=e;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=n,this._box||(this._box=i.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const o=Math.min(r.x,n.x),a=Math.max(r.x,n.x),s=Math.min(r.y,n.y),l=Math.max(r.y,n.y);i.setTransform(this._box,`translate(${o}px,${s}px)`),this._box.style.width=a-o+"px",this._box.style.height=l-s+"px"}mouseupWindow(e,n){if(!this._active)return;if(0!==e.button)return;const r=this._startPos,o=n;if(this.reset(),i.suppressClick(),r.x!==o.x||r.y!==o.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(r,o,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(i.remove(this._box),this._box=null),i.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))}}function _r(t,e){const n={};for(let r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}class xr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const n=new t.Point(0,0);for(const t of e)n._add(t);return n.div(e.length)}(n),this.touches=_r(r,n)))}touchmove(t,e,n){if(this.aborted||!this.centroid)return;const r=_r(n,e);for(const i in this.touches){const t=this.touches[i],e=r[i];(!e||e.dist(t)>30)&&(this.aborted=!0)}}touchend(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class br{constructor(t){this.singleTap=new xr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,n){this.singleTap.touchstart(t,e,n)}touchmove(t,e,n){this.singleTap.touchmove(t,e,n)}touchend(t,e,n){const r=this.singleTap.touchend(t,e,n);if(r){const e=t.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(r)<30;if(e&&n||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class wr{constructor(){this._zoomIn=new br({numTouches:1,numTaps:2}),this._zoomOut=new br({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)}touchmove(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)}touchend(t,e,n){const r=this._zoomIn.touchend(t,e,n),i=this._zoomOut.touchend(t,e,n);return r?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(r)},{originalEvent:t})}):i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(i)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Mr={0:1,2:2};class Er{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const n=i.mouseButton(t);this._correctButton(t,n)&&(this._lastPoint=e,this._eventButton=n)}mousemoveWindow(t,e){const n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){const n=Mr[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)}mouseupWindow(t){this._lastPoint&&i.mouseButton(t)===this._eventButton&&(this._moved&&i.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sr extends Er{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class Tr extends Er{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(t){t.preventDefault()}}class Ar extends Er{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(t){t.preventDefault()}}class Cr{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)}touchstart(t,e,n){return this._calculateTransform(t,e,n)}touchmove(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)}touchend(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,r){r.length>0&&(this._active=!0);const i=_r(r,n),o=new t.Point(0,0),a=new t.Point(0,0);let s=0;for(const t in i){const e=i[t],n=this._touches[t];n&&(o._add(e),a._add(e.sub(n)),s++,i[t]=e)}if(this._touches=i,s<this._minTouches||!a.mag())return;const l=a.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,e,n){return{}}touchstart(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,n){if(!this._firstTwoTouches)return;t.preventDefault();const[r,i]=this._firstTwoTouches,o=Ir(n,e,r),a=Ir(n,e,i);if(!o||!a)return;const s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}touchend(t,e,n){if(!this._firstTwoTouches)return;const[r,o]=this._firstTwoTouches,a=Ir(n,e,r),s=Ir(n,e,o);a&&s||(this._active&&i.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ir(t,e,n){for(let r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function Pr(t,e){return Math.log(t/e)/Math.LN2}class Rr extends Lr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Pr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pr(this._distance,n),pinchAround:e}}}function Or(t,e){return 180*t.angleWith(e)/Math.PI}class Dr extends Lr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Or(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,n=Or(t,this._startVector);return Math.abs(n)<e}}function Nr(t){return Math.abs(t.y)>Math.abs(t.x)}class kr extends Lr{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,Nr(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,n){const r=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}}gestureBeginsVertically(t,e,n){if(void 0!==this._valid)return this._valid;const r=t.mag()>=2,i=e.mag()>=2;if(!r&&!i)return;if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return Nr(t)&&Nr(e)&&o}}const Fr={panStep:100,bearingStep:15,pitchStep:10};class zr{constructor(){const t=Fr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,n=0,r=0,i=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),i=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),i=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,r=0),{cameraAnimation:a=>{const s=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:Br,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+n*this._bearingStep,pitch:a.getPitch()+r*this._pitchStep,offset:[-i*this._panStep,-o*this._panStep],center:a.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Br(t){return t*(2-t)}class Ur{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;let n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=t.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=i.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform,n=()=>e._terrainEnabled()?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==r&&(r=1/r);const i=n(),o=Math.pow(2,i),a="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(a*r))),"wheel"===this._type&&(this._startZoom=n(),this._easing=this._smoothOutEasing(200)),this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:n(),i=this._startZoom,o=this._easing;let a,s=!1;if("wheel"===this._type&&i&&o){const e=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),n=o(e);a=t.number(i,r,n),e<1?this._frameId||(this._frameId=!0):s=!0}else a=r,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!s,zoomDelta:a-n(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=t.ease;if(this._prevEase){const e=this._prevEase,r=(t.browser.now()-e.start)/e.duration,i=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01,a=Math.sqrt(.0729-o*o);n=t.bezier(o,a,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n}reset(){this._active=!1}}class jr{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gr{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vr{constructor(){this._tap=new br({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))}touchmove(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const r=e[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,n)}touchend(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hr{constructor(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wr{constructor(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qr{constructor(t,e,n,r){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xr=t=>t.zoom||t.drag||t.pitch||t.rotate;class Zr extends t.Event{}class Yr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,n){const r=t.sub([],n,e);this.radius=t.length(r[2]<0?t.div([],r,this.constants):[r[0],r[1],0])}projectRay(e){t.div(e,e,this.constants),t.normalize(e,e),t.mul$1(e,e,this.constants);const n=t.scale$2([],e,this.radius);if(n[2]>0){const e=t.scale$2([],[0,0,1],t.dot(n,[0,0,1])),r=t.scale$2([],t.normalize([],[n[0],n[1],0]),this.radius),i=t.add([],n,t.scale$2([],t.sub([],t.add([],r,e),n),2));n[0]=i[0],n[1]=i[1]}return n}}function $r(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class Jr{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ur(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Yr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),t.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[t.window,"blur",void 0]];for(const[o,a,s]of this._listeners)i.addEventListener(o,a,o===t.window.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(const[e,n,r]of this._listeners)i.removeEventListener(e,n,e===t.window.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new gr(e,t));const r=e.boxZoom=new vr(e,t);this._add("boxZoom",r);const i=new wr,o=new Gr;e.doubleClickZoom=new jr(o,i),this._add("tapZoom",i),this._add("clickZoom",o);const a=new Vr;this._add("tapDragZoom",a);const s=e.touchPitch=new kr;this._add("touchPitch",s);const l=new Tr(t),c=new Ar(t);e.dragRotate=new Wr(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Sr(t),h=new Cr(t);e.dragPan=new Hr(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const p=new Dr,d=new Rr;e.touchZoomRotate=new qr(n,d,p,a),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]),this._add("blockableMapEvent",new yr(e));const f=e.scrollZoom=new Ur(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new zr;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[g]&&e[g].enable(t[g])}_add(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Xr(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,n){for(const r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,t.type+"Window")}_getMapTouches(t){const e=[];for(const n of t)this._el.contains(n.target)&&e.push(n);return e}handleEvent(t,e){if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const n="renderFrame"===t.type?void 0:t,r={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,l=s?i.touchPos(this._el,s):i.mousePos(this._el,t);for(const{handlerName:i,handler:h,allowed:p}of this._handlers){if(!h.isEnabled())continue;let c;this._blockedByActive(a,p,i)?h.reset():h[e||t.type]&&(c=h[e||t.type](t,l,s),this.mergeHandlerResult(r,o,c,i,n),c&&c.needsRenderFrame&&this._triggerRenderFrame()),(c||h.isActive())&&(a[i]=h)}const c={};for(const i in this._previousActiveHandlers)a[i]||(c[i]=n);this._previousActiveHandlers=a,(Object.keys(c).length||$r(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(a).length||$r(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,n,r,i,o){if(!r)return;t.extend(e,r);const a={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=a),void 0!==r.panDelta&&(n.drag=a),void 0!==r.pitchDelta&&(n.pitch=a),void 0!==r.bearingDelta&&(n.rotate=a)}_applyChanges(){const e={},n={},r={};for(const[i,o,a]of this._changes)i.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(i.panDelta)),i.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(e.around=i.around),void 0!==i.aroundCoord&&(e.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(e.pinchAround=i.pinchAround),i.noInertia&&(e.noInertia=i.noInertia),t.extend(n,o),t.extend(r,a);this._updateMapTransform(e,n,r),this._changes=[]}_updateMapTransform(e,n,r){const i=this._map,o=i.transform,a=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!$r(e)){const t=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",t!==o.zoom&&this._map._update(!0)}if(!$r(e))return this._fireEvents(n,r,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:p,pinchAround:d}=e;void 0!==d&&(h=d),(t=>n.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=a(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",i._stop(!0),h=h||i.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(s){const t=o.screenPointToMercatorRay(h),e=o.screenPointToMercatorRay(h.sub(s)),n=this._trackingEllipsoid.projectRay(t.dir),r=this._trackingEllipsoid.projectRay(e.dir);f[0]=r[0]-n[0],f[1]=r[1]-n[1]}const m=o.zoom,g=[0,0,0];if(l){const e=a(p||o.pointCoordinate3D(h)),n={dir:t.normalize([],t.sub([],e,o._camera.position))},r=o.screenPointToMercatorRay(o.centerPoint);if(n.dir[2]<0){const i=t.altitudeFromMercatorZ(e[2],e[1]),s=o.rayIntersectionCoordinate(o.pointRayIntersection(o.centerPoint,i)),c=o.zoomDeltaToMovement(a(s),l)*(r.dir[2]/n.dir[2]);t.scale$2(g,n.dir,c)}else if(o._terrainEnabled()){const r=o.zoomDeltaToMovement(e,l);t.scale$2(g,n.dir,r)}}const y=t.add(f,f,g);o._translateCameraConstrained(y),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,r,!0)}_fireEvents(e,n,r){const i=Xr(this._eventsInProgress),o=Xr(e),a={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(a[t+"start"]=n),this._eventsInProgress[t]=e[t]}!i&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in a)this._fireEvent(t,a[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const s={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=n[e]||r,s[t+"end"]=l)}for(const t in s)this._fireEvent(t,s[t]);const c=Xr(this._eventsInProgress);if(r&&(i||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(n(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.Event("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Zr("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Kr extends t.Evented{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,n,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),r)}panTo(e,n,r){return this.easeTo(t.extend({center:e},n),r)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,n,r){return this.easeTo(t.extend({zoom:e},n),r)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,n,r){return this.easeTo(t.extend({bearing:e},n),r)}resetNorth(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,n){e=t.LngLatBounds.convert(e);const r=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,n)}_extendCameraOptions(e){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.extend({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.extend(n,e.padding),e}_cameraForBoxAndBearing(e,n,r,i){const o=this._extendCameraOptions(i),a=this.transform,s=a.padding,l=a.project(t.LngLat.convert(e)),c=a.project(t.LngLat.convert(n)),u=l.rotate(-t.degToRad(r)),h=c.rotate(-t.degToRad(r)),p=new t.Point(Math.max(u.x,h.x),Math.max(u.y,h.y)),d=new t.Point(Math.min(u.x,h.x),Math.min(u.y,h.y)),f=p.sub(d),m=(a.width-(s.left+s.right+o.padding.left+o.padding.right))/f.x,g=(a.height-(s.top+s.bottom+o.padding.top+o.padding.bottom))/f.y;if(g<0||m<0)return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const y=Math.min(a.scaleZoom(a.scale*Math.min(m,g)),o.maxZoom),v="number"==typeof o.offset.x?new t.Point(o.offset.x,o.offset.y):t.Point.convert(o.offset),_=new t.Point((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(r*Math.PI/180),x=v.add(_).mult(a.scale/a.zoomScale(y));return{center:a.unproject(l.add(c).div(2).sub(x)),zoom:y,bearing:r}}_cameraForBox(e,n,r,i,o){const a=this._extendCameraOptions(o);r=r||0,i=i||0,e=t.LngLat.convert(e),n=t.LngLat.convert(n);const s=this.transform.clone();s.padding=a.padding;const l=this.getFreeCameraOptions(),c=new t.LngLat(.5*(e.lng+n.lng),.5*(e.lat+n.lat)),u=.5*(r+i);if(s._camera.position[2]<t.mercatorZfromAltitude(u,c.lat))return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),s.setFreeCameraOptions(l);const h=t.MercatorCoordinate.fromLngLat(e),p=t.MercatorCoordinate.fromLngLat(n),d=s.pointRayIntersection(s.centerPoint,u),f=[(m=s.rayIntersectionCoordinate(d)).x,m.y,m.z];var m;const g=s.screenPointToMercatorRay(s.centerPoint);let y,v=0;do{const n=Math.floor(s.zoom),o=1<<n,a=Math.min(o*h.x,o*p.x),l=Math.min(o*h.y,o*p.y),c=Math.max(o*h.x,o*p.x),u=Math.max(o*h.y,o*p.y),d=new t.Aabb([a,l,r],[c,u,i]),m=t.Frustum.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,n);if(2!==d.intersects(m)){y&&(s._camera.position=t.scaleAndAdd([],s._camera.position,g.dir,-y),s._updateStateFromCamera());break}const v=t.sub([],s._camera.position,f);y=.5*t.length(v),s._camera.position=t.scaleAndAdd([],s._camera.position,g.dir,y);try{s._updateStateFromCamera()}catch(e){return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}}fitBounds(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)}_raycastElevationBox(e,n){const r=this.transform.elevation;if(!r)return;const i=new t.Point(e.x,n.y),o=new t.Point(n.x,e.y),a=r.pointCoordinate(e);if(!a)return;const s=r.pointCoordinate(n);if(!s)return;const l=r.pointCoordinate(i);if(!l)return;const c=r.pointCoordinate(o);if(!c)return;const u=new t.MercatorCoordinate(a[0],a[1]).toLngLat(),h=new t.MercatorCoordinate(s[0],s[1]).toLngLat(),p=new t.MercatorCoordinate(l[0],l[1]).toLngLat(),d=new t.MercatorCoordinate(c[0],c[1]).toLngLat(),f=Math.min(u.lng,Math.min(h.lng,Math.min(p.lng,d.lng))),m=Math.min(u.lat,Math.min(h.lat,Math.min(p.lat,d.lat))),g=Math.max(u.lng,Math.max(h.lng,Math.max(p.lng,d.lng))),y=Math.max(u.lat,Math.max(h.lat,Math.max(p.lat,d.lat))),v=Math.min(a[3],Math.min(s[3],Math.min(l[3],c[3]))),_=Math.max(a[3],Math.max(s[3],Math.max(l[3],c[3])));return{minLngLat:new t.LngLat(f,m),maxLngLat:new t.LngLat(g,y),minAltitude:v,maxAltitude:_}}fitScreenCoordinates(e,n,r,i,o){let a,s,l,c;const u=t.Point.convert(e),h=t.Point.convert(n),p=this._raycastElevationBox(u,h);if(p)a=p.minLngLat,s=p.maxLngLat,l=p.minAltitude,c=p.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(u,h))return this;a=this.transform.pointLocation(u),s=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),r,i):this._cameraForBox(a,s,l,c,i),i,o)}_fitInternal(e,n,r){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this}jumpTo(e,n){this.stop();const r=this.transform;let i=!1,o=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),i&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),a&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,n){this.stop();const r=this.transform,i=r.zoom,o=r.pitch,a=r.bearing;r.setFreeCameraOptions(e);const s=i!==r.zoom,l=o!==r.pitch,c=a!==r.bearing;return this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),s&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),c&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),l&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n)),this}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);const r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in e?+e.zoom:i,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:a,h="padding"in e?e.padding:r.padding,p=t.Point.convert(e.offset);let d=r.centerPoint.add(p);const f=r.pointLocation(d),m=t.LngLat.convert(e.center||f);this._normalizeCenter(m);const g=r.project(f),y=r.project(m).sub(g),v=r.zoomScale(l-i);let _,x;e.around&&(_=t.LngLat.convert(e.around),x=r.locationPoint(_));const b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==i,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||u!==a,this._padding=!r.isPaddingEqual(h),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,b),this._ease(e=>{if(this._zooming&&(r.zoom=t.number(i,l,e)),this._rotating&&(r.bearing=t.number(o,c,e)),this._pitching&&(r.pitch=t.number(a,u,e)),this._padding&&(r.interpolatePadding(s,h,e),d=r.centerPoint.add(p)),_)r.setLocationAtPoint(_,x);else{const t=r.zoomScale(r.zoom-i),n=l>i?Math.min(2,v):Math.max(.5,v),o=Math.pow(n,1-e),a=r.unproject(g.add(y.mult(e*o)).mult(t));r.setLocationAtPoint(r.renderWorldCopies?a.wrap():a,d)}this._fireMoveEvents(n)},t=>{r.recenterOnTerrain(),this._afterEase(n,t)},e),this}_prepareEase(e,n,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",n||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.transform.cameraElevationReference="ground";const r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}flyTo(e,n){if(!e.essential&&t.browser.prefersReducedMotion){const r=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);const r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in e?t.clamp(+e.zoom,r.minZoom,r.maxZoom):i,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:a,h="padding"in e?e.padding:r.padding,p=r.zoomScale(l-i),d=t.Point.convert(e.offset);let f=r.centerPoint.add(d);const m=r.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);const y=r.project(m),v=r.project(g).sub(y);let _=e.curve;const x=Math.max(r.width,r.height),b=x/p,w=v.mag();if("minZoom"in e){const n=t.clamp(Math.min(e.minZoom,i,l),r.minZoom,r.maxZoom),o=x/r.zoomScale(n-i);_=Math.sqrt(o/w*2)}const M=_*_;function E(t){const e=(b*b-x*x+(t?-1:1)*M*M*w*w)/(2*(t?b:x)*M*w);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function T(t){return(Math.exp(t)+Math.exp(-t))/2}const A=E(0);let C=function(t){return T(A)/T(A+_*t)},L=function(t){return x*((T(A)*(S(e=A+_*t)/T(e))-S(A))/M)/w;var e},I=(E(1)-A)/_;if(Math.abs(w)<1e-6||!isFinite(I)){if(Math.abs(x-b)<1e-6)return this.easeTo(e,n);const t=b<x?-1:1;I=Math.abs(Math.log(b/x))/_,L=function(){return 0},C=function(e){return Math.exp(t*_*e)}}return e.duration="duration"in e?+e.duration:1e3*I/("screenSpeed"in e?+e.screenSpeed/_:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=o!==c,this._pitching=u!==a,this._padding=!r.isPaddingEqual(h),this._prepareEase(n,!1),this._ease(e=>{const p=e*I,m=1/C(p);r.zoom=1===e?l:i+r.scaleZoom(m),this._rotating&&(r.bearing=t.number(o,c,e)),this._pitching&&(r.pitch=t.number(a,u,e)),this._padding&&(r.interpolatePadding(s,h,e),f=r.centerPoint.add(d));const _=1===e?g:r.unproject(y.add(v.mult(L(p))).mult(m));r.setLocationAtPoint(r.renderWorldCopies?_.wrap():_,f),r._updateCenterElevation(),this._fireMoveEvents(n)},()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,n,r){!1===r.animate||0===r.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=t.wrap(e,-180,180);const r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}class Qr{constructor(e={}){this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=i.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=i.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){i.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const n=this._map._getUIString("AttributionControl."+e);t.title=n,t.setAttribute("aria-label",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){const r=n.reduce((t,e,r)=>(e.value&&(t+=`${e.key}=${e.value}${r<n.length-1?"&":""}`),t),"?");e.href=`${t.config.FEEDBACK_URL}/${r}${this._map._hash?this._map._hash.getHashString(!0):""}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(t=>"string"!=typeof t?"":t)):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._sourceCaches;for(const r in e){const n=e[r];if(n.used){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort((t,e)=>t.length-e.length),t=t.filter((e,n)=>{for(let r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0});const n=t.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,t.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ti{constructor(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=i.create("div","mapboxgl-ctrl");const e=i.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){i.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const n=t[e].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class ei{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,n=e?this._queue.concat(e):this._queue;for(const r of n)if(r.id===t)return void(r.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const n of e)if(!n.cancelled&&(n.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ni={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:ri,HTMLElement:ii,ImageBitmap:oi}=t.window,ai={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function si(t){t.parentNode&&t.parentNode.removeChild(t)}const li={showCompass:!0,showZoom:!0,visualizePitch:!1};class ci{constructor(e,n,r=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Tr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new Ar({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener(n,"mousedown",this.mousedown),i.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),i.addEventListener(n,"touchmove",this.touchmove),i.addEventListener(n,"touchend",this.touchend),i.addEventListener(n,"touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),i.disableDrag()}move(t,e){const n=this.map,r=this.mouseRotate.mousemoveWindow(t,e);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){const r=this.mousePitch.mousemoveWindow(t,e);r&&r.pitchDelta&&n.setPitch(n.getPitch()+r.pitchDelta)}}off(){const t=this.element;i.removeEventListener(t,"mousedown",this.mousedown),i.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),i.removeEventListener(t,"touchmove",this.touchmove),i.removeEventListener(t,"touchend",this.touchend),i.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){i.enableDrag(),i.removeEventListener(t.window,"mousemove",this.mousemove),i.removeEventListener(t.window,"mouseup",this.mouseup)}mousedown(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),i.mousePos(this.element,e)),i.addEventListener(t.window,"mousemove",this.mousemove),i.addEventListener(t.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,i.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ui(e,n,r){if(e=new t.LngLat(e.lng,e.lat),n){const i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=360*Math.ceil(Math.abs(e.lng-r.center.lng)/360),s=r.locationPoint(e).distSqr(n),l=n.x<0||n.y<0||n.x>r.width||n.y>r.height;r.locationPoint(i).distSqr(n)<s&&(l||Math.abs(i.lng-r.center.lng)<a)?e=i:r.locationPoint(o).distSqr(n)<s&&(l||Math.abs(o.lng-r.center.lng)<a)&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const hi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pi(t,e,n){const r=t.classList;for(const i in hi)r.remove(`mapboxgl-${n}-anchor-${i}`);r.add(`mapboxgl-${n}-anchor-${e}`)}class di extends t.Evented{constructor(e,n){if(super(),(e instanceof t.window.HTMLElement||n)&&(e=t.extend({element:e},n)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=t.Point.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=i.create("div"),this._element.setAttribute("aria-label","Map marker");const n=i.createNS("http://www.w3.org/2000/svg","svg"),r=41,o=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",r+"px"),n.setAttributeNS(null,"width",o+"px"),n.setAttributeNS(null,"viewBox",`0 0 ${o} ${r}`);const a=i.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");const s=i.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");const l=i.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=i.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=i.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=i.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const p=i.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"fill","#000000");const d=i.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),p.appendChild(d);const f=i.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=i.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=i.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=i.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),s.appendChild(l),s.appendChild(u),s.appendChild(p),s.appendChild(f),s.appendChild(m),n.appendChild(s),n.setAttributeNS(null,"height",r*this._scale+"px"),n.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(n),this._offset=t.Point.convert(e&&e.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()}),pi(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),i.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,n=13.5,r=Math.sqrt(Math.pow(n,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[r,-1*(e-n+r)],"bottom-right":[-r,-1*(e-n+r)],left:[n,-1*(e-n)],right:[-n,-1*(e-n)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_updateOcclusion(){this._occlusionTimer||(this._occlusionTimer=setTimeout(this._onOcclusionTimer.bind(this),60))}_onOcclusionTimer(){const t=this._map.transform,e=this._pos?this._pos.sub(this._transformedOffset()):null;if(e&&e.x>=0&&e.x<t.width&&e.y>=0&&e.y<t.height){const t=this._map.unproject(e),n=this._map.getFreeCameraOptions();if(n.position){const e=n.position.toLngLat(),r=e.distanceTo(t),i=e.distanceTo(this._lngLat);this._element.classList.toggle("mapboxgl-marker-occluded",r<.9*i)}}this._occlusionTimer=null}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ui(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),this._map.transform.elevation&&this._updateOcclusion();let e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(e=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),i.setTransform(this._element,`${hi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${e}`)}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,e=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&e._rotate(t.angle),"map"===this._pitchAlignment&&(e.y*=Math.cos(t._pitch)),e}getOffset(){return this._offset}setOffset(e){return this._offset=t.Point.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const fi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mi,gi=0,yi=!1;const vi={maxWidth:100,unit:"metric"};function _i(t,e,n){const r=n&&n.maxWidth||100,i=t._container.clientHeight/2,o=t.unproject([0,i]),a=t.unproject([r,i]),s=o.distanceTo(a);if(n&&"imperial"===n.unit){const n=3.2808*s;n>5280?xi(e,r,n/5280,t._getUIString("ScaleControl.Miles")):xi(e,r,n,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?xi(e,r,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?xi(e,r,s/1e3,t._getUIString("ScaleControl.Kilometers")):xi(e,r,s,t._getUIString("ScaleControl.Meters"))}function xi(t,e,n,r){const i=function(t){const e=Math.pow(10,(""+Math.floor(t)).length-1);let n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(n),e*n}(n);t.style.width=e*(i/n)+"px",t.innerHTML=`${i}&nbsp;${r}`}const bi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},wi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Mi={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends Kr{constructor(e){if(null!=(e=t.extend({},ai,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new ei,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},ni,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof ii))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Jr(this,e),this._hash=e.hash&&new ir("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Qr({customAttribution:e.customAttribution})),this._logoControl=new ti,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new t.Event(e.dataType+"data",e))}),this.on("dataloading",e=>{this.fire(new t.Event(e.dataType+"dataloading",e))})}_getMapId(){return this._mapId}addControl(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}resize(e){const n=this._containerDimensions(),r=n[0],i=n[1];this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);const o=!this._moving;return o&&(this.stop(),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e))),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}project(e){return this.transform.locationPoint3D(t.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(t.Point.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let r=!1;const i=i=>{const o=this.getLayer(e)?this.queryRenderedFeatures(i.point,{layers:[e]}):[];o.length?r||(r=!0,n.call(this,new dr(t,this,i.originalEvent,{features:o}))):r=!1};return{layer:e,listener:n,delegates:{mousemove:i,mouseout:()=>{r=!1}}}}if("mouseleave"===t||"mouseout"===t){let r=!1;const i=i=>{(this.getLayer(e)?this.queryRenderedFeatures(i.point,{layers:[e]}):[]).length?r=!0:r&&(r=!1,n.call(this,new dr(t,this,i.originalEvent)))},o=e=>{r&&(r=!1,n.call(this,new dr(t,this,e.originalEvent)))};return{layer:e,listener:n,delegates:{mousemove:i,mouseout:o}}}{const r=t=>{const r=this.getLayer(e)?this.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,n.call(this,t),delete t.features)};return{layer:e,listener:n,delegates:{[t]:r}}}}on(t,e,n){if(void 0===n)return super.on(t,e);const r=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const i in r.delegates)this.on(i,r.delegates[i]);return this}once(t,e,n){if(void 0===n)return super.once(t,e);const r=this._createDelegatedListener(t,e,n);for(const i in r.delegates)this.once(i,r.delegates[i]);return this}off(t,e,n){return void 0===n?super.off(t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&(r=>{const i=this._delegatedListeners[t];for(let t=0;t<i.length;t++){const r=i[t];if(r.layer===e&&r.listener===n){for(const t in r.delegates)this.off(t,r.delegates[t]);return i.splice(t,1),this}}})(),this)}queryRenderedFeatures(e,n){return this.style?(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),t&&(this.style=new Xt(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,n){if("string"==typeof e){const r=this._requestManager.normalizeStyleURL(e),i=this._requestManager.transformRequest(r,t.ResourceType.Style);t.getJSON(i,(e,r)=>{e?this.fire(new t.ErrorEvent(e)):r&&this._updateDiff(r,n)})}else"object"==typeof e&&this._updateDiff(e,n)}_updateDiff(e,n){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(e){const n=this.style&&this.style._getSourceCaches(e);if(0!==n.length)return n.every(t=>t.loaded());this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${e}'`)))}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const n=t[e]._tiles;for(const t in n){const e=n[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this.style.removeSource(t),this._updateTerrain(),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,n,{pixelRatio:r=1,sdf:i=!1,stretchX:o,stretchY:a,content:s}={}){if(this._lazyInitEmptyStyle(),n instanceof ri||oi&&n instanceof oi){const{width:l,height:c,data:u}=t.browser.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},u),pixelRatio:r,stretchX:o,stretchY:a,content:s,sdf:i,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:c,data:u}=n,h=n;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},new Uint8Array(u)),pixelRatio:r,stretchX:o,stretchY:a,content:s,sdf:i,version:0,userImage:h}),h.onAdd&&h.onAdd(this,e)}}}updateImage(e,n){const r=this.style.getImage(e);if(!r)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=n instanceof ri||oi&&n instanceof oi?t.browser.getImageData(n):n,{width:o,height:a,data:s}=i;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==r.data.width||a!==r.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(n instanceof ri||oi&&n instanceof oi)),void this.style.updateImage(e,r))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)}setFilter(t,e,n={}){return this.style.setFilter(t,e,n),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,n,r={}){return this.style.setPaintProperty(t,e,n,r),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,n,r={}){return this.style.setLayoutProperty(t,e,n,r),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(t){return this._lazyInitEmptyStyle(),this.style.setTerrain(t),this._update(!0)}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=i.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=i.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=i.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);const r=this._controlContainer=i.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{o[t]=i.create("div","mapboxgl-ctrl-"+t,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,n){const r=t.browser.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"}_setupPainter(){const n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(this.painter=new Xn(r,this.transform),this.on("data",t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)}),t.webpSupported.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(e){let n,r=0;const i=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=i.createQueryEXT(),i.beginQueryEXT(i.TIME_ELAPSED_EXT,n),r=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let o=!1;const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=t.browser.now();this.style.zoomHistory.update(e,n);const r=new t.EvaluationParameters(e,{now:n,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),i=r.crossFadingFactor();1===i&&i===this._crossFadingFactor||(o=!0,this._crossFadingFactor=i),this.style.update(r)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const e=t.browser.now()-r;i.endQueryEXT(i.TIME_ELAPSED_EXT,n),setTimeout(()=>{const r=i.getQueryObjectEXT(n,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(n),this.fire(new t.Event("gpu-timing-frame",{cpuTime:e,gpuTime:r}))},50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout(()=>{const n=this.painter.queryGpuTimers(e);this.fire(new t.Event("gpu-timing-layer",{layerTimes:n}))},50)}const s=this._sourcesDirty||this._styleDirty||this._placementDirty;if(s||this._repaint)this.triggerRepaint();else if(this._triggerFrame(!1),!this.isMoving()&&this.loaded()&&(this.fire(new t.Event("idle")),this._isInitialLoad&&this._authenticate(),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}return!this._loaded||this._fullyLoaded||s||(this._fullyLoaded=!0),this}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===t.AUTH_ERR_MSG||401===e.status)){console.error("Error: A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/"),t.browser.setErrorState();const e=this.painter.context.gl;this._logoControl instanceof ti&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT)}}),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const n=this.painter.context.gl,r=n.createFramebuffer();function i(t){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const e=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,e),e}return n.bindFramebuffer(n.FRAMEBUFFER,r),this._canvasPixelComparison(i(t),e.canvasCopies.map(i),e.timeStamps)}_canvasPixelComparison(t,e,n){let r=n[1]-n[0];const i=t.length/4;for(let o=0;o<e.length;o++){const a=e[o];let s=0;for(let e=0;e<a.length;e+=4)a[e]===t[e]&&a[e+1]===t[e+1]&&a[e+2]===t[e+2]&&a[e+3]===t[e+3]&&(s+=1);r+=(n[o+2]-n[o+1])*(1-s/i)}return r}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),si(this._canvasContainer),si(this._controlContainer),si(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.browser.frame(t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}_setCacheLimits(e,n){t.setCacheLimits(e,n)}get version(){return t.version}},NavigationControl:class{constructor(e){this.options=t.extend({},li,e),this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),i.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),i.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=i.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ci(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){i.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const n=i.create("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){const n=this._map._getUIString("NavigationControl."+e);t.title=n,t.setAttribute("aria-label",n)}},GeolocateControl:class extends t.Evented{constructor(e){super(),this.options=t.extend({},fi,e),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(e){var n;return this._map=e,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==mi?n(mi):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(t=>{mi="denied"!==t.state,n(mi)}):(mi=!!t.window.navigator.geolocation,n(mi)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),i.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,gi=0,yi=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}}_updateCamera(e){const n=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})}_updateMarker(e){if(e){const n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([1,t]),r=e.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&yi)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=i.create("button","mapboxgl-ctrl-geolocate",this._container),i.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=i.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new di(this._dotElement),this._circleElement=i.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new di({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gi--,yi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),gi++,gi>1?(e={maximumAge:6e5,timeout:0},yi=!0):(e=this.options.positionOptions,yi=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qr,ScaleControl:class{constructor(e){this.options=t.extend({},vi,e),t.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){_i(this._map,this._container,this.options)}onAdd(t){return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){i.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(t){this.options.unit=t,_i(this._map,this._container,this.options)}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){i.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=i.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);i.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(e){super(),this.options=t.extend(Object.create(bi),e),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&i.remove(this._content),this._container&&(i.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.window.document.createTextNode(e))}setHTML(e){const n=t.window.document.createDocumentFragment(),r=t.window.document.createElement("body");let i;for(r.innerHTML=e;i=r.firstChild,i;)n.appendChild(i);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=i.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){this._container&&this._container.classList.add(t)}removeClassName(t){this._container&&this._container.classList.remove(t)}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}_createCloseButton(){this.options.closeButton&&(this._closeButton=i.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(t){this._update(t.point)}_onMouseMove(t){this._update(t.point)}_onDrag(t){this._update(t.point)}_update(e){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(this._container||(this._container=i.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=i.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(t=>this._container.classList.add(t)),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ui(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!e)return;const n=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);let r=this.options.anchor;const o=function e(n){if(n){if("number"==typeof n){const e=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(e,e),"top-right":new t.Point(-e,e),bottom:new t.Point(0,-n),"bottom-left":new t.Point(e,-e),"bottom-right":new t.Point(-e,-e),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){const e=t.Point.convert(n);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!r){const t=this._container.offsetWidth,e=this._container.offsetHeight;let i;i=n.y+o.bottom.y<e?["top"]:n.y>this._map.transform.height-e?["bottom"]:[],n.x<t/2?i.push("left"):n.x>this._map.transform.width-t/2&&i.push("right"),r=0===i.length?"bottom":i.join("-")}const a=n.add(o[r]).round();i.setTransform(this._container,`${hi[r]} translate(${a.x}px,${a.y}px)`),pi(this._container,r,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(wi);t&&t.focus()}_onClose(){this.remove()}},Marker:di,Style:Xt,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:er,Evented:t.Evented,config:t.config,prewarm:function(){V().acquire(U)},clearPrewarmedResources:function(){const t=G;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(U),G=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return j.workerCount},set workerCount(t){j.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:t.browser.setNow,restoreNow:t.browser.restoreNow};return Mi})),n}))},e1b1:function(t,e,n){},e27c:function(t,e,n){const r=n("7bc4"),i=n("2093");r.FBXLoader=function(){var t,e,n;function o(t){r.Loader.call(this,t)}function a(t,e){this.textureLoader=t,this.manager=e}function s(){}function l(){}function c(){}function u(){}function h(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function p(){}function d(t){var e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===E(t,0,e.length)}function f(t){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function r(e){var r=t[e-1];return t=t.slice(n+e),n++,r}for(var i=0;i<e.length;++i){var o=r(1);if(o===e[i])return!1}return!0}function m(t){var e=/FBXVersion: (\d+)/,n=t.match(e);if(n){var r=parseInt(n[1]);return r}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function g(t){return t/46186158e3}o.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:o,load:function(t,e,n,i){var o=this,a=""===o.path?r.LoaderUtils.extractUrlBase(t):o.path,s=new r.FileLoader(this.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.load(t,(function(n){try{e(o.parse(n,a))}catch(r){i?i(r):console.error(r),o.manager.itemError(t)}}),n,i)},parse:function(e,n){if(d(e))t=(new u).parse(e);else{var i=E(e);if(!f(i))throw new Error("THREE.FBXLoader: Unknown format.");if(m(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+m(i));t=(new c).parse(i)}var o=new r.TextureLoader(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new a(o,this.manager).parse(t)}}),a.prototype={constructor:a,parse:function(){e=this.parseConnections();var t=this.parseImages(),r=this.parseTextures(t),i=this.parseMaterials(r),o=this.parseDeformers(),a=(new s).parse(o);return this.parseScene(o,a,i),n},parseConnections:function(){var e=new Map;if("Connections"in t){var n=t.Connections.connections;n.forEach((function(t){var n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};e.get(n).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};e.get(r).children.push(a)}))}return e},parseImages:function(){var e={},n={};if("Video"in t.Objects){var r=t.Objects.Video;for(var i in r){var o=r[i],a=parseInt(i);if(e[a]=o.RelativeFilename||o.Filename,"Content"in o){var s=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,l="string"===typeof o.Content&&""!==o.Content;if(s||l){var c=this.parseImage(r[i]);n[o.RelativeFilename||o.Filename]=c}}}}for(var a in e){var u=e[a];void 0!==n[u]?e[a]=n[u]:e[a]=e[a].split("\\").pop()}return e},parseImage:function(t){var e,n=t.Content,r=t.RelativeFilename||t.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),e="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"===typeof n)return"data:"+e+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:e}))},parseTextures:function(e){var n=new Map;if("Texture"in t.Objects){var r=t.Objects.Texture;for(var i in r){var o=this.parseTexture(r[i],e);n.set(parseInt(i),o)}}return n},parseTexture:function(t,e){var n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;var i=t.WrapModeU,o=t.WrapModeV,a=void 0!==i?i.value:0,s=void 0!==o?o.value:0;if(n.wrapS=0===a?r.RepeatWrapping:r.ClampToEdgeWrapping,n.wrapT=0===s?r.RepeatWrapping:r.ClampToEdgeWrapping,"Scaling"in t){var l=t.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}return n},loadTexture:function(t,n){var i,o,a=this.textureLoader.path,s=e.get(t.id).children;void 0!==s&&s.length>0&&void 0!==n[s[0].ID]&&(i=n[s[0].ID],0!==i.indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));var l=t.FileName.slice(-3).toLowerCase();if("tga"===l){var c=this.manager.getHandler(".tga");null===c?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new r.Texture):o=c.load(i)}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new r.Texture):o=this.textureLoader.load(i);return this.textureLoader.setPath(a),o},parseMaterials:function(e){var n=new Map;if("Material"in t.Objects){var r=t.Objects.Material;for(var i in r){var o=this.parseMaterial(r[i],e);null!==o&&n.set(parseInt(i),o)}}return n},parseMaterial:function(t,n){var i=t.id,o=t.attrName,a=t.ShadingModel;if("object"===typeof a&&(a=a.value),!e.has(i))return null;var s,l=this.parseParameters(t,n,i);switch(a.toLowerCase()){case"phong":s=new r.MeshPhongMaterial;break;case"lambert":s=new r.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),s=new r.MeshPhongMaterial;break}return s.setValues(l),s.name=o,s},parseParameters:function(t,n,i){var o={};t.BumpFactor&&(o.bumpScale=t.BumpFactor.value),t.Diffuse?o.color=(new r.Color).fromArray(t.Diffuse.value):t.DiffuseColor&&"Color"===t.DiffuseColor.type&&(o.color=(new r.Color).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(o.displacementScale=t.DisplacementFactor.value),t.Emissive?o.emissive=(new r.Color).fromArray(t.Emissive.value):t.EmissiveColor&&"Color"===t.EmissiveColor.type&&(o.emissive=(new r.Color).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(o.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(o.opacity=parseFloat(t.Opacity.value)),o.opacity<1&&(o.transparent=!0),t.ReflectionFactor&&(o.reflectivity=t.ReflectionFactor.value),t.Shininess&&(o.shininess=t.Shininess.value),t.Specular?o.specular=(new r.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(o.specular=(new r.Color).fromArray(t.SpecularColor.value));var a=this;return e.get(i).children.forEach((function(t){var e=t.relationship;switch(e){case"Bump":o.bumpMap=a.getTexture(n,t.ID);break;case"Maya|TEX_ao_map":o.aoMap=a.getTexture(n,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=a.getTexture(n,t.ID),o.map.encoding=r.sRGBEncoding;break;case"DisplacementColor":o.displacementMap=a.getTexture(n,t.ID);break;case"EmissiveColor":o.emissiveMap=a.getTexture(n,t.ID),o.emissiveMap.encoding=r.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=a.getTexture(n,t.ID);break;case"ReflectionColor":o.envMap=a.getTexture(n,t.ID),o.envMap.mapping=r.EquirectangularReflectionMapping,o.envMap.encoding=r.sRGBEncoding;break;case"SpecularColor":o.specularMap=a.getTexture(n,t.ID),o.specularMap.encoding=r.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=a.getTexture(n,t.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",e);break}})),o},getTexture:function(n,r){return"LayeredTexture"in t.Objects&&r in t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=e.get(r).children[0].ID),n.get(r)},parseDeformers:function(){var n={},r={};if("Deformer"in t.Objects){var i=t.Objects.Deformer;for(var o in i){var a=i[o],s=e.get(parseInt(o));if("Skin"===a.attrType){var l=this.parseSkeleton(s,i);l.ID=o,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,n[o]=l}else if("BlendShape"===a.attrType){var c={id:o};c.rawTargets=this.parseMorphTargets(s,i),c.id=o,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[o]=c}}}return{skeletons:n,morphTargets:r}},parseSkeleton:function(t,e){var n=[];return t.children.forEach((function(t){var i=e[t.ID];if("Cluster"===i.attrType){var o={ID:t.ID,indices:[],weights:[],transformLink:(new r.Matrix4).fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),n.push(o)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(t,n){for(var r=[],i=0;i<t.children.length;i++){var o=t.children[i],a=n[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=e.get(parseInt(o.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,r.push(s)}return r},parseScene:function(i,o,a){n=new r.Group;var s=this.parseModels(i.skeletons,o,a),c=t.Objects.Model,u=this;s.forEach((function(t){var r=c[t.ID];u.setLookAtProperties(t,r);var i=e.get(t.ID).parents;i.forEach((function(e){var n=s.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&n.add(t)})),this.bindSkeleton(i.skeletons,o,s),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrixWorld=t.parent.matrix);var e=b(t.userData.transformData);t.applyMatrix4(e)}}));var h=(new l).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=h,n=n.children[0]),n.animations=h},parseModels:function(n,i,o){var a=new Map,s=t.Objects.Model;for(var l in s){var c=parseInt(l),u=s[l],h=e.get(c),p=this.buildSkeleton(h,n,c,u.attrName);if(!p){switch(u.attrType){case"Camera":p=this.createCamera(h);break;case"Light":p=this.createLight(h);break;case"Mesh":p=this.createMesh(h,i,o);break;case"NurbsCurve":p=this.createCurve(h,i);break;case"LimbNode":case"Root":p=new r.Bone;break;case"Null":default:p=new r.Group;break}p.name=u.attrName?r.PropertyBinding.sanitizeNodeName(u.attrName):"",p.ID=c}this.getTransformData(p,u),a.set(c,p)}return a},buildSkeleton:function(t,e,n,i){var o=null;return t.parents.forEach((function(t){for(var a in e){var s=e[a];s.rawBones.forEach((function(e,a){if(e.ID===t.ID){var l=o;o=new r.Bone,o.matrixWorld.copy(e.transformLink),o.name=i?r.PropertyBinding.sanitizeNodeName(i):"",o.ID=n,s.bones[a]=o,null!==l&&o.add(l)}}))}})),o},createCamera:function(e){var n,i;if(e.children.forEach((function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(i=n)})),void 0===i)n=new r.Object3D;else{var o=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(o=1);var a=1;void 0!==i.NearPlane&&(a=i.NearPlane.value/1e3);var s=1e3;void 0!==i.FarPlane&&(s=i.FarPlane.value/1e3);var l=window.innerWidth,c=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(l=i.AspectWidth.value,c=i.AspectHeight.value);var u=l/c,h=45;void 0!==i.FieldOfView&&(h=i.FieldOfView.value);var p=i.FocalLength?i.FocalLength.value:null;switch(o){case 0:n=new r.PerspectiveCamera(h,u,a,s),null!==p&&n.setFocalLength(p);break;case 1:n=new r.OrthographicCamera(-l/2,l/2,c/2,-c/2,a,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+o+"."),n=new r.Object3D;break}}return n},createLight:function(e){var n,i;if(e.children.forEach((function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(i=n)})),void 0===i)n=new r.Object3D;else{var o;o=void 0===i.LightType?0:i.LightType.value;var a=16777215;void 0!==i.Color&&(a=(new r.Color).fromArray(i.Color.value));var s=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(s=0);var l=0;void 0!==i.FarAttenuationEnd&&(l=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);var c=1;switch(o){case 0:n=new r.PointLight(a,s,l,c);break;case 1:n=new r.DirectionalLight(a,s);break;case 2:var u=Math.PI/3;void 0!==i.InnerAngle&&(u=r.MathUtils.degToRad(i.InnerAngle.value));var h=0;void 0!==i.OuterAngle&&(h=r.MathUtils.degToRad(i.OuterAngle.value),h=Math.max(h,1)),n=new r.SpotLight(a,s,l,u,h,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a THREE.PointLight."),n=new r.PointLight(a,s);break}void 0!==i.CastShadows&&1===i.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(t,e,n){var i,o=null,a=null,s=[];return t.children.forEach((function(t){e.has(t.ID)&&(o=e.get(t.ID)),n.has(t.ID)&&s.push(n.get(t.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new r.MeshPhongMaterial({color:13421772}),s.push(a)),"color"in o.attributes&&s.forEach((function(t){t.vertexColors=!0})),o.FBX_Deformer?(s.forEach((function(t){t.skinning=!0})),i=new r.SkinnedMesh(o,a),i.normalizeSkinWeights()):i=new r.Mesh(o,a),i},createCurve:function(t,e){var n=t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),i=new r.LineBasicMaterial({color:3342591,linewidth:1});return new r.Line(n,i)},getTransformData:function(t,e){var n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?w(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n},setLookAtProperties:function(i,o){if("LookAtProperty"in o){var a=e.get(i.ID).children;a.forEach((function(e){if("LookAtProperty"===e.relationship){var o=t.Objects.Model[e.ID];if("Lcl_Translation"in o){var a=o.Lcl_Translation.value;void 0!==i.target?(i.target.position.fromArray(a),n.add(i.target)):i.lookAt((new r.Vector3).fromArray(a))}}}))}},bindSkeleton:function(t,n,i){var o=this.parsePoseNodes();for(var a in t){var s=t[a],l=e.get(parseInt(s.ID)).parents;l.forEach((function(t){if(n.has(t.ID)){var a=t.ID,l=e.get(a);l.parents.forEach((function(t){if(i.has(t.ID)){var e=i.get(t.ID);e.bind(new r.Skeleton(s.bones),o[t.ID])}}))}}))}},parsePoseNodes:function(){var e={};if("Pose"in t.Objects){var n=t.Objects.Pose;for(var i in n)if("BindPose"===n[i].attrType){var o=n[i].PoseNode;Array.isArray(o)?o.forEach((function(t){e[t.Node]=(new r.Matrix4).fromArray(t.Matrix.a)})):e[o.Node]=(new r.Matrix4).fromArray(o.Matrix.a)}}return e},createAmbientLight:function(){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var e=t.GlobalSettings.AmbientColor.value,i=e[0],o=e[1],a=e[2];if(0!==i||0!==o||0!==a){var s=new r.Color(i,o,a);n.add(new r.AmbientLight(s,1))}}},setupMorphMaterials:function(){var t=this;n.traverse((function(e){e.isMesh&&e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length&&(Array.isArray(e.material)?e.material.forEach((function(n,r){t.setupMorphMaterial(e,n,r)})):t.setupMorphMaterial(e,e.material))}))},setupMorphMaterial:function(t,e,r){var i=t.uuid,o=e.uuid,a=!1;if(n.traverse((function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach((function(e){e.uuid===o&&t.uuid!==i&&(a=!0)})):t.material.uuid===o&&t.uuid!==i&&(a=!0))})),!0===a){var s=e.clone();s.morphTargets=!0,void 0===r?t.material=s:t.material[r]=s}else e.morphTargets=!0}},s.prototype={constructor:s,parse:function(n){var r=new Map;if("Geometry"in t.Objects){var i=t.Objects.Geometry;for(var o in i){var a=e.get(parseInt(o)),s=this.parseGeometry(a,i[o],n);r.set(parseInt(o),s)}}return r},parseGeometry:function(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}},parseMeshGeometry:function(e,n,r){var i=r.skeletons,o=[],a=e.parents.map((function(e){return t.Objects.Model[e.ID]}));if(0!==a.length){var s=e.children.reduce((function(t,e){return void 0!==i[e.ID]&&(t=i[e.ID]),t}),null);e.children.forEach((function(t){void 0!==r.morphTargets[t.ID]&&o.push(r.morphTargets[t.ID])}));var l=a[0],c={};"RotationOrder"in l&&(c.eulerOrder=w(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);var u=b(c);return this.genGeometry(n,s,o,u)}},genGeometry:function(t,e,n,i){var o=new r.BufferGeometry;t.attrName&&(o.name=t.attrName);var a=this.parseGeoNode(t,e),s=this.genBuffers(a),l=new r.Float32BufferAttribute(s.vertex,3);if(l.applyMatrix4(i),o.setAttribute("position",l),s.colors.length>0&&o.setAttribute("color",new r.Float32BufferAttribute(s.colors,3)),e&&(o.setAttribute("skinIndex",new r.Uint16BufferAttribute(s.weightsIndices,4)),o.setAttribute("skinWeight",new r.Float32BufferAttribute(s.vertexWeights,4)),o.FBX_Deformer=e),s.normal.length>0){var c=(new r.Matrix3).getNormalMatrix(i),u=new r.Float32BufferAttribute(s.normal,3);u.applyNormalMatrix(c),o.setAttribute("normal",u)}if(s.uvs.forEach((function(t,e){var n="uv"+(e+1).toString();0===e&&(n="uv"),o.setAttribute(n,new r.Float32BufferAttribute(s.uvs[e],2))})),a.material&&"AllSame"!==a.material.mappingType){var h=s.materialIndex[0],p=0;if(s.materialIndex.forEach((function(t,e){t!==h&&(o.addGroup(p,e-p,h),h=t,p=e)})),o.groups.length>0){var d=o.groups[o.groups.length-1],f=d.start+d.count;f!==s.materialIndex.length&&o.addGroup(f,s.materialIndex.length-f,h)}0===o.groups.length&&o.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(o,t,n,i),o},parseGeoNode:function(t,e){var n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];var r=0;while(t.LayerElementUV[r])n.uv.push(this.parseUVs(t.LayerElementUV[r])),r++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:e,weight:t.weights[i]})}))}))),n},genBuffers:function(t){var e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,o=[],a=[],s=[],l=[],c=[],u=[],h=this;return t.vertexIndices.forEach((function(p,d){var f=!1;p<0&&(p^=-1,f=!0);var m=[],g=[];if(o.push(3*p,3*p+1,3*p+2),t.color){var y=v(d,n,p,t.color);s.push(y[0],y[1],y[2])}if(t.skeleton){if(void 0!==t.weightTable[p]&&t.weightTable[p].forEach((function(t){g.push(t.weight),m.push(t.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var _=[0,0,0,0],x=[0,0,0,0];g.forEach((function(t,e){var n=t,r=m[e];x.forEach((function(t,e,i){if(n>t){i[e]=n,n=t;var o=_[e];_[e]=r,r=o}}))})),m=_,g=x}while(g.length<4)g.push(0),m.push(0);for(var b=0;b<4;++b)c.push(g[b]),u.push(m[b])}if(t.normal){y=v(d,n,p,t.normal);a.push(y[0],y[1],y[2])}if(t.material&&"AllSame"!==t.material.mappingType)var w=v(d,n,p,t.material)[0];t.uv&&t.uv.forEach((function(t,e){var r=v(d,n,p,t);void 0===l[e]&&(l[e]=[]),l[e].push(r[0]),l[e].push(r[1])})),r++,f&&(h.genFace(e,t,o,w,a,s,l,c,u,r),n++,r=0,o=[],a=[],s=[],l=[],c=[],u=[])})),e},genFace:function(t,e,n,r,i,o,a,s,l,c){for(var u=2;u<c;u++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[3*(u-1)]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+1]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+2]]),t.vertex.push(e.vertexPositions[n[3*u]]),t.vertex.push(e.vertexPositions[n[3*u+1]]),t.vertex.push(e.vertexPositions[n[3*u+2]]),e.skeleton&&(t.vertexWeights.push(s[0]),t.vertexWeights.push(s[1]),t.vertexWeights.push(s[2]),t.vertexWeights.push(s[3]),t.vertexWeights.push(s[4*(u-1)]),t.vertexWeights.push(s[4*(u-1)+1]),t.vertexWeights.push(s[4*(u-1)+2]),t.vertexWeights.push(s[4*(u-1)+3]),t.vertexWeights.push(s[4*u]),t.vertexWeights.push(s[4*u+1]),t.vertexWeights.push(s[4*u+2]),t.vertexWeights.push(s[4*u+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(u-1)]),t.weightsIndices.push(l[4*(u-1)+1]),t.weightsIndices.push(l[4*(u-1)+2]),t.weightsIndices.push(l[4*(u-1)+3]),t.weightsIndices.push(l[4*u]),t.weightsIndices.push(l[4*u+1]),t.weightsIndices.push(l[4*u+2]),t.weightsIndices.push(l[4*u+3])),e.color&&(t.colors.push(o[0]),t.colors.push(o[1]),t.colors.push(o[2]),t.colors.push(o[3*(u-1)]),t.colors.push(o[3*(u-1)+1]),t.colors.push(o[3*(u-1)+2]),t.colors.push(o[3*u]),t.colors.push(o[3*u+1]),t.colors.push(o[3*u+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(r),t.materialIndex.push(r),t.materialIndex.push(r)),e.normal&&(t.normal.push(i[0]),t.normal.push(i[1]),t.normal.push(i[2]),t.normal.push(i[3*(u-1)]),t.normal.push(i[3*(u-1)+1]),t.normal.push(i[3*(u-1)+2]),t.normal.push(i[3*u]),t.normal.push(i[3*u+1]),t.normal.push(i[3*u+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(a[n][0]),t.uvs[n].push(a[n][1]),t.uvs[n].push(a[n][2*(u-1)]),t.uvs[n].push(a[n][2*(u-1)+1]),t.uvs[n].push(a[n][2*u]),t.uvs[n].push(a[n][2*u+1])}))},addMorphTargets:function(e,n,r,i){if(0!==r.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var o=this;r.forEach((function(r){r.rawTargets.forEach((function(r){var a=t.Objects.Geometry[r.geoID];void 0!==a&&o.genMorphGeometry(e,n,a,i,r.name)}))}))}},genMorphGeometry:function(t,e,n,i,o){for(var a=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],s=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],c=3*t.attributes.position.count,u=new Float32Array(c),h=0;h<l.length;h++){var p=3*l[h];u[p]=s[3*h],u[p+1]=s[3*h+1],u[p+2]=s[3*h+2]}var d={vertexIndices:a,vertexPositions:u},f=this.genBuffers(d),m=new r.Float32BufferAttribute(f.vertex,3);m.name=o||n.attrName,m.applyMatrix4(i),t.morphAttributes.position.push(m)},parseNormals:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in t?i=t.NormalIndex.a:"NormalsIndex"in t&&(i=t.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:e,referenceType:n}},parseUVs:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.UV.a,i=[];return"IndexToDirect"===n&&(i=t.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:e,referenceType:n}},parseVertexColors:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Colors.a,i=[];return"IndexToDirect"===n&&(i=t.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:e,referenceType:n}},parseMaterialIndices:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=t.Materials.a,i=[],o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:e,referenceType:n}},parseNurbsGeometry:function(t){if(void 0===r.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new r.BufferGeometry;var e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new r.BufferGeometry;for(var n,i,o=e-1,a=t.KnotVector.a,s=[],l=t.Points.a,c=0,u=l.length;c<u;c+=4)s.push((new r.Vector4).fromArray(l,c));if("Closed"===t.Form)s.push(s[0]);else if("Periodic"===t.Form){n=o,i=a.length-1-n;for(c=0;c<o;++c)s.push(s[c])}var h=new r.NURBSCurve(o,a,s,n,i),p=h.getPoints(7*s.length),d=new Float32Array(3*p.length);p.forEach((function(t,e){t.toArray(d,3*e)}));var f=new r.BufferGeometry;return f.setAttribute("position",new r.BufferAttribute(d,3)),f}},l.prototype={constructor:l,parse:function(){var t=[],e=this.parseClips();if(void 0!==e)for(var n in e){var r=e[n],i=this.addClip(r);t.push(i)}return t},parseClips:function(){if(void 0!==t.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var n=this.parseAnimationLayers(e),r=this.parseAnimStacks(n);return r}},parseAnimationCurveNodes:function(){var e=t.Objects.AnimationCurveNode,n=new Map;for(var r in e){var i=e[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var o={id:i.id,attr:i.attrName,curves:{}};n.set(o.id,o)}}return n},parseAnimationCurves:function(n){var r=t.Objects.AnimationCurve;for(var i in r){var o={id:r[i].id,times:r[i].KeyTime.a.map(g),values:r[i].KeyValueFloat.a},a=e.get(o.id);if(void 0!==a){var s=a.parents[0].ID,l=a.parents[0].relationship;l.match(/X/)?n.get(s).curves["x"]=o:l.match(/Y/)?n.get(s).curves["y"]=o:l.match(/Z/)?n.get(s).curves["z"]=o:l.match(/d|DeformPercent/)&&n.has(s)&&(n.get(s).curves["morph"]=o)}}},parseAnimationLayers:function(i){var o=t.Objects.AnimationLayer,a=new Map;for(var s in o){var l=[],c=e.get(parseInt(s));if(void 0!==c){var u=c.children;u.forEach((function(o,a){if(i.has(o.ID)){var s=i.get(o.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===l[a]){var c=e.get(o.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==c){var u=t.Objects.Model[c.toString()];if(void 0===u)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",o);var h={modelName:u.attrName?r.PropertyBinding.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(t){t.ID===u.id&&(h.transform=t.matrix,t.userData.transformData&&(h.eulerOrder=t.userData.transformData.eulerOrder))})),h.transform||(h.transform=new r.Matrix4),"PreRotation"in u&&(h.preRotation=u.PreRotation.value),"PostRotation"in u&&(h.postRotation=u.PostRotation.value),l[a]=h}}l[a]&&(l[a][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===l[a]){var p=e.get(o.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,d=e.get(p).parents[0].ID,f=e.get(d).parents[0].ID;c=e.get(f).parents[0].ID,u=t.Objects.Model[c],h={modelName:u.attrName?r.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:t.Objects.Deformer[p].attrName};l[a]=h}l[a][s.attr]=s}}})),a.set(parseInt(s),l)}}return a},parseAnimStacks:function(n){var r=t.Objects.AnimationStack,i={};for(var o in r){var a=e.get(parseInt(o)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=n.get(a[0].ID);i[o]={name:r[o].attrName,layer:s}}return i},addClip:function(t){var e=[],n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new r.AnimationClip(t.name,-1,e)},generateTracks:function(t){var e=[],n=new r.Vector3,i=new r.Quaternion,o=new r.Vector3;if(t.transform&&t.transform.decompose(n,i,o),n=n.toArray(),i=(new r.Euler).setFromQuaternion(i,t.eulerOrder).toArray(),o=o.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){var a=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==a&&e.push(a)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var s=this.generateRotationTrack(t.modelName,t.R.curves,i,t.preRotation,t.postRotation,t.eulerOrder);void 0!==s&&e.push(s)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var l=this.generateVectorTrack(t.modelName,t.S.curves,o,"scale");void 0!==l&&e.push(l)}if(void 0!==t.DeformPercent){var c=this.generateMorphTrack(t);void 0!==c&&e.push(c)}return e},generateVectorTrack:function(t,e,n,i){var o=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(o,e,n);return new r.VectorKeyframeTrack(t+"."+i,o,a)},generateRotationTrack:function(t,e,n,i,o,a){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(r.MathUtils.degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(r.MathUtils.degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(r.MathUtils.degToRad));var s=this.getTimesForAllAxes(e),l=this.getKeyframeTrackValues(s,e,n);void 0!==i&&(i=i.map(r.MathUtils.degToRad),i.push(a),i=(new r.Euler).fromArray(i),i=(new r.Quaternion).setFromEuler(i)),void 0!==o&&(o=o.map(r.MathUtils.degToRad),o.push(a),o=(new r.Euler).fromArray(o),o=(new r.Quaternion).setFromEuler(o).inverse());for(var c=new r.Quaternion,u=new r.Euler,h=[],p=0;p<l.length;p+=3)u.set(l[p],l[p+1],l[p+2],a),c.setFromEuler(u),void 0!==i&&c.premultiply(i),void 0!==o&&c.multiply(o),c.toArray(h,p/3*4);return new r.QuaternionKeyframeTrack(t+".quaternion",s,h)},generateMorphTrack:function(t){var e=t.DeformPercent.curves.morph,i=e.values.map((function(t){return t/100})),o=n.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new r.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+o+"]",e.times,i)},getTimesForAllAxes:function(t){var e=[];return void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})).filter((function(t,e,n){return n.indexOf(t)==e})),e},getKeyframeTrackValues:function(t,e,n){var r=n,i=[],o=-1,a=-1,s=-1;return t.forEach((function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(a=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==o){var n=e.x.values[o];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==a){var l=e.y.values[a];i.push(l),r[1]=l}else i.push(r[1]);if(-1!==s){var c=e.z.values[s];i.push(c),r[2]=c}else i.push(r[2])})),i},interpolateRotations:function(t){for(var e=1;e<t.values.length;e++){var n=t.values[e-1],r=t.values[e]-n,i=Math.abs(r);if(i>=180){var o=i/180,a=r/o,s=n+a,l=t.times[e-1],c=t.times[e]-l,u=c/o,h=l+u,p=[],d=[];while(h<t.times[e])p.push(h),h+=u,d.push(s),s+=a;t.times=A(t.times,e,p),t.values=A(t.values,e,d)}}}},c.prototype={constructor:c,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new p,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,r){var i=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(!i&&!o){var a=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");a?e.parseNodeBegin(t,a):s?e.parseNodeProperty(t,s,n[++r]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}})),this.allNodes},parseNodeBegin:function(t,e){var n=e[1].trim().replace(/^"/,"").replace(/"$/,""),r=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in a?("PoseNode"===n?a.PoseNode.push(i):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=i)):"number"===typeof o.id?(a[n]={},a[n][o.id]=i):"Properties70"!==n&&(a[n]="PoseNode"===n?[i]:i),"number"===typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var n="",r="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),r=t[2]),{id:e,name:n,type:r}},parseNodeProperty:function(t,e,n){var r=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode(),a=o.name;if("Properties70"!==a){if("C"===r){var s=i.split(",").slice(1),l=parseInt(s[0]),c=parseInt(s[1]),u=i.split(",").slice(3);u=u.map((function(t){return t.trim().replace(/^"/,"")})),r="connections",i=[l,c],S(i,u),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=M(i))}else this.parseNodeSpecialProperty(t,r,i)},parseNodePropertyContinued:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=M(e.a))},parseNodeSpecialProperty:function(t,e,n){var r=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],a=r[2],s=r[3],l=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=M(l);break}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},u.prototype={constructor:u,parse:function(t){var e=new h(t);e.skip(23);var n=e.getUint32(),r=new p;while(!this.endOfContent(e)){var i=this.parseNode(e,n);null!==i&&r.add(i.name,i)}return r},endOfContent:function(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var n={},r=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();var o=t.getUint8(),a=t.getString(o);if(0===r)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(t));var c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",h=s.length>2?s[2]:"";n.singleProperty=1===i&&t.getOffset()===r;while(r>t.getOffset()){var p=this.parseNode(t,e);null!==p&&this.parseSubNode(a,n,p)}return n.propertyList=s,"number"===typeof c&&(n.id=c),""!==u&&(n.attrName=u),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n},parseSubNode:function(t,e,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(e[n.name]=n,n.a=r):e[n.name]=r}else if("Connections"===t&&"C"===n.name){var i=[];n.propertyList.forEach((function(t,e){0!==e&&i.push(t)})),void 0===e.connections&&(e.connections=[]),e.connections.push(i)}else if("Properties70"===n.name){var o=Object.keys(n);o.forEach((function(t){e[t]=n[t]}))}else if("Properties70"===t&&"P"===n.name){var a,s=n.propertyList[0],l=n.propertyList[1],c=n.propertyList[2],u=n.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===l.indexOf("Lcl ")&&(l=l.replace("Lcl ","Lcl_")),a="Color"===l||"ColorRGB"===l||"Vector"===l||"Vector3D"===l||0===l.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[s]={type:l,type2:c,flag:u,value:a}}else void 0===e[n.name]?"number"===typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)},parseProperty:function(t){var e=t.getString(1);switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var n=t.getUint32();return t.getArrayBuffer(n);case"S":n=t.getUint32();return t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=t.getUint32(),o=t.getUint32(),a=t.getUint32();if(0===o)switch(e){case"b":case"c":return t.getBooleanArray(r);case"d":return t.getFloat64Array(r);case"f":return t.getFloat32Array(r);case"i":return t.getInt32Array(r);case"l":return t.getInt64Array(r)}"undefined"===typeof i&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new i.Inflate(new Uint8Array(t.getArrayBuffer(a))),l=new h(s.decompress().buffer);switch(e){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}},h.prototype={constructor:h,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1===(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getBoolean());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t},getInt64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getString:function(t){for(var e=[],n=0;n<t;n++)e[n]=this.getUint8();var i=e.indexOf(0);return i>=0&&(e=e.slice(0,i)),r.LoaderUtils.decodeText(new Uint8Array(e))}},p.prototype={constructor:p,add:function(t,e){this[t]=e}};var y=[];function v(t,e,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=t;break;case"ByPolygon":i=e;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var o=i*r.dataSize,a=o+r.dataSize;return T(y,r.buffer,o,a)}var _=new r.Euler,x=new r.Vector3;function b(t){var e=new r.Matrix4,n=new r.Matrix4,i=new r.Matrix4,o=new r.Matrix4,a=new r.Matrix4,s=new r.Matrix4,l=new r.Matrix4,c=new r.Matrix4,u=new r.Matrix4,h=new r.Matrix4,p=new r.Matrix4,d=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(x.fromArray(t.translation)),t.preRotation){var f=t.preRotation.map(r.MathUtils.degToRad);f.push(t.eulerOrder),n.makeRotationFromEuler(_.fromArray(f))}if(t.rotation){f=t.rotation.map(r.MathUtils.degToRad);f.push(t.eulerOrder),i.makeRotationFromEuler(_.fromArray(f))}if(t.postRotation){f=t.postRotation.map(r.MathUtils.degToRad);f.push(t.eulerOrder),o.makeRotationFromEuler(_.fromArray(f))}t.scale&&a.scale(x.fromArray(t.scale)),t.scalingOffset&&l.setPosition(x.fromArray(t.scalingOffset)),t.scalingPivot&&s.setPosition(x.fromArray(t.scalingPivot)),t.rotationOffset&&c.setPosition(x.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(x.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h=t.parentMatrixWorld);var m=n.multiply(i).multiply(o),g=new r.Matrix4;h.extractRotation(g);var y=new r.Matrix4;y.copyPosition(h);var v=new r.Matrix4;v.getInverse(g).multiply(h);var b=new r.Matrix4;if(0===d)b.copy(g).multiply(m).multiply(v).multiply(a);else if(1===d)b.copy(g).multiply(v).multiply(m).multiply(a);else{var w=(new r.Matrix4).getInverse(a),M=(new r.Matrix4).multiply(v).multiply(w);b.copy(g).multiply(m).multiply(M).multiply(a)}var E=(new r.Matrix4).getInverse(u),S=(new r.Matrix4).getInverse(s),T=new r.Matrix4;T.copy(e).multiply(c).multiply(u).multiply(n).multiply(i).multiply(o).multiply(E).multiply(l).multiply(s).multiply(a).multiply(S);var A=(new r.Matrix4).copyPosition(T),C=(new r.Matrix4).copy(h).multiply(A);return p.copyPosition(C),T=(new r.Matrix4).multiply(p).multiply(b),T}function w(t){t=t||0;var e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===t?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function M(t){var e=t.split(",").map((function(t){return parseFloat(t)}));return e}function E(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),r.LoaderUtils.decodeText(new Uint8Array(t,e,n))}function S(t,e){for(var n=0,r=t.length,i=e.length;n<i;n++,r++)t[r]=e[n]}function T(t,e,n,r){for(var i=n,o=0;i<r;i++,o++)t[o]=e[i];return t}function A(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}return o}(),t.exports=r.FBXLoader},e364:function(t,e){function n(t){return t*Math.PI/180}function r(t){var e=0;if(t.length>2)for(var r,i,o=0;o<t.length-1;o++)r=t[o],i=t[o+1],e+=n(i[0]-r[0])*(2+Math.sin(n(r[1]))+Math.sin(n(i[1])));return e>=0}function i(t){if(t&&t.length>0){if(r(t[0]))return!1;var e=t.slice(1,t.length);if(!e.every(r))return!1}return!0}function o(t){return"Polygon"===t.type?i(t.coordinates):"MultiPolygon"===t.type?t.coordinates.every(i):void 0}t.exports=function(t,e){o(t)||e.push({message:"Polygons and MultiPolygons should follow the right-hand rule",level:"message",line:t.__line__})}},e46a:function(t,e){function n(t,e=0){return[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}t.exports=n},ecba:function(t,e){function n(t,e){return!!t.lngLat&&(t.lngLat.lng===e[0]&&t.lngLat.lat===e[1])}t.exports=n},ed5e:function(t,e,n){var r=n("64af");function o(t){var e,n=0;switch(t.type){case"Polygon":return a(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=a(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(e=0;e<t.geometries.length;e++)n+=o(t.geometries[e]);return n}}function a(t){var e=0;if(t&&t.length>0){e+=Math.abs(s(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(s(t[n]))}return e}function s(t){var e,n,o,a,s,c,u=0,h=t.length;if(h>2){for(i=0;i<h;i++)i===h-2?(a=h-2,s=h-1,c=0):i===h-1?(a=h-1,s=0,c=1):(a=i,s=i+1,c=i+2),e=t[a],n=t[s],o=t[c],u+=(l(o[0])-l(e[0]))*Math.sin(l(n[1]));u=u*r.RADIUS*r.RADIUS/2}return u}function l(t){return t*Math.PI/180}t.exports.geometry=o,t.exports.ring=s},f159:function(t,e){t.exports=function(t,e){return t.length===e.length&&JSON.stringify(t.map(t=>t).sort())===JSON.stringify(e.map(t=>t).sort())}},f767:function(t,e,n){const r=n("93b5"),i=n("a4f5"),o=n("6044"),a=n("c2f7"),s=n("e27c"),l=n("a3c1"),c=n("8fe5"),u=new o,h=new a,p=new l,d=new s,f=new c;function g(t,e,n){if(void 0===t)return console.error("Invalid options provided to loadObj()");let o;switch(t=r._validate(t,i.prototype._defaults.loadObj),t.type||(t.type="mtl"),t.type){case"mtl":o=u;break;case"gltf":case"glb":o=p;break;case"fbx":o=d;break;case"dae":o=f;break}function a(a){a&&"mtl"==t.type&&(a.preload(),o.setMaterials(a)),o.load(t.obj,o=>{let a=[];switch(t.type){case"mtl":o=o.children[0];break;case"gltf":case"glb":case"dae":a=o.animations,o=o.scene;break;case"fbx":a=o.animations;break}o.animations=a;const l=r.types.rotation(t.rotation,[0,0,0]),c=r.types.scale(t.scale,[1,1,1]);o.rotation.set(l[0],l[1],l[2]),o.scale.set(c[0],c[1],c[2]),t.normalize&&s(o),o.name="model";let u=i.prototype._makeGroup(o,t);i.prototype._addMethods(u),u.setAnchor(t.anchor),u.setCenter(t.adjustment),u.raycasted=t.raycasted,n(u),e(u),u.setFixedZoom(t.mapScale),u.idle()},()=>null,e=>{console.error("Could not load model file: "+t.obj+" \n "+e.stack),n("Error loading the model")})}function s(t){t.traverse((function(t){if(t.isMesh){let e;"MeshStandardMaterial"==t.material.type?(t.material.metalness&&(t.material.metalness*=.1),t.material.glossiness&&(t.material.glossiness*=.25),e=new THREE.Color(12,12,12)):"MeshPhongMaterial"==t.material.type&&(t.material.shininess=.1,e=new THREE.Color(20,20,20)),t.material.specular&&t.material.specular.isColor&&(t.material.specular=e)}}))}h.load(t.mtl,a,()=>null,t=>{console.warn("No material file found for SymbolLayer3D model "+m)})}t.exports=g},fa6d:function(t,e,n){var r,a,s,l;(function(){function t(e,n,i){function o(s,l){if(!n[s]){if(!e[s]){var c="function"==typeof r&&r;if(!l&&c)return r(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};e[s][0].call(h.exports,(function(t){var n=e[s][1][t];return o(n||t)}),h,h.exports,t,e,n,i)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}return t})()({1:[function(t,e,n){window.Threebox=t("./src/Threebox.js"),window.THREE=t("./src/three.js")},{"./src/Threebox.js":2,"./src/three.js":23}],2:[function(t,e,n){const r=t("./three.js"),i=t("./camera/CameraSync.js"),o=t("./utils/utils.js"),a=t("./utils/suncalc.js"),s=t("./utils/constants.js"),l=t("./objects/objects.js"),c=t("./utils/material.js"),u=t("./objects/sphere.js"),h=t("./objects/extrusion.js"),p=t("./objects/label.js"),d=t("./objects/tooltip.js"),f=t("./objects/loadObj.js"),m=t("./objects/Object3D.js"),g=t("./objects/line.js"),y=t("./objects/tube.js"),v=t("./objects/LabelRenderer.js"),_=t("./objects/effects/BuildingShadows.js");function x(t,e,n){this.init(t,e,n)}x.prototype={repaint:function(){this.map.repaint=!0},init:function(t,e,n){this.options=o._validate(n||{},b),this.map=t,this.map.tb=this,this.objects=new l,this.renderer=new r.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,canvas:t.getCanvas(),context:e}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.outputEncoding=r.sRGBEncoding,this.renderer.autoClear=!1,this.labelRenderer=new v(this.map),this.scene=new r.Scene,this.world=new r.Group,this.world.name="world",this.scene.add(this.world),this.objectsCache=new Map,this.zoomLayers=[],this.fov=this.options.fov,this.orthographic=this.options.orthographic||!1,this.raycaster=new r.Raycaster,this.raycaster.layers.set(0),this.mapCenter=this.map.getCenter(),this.mapCenterUnits=o.projectToWorld([this.mapCenter.lng,this.mapCenter.lat]),this.lightDateTime=new Date,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition,this.rotationStep=5,this.gridStep=6,this.altitudeStep=.1,this.lights=this.initLights,this.options.defaultLights&&this.defaultLights(),this.options.realSunlight&&this.realSunlight(this.options.realSunlightHelper),this.enableSelectingFeatures=this.options.enableSelectingFeatures||!1,this.enableSelectingObjects=this.options.enableSelectingObjects||!1,this.enableDraggingObjects=this.options.enableDraggingObjects||!1,this.enableRotatingObjects=this.options.enableRotatingObjects||!1,this.enableTooltips=this.options.enableTooltips||!1,this.multiLayer=this.options.multiLayer||!1,this.map.on("style.load",(function(){this.tb.zoomLayers=[],this.tb.options.multiLayer&&this.addLayer({id:"threebox_layer",type:"custom",renderingMode:"3d",map:this,onAdd:function(t,e){},render:function(t,e){this.map.tb.update()}})})),this.map.on("load",(function(){let e;this.selectedObject,this.selectedFeature,this.draggedObject,this.overedObject,this.overedFeature;let n,r=this.getCanvasContainer();this.getCanvasContainer().style.cursor="default";let i,a,s,l,c=[];function u(t){var e=r.getBoundingClientRect();return{x:t.originalEvent.clientX-e.left-r.clientLeft,y:t.originalEvent.clientY-e.top-r.clientTop}}this.unselectObject=function(){this.selectedObject.selected=!1,this.selectedObject=null},this.outObject=function(){this.overedObject.over=!1,this.overedObject=null},this.unselectFeature=function(t){"undefined"!=typeof t.id&&(this.setFeatureState({source:t.source,sourceLayer:t.sourceLayer,id:t.id},{select:!1}),this.removeTooltip(t),t=this.queryRenderedFeatures({layers:[t.layer.id],filter:["==",["id"],t.id]})[0],t&&this.fire("SelectedFeatureChange",{detail:t}),this.selectedFeature=null)},this.selectFeature=function(t){this.selectedFeature=t,this.setFeatureState({source:this.selectedFeature.source,sourceLayer:this.selectedFeature.sourceLayer,id:this.selectedFeature.id},{select:!0}),this.selectedFeature=this.queryRenderedFeatures({layers:[this.selectedFeature.layer.id],filter:["==",["id"],this.selectedFeature.id]})[0],this.addTooltip(this.selectedFeature),this.fire("SelectedFeatureChange",{detail:this.selectedFeature})},this.outFeature=function(e){this.overedFeature&&"undefined"!=typeof this.overedFeature&&this.overedFeature.id!=e&&(t.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!1}),this.removeTooltip(this.overedFeature),this.overedFeature=null)},this.addTooltip=function(t){if(!this.tb.enableTooltips)return;let e=this.tb.getFeatureCenter(t),n=this.tb.tooltip({text:t.properties.name||t.id||t.type,mapboxStyle:!0,feature:t});n.setCoords(e),this.tb.add(n,t.layer.id),t.tooltip=n,t.tooltip.tooltip.visible=!0},this.removeTooltip=function(t){t.tooltip&&(t.tooltip.visibility=!1,this.tb.remove(t.tooltip),t.tooltip=null)},t.onContextMenu=function(t){alert("contextMenu")},this.onClick=function(e){let n,r=[];if(t.tb.enableSelectingObjects&&(r=this.tb.queryRenderedFeatures(e.point)),n="object"==typeof r[0],n){let t=x.prototype.findParent3DObject(r[0]);if(t){if(this.selectedFeature&&this.unselectFeature(this.selectedFeature),this.selectedObject){if(this.selectedObject.uuid!=t.uuid)this.selectedObject.selected=!1,t.selected=!0,this.selectedObject=t;else if(this.selectedObject.uuid==t.uuid)return void this.unselectObject()}else this.selectedObject=t,this.selectedObject.selected=!0;this.selectedObject.dispatchEvent(new CustomEvent("Wireframed",{detail:this.selectedObject,bubbles:!0,cancelable:!0})),this.selectedObject.dispatchEvent(new CustomEvent("IsPlayingChanged",{detail:this.selectedObject,bubbles:!0,cancelable:!0})),this.repaint=!0,e.preventDefault()}}else{let n=[];if(t.tb.enableSelectingFeatures&&(n=this.queryRenderedFeatures(e.point)),n.length>0&&"fill-extrusion"==n[0].layer.type&&"undefined"!=typeof n[0].id)if(this.selectedObject&&this.unselectObject(),this.selectedFeature){if(this.selectedFeature.id!=n[0].id)this.unselectFeature(this.selectedFeature),this.selectFeature(n[0]);else if(this.selectedFeature.id==n[0].id)return void this.unselectFeature(this.selectedFeature)}else this.selectFeature(n[0])}},this.onMouseMove=function(r){let o,c=u(r);if(this.getCanvasContainer().style.cursor="default",r.originalEvent.altKey&&this.draggedObject){if(!t.tb.enableRotatingObjects)return;e="rotate",this.getCanvasContainer().style.cursor="move";Math.min(n.x,c.x),Math.max(n.x,c.x),Math.min(n.y,c.y),Math.max(n.y,c.y);let r={x:0,y:0,z:Math.round(l[2]+~~((c.x-n.x)/this.tb.rotationStep)%360*this.tb.rotationStep%360)};return this.draggedObject.setRotation(r),void this.draggedObject.addHelp("rot: "+r.z+"&#176;")}if(r.originalEvent.shiftKey&&this.draggedObject){if(!t.tb.enableDraggingObjects)return;e="translate",this.getCanvasContainer().style.cursor="move";let n=r.lngLat,o=[Number((n.lng+i).toFixed(this.tb.gridStep)),Number((n.lat+a).toFixed(this.tb.gridStep)),this.draggedObject.modelHeight];return this.draggedObject.setCoords(o),void this.draggedObject.addHelp("lng: "+o[0]+"&#176;, lat: "+o[1]+"&#176;")}if(r.originalEvent.ctrlKey&&this.draggedObject){if(!t.tb.enableDraggingObjects)return;e="altitude",this.getCanvasContainer().style.cursor="move";let n=r.point.y*this.tb.altitudeStep,i=[this.draggedObject.coordinates[0],this.draggedObject.coordinates[1],Number((-n-s).toFixed(this.tb.gridStep))];return this.draggedObject.setCoords(i),void this.draggedObject.addHelp("alt: "+i[2]+"m")}let h=[];if(t.tb.enableSelectingObjects&&(h=this.tb.queryRenderedFeatures(r.point)),o="object"==typeof h[0],o){let t=x.prototype.findParent3DObject(h[0]);t&&(this.outFeature(this.overedFeature),this.getCanvasContainer().style.cursor="pointer",this.selectedObject&&t.uuid==this.selectedObject.uuid||(this.overedObject&&this.overedObject.uuid!=t.uuid&&this.outObject(),t.over=!0,this.overedObject=t),this.repaint=!0,r.preventDefault())}else{this.overedObject&&this.outObject();let e=[];t.tb.enableSelectingFeatures&&(e=this.queryRenderedFeatures(r.point)),e.length>0&&(this.outFeature(e[0]),"fill-extrusion"==e[0].layer.type&&"undefined"!=typeof e[0].id&&(this.selectedFeature&&this.selectedFeature.id==e[0].id||(this.getCanvasContainer().style.cursor="pointer",this.overedFeature=e[0],this.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!0}),this.overedFeature=t.queryRenderedFeatures({layers:[this.overedFeature.layer.id],filter:["==",["id"],this.overedFeature.id]})[0],this.addTooltip(this.overedFeature))))}},this.onMouseDown=function(e){(e.originalEvent.shiftKey||e.originalEvent.altKey||e.originalEvent.ctrlKey)&&0===e.originalEvent.button&&this.selectedObject&&(t.tb.enableDraggingObjects||t.tb.enableRotatingObjects)&&(e.preventDefault(),t.getCanvasContainer().style.cursor="move",t.once("mouseup",this.onMouseUp),this.draggedObject=this.selectedObject,n=u(e),c=this.draggedObject.coordinates,l=o.degreeify(this.draggedObject.rotation),i=c[0]-e.lngLat.lng,a=c[1]-e.lngLat.lat,s=-this.draggedObject.modelHeight-e.point.y*this.tb.altitudeStep)},this.onMouseUp=function(t){this.getCanvasContainer().style.cursor="default",this.off("mouseup",this.onMouseUp),this.off("mouseout",this.onMouseUp),this.dragPan.enable(),this.draggedObject&&(this.draggedObject.dispatchEvent(new CustomEvent("ObjectDragged",{detail:{draggedObject:this.draggedObject,draggedAction:e},bubbles:!0,cancelable:!0})),this.draggedObject.removeHelp(),this.draggedObject=null,e=null)},this.onMouseOut=function(t){if(this.overedFeature){let e=this.queryRenderedFeatures(t.point);e.length>0&&this.overedFeature.id!=e[0].id&&(this.getCanvasContainer().style.cursor="default",this.outFeature(e[0]))}},this.onZoom=function(t){this.tb.zoomLayers.forEach(t=>{this.tb.toggleLayer(t)}),this.tb.world.children.filter(t=>null!=t.fixedZoom).forEach(t=>{t.setObjectScale(this.transform.scale)})};let h=!1,p=!1,d=17,f=91,m=16,g=83;function y(t){t.which!==d&&t.which!==f||(h=!0),t.which===m&&(p=!0);let e=this.selectedObject;if(p&&t.which===g&&e){let t=o.toDecimal;if(e.help)e.removeHelp();else{let n=e.modelSize,r=1;"meters"!==e.userData.units&&(r=o.projectedUnitsPerMeter(e.coordinates[1]),r||(r=1),r=t(r,7)),e.addHelp("size(m): "+t(n.x/r,3)+" W, "+t(n.y/r,3)+" L, "+t(n.z/r,3)+" H"),this.repaint=!0}return!1}}function v(t){t.which!=d&&t.which!=f||(h=!1),t.which===m&&(p=!1)}this.on("click",this.onClick),this.on("mousemove",this.onMouseMove),this.on("mouseout",this.onMouseOut),this.on("mousedown",this.onMouseDown),this.on("zoom",this.onZoom),document.addEventListener("keydown",y.bind(this),!0),document.addEventListener("keyup",v.bind(this))}))},get fov(){return this.options.fov},set fov(t){this.camera instanceof r.PerspectiveCamera&&this.options.fov!==t&&(this.map.transform.fov=t,this.camera.fov=this.map.transform.fov,this.cameraSync.setupCamera(),this.map.repaint=!0,this.options.fov=t)},get orthographic(){return this.options.orthographic},set orthographic(t){const e=this.map.getCanvas().clientHeight,n=this.map.getCanvas().clientWidth;t?(this.map.transform.fov=0,this.camera=new r.OrthographicCamera(n/-2,n/2,e/2,e/-2,.1,1e21)):(this.map.transform.fov=this.fov,this.camera=new r.PerspectiveCamera(this.map.transform.fov,n/e,.1,1e21)),this.camera.layers.enable(0),this.camera.layers.enable(1),this.cameraSync=new i(this.map,this.camera,this.world),this.map.repaint=!0,this.options.orthographic=t},sphere:function(t){return this.setDefaultView(t,this.options),u(t,this.world)},line:g,label:p,tooltip:d,tube:function(t){return this.setDefaultView(t,this.options),y(t,this.world)},extrusion:function(t){return this.setDefaultView(t,this.options),h(t)},Object3D:function(t){return this.setDefaultView(t,this.options),m(t)},loadObj:async function(t,e){this.setDefaultView(t,this.options);let n=this.objectsCache.get(t.obj);n?n.promise.then(n=>{e(n.duplicate(t))}).catch(e=>{this.objectsCache.delete(t.obj),console.error("Could not load model file: "+t.obj)}):this.objectsCache.set(t.obj,{promise:new Promise(async(n,r)=>{f(t,e,async t=>{t.duplicate?n(t.duplicate()):r(t)})})})},material:function(t){return c(t)},initLights:{ambientLight:null,dirLight:null,dirLightBack:null,dirLightHelper:null,hemiLight:null,pointLight:null},utils:o,SunCalc:a,Constants:s,projectToWorld:function(t){return this.utils.projectToWorld(t)},unprojectFromWorld:function(t){return this.utils.unprojectFromWorld(t)},projectedUnitsPerMeter:function(t){return this.utils.projectedUnitsPerMeter(t)},getFeatureCenter:function(t,e,n){return o.getFeatureCenter(t,e,n)},getObjectHeightOnFloor:function(t,e,n){return o.getObjectHeightOnFloor(t,e,n)},queryRenderedFeatures:function(t){let e=new r.Vector2;e.x=t.x/this.map.transform.width*2-1,e.y=1-t.y/this.map.transform.height*2,this.raycaster.setFromCamera(e,this.camera);let n=this.raycaster.intersectObjects(this.world.children,!0);return n},findParent3DObject:function(t){var e;return t.object.traverseAncestors((function(t){t.parent&&"Group"==t.parent.type&&t.userData.obj&&(e=t)})),e},setLayoutProperty:function(t,e,n){this.map.setLayoutProperty(t,e,n),null===n||void 0===n||"visibility"!==e||this.world.children.forEach((function(e){e.layer===t&&(e.visibility=n)}))},setLayerZoomRange:function(t,e,n){this.map.getLayer(t)&&(this.map.setLayerZoomRange(t,e,n),this.zoomLayers.includes(t)||this.zoomLayers.push(t),this.toggleLayer(t))},setLayerHeigthProperty:function(t,e){let n=this.map.getLayer(t);if(n)if("fill-extrusion"==n.type){let t=this.map.getStyle().sources[n.source].data,r=t.features;r.forEach((function(t){t.properties.level=e})),this.map.getSource(n.source).setData(t)}else"custom"==n.type&&this.world.children.forEach((function(n){let r=n.userData.feature;if(r&&r.layer===t){let t=this.tb.getFeatureCenter(r,n,e);n.setCoords(t)}}))},setStyle:function(t,e){this.clear().then(()=>{this.map.setStyle(t,e)})},toggleLayer:function(t,e=!0){let n=this.map.getLayer(t);if(n){if(!e)return void this.toggle(n.id,!1);let t=this.map.getZoom();if(n.minzoom&&t<n.minzoom)return void this.toggle(n.id,!1);if(n.maxzoom&&t>=n.maxzoom)return void this.toggle(n.id,!1);this.toggle(n.id,!0)}},toggle:function(t,e){this.setLayoutProperty(t,"visibility",e?"visible":"none"),this.labelRenderer.toggleLabels(t,e)},update:function(){this.map.repaint&&(this.map.repaint=!1);var t=Date.now();this.objects.animationManager.update(t),this.updateLightHelper(),this.renderer.state.reset(),this.options.realSunlight&&this.renderer.state.setBlending(r.NormalBlending),this.renderer.render(this.scene,this.camera),this.labelRenderer.render(this.scene,this.camera),!1===this.options.passiveRendering&&this.map.triggerRepaint()},add:function(t,e,n){if(!this.enableTooltips&&t.tooltip&&(t.tooltip.visibility=!1),this.world.add(t),e){t.layer=e,t.source=n;let r=this.map.getLayer(e);if(r){let e=r.visibility,n="undefined"===typeof e;t.visibility=!(!n&&"visible"!==e)}}},remove:function(t){this.map.selectedObject&&t.uuid==this.map.selectedObject.uuid&&this.map.unselectObject(),this.map.draggedObject&&t.uuid==this.map.draggedObject.uuid&&(this.map.draggedObject=null),t.dispose&&t.dispose(),this.world.remove(t),t=null},clear:async function(t=null,e=!1){return new Promise((n,r)=>{let i=[];this.world.children.forEach((function(t){i.push(t)}));for(let e=0;e<i.length;e++){let n=i[e];n.layer!==t&&t||this.remove(n)}e&&this.objectsCache.forEach(t=>{t.promise.then(t=>{t.dispose(),t=null})}),n("clear")})},removeLayer:function(t){this.clear(t,!0).then(()=>{this.map.removeLayer(t)})},getSunPosition:function(t,e){return a.getPosition(t,e[1],e[0])},getSunTimes:function(t,e){return a.getTimes(t,e[1],e[0],e[2]?e[2]:0)},setBuildingShadows:function(t){if(this.map.getLayer(t.buildingsLayerId)){let e=new _(t,this);this.map.addLayer(e,t.buildingsLayerId)}else console.warn("The layer '"+t.buildingsLayerId+"' does not exist in the map.")},setSunlight:function(t=new Date,e){if(!this.lights.dirLight||!this.options.realSunlight)return void console.warn("To use setSunlight it's required to set realSunlight : true in Threebox initial options.");var n=new Date(t.getTime());if(e?e.lng&&e.lat?this.mapCenter=e:this.mapCenter={lng:e[0],lat:e[1]}:this.mapCenter=this.map.getCenter(),this.lightDateTime&&this.lightDateTime.getTime()===n.getTime()&&this.lightLng===this.mapCenter.lng&&this.lightLat===this.mapCenter.lat)return;this.lightDateTime=n,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition=this.getSunPosition(n,[this.mapCenter.lng,this.mapCenter.lat]);let r=this.sunPosition.altitude,i=Math.PI+this.sunPosition.azimuth,o=s.WORLD_SIZE/2,a=Math.sin(r),l=Math.cos(r),c=Math.cos(i)*l,u=Math.sin(i)*l;this.lights.dirLight.position.set(u,c,a),this.lights.dirLight.position.multiplyScalar(o),this.lights.dirLight.intensity=Math.max(a,-.15),this.lights.dirLight.updateMatrixWorld(),this.updateLightHelper(),this.map.loaded()&&this.map.setLight({anchor:"map",position:[1.5,180+180*this.sunPosition.azimuth/Math.PI,90-180*this.sunPosition.altitude/Math.PI],"position-transition":{duration:0},color:`hsl(40, ${50*Math.cos(this.sunPosition.altitude)}%, ${96*Math.sin(this.sunPosition.altitude)}%)`},{duration:0})},updateLightHelper:function(){this.lights.dirLightHelper&&(this.lights.dirLightHelper.position.setFromMatrixPosition(this.lights.dirLight.matrixWorld),this.lights.dirLightHelper.updateMatrix(),this.lights.dirLightHelper.update())},dispose:async function(){return console.log(this.memory()),new Promise(t=>{t(this.clear(null,!0).then(t=>(this.map.remove(),this.map={},this.scene.remove(this.world),this.scene.dispose(),this.world.children=[],this.world=null,this.objectsCache.clear(),this.labelRenderer.dispose(),console.log(this.memory()),this.renderer.dispose(),t)))})},defaultLights:function(){this.lights.ambientLight=new r.AmbientLight(new r.Color("hsl(0, 0%, 100%)"),.75),this.scene.add(this.lights.ambientLight),this.lights.dirLightBack=new r.DirectionalLight(new r.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLightBack.position.set(30,100,100),this.scene.add(this.lights.dirLightBack),this.lights.dirLight=new r.DirectionalLight(new r.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLight.position.set(-30,100,-100),this.scene.add(this.lights.dirLight)},realSunlight:function(t=!1){this.renderer.shadowMap.enabled=!0,this.lights.dirLight=new r.DirectionalLight(16777215,1),this.scene.add(this.lights.dirLight),t&&(this.lights.dirLightHelper=new r.DirectionalLightHelper(this.lights.dirLight,5),this.scene.add(this.lights.dirLightHelper));let e=1e3,n=2,i=8192;this.lights.dirLight.castShadow=!0,this.lights.dirLight.shadow.radius=n,this.lights.dirLight.shadow.mapSize.width=i,this.lights.dirLight.shadow.mapSize.height=i,this.lights.dirLight.shadow.camera.top=this.lights.dirLight.shadow.camera.right=e,this.lights.dirLight.shadow.camera.bottom=this.lights.dirLight.shadow.camera.left=-e,this.lights.dirLight.shadow.camera.near=1,this.lights.dirLight.shadow.camera.visible=!0,this.lights.dirLight.shadow.camera.far=4e8,this.lights.hemiLight=new r.HemisphereLight(new r.Color(16777215),new r.Color(16777215),.6),this.lights.hemiLight.color.setHSL(.661,.96,.12),this.lights.hemiLight.groundColor.setHSL(.11,.96,.14),this.lights.hemiLight.position.set(0,0,50),this.scene.add(this.lights.hemiLight),this.setSunlight()},setDefaultView:function(t,e){t.bbox=t.bbox&&e.enableSelectingObjects,t.tooltip=t.tooltip&&e.enableTooltips,t.mapScale=this.map.transform.scale},memory:function(){return this.renderer.info.memory},programs:function(){return this.renderer.info.programs.length},version:"2.1.8"};var b={defaultLights:!1,realSunlight:!1,realSunlightHelper:!1,passiveRendering:!0,preserveDrawingBuffer:!1,enableSelectingFeatures:!1,enableSelectingObjects:!1,enableDraggingObjects:!1,enableRotatingObjects:!1,enableTooltips:!1,multiLayer:!1,orthographic:!1,fov:s.FOV_DEGREES};e.exports=x},{"./camera/CameraSync.js":4,"./objects/LabelRenderer.js":6,"./objects/Object3D.js":7,"./objects/effects/BuildingShadows.js":9,"./objects/extrusion.js":10,"./objects/label.js":11,"./objects/line.js":12,"./objects/loadObj.js":13,"./objects/objects.js":19,"./objects/sphere.js":20,"./objects/tooltip.js":21,"./objects/tube.js":22,"./three.js":23,"./utils/constants.js":24,"./utils/material.js":25,"./utils/suncalc.js":26,"./utils/utils.js":27}],3:[function(t,e,n){const r=t("../three.js"),i=t("../utils/utils.js");function o(t){this.map=t,this.enrolledObjects=[],this.previousFrameTime}o.prototype={unenroll:function(t){this.enrolledObjects.splice(this.enrolledObjects.indexOf(t),1)},enroll:function(t){if(t.clock=new r.Clock,t.hasDefaultAnimation=!1,t.defaultAction,t.actions=[],t.mixer,t.animations&&t.animations.length>0){t.hasDefaultAnimation=!0;let n=t.userData.defaultAnimation?t.userData.defaultAnimation:0;t.mixer=new r.AnimationMixer(t),e(n)}function e(e){for(let n=0;n<t.animations.length;n++){e>t.animations.length&&console.log("The animation index "+e+" doesn't exist for this object");let r=t.animations[n],i=t.mixer.clipAction(r);t.actions.push(i),e===n?(t.defaultAction=i,i.setEffectiveWeight(1)):i.setEffectiveWeight(0),i.play()}}let n=!1;Object.defineProperty(t,"isPlaying",{get(){return n},set(e){n!=e&&(n=e,t.dispatchEvent(new CustomEvent("IsPlayingChanged",{detail:t,bubbles:!0,cancelable:!0})))}}),this.enrolledObjects.push(t),t.animationQueue=[],t.set=function(e){if(e.duration>0){let n={start:Date.now(),expiration:Date.now()+e.duration,endState:{}};i.extend(e,n);let o=e.coords,a=e.rotation,s=e.scale||e.scaleX||e.scaleY||e.scaleZ;if(a){let n=t.rotation;e.startRotation=[n.x,n.y,n.z],e.endState.rotation=i.types.rotation(e.rotation,e.startRotation),e.rotationPerMs=e.endState.rotation.map((function(t,n){return(t-e.startRotation[n])/e.duration}))}if(s){let n=t.scale;e.startScale=[n.x,n.y,n.z],e.endState.scale=i.types.scale(e.scale,e.startScale),e.scalePerMs=e.endState.scale.map((function(t,n){return(t-e.startScale[n])/e.duration}))}o&&(e.pathCurve=new r.CatmullRomCurve3(i.lnglatsToWorld([t.coordinates,e.coords])));let l={type:"set",parameters:e};this.animationQueue.push(l),tb.map.repaint=!0}else this.stop(),e.rotation=i.radify(e.rotation),this._setObject(e);return this},t.animationMethod=null,t.stop=function(e){return t.mixer&&(t.isPlaying=!1,cancelAnimationFrame(t.animationMethod)),this.animationQueue=[],this},t.followPath=function(t,e){let n={type:"followPath",parameters:i._validate(t,a.followPath)};return i.extend(n.parameters,{pathCurve:new r.CatmullRomCurve3(i.lnglatsToWorld(t.path)),start:Date.now(),expiration:Date.now()+n.parameters.duration,cb:e}),this.animationQueue.push(n),tb.map.repaint=!0,this},t._setObject=function(e){t.setScale();let n=e.position,o=e.rotation,a=e.scale,s=e.worldCoordinates,l=e.quaternion,c=e.translate,u=e.worldTranslate;if(n){this.coordinates=n;let t=i.projectToWorld(n);this.position.copy(t)}if(c){this.coordinates=[this.coordinates[0]+c[0],this.coordinates[1]+c[1],this.coordinates[2]+c[2]];let t=i.projectToWorld(c);this.position.copy(t),e.position=this.coordinates}if(u){this.translateX(u.x),this.translateY(u.y),this.translateZ(u.z);let t=i.unprojectFromWorld(this.position);this.coordinates=e.position=t}if(o&&(this.rotation.set(o[0],o[1],o[2]),e.rotation=new r.Vector3(o[0],o[1],o[2])),a&&(this.scale.set(a[0],a[1],a[2]),e.scale=this.scale),l&&(this.quaternion.setFromAxisAngle(l[0],l[1]),e.rotation=l[0].multiplyScalar(l[1])),s){this.position.copy(s);let t=i.unprojectFromWorld(s);this.coordinates=e.position=t}this.setBoundingBoxShadowFloor(),this.setReceiveShadowFloor(),this.updateMatrixWorld(),tb.map.repaint=!0,this.dispatchEvent(new CustomEvent("ObjectChanged",{detail:{object:this,action:{position:e.position,rotation:e.rotation,scale:e.scale}},bubbles:!0,cancelable:!0}))},t.playDefault=function(e){if(t.mixer&&t.hasDefaultAnimation){let n={start:Date.now(),expiration:Date.now()+e.duration,endState:{}};i.extend(e,n),t.mixer.timeScale=e.speed||1;let r={type:"playDefault",parameters:e};return this.animationQueue.push(r),tb.map.repaint=!0,this}},t.playAnimation=function(n){t.mixer&&(n.animation&&e(n.animation),t.playDefault(n))},t.pauseAllActions=function(){t.mixer&&t.actions.forEach((function(t){t.paused=!0}))},t.unPauseAllActions=function(){t.mixer&&t.actions.forEach((function(t){t.paused=!1}))},t.deactivateAllActions=function(){t.mixer&&t.actions.forEach((function(t){t.stop()}))},t.activateAllActions=function(){t.mixer&&t.actions.forEach((function(t){t.play()}))},t.idle=function(){return t.mixer&&t.mixer.update(.01),tb.map.repaint=!0,this}},update:function(t){void 0===this.previousFrameTime&&(this.previousFrameTime=t);if(!this.enrolledObjects)return!1;for(let e=this.enrolledObjects.length-1;e>=0;e--){let n=this.enrolledObjects[e];if(n.animationQueue&&0!==n.animationQueue.length)for(let e=n.animationQueue.length-1;e>=0;e--){let i=n.animationQueue[e];if(!i)continue;let o=i.parameters;if(!o.expiration)return n.animationQueue.splice(e,1),void(n.animationQueue[e]&&(n.animationQueue[e].parameters.start=t));let a=t>=o.expiration;if(a)o.expiration=!1,"playDefault"===i.type?n.stop():(o.endState&&n._setObject(o.endState),"undefined"!=typeof o.cb&&o.cb());else{let e=(t-o.start)/o.duration;if("set"===i.type){let t={};o.pathCurve&&(t.worldCoordinates=o.pathCurve.getPoint(e)),o.rotationPerMs&&(t.rotation=o.startRotation.map((function(t,n){return t+o.rotationPerMs[n]*e*o.duration}))),o.scalePerMs&&(t.scale=o.startScale.map((function(t,n){return t+o.scalePerMs[n]*e*o.duration}))),n._setObject(t)}if("followPath"===i.type){let t=o.pathCurve.getPointAt(e),i={worldCoordinates:t};if(o.trackHeading){let t=o.pathCurve.getTangentAt(e).normalize(),n=new r.Vector3(0,0,0),a=new r.Vector3(0,1,0);n.crossVectors(a,t).normalize();let s=Math.acos(a.dot(t));i.quaternion=[n,s]}n._setObject(i)}"playDefault"===i.type&&(n.activateAllActions(),n.isPlaying=!0,n.animationMethod=requestAnimationFrame(this.update),n.mixer.update(n.clock.getDelta()),tb.map.repaint=!0)}}}this.previousFrameTime=t}};const a={followPath:{path:null,duration:1e3,trackHeading:!0}};e.exports=o},{"../three.js":23,"../utils/utils.js":27}],4:[function(t,e,n){const r=t("../three.js"),i=t("../utils/utils.js"),o=t("../utils/constants.js");function a(t,e,n){this.map=t,this.camera=e,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=n||new r.Group,this.world.position.x=this.world.position.y=o.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1,this.state={translateCenter:(new r.Matrix4).makeTranslation(o.WORLD_SIZE/2,-o.WORLD_SIZE/2,0),worldSizeRatio:o.TILE_SIZE/o.WORLD_SIZE,worldSize:o.TILE_SIZE*this.map.transform.scale};let i=this;this.map.on("move",(function(){i.updateCamera()})).on("resize",(function(){i.setupCamera()})),this.setupCamera()}a.prototype={setupCamera:function(){this.state.fov=this.map.transform._fov;const t=this.map.transform;this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix(),this.halfFov=this.state.fov/2;const e={x:t.width/2,y:t.height/2},n=.5/Math.tan(this.halfFov)*t.height,i=t._maxPitch*Math.PI/180;this.acuteAngle=Math.PI/2-i,this.state.cameraToCenterDistance=n,this.state.offset=e,this.state.cameraTranslateZ=(new r.Matrix4).makeTranslation(0,0,this.state.cameraToCenterDistance),this.state.maxFurthestDistance=.95*this.state.cameraToCenterDistance*(Math.cos(this.acuteAngle)*Math.sin(this.halfFov)/Math.sin(Math.max(.01,Math.min(Math.PI-.01,this.acuteAngle-this.halfFov)))+1),this.updateCamera()},updateCamera:function(t){if(!this.camera)return void console.log("nocamera");const e=this.map.transform,n=Math.PI/2+e._pitch;this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*e.height,this.state.cameraTranslateZ=(new r.Matrix4).makeTranslation(0,0,this.cameraToCenterDistance);const o=Math.sin(this.halfFov)*this.state.cameraToCenterDistance/Math.sin(Math.PI-n-this.halfFov),a=Math.cos(Math.PI/2-e._pitch),s=a*o+this.state.cameraToCenterDistance,l=1.01*s,c=e.height/50,u=Math.max(c*a,c),h=e.height,p=e.width;this.camera instanceof r.OrthographicCamera?this.camera.projectionMatrix=i.makeOrthographicMatrix(p/-2,p/2,h/2,h/-2,u,l):this.camera.projectionMatrix=i.makePerspectiveMatrix(this.state.fov,p/h,u,l);let d=this.calcCameraMatrix(e._pitch,e.angle);this.camera.matrixWorld.copy(d);let f=e.scale*this.state.worldSizeRatio,m=new r.Matrix4,g=new r.Matrix4,y=new r.Matrix4;m.makeScale(f,f,f);let v=e.x||e.point.x,_=e.y||e.point.y;g.makeTranslation(-v,_,0),y.makeRotationZ(Math.PI),this.world.matrix=(new r.Matrix4).premultiply(y).premultiply(this.state.translateCenter).premultiply(m).premultiply(g)},calcCameraMatrix(t,e,n){const i=this.map.transform,o=void 0===t?i._pitch:t,a=void 0===e?i.angle:e,s=void 0===n?this.state.cameraTranslateZ:n;return(new r.Matrix4).premultiply(s).premultiply((new r.Matrix4).makeRotationX(o)).premultiply((new r.Matrix4).makeRotationZ(a))}},e.exports=a},{"../three.js":23,"../utils/constants.js":24,"../utils/utils.js":27}],5:[function(t,e,n){const r=t("../three.js");r.CSS2DObject=function(t){r.Object3D.call(this),this.element=t||document.createElement("div"),this.element.style.position="absolute",this.alwaysVisible=!1,Object.defineProperty(this,"layer",{get(){return this.parent&&this.parent.parent?this.parent.parent.layer:null}}),this.dispose=function(){this.remove(),this.element=null},this.remove=function(){this.element instanceof Element&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)},this.addEventListener("removed",(function(){this.remove()}))},r.CSS2DObject.prototype=Object.assign(Object.create(r.Object3D.prototype),{constructor:r.CSS2DObject,copy:function(t,e){return r.Object3D.prototype.copy.call(this,t,e),this.element=t.element.cloneNode(!0),this}}),r.CSS2DRenderer=function(){var t,e,n,i,o=this,a=new r.Vector3,s=new r.Matrix4,l=new r.Matrix4,c={objects:new WeakMap,list:new Map};this.cacheList=c.list;var u=document.createElement("div");u.style.overflow="hidden",this.domElement=u,this.getSize=function(){return{width:t,height:e}},this.setSize=function(r,o){t=r,e=o,n=t/2,i=e/2,u.style.width=r+"px",u.style.height=o+"px"},this.renderObject=function(t,e,s){if(t instanceof r.CSS2DObject)if(t.visible){t.onBeforeRender(o,e,s),a.setFromMatrixPosition(t.matrixWorld),a.applyMatrix4(l);var p=t.element,d="translate(-50%,-50%) translate("+(a.x*n+n)+"px,"+(-a.y*i+i)+"px)";p.style.WebkitTransform=d,p.style.MozTransform=d,p.style.oTransform=d,p.style.transform=d,p.style.display=t.visible&&a.z>=-1&&a.z<=1?"":"none";var f={distanceToCameraSquared:h(s,t)};c.objects.set({key:t.uuid},f),c.list.set(t.uuid,t),p.parentNode!==u&&u.appendChild(p),t.onAfterRender(o,e,s)}else c.objects.delete({key:t.uuid}),c.list.delete(t.uuid),t.remove();for(var m=0,g=t.children.length;m<g;m++)this.renderObject(t.children[m],e,s)};var h=function(){var t=new r.Vector3,e=new r.Vector3;return function(n,r){return t.setFromMatrixPosition(n.matrixWorld),e.setFromMatrixPosition(r.matrixWorld),t.distanceToSquared(e)}}(),p=function(t){var e=[];return t.traverse((function(t){t instanceof r.CSS2DObject&&e.push(t)})),e},d=function(t){for(var e=p(t).sort((function(t,e){let n=c.objects.get({key:t.uuid}),r=c.objects.get({key:e.uuid});if(n&&r){var i=n.distanceToCameraSquared,o=r.distanceToCameraSquared;return i-o}})),n=e.length,r=0,i=e.length;r<i;r++)e[r].element.style.zIndex=n-r};this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),s.copy(e.matrixWorldInverse),l.multiplyMatrices(e.projectionMatrix,s),this.renderObject(t,t,e),d(t)}},e.exports={CSS2DRenderer:r.CSS2DRenderer,CSS2DObject:r.CSS2DObject}},{"../three.js":23}],6:[function(t,e,n){const r=t("./CSS2DRenderer.js");function i(t){this.map=t,this.renderer=new r.CSS2DRenderer,this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.id="labelCanvas",this.renderer.domElement.style.top=0,this.renderer.domElement.style.zIndex="0",this.map.getCanvasContainer().appendChild(this.renderer.domElement),this.scene,this.camera,this.dispose=function(){this.map.getCanvasContainer().removeChild(this.renderer.domElement),this.renderer.domElement.remove(),this.renderer={}},this.setSize=function(t,e){this.renderer.setSize(t,e)},this.map.on("resize",function(){this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight)}.bind(this)),this.state={reset:function(){}},this.render=async function(t,e){return this.scene=t,this.camera=e,new Promise(n=>{n(this.renderer.render(t,e))})},this.toggleLabels=async function(t,e){return new Promise(n=>{n(this.setVisibility(t,e,this.scene,this.camera,this.renderer))})},this.setVisibility=function(t,e,n,r,i){var o=this.renderer.cacheList;o.forEach((function(o){o.visible!=e&&o.layer===t&&(e&&o.alwaysVisible||!e)&&(o.visible=e,i.renderObject(o,n,r))}))}}e.exports=i},{"./CSS2DRenderer.js":5}],7:[function(t,e,n){const r=t("./objects.js"),i=t("../utils/utils.js");function o(t){t=i._validate(t,r.prototype._defaults.Object3D);let e=t.obj;const n=i.types.rotation(t.rotation,[0,0,0]),o=i.types.scale(t.scale,[1,1,1]);e.rotation.set(n[0],n[1],n[2]),e.scale.set(o[0],o[1],o[2]),e.name="model";let a=r.prototype._makeGroup(e,t);return t.obj.name="model",r.prototype._addMethods(a),a.setAnchor(t.anchor),a.setCenter(t.adjustment),a.raycasted=t.raycasted,a.visibility=!0,a}e.exports=o},{"../utils/utils.js":27,"./objects.js":19}],8:[function(t,e,n){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */var r={},i=void 0,o=r;function a(t,e){var n,r=t.split("."),a=o;!(r[0]in a)&&a.execScript&&a.execScript("var "+r[0]);for(;r.length&&(n=r.shift());)r.length||e===i?a=a[n]?a[n]:a[n]={}:a[n]=e}var s="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function l(t){var e,n,r,i,o,a,l,c,u,h,p=t.length,d=0,f=Number.POSITIVE_INFINITY;for(c=0;c<p;++c)t[c]>d&&(d=t[c]),t[c]<f&&(f=t[c]);for(e=1<<d,n=new(s?Uint32Array:Array)(e),r=1,i=0,o=2;r<=d;){for(c=0;c<p;++c)if(t[c]===r){for(a=0,l=i,u=0;u<r;++u)a=a<<1|1&l,l>>=1;for(h=r<<16|c,u=a;u<e;u+=o)n[u]=h;++i}++r,i<<=1,o<<=1}return[n,d,f]}function c(t,e){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=s?new Uint8Array(t):t,this.m=!1,this.i=h,this.r=!1,!e&&(e={})||(e.index&&(this.a=e.index),e.bufferSize&&(this.h=e.bufferSize),e.bufferType&&(this.i=e.bufferType),e.resize&&(this.r=e.resize)),this.i){case u:this.b=32768,this.c=new(s?Uint8Array:Array)(32768+this.h+258);break;case h:this.b=0,this.c=new(s?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var u=0,h=1,p={t:u,s:h};c.prototype.k=function(){for(;!this.m;){var t=P(this,3);switch(1&t&&(this.m=!0),t>>>=1,t){case 0:var e=this.input,n=this.a,r=this.c,o=this.b,a=e.length,c=i,p=i,d=r.length,f=i;if(this.d=this.f=0,n+1>=a)throw Error("invalid uncompressed block header: LEN");if(c=e[n++]|e[n++]<<8,n+1>=a)throw Error("invalid uncompressed block header: NLEN");if(p=e[n++]|e[n++]<<8,c===~p)throw Error("invalid uncompressed block header: length verify");if(n+c>e.length)throw Error("input buffer is broken");switch(this.i){case u:for(;o+c>r.length;){if(f=d-o,c-=f,s)r.set(e.subarray(n,n+f),o),o+=f,n+=f;else for(;f--;)r[o++]=e[n++];this.b=o,r=this.e(),o=this.b}break;case h:for(;o+c>r.length;)r=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(s)r.set(e.subarray(n,n+c),o),o+=c,n+=c;else for(;c--;)r[o++]=e[n++];this.a=n,this.b=o,this.c=r;break;case 1:this.j(C,I);break;case 2:var m=P(this,5)+257,y=P(this,5)+1,v=P(this,4)+4,_=new(s?Uint8Array:Array)(g.length),x=i,b=i,w=i,M=i,E=i,S=i,T=i,A=i,L=i;for(A=0;A<v;++A)_[g[A]]=P(this,3);if(!s)for(A=v,v=_.length;A<v;++A)_[g[A]]=0;for(x=l(_),M=new(s?Uint8Array:Array)(m+y),A=0,L=m+y;A<L;)switch(E=R(this,x),E){case 16:for(T=3+P(this,2);T--;)M[A++]=S;break;case 17:for(T=3+P(this,3);T--;)M[A++]=0;S=0;break;case 18:for(T=11+P(this,7);T--;)M[A++]=0;S=0;break;default:S=M[A++]=E}b=l(s?M.subarray(0,m):M.slice(0,m)),w=l(s?M.subarray(m):M.slice(m)),this.j(b,w);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var d,f,m=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],g=s?new Uint16Array(m):m,y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],v=s?new Uint16Array(y):y,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],x=s?new Uint8Array(_):_,b=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],w=s?new Uint16Array(b):b,M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=s?new Uint8Array(M):M,S=new(s?Uint8Array:Array)(288);for(d=0,f=S.length;d<f;++d)S[d]=143>=d?8:255>=d?9:279>=d?7:8;var T,A,C=l(S),L=new(s?Uint8Array:Array)(30);for(T=0,A=L.length;T<A;++T)L[T]=5;var I=l(L);function P(t,e){for(var n,r=t.f,i=t.d,o=t.input,a=t.a,s=o.length;i<e;){if(a>=s)throw Error("input buffer is broken");r|=o[a++]<<i,i+=8}return n=r&(1<<e)-1,t.f=r>>>e,t.d=i-e,t.a=a,n}function R(t,e){for(var n,r,i=t.f,o=t.d,a=t.input,s=t.a,l=a.length,c=e[0],u=e[1];o<u&&!(s>=l);)i|=a[s++]<<o,o+=8;if(n=c[i&(1<<u)-1],r=n>>>16,r>o)throw Error("invalid code length: "+r);return t.f=i>>r,t.d=o-r,t.a=s,65535&n}function O(t,e){var n,r;switch(this.input=t,this.a=0,!e&&(e={})||(e.index&&(this.a=e.index),e.verify&&(this.A=e.verify)),n=t[this.a++],r=t[this.a++],15&n){case D:this.method=D;break;default:throw Error("unsupported compression method")}if(0!==((n<<8)+r)%31)throw Error("invalid fcheck flag:"+((n<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new c(t,{index:this.a,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}c.prototype.j=function(t,e){var n=this.c,r=this.b;this.o=t;for(var i,o,a,s,l=n.length-258;256!==(i=R(this,t));)if(256>i)r>=l&&(this.b=r,n=this.e(),r=this.b),n[r++]=i;else for(o=i-257,s=v[o],0<x[o]&&(s+=P(this,x[o])),i=R(this,e),a=w[i],0<E[i]&&(a+=P(this,E[i])),r>=l&&(this.b=r,n=this.e(),r=this.b);s--;)n[r]=n[r++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},c.prototype.w=function(t,e){var n=this.c,r=this.b;this.o=t;for(var i,o,a,s,l=n.length;256!==(i=R(this,t));)if(256>i)r>=l&&(n=this.e(),l=n.length),n[r++]=i;else for(o=i-257,s=v[o],0<x[o]&&(s+=P(this,x[o])),i=R(this,e),a=w[i],0<E[i]&&(a+=P(this,E[i])),r+s>l&&(n=this.e(),l=n.length);s--;)n[r]=n[r++-a];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},c.prototype.e=function(){var t,e,n=new(s?Uint8Array:Array)(this.b-32768),r=this.b-32768,i=this.c;if(s)n.set(i.subarray(32768,n.length));else for(t=0,e=n.length;t<e;++t)n[t]=i[t+32768];if(this.g.push(n),this.l+=n.length,s)i.set(i.subarray(r,r+32768));else for(t=0;32768>t;++t)i[t]=i[r+t];return this.b=32768,i},c.prototype.z=function(t){var e,n,r,i,o=this.input.length/this.a+1|0,a=this.input,l=this.c;return t&&("number"===typeof t.p&&(o=t.p),"number"===typeof t.u&&(o+=t.u)),2>o?(n=(a.length-this.a)/this.o[2],i=n/2*258|0,r=i<l.length?l.length+i:l.length<<1):r=l.length*o,s?(e=new Uint8Array(r),e.set(l)):e=l,this.c=e},c.prototype.n=function(){var t,e,n,r,i,o=0,a=this.c,l=this.g,c=new(s?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return s?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(e=0,n=l.length;e<n;++e)for(t=l[e],r=0,i=t.length;r<i;++r)c[o++]=t[r];for(e=32768,n=this.b;e<n;++e)c[o++]=a[e];return this.g=[],this.buffer=c},c.prototype.v=function(){var t,e=this.b;return s?this.r?(t=new Uint8Array(e),t.set(this.c.subarray(0,e))):t=this.c.subarray(0,e):(this.c.length>e&&(this.c.length=e),t=this.c),this.buffer=t},O.prototype.k=function(){var t,e,n=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){e=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var r=t;if("string"===typeof r){var i,o,a=r.split("");for(i=0,o=a.length;i<o;i++)a[i]=(255&a[i].charCodeAt(0))>>>0;r=a}for(var s,l=1,c=0,u=r.length,h=0;0<u;){s=1024<u?1024:u,u-=s;do{l+=r[h++],c+=l}while(--s);l%=65521,c%=65521}if(e!==(c<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return t};var D=8;a("Zlib.Inflate",O),a("Zlib.Inflate.prototype.decompress",O.prototype.k);var N,k,F,z,B={ADAPTIVE:p.s,BLOCK:p.t};if(Object.keys)N=Object.keys(B);else for(k in N=[],F=0,B)N[F++]=k;for(F=0,z=N.length;F<z;++F)k=N[F],a("Zlib.Inflate.BufferType."+k,B[k]);var U=r.Zlib;e.exports=U},{}],9:[function(t,e,n){t("../../utils/suncalc.js");class r{constructor(t,e){this.id=t.layerId,this.type="custom",this.renderingMode="3d",this.opacity=.5,this.buildingsLayerId=t.buildingsLayerId,this.minAltitude=t.minAltitude||.1,this.tb=e}onAdd(t,e){this.map=t;const n="\n\t\t\tuniform mat4 u_matrix;\n\t\t\tuniform float u_height_factor;\n\t\t\tuniform float u_altitude;\n\t\t\tuniform float u_azimuth;\n\t\t\tattribute vec2 a_pos;\n\t\t\tattribute vec4 a_normal_ed;\n\t\t\tattribute lowp vec2 a_base;\n\t\t\tattribute lowp vec2 a_height;\n\t\t\tvoid main() {\n\t\t\t\tfloat base = max(0.0, a_base.x);\n\t\t\t\tfloat height = max(0.0, a_height.x);\n\t\t\t\tfloat t = mod(a_normal_ed.x, 2.0);\n\t\t\t\tvec4 pos = vec4(a_pos, t > 0.0 ? height : base, 1);\n\t\t\t\tfloat len = pos.z * u_height_factor / tan(u_altitude);\n\t\t\t\tpos.x += cos(u_azimuth) * len;\n\t\t\t\tpos.y += sin(u_azimuth) * len;\n\t\t\t\tpos.z = 0.0;\n\t\t\t\tgl_Position = u_matrix * pos;\n\t\t\t}\n\t\t\t",r="\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 0.7);\n\t\t\t}\n\t\t\t",i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,n),e.compileShader(i);const o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,r),e.compileShader(o),this.program=e.createProgram(),e.attachShader(this.program,i),e.attachShader(this.program,o),e.linkProgram(this.program),e.validateProgram(this.program),this.uMatrix=e.getUniformLocation(this.program,"u_matrix"),this.uHeightFactor=e.getUniformLocation(this.program,"u_height_factor"),this.uAltitude=e.getUniformLocation(this.program,"u_altitude"),this.uAzimuth=e.getUniformLocation(this.program,"u_azimuth"),this.aPos=e.getAttribLocation(this.program,"a_pos"),this.aNormal=e.getAttribLocation(this.program,"a_normal_ed"),this.aBase=e.getAttribLocation(this.program,"a_base"),this.aHeight=e.getAttribLocation(this.program,"a_height")}render(t,e){t.useProgram(this.program);const n=this.map.style.sourceCaches["composite"],r=n.getVisibleCoordinates().reverse(),i=this.map.getLayer(this.buildingsLayerId),o=this.map.painter.context,{lng:a,lat:s}=this.map.getCenter(),l=this.tb.getSunPosition(this.tb.lightDateTime,[a,s]);t.uniform1f(this.uAltitude,l.altitude>this.minAltitude?l.altitude:0),t.uniform1f(this.uAzimuth,l.azimuth+3*Math.PI/2),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);t.getExtension("EXT_blend_minmax");t.disable(t.DEPTH_TEST);for(const c of r){const e=n.getTile(c),r=e.getBucket(i);if(!r)continue;const[a,s]=r.programConfigurations.programConfigurations[this.buildingsLayerId]._buffers;t.uniformMatrix4fv(this.uMatrix,!1,c.posMatrix),t.uniform1f(this.uHeightFactor,Math.pow(2,c.overscaledZ)/e.tileSize/8);for(const n of r.segments.get()){const e=o.currentNumAttributes||0,i=2;for(let n=i;n<e;n++)t.disableVertexAttribArray(n);const l=n.vertexOffset||0;t.enableVertexAttribArray(this.aPos),t.enableVertexAttribArray(this.aNormal),t.enableVertexAttribArray(this.aHeight),t.enableVertexAttribArray(this.aBase),r.layoutVertexBuffer.bind(),t.vertexAttribPointer(this.aPos,2,t.SHORT,!1,12,12*l),t.vertexAttribPointer(this.aNormal,4,t.SHORT,!1,12,4+12*l),a.bind(),t.vertexAttribPointer(this.aHeight,1,t.FLOAT,!1,4,4*l),s.bind(),t.vertexAttribPointer(this.aBase,1,t.FLOAT,!1,4,4*l),r.indexBuffer.bind(),o.currentNumAttributes=i,t.drawElements(t.TRIANGLES,3*n.primitiveLength,t.UNSIGNED_SHORT,3*n.primitiveOffset*2)}}}}e.exports=r},{"../../utils/suncalc.js":26}],10:[function(t,e,n){const r=t("./objects.js"),i=t("../utils/utils.js"),o=t("../three.js"),a=t("./Object3D.js");function s(t){t=i._validate(t,r.prototype._defaults.extrusion);let e=s.prototype.buildShape(t.coordinates),n=s.prototype.buildGeometry(e,t.geometryOptions),l=new o.Mesh(n,t.materials);return t.obj=l,new a(t)}s.prototype={buildShape:function(t){if(t[0]instanceof(o.Vector2||o.Vector3))return new o.Shape(t);let e=new o.Shape;for(let n=0;n<t.length;n++)0===n?e=new o.Shape(this.buildPoints(t[0],t[0])):e.holes.push(new o.Path(this.buildPoints(t[n],t[0])));return e},buildPoints:function(t,e){const n=[];let r=i.projectToWorld([e[0][0],e[0][1],0]);for(let a=0;a<t.length;a++){let e=i.projectToWorld([t[a][0],t[a][1],0]);n.push(new o.Vector2(i.toDecimal(e.x-r.x,9),i.toDecimal(e.y-r.y,9)))}return n},buildGeometry:function(t,e){let n=new o.ExtrudeBufferGeometry(t,e);return n.computeBoundingBox(),n}},e.exports=s},{"../three.js":23,"../utils/utils.js":27,"./Object3D.js":7,"./objects.js":19}],11:[function(t,e,n){const r=t("../utils/utils.js"),i=t("./objects.js"),o=t("./CSS2DRenderer.js");function a(t){t=r._validate(t,i.prototype._defaults.label);let e=i.prototype.drawLabelHTML(t.htmlElement,t.cssClass),n=new o.CSS2DObject(e);n.name="label",n.visible=t.alwaysVisible,n.alwaysVisible=t.alwaysVisible;var a=i.prototype._makeGroup(n,t);return i.prototype._addMethods(a),a.visibility=t.alwaysVisible,a}e.exports=a},{"../utils/utils.js":27,"./CSS2DRenderer.js":5,"./objects.js":19}],12:[function(t,e,n){const r=t("../three.js"),i=t("../utils/utils.js"),o=t("./objects.js");function a(t){t=i._validate(t,o.prototype._defaults.line);var e=i.lnglatsToWorld(t.geometry),n=i.normalizeVertices(e),s=i.flattenVectors(n.vertices),l=new r.LineGeometry;l.setPositions(s);let c=new r.LineMaterial({color:t.color,linewidth:t.width,dashed:!1,opacity:t.opacity});return c.resolution.set(window.innerWidth,window.innerHeight),c.isMaterial=!0,c.transparent=!0,c.depthWrite=!1,a=new r.Line2(l,c),a.position.copy(n.position),a.computeLineDistances(),a}e.exports=a,r.LineSegmentsGeometry=function(){r.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry";var t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new r.Float32BufferAttribute(t,3)),this.setAttribute("uv",new r.Float32BufferAttribute(e,2))},r.LineSegmentsGeometry.prototype=Object.assign(Object.create(r.InstancedBufferGeometry.prototype),{constructor:r.LineSegmentsGeometry,isLineSegmentsGeometry:!0,applyMatrix4:function(t){var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new r.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new r.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new r.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new r.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new r.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new r.InterleavedBufferAttribute(n,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new r.WireframeGeometry(t.geometry)),this},fromLineSegments:function(t){var e=t.geometry;if(!e.isGeometry)return e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this;console.error("THREE.LineSegmentsGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},computeBoundingBox:function(){var t=new r.Box3;return function(){null===this.boundingBox&&(this.boundingBox=new r.Box3);var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;void 0!==e&&void 0!==n&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(n),this.boundingBox.union(t))}}(),computeBoundingSphere:function(){var t=new r.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new r.Sphere),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==e&&void 0!==n){var i=this.boundingSphere.center;this.boundingBox.getCenter(i);for(var o=0,a=0,s=e.count;a<s;a++)t.fromBufferAttribute(e,a),o=Math.max(o,i.distanceToSquared(t)),t.fromBufferAttribute(n,a),o=Math.max(o,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},applyMatrix:function(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}}),r.LineGeometry=function(){r.LineSegmentsGeometry.call(this),this.type="LineGeometry"},r.LineGeometry.prototype=Object.assign(Object.create(r.LineSegmentsGeometry.prototype),{constructor:r.LineGeometry,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return r.LineSegmentsGeometry.prototype.setPositions.call(this,n),this},setColors:function(t){for(var e=t.length-3,n=new Float32Array(2*e),i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return r.LineSegmentsGeometry.prototype.setColors.call(this,n),this},fromLine:function(t){var e=t.geometry;if(!e.isGeometry)return e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this;console.error("THREE.LineGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},copy:function(){return this}}),r.WireframeGeometry2=function(t){r.LineSegmentsGeometry.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new r.WireframeGeometry(t))},r.WireframeGeometry2.prototype=Object.assign(Object.create(r.LineSegmentsGeometry.prototype),{constructor:r.WireframeGeometry2,isWireframeGeometry2:!0}),r.UniformsLib.line={linewidth:{value:1},resolution:{value:new r.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1},opacity:{value:1}},r.ShaderLib["line"]={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"},r.LineMaterial=function(t){r.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:r.UniformsUtils.clone(r.ShaderLib["line"].uniforms),vertexShader:r.ShaderLib["line"].vertexShader,fragmentShader:r.ShaderLib["line"].fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)},r.LineMaterial.prototype=Object.create(r.ShaderMaterial.prototype),r.LineMaterial.prototype.constructor=r.LineMaterial,r.LineMaterial.prototype.isLineMaterial=!0,r.LineSegments2=function(t,e){void 0===t&&(t=new r.LineSegmentsGeometry),void 0===e&&(e=new r.LineMaterial({color:16777215*Math.random()})),r.Mesh.call(this,t,e),this.type="LineSegments2"},r.LineSegments2.prototype=Object.assign(Object.create(r.Mesh.prototype),{constructor:r.LineSegments2,isLineSegments2:!0,computeLineDistances:function(){var t=new r.Vector3,e=new r.Vector3;return function(){for(var n=this.geometry,i=n.attributes.instanceStart,o=n.attributes.instanceEnd,a=new Float32Array(2*i.data.count),s=0,l=0,c=i.data.count;s<c;s++,l+=2)t.fromBufferAttribute(i,s),e.fromBufferAttribute(o,s),a[l]=0===l?0:a[l-1],a[l+1]=a[l]+t.distanceTo(e);var u=new r.InstancedInterleavedBuffer(a,2,1);return n.setAttribute("instanceDistanceStart",new r.InterleavedBufferAttribute(u,1,0)),n.setAttribute("instanceDistanceEnd",new r.InterleavedBufferAttribute(u,1,1)),this}}(),raycast:function(){var t=new r.Vector4,e=new r.Vector4,n=new r.Vector4,i=new r.Vector3,o=new r.Matrix4,a=new r.Line3,s=new r.Vector3;return function(l,c){null===l.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var u=void 0!==l.params.Line2&&l.params.Line2.threshold||0,h=l.ray,p=l.camera,d=p.projectionMatrix,f=this.geometry,m=this.material,g=m.resolution,y=m.linewidth+u,v=f.attributes.instanceStart,_=f.attributes.instanceEnd,x=-p.near;h.at(1,n),n.w=1,n.applyMatrix4(p.matrixWorldInverse),n.applyMatrix4(d),n.multiplyScalar(1/n.w),n.x*=g.x/2,n.y*=g.y/2,n.z=0,i.copy(n);var b=this.matrixWorld;o.multiplyMatrices(p.matrixWorldInverse,b);for(var w=0,M=v.count;w<M;w++){t.fromBufferAttribute(v,w),e.fromBufferAttribute(_,w),t.w=1,e.w=1,t.applyMatrix4(o),e.applyMatrix4(o);var E=t.z>x&&e.z>x;if(!E){if(t.z>x){const n=t.z-e.z,r=(t.z-x)/n;t.lerp(e,r)}else if(e.z>x){const n=e.z-t.z,r=(e.z-x)/n;e.lerp(t,r)}t.applyMatrix4(d),e.applyMatrix4(d),t.multiplyScalar(1/t.w),e.multiplyScalar(1/e.w),t.x*=g.x/2,t.y*=g.y/2,e.x*=g.x/2,e.y*=g.y/2,a.start.copy(t),a.start.z=0,a.end.copy(e),a.end.z=0;var S=a.closestPointToPointParameter(i,!0);a.at(S,s);var T=r.MathUtils.lerp(t.z,e.z,S),A=T>=-1&&T<=1,C=i.distanceTo(s)<.5*y;if(A&&C){a.start.fromBufferAttribute(v,w),a.end.fromBufferAttribute(_,w),a.start.applyMatrix4(b),a.end.applyMatrix4(b);var L=new r.Vector3,I=new r.Vector3;h.distanceSqToSegment(a.start,a.end,I,L),c.push({point:I,pointOnLine:L,distance:h.origin.distanceTo(I),object:this,face:null,faceIndex:w,uv:null,uv2:null})}}}}}()}),r.Line2=function(t,e){void 0===t&&(t=new r.LineGeometry),void 0===e&&(e=new r.LineMaterial({color:16777215*Math.random()})),r.LineSegments2.call(this,t,e),this.type="Line2"},r.Line2.prototype=Object.assign(Object.create(r.LineSegments2.prototype),{constructor:r.Line2,isLine2:!0}),r.Wireframe=function(t,e){r.Mesh.call(this),this.type="Wireframe",this.geometry=void 0!==t?t:new r.LineSegmentsGeometry,this.material=void 0!==e?e:new r.LineMaterial({color:16777215*Math.random()})},r.Wireframe.prototype=Object.assign(Object.create(r.Mesh.prototype),{constructor:r.Wireframe,isWireframe:!0,computeLineDistances:function(){var t=new r.Vector3,e=new r.Vector3;return function(){for(var n=this.geometry,i=n.attributes.instanceStart,o=n.attributes.instanceEnd,a=new Float32Array(2*i.data.count),s=0,l=0,c=i.data.count;s<c;s++,l+=2)t.fromBufferAttribute(i,s),e.fromBufferAttribute(o,s),a[l]=0===l?0:a[l-1],a[l+1]=a[l]+t.distanceTo(e);var u=new r.InstancedInterleavedBuffer(a,2,1);return n.setAttribute("instanceDistanceStart",new r.InterleavedBufferAttribute(u,1,0)),n.setAttribute("instanceDistanceEnd",new r.InterleavedBufferAttribute(u,1,1)),this}}()})},{"../three.js":23,"../utils/utils.js":27,"./objects.js":19}],13:[function(t,e,n){const r=t("../utils/utils.js"),i=t("./objects.js"),o=t("./loaders/OBJLoader.js"),a=t("./loaders/MTLLoader.js"),s=t("./loaders/FBXLoader.js"),l=t("./loaders/GLTFLoader.js"),c=t("./loaders/ColladaLoader.js"),u=new o,h=new a,p=new l,d=new s,f=new c;function g(t,e,n){if(void 0===t)return console.error("Invalid options provided to loadObj()");let o;switch(t=r._validate(t,i.prototype._defaults.loadObj),t.type||(t.type="mtl"),t.type){case"mtl":o=u;break;case"gltf":case"glb":o=p;break;case"fbx":o=d;break;case"dae":o=f;break}function a(a){a&&"mtl"==t.type&&(a.preload(),o.setMaterials(a)),o.load(t.obj,o=>{let a=[];switch(t.type){case"mtl":o=o.children[0];break;case"gltf":case"glb":case"dae":a=o.animations,o=o.scene;break;case"fbx":a=o.animations;break}o.animations=a;const l=r.types.rotation(t.rotation,[0,0,0]),c=r.types.scale(t.scale,[1,1,1]);o.rotation.set(l[0],l[1],l[2]),o.scale.set(c[0],c[1],c[2]),t.normalize&&s(o),o.name="model";let u=i.prototype._makeGroup(o,t);i.prototype._addMethods(u),u.setAnchor(t.anchor),u.setCenter(t.adjustment),u.raycasted=t.raycasted,n(u),e(u),u.setFixedZoom(t.mapScale),u.idle()},()=>null,e=>{console.error("Could not load model file: "+t.obj+" \n "+e.stack),n("Error loading the model")})}function s(t){t.traverse((function(t){if(t.isMesh){let e;"MeshStandardMaterial"==t.material.type?(t.material.metalness&&(t.material.metalness*=.1),t.material.glossiness&&(t.material.glossiness*=.25),e=new THREE.Color(12,12,12)):"MeshPhongMaterial"==t.material.type&&(t.material.shininess=.1,e=new THREE.Color(20,20,20)),t.material.specular&&t.material.specular.isColor&&(t.material.specular=e)}}))}h.load(t.mtl,a,()=>null,t=>{console.warn("No material file found for SymbolLayer3D model "+m)})}e.exports=g},{"../utils/utils.js":27,"./loaders/ColladaLoader.js":14,"./loaders/FBXLoader.js":15,"./loaders/GLTFLoader.js":16,"./loaders/MTLLoader.js":17,"./loaders/OBJLoader.js":18,"./objects.js":19}],14:[function(t,e,n){const r=t("../../three.js");r.ColladaLoader=function(t){r.Loader.call(this,t)},r.ColladaLoader.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:r.ColladaLoader,load:function(t,e,n,i){var o=this,a=""===o.path?r.LoaderUtils.extractUrlBase(t):o.path,s=new r.FileLoader(o.manager);s.setPath(o.path),s.load(t,(function(n){try{e(o.parse(n,a))}catch(r){i?i(r):console.error(r),o.manager.itemError(t)}}),n,i)},options:{set convertUpAxis(t){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(t,e){function n(t,e){for(var n=[],r=t.childNodes,i=0,o=r.length;i<o;i++){var a=r[i];a.nodeName===e&&n.push(a)}return n}function i(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=e[r];return n}function o(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=parseFloat(e[r]);return n}function a(t){if(0===t.length)return[];for(var e=t.trim().split(/\s+/),n=new Array(e.length),r=0,i=e.length;r<i;r++)n[r]=parseInt(e[r]);return n}function s(t){return t.substring(1)}function l(){return"three_default_"+Se++}function c(t){return 0===Object.keys(t).length}function u(t){return{unit:h(n(t,"unit")[0]),upAxis:p(n(t,"up_axis")[0])}}function h(t){return void 0!==t&&!0===t.hasAttribute("meter")?parseFloat(t.getAttribute("meter")):1}function p(t){return void 0!==t?t.textContent:"Y_UP"}function d(t,e,r,i){var o=n(t,e)[0];if(void 0!==o)for(var a=n(o,r),s=0;s<a.length;s++)i(a[s])}function f(t,e){for(var n in t){var r=t[n];r.build=e(t[n])}}function m(t,e){return void 0!==t.build||(t.build=e(t)),t.build}function g(t){for(var e={sources:{},samplers:{},channels:{}},n=!1,i=0,o=t.childNodes.length;i<o;i++){var a,s=t.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"source":a=s.getAttribute("id"),e.sources[a]=wt(s);break;case"sampler":a=s.getAttribute("id"),e.samplers[a]=y(s);break;case"channel":a=s.getAttribute("target"),e.channels[a]=v(s);break;case"animation":g(s),n=!0;break;default:console.log(s)}}!1===n&&(Te.animations[t.getAttribute("id")||r.MathUtils.generateUUID()]=e)}function y(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=s(i.getAttribute("source")),a=i.getAttribute("semantic");e.inputs[a]=o;break}}return e}function v(t){var e={},n=t.getAttribute("target"),r=n.split("/"),i=r.shift(),o=r.shift(),a=-1!==o.indexOf("("),l=-1!==o.indexOf(".");if(l)r=o.split("."),o=r.shift(),e.member=r.shift();else if(a){var c=o.split("(");o=c.shift();for(var u=0;u<c.length;u++)c[u]=parseInt(c[u].replace(/\)/,""));e.indices=c}return e.id=i,e.sid=o,e.arraySyntax=a,e.memberSyntax=l,e.sampler=s(t.getAttribute("source")),e}function _(t){var e=[],n=t.channels,r=t.samplers,i=t.sources;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o],s=r[a.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT,u=i[l],h=i[c],p=b(a,u,h);T(p,e)}return e}function x(t){return m(Te.animations[t],_)}function b(t,e,n){var r,i,o,a,s,l,c=Te.nodes[t.id],u=se(c.id),h=c.transforms[t.sid],p=c.matrix.clone().transpose(),d={};switch(h){case"matrix":for(o=0,a=e.array.length;o<a;o++)if(r=e.array[o],i=o*n.stride,void 0===d[r]&&(d[r]={}),!0===t.arraySyntax){var f=n.array[i],m=t.indices[0]+4*t.indices[1];d[r][m]=f}else for(s=0,l=n.stride;s<l;s++)d[r][s]=n.array[i+s];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h);break}var g=w(d,p),y={name:u.uuid,keyframes:g};return y}function w(t,e){var n=[];for(var r in t)n.push({time:parseFloat(r),value:t[r]});n.sort(o);for(var i=0;i<16;i++)A(n,i,e.elements[i]);return n;function o(t,e){return t.time-e.time}}var M=new r.Vector3,E=new r.Vector3,S=new r.Quaternion;function T(t,e){for(var n=t.keyframes,i=t.name,o=[],a=[],s=[],l=[],c=0,u=n.length;c<u;c++){var h=n[c],p=h.time,d=h.value;$t.fromArray(d).transpose(),$t.decompose(M,S,E),o.push(p),a.push(M.x,M.y,M.z),s.push(S.x,S.y,S.z,S.w),l.push(E.x,E.y,E.z)}return a.length>0&&e.push(new r.VectorKeyframeTrack(i+".position",o,a)),s.length>0&&e.push(new r.QuaternionKeyframeTrack(i+".quaternion",o,s)),l.length>0&&e.push(new r.VectorKeyframeTrack(i+".scale",o,l)),e}function A(t,e,n){var r,i,o,a=!0;for(i=0,o=t.length;i<o;i++)r=t[i],void 0===r.value[e]?r.value[e]=null:a=!1;if(!0===a)for(i=0,o=t.length;i<o;i++)r=t[i],r.value[e]=n;else C(t,e)}function C(t,e){for(var n,r,i=0,o=t.length;i<o;i++){var a=t[i];if(null===a.value[e]){if(n=L(t,i,e),r=I(t,i,e),null===n){a.value[e]=r.value[e];continue}if(null===r){a.value[e]=n.value[e];continue}P(a,n,r,e)}}}function L(t,e,n){while(e>=0){var r=t[e];if(null!==r.value[n])return r;e--}return null}function I(t,e,n){while(e<t.length){var r=t[e];if(null!==r.value[n])return r;e++}return null}function P(t,e,n,r){n.time-e.time!==0?t.value[r]=(t.time-e.time)*(n.value[r]-e.value[r])/(n.time-e.time)+e.value[r]:t.value[r]=e.value[r]}function R(t){for(var e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":e.animations.push(s(i.getAttribute("url")));break}}Te.clips[t.getAttribute("id")]=e}function O(t){for(var e=[],n=t.name,i=t.end-t.start||-1,o=t.animations,a=0,s=o.length;a<s;a++)for(var l=x(o[a]),c=0,u=l.length;c<u;c++)e.push(l[c]);return new r.AnimationClip(n,i,e)}function D(t){return m(Te.clips[t],O)}function N(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":e.id=s(i.getAttribute("source")),e.skin=k(i);break;case"morph":e.id=s(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}Te.controllers[t.getAttribute("id")]=e}function k(t){for(var e={sources:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=o(i.textContent);break;case"source":var a=i.getAttribute("id");e.sources[a]=wt(i);break;case"joints":e.joints=F(i);break;case"vertex_weights":e.vertexWeights=z(i);break}}return e}function F(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),a=s(i.getAttribute("source"));e.inputs[o]=a;break}}return e}function z(t){for(var e={inputs:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=i.getAttribute("semantic"),l=s(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));e.inputs[o]={id:l,offset:c};break;case"vcount":e.vcount=a(i.textContent);break;case"v":e.v=a(i.textContent);break}}return e}function B(t){var e={id:t.id},n=Te.geometries[e.id];return void 0!==t.skin&&(e.skin=U(t.skin),n.sources.skinIndices=e.skin.indices,n.sources.skinWeights=e.skin.weights),e}function U(t){var e,n,i,o=4,a={joints:[],indices:{array:[],stride:o},weights:{array:[],stride:o}},s=t.sources,l=t.vertexWeights,c=l.vcount,u=l.v,h=l.inputs.JOINT.offset,p=l.inputs.WEIGHT.offset,d=t.sources[t.joints.inputs.JOINT],f=t.sources[t.joints.inputs.INV_BIND_MATRIX],m=s[l.inputs.WEIGHT.id].array,g=0;for(e=0,i=c.length;e<i;e++){var y=c[e],v=[];for(n=0;n<y;n++){var _=u[g+h],x=u[g+p],b=m[x];v.push({index:_,weight:b}),g+=2}for(v.sort(S),n=0;n<o;n++){var w=v[n];void 0!==w?(a.indices.array.push(w.index),a.weights.array.push(w.weight)):(a.indices.array.push(0),a.weights.array.push(0))}}for(t.bindShapeMatrix?a.bindMatrix=(new r.Matrix4).fromArray(t.bindShapeMatrix).transpose():a.bindMatrix=(new r.Matrix4).identity(),e=0,i=d.array.length;e<i;e++){var M=d.array[e],E=(new r.Matrix4).fromArray(f.array,e*f.stride).transpose();a.joints.push({name:M,boneInverse:E})}return a;function S(t,e){return e.weight-t.weight}}function j(t){return m(Te.controllers[t],B)}function G(t){var e={init_from:n(t,"init_from")[0].textContent};Te.images[t.getAttribute("id")]=e}function V(t){return void 0!==t.build?t.build:t.init_from}function H(t){var e=Te.images[t];return void 0!==e?m(e,V):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function W(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":e.profile=q(i);break}}Te.effects[t.getAttribute("id")]=e}function q(t){for(var e={surfaces:{},samplers:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":X(i,e);break;case"technique":e.technique=$(i);break;case"extra":e.extra=nt(i);break}}return e}function X(t,e){for(var n=t.getAttribute("sid"),r=0,i=t.childNodes.length;r<i;r++){var o=t.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"surface":e.surfaces[n]=Z(o);break;case"sampler2D":e.samplers[n]=Y(o);break}}}function Z(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"init_from":e.init_from=i.textContent;break}}return e}function Y(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"source":e.source=i.textContent;break}}return e}function $(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=i.nodeName,e.parameters=J(i);break}}return e}function J(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[i.nodeName]=K(i);break;case"transparent":e[i.nodeName]={opaque:i.getAttribute("opaque"),data:K(i)};break}}return e}function K(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"color":e[i.nodeName]=o(i.textContent);break;case"float":e[i.nodeName]=parseFloat(i.textContent);break;case"texture":e[i.nodeName]={id:i.getAttribute("texture"),extra:Q(i)};break}}return e}function Q(t){for(var e={technique:{}},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"extra":tt(i,e);break}}return e}function tt(t,e){for(var n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":et(i,e);break}}}function et(t,e){for(var n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?e.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?e.technique[i.nodeName]=0:e.technique[i.nodeName]=parseInt(i.textContent);break}}}function nt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique":e.technique=rt(i);break}}return e}function rt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"double_sided":e[i.nodeName]=parseInt(i.textContent);break}}return e}function it(t){return t}function ot(t){return m(Te.effects[t],it)}function at(t){for(var e={name:t.getAttribute("name")},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":e.url=s(i.getAttribute("url"));break}}Te.materials[t.getAttribute("id")]=e}function st(t){var e,n=t.slice(2+(t.lastIndexOf(".")-1>>>0));switch(n=n.toLowerCase(),n){case"tga":e=xe;break;default:e=we}return e}function lt(t){var e,n=ot(t.url),i=n.profile.technique,o=n.profile.extra;switch(i.type){case"phong":case"blinn":e=new r.MeshPhongMaterial;break;case"lambert":e=new r.MeshLambertMaterial;break;default:e=new r.MeshBasicMaterial;break}function a(t){var e=n.profile.samplers[t.id],i=null;if(void 0!==e){var o=n.profile.surfaces[e.source];i=H(o.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=H(t.id);if(null!==i){var a=st(i);if(void 0!==a){var s=a.load(i),l=t.extra;if(void 0!==l&&void 0!==l.technique&&!1===c(l.technique)){var u=l.technique;s.wrapS=u.wrapU?r.RepeatWrapping:r.ClampToEdgeWrapping,s.wrapT=u.wrapV?r.RepeatWrapping:r.ClampToEdgeWrapping,s.offset.set(u.offsetU||0,u.offsetV||0),s.repeat.set(u.repeatU||1,u.repeatV||1)}else s.wrapS=r.RepeatWrapping,s.wrapT=r.RepeatWrapping;return s}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}e.name=t.name||"";var s=i.parameters;for(var l in s){var u=s[l];switch(l){case"diffuse":u.color&&e.color.fromArray(u.color),u.texture&&(e.map=a(u.texture));break;case"specular":u.color&&e.specular&&e.specular.fromArray(u.color),u.texture&&(e.specularMap=a(u.texture));break;case"bump":u.texture&&(e.normalMap=a(u.texture));break;case"ambient":u.texture&&(e.lightMap=a(u.texture));break;case"shininess":u.float&&e.shininess&&(e.shininess=u.float);break;case"emission":u.color&&e.emissive&&e.emissive.fromArray(u.color),u.texture&&(e.emissiveMap=a(u.texture));break}}var h=s["transparent"],p=s["transparency"];if(void 0===p&&h&&(p={float:1}),void 0===h&&p&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&p)if(h.data.texture)e.transparent=!0;else{var d=h.data.color;switch(h.opaque){case"A_ONE":e.opacity=d[3]*p.float;break;case"RGB_ZERO":e.opacity=1-d[0]*p.float;break;case"A_ZERO":e.opacity=1-d[3]*p.float;break;case"RGB_ONE":e.opacity=d[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}e.opacity<1&&(e.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(e.side=r.DoubleSide),e}function ct(t){return m(Te.materials[t],lt)}function ut(t){for(var e={name:t.getAttribute("name")},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"optics":e.optics=ht(i);break}}Te.cameras[t.getAttribute("id")]=e}function ht(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"technique_common":return pt(n)}}return{}}function pt(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":e.technique=r.nodeName,e.parameters=dt(r);break}}return e}function dt(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[r.nodeName]=parseFloat(r.textContent);break}}return e}function ft(t){var e;switch(t.optics.technique){case"perspective":e=new r.PerspectiveCamera(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var n=t.optics.parameters.ymag,i=t.optics.parameters.xmag,o=t.optics.parameters.aspect_ratio;i=void 0===i?n*o:i,n=void 0===n?i/o:n,i*=.5,n*=.5,e=new r.OrthographicCamera(-i,i,n,-n,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new r.PerspectiveCamera;break}return e.name=t.name||"",e}function mt(t){var e=Te.cameras[t];return void 0!==e?m(e,ft):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function gt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"technique_common":e=yt(i);break}}Te.lights[t.getAttribute("id")]=e}function yt(t){for(var e={},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=i.nodeName,e.parameters=vt(i)}}return e}function vt(t){for(var e={},n=0,i=t.childNodes.length;n<i;n++){var a=t.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"color":var s=o(a.textContent);e.color=(new r.Color).fromArray(s);break;case"falloff_angle":e.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var l=parseFloat(a.textContent);e.distance=l?Math.sqrt(1/l):0;break}}return e}function _t(t){var e;switch(t.technique){case"directional":e=new r.DirectionalLight;break;case"point":e=new r.PointLight;break;case"spot":e=new r.SpotLight;break;case"ambient":e=new r.AmbientLight;break}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function xt(t){var e=Te.lights[t];return void 0!==e?m(e,_t):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function bt(t){var e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(t,"mesh")[0];if(void 0!==r){for(var i=0;i<r.childNodes.length;i++){var o=r.childNodes[i];if(1===o.nodeType){var a=o.getAttribute("id");switch(o.nodeName){case"source":e.sources[a]=wt(o);break;case"vertices":e.vertices=Mt(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(Et(o));break;default:console.log(o)}}}Te.geometries[t.getAttribute("id")]=e}}function wt(t){for(var e={array:[],stride:3},r=0;r<t.childNodes.length;r++){var a=t.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"float_array":e.array=o(a.textContent);break;case"Name_array":e.array=i(a.textContent);break;case"technique_common":var s=n(a,"accessor")[0];void 0!==s&&(e.stride=parseInt(s.getAttribute("stride")));break}}return e}function Mt(t){for(var e={},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];1===r.nodeType&&(e[r.getAttribute("semantic")]=s(r.getAttribute("source")))}return e}function Et(t){for(var e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1},n=0,r=t.childNodes.length;n<r;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var o=s(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),h=u>0?l+u:l;e.inputs[h]={id:o,offset:c},e.stride=Math.max(e.stride,c+1),"TEXCOORD"===l&&(e.hasUV=!0);break;case"vcount":e.vcount=a(i.textContent);break;case"p":e.p=a(i.textContent);break}}return e}function St(t){for(var e={},n=0;n<t.length;n++){var r=t[n];void 0===e[r.type]&&(e[r.type]=[]),e[r.type].push(r)}return e}function Tt(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];!0===i.hasUV&&e++}e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function At(t){var e={},n=t.sources,r=t.vertices,i=t.primitives;if(0===i.length)return{};var o=St(i);for(var a in o){var s=o[a];Tt(s),e[a]=Ct(s,n,r)}return e}function Ct(t,e,n){for(var i={},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:0},u={array:[],stride:4},h={array:[],stride:4},p=new r.BufferGeometry,d=[],f=0,m=0;m<t.length;m++){var g=t[m],y=g.inputs,v=0;switch(g.type){case"lines":case"linestrips":v=2*g.count;break;case"triangles":v=3*g.count;break;case"polylist":for(var _=0;_<g.count;_++){var x=g.vcount[_];switch(x){case 3:v+=3;break;case 4:v+=6;break;default:v+=3*(x-2);break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var b in p.addGroup(f,v,m),f+=v,g.material&&d.push(g.material),y){var w=y[b];switch(b){case"VERTEX":for(var M in n){var E=n[M];switch(M){case"POSITION":var S=o.array.length;if(Lt(g,e[E],w.offset,o.array),o.stride=e[E].stride,e.skinWeights&&e.skinIndices&&(Lt(g,e.skinIndices,w.offset,u.array),Lt(g,e.skinWeights,w.offset,h.array)),!1===g.hasUV&&!0===t.uvsNeedsFix){v=(o.array.length-S)/o.stride;for(var T=0;T<v;T++)s.array.push(0,0)}break;case"NORMAL":Lt(g,e[E],w.offset,a.array),a.stride=e[E].stride;break;case"COLOR":Lt(g,e[E],w.offset,c.array),c.stride=e[E].stride;break;case"TEXCOORD":Lt(g,e[E],w.offset,s.array),s.stride=e[E].stride;break;case"TEXCOORD1":Lt(g,e[E],w.offset,l.array),s.stride=e[E].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',M)}}break;case"NORMAL":Lt(g,e[w.id],w.offset,a.array),a.stride=e[w.id].stride;break;case"COLOR":Lt(g,e[w.id],w.offset,c.array),c.stride=e[w.id].stride;break;case"TEXCOORD":Lt(g,e[w.id],w.offset,s.array),s.stride=e[w.id].stride;break;case"TEXCOORD1":Lt(g,e[w.id],w.offset,l.array),l.stride=e[w.id].stride;break}}}return o.array.length>0&&p.setAttribute("position",new r.Float32BufferAttribute(o.array,o.stride)),a.array.length>0&&p.setAttribute("normal",new r.Float32BufferAttribute(a.array,a.stride)),c.array.length>0&&p.setAttribute("color",new r.Float32BufferAttribute(c.array,c.stride)),s.array.length>0&&p.setAttribute("uv",new r.Float32BufferAttribute(s.array,s.stride)),l.array.length>0&&p.setAttribute("uv2",new r.Float32BufferAttribute(l.array,l.stride)),u.array.length>0&&p.setAttribute("skinIndex",new r.Float32BufferAttribute(u.array,u.stride)),h.array.length>0&&p.setAttribute("skinWeight",new r.Float32BufferAttribute(h.array,h.stride)),i.data=p,i.type=t[0].type,i.materialKeys=d,i}function Lt(t,e,n,r){var i=t.p,o=t.stride,a=t.vcount;function s(t){for(var e=i[t+n]*c,o=e+c;e<o;e++)r.push(l[e])}var l=e.array,c=e.stride;if(void 0!==t.vcount)for(var u=0,h=0,p=a.length;h<p;h++){var d=a[h];if(4===d){var f=u+0*o,m=u+1*o,g=u+2*o,y=u+3*o;s(f),s(m),s(y),s(m),s(g),s(y)}else if(3===d){f=u+0*o,m=u+1*o,g=u+2*o;s(f),s(m),s(g)}else if(d>4)for(var v=1,_=d-2;v<=_;v++){f=u+0*o,m=u+o*v,g=u+o*(v+1);s(f),s(m),s(g)}u+=o*d}else for(h=0,p=i.length;h<p;h+=o)s(h)}function It(t){return m(Te.geometries[t],At)}function Pt(t){for(var e={name:t.getAttribute("name")||"",joints:{},links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":Dt(r,e);break}}Te.kinematicsModels[t.getAttribute("id")]=e}function Rt(t){return void 0!==t.build?t.build:t}function Ot(t){return m(Te.kinematicsModels[t],Rt)}function Dt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":e.joints[r.getAttribute("sid")]=Nt(r);break;case"link":e.links.push(Ft(r));break}}}function Nt(t){for(var e,n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":e=kt(r);break}}return e}function kt(t,e){e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new r.Vector3,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"axis":var a=o(i.textContent);e.axis.fromArray(a);break;case"limits":var s=i.getElementsByTagName("max")[0],l=i.getElementsByTagName("min")[0];e.limits.max=parseFloat(s.textContent),e.limits.min=parseFloat(l.textContent);break}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function Ft(t){for(var e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":e.attachments.push(zt(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(Bt(r));break}}return e}function zt(t){for(var e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":e.links.push(Ft(r));break;case"matrix":case"translate":case"rotate":e.transforms.push(Bt(r));break}}return e}function Bt(t){var e={type:t.nodeName},n=o(t.textContent);switch(e.type){case"matrix":e.obj=new r.Matrix4,e.obj.fromArray(n).transpose();break;case"translate":e.obj=new r.Vector3,e.obj.fromArray(n);break;case"rotate":e.obj=new r.Vector3,e.obj.fromArray(n),e.angle=r.MathUtils.degToRad(n[3]);break}return e}function Ut(t){for(var e={name:t.getAttribute("name")||"",rigidBodies:{}},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"rigid_body":e.rigidBodies[r.getAttribute("name")]={},jt(r,e.rigidBodies[r.getAttribute("name")]);break}}Te.physicsModels[t.getAttribute("id")]=e}function jt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"technique_common":Gt(r,e);break}}}function Gt(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":e.inertia=o(r.textContent);break;case"mass":e.mass=o(r.textContent)[0];break}}}function Vt(t){for(var e={bindJointAxis:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":e.bindJointAxis.push(Ht(r));break}}Te.kinematicsScenes[s(t.getAttribute("url"))]=e}function Ht(t){for(var e={target:t.getAttribute("target").split("/").pop()},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var i=r.getElementsByTagName("param")[0];e.axis=i.textContent;var o=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=o.substr(0,o.length-1);break}}return e}function Wt(t){return void 0!==t.build?t.build:t}function qt(t){return m(Te.kinematicsScenes[t],Wt)}function Xt(){var t=Object.keys(Te.kinematicsModels)[0],e=Object.keys(Te.kinematicsScenes)[0],n=Object.keys(Te.visualScenes)[0];if(void 0!==t&&void 0!==e){for(var i=Ot(t),o=qt(e),a=he(n),s=o.bindJointAxis,l={},c=0,u=s.length;c<u;c++){var h=s[c],p=ge.querySelector('[sid="'+h.target+'"]');if(p){var d=p.parentElement;m(h.jointIndex,d)}}var f=new r.Matrix4;Ee={joints:i&&i.joints,getJointValue:function(t){var e=l[t];if(e)return e.position;console.warn("THREE.ColladaLoader: Joint "+t+" doesn't exist.")},setJointValue:function(t,e){var n=l[t];if(n){var i=n.joint;if(e>i.limits.max||e<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+e+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{var o=n.object,a=i.axis,s=n.transforms;$t.identity();for(var c=0;c<s.length;c++){var u=s[c];if(u.sid&&-1!==u.sid.indexOf(t))switch(i.type){case"revolute":$t.multiply(f.makeRotationAxis(a,r.MathUtils.degToRad(e)));break;case"prismatic":$t.multiply(f.makeTranslation(a.x*e,a.y*e,a.z*e));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type);break}else switch(u.type){case"matrix":$t.multiply(u.obj);break;case"translate":$t.multiply(f.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":$t.scale(u.obj);break;case"rotate":$t.multiply(f.makeRotationAxis(u.obj,u.angle));break}}o.matrix.copy($t),o.matrix.decompose(o.position,o.quaternion,o.scale),l[t].position=e}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}function m(t,e){var n=e.getAttribute("name"),r=i.joints[t];a.traverse((function(i){i.name===n&&(l[t]={object:i,transforms:Zt(e),joint:r,position:r.zeroPosition})}))}}function Zt(t){for(var e=[],n=ge.querySelector('[id="'+t.id+'"]'),i=0;i<n.childNodes.length;i++){var a=n.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"matrix":var s=o(a.textContent),l=(new r.Matrix4).fromArray(s).transpose();e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"translate":case"scale":s=o(a.textContent);var c=(new r.Vector3).fromArray(s);e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:c});break;case"rotate":s=o(a.textContent),c=(new r.Vector3).fromArray(s);var u=r.MathUtils.degToRad(s[3]);e.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:c,angle:u});break}}return e}function Yt(t){for(var e=t.getElementsByTagName("node"),n=0;n<e.length;n++){var r=e[n];!1===r.hasAttribute("id")&&r.setAttribute("id",l())}}var $t=new r.Matrix4,Jt=new r.Vector3;function Kt(t){for(var e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new r.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"node":e.nodes.push(i.getAttribute("id")),Kt(i);break;case"instance_camera":e.instanceCameras.push(s(i.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(Qt(i));break;case"instance_light":e.instanceLights.push(s(i.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(Qt(i));break;case"instance_node":e.instanceNodes.push(s(i.getAttribute("url")));break;case"matrix":var a=o(i.textContent);e.matrix.multiply($t.fromArray(a).transpose()),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"translate":a=o(i.textContent);Jt.fromArray(a),e.matrix.multiply($t.makeTranslation(Jt.x,Jt.y,Jt.z)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"rotate":a=o(i.textContent);var l=r.MathUtils.degToRad(a[3]);e.matrix.multiply($t.makeRotationAxis(Jt.fromArray(a),l)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"scale":a=o(i.textContent);e.matrix.scale(Jt.fromArray(a)),e.transforms[i.getAttribute("sid")]=i.nodeName;break;case"extra":break;default:console.log(i)}}return ae(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):Te.nodes[e.id]=e,e}function Qt(t){for(var e={id:s(t.getAttribute("url")),materials:{},skeletons:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];switch(r.nodeName){case"bind_material":for(var i=r.getElementsByTagName("instance_material"),o=0;o<i.length;o++){var a=i[o],l=a.getAttribute("symbol"),c=a.getAttribute("target");e.materials[l]=s(c)}break;case"skeleton":e.skeletons.push(s(r.textContent));break;default:break}}return e}function te(t,e){var n,i,o=[],a=[];for(n=0;n<t.length;n++){var s=t[n];if(ae(s))p=se(s),ee(p,e,o);else if(ue(s))for(var l=Te.visualScenes[s],c=l.children,u=0;u<c.length;u++){var h=c[u];if("JOINT"===h.type){var p=se(h.id);ee(p,e,o)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(n=0;n<e.length;n++)for(u=0;u<o.length;u++)if(i=o[u],i.bone.name===e[n].name){a[n]=i,i.processed=!0;break}for(n=0;n<o.length;n++)i=o[n],!1===i.processed&&(a.push(i),i.processed=!0);var d=[],f=[];for(n=0;n<a.length;n++)i=a[n],d.push(i.bone),f.push(i.boneInverse);return new r.Skeleton(d,f)}function ee(t,e,n){t.traverse((function(t){if(!0===t.isBone){for(var i,o=0;o<e.length;o++){var a=e[o];if(a.name===t.name){i=a.boneInverse;break}}void 0===i&&(i=new r.Matrix4),n.push({bone:t,boneInverse:i,processed:!1})}}))}function ne(t){for(var e=[],n=t.matrix,i=t.nodes,o=t.type,a=t.instanceCameras,s=t.instanceControllers,l=t.instanceLights,c=t.instanceGeometries,u=t.instanceNodes,h=0,p=i.length;h<p;h++)e.push(se(i[h]));for(h=0,p=a.length;h<p;h++){var d=mt(a[h]);null!==d&&e.push(d.clone())}for(h=0,p=s.length;h<p;h++)for(var f=s[h],m=j(f.id),g=It(m.id),y=oe(g,f.materials),v=f.skeletons,_=m.skin.joints,x=te(v,_),b=0,w=y.length;b<w;b++){var M=y[b];M.isSkinnedMesh&&(M.bind(x,m.skin.bindMatrix),M.normalizeSkinWeights()),e.push(M)}for(h=0,p=l.length;h<p;h++){var E=xt(l[h]);null!==E&&e.push(E.clone())}for(h=0,p=c.length;h<p;h++)for(f=c[h],g=It(f.id),y=oe(g,f.materials),b=0,w=y.length;b<w;b++)e.push(y[b]);for(h=0,p=u.length;h<p;h++)e.push(se(u[h]).clone());if(0===i.length&&1===e.length)M=e[0];else{M="JOINT"===o?new r.Bone:new r.Group;for(h=0;h<e.length;h++)M.add(e[h])}return M.name="JOINT"===o?t.sid:t.name,M.matrix.copy(n),M.matrix.decompose(M.position,M.quaternion,M.scale),M}var re=new r.MeshBasicMaterial({color:16711935});function ie(t,e){for(var n=[],r=0,i=t.length;r<i;r++){var o=e[t[r]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[r]),n.push(re)):n.push(ct(o))}return n}function oe(t,e){var n=[];for(var i in t){var o=t[i],a=ie(o.materialKeys,e);0===a.length&&("lines"===i||"linestrips"===i?a.push(new r.LineBasicMaterial):a.push(new r.MeshPhongMaterial));var s=void 0!==o.data.attributes.skinIndex;if(s)for(var l=0,c=a.length;l<c;l++)a[l].skinning=!0;var u,h=1===a.length?a[0]:a;switch(i){case"lines":u=new r.LineSegments(o.data,h);break;case"linestrips":u=new r.Line(o.data,h);break;case"triangles":case"polylist":u=s?new r.SkinnedMesh(o.data,h):new r.Mesh(o.data,h);break}n.push(u)}return n}function ae(t){return void 0!==Te.nodes[t]}function se(t){return m(Te.nodes[t],ne)}function le(t){var e={name:t.getAttribute("name"),children:[]};Yt(t);for(var r=n(t,"node"),i=0;i<r.length;i++)e.children.push(Kt(r[i]));Te.visualScenes[t.getAttribute("id")]=e}function ce(t){var e=new r.Group;e.name=t.name;for(var n=t.children,i=0;i<n.length;i++){var o=n[i];e.add(se(o.id))}return e}function ue(t){return void 0!==Te.visualScenes[t]}function he(t){return m(Te.visualScenes[t],ce)}function pe(t){var e=n(t,"instance_visual_scene")[0];return he(s(e.getAttribute("url")))}function de(){var t=Te.clips;if(!0===c(t)){if(!1===c(Te.animations)){var e=[];for(var n in Te.animations)for(var i=x(n),o=0,a=i.length;o<a;o++)e.push(i[o]);Me.push(new r.AnimationClip("default",-1,e))}}else for(var n in t)Me.push(D(n))}function fe(t){var e="",n=[t];while(n.length){var r=n.shift();r.nodeType===Node.TEXT_NODE?e+=r.textContent:(e+="\n",n.push.apply(n,r.childNodes))}return e.trim()}if(0===t.length)return{scene:new r.Scene};var me=(new DOMParser).parseFromString(t,"application/xml"),ge=n(me,"COLLADA")[0],ye=me.getElementsByTagName("parsererror")[0];if(void 0!==ye){var ve,_e=n(ye,"div")[0];return ve=_e?_e.textContent:fe(ye),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",ve),null}ge.getAttribute("version");var xe,be=u(n(ge,"asset")[0]),we=new r.TextureLoader(this.manager);we.setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin),r.TGALoader&&(xe=new r.TGALoader(this.manager),xe.setPath(this.resourcePath||e));var Me=[],Ee={},Se=0,Te={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};d(ge,"library_animations","animation",g),d(ge,"library_animation_clips","animation_clip",R),d(ge,"library_controllers","controller",N),d(ge,"library_images","image",G),d(ge,"library_effects","effect",W),d(ge,"library_materials","material",at),d(ge,"library_cameras","camera",ut),d(ge,"library_lights","light",gt),d(ge,"library_geometries","geometry",bt),d(ge,"library_nodes","node",Kt),d(ge,"library_visual_scenes","visual_scene",le),d(ge,"library_kinematics_models","kinematics_model",Pt),d(ge,"library_physics_models","physics_model",Ut),d(ge,"scene","instance_kinematics_scene",Vt),f(Te.animations,_),f(Te.clips,O),f(Te.controllers,B),f(Te.images,V),f(Te.effects,it),f(Te.materials,lt),f(Te.cameras,ft),f(Te.lights,_t),f(Te.geometries,At),f(Te.visualScenes,ce),de(),Xt();var Ae=pe(n(ge,"scene")[0]);return"Z_UP"===be.upAxis&&Ae.quaternion.setFromEuler(new r.Euler(-Math.PI/2,0,0)),Ae.scale.multiplyScalar(be.unit),{animations:Me,kinematics:Ee,library:Te,scene:Ae}}}),e.exports=r.ColladaLoader},{"../../three.js":23}],15:[function(t,e,n){const r=t("../../three.js"),i=t("../Zlib.Inflate.js");r.FBXLoader=function(){var t,e,n;function o(t){r.Loader.call(this,t)}function a(t,e){this.textureLoader=t,this.manager=e}function s(){}function l(){}function c(){}function u(){}function h(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function p(){}function d(t){var e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===E(t,0,e.length)}function f(t){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function r(e){var r=t[e-1];return t=t.slice(n+e),n++,r}for(var i=0;i<e.length;++i){var o=r(1);if(o===e[i])return!1}return!0}function m(t){var e=/FBXVersion: (\d+)/,n=t.match(e);if(n){var r=parseInt(n[1]);return r}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function g(t){return t/46186158e3}o.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:o,load:function(t,e,n,i){var o=this,a=""===o.path?r.LoaderUtils.extractUrlBase(t):o.path,s=new r.FileLoader(this.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.load(t,(function(n){try{e(o.parse(n,a))}catch(r){i?i(r):console.error(r),o.manager.itemError(t)}}),n,i)},parse:function(e,n){if(d(e))t=(new u).parse(e);else{var i=E(e);if(!f(i))throw new Error("THREE.FBXLoader: Unknown format.");if(m(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+m(i));t=(new c).parse(i)}var o=new r.TextureLoader(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new a(o,this.manager).parse(t)}}),a.prototype={constructor:a,parse:function(){e=this.parseConnections();var t=this.parseImages(),r=this.parseTextures(t),i=this.parseMaterials(r),o=this.parseDeformers(),a=(new s).parse(o);return this.parseScene(o,a,i),n},parseConnections:function(){var e=new Map;if("Connections"in t){var n=t.Connections.connections;n.forEach((function(t){var n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};e.get(n).parents.push(o),e.has(r)||e.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};e.get(r).children.push(a)}))}return e},parseImages:function(){var e={},n={};if("Video"in t.Objects){var r=t.Objects.Video;for(var i in r){var o=r[i],a=parseInt(i);if(e[a]=o.RelativeFilename||o.Filename,"Content"in o){var s=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,l="string"===typeof o.Content&&""!==o.Content;if(s||l){var c=this.parseImage(r[i]);n[o.RelativeFilename||o.Filename]=c}}}}for(var a in e){var u=e[a];void 0!==n[u]?e[a]=n[u]:e[a]=e[a].split("\\").pop()}return e},parseImage:function(t){var e,n=t.Content,r=t.RelativeFilename||t.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),e="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"===typeof n)return"data:"+e+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:e}))},parseTextures:function(e){var n=new Map;if("Texture"in t.Objects){var r=t.Objects.Texture;for(var i in r){var o=this.parseTexture(r[i],e);n.set(parseInt(i),o)}}return n},parseTexture:function(t,e){var n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;var i=t.WrapModeU,o=t.WrapModeV,a=void 0!==i?i.value:0,s=void 0!==o?o.value:0;if(n.wrapS=0===a?r.RepeatWrapping:r.ClampToEdgeWrapping,n.wrapT=0===s?r.RepeatWrapping:r.ClampToEdgeWrapping,"Scaling"in t){var l=t.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}return n},loadTexture:function(t,n){var i,o,a=this.textureLoader.path,s=e.get(t.id).children;void 0!==s&&s.length>0&&void 0!==n[s[0].ID]&&(i=n[s[0].ID],0!==i.indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));var l=t.FileName.slice(-3).toLowerCase();if("tga"===l){var c=this.manager.getHandler(".tga");null===c?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new r.Texture):o=c.load(i)}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new r.Texture):o=this.textureLoader.load(i);return this.textureLoader.setPath(a),o},parseMaterials:function(e){var n=new Map;if("Material"in t.Objects){var r=t.Objects.Material;for(var i in r){var o=this.parseMaterial(r[i],e);null!==o&&n.set(parseInt(i),o)}}return n},parseMaterial:function(t,n){var i=t.id,o=t.attrName,a=t.ShadingModel;if("object"===typeof a&&(a=a.value),!e.has(i))return null;var s,l=this.parseParameters(t,n,i);switch(a.toLowerCase()){case"phong":s=new r.MeshPhongMaterial;break;case"lambert":s=new r.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),s=new r.MeshPhongMaterial;break}return s.setValues(l),s.name=o,s},parseParameters:function(t,n,i){var o={};t.BumpFactor&&(o.bumpScale=t.BumpFactor.value),t.Diffuse?o.color=(new r.Color).fromArray(t.Diffuse.value):t.DiffuseColor&&"Color"===t.DiffuseColor.type&&(o.color=(new r.Color).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(o.displacementScale=t.DisplacementFactor.value),t.Emissive?o.emissive=(new r.Color).fromArray(t.Emissive.value):t.EmissiveColor&&"Color"===t.EmissiveColor.type&&(o.emissive=(new r.Color).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(o.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(o.opacity=parseFloat(t.Opacity.value)),o.opacity<1&&(o.transparent=!0),t.ReflectionFactor&&(o.reflectivity=t.ReflectionFactor.value),t.Shininess&&(o.shininess=t.Shininess.value),t.Specular?o.specular=(new r.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(o.specular=(new r.Color).fromArray(t.SpecularColor.value));var a=this;return e.get(i).children.forEach((function(t){var e=t.relationship;switch(e){case"Bump":o.bumpMap=a.getTexture(n,t.ID);break;case"Maya|TEX_ao_map":o.aoMap=a.getTexture(n,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=a.getTexture(n,t.ID),o.map.encoding=r.sRGBEncoding;break;case"DisplacementColor":o.displacementMap=a.getTexture(n,t.ID);break;case"EmissiveColor":o.emissiveMap=a.getTexture(n,t.ID),o.emissiveMap.encoding=r.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=a.getTexture(n,t.ID);break;case"ReflectionColor":o.envMap=a.getTexture(n,t.ID),o.envMap.mapping=r.EquirectangularReflectionMapping,o.envMap.encoding=r.sRGBEncoding;break;case"SpecularColor":o.specularMap=a.getTexture(n,t.ID),o.specularMap.encoding=r.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=a.getTexture(n,t.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",e);break}})),o},getTexture:function(n,r){return"LayeredTexture"in t.Objects&&r in t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=e.get(r).children[0].ID),n.get(r)},parseDeformers:function(){var n={},r={};if("Deformer"in t.Objects){var i=t.Objects.Deformer;for(var o in i){var a=i[o],s=e.get(parseInt(o));if("Skin"===a.attrType){var l=this.parseSkeleton(s,i);l.ID=o,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,n[o]=l}else if("BlendShape"===a.attrType){var c={id:o};c.rawTargets=this.parseMorphTargets(s,i),c.id=o,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[o]=c}}}return{skeletons:n,morphTargets:r}},parseSkeleton:function(t,e){var n=[];return t.children.forEach((function(t){var i=e[t.ID];if("Cluster"===i.attrType){var o={ID:t.ID,indices:[],weights:[],transformLink:(new r.Matrix4).fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),n.push(o)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(t,n){for(var r=[],i=0;i<t.children.length;i++){var o=t.children[i],a=n[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=e.get(parseInt(o.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,r.push(s)}return r},parseScene:function(i,o,a){n=new r.Group;var s=this.parseModels(i.skeletons,o,a),c=t.Objects.Model,u=this;s.forEach((function(t){var r=c[t.ID];u.setLookAtProperties(t,r);var i=e.get(t.ID).parents;i.forEach((function(e){var n=s.get(e.ID);void 0!==n&&n.add(t)})),null===t.parent&&n.add(t)})),this.bindSkeleton(i.skeletons,o,s),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrixWorld=t.parent.matrix);var e=b(t.userData.transformData);t.applyMatrix4(e)}}));var h=(new l).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=h,n=n.children[0]),n.animations=h},parseModels:function(n,i,o){var a=new Map,s=t.Objects.Model;for(var l in s){var c=parseInt(l),u=s[l],h=e.get(c),p=this.buildSkeleton(h,n,c,u.attrName);if(!p){switch(u.attrType){case"Camera":p=this.createCamera(h);break;case"Light":p=this.createLight(h);break;case"Mesh":p=this.createMesh(h,i,o);break;case"NurbsCurve":p=this.createCurve(h,i);break;case"LimbNode":case"Root":p=new r.Bone;break;case"Null":default:p=new r.Group;break}p.name=u.attrName?r.PropertyBinding.sanitizeNodeName(u.attrName):"",p.ID=c}this.getTransformData(p,u),a.set(c,p)}return a},buildSkeleton:function(t,e,n,i){var o=null;return t.parents.forEach((function(t){for(var a in e){var s=e[a];s.rawBones.forEach((function(e,a){if(e.ID===t.ID){var l=o;o=new r.Bone,o.matrixWorld.copy(e.transformLink),o.name=i?r.PropertyBinding.sanitizeNodeName(i):"",o.ID=n,s.bones[a]=o,null!==l&&o.add(l)}}))}})),o},createCamera:function(e){var n,i;if(e.children.forEach((function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(i=n)})),void 0===i)n=new r.Object3D;else{var o=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(o=1);var a=1;void 0!==i.NearPlane&&(a=i.NearPlane.value/1e3);var s=1e3;void 0!==i.FarPlane&&(s=i.FarPlane.value/1e3);var l=window.innerWidth,c=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(l=i.AspectWidth.value,c=i.AspectHeight.value);var u=l/c,h=45;void 0!==i.FieldOfView&&(h=i.FieldOfView.value);var p=i.FocalLength?i.FocalLength.value:null;switch(o){case 0:n=new r.PerspectiveCamera(h,u,a,s),null!==p&&n.setFocalLength(p);break;case 1:n=new r.OrthographicCamera(-l/2,l/2,c/2,-c/2,a,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+o+"."),n=new r.Object3D;break}}return n},createLight:function(e){var n,i;if(e.children.forEach((function(e){var n=t.Objects.NodeAttribute[e.ID];void 0!==n&&(i=n)})),void 0===i)n=new r.Object3D;else{var o;o=void 0===i.LightType?0:i.LightType.value;var a=16777215;void 0!==i.Color&&(a=(new r.Color).fromArray(i.Color.value));var s=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(s=0);var l=0;void 0!==i.FarAttenuationEnd&&(l=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);var c=1;switch(o){case 0:n=new r.PointLight(a,s,l,c);break;case 1:n=new r.DirectionalLight(a,s);break;case 2:var u=Math.PI/3;void 0!==i.InnerAngle&&(u=r.MathUtils.degToRad(i.InnerAngle.value));var h=0;void 0!==i.OuterAngle&&(h=r.MathUtils.degToRad(i.OuterAngle.value),h=Math.max(h,1)),n=new r.SpotLight(a,s,l,u,h,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a THREE.PointLight."),n=new r.PointLight(a,s);break}void 0!==i.CastShadows&&1===i.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(t,e,n){var i,o=null,a=null,s=[];return t.children.forEach((function(t){e.has(t.ID)&&(o=e.get(t.ID)),n.has(t.ID)&&s.push(n.get(t.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new r.MeshPhongMaterial({color:13421772}),s.push(a)),"color"in o.attributes&&s.forEach((function(t){t.vertexColors=!0})),o.FBX_Deformer?(s.forEach((function(t){t.skinning=!0})),i=new r.SkinnedMesh(o,a),i.normalizeSkinWeights()):i=new r.Mesh(o,a),i},createCurve:function(t,e){var n=t.children.reduce((function(t,n){return e.has(n.ID)&&(t=e.get(n.ID)),t}),null),i=new r.LineBasicMaterial({color:3342591,linewidth:1});return new r.Line(n,i)},getTransformData:function(t,e){var n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),n.eulerOrder="RotationOrder"in e?w(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n},setLookAtProperties:function(i,o){if("LookAtProperty"in o){var a=e.get(i.ID).children;a.forEach((function(e){if("LookAtProperty"===e.relationship){var o=t.Objects.Model[e.ID];if("Lcl_Translation"in o){var a=o.Lcl_Translation.value;void 0!==i.target?(i.target.position.fromArray(a),n.add(i.target)):i.lookAt((new r.Vector3).fromArray(a))}}}))}},bindSkeleton:function(t,n,i){var o=this.parsePoseNodes();for(var a in t){var s=t[a],l=e.get(parseInt(s.ID)).parents;l.forEach((function(t){if(n.has(t.ID)){var a=t.ID,l=e.get(a);l.parents.forEach((function(t){if(i.has(t.ID)){var e=i.get(t.ID);e.bind(new r.Skeleton(s.bones),o[t.ID])}}))}}))}},parsePoseNodes:function(){var e={};if("Pose"in t.Objects){var n=t.Objects.Pose;for(var i in n)if("BindPose"===n[i].attrType){var o=n[i].PoseNode;Array.isArray(o)?o.forEach((function(t){e[t.Node]=(new r.Matrix4).fromArray(t.Matrix.a)})):e[o.Node]=(new r.Matrix4).fromArray(o.Matrix.a)}}return e},createAmbientLight:function(){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var e=t.GlobalSettings.AmbientColor.value,i=e[0],o=e[1],a=e[2];if(0!==i||0!==o||0!==a){var s=new r.Color(i,o,a);n.add(new r.AmbientLight(s,1))}}},setupMorphMaterials:function(){var t=this;n.traverse((function(e){e.isMesh&&e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length&&(Array.isArray(e.material)?e.material.forEach((function(n,r){t.setupMorphMaterial(e,n,r)})):t.setupMorphMaterial(e,e.material))}))},setupMorphMaterial:function(t,e,r){var i=t.uuid,o=e.uuid,a=!1;if(n.traverse((function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach((function(e){e.uuid===o&&t.uuid!==i&&(a=!0)})):t.material.uuid===o&&t.uuid!==i&&(a=!0))})),!0===a){var s=e.clone();s.morphTargets=!0,void 0===r?t.material=s:t.material[r]=s}else e.morphTargets=!0}},s.prototype={constructor:s,parse:function(n){var r=new Map;if("Geometry"in t.Objects){var i=t.Objects.Geometry;for(var o in i){var a=e.get(parseInt(o)),s=this.parseGeometry(a,i[o],n);r.set(parseInt(o),s)}}return r},parseGeometry:function(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}},parseMeshGeometry:function(e,n,r){var i=r.skeletons,o=[],a=e.parents.map((function(e){return t.Objects.Model[e.ID]}));if(0!==a.length){var s=e.children.reduce((function(t,e){return void 0!==i[e.ID]&&(t=i[e.ID]),t}),null);e.children.forEach((function(t){void 0!==r.morphTargets[t.ID]&&o.push(r.morphTargets[t.ID])}));var l=a[0],c={};"RotationOrder"in l&&(c.eulerOrder=w(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);var u=b(c);return this.genGeometry(n,s,o,u)}},genGeometry:function(t,e,n,i){var o=new r.BufferGeometry;t.attrName&&(o.name=t.attrName);var a=this.parseGeoNode(t,e),s=this.genBuffers(a),l=new r.Float32BufferAttribute(s.vertex,3);if(l.applyMatrix4(i),o.setAttribute("position",l),s.colors.length>0&&o.setAttribute("color",new r.Float32BufferAttribute(s.colors,3)),e&&(o.setAttribute("skinIndex",new r.Uint16BufferAttribute(s.weightsIndices,4)),o.setAttribute("skinWeight",new r.Float32BufferAttribute(s.vertexWeights,4)),o.FBX_Deformer=e),s.normal.length>0){var c=(new r.Matrix3).getNormalMatrix(i),u=new r.Float32BufferAttribute(s.normal,3);u.applyNormalMatrix(c),o.setAttribute("normal",u)}if(s.uvs.forEach((function(t,e){var n="uv"+(e+1).toString();0===e&&(n="uv"),o.setAttribute(n,new r.Float32BufferAttribute(s.uvs[e],2))})),a.material&&"AllSame"!==a.material.mappingType){var h=s.materialIndex[0],p=0;if(s.materialIndex.forEach((function(t,e){t!==h&&(o.addGroup(p,e-p,h),h=t,p=e)})),o.groups.length>0){var d=o.groups[o.groups.length-1],f=d.start+d.count;f!==s.materialIndex.length&&o.addGroup(f,s.materialIndex.length-f,h)}0===o.groups.length&&o.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(o,t,n,i),o},parseGeoNode:function(t,e){var n={};if(n.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],n.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];var r=0;while(t.LayerElementUV[r])n.uv.push(this.parseUVs(t.LayerElementUV[r])),r++}return n.weightTable={},null!==e&&(n.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:e,weight:t.weights[i]})}))}))),n},genBuffers:function(t){var e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,o=[],a=[],s=[],l=[],c=[],u=[],h=this;return t.vertexIndices.forEach((function(p,d){var f=!1;p<0&&(p^=-1,f=!0);var m=[],g=[];if(o.push(3*p,3*p+1,3*p+2),t.color){var y=v(d,n,p,t.color);s.push(y[0],y[1],y[2])}if(t.skeleton){if(void 0!==t.weightTable[p]&&t.weightTable[p].forEach((function(t){g.push(t.weight),m.push(t.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var _=[0,0,0,0],x=[0,0,0,0];g.forEach((function(t,e){var n=t,r=m[e];x.forEach((function(t,e,i){if(n>t){i[e]=n,n=t;var o=_[e];_[e]=r,r=o}}))})),m=_,g=x}while(g.length<4)g.push(0),m.push(0);for(var b=0;b<4;++b)c.push(g[b]),u.push(m[b])}if(t.normal){y=v(d,n,p,t.normal);a.push(y[0],y[1],y[2])}if(t.material&&"AllSame"!==t.material.mappingType)var w=v(d,n,p,t.material)[0];t.uv&&t.uv.forEach((function(t,e){var r=v(d,n,p,t);void 0===l[e]&&(l[e]=[]),l[e].push(r[0]),l[e].push(r[1])})),r++,f&&(h.genFace(e,t,o,w,a,s,l,c,u,r),n++,r=0,o=[],a=[],s=[],l=[],c=[],u=[])})),e},genFace:function(t,e,n,r,i,o,a,s,l,c){for(var u=2;u<c;u++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[3*(u-1)]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+1]]),t.vertex.push(e.vertexPositions[n[3*(u-1)+2]]),t.vertex.push(e.vertexPositions[n[3*u]]),t.vertex.push(e.vertexPositions[n[3*u+1]]),t.vertex.push(e.vertexPositions[n[3*u+2]]),e.skeleton&&(t.vertexWeights.push(s[0]),t.vertexWeights.push(s[1]),t.vertexWeights.push(s[2]),t.vertexWeights.push(s[3]),t.vertexWeights.push(s[4*(u-1)]),t.vertexWeights.push(s[4*(u-1)+1]),t.vertexWeights.push(s[4*(u-1)+2]),t.vertexWeights.push(s[4*(u-1)+3]),t.vertexWeights.push(s[4*u]),t.vertexWeights.push(s[4*u+1]),t.vertexWeights.push(s[4*u+2]),t.vertexWeights.push(s[4*u+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(u-1)]),t.weightsIndices.push(l[4*(u-1)+1]),t.weightsIndices.push(l[4*(u-1)+2]),t.weightsIndices.push(l[4*(u-1)+3]),t.weightsIndices.push(l[4*u]),t.weightsIndices.push(l[4*u+1]),t.weightsIndices.push(l[4*u+2]),t.weightsIndices.push(l[4*u+3])),e.color&&(t.colors.push(o[0]),t.colors.push(o[1]),t.colors.push(o[2]),t.colors.push(o[3*(u-1)]),t.colors.push(o[3*(u-1)+1]),t.colors.push(o[3*(u-1)+2]),t.colors.push(o[3*u]),t.colors.push(o[3*u+1]),t.colors.push(o[3*u+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(r),t.materialIndex.push(r),t.materialIndex.push(r)),e.normal&&(t.normal.push(i[0]),t.normal.push(i[1]),t.normal.push(i[2]),t.normal.push(i[3*(u-1)]),t.normal.push(i[3*(u-1)+1]),t.normal.push(i[3*(u-1)+2]),t.normal.push(i[3*u]),t.normal.push(i[3*u+1]),t.normal.push(i[3*u+2])),e.uv&&e.uv.forEach((function(e,n){void 0===t.uvs[n]&&(t.uvs[n]=[]),t.uvs[n].push(a[n][0]),t.uvs[n].push(a[n][1]),t.uvs[n].push(a[n][2*(u-1)]),t.uvs[n].push(a[n][2*(u-1)+1]),t.uvs[n].push(a[n][2*u]),t.uvs[n].push(a[n][2*u+1])}))},addMorphTargets:function(e,n,r,i){if(0!==r.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var o=this;r.forEach((function(r){r.rawTargets.forEach((function(r){var a=t.Objects.Geometry[r.geoID];void 0!==a&&o.genMorphGeometry(e,n,a,i,r.name)}))}))}},genMorphGeometry:function(t,e,n,i,o){for(var a=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],s=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],c=3*t.attributes.position.count,u=new Float32Array(c),h=0;h<l.length;h++){var p=3*l[h];u[p]=s[3*h],u[p+1]=s[3*h+1],u[p+2]=s[3*h+2]}var d={vertexIndices:a,vertexPositions:u},f=this.genBuffers(d),m=new r.Float32BufferAttribute(f.vertex,3);m.name=o||n.attrName,m.applyMatrix4(i),t.morphAttributes.position.push(m)},parseNormals:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in t?i=t.NormalIndex.a:"NormalsIndex"in t&&(i=t.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:e,referenceType:n}},parseUVs:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.UV.a,i=[];return"IndexToDirect"===n&&(i=t.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:e,referenceType:n}},parseVertexColors:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType,r=t.Colors.a,i=[];return"IndexToDirect"===n&&(i=t.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:e,referenceType:n}},parseMaterialIndices:function(t){var e=t.MappingInformationType,n=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=t.Materials.a,i=[],o=0;o<r.length;++o)i.push(o);return{dataSize:1,buffer:r,indices:i,mappingType:e,referenceType:n}},parseNurbsGeometry:function(t){if(void 0===r.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new r.BufferGeometry;var e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new r.BufferGeometry;for(var n,i,o=e-1,a=t.KnotVector.a,s=[],l=t.Points.a,c=0,u=l.length;c<u;c+=4)s.push((new r.Vector4).fromArray(l,c));if("Closed"===t.Form)s.push(s[0]);else if("Periodic"===t.Form){n=o,i=a.length-1-n;for(c=0;c<o;++c)s.push(s[c])}var h=new r.NURBSCurve(o,a,s,n,i),p=h.getPoints(7*s.length),d=new Float32Array(3*p.length);p.forEach((function(t,e){t.toArray(d,3*e)}));var f=new r.BufferGeometry;return f.setAttribute("position",new r.BufferAttribute(d,3)),f}},l.prototype={constructor:l,parse:function(){var t=[],e=this.parseClips();if(void 0!==e)for(var n in e){var r=e[n],i=this.addClip(r);t.push(i)}return t},parseClips:function(){if(void 0!==t.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var n=this.parseAnimationLayers(e),r=this.parseAnimStacks(n);return r}},parseAnimationCurveNodes:function(){var e=t.Objects.AnimationCurveNode,n=new Map;for(var r in e){var i=e[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var o={id:i.id,attr:i.attrName,curves:{}};n.set(o.id,o)}}return n},parseAnimationCurves:function(n){var r=t.Objects.AnimationCurve;for(var i in r){var o={id:r[i].id,times:r[i].KeyTime.a.map(g),values:r[i].KeyValueFloat.a},a=e.get(o.id);if(void 0!==a){var s=a.parents[0].ID,l=a.parents[0].relationship;l.match(/X/)?n.get(s).curves["x"]=o:l.match(/Y/)?n.get(s).curves["y"]=o:l.match(/Z/)?n.get(s).curves["z"]=o:l.match(/d|DeformPercent/)&&n.has(s)&&(n.get(s).curves["morph"]=o)}}},parseAnimationLayers:function(i){var o=t.Objects.AnimationLayer,a=new Map;for(var s in o){var l=[],c=e.get(parseInt(s));if(void 0!==c){var u=c.children;u.forEach((function(o,a){if(i.has(o.ID)){var s=i.get(o.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===l[a]){var c=e.get(o.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==c){var u=t.Objects.Model[c.toString()];if(void 0===u)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",o);var h={modelName:u.attrName?r.PropertyBinding.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(t){t.ID===u.id&&(h.transform=t.matrix,t.userData.transformData&&(h.eulerOrder=t.userData.transformData.eulerOrder))})),h.transform||(h.transform=new r.Matrix4),"PreRotation"in u&&(h.preRotation=u.PreRotation.value),"PostRotation"in u&&(h.postRotation=u.PostRotation.value),l[a]=h}}l[a]&&(l[a][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===l[a]){var p=e.get(o.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,d=e.get(p).parents[0].ID,f=e.get(d).parents[0].ID;c=e.get(f).parents[0].ID,u=t.Objects.Model[c],h={modelName:u.attrName?r.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:t.Objects.Deformer[p].attrName};l[a]=h}l[a][s.attr]=s}}})),a.set(parseInt(s),l)}}return a},parseAnimStacks:function(n){var r=t.Objects.AnimationStack,i={};for(var o in r){var a=e.get(parseInt(o)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=n.get(a[0].ID);i[o]={name:r[o].attrName,layer:s}}return i},addClip:function(t){var e=[],n=this;return t.layer.forEach((function(t){e=e.concat(n.generateTracks(t))})),new r.AnimationClip(t.name,-1,e)},generateTracks:function(t){var e=[],n=new r.Vector3,i=new r.Quaternion,o=new r.Vector3;if(t.transform&&t.transform.decompose(n,i,o),n=n.toArray(),i=(new r.Euler).setFromQuaternion(i,t.eulerOrder).toArray(),o=o.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){var a=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==a&&e.push(a)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var s=this.generateRotationTrack(t.modelName,t.R.curves,i,t.preRotation,t.postRotation,t.eulerOrder);void 0!==s&&e.push(s)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var l=this.generateVectorTrack(t.modelName,t.S.curves,o,"scale");void 0!==l&&e.push(l)}if(void 0!==t.DeformPercent){var c=this.generateMorphTrack(t);void 0!==c&&e.push(c)}return e},generateVectorTrack:function(t,e,n,i){var o=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(o,e,n);return new r.VectorKeyframeTrack(t+"."+i,o,a)},generateRotationTrack:function(t,e,n,i,o,a){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(r.MathUtils.degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(r.MathUtils.degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(r.MathUtils.degToRad));var s=this.getTimesForAllAxes(e),l=this.getKeyframeTrackValues(s,e,n);void 0!==i&&(i=i.map(r.MathUtils.degToRad),i.push(a),i=(new r.Euler).fromArray(i),i=(new r.Quaternion).setFromEuler(i)),void 0!==o&&(o=o.map(r.MathUtils.degToRad),o.push(a),o=(new r.Euler).fromArray(o),o=(new r.Quaternion).setFromEuler(o).inverse());for(var c=new r.Quaternion,u=new r.Euler,h=[],p=0;p<l.length;p+=3)u.set(l[p],l[p+1],l[p+2],a),c.setFromEuler(u),void 0!==i&&c.premultiply(i),void 0!==o&&c.multiply(o),c.toArray(h,p/3*4);return new r.QuaternionKeyframeTrack(t+".quaternion",s,h)},generateMorphTrack:function(t){var e=t.DeformPercent.curves.morph,i=e.values.map((function(t){return t/100})),o=n.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new r.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+o+"]",e.times,i)},getTimesForAllAxes:function(t){var e=[];return void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})).filter((function(t,e,n){return n.indexOf(t)==e})),e},getKeyframeTrackValues:function(t,e,n){var r=n,i=[],o=-1,a=-1,s=-1;return t.forEach((function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(a=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==o){var n=e.x.values[o];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==a){var l=e.y.values[a];i.push(l),r[1]=l}else i.push(r[1]);if(-1!==s){var c=e.z.values[s];i.push(c),r[2]=c}else i.push(r[2])})),i},interpolateRotations:function(t){for(var e=1;e<t.values.length;e++){var n=t.values[e-1],r=t.values[e]-n,i=Math.abs(r);if(i>=180){var o=i/180,a=r/o,s=n+a,l=t.times[e-1],c=t.times[e]-l,u=c/o,h=l+u,p=[],d=[];while(h<t.times[e])p.push(h),h+=u,d.push(s),s+=a;t.times=A(t.times,e,p),t.values=A(t.values,e,d)}}}},c.prototype={constructor:c,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new p,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,n=t.split(/[\r\n]+/);return n.forEach((function(t,r){var i=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(!i&&!o){var a=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");a?e.parseNodeBegin(t,a):s?e.parseNodeProperty(t,s,n[++r]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}})),this.allNodes},parseNodeBegin:function(t,e){var n=e[1].trim().replace(/^"/,"").replace(/"$/,""),r=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in a?("PoseNode"===n?a.PoseNode.push(i):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==o.id&&(a[n][o.id]=i)):"number"===typeof o.id?(a[n]={},a[n][o.id]=i):"Properties70"!==n&&(a[n]="PoseNode"===n?[i]:i),"number"===typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var n="",r="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),r=t[2]),{id:e,name:n,type:r}},parseNodeProperty:function(t,e,n){var r=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode(),a=o.name;if("Properties70"!==a){if("C"===r){var s=i.split(",").slice(1),l=parseInt(s[0]),c=parseInt(s[1]),u=i.split(",").slice(3);u=u.map((function(t){return t.trim().replace(/^"/,"")})),r="connections",i=[l,c],S(i,u),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=M(i))}else this.parseNodeSpecialProperty(t,r,i)},parseNodePropertyContinued:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=M(e.a))},parseNodeSpecialProperty:function(t,e,n){var r=n.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],a=r[2],s=r[3],l=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=M(l);break}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},u.prototype={constructor:u,parse:function(t){var e=new h(t);e.skip(23);var n=e.getUint32(),r=new p;while(!this.endOfContent(e)){var i=this.parseNode(e,n);null!==i&&r.add(i.name,i)}return r},endOfContent:function(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var n={},r=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();var o=t.getUint8(),a=t.getString(o);if(0===r)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(t));var c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",h=s.length>2?s[2]:"";n.singleProperty=1===i&&t.getOffset()===r;while(r>t.getOffset()){var p=this.parseNode(t,e);null!==p&&this.parseSubNode(a,n,p)}return n.propertyList=s,"number"===typeof c&&(n.id=c),""!==u&&(n.attrName=u),""!==h&&(n.attrType=h),""!==a&&(n.name=a),n},parseSubNode:function(t,e,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(e[n.name]=n,n.a=r):e[n.name]=r}else if("Connections"===t&&"C"===n.name){var i=[];n.propertyList.forEach((function(t,e){0!==e&&i.push(t)})),void 0===e.connections&&(e.connections=[]),e.connections.push(i)}else if("Properties70"===n.name){var o=Object.keys(n);o.forEach((function(t){e[t]=n[t]}))}else if("Properties70"===t&&"P"===n.name){var a,s=n.propertyList[0],l=n.propertyList[1],c=n.propertyList[2],u=n.propertyList[3];0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),0===l.indexOf("Lcl ")&&(l=l.replace("Lcl ","Lcl_")),a="Color"===l||"ColorRGB"===l||"Vector"===l||"Vector3D"===l||0===l.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],e[s]={type:l,type2:c,flag:u,value:a}}else void 0===e[n.name]?"number"===typeof n.id?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:"PoseNode"===n.name?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):void 0===e[n.name][n.id]&&(e[n.name][n.id]=n)},parseProperty:function(t){var e=t.getString(1);switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var n=t.getUint32();return t.getArrayBuffer(n);case"S":n=t.getUint32();return t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=t.getUint32(),o=t.getUint32(),a=t.getUint32();if(0===o)switch(e){case"b":case"c":return t.getBooleanArray(r);case"d":return t.getFloat64Array(r);case"f":return t.getFloat32Array(r);case"i":return t.getInt32Array(r);case"l":return t.getInt64Array(r)}"undefined"===typeof i&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new i.Inflate(new Uint8Array(t.getArrayBuffer(a))),l=new h(s.decompress().buffer);switch(e){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}},h.prototype={constructor:h,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1===(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getBoolean());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t},getInt64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],n=0;n<t;n++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getString:function(t){for(var e=[],n=0;n<t;n++)e[n]=this.getUint8();var i=e.indexOf(0);return i>=0&&(e=e.slice(0,i)),r.LoaderUtils.decodeText(new Uint8Array(e))}},p.prototype={constructor:p,add:function(t,e){this[t]=e}};var y=[];function v(t,e,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=t;break;case"ByPolygon":i=e;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var o=i*r.dataSize,a=o+r.dataSize;return T(y,r.buffer,o,a)}var _=new r.Euler,x=new r.Vector3;function b(t){var e=new r.Matrix4,n=new r.Matrix4,i=new r.Matrix4,o=new r.Matrix4,a=new r.Matrix4,s=new r.Matrix4,l=new r.Matrix4,c=new r.Matrix4,u=new r.Matrix4,h=new r.Matrix4,p=new r.Matrix4,d=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(x.fromArray(t.translation)),t.preRotation){var f=t.preRotation.map(r.MathUtils.degToRad);f.push(t.eulerOrder),n.makeRotationFromEuler(_.fromArray(f))}if(t.rotation){f=t.rotation.map(r.MathUtils.degToRad);f.push(t.eulerOrder),i.makeRotationFromEuler(_.fromArray(f))}if(t.postRotation){f=t.postRotation.map(r.MathUtils.degToRad);f.push(t.eulerOrder),o.makeRotationFromEuler(_.fromArray(f))}t.scale&&a.scale(x.fromArray(t.scale)),t.scalingOffset&&l.setPosition(x.fromArray(t.scalingOffset)),t.scalingPivot&&s.setPosition(x.fromArray(t.scalingPivot)),t.rotationOffset&&c.setPosition(x.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(x.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h=t.parentMatrixWorld);var m=n.multiply(i).multiply(o),g=new r.Matrix4;h.extractRotation(g);var y=new r.Matrix4;y.copyPosition(h);var v=new r.Matrix4;v.getInverse(g).multiply(h);var b=new r.Matrix4;if(0===d)b.copy(g).multiply(m).multiply(v).multiply(a);else if(1===d)b.copy(g).multiply(v).multiply(m).multiply(a);else{var w=(new r.Matrix4).getInverse(a),M=(new r.Matrix4).multiply(v).multiply(w);b.copy(g).multiply(m).multiply(M).multiply(a)}var E=(new r.Matrix4).getInverse(u),S=(new r.Matrix4).getInverse(s),T=new r.Matrix4;T.copy(e).multiply(c).multiply(u).multiply(n).multiply(i).multiply(o).multiply(E).multiply(l).multiply(s).multiply(a).multiply(S);var A=(new r.Matrix4).copyPosition(T),C=(new r.Matrix4).copy(h).multiply(A);return p.copyPosition(C),T=(new r.Matrix4).multiply(p).multiply(b),T}function w(t){t=t||0;var e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===t?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function M(t){var e=t.split(",").map((function(t){return parseFloat(t)}));return e}function E(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=t.byteLength),r.LoaderUtils.decodeText(new Uint8Array(t,e,n))}function S(t,e){for(var n=0,r=t.length,i=e.length;n<i;n++,r++)t[r]=e[n]}function T(t,e,n,r){for(var i=n,o=0;i<r;i++,o++)t[o]=e[i];return t}function A(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}return o}(),e.exports=r.FBXLoader},{"../../three.js":23,"../Zlib.Inflate.js":8}],16:[function(t,e,n){const r=t("../../three.js");r.GLTFLoader=function(){function t(t){r.Loader.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.pluginCallbacks=[],this.register((function(t){return new s(t)}))}function e(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}t.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:t,load:function(t,e,n,i){var o,a=this;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.LoaderUtils.extractUrlBase(t),a.manager.itemStart(t);var s=function(e){i?i(e):console.error(e),a.manager.itemError(t),a.manager.itemEnd(t)},l=new r.FileLoader(a.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),"use-credentials"===a.crossOrigin&&l.setWithCredentials(!0),l.load(t,(function(n){try{a.parse(n,o,(function(n){e(n),a.manager.itemEnd(t)}),s)}catch(r){s(r)}}),n,s)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},register:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},unregister:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},parse:function(t,e,s,c){var u,f={},y={};if("string"===typeof t)u=t;else{var v=r.LoaderUtils.decodeText(new Uint8Array(t,0,4));if(v===l){try{f[n.KHR_BINARY_GLTF]=new h(t)}catch(S){return void(c&&c(S))}u=f[n.KHR_BINARY_GLTF].content}else u=r.LoaderUtils.decodeText(new Uint8Array(t))}var _=JSON.parse(u);if(void 0===_.asset||_.asset.version[0]<2)c&&c(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var x=new k(_,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});x.fileLoader.setRequestHeader(this.requestHeader);for(var b=0;b<this.pluginCallbacks.length;b++){var w=this.pluginCallbacks[b](x);y[w.name]=w,f[w.name]=!0}if(_.extensionsUsed)for(b=0;b<_.extensionsUsed.length;++b){var M=_.extensionsUsed[b],E=_.extensionsRequired||[];switch(M){case n.KHR_LIGHTS_PUNCTUAL:f[M]=new o(_);break;case n.KHR_MATERIALS_UNLIT:f[M]=new a;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[M]=new m;break;case n.KHR_DRACO_MESH_COMPRESSION:f[M]=new p(_,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:f[M]=new i(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:f[M]=new d;break;case n.KHR_MESH_QUANTIZATION:f[M]=new g;break;default:E.indexOf(M)>=0&&void 0===y[M]&&console.warn('THREE.GLTFLoader: Unknown extension "'+M+'".')}}x.setExtensions(f),x.setPlugins(y),x.parse(s,c)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=t}function o(t){this.name=n.KHR_LIGHTS_PUNCTUAL;var e=t.extensions&&t.extensions[n.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=e.lights||[]}function a(){this.name=n.KHR_MATERIALS_UNLIT}function s(t){this.parser=t,this.name=n.KHR_MATERIALS_CLEARCOAT}o.prototype.loadLight=function(t){var e,n=this.lightDefs[t],i=new r.Color(16777215);void 0!==n.color&&i.fromArray(n.color);var o=void 0!==n.range?n.range:0;switch(n.type){case"directional":e=new r.DirectionalLight(i),e.target.position.set(0,0,-1),e.add(e.target);break;case"point":e=new r.PointLight(i),e.distance=o;break;case"spot":e=new r.SpotLight(i),e.distance=o,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,e.angle=n.spot.outerConeAngle,e.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,e.target.position.set(0,0,-1),e.add(e.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return e.position.set(0,0,0),e.decay=2,void 0!==n.intensity&&(e.intensity=n.intensity),e.name=n.name||"light_"+t,Promise.resolve(e)},a.prototype.getMaterialType=function(){return r.MeshBasicMaterial},a.prototype.extendParams=function(t,e,n){var i=[];t.color=new r.Color(1,1,1),t.opacity=1;var o=e.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){var a=o.baseColorFactor;t.color.fromArray(a),t.opacity=a[3]}void 0!==o.baseColorTexture&&i.push(n.assignTexture(t,"map",o.baseColorTexture))}return Promise.all(i)},s.prototype.getMaterialType=function(){return r.MeshPhysicalMaterial},s.prototype.extendMaterialParams=function(t,e){var n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(e.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&o.push(n.assignTexture(e,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(e.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&o.push(n.assignTexture(e,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(o.push(n.assignTexture(e,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var s=a.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new r.Vector2(s,s)}return Promise.all(o)};var l="glTF",c=12,u={JSON:1313821514,BIN:5130562};function h(t){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,c);if(this.header={magic:r.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==l)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var i=new DataView(t,c),o=0;while(o<i.byteLength){var a=i.getUint32(o,!0);o+=4;var s=i.getUint32(o,!0);if(o+=4,s===u.JSON){var h=new Uint8Array(t,c+o,a);this.content=r.LoaderUtils.decodeText(h)}else if(s===u.BIN){var p=c+o;this.body=t.slice(p,p+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function p(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function d(){this.name=n.KHR_TEXTURE_TRANSFORM}function f(t){r.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),s={specular:{value:(new r.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(t){for(var r in s)t.uniforms[r]=s[r];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),t.fragmentShader=t.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_pars_fragment>",e),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_pars_fragment>",n),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_fragment>",i),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_fragment>",o),t.fragmentShader=t.fragmentShader.replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(t){s.specular.value=t}},specularMap:{get:function(){return s.specularMap.value},set:function(t){s.specularMap.value=t}},glossiness:{get:function(){return s.glossiness.value},set:function(t){s.glossiness.value=t}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(t){s.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function m(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return f},extendParams:function(t,e,n){var i=e.extensions[this.name];t.color=new r.Color(1,1,1),t.opacity=1;var o=[];if(Array.isArray(i.diffuseFactor)){var a=i.diffuseFactor;t.color.fromArray(a),t.opacity=a[3]}if(void 0!==i.diffuseTexture&&o.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new r.Color(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new r.Color(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var s=i.specularGlossinessTexture;o.push(n.assignTexture(t,"glossinessMap",s)),o.push(n.assignTexture(t,"specularMap",s))}return Promise.all(o)},createMaterial:function(t){var e=new f(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=r.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function g(){this.name=n.KHR_MESH_QUANTIZATION}function y(t,e,n,i){r.Interpolant.call(this,t,e,n,i)}p.prototype.decodePrimitive=function(t,e){var n=this.json,r=this.dracoLoader,i=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},s={},l={};for(var c in o){var u=M[c]||c.toLowerCase();a[u]=o[c]}for(c in t.attributes){u=M[c]||c.toLowerCase();if(void 0!==o[c]){var h=n.accessors[t.attributes[c]],p=_[h.componentType];l[u]=p,s[u]=!0===h.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){r.decodeDracoFile(t,(function(t){for(var n in t.attributes){var r=t.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}e(t)}),a,l)}))}))},d.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},f.prototype=Object.create(r.MeshStandardMaterial.prototype),f.prototype.constructor=f,f.prototype.copy=function(t){return r.MeshStandardMaterial.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},y.prototype=Object.create(r.Interpolant.prototype),y.prototype.constructor=y,y.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r,o=0;o!==r;o++)e[o]=n[i+o];return e},y.prototype.beforeStart_=y.prototype.copySampleValue_,y.prototype.afterEnd_=y.prototype.copySampleValue_,y.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=r-e,u=(n-e)/c,h=u*u,p=h*u,d=t*l,f=d-l,m=-2*p+3*h,g=p-h,y=1-m,v=g-h+u,_=0;_!==a;_++){var x=o[f+_+a],b=o[f+_+s]*c,w=o[d+_+a],M=o[d+_]*c;i[_]=y*x+v*b+m*w+g*M}return i};var v={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x={9728:r.NearestFilter,9729:r.LinearFilter,9984:r.NearestMipmapNearestFilter,9985:r.LinearMipmapNearestFilter,9986:r.NearestMipmapLinearFilter,9987:r.LinearMipmapLinearFilter},b={33071:r.ClampToEdgeWrapping,33648:r.MirroredRepeatWrapping,10497:r.RepeatWrapping},w={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},E={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},S={CUBICSPLINE:void 0,LINEAR:r.InterpolateLinear,STEP:r.InterpolateDiscrete},T={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},A={"image/png":r.RGBAFormat,"image/jpeg":r.RGBFormat};function C(t,e){return"string"!==typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function L(t){return void 0===t["DefaultMaterial"]&&(t["DefaultMaterial"]=new r.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.FrontSide})),t["DefaultMaterial"]}function I(t,e,n){for(var r in n.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function P(t,e){void 0!==e.extras&&("object"===typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function R(t,e,n){for(var r=!1,i=!1,o=0,a=e.length;o<a;o++){var s=e[o];if(void 0!==s.POSITION&&(r=!0),void 0!==s.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(t);var l=[],c=[];for(o=0,a=e.length;o<a;o++){s=e[o];if(r){var u=void 0!==s.POSITION?n.getDependency("accessor",s.POSITION):t.attributes.position;l.push(u)}if(i){u=void 0!==s.NORMAL?n.getDependency("accessor",s.NORMAL):t.attributes.normal;c.push(u)}}return Promise.all([Promise.all(l),Promise.all(c)]).then((function(e){var n=e[0],o=e[1];return r&&(t.morphAttributes.position=n),i&&(t.morphAttributes.normal=o),t.morphTargetsRelative=!0,t}))}function O(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){var i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)t.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function D(t){var e,r=t.extensions&&t.extensions[n.KHR_DRACO_MESH_COMPRESSION];return e=r?"draco:"+r.bufferView+":"+r.indices+":"+N(r.attributes):t.indices+":"+N(t.attributes)+":"+t.mode,e}function N(t){for(var e="",n=Object.keys(t).sort(),r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function k(t,n){this.json=t||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new e,this.associations=new Map,this.primitiveCache={},this.useImageBitmap="undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent),this.useImageBitmap?this.textureLoader=new r.ImageBitmapLoader(this.options.manager):this.textureLoader=new r.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new r.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function F(t,e,n){var i=e.attributes,o=new r.Box3;if(void 0!==i.POSITION){var a=n.json.accessors[i.POSITION],s=a.min,l=a.max;if(void 0!==s&&void 0!==l){o.set(new r.Vector3(s[0],s[1],s[2]),new r.Vector3(l[0],l[1],l[2]));var c=e.targets;if(void 0!==c){for(var u=new r.Vector3,h=new r.Vector3,p=0,d=c.length;p<d;p++){var f=c[p];if(void 0!==f.POSITION){a=n.json.accessors[f.POSITION],s=a.min,l=a.max;void 0!==s&&void 0!==l?(h.setX(Math.max(Math.abs(s[0]),Math.abs(l[0]))),h.setY(Math.max(Math.abs(s[1]),Math.abs(l[1]))),h.setZ(Math.max(Math.abs(s[2]),Math.abs(l[2]))),u.max(h)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(u)}t.boundingBox=o;var m=new r.Sphere;o.getCenter(m.center),m.radius=o.min.distanceTo(o.max)/2,t.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function z(t,e,n){var r=e.attributes,i=[];function o(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(var a in r){var s=M[a]||a.toLowerCase();s in t.attributes||i.push(o(r[a],s))}if(void 0!==e.indices&&!t.index){var l=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(l)}return P(t,e),F(t,e,n),Promise.all(i).then((function(){return void 0!==e.targets?R(t,e.targets,n):t}))}function B(t,e){var n=t.getIndex();if(null===n){var i=[],o=t.getAttribute("position");if(void 0===o)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var a=0;a<o.count;a++)i.push(a);t.setIndex(i),n=t.getIndex()}var s=n.count-2,l=[];if(e===r.TriangleFanDrawMode)for(a=1;a<=s;a++)l.push(n.getX(0)),l.push(n.getX(a)),l.push(n.getX(a+1));else for(a=0;a<s;a++)a%2===0?(l.push(n.getX(a)),l.push(n.getX(a+1)),l.push(n.getX(a+2))):(l.push(n.getX(a+2)),l.push(n.getX(a+1)),l.push(n.getX(a)));l.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=t.clone();return c.setIndex(l),c}return k.prototype.setExtensions=function(t){this.extensions=t},k.prototype.setPlugins=function(t){this.plugins=t},k.prototype.parse=function(t,e){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(e){var o={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};I(i,o,r),P(o,r),t(o)})).catch(e)},k.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],r={},i={},o=0,a=e.length;o<a;o++)for(var s=e[o].joints,l=0,c=s.length;l<c;l++)t[s[l]].isBone=!0;for(var u=0,h=t.length;u<h;u++){var p=t[u];void 0!==p.mesh&&(void 0===r[p.mesh]&&(r[p.mesh]=i[p.mesh]=0),r[p.mesh]++,void 0!==p.skin&&(n[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=i},k.prototype._invokeOne=function(t){var e=Object.values(this.plugins);e.push(this);for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}},k.prototype._invokeAll=function(t){var e=Object.values(this.plugins);e.unshift(this);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r]));return Promise.all(n)},k.prototype.getDependency=function(t,e){var r=t+":"+e,i=this.cache.get(r);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this.loadTexture(e);break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;case"light":i=this.extensions[n.KHR_LIGHTS_PUNCTUAL].loadLight(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,i)}return i},k.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e},k.prototype.loadBuffer=function(t){var e=this.json.buffers[t],r=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(t,n){r.load(C(e.uri,i.path),t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},k.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))},k.prototype.loadAccessor=function(t){var e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var o=[];return void 0!==i.bufferView?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),void 0!==i.sparse&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then((function(t){var o,a,s=t[0],l=w[i.type],c=_[i.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,p=i.byteOffset||0,d=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,f=!0===i.normalized;if(d&&d!==h){var m=Math.floor(p/d),g="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+m+":"+i.count,y=e.cache.get(g);y||(o=new c(s,m*d,i.count*d/u),y=new r.InterleavedBuffer(o,d/u),e.cache.add(g,y)),a=new r.InterleavedBufferAttribute(y,l,p%d/u,f)}else o=null===s?new c(i.count*l):new c(s,p,i.count*l),a=new r.BufferAttribute(o,l,f);if(void 0!==i.sparse){var v=w.SCALAR,x=_[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,M=i.sparse.values.byteOffset||0,E=new x(t[1],b,i.sparse.count*v),S=new c(t[2],M,i.sparse.count*l);null!==s&&(a=new r.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(var T=0,A=E.length;T<A;T++){var C=E[T];if(a.setX(C,S[T*l]),l>=2&&a.setY(C,S[T*l+1]),l>=3&&a.setZ(C,S[T*l+2]),l>=4&&a.setW(C,S[T*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))},k.prototype.loadTexture=function(t){var e,i=this,o=this.json,a=this.options,s=this.useImageBitmap,l=this.textureLoader,c=self.URL||self.webkitURL,u=o.textures[t],h=u.extensions||{};e=h[n.MSFT_TEXTURE_DDS]?o.images[h[n.MSFT_TEXTURE_DDS].source]:o.images[u.source];var p=e.uri,d=!1;return void 0!==e.bufferView&&(p=i.getDependency("bufferView",e.bufferView).then((function(t){d=!0;var n=new Blob([t],{type:e.mimeType});return p=c.createObjectURL(n),p}))),Promise.resolve(p).then((function(t){var e=a.manager.getHandler(t);return e||(e=h[n.MSFT_TEXTURE_DDS]?i.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:l),new Promise((function(n,i){var o=n;s&&(o=function(t){n(new r.CanvasTexture(t))}),e.load(C(t,a.path),o,void 0,i)}))})).then((function(n){!0===d&&c.revokeObjectURL(p),n.flipY=!1,u.name&&(n.name=u.name),e.mimeType in A&&(n.format=A[e.mimeType]);var a=o.samplers||{},s=a[u.sampler]||{};return n.magFilter=x[s.magFilter]||r.LinearFilter,n.minFilter=x[s.minFilter]||r.LinearMipmapLinearFilter,n.wrapS=b[s.wrapS]||r.RepeatWrapping,n.wrapT=b[s.wrapT]||r.RepeatWrapping,i.associations.set(n,{type:"textures",index:t}),n}))},k.prototype.assignTexture=function(t,e,i){var o=this;return this.getDependency("texture",i.index).then((function(a){if(!a.isCompressedTexture)switch(e){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":a.format=r.RGBFormat;break}if(void 0===i.texCoord||0==i.texCoord||"aoMap"===e&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+e+" not yet supported."),o.extensions[n.KHR_TEXTURE_TRANSFORM]){var s=void 0!==i.extensions?i.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var l=o.associations.get(a);a=o.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(a,s),o.associations.set(a,l)}}t[e]=a}))},k.prototype.assignFinalMaterial=function(t){var e=t.geometry,n=t.material,i=void 0!==e.attributes.tangent,o=void 0!==e.attributes.color,a=void 0===e.attributes.normal,s=!0===t.isSkinnedMesh,l=Object.keys(e.morphAttributes).length>0,c=l&&void 0!==e.morphAttributes.normal;if(t.isPoints){var u="PointsMaterial:"+n.uuid,h=this.cache.get(u);h||(h=new r.PointsMaterial,r.Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(u,h)),n=h}else if(t.isLine){u="LineBasicMaterial:"+n.uuid;var p=this.cache.get(u);p||(p=new r.LineBasicMaterial,r.Material.prototype.copy.call(p,n),p.color.copy(n.color),this.cache.add(u,p)),n=p}if(i||o||a||s||l){u="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),s&&(u+="skinning:"),i&&(u+="vertex-tangents:"),o&&(u+="vertex-colors:"),a&&(u+="flat-shading:"),l&&(u+="morph-targets:"),c&&(u+="morph-normals:");var d=this.cache.get(u);d||(d=n.clone(),s&&(d.skinning=!0),i&&(d.vertexTangents=!0),o&&(d.vertexColors=!0),a&&(d.flatShading=!0),l&&(d.morphTargets=!0),c&&(d.morphNormals=!0),this.cache.add(u,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),n.normalScale&&!i&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!i&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),t.material=n},k.prototype.getMaterialType=function(){return r.MeshStandardMaterial},k.prototype.loadMaterial=function(t){var e,i=this,o=this.json,a=this.extensions,s=o.materials[t],l={},c=s.extensions||{},u=[];if(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=h.getMaterialType(),u.push(h.extendParams(l,s,i))}else if(c[n.KHR_MATERIALS_UNLIT]){var p=a[n.KHR_MATERIALS_UNLIT];e=p.getMaterialType(),u.push(p.extendParams(l,s,i))}else{var d=s.pbrMetallicRoughness||{};if(l.color=new r.Color(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){var m=d.baseColorFactor;l.color.fromArray(m),l.opacity=m[3]}void 0!==d.baseColorTexture&&u.push(i.assignTexture(l,"map",d.baseColorTexture)),l.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,l.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(u.push(i.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),u.push(i.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),u.push(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,l)})))}!0===s.doubleSided&&(l.side=r.DoubleSide);var g=s.alphaMode||T.OPAQUE;return g===T.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,g===T.MASK&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&e!==r.MeshBasicMaterial&&(u.push(i.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new r.Vector2(1,1),void 0!==s.normalTexture.scale&&l.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&e!==r.MeshBasicMaterial&&(u.push(i.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&e!==r.MeshBasicMaterial&&(l.emissive=(new r.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&e!==r.MeshBasicMaterial&&u.push(i.assignTexture(l,"emissiveMap",s.emissiveTexture)),Promise.all(u).then((function(){var o;return o=e===f?a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new e(l),s.name&&(o.name=s.name),o.map&&(o.map.encoding=r.sRGBEncoding),o.emissiveMap&&(o.emissiveMap.encoding=r.sRGBEncoding),P(o,s),i.associations.set(o,{type:"materials",index:t}),s.extensions&&I(a,o,s),o}))},k.prototype.loadGeometries=function(t){var e=this,i=this.extensions,o=this.primitiveCache;function a(t){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return z(n,t,e)}))}for(var s=[],l=0,c=t.length;l<c;l++){var u,h=t[l],p=D(h),d=o[p];if(d)s.push(d.promise);else u=h.extensions&&h.extensions[n.KHR_DRACO_MESH_COMPRESSION]?a(h):z(new r.BufferGeometry,h,e),o[p]={primitive:h,promise:u},s.push(u)}return Promise.all(s)},k.prototype.loadMesh=function(t){for(var e=this,n=this.json,i=n.meshes[t],o=i.primitives,a=[],s=0,l=o.length;s<l;s++){var c=void 0===o[s].material?L(this.cache):this.getDependency("material",o[s].material);a.push(c)}return a.push(e.loadGeometries(o)),Promise.all(a).then((function(n){for(var a=n.slice(0,n.length-1),s=n[n.length-1],l=[],c=0,u=s.length;c<u;c++){var h,p=s[c],d=o[c],f=a[c];if(d.mode===v.TRIANGLES||d.mode===v.TRIANGLE_STRIP||d.mode===v.TRIANGLE_FAN||void 0===d.mode)h=!0===i.isSkinnedMesh?new r.SkinnedMesh(p,f):new r.Mesh(p,f),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),d.mode===v.TRIANGLE_STRIP?h.geometry=B(h.geometry,r.TriangleStripDrawMode):d.mode===v.TRIANGLE_FAN&&(h.geometry=B(h.geometry,r.TriangleFanDrawMode));else if(d.mode===v.LINES)h=new r.LineSegments(p,f);else if(d.mode===v.LINE_STRIP)h=new r.Line(p,f);else if(d.mode===v.LINE_LOOP)h=new r.LineLoop(p,f);else{if(d.mode!==v.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new r.Points(p,f)}Object.keys(h.geometry.morphAttributes).length>0&&O(h,i),h.name=i.name||"mesh_"+t,s.length>1&&(h.name+="_"+c),P(h,i),e.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];var m=new r.Group;for(c=0,u=l.length;c<u;c++)m.add(l[c]);return m}))},k.prototype.loadCamera=function(t){var e,n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new r.PerspectiveCamera(r.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new r.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=n.name),P(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},k.prototype.loadSkin=function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))},k.prototype.loadAnimation=function(t){for(var e=this.json,n=e.animations[t],i=[],o=[],a=[],s=[],l=[],c=0,u=n.channels.length;c<u;c++){var h=n.channels[c],p=n.samplers[h.sampler],d=h.target,f=void 0!==d.node?d.node:d.id,m=void 0!==n.parameters?n.parameters[p.input]:p.input,g=void 0!==n.parameters?n.parameters[p.output]:p.output;i.push(this.getDependency("node",f)),o.push(this.getDependency("accessor",m)),a.push(this.getDependency("accessor",g)),s.push(p),l.push(d)}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(s),Promise.all(l)]).then((function(e){for(var i=e[0],o=e[1],a=e[2],s=e[3],l=e[4],c=[],u=0,h=i.length;u<h;u++){var p=i[u],d=o[u],f=a[u],m=s[u],g=l[u];if(void 0!==p){var v;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,E[g.path]){case E.weights:v=r.NumberKeyframeTrack;break;case E.rotation:v=r.QuaternionKeyframeTrack;break;case E.position:case E.scale:default:v=r.VectorKeyframeTrack;break}var _=p.name?p.name:p.uuid,x=void 0!==m.interpolation?S[m.interpolation]:r.InterpolateLinear,b=[];E[g.path]===E.weights?p.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&b.push(t.name?t.name:t.uuid)})):b.push(_);var w=f.array;if(f.normalized){var M;if(w.constructor===Int8Array)M=1/127;else if(w.constructor===Uint8Array)M=1/255;else if(w.constructor==Int16Array)M=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");M=1/65535}for(var T=new Float32Array(w.length),A=0,C=w.length;A<C;A++)T[A]=w[A]*M;w=T}for(A=0,C=b.length;A<C;A++){var L=new v(b[A]+"."+E[g.path],d.array,w,x);"CUBICSPLINE"===m.interpolation&&(L.createInterpolant=function(t){return new y(this.times,this.values,this.getValueSize()/3,t)},L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(L)}}}var I=n.name?n.name:"animation_"+t;return new r.AnimationClip(I,void 0,c)}))},k.prototype.loadNode=function(t){var e=this.json,i=this.extensions,o=this,a=e.meshReferences,s=e.meshUses,l=e.nodes[t];return function(){var t=[];return void 0!==l.mesh&&t.push(o.getDependency("mesh",l.mesh).then((function(t){var e;if(a[l.mesh]>1){var n=s[l.mesh]++;e=t.clone(),e.name+="_instance_"+n}else e=t;return void 0!==l.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,n=l.weights.length;e<n;e++)t.morphTargetInfluences[e]=l.weights[e]})),e}))),void 0!==l.camera&&t.push(o.getDependency("camera",l.camera)),l.extensions&&l.extensions[n.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[n.KHR_LIGHTS_PUNCTUAL].light&&t.push(o.getDependency("light",l.extensions[n.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)}().then((function(e){var n;if(n=!0===l.isBone?new r.Bone:e.length>1?new r.Group:1===e.length?e[0]:new r.Object3D,n!==e[0])for(var a=0,s=e.length;a<s;a++)n.add(e[a]);if(l.name&&(n.userData.name=l.name,n.name=r.PropertyBinding.sanitizeNodeName(l.name)),P(n,l),l.extensions&&I(i,n,l),void 0!==l.matrix){var c=new r.Matrix4;c.fromArray(l.matrix),n.applyMatrix4(c)}else void 0!==l.translation&&n.position.fromArray(l.translation),void 0!==l.rotation&&n.quaternion.fromArray(l.rotation),void 0!==l.scale&&n.scale.fromArray(l.scale);return o.associations.set(n,{type:"nodes",index:t}),n}))},k.prototype.loadScene=function(){function t(e,n,i,o){var a=i.nodes[e];return o.getDependency("node",e).then((function(t){return void 0===a.skin?t:o.getDependency("skin",a.skin).then((function(t){e=t;for(var n=[],r=0,i=e.joints.length;r<i;r++)n.push(o.getDependency("node",e.joints[r]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(t.isMesh){for(var i=[],o=[],a=0,s=n.length;a<s;a++){var l=n[a];if(l){i.push(l);var c=new r.Matrix4;void 0!==e.inverseBindMatrices&&c.fromArray(e.inverseBindMatrices.array,16*a),o.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[a])}t.bind(new r.Skeleton(i,o),t.matrixWorld)}})),t}));var e})).then((function(e){n.add(e);var r=[];if(a.children)for(var s=a.children,l=0,c=s.length;l<c;l++){var u=s[l];r.push(t(u,e,i,o))}return Promise.all(r)}))}return function(e){var n=this.json,i=this.extensions,o=this.json.scenes[e],a=this,s=new r.Group;o.name&&(s.name=o.name),P(s,o),o.extensions&&I(i,s,o);for(var l=o.nodes||[],c=[],u=0,h=l.length;u<h;u++)c.push(t(l[u],s,n,a));return Promise.all(c).then((function(){return s}))}}(),t}(),e.exports=r.GLTFLoader},{"../../three.js":23}],17:[function(t,e,n){const r=t("../../three.js");r.MTLLoader=function(t){r.Loader.call(this,t)},r.MTLLoader.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:r.MTLLoader,load:function(t,e,n,i){var o=this,a=""===this.path?r.LoaderUtils.extractUrlBase(t||""):this.path,s=new r.FileLoader(this.manager);s.setPath(this.path),s.load(t,(function(n){try{e(o.parse(n,a))}catch(r){i?i(r):console.error(r),o.manager.itemError(t)}}),n,i)},setMaterialOptions:function(t){return this.materialOptions=t,this},parse:function(t,e){for(var n=t.split("\n"),i={},o=/\s+/,a={},s=0;s<n.length;s++){var l=n[s];if(l=l.trim(),0!==l.length&&"#"!==l.charAt(0)){var c=l.indexOf(" "),u=c>=0?l.substring(0,c):l;u=u.toLowerCase();var h=c>=0?l.substring(c+1):"";if(h=h.trim(),"newmtl"===u)i={name:h},a[h]=i;else if("ka"===u||"kd"===u||"ks"===u||"ke"===u){var p=h.split(o,3);i[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else i[u]=h}}var d=new r.MTLLoader.MaterialCreator(this.resourcePath||e,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(a),d}}),r.MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:r.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:r.RepeatWrapping},r.MTLLoader.MaterialCreator.prototype={constructor:r.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(t){return this.crossOrigin=t,this},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var n in t){var r=t[n],i={};for(var o in e[n]=i,r){var a=!0,s=r[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(a=!1);break;default:break}a&&(i[l]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,n=this.materialsInfo[t],i={name:t,side:this.side};function o(t,e){return"string"!==typeof e||""===e?"":/^https?:\/\//i.test(e)?e:t+e}function a(t,n){if(!i[t]){var r=e.getTextureParams(n,i),a=e.loadTexture(o(e.baseUrl,r.url));a.repeat.copy(r.scale),a.offset.copy(r.offset),a.wrapS=e.wrap,a.wrapT=e.wrap,i[t]=a}}for(var s in n){var l,c=n[s];if(""!==c)switch(s.toLowerCase()){case"kd":i.color=(new r.Color).fromArray(c);break;case"ks":i.specular=(new r.Color).fromArray(c);break;case"ke":i.emissive=(new r.Color).fromArray(c);break;case"map_kd":a("map",c);break;case"map_ks":a("specularMap",c);break;case"map_ke":a("emissiveMap",c);break;case"norm":a("normalMap",c);break;case"map_bump":case"bump":a("bumpMap",c);break;case"map_d":a("alphaMap",c),i.transparent=!0;break;case"ns":i.shininess=parseFloat(c);break;case"d":l=parseFloat(c),l<1&&(i.opacity=l,i.transparent=!0);break;case"tr":l=parseFloat(c),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(i.opacity=1-l,i.transparent=!0);break;default:break}}return this.materials[t]=new r.MeshPhongMaterial(i),this.materials[t]},getTextureParams:function(t,e){var n,i={scale:new r.Vector2(1,1),offset:new r.Vector2(0,0)},o=t.split(/\s+/);return n=o.indexOf("-bm"),n>=0&&(e.bumpScale=parseFloat(o[n+1]),o.splice(n,2)),n=o.indexOf("-s"),n>=0&&(i.scale.set(parseFloat(o[n+1]),parseFloat(o[n+2])),o.splice(n,4)),n=o.indexOf("-o"),n>=0&&(i.offset.set(parseFloat(o[n+1]),parseFloat(o[n+2])),o.splice(n,4)),i.url=o.join(" ").trim(),i},loadTexture:function(t,e,n,i,o){var a,s=void 0!==this.manager?this.manager:r.DefaultLoadingManager,l=s.getHandler(t);return null===l&&(l=new r.TextureLoader(s)),l.setCrossOrigin&&l.setCrossOrigin(this.crossOrigin),a=l.load(t,n,i,o),void 0!==e&&(a.mapping=e),a}},e.exports=r.MTLLoader},{"../../three.js":23}],18:[function(t,e,n){const r=t("../../three.js");r.OBJLoader=function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,n=/^usemtl /,i=/^usemap /,o=new r.Vector3,a=new r.Vector3,s=new r.Vector3,l=new r.Vector3,c=new r.Vector3;function u(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var n=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasNormalIndices:!1,hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var r={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"===typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"===typeof n.clone){var r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){var r=this.vertices,i=this.object.geometry.vertices;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(t){var e=this.vertices,n=this.object.geometry.vertices;n.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices,n=this.object.geometry.vertices;n.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){var r=this.normals,i=this.object.geometry.normals;i.push(r[t+0],r[t+1],r[t+2]),i.push(r[e+0],r[e+1],r[e+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(t,e,n){var r=this.vertices,i=this.object.geometry.normals;o.fromArray(r,t),a.fromArray(r,e),s.fromArray(r,n),c.subVectors(s,a),l.subVectors(o,a),c.cross(l),c.normalize(),i.push(c.x,c.y,c.z),i.push(c.x,c.y,c.z),i.push(c.x,c.y,c.z)},addColor:function(t,e,n){var r=this.colors,i=this.object.geometry.colors;void 0!==r[t]&&i.push(r[t+0],r[t+1],r[t+2]),void 0!==r[e]&&i.push(r[e+0],r[e+1],r[e+2]),void 0!==r[n]&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(t,e,n){var r=this.uvs,i=this.object.geometry.uvs;i.push(r[t+0],r[t+1]),i.push(r[e+0],r[e+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){var t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){var e=this.uvs,n=this.object.geometry.uvs;n.push(e[t+0],e[t+1])},addFace:function(t,e,n,r,i,o,a,s,l){var c=this.vertices.length,u=this.parseVertexIndex(t,c),h=this.parseVertexIndex(e,c),p=this.parseVertexIndex(n,c);if(this.addVertex(u,h,p),this.addColor(u,h,p),void 0!==a&&""!==a){var d=this.normals.length;u=this.parseNormalIndex(a,d),h=this.parseNormalIndex(s,d),p=this.parseNormalIndex(l,d),this.addNormal(u,h,p),this.object.geometry.hasNormalIndices=!0}else this.addFaceNormal(u,h,p);if(void 0!==r&&""!==r){var f=this.uvs.length;u=this.parseUVIndex(r,f),h=this.parseUVIndex(i,f),p=this.parseUVIndex(o,f),this.addUV(u,h,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,n=0,r=t.length;n<r;n++)this.addVertexPoint(this.parseVertexIndex(t[n],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,i=0,o=t.length;i<o;i++)this.addVertexLine(this.parseVertexIndex(t[i],n));var a=0;for(o=e.length;a<o;a++)this.addUVLine(this.parseUVIndex(e[a],r))}};return t.startObject("",!1),t}function h(t){r.Loader.call(this,t),this.materials=null}return h.prototype=Object.assign(Object.create(r.Loader.prototype),{constructor:h,load:function(t,e,n,i){var o=this,a=new r.FileLoader(o.manager);a.setPath(this.path),a.load(t,(function(n){try{e(o.parse(n))}catch(r){i?i(r):console.error(r),o.manager.itemError(t)}}),n,i)},setMaterials:function(t){return this.materials=t,this},parse:function(o){var a=new u;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var s=o.split("\n"),l="",c="",h=0,p=[],d="function"===typeof"".trimLeft,f=0,m=s.length;f<m;f++)if(l=s[f],l=d?l.trimLeft():l.trim(),h=l.length,0!==h&&(c=l.charAt(0),"#"!==c))if("v"===c){var g=l.split(/\s+/);switch(g[0]){case"v":a.vertices.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])),g.length>=7?a.colors.push(parseFloat(g[4]),parseFloat(g[5]),parseFloat(g[6])):a.colors.push(void 0,void 0,void 0);break;case"vn":a.normals.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3]));break;case"vt":a.uvs.push(parseFloat(g[1]),parseFloat(g[2]));break}}else if("f"===c){for(var y=l.substr(1).trim(),v=y.split(/\s+/),_=[],x=0,b=v.length;x<b;x++){var w=v[x];if(w.length>0){var M=w.split("/");_.push(M)}}var E=_[0];for(x=1,b=_.length-1;x<b;x++){var S=_[x],T=_[x+1];a.addFace(E[0],S[0],T[0],E[1],S[1],T[1],E[2],S[2],T[2])}}else if("l"===c){var A=l.substring(1).trim().split(" "),C=[],L=[];if(-1===l.indexOf("/"))C=A;else for(var I=0,P=A.length;I<P;I++){var R=A[I].split("/");""!==R[0]&&C.push(R[0]),""!==R[1]&&L.push(R[1])}a.addLineGeometry(C,L)}else if("p"===c){y=l.substr(1).trim();var O=y.split(" ");a.addPointGeometry(O)}else if(null!==(p=t.exec(l))){var D=(" "+p[0].substr(1).trim()).substr(1);a.startObject(D)}else if(n.test(l))a.object.startMaterial(l.substring(7).trim(),a.materialLibraries);else if(e.test(l))a.materialLibraries.push(l.substring(7).trim());else if(i.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if(p=l.split(" "),p.length>1){var N=p[1].trim().toLowerCase();a.object.smooth="0"!==N&&"off"!==N}else a.object.smooth=!0;var k=a.object.currentMaterial();k&&(k.smooth=a.object.smooth)}else{if("\0"===l)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}a.finalize();var F=new r.Group;F.materialLibraries=[].concat(a.materialLibraries);for(f=0,m=a.objects.length;f<m;f++){var z=a.objects[f],B=z.geometry,U=z.materials,j="Line"===B.type,G="Points"===B.type,V=!1;if(0!==B.vertices.length){var H=new r.BufferGeometry;H.setAttribute("position",new r.Float32BufferAttribute(B.vertices,3)),!0===B.hasNormalIndices&&H.setAttribute("normal",new r.Float32BufferAttribute(B.normals,3)),B.colors.length>0&&(V=!0,H.setAttribute("color",new r.Float32BufferAttribute(B.colors,3))),!0===B.hasUVIndices&&H.setAttribute("uv",new r.Float32BufferAttribute(B.uvs,2));for(var W,q=[],X=0,Z=U.length;X<Z;X++){var Y=U[X],$=Y.name+"_"+Y.smooth+"_"+V;k=a.materials[$];if(null!==this.materials)if(k=this.materials.create(Y.name),!j||!k||k instanceof r.LineBasicMaterial){if(G&&k&&!(k instanceof r.PointsMaterial)){var J=new r.PointsMaterial({size:10,sizeAttenuation:!1});r.Material.prototype.copy.call(J,k),J.color.copy(k.color),J.map=k.map,k=J}}else{var K=new r.LineBasicMaterial;r.Material.prototype.copy.call(K,k),K.color.copy(k.color),k=K}void 0===k&&(k=j?new r.LineBasicMaterial:G?new r.PointsMaterial({size:1,sizeAttenuation:!1}):new r.MeshPhongMaterial,k.name=Y.name,k.flatShading=!Y.smooth,k.vertexColors=V,a.materials[$]=k),q.push(k)}if(q.length>1){for(X=0,Z=U.length;X<Z;X++){Y=U[X];H.addGroup(Y.groupStart,Y.groupCount,X)}W=j?new r.LineSegments(H,q):G?new r.Points(H,q):new r.Mesh(H,q)}else W=j?new r.LineSegments(H,q[0]):G?new r.Points(H,q[0]):new r.Mesh(H,q[0]);W.name=z.name,F.add(W)}}return F}}),h}(),e.exports=r.OBJLoader},{"../../three.js":23}],19:[function(t,e,n){const r=t("../utils/utils.js"),i=(t("../utils/material.js"),t("../three.js")),a=t("../animation/AnimationManager.js"),s=t("./CSS2DRenderer.js");function l(){}l.prototype={line:function(t){t=r._validate(t,this._defaults.line);var e=r.lnglatsToWorld(t.geometry),n=r.normalizeVertices(e),o=r.flattenVectors(n.vertices),a=new Float32Array(o),s=new i.BufferGeometry;s.setAttribute("position",new i.BufferAttribute(a,3));var l=new i.LineBasicMaterial({color:16711680,linewidth:21}),c=new i.Line(s,l);return c.options=options||{},c.position.copy(n.position),c},extrusion:function(t){},unenroll:function(t,e){var n=this;e||n.animationManager.unenroll(t)},_addMethods:function(t,e){var n=this;const o="label",a="tooltip",c="help",u="shadowPlane";if(e);else{function h(t,e,n,i){let o=r.radify(i);t.position.sub(e),t.position.applyAxisAngle(n,o),t.position.add(e),t.rotateOnAxis(n,o),tb.map.repaint=!0}t.coordinates||(t.coordinates=[0,0,0]),Object.defineProperty(t,"model",{get(){return t.getObjectByName("model")}}),Object.defineProperty(t,"animations",{get(){const e=t.model;return e?e.animations:null}}),n.animationManager.enroll(t),t.setCoords=function(e){return t.userData.topMargin&&t.userData.feature&&(e[2]+=((t.userData.feature.properties.height||0)-(t.userData.feature.properties.base_height||t.userData.feature.properties.min_height||0))*(t.userData.topMargin||0)),t.coordinates=e,t.set({position:e}),t},t.setTranslate=function(e){return t.set({translate:e}),t},t.setRotation=function(e){"number"===typeof e&&(e={z:e});var n={x:r.radify(e.x)||t.rotation.x,y:r.radify(e.y)||t.rotation.y,z:r.radify(e.z)||t.rotation.z};t._setObject({rotation:[n.x,n.y,n.z]})},t.calculateAdjustedPosition=function(e,n,i){let o=e.slice(),a=r.unprojectFromWorld(t.modelSize);return i?(o[0]-=0!=n.x?a[0]/n.x:0,o[1]-=0!=n.y?a[1]/n.y:0,o[2]-=0!=n.z?a[2]/n.z:0):(o[0]+=0!=n.x?a[0]/n.x:0,o[1]+=0!=n.y?a[1]/n.y:0,o[2]+=0!=n.z?a[2]/n.z:0),o},t.setRotationAxis=function(e){"number"===typeof e&&(e={z:e});let n=t.modelBox(),r=new i.Vector3(n.max.x,n.max.y,n.min.z);0!=e.x&&h(t,r,new i.Vector3(0,0,1),e.x),0!=e.y&&h(t,r,new i.Vector3(0,0,1),e.y),0!=e.z&&h(t,r,new i.Vector3(0,0,1),e.z)},Object.defineProperty(t,"scaleGroup",{get(){return t.getObjectByName("scaleGroup")}}),Object.defineProperty(t,"boxGroup",{get(){return t.getObjectByName("boxGroup")}}),Object.defineProperty(t,"boundingBox",{get(){return t.getObjectByName("boxModel")}}),Object.defineProperty(t,"boundingBoxShadow",{get(){return t.getObjectByName("boxShadow")}}),t.drawBoundingBox=function(){let e=t.box3(),n=new i.Group;n.name="boxGroup",n.updateMatrixWorld(!0);let r=new i.Box3Helper(e,l.prototype._defaults.colors.yellow);r.name="boxModel",n.add(r),r.layers.disable(0);let o=e.clone();o.max.z=o.min.z;let a=new i.Box3Helper(o,l.prototype._defaults.colors.black);a.name="boxShadow",n.add(a),a.layers.disable(0),n.visible=!1,t.scaleGroup.add(n),t.setBoundingBoxShadowFloor()},t.setBoundingBoxShadowFloor=function(){if(t.boundingBoxShadow){let e=-t.modelHeight,n=t.rotation,r=t.boundingBoxShadow;r.box.max.z=r.box.min.z=e,r.rotation.y=n.y,r.rotation.x=-n.x}},t.setAnchor=function(e){const n=t.box3(),r=n.getCenter(new i.Vector3);switch(t.none={x:0,y:0,z:0},t.center={x:r.x,y:r.y,z:n.min.z},t.bottom={x:r.x,y:n.max.y,z:n.min.z},t.bottomLeft={x:n.max.x,y:n.max.y,z:n.min.z},t.bottomRight={x:n.min.x,y:n.max.y,z:n.min.z},t.top={x:r.x,y:n.min.y,z:n.min.z},t.topLeft={x:n.max.x,y:n.min.y,z:n.min.z},t.topRight={x:n.min.x,y:n.min.y,z:n.min.z},t.left={x:n.max.x,y:r.y,z:n.min.z},t.right={x:n.min.x,y:r.y,z:n.min.z},e){case"center":t.anchor=t.center;break;case"top":t.anchor=t.top;break;case"top-left":t.anchor=t.topLeft;break;case"top-right":t.anchor=t.topRight;break;case"left":t.anchor=t.left;break;case"right":t.anchor=t.right;break;case"bottom":t.anchor=t.bottom;break;case"bottom-left":default:t.anchor=t.bottomLeft;break;case"bottom-right":t.anchor=t.bottomRight;break;case"auto":case"none":t.anchor=t.none}t.model.position.set(-t.anchor.x,-t.anchor.y,-t.anchor.z)},t.setCenter=function(e){if(e&&(0!=e.x||0!=e.y||0!=e.z)){let n=t.getSize();t.anchor={x:t.anchor.x-n.x*e.x,y:t.anchor.y-n.y*e.y,z:t.anchor.z-n.z*e.z},t.model.position.set(-t.anchor.x,-t.anchor.y,-t.anchor.z)}},Object.defineProperty(t,"label",{get(){return t.getObjectByName(o)}}),Object.defineProperty(t,"tooltip",{get(){return t.getObjectByName(a)}}),Object.defineProperty(t,"help",{get(){return t.getObjectByName(c)}}),Object.defineProperty(t,"visibility",{get(){return t.visible},set(e){let n=e;if("visible"==e||1==e)n=!0,t.label&&(t.label.visible=n);else{if("none"!=e&&0!=e)return;n=!1,t.label&&t.label.alwaysVisible&&(t.label.visible=n),t.tooltip&&(t.tooltip.visible=n)}t.visible!=n&&(t.visible=n,t.model&&t.model.traverse((function(e){"Mesh"!=e.type&&"SkinnedMesh"!=e.type||(n&&t.raycasted?e.layers.enable(0):e.layers.disable(0)),"LineSegments"==e.type&&e.layers.disableAll()})))}}),t.addLabel=function(e,n,r,i){e&&t.drawLabelHTML(e,n,r,i)},t.removeLabel=function(){t.removeCSS2D(o)},t.drawLabelHTML=function(e,r=!1,i=t.anchor,a=.5){let s=n.drawLabelHTML(e,l.prototype._defaults.label.cssClass),c=t.addCSS2D(s,o,i,a);return c.alwaysVisible=r,c.visible=r,c},t.addTooltip=function(e,n,r,i=!0,o=1){let s=t.addHelp(e,a,n,r,o);s.visible=!1,s.custom=i},t.removeTooltip=function(){t.removeCSS2D(a)},t.addHelp=function(e,r=c,i=!1,o=t.anchor,a=0){let s=n.drawTooltip(e,i),l=t.addCSS2D(s,r,o,a);return l.visible=!0,l},t.removeHelp=function(){t.removeCSS2D(c)},t.addCSS2D=function(e,n,r=t.anchor,o=1){if(e){const a=t.box3(),l=a.getSize(new i.Vector3);let c={x:a.max.x,y:a.max.y,z:a.min.z};t.removeCSS2D(n);let u=new s.CSS2DObject(e);return u.name=n,u.position.set(.5*-l.x-t.model.position.x-r.x+c.x,.5*-l.y-t.model.position.y-r.y+c.y,l.z*o),u.visible=!1,t.scaleGroup.add(u),u}},t.removeCSS2D=function(e){let n=t.getObjectByName(e);if(n){n.dispose();let e=t.scaleGroup.children;e.splice(e.indexOf(n),1)}},Object.defineProperty(t,"shadowPlane",{get(){return t.getObjectByName(u)}});let e=!1;Object.defineProperty(t,"castShadow",{get(){return e},set(n){if(t.model&&e!==n){if(t.model.traverse((function(t){t.isMesh&&(t.castShadow=!0)})),n){const e=t.modelSize,r=[e.x,e.y,e.z,t.modelHeight],o=10*Math.max(...r),a=new i.PlaneBufferGeometry(o,o),s=new i.ShadowMaterial;s.opacity=.5;let l=new i.Mesh(a,s);l.name=u,l.layers.enable(1),l.layers.disable(0),l.receiveShadow=n,t.add(l)}else t.traverse((function(e){e.isMesh&&e.material instanceof i.ShadowMaterial&&t.remove(e)}));e=n}}}),t.setReceiveShadowFloor=function(){if(t.castShadow){let e=t.shadowPlane,n=e.position,r=e.rotation;if(n.z=-t.modelHeight,r.y=t.rotation.y,r.x=-t.rotation.x,"meters"===t.userData.units){const r=t.modelSize,i=[r.x,r.y,r.z,-n.z],o=10*Math.max(...i),a=o/e.geometry.parameters.width;e.scale.set(a,a,a)}}};let d=!1;Object.defineProperty(t,"receiveShadow",{get(){return d},set(e){t.model&&d!==e&&(t.model.traverse((function(t){t.isMesh&&(t.receiveShadow=!0)})),d=e)}});let f=!1;Object.defineProperty(t,"wireframe",{get(){return f},set(e){t.model&&f!==e&&(t.model.traverse((function(t){if("Mesh"==t.type||"SkinnedMesh"==t.type){let n=[];if(Array.isArray(t.material)?n=t.material:n.push(t.material),e)t.userData.materials=n,t.material=l.prototype._defaults.materials.wireframeMaterial,t.material.opacity=e?.5:1,t.material.wireframe=e,t.material.transparent=e;else{let e=t.userData.materials;t.material=e.length>1?e:e[0],t.userData.materials=null}e?(t.layers.disable(0),t.layers.enable(1)):(t.layers.disable(1),t.layers.enable(0))}"LineSegments"==t.type&&t.layers.disableAll()})),f=e,t.dispatchEvent(new CustomEvent("Wireframed",{detail:t,bubbles:!0,cancelable:!0})))}});let m=!1;Object.defineProperty(t,"selected",{get(){return m},set(e){e?(t.userData.bbox&&!t.boundingBox&&t.drawBoundingBox(),t.boxGroup&&(t.boundingBox.material=l.prototype._defaults.materials.boxSelectedMaterial,t.boundingBox.parent.visible=!0,t.boundingBox.layers.enable(1),t.boundingBoxShadow.layers.enable(1)),t.label&&!t.label.alwaysVisible&&(t.label.visible=!0)):(t.boxGroup&&t.remove(t.boxGroup),t.label&&!t.label.alwaysVisible&&(t.label.visible=!1),t.removeHelp()),t.tooltip&&(t.tooltip.visible=e),m!=e&&(m=e,t.dispatchEvent(new CustomEvent("SelectedChange",{detail:t,bubbles:!0,cancelable:!0})))}});let g=!0;Object.defineProperty(t,"raycasted",{get(){return g},set(e){t.model&&g!==e&&(t.model.traverse((function(t){"Mesh"!=t.type&&"SkinnedMesh"!=t.type||(e?(t.layers.disable(1),t.layers.enable(0)):(t.layers.disable(0),t.layers.enable(1)))})),g=e)}});let y=!1;Object.defineProperty(t,"over",{get(){return y},set(e){e?(t.selected||(t.userData.bbox&&!t.boundingBox&&t.drawBoundingBox(),t.userData.tooltip&&!t.tooltip&&t.addTooltip(t.uuid,!0,t.anchor,!1),t.boxGroup&&(t.boundingBox.material=l.prototype._defaults.materials.boxOverMaterial,t.boundingBox.parent.visible=!0,t.boundingBox.layers.enable(1),t.boundingBoxShadow.layers.enable(1))),t.label&&!t.label.alwaysVisible&&(t.label.visible=!0),t.dispatchEvent(new CustomEvent("ObjectMouseOver",{detail:t,bubbles:!0,cancelable:!0}))):(t.selected||(t.boxGroup&&(t.remove(t.boxGroup),t.tooltip&&!t.tooltip.custom&&t.removeTooltip()),t.label&&!t.label.alwaysVisible&&(t.label.visible=!1)),t.dispatchEvent(new CustomEvent("ObjectMouseOut",{detail:t,bubbles:!0,cancelable:!0}))),t.tooltip&&(t.tooltip.visible=e||t.selected),y=e}}),t.box3=function(){let e;if(t.updateMatrix(),t.updateMatrixWorld(!0,!0),t.model){let n=t.clone(!0),r=t.model.clone();if(e=(new i.Box3).setFromObject(r),t.parent){let o=new i.Matrix4,a=new i.Matrix4;t.matrix.extractRotation(o),o.getInverse(a),n.setRotationFromMatrix(a),e=(new i.Box3).setFromObject(r)}}return e},t.modelBox=function(){return t.box3()},t.getSize=function(){return t.box3().getSize(new i.Vector3(0,0,0))};let v=!1;Object.defineProperty(t,"modelSize",{get(){return v=t.getSize(),v},set(t){v!=t&&(v=t)}}),Object.defineProperty(t,"modelHeight",{get(){let e=t.coordinates[2]||0;return"scene"===t.userData.units&&(e*=t.unitsPerMeter/t.scale.x),e}}),Object.defineProperty(t,"unitsPerMeter",{get(){return Number(r.projectedUnitsPerMeter(t.coordinates[1]).toFixed(7))}});function p(t){return Math.pow(2,t)}Object.defineProperty(t,"fixedZoom",{get(){return t.userData.fixedZoom},set(e){t.userData.fixedZoom!==e&&(t.userData.fixedZoom=e,t.userData.units=e?"scene":"meters")}}),t.setFixedZoom=function(e){if(null!=t.fixedZoom){e||(e=t.userData.mapScale);let n=p(t.fixedZoom);if(n>e){let r=n/e;t.scale.set(r,r,r)}else t.scale.set(1,1,1)}},t.setScale=function(e){if("meters"!==t.userData.units||t.fixedZoom)t.fixedZoom?(e&&(t.userData.mapScale=e),t.setFixedZoom(t.userData.mapScale)):t.scale.set(1,1,1);else{let e=t.unitsPerMeter;t.scale.set(e,e,e)}},t.setObjectScale=function(e){t.setScale(e),t.setBoundingBoxShadowFloor(),t.setReceiveShadowFloor()}}t.add=function(e){return t.scaleGroup.add(e),e.position.z=t.coordinates[2]?-t.coordinates[2]:0,e},t.remove=function(e){e&&(e.traverse(t=>{if(t.geometry&&t.geometry.dispose(),t.material)if(t.material.isMaterial)d(t.material);else for(const e of t.material)d(e);t.dispose&&t.dispose()}),t.scaleGroup.remove(e),tb.map.repaint=!0)},t.duplicate=function(e){let i=t.clone(!0);if(i.getObjectByName("model").animations=t.animations,i.userData.feature&&(e&&e.feature&&(i.userData.feature=e.feature),i.userData.feature.properties.uuid=i.uuid),n._addMethods(i),!e||r.equal(e.scale,t.userData.scale))return i.copyAnchor(t),i;{i.userData=e,i.userData.isGeoGroup=!0,i.remove(i.boxGroup);const t=r.types.rotation(e.rotation,[0,0,0]),n=r.types.scale(e.scale,[1,1,1]);return i.model.position.set(0,0,0),i.model.rotation.set(t[0],t[1],t[2]),i.model.scale.set(n[0],n[1],n[2]),i.setAnchor(e.anchor),i.setCenter(e.adjustment),i}},t.copyAnchor=function(e){t.anchor=e.anchor,t.none={x:0,y:0,z:0},t.center=e.center,t.bottom=e.bottom,t.bottomLeft=e.bottomLeft,t.bottomRight=e.bottomRight,t.top=e.top,t.topLeft=e.topLeft,t.topRight=e.topRight,t.left=e.left,t.right=e.right},t.dispose=function(){l.prototype.unenroll(t),t.traverse(t=>{if((!t.parent||"world"!=t.parent.name)&&"threeboxObject"!==t.name){if(t.geometry&&t.geometry.dispose(),t.material)if(t.material.isMaterial)d(t.material);else for(const e of t.material)d(e);t.dispose&&t.dispose()}}),t.children=[]};const d=t=>{t.dispose();for(const r of Object.keys(t)){const e=t[r];e&&"object"===typeof e&&"minFilter"in e&&e.dispose()}let e=t,n=e.map||e.alphaMap||e.aoMap||e.bumpMap||e.displacementMap||e.emissiveMap||e.envMap||e.lightMap||e.metalnessMap||e.normalMap||e.roughnessMap;n&&(e.map&&e.map.dispose(),e.alphaMap&&e.alphaMap.dispose(),e.aoMap&&e.aoMap.dispose(),e.bumpMap&&e.bumpMap.dispose(),e.displacementMap&&e.displacementMap.dispose(),e.emissiveMap&&e.emissiveMap.dispose(),e.envMap&&e.envMap.dispose(),e.lightMap&&e.lightMap.dispose(),e.metalnessMap&&e.metalnessMap.dispose(),e.normalMap&&e.normalMap.dispose(),e.roughnessMap&&e.roughnessMap.dispose())};return t},_makeGroup:function(t,e){let n=new i.Group;n.name="scaleGroup",n.add(t);var r=new i.Group;r.userData=e||{},r.userData.isGeoGroup=!0,r.userData.feature&&(r.userData.feature.properties.uuid=r.uuid);var a=n.length;if(a)for(o of n)r.add(o);else r.add(n);return r.name="threeboxObject",r},animationManager:new a,drawTooltip:function(t,e=!1){if(t){let n;if(e){let e=document.createElement("div");e.className="mapboxgl-popup-content";let r=document.createElement("strong");r.innerHTML=t,e.appendChild(r);let i=document.createElement("div");i.className="mapboxgl-popup-tip";let o=document.createElement("div");o.className="marker mapboxgl-popup-anchor-bottom",o.appendChild(i),o.appendChild(e),n=document.createElement("div"),n.className+="label3D",n.appendChild(o)}else n=document.createElement("span"),n.className=this._defaults.tooltip.cssClass,n.innerHTML=t;return n}},drawLabelHTML:function(t,e){let n=document.createElement("div");return n.className+=e,n.innerHTML="string"==typeof t?t:t.outerHTML,n},_defaults:{colors:{red:new i.Color(16711680),yellow:new i.Color(16776960),green:new i.Color(65280),black:new i.Color(0)},materials:{wireframeMaterial:new i.LineBasicMaterial({color:new i.Color(16777215)}),boxNormalMaterial:new i.LineBasicMaterial({color:new i.Color(16711680)}),boxOverMaterial:new i.LineBasicMaterial({color:new i.Color(16776960)}),boxSelectedMaterial:new i.LineBasicMaterial({color:new i.Color(65280)})},line:{geometry:null,color:"black",width:1,opacity:1},label:{htmlElement:null,cssClass:" label3D",alwaysVisible:!1,topMargin:-.5},tooltip:{text:"",cssClass:"toolTip text-xs",mapboxStyle:!1,topMargin:0,feature:null},sphere:{position:[0,0,0],radius:1,sides:20,units:"scene",material:"MeshBasicMaterial",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},tube:{geometry:null,radius:1,sides:6,units:"scene",material:"MeshBasicMaterial",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0},loadObj:{type:null,obj:null,units:"scene",scale:1,rotation:0,defaultAnimation:0,anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},Object3D:{obj:null,units:"scene",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},extrusion:{coordinates:[[[]]],geometryOptions:{},height:100,materials:null,scale:1,rotation:0,units:"scene",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0}},geometries:{line:["LineString"],tube:["LineString"],sphere:["Point"]}},e.exports=l},{"../animation/AnimationManager.js":3,"../three.js":23,"../utils/material.js":25,"../utils/utils.js":27,"./CSS2DRenderer.js":5}],20:[function(t,e,n){const r=t("../utils/utils.js"),i=t("../utils/material.js"),o=t("./objects.js"),a=t("./Object3D.js");function s(t){t=r._validate(t,o.prototype._defaults.sphere);let e=new THREE.SphereBufferGeometry(t.radius,t.sides,t.sides),n=i(t),s=new THREE.Mesh(e,n);return new a({obj:s,units:t.units,anchor:t.anchor,adjustment:t.adjustment,bbox:t.bbox,tooltip:t.tooltip,raycasted:t.raycasted})}e.exports=s},{"../utils/material.js":25,"../utils/utils.js":27,"./Object3D.js":7,"./objects.js":19}],21:[function(t,e,n){const r=t("../utils/utils.js"),i=t("./objects.js"),o=t("./CSS2DRenderer.js");t("../three.js");function a(t){if(t=r._validate(t,i.prototype._defaults.tooltip),t.text){let n=i.prototype.drawTooltip(t.text,t.mapboxStyle),r=new o.CSS2DObject(n);r.visible=!1,r.name="tooltip";var e=i.prototype._makeGroup(r,t);return i.prototype._addMethods(e),e}}e.exports=a},{"../three.js":23,"../utils/utils.js":27,"./CSS2DRenderer.js":5,"./objects.js":19}],22:[function(t,e,n){const r=t("../utils/utils.js"),o=t("../utils/material.js"),a=t("./objects.js"),s=t("../three.js"),l=t("./Object3D.js");function c(t,e){t=r._validate(t,a.prototype._defaults.tube);let n=r.lnglatsToWorld(t.geometry),i=r.normalizeVertices(n),u=c.prototype.defineCrossSection(t),h=c.prototype.buildVertices(u,i.vertices,e),p=c.prototype.buildFaces(h,i.vertices,t),d=o(t),f=new s.Mesh(p,d);return new l({obj:f,units:t.units,anchor:t.anchor,adjustment:t.adjustment,bbox:t.bbox,tooltip:t.tooltip,raycasted:t.raycasted})}c.prototype={buildVertices:function(t,e,n){var r=new s.PlaneBufferGeometry(99999999999,9999999999),o=new s.MeshBasicMaterial({color:16777215,side:s.DoubleSide});o.opacity=0;var a=new s.Mesh(r,o),l=new s.Geometry,c=!1,u=[e[0].clone().normalize()];for(i in e){var h;i=parseFloat(i),e[i+1]&&(h=(new s.Vector3).subVectors(e[i+1],e[i]).normalize()),u.push(h)}for(i in u.push(new s.Vector3),e){i=parseFloat(i);var p=e[i],d=u[i],f=u[i+1],m=d.clone().add(f).normalize();if(0===i?m=f:i===e.length-1&&(m=d),c){let t=[];a.position.copy(p),a.lookAt(m.clone().add(p)),a.updateMatrixWorld(),c.forEach((function(e){let n=new s.Raycaster(e,d),r=n.intersectObject(a)[0];r?(l.vertices.push(r.point),t.push(r.point)):console.error("Tube geometry failed at vertex "+i+". Consider reducing tube radius, or smoothening out the sharp angle at this vertex")})),c=t}else{let e=t.clone();e.lookAt(m),e.vertices.forEach((function(t){l.vertices.push(t.add(p))})),c=e.vertices}}return n.remove(a),l},defineCrossSection:function(t){let e=new s.Geometry,n=t.sides;for(let r=0;r<n;r++){let i=t.radius,o=(r+.5)/n*Math.PI;e.vertices.push(new s.Vector3(-Math.sin(2*o),Math.cos(2*o),0).multiplyScalar(i))}return e},buildFaces:function(t,e,n){for(let i in e){i=parseFloat(i);e[i];if(i<e.length-1)for(let e=0;e<n.sides;e++){let r=i*n.sides+e,o=i*n.sides+(e+1)%n.sides,a=r+n.sides,l=o+n.sides,c=new s.Face3(a,r,o),u=new s.Face3(a,o,l);t.faces.push(c,u)}}let r=t.vertices.length;for(let i=0;i+2<n.sides;i++){let e=new s.Face3(0,i+2,i+1),n=new s.Face3(r-1,r-1-(i+2),r-1-(i+1));t.faces.push(e,n)}t.computeFaceNormals();(new s.BufferGeometry).fromGeometry(t);return t}},e.exports=c},{"../three.js":23,"../utils/material.js":25,"../utils/utils.js":27,"./Object3D.js":7,"./objects.js":19}],23:[function(t,e,n){(function(t,r){"object"===typeof n&&"undefined"!==typeof e?r(n):(s=[n],a=r,l="function"===typeof a?a.apply(n,s):a,void 0===l||(e.exports=l))})(0,(function(t){function e(){}function n(t,e){this.x=t||0,this.y=e||0}function r(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function i(t,e,o,a,s,l,c,u,h,p){Object.defineProperty(this,"id",{value:qo++}),this.uuid=Vo.generateUUID(),this.name="",this.image=void 0!==t?t:i.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:i.DEFAULT_MAPPING,this.wrapS=void 0!==o?o:1001,this.wrapT=void 0!==a?a:1001,this.magFilter=void 0!==s?s:1006,this.minFilter=void 0!==l?l:1008,this.anisotropy=void 0!==h?h:1,this.format=void 0!==c?c:1023,this.internalFormat=null,this.type=void 0!==u?u:1009,this.offset=new n(0,0),this.repeat=new n(1,1),this.center=new n(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new r,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==p?p:3e3,this.version=0,this.onUpdate=null}function o(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==r?r:1}function a(t,e,n){this.width=t,this.height=e,this.scissor=new o(0,0,t,e),this.scissorTest=!1,this.viewport=new o(0,0,t,e),n=n||{},this.texture=new i(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function s(t,e,n){a.call(this,t,e,n),this.samples=4}function l(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1}function c(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}function u(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function h(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||h.DefaultOrder}function p(){this.mask=1}function d(){Object.defineProperty(this,"id",{value:ia++}),this.uuid=Vo.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=d.DefaultUp.clone();var t=new c,e=new h,n=new l,i=new c(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new u},normalMatrix:{value:new r}}),this.matrix=new u,this.matrixWorld=new u,this.matrixAutoUpdate=d.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new p,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function f(){d.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.environment=this.background=null,this.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function m(t,e){this.min=void 0!==t?t:new c(1/0,1/0,1/0),this.max=void 0!==e?e:new c(-1/0,-1/0,-1/0)}function g(t,e,n,r,i){var o,a=0;for(o=t.length-3;a<=o;a+=3){La.fromArray(t,a);var s=i.x*Math.abs(La.x)+i.y*Math.abs(La.y)+i.z*Math.abs(La.z),l=e.dot(La),c=n.dot(La),u=r.dot(La);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}function y(t,e){this.center=void 0!==t?t:new c,this.radius=void 0!==e?e:-1}function v(t,e){this.origin=void 0!==t?t:new c,this.direction=void 0!==e?e:new c(0,0,-1)}function _(t,e){this.normal=void 0!==t?t:new c(1,0,0),this.constant=void 0!==e?e:0}function x(t,e,n){this.a=void 0!==t?t:new c,this.b=void 0!==e?e:new c,this.c=void 0!==n?n:new c}function b(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function w(t,e,n){return 0>n&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:.5>n?e:n<2/3?t+6*(e-t)*(2/3-n):t}function M(t){return.04045>t?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function E(t){return.0031308>t?12.92*t:1.055*Math.pow(t,.41666)-.055}function S(t,e,n,r,i,o){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new c,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new b,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}function T(){Object.defineProperty(this,"id",{value:ts++}),this.uuid=Vo.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=this.flatShading=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilZPass=this.stencilZFail=this.stencilFail=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.toneMapped=this.visible=!0,this.userData={},this.version=0}function A(t){T.call(this),this.type="MeshBasicMaterial",this.color=new b(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphTargets=this.skinning=!1,this.setValues(t)}function C(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function L(t,e,n){C.call(this,new Int8Array(t),e,n)}function I(t,e,n){C.call(this,new Uint8Array(t),e,n)}function P(t,e,n){C.call(this,new Uint8ClampedArray(t),e,n)}function R(t,e,n){C.call(this,new Int16Array(t),e,n)}function O(t,e,n){C.call(this,new Uint16Array(t),e,n)}function D(t,e,n){C.call(this,new Int32Array(t),e,n)}function N(t,e,n){C.call(this,new Uint32Array(t),e,n)}function k(t,e,n){C.call(this,new Float32Array(t),e,n)}function F(t,e,n){C.call(this,new Float64Array(t),e,n)}function z(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function B(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}function U(){Object.defineProperty(this,"id",{value:ns+=2}),this.uuid=Vo.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function j(t,e){d.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new U,this.material=void 0!==e?e:new A,this.updateMorphTargets()}function G(t,e,n,r,i,o,a,s){return null===(1===e.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,2!==e.side,s))?null:(Ss.copy(s),Ss.applyMatrix4(t.matrixWorld),e=n.ray.origin.distanceTo(Ss),e<n.near||e>n.far?null:{distance:e,point:Ss.clone(),object:t})}function V(t,e,r,i,o,a,s,l,c,u,h,p){if(ps.fromBufferAttribute(o,u),ds.fromBufferAttribute(o,h),fs.fromBufferAttribute(o,p),o=t.morphTargetInfluences,e.morphTargets&&a&&o){vs.set(0,0,0),_s.set(0,0,0),xs.set(0,0,0);for(var d=0,f=a.length;d<f;d++){var m=o[d],g=a[d];0!==m&&(ms.fromBufferAttribute(g,u),gs.fromBufferAttribute(g,h),ys.fromBufferAttribute(g,p),s?(vs.addScaledVector(ms,m),_s.addScaledVector(gs,m),xs.addScaledVector(ys,m)):(vs.addScaledVector(ms.sub(ps),m),_s.addScaledVector(gs.sub(ds),m),xs.addScaledVector(ys.sub(fs),m)))}ps.add(vs),ds.add(_s),fs.add(xs)}return t.isSkinnedMesh&&(t.boneTransform(u,ps),t.boneTransform(h,ds),t.boneTransform(p,fs)),(t=G(t,e,r,i,ps,ds,fs,Es))&&(l&&(bs.fromBufferAttribute(l,u),ws.fromBufferAttribute(l,h),Ms.fromBufferAttribute(l,p),t.uv=x.getUV(Es,ps,ds,fs,bs,ws,Ms,new n)),c&&(bs.fromBufferAttribute(c,u),ws.fromBufferAttribute(c,h),Ms.fromBufferAttribute(c,p),t.uv2=x.getUV(Es,ps,ds,fs,bs,ws,Ms,new n)),l=new S(u,h,p),x.getNormal(ps,ds,fs,l.normal),t.face=l),t}function H(){Object.defineProperty(this,"id",{value:Ts+=2}),this.uuid=Vo.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function W(t){var e,n={};for(e in t)for(var r in n[e]={},t[e]){var i=t[e][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?n[e][r]=i.clone():Array.isArray(i)?n[e][r]=i.slice():n[e][r]=i}return n}function q(t){for(var e={},n=0;n<t.length;n++){var r,i=W(t[n]);for(r in i)e[r]=i[r]}return e}function X(t){T.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Z(){d.call(this),this.type="Camera",this.matrixWorldInverse=new u,this.projectionMatrix=new u,this.projectionMatrixInverse=new u}function Y(t,e,n,r){Z.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function $(t,e,n){if(d.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");else{this.renderTarget=n;var r=new Y(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new c(1,0,0)),this.add(r);var i=new Y(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new c(-1,0,0)),this.add(i);var o=new Y(90,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new c(0,1,0)),this.add(o);var a=new Y(90,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new c(0,-1,0)),this.add(a);var s=new Y(90,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new c(0,0,1)),this.add(s);var l=new Y(90,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new c(0,0,-1)),this.add(l),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,i),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,a),t.setRenderTarget(n,4),t.render(e,s),n.texture.generateMipmaps=h,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c},this.clear=function(t,e,r,i){for(var o=t.getRenderTarget(),a=0;6>a;a++)t.setRenderTarget(n,a),t.clear(e,r,i);t.setRenderTarget(o)}}}function J(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),a.call(this,t,t,e)}function K(t,e,n,r,o,a,s,l,c,u,h,p){i.call(this,null,a,s,l,c,u,r,o,h,p),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=void 0!==c?c:1003,this.minFilter=void 0!==u?u:1003,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1,this.needsUpdate=!0}function Q(t,e,n,r,i,o){this.planes=[void 0!==t?t:new _,void 0!==e?e:new _,void 0!==n?n:new _,void 0!==r?r:new _,void 0!==i?i:new _,void 0!==o?o:new _]}function tt(){function t(i,o){!1!==n&&(r(i,o),e.requestAnimationFrame(t))}var e=null,n=!1,r=null;return{start:function(){!0!==n&&null!==r&&(e.requestAnimationFrame(t),n=!0)},stop:function(){n=!1},setAnimationLoop:function(t){r=t},setContext:function(t){e=t}}}function et(t,e){function n(e,n){var r=e.array,i=e.usage,o=t.createBuffer();return t.bindBuffer(n,o),t.bufferData(n,r,i),e.onUploadCallback(),n=5126,r instanceof Float32Array?n=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?n=5123:r instanceof Int16Array?n=5122:r instanceof Uint32Array?n=5125:r instanceof Int32Array?n=5124:r instanceof Int8Array?n=5120:r instanceof Uint8Array&&(n=5121),{buffer:o,type:n,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}var r=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,o){e.isInterleavedBufferAttribute&&(e=e.data);var a=i.get(e);if(void 0===a)i.set(e,n(e,o));else if(a.version<e.version){var s=e.array,l=e.updateRange;t.bindBuffer(o,a.buffer),-1===l.count?t.bufferSubData(o,0,s):(r?t.bufferSubData(o,l.offset*s.BYTES_PER_ELEMENT,s,l.offset,l.count):t.bufferSubData(o,l.offset*s.BYTES_PER_ELEMENT,s.subarray(l.offset,l.offset+l.count)),l.count=-1),a.version=e.version}}}}function nt(t,e,n,r){H.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new rt(t,e,n,r)),this.mergeVertices()}function rt(t,e,n,r){U.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},t=t||1,e=e||1;var i=t/2,o=e/2;n=Math.floor(n)||1,r=Math.floor(r)||1;var a=n+1,s=r+1,l=t/n,c=e/r,u=[],h=[],p=[],d=[];for(t=0;t<s;t++){var f=t*c-o;for(e=0;e<a;e++)h.push(e*l-i,-f,0),p.push(0,0,1),d.push(e/n),d.push(1-t/r)}for(t=0;t<r;t++)for(e=0;e<n;e++)i=e+a*(t+1),o=e+1+a*(t+1),s=e+1+a*t,u.push(e+a*t,i,s),u.push(i,o,s);this.setIndex(u),this.setAttribute("position",new k(h,3)),this.setAttribute("normal",new k(p,3)),this.setAttribute("uv",new k(d,2))}function it(t,e,n,r){function i(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,r)}var o,a,s=new b(0),l=0,c=null,u=0,h=null;return{getClearColor:function(){return s},setClearColor:function(t,e){s.set(t),l=void 0!==e?e:1,i(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(t){l=t,i(s,l)},render:function(e,r,p,d){r=r.background,p=t.xr,(p=p.getSession&&p.getSession())&&"additive"===p.environmentBlendMode&&(r=null),null===r?i(s,l):r&&r.isColor&&(i(r,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),r&&(r.isCubeTexture||r.isWebGLCubeRenderTarget||306===r.mapping)?(void 0===a&&(a=new j(new Ps(1,1,1),new X({type:"BackgroundCubeMaterial",uniforms:W(Fs.cube.uniforms),vertexShader:Fs.cube.vertexShader,fragmentShader:Fs.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),d=r.isWebGLCubeRenderTarget?r.texture:r,a.material.uniforms.envMap.value=d,a.material.uniforms.flipEnvMap.value=d.isCubeTexture?-1:1,c===r&&u===d.version&&h===t.toneMapping||(a.material.needsUpdate=!0,c=r,u=d.version,h=t.toneMapping),e.unshift(a,a.geometry,a.material,0,0,null)):r&&r.isTexture&&(void 0===o&&(o=new j(new rt(2,2),new X({type:"BackgroundMaterial",uniforms:W(Fs.background.uniforms),vertexShader:Fs.background.vertexShader,fragmentShader:Fs.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=r,!0===r.matrixAutoUpdate&&r.updateMatrix(),o.material.uniforms.uvTransform.value.copy(r.matrix),c===r&&u===r.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=r,u=r.version,h=t.toneMapping),e.unshift(o,o.geometry,o.material,0,0,null))}}}function ot(t,e,n,r){var i,o=r.isWebGL2;this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i)},this.renderInstances=function(r,a,s,l){if(0!==l){if(o){r=t;var c="drawArraysInstanced"}else if(r=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===r)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[c](i,a,s,l),n.update(s,i,l)}}}function at(t,e,n){function r(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var i,o="undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s),n=!0===n.logarithmicDepthBuffer,s=t.getParameter(34930);var l=t.getParameter(35660),c=t.getParameter(3379),u=t.getParameter(34076),h=t.getParameter(34921),p=t.getParameter(36347),d=t.getParameter(36348),f=t.getParameter(36349),m=0<l,g=o||!!e.get("OES_texture_float"),y=m&&g,v=o?t.getParameter(36183):0;return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;var n=e.get("EXT_texture_filter_anisotropic");return i=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:n,maxTextures:s,maxVertexTextures:l,maxTextureSize:c,maxCubemapSize:u,maxAttributes:h,maxVertexUniforms:p,maxVaryings:d,maxFragmentUniforms:f,vertexTextures:m,floatFragmentTextures:g,floatVertexTextures:y,maxSamples:v}}function st(){function t(){u.value!==i&&(u.value=i,u.needsUpdate=0<o),n.numPlanes=o,n.numIntersection=0}function e(t,e,r,i){var o=null!==t?t.length:0,a=null;if(0!==o){if(a=u.value,!0!==i||null===a)for(i=r+4*o,e=e.matrixWorldInverse,c.getNormalMatrix(e),(null===a||a.length<i)&&(a=new Float32Array(i)),i=0;i!==o;++i,r+=4)l.copy(t[i]).applyMatrix4(e,c),l.normal.toArray(a,r),a[r+3]=l.constant;u.value=a,u.needsUpdate=!0}return n.numPlanes=o,n.numIntersection=0,a}var n=this,i=null,o=0,a=!1,s=!1,l=new _,c=new r,u={value:null,needsUpdate:!1};this.uniform=u,this.numIntersection=this.numPlanes=0,this.init=function(t,n,r){var s=0!==t.length||n||0!==o||a;return a=n,i=e(t,r,0),o=t.length,s},this.beginShadows=function(){s=!0,e(null)},this.endShadows=function(){s=!1,t()},this.setState=function(n,r,l,c,h,p){if(!a||null===n||0===n.length||s&&!l)s?e(null):t();else{l=s?0:o;var d=4*l,f=h.clippingState||null;for(u.value=f,f=e(n,c,d,p),n=0;n!==d;++n)f[n]=i[n];h.clippingState=f,this.numIntersection=r?this.numPlanes:0,this.numPlanes+=l}}}function lt(t){var e={};return{get:function(n){if(void 0!==e[n])return e[n];switch(n){case"WEBGL_depth_texture":var r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=r}}}function ct(t,e,n){function r(t){var i=t.target;for(var s in t=o.get(i),null!==t.index&&e.remove(t.index),t.attributes)e.remove(t.attributes[s]);i.removeEventListener("dispose",r),o.delete(i),(s=a.get(t))&&(e.remove(s),a.delete(t)),n.memory.geometries--}function i(t){var n=[],r=t.index,i=t.attributes.position;if(null!==r){var o=r.array;r=r.version,i=0;for(var s=o.length;i<s;i+=3){var l=o[i+0],c=o[i+1],u=o[i+2];n.push(l,c,c,u,u,l)}}else for(o=i.array,r=i.version,i=0,s=o.length/3-1;i<s;i+=3)l=i+0,c=i+1,u=i+2,n.push(l,c,c,u,u,l);n=new(65535<B(n)?N:O)(n,1),n.version=r,e.update(n,34963),(o=a.get(t))&&e.remove(o),a.set(t,n)}var o=new WeakMap,a=new WeakMap;return{get:function(t,e){var i=o.get(e);return i||(e.addEventListener("dispose",r),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new U).setFromObject(t)),i=e._bufferGeometry),o.set(e,i),n.memory.geometries++,i)},update:function(t){var n=t.index,r=t.attributes;for(var i in null!==n&&e.update(n,34963),r)e.update(r[i],34962);for(i in t=t.morphAttributes,t){n=t[i],r=0;for(var o=n.length;r<o;r++)e.update(n[r],34962)}},getWireframeAttribute:function(t){var e=a.get(t);if(e){var n=t.index;null!==n&&e.version<n.version&&i(t)}else i(t);return a.get(t)}}}function ut(t,e,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(t){i=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(i,r,o,e*a),n.update(r,i)},this.renderInstances=function(r,l,c,u){if(0!==u){if(s){r=t;var h="drawElementsInstanced"}else if(r=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===r)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[h](i,c,o,l*a,u),n.update(c,i,u)}}}function ht(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(r=r||1,e.calls++,n){case 4:e.triangles+=t/3*r;break;case 1:e.lines+=t/2*r;break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function pt(t,e){return Math.abs(e[1])-Math.abs(t[1])}function dt(t){var e={},n=new Float32Array(8);return{update:function(r,i,o,a){var s=r.morphTargetInfluences,l=void 0===s?0:s.length;if(r=e[i.id],void 0===r){r=[];for(var c=0;c<l;c++)r[c]=[c,0];e[i.id]=r}var u=o.morphTargets&&i.morphAttributes.position;for(o=o.morphNormals&&i.morphAttributes.normal,c=0;c<l;c++){var h=r[c];0!==h[1]&&(u&&i.deleteAttribute("morphTarget"+c),o&&i.deleteAttribute("morphNormal"+c))}for(c=0;c<l;c++)h=r[c],h[0]=c,h[1]=s[c];for(r.sort(pt),c=s=0;8>c;c++)(h=r[c])&&(l=h[0],h=h[1])?(u&&i.setAttribute("morphTarget"+c,u[l]),o&&i.setAttribute("morphNormal"+c,o[l]),n[c]=h,s+=h):n[c]=0;i=i.morphTargetsRelative?1:1-s,a.getUniforms().setValue(t,"morphTargetBaseInfluence",i),a.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function ft(t,e,n,r){var i=new WeakMap;return{update:function(t){var o=r.render.frame,a=t.geometry,s=e.get(t,a);return i.get(s)!==o&&(a.isGeometry&&s.updateFromObject(t),e.update(s),i.set(s,o)),t.isInstancedMesh&&n.update(t.instanceMatrix,34962),s},dispose:function(){i=new WeakMap}}}function mt(t,e,n,r,o,a,s,l,c,u){t=void 0!==t?t:[],i.call(this,t,void 0!==e?e:301,n,r,o,a,void 0!==s?s:1022,l,c,u),this.flipY=!1}function gt(t,e,n,r){i.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1,this.needsUpdate=!0}function yt(t,e,n,r){i.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.minFilter=this.magFilter=1003,this.wrapR=1001,this.flipY=this.generateMipmaps=!1,this.needsUpdate=!0}function vt(t,e,n){var r=t[0];if(0>=r||0<r)return t;var i=e*n,o=Gs[i];if(void 0===o&&(o=new Float32Array(i),Gs[i]=o),0!==e)for(r.toArray(o,0),r=1,i=0;r!==e;++r)i+=n,t[r].toArray(o,i);return o}function _t(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function xt(t,e){for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}function bt(t,e){var n=Vs[e];void 0===n&&(n=new Int32Array(e),Vs[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function wt(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Mt(t,e){var n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y):_t(n,e)||(t.uniform2fv(this.addr,e),xt(n,e))}function Et(t,e){var n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z):void 0!==e.r?n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b):_t(n,e)||(t.uniform3fv(this.addr,e),xt(n,e))}function St(t,e){var n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w):_t(n,e)||(t.uniform4fv(this.addr,e),xt(n,e))}function Tt(t,e){var n=this.cache,r=e.elements;void 0===r?_t(n,e)||(t.uniformMatrix2fv(this.addr,!1,e),xt(n,e)):_t(n,r)||(qs.set(r),t.uniformMatrix2fv(this.addr,!1,qs),xt(n,r))}function At(t,e){var n=this.cache,r=e.elements;void 0===r?_t(n,e)||(t.uniformMatrix3fv(this.addr,!1,e),xt(n,e)):_t(n,r)||(Ws.set(r),t.uniformMatrix3fv(this.addr,!1,Ws),xt(n,r))}function Ct(t,e){var n=this.cache,r=e.elements;void 0===r?_t(n,e)||(t.uniformMatrix4fv(this.addr,!1,e),xt(n,e)):_t(n,r)||(Hs.set(r),t.uniformMatrix4fv(this.addr,!1,Hs),xt(n,r))}function Lt(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||zs,i)}function It(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Bs,i)}function Pt(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Us,i)}function Rt(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||js,i)}function Ot(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Dt(t,e){var n=this.cache;_t(n,e)||(t.uniform2iv(this.addr,e),xt(n,e))}function Nt(t,e){var n=this.cache;_t(n,e)||(t.uniform3iv(this.addr,e),xt(n,e))}function kt(t,e){var n=this.cache;_t(n,e)||(t.uniform4iv(this.addr,e),xt(n,e))}function Ft(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function zt(t){switch(t){case 5126:return wt;case 35664:return Mt;case 35665:return Et;case 35666:return St;case 35674:return Tt;case 35675:return At;case 35676:return Ct;case 5124:case 35670:return Ot;case 35667:case 35671:return Dt;case 35668:case 35672:return Nt;case 35669:case 35673:return kt;case 5125:return Ft;case 35678:case 36198:case 36298:case 36306:case 35682:return Lt;case 35679:case 36299:case 36307:return Pt;case 35680:case 36300:case 36308:case 36293:return Rt;case 36289:case 36303:case 36311:case 36292:return It}}function Bt(t,e){t.uniform1fv(this.addr,e)}function Ut(t,e){t.uniform1iv(this.addr,e)}function jt(t,e){t.uniform2iv(this.addr,e)}function Gt(t,e){t.uniform3iv(this.addr,e)}function Vt(t,e){t.uniform4iv(this.addr,e)}function Ht(t,e){e=vt(e,this.size,2),t.uniform2fv(this.addr,e)}function Wt(t,e){e=vt(e,this.size,3),t.uniform3fv(this.addr,e)}function qt(t,e){e=vt(e,this.size,4),t.uniform4fv(this.addr,e)}function Xt(t,e){e=vt(e,this.size,4),t.uniformMatrix2fv(this.addr,!1,e)}function Zt(t,e){e=vt(e,this.size,9),t.uniformMatrix3fv(this.addr,!1,e)}function Yt(t,e){e=vt(e,this.size,16),t.uniformMatrix4fv(this.addr,!1,e)}function $t(t,e,n){var r=e.length,i=bt(n,r);for(t.uniform1iv(this.addr,i),t=0;t!==r;++t)n.safeSetTexture2D(e[t]||zs,i[t])}function Jt(t,e,n){var r=e.length,i=bt(n,r);for(t.uniform1iv(this.addr,i),t=0;t!==r;++t)n.safeSetTextureCube(e[t]||js,i[t])}function Kt(t){switch(t){case 5126:return Bt;case 35664:return Ht;case 35665:return Wt;case 35666:return qt;case 35674:return Xt;case 35675:return Zt;case 35676:return Yt;case 5124:case 35670:return Ut;case 35667:case 35671:return jt;case 35668:case 35672:return Gt;case 35669:case 35673:return Vt;case 35678:case 36198:case 36298:case 36306:case 35682:return $t;case 35680:case 36300:case 36308:case 36293:return Jt}}function Qt(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=zt(e.type)}function te(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=Kt(e.type)}function ee(t){this.id=t,this.seq=[],this.map={}}function ne(t,e){this.seq=[],this.map={};for(var n=t.getProgramParameter(e,35718),r=0;r<n;++r){var i=t.getActiveUniform(e,r),o=t.getUniformLocation(e,i.name),a=this,s=i.name,l=s.length;for(Xs.lastIndex=0;;){var c=Xs.exec(s),u=Xs.lastIndex,h=c[1],p=c[3];if("]"===c[2]&&(h|=0),void 0===p||"["===p&&u+2===l){s=a,i=void 0===p?new Qt(h,i,o):new te(h,i,o),s.seq.push(i),s.map[i.id]=i;break}p=a.map[h],void 0===p&&(p=new ee(h),h=a,a=p,h.seq.push(a),h.map[a.id]=a),a=p}}}function re(t,e,n){return e=t.createShader(e),t.shaderSource(e,n),t.compileShader(e),e}function ie(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw Error("unsupported encoding: "+t)}}function oe(t,e,n){var r=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";for(t=t.getShaderSource(e).split("\n"),e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t=t.join("\n"),"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+t}function ae(t,e){return e=ie(e),"vec4 "+t+"( vec4 value ) { return "+e[0]+"ToLinear"+e[1]+"; }"}function se(t,e){return e=ie(e),"vec4 "+t+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function le(t,e){switch(e){case 1:e="Linear";break;case 2:e="Reinhard";break;case 3:e="Uncharted2";break;case 4:e="OptimizedCineon";break;case 5:e="ACESFilmic";break;default:throw Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function ce(t){var e,n=[];for(e in t){var r=t[e];!1!==r&&n.push("#define "+e+" "+r)}return n.join("\n")}function ue(t){return""!==t}function he(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pe(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function de(t,e){if(t=ks[e],void 0===t)throw Error("Can not resolve #include <"+e+">");return t.replace(Ys,de)}function fe(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),me(t,e,n,r)}function me(t,e,n,r){for(t="",e=parseInt(e);e<parseInt(n);e++)t+=r.replace(/\[ i \]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return t}function ge(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ye(t){var e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}function ve(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:e="ENVMAP_TYPE_EQUIREC";break;case 305:e="ENVMAP_TYPE_SPHERE"}return e}function _e(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 304:e="ENVMAP_MODE_REFRACTION"}return e}function xe(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}function be(t,e,n){var r,i,o=t.getContext(),a=n.defines,s=n.vertexShader,l=n.fragmentShader,c=ye(n),u=ve(n),h=_e(n),p=xe(n),d=0<t.gammaFactor?t.gammaFactor:1,f=n.isWebGL2?"":[n.extensionDerivatives||n.envMapCubeUV||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ue).join("\n"),m=ce(a),g=o.createProgram();return n.isRawShaderMaterial?(a=[m].filter(ue).join("\n"),0<a.length&&(a+="\n"),c=[f,m].filter(ue).join("\n"),0<c.length&&(c+="\n")):(a=[ge(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ue).join("\n"),c=[f,ge(n),"#define SHADER_NAME "+n.shaderName,m,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?ks.tonemapping_pars_fragment:"",0!==n.toneMapping?le("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?ks.encodings_pars_fragment:"",n.mapEncoding?ae("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?ae("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?ae("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?ae("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?ae("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?se("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ue).join("\n")),s=s.replace(Ys,de),s=he(s,n),s=pe(s,n),l=l.replace(Ys,de),l=he(l,n),l=pe(l,n),s=s.replace(Js,me).replace($s,fe),l=l.replace(Js,me).replace($s,fe),n.isWebGL2&&!n.isRawShaderMaterial&&(u=!1,h=/^\s*#version\s+300\s+es\s*\n/,n.isShaderMaterial&&null!==s.match(h)&&null!==l.match(h)&&(u=!0,s=s.replace(h,""),l=l.replace(h,"")),a="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+a,c=["#version 300 es\n\n#define varying in",u?"":"out highp vec4 pc_fragColor;",u?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+c),l=c+l,s=re(o,35633,a+s),l=re(o,35632,l),o.attachShader(g,s),o.attachShader(g,l),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),t.debug.checkShaderErrors&&(t=o.getProgramInfoLog(g).trim(),u=o.getShaderInfoLog(s).trim(),h=o.getShaderInfoLog(l).trim(),d=p=!0,!1===o.getProgramParameter(g,35714)?(p=!1,f=oe(o,s,"vertex"),m=oe(o,l,"fragment"),console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(g,35715),"gl.getProgramInfoLog",t,f,m)):""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==u&&""!==h||(d=!1),d&&(this.diagnostics={runnable:p,programLog:t,vertexShader:{log:u,prefix:a},fragmentShader:{log:h,prefix:c}})),o.deleteShader(s),o.deleteShader(l),this.getUniforms=function(){return void 0===r&&(r=new ne(o,g)),r},this.getAttributes=function(){if(void 0===i){for(var t={},e=o.getProgramParameter(g,35721),n=0;n<e;n++){var r=o.getActiveAttrib(g,n).name;t[r]=o.getAttribLocation(g,r)}i=t}return i},this.destroy=function(){o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=Zs++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=s,this.fragmentShader=l,this}function we(t,e,n){function r(t){if(t)t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding);else var e=3e3;return e}var i=[],o=n.isWebGL2,a=n.logarithmicDepthBuffer,s=n.floatVertexTextures,l=n.precision,c=n.maxVertexUniforms,u=n.vertexTextures,h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p="precision isWebGL2 supportsVertexTextures outputEncoding instancing map mapEncoding matcap matcapEncoding envMap envMapMode envMapEncoding envMapCubeUV lightMap lightMapEncoding aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap tangentSpaceNormalMap clearcoatMap clearcoatRoughnessMap clearcoatNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors vertexTangents vertexUvs uvsVertexOnly fog useFog fogExp2 flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights numDirLightShadows numPointLightShadows numSpotLightShadows shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering sheen".split(" ");this.getParameters=function(i,p,d,f,m,g,y){var v=f.fog;f=i.isMeshStandardMaterial?f.environment:null,f=i.envMap||f;var _=h[i.type];if(y.isSkinnedMesh){var x=y.skeleton.bones;if(s)x=1024;else{var b=Math.min(Math.floor((c-20)/4),x.length);b<x.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+x.length+" bones. This GPU supports "+b+"."),x=0):x=b}}else x=0;null!==i.precision&&(l=n.getMaxPrecision(i.precision),l!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",l,"instead.")),_?(b=Fs[_],b={name:i.type,uniforms:Rs.clone(b.uniforms),vertexShader:b.vertexShader,fragmentShader:b.fragmentShader}):b={name:i.type,uniforms:i.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader},i.onBeforeCompile(b,t);var w=t.getRenderTarget();return{isWebGL2:o,shaderID:_,shaderName:b.name,uniforms:b.uniforms,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,defines:i.defines,isRawShaderMaterial:i.isRawShaderMaterial,isShaderMaterial:i.isShaderMaterial,precision:l,instancing:!0===y.isInstancedMesh,supportsVertexTextures:u,outputEncoding:null!==w?r(w.texture):t.outputEncoding,map:!!i.map,mapEncoding:r(i.map),matcap:!!i.matcap,matcapEncoding:r(i.matcap),envMap:!!f,envMapMode:f&&f.mapping,envMapEncoding:r(f),envMapCubeUV:!!f&&(306===f.mapping||307===f.mapping),lightMap:!!i.lightMap,lightMapEncoding:r(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:r(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!i.map||!!i.bumpMap||!!i.normalMap||!!i.specularMap||!!i.alphaMap||!!i.emissiveMap||!!i.roughnessMap||!!i.metalnessMap||!!i.clearcoatMap||!!i.clearcoatRoughnessMap||!!i.clearcoatNormalMap||!!i.displacementMap,uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap)&&!!i.displacementMap,fog:!!v,useFog:i.fog,fogExp2:v&&v.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:a,skinning:i.skinning&&0<x,maxBones:x,useVertexTexture:s,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:p.directional.length,numPointLights:p.point.length,numSpotLights:p.spot.length,numRectAreaLights:p.rectArea.length,numHemiLights:p.hemi.length,numDirLightShadows:p.directionalShadowMap.length,numPointLightShadows:p.pointShadowMap.length,numSpotLightShadows:p.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:g,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&0<d.length,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||null!==e.get("EXT_frag_depth"),rendererExtensionDrawBuffers:o||null!==e.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||null!==e.get("EXT_shader_texture_lod"),onBeforeCompile:i.onBeforeCompile}},this.getProgramCacheKey=function(e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);if(void 0===e.isRawShaderMaterial){for(r=0;r<p.length;r++)n.push(e[p[r]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.onBeforeCompile.toString()),n.join()},this.acquireProgram=function(e,n){for(var r,o=0,a=i.length;o<a;o++){var s=i[o];if(s.cacheKey===n){r=s,++r.usedTimes;break}}return void 0===r&&(r=new be(t,n,e),i.push(r)),r},this.releaseProgram=function(t){if(0===--t.usedTimes){var e=i.indexOf(t);i[e]=i[i.length-1],i.pop(),t.destroy()}},this.programs=i}function Me(){var t=new WeakMap;return{get:function(e){var n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function Ee(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Se(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Te(){function t(t,r,i,a,s,l){var c=e[n];return void 0===c?(c={id:t.id,object:t,geometry:r,material:i,program:i.program||o,groupOrder:a,renderOrder:t.renderOrder,z:s,group:l},e[n]=c):(c.id=t.id,c.object=t,c.geometry=r,c.material=i,c.program=i.program||o,c.groupOrder=a,c.renderOrder=t.renderOrder,c.z=s,c.group=l),n++,c}var e=[],n=0,r=[],i=[],o={id:-1};return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(e,n,o,a,s,l){e=t(e,n,o,a,s,l),(!0===o.transparent?i:r).push(e)},unshift:function(e,n,o,a,s,l){e=t(e,n,o,a,s,l),(!0===o.transparent?i:r).unshift(e)},finish:function(){for(var t=n,r=e.length;t<r;t++){var i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){1<r.length&&r.sort(t||Ee),1<i.length&&i.sort(e||Se)}}}function Ae(){function t(n){n=n.target,n.removeEventListener("dispose",t),e.delete(n)}var e=new WeakMap;return{get:function(n,r){var i=e.get(n);if(void 0===i){var o=new Te;e.set(n,new WeakMap),e.get(n).set(r,o),n.addEventListener("dispose",t)}else o=i.get(r),void 0===o&&(o=new Te,i.set(r,o));return o},dispose:function(){e=new WeakMap}}}function Ce(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];switch(e.type){case"DirectionalLight":var n={direction:new c,color:new b};break;case"SpotLight":n={position:new c,direction:new c,color:new b,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new c,color:new b,distance:0,decay:0};break;case"HemisphereLight":n={direction:new c,skyColor:new b,groundColor:new b};break;case"RectAreaLight":n={color:new b,position:new c,halfWidth:new c,halfHeight:new c}}return t[e.id]=n}}}function Le(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];switch(e.type){case"DirectionalLight":var r={shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case"SpotLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case"PointLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new n,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=r}}}function Ie(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Pe(){for(var t=new Ce,e=Le(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;9>r;r++)n.probe.push(new c);var i=new c,o=new u,a=new u;return{setup:function(r,s,l){for(var c=0,u=0,h=0,p=0;9>p;p++)n.probe[p].set(0,0,0);var d=s=0,f=0,m=0,g=0,y=0,v=0,_=0;l=l.matrixWorldInverse,r.sort(Ie),p=0;for(var x=r.length;p<x;p++){var b=r[p],w=b.color,M=b.intensity,E=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)c+=w.r*M,u+=w.g*M,h+=w.b*M;else if(b.isLightProbe)for(S=0;9>S;S++)n.probe[S].addScaledVector(b.sh.coefficients[S],M);else if(b.isDirectionalLight){var T=t.get(b);T.color.copy(b.color).multiplyScalar(b.intensity),T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(l),b.castShadow&&(M=b.shadow,w=e.get(b),w.shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,n.directionalShadow[s]=w,n.directionalShadowMap[s]=S,n.directionalShadowMatrix[s]=b.shadow.matrix,y++),n.directional[s]=T,s++}else b.isSpotLight?(T=t.get(b),T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(l),T.color.copy(w).multiplyScalar(M),T.distance=E,T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(l),T.coneCos=Math.cos(b.angle),T.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),T.decay=b.decay,b.castShadow&&(M=b.shadow,w=e.get(b),w.shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,n.spotShadow[f]=w,n.spotShadowMap[f]=S,n.spotShadowMatrix[f]=b.shadow.matrix,_++),n.spot[f]=T,f++):b.isRectAreaLight?(T=t.get(b),T.color.copy(w).multiplyScalar(M),T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(l),a.identity(),o.copy(b.matrixWorld),o.premultiply(l),a.extractRotation(o),T.halfWidth.set(.5*b.width,0,0),T.halfHeight.set(0,.5*b.height,0),T.halfWidth.applyMatrix4(a),T.halfHeight.applyMatrix4(a),n.rectArea[m]=T,m++):b.isPointLight?(T=t.get(b),T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(l),T.color.copy(b.color).multiplyScalar(b.intensity),T.distance=b.distance,T.decay=b.decay,b.castShadow&&(M=b.shadow,w=e.get(b),w.shadowBias=M.bias,w.shadowRadius=M.radius,w.shadowMapSize=M.mapSize,w.shadowCameraNear=M.camera.near,w.shadowCameraFar=M.camera.far,n.pointShadow[d]=w,n.pointShadowMap[d]=S,n.pointShadowMatrix[d]=b.shadow.matrix,v++),n.point[d]=T,d++):b.isHemisphereLight&&(T=t.get(b),T.direction.setFromMatrixPosition(b.matrixWorld),T.direction.transformDirection(l),T.direction.normalize(),T.skyColor.copy(b.color).multiplyScalar(M),T.groundColor.copy(b.groundColor).multiplyScalar(M),n.hemi[g]=T,g++)}n.ambient[0]=c,n.ambient[1]=u,n.ambient[2]=h,r=n.hash,r.directionalLength===s&&r.pointLength===d&&r.spotLength===f&&r.rectAreaLength===m&&r.hemiLength===g&&r.numDirectionalShadows===y&&r.numPointShadows===v&&r.numSpotShadows===_||(n.directional.length=s,n.spot.length=f,n.rectArea.length=m,n.point.length=d,n.hemi.length=g,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=v,n.pointShadowMap.length=v,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=v,n.spotShadowMatrix.length=_,r.directionalLength=s,r.pointLength=d,r.spotLength=f,r.rectAreaLength=m,r.hemiLength=g,r.numDirectionalShadows=y,r.numPointShadows=v,r.numSpotShadows=_,n.version=Ks++)},state:n}}function Re(){var t=new Pe,e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(r){t.setup(e,n,r)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)}}}function Oe(){function t(n){n=n.target,n.removeEventListener("dispose",t),e.delete(n)}var e=new WeakMap;return{get:function(n,r){if(!1===e.has(n)){var i=new Re;e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)}else!1===e.get(n).has(r)?(i=new Re,e.get(n).set(r,i)):i=e.get(n).get(r);return i},dispose:function(){e=new WeakMap}}}function De(t){T.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Ne(t){T.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new c,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}function ke(t,e,r){function i(t,e,n){n=t<<0|e<<1|n<<2;var r=f[n];return void 0===r&&(r=new De({depthPacking:3201,morphTargets:t,skinning:e}),f[n]=r),r}function s(t,e,n){n=t<<0|e<<1|n<<2;var r=m[n];return void 0===r&&(r=new Ne({morphTargets:t,skinning:e}),m[n]=r),r}function l(e,n,r,o,a,l,c){var u=i,h=e.customDepthMaterial;return!0===o.isPointLight&&(u=s,h=e.customDistanceMaterial),void 0===h?(h=!1,!0===r.morphTargets&&(h=n.morphAttributes&&n.morphAttributes.position&&0<n.morphAttributes.position.length),n=!1,!0===e.isSkinnedMesh&&(!0===r.skinning?n=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),e=u(h,n,!0===e.isInstancedMesh)):e=h,t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length&&(h=e.uuid,u=r.uuid,n=g[h],void 0===n&&(n={},g[h]=n),h=n[u],void 0===h&&(h=e.clone(),n[u]=h),e=h),e.visible=r.visible,e.wireframe=r.wireframe,e.side=3===c?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:y[r.side],e.clipShadows=r.clipShadows,e.clippingPlanes=r.clippingPlanes,e.clipIntersection=r.clipIntersection,e.wireframeLinewidth=r.wireframeLinewidth,e.linewidth=r.linewidth,!0===o.isPointLight&&!0===e.isMeshDistanceMaterial&&(e.referencePosition.setFromMatrixPosition(o.matrixWorld),e.nearDistance=a,e.farDistance=l),e}function c(n,r,i,o,a){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||u.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);var s=e.update(n),h=n.material;if(Array.isArray(h))for(var p=s.groups,d=0,f=p.length;d<f;d++){var m=p[d],g=h[m.materialIndex];g&&g.visible&&(g=l(n,s,g,o,i.near,i.far,a),t.renderBufferDirect(i,null,s,g,n,m))}else h.visible&&(g=l(n,s,h,o,i.near,i.far,a),t.renderBufferDirect(i,null,s,g,n,null))}for(n=n.children,s=0,h=n.length;s<h;s++)c(n[s],r,i,o,a)}}var u=new Q,h=new n,p=new n,d=new o,f=[],m=[],g={},y={0:1,1:0,2:2},v=new X({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:.125},uniforms:{shadow_pass:{value:null},resolution:{value:new n},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=v.clone();_.defines.HORIZONAL_PASS=1;var x=new U;x.setAttribute("position",new C(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var b=new j(x,v),w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(n,i,o){if(!1!==w.enabled&&(!1!==w.autoUpdate||!1!==w.needsUpdate)&&0!==n.length){var s=t.getRenderTarget(),l=t.getActiveCubeFace(),f=t.getActiveMipmapLevel(),m=t.state;m.setBlending(0),m.buffers.color.setClear(1,1,1,1),m.buffers.depth.setTest(!0),m.setScissorTest(!1);for(var g=0,y=n.length;g<y;g++){var x=n[g],M=x.shadow;if(void 0===M)console.warn("THREE.WebGLShadowMap:",x,"has no shadow.");else{h.copy(M.mapSize);var E=M.getFrameExtents();h.multiply(E),p.copy(M.mapSize),(h.x>r||h.y>r)&&(h.x>r&&(p.x=Math.floor(r/E.x),h.x=p.x*E.x,M.mapSize.x=p.x),h.y>r&&(p.y=Math.floor(r/E.y),h.y=p.y*E.y,M.mapSize.y=p.y)),null!==M.map||M.isPointLightShadow||3!==this.type||(E={minFilter:1006,magFilter:1006,format:1023},M.map=new a(h.x,h.y,E),M.map.texture.name=x.name+".shadowMap",M.mapPass=new a(h.x,h.y,E),M.camera.updateProjectionMatrix()),null===M.map&&(E={minFilter:1003,magFilter:1003,format:1023},M.map=new a(h.x,h.y,E),M.map.texture.name=x.name+".shadowMap",M.camera.updateProjectionMatrix()),t.setRenderTarget(M.map),t.clear(),E=M.getViewportCount();for(var S=0;S<E;S++){var T=M.getViewport(S);d.set(p.x*T.x,p.y*T.y,p.x*T.z,p.y*T.w),m.viewport(d),M.updateMatrices(x,S),u=M.getFrustum(),c(i,o,M.camera,x,this.type)}M.isPointLightShadow||3!==this.type||(x=M,M=o,E=e.update(b),v.uniforms.shadow_pass.value=x.map.texture,v.uniforms.resolution.value=x.mapSize,v.uniforms.radius.value=x.radius,t.setRenderTarget(x.mapPass),t.clear(),t.renderBufferDirect(M,null,E,v,b,null),_.uniforms.shadow_pass.value=x.mapPass.texture,_.uniforms.resolution.value=x.mapSize,_.uniforms.radius.value=x.radius,t.setRenderTarget(x.map),t.clear(),t.renderBufferDirect(M,null,E,_,b,null))}}w.needsUpdate=!1,t.setRenderTarget(s,l,f)}}}function Fe(t,e,n){function r(e,n,r){var i=new Uint8Array(4),o=t.createTexture();for(t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728),e=0;e<r;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,i);return o}function i(n,r){y[n]=1,0===v[n]&&(t.enableVertexAttribArray(n),v[n]=1),_[n]!==r&&((d?t:e.get("ANGLE_instanced_arrays"))[d?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),_[n]=r)}function a(e){!0!==x[e]&&(t.enable(e),x[e]=!0)}function s(e){!1!==x[e]&&(t.disable(e),x[e]=!1)}function l(e,n,r,i,o,l,c,u){if(0===e)w&&(s(3042),w=!1);else if(w||(a(3042),w=!0),5!==e){if(e!==M||u!==I){if(100===E&&100===A||(t.blendEquation(32774),A=E=100),u)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}L=C=T=S=null,M=e,I=u}}else o=o||n,l=l||r,c=c||i,n===E&&o===A||(t.blendEquationSeparate(V[n],V[o]),E=n,A=o),r===S&&i===T&&l===C&&c===L||(t.blendFuncSeparate(H[r],H[i],H[l],H[c]),S=r,T=i,C=l,L=c),M=e,I=null}function c(e){P!==e&&(e?t.frontFace(2304):t.frontFace(2305),P=e)}function u(e){0!==e?(a(2884),e!==R&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):s(2884),R=e}function h(e,n,r){e?(a(32823),(D!==n||N!==r)&&(t.polygonOffset(n,r),D=n,N=r)):s(32823)}function p(e){void 0===e&&(e=33984+k-1),z!==e&&(t.activeTexture(e),z=e)}var d=n.isWebGL2,f=new function(){var e=!1,n=new o,r=null,i=new o(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,a,s){!0===s&&(e*=a,r*=a,o*=a),n.set(e,r,o,a),!1===i.equals(n)&&(t.clearColor(e,r,o,a),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},m=new function(){var e=!1,n=null,r=null,i=null;return{setTest:function(t){t?a(2929):s(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,i=r=n=null}}},g=new function(){var e=!1,n=null,r=null,i=null,o=null,l=null,c=null,u=null,h=null;return{setTest:function(t){e||(t?a(2960):s(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,a){r===e&&i===n&&o===a||(t.stencilFunc(e,n,a),r=e,i=n,o=a)},setOp:function(e,n,r){l===e&&c===n&&u===r||(t.stencilOp(e,n,r),l=e,c=n,u=r)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,h=u=c=l=o=i=r=n=null}}};n=t.getParameter(34921);var y=new Uint8Array(n),v=new Uint8Array(n),_=new Uint8Array(n),x={},b=null,w=null,M=null,E=null,S=null,T=null,A=null,C=null,L=null,I=!1,P=null,R=null,O=null,D=null,N=null,k=t.getParameter(35661),F=!1;n=0,n=t.getParameter(7938),-1!==n.indexOf("WebGL")?(n=parseFloat(/^WebGL ([0-9])/.exec(n)[1]),F=1<=n):-1!==n.indexOf("OpenGL ES")&&(n=parseFloat(/^OpenGL ES ([0-9])/.exec(n)[1]),F=2<=n);var z=null,B={},U=new o,j=new o,G={};G[3553]=r(3553,3553,1),G[34067]=r(34067,34069,6),f.setClear(0,0,0,1),m.setClear(1),g.setClear(0),a(2929),m.setFunc(3),c(!1),u(1),a(2884),l(0);var V={100:32774,101:32778,102:32779};d?(V[103]=32775,V[104]=32776):(n=e.get("EXT_blend_minmax"),null!==n&&(V[103]=n.MIN_EXT,V[104]=n.MAX_EXT));var H={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};return{buffers:{color:f,depth:m,stencil:g},initAttributes:function(){for(var t=0,e=y.length;t<e;t++)y[t]=0},enableAttribute:function(t){i(t,0)},enableAttributeAndDivisor:i,disableUnusedAttributes:function(){for(var e=0,n=v.length;e!==n;++e)v[e]!==y[e]&&(t.disableVertexAttribArray(e),v[e]=0)},vertexAttribPointer:function(e,n,r,i,o,a){!0!==d||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,i,o,a):t.vertexAttribIPointer(e,n,r,i,o,a)},enable:a,disable:s,useProgram:function(e){return b!==e&&(t.useProgram(e),b=e,!0)},setBlending:l,setMaterial:function(t,e){2===t.side?s(2884):a(2884);var n=1===t.side;e&&(n=!n),c(n),1===t.blending&&!1===t.transparent?l(0):l(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),m.setFunc(t.depthFunc),m.setTest(t.depthTest),m.setMask(t.depthWrite),f.setMask(t.colorWrite),e=t.stencilWrite,g.setTest(e),e&&(g.setMask(t.stencilWriteMask),g.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),g.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),h(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:c,setCullFace:u,setLineWidth:function(e){e!==O&&(F&&t.lineWidth(e),O=e)},setPolygonOffset:h,setScissorTest:function(t){t?a(3089):s(3089)},activeTexture:p,bindTexture:function(e,n){null===z&&p();var r=B[z];void 0===r&&(r={type:void 0,texture:void 0},B[z]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||G[e]),r.type=e,r.texture=n)},unbindTexture:function(){var e=B[z];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===U.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),U.copy(e))},viewport:function(e){!1===j.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),j.copy(e))},reset:function(){for(var e=0;e<v.length;e++)1===v[e]&&(t.disableVertexAttribArray(e),v[e]=0);x={},z=null,B={},R=P=M=b=null,f.reset(),m.reset(),g.reset()}}}function ze(t,e,n,r,i,o,a){function s(t,e){return R?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function l(t,e,n,r){var i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),1>i||!0===e){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap)return r=e?Vo.floorPowerOfTwo:Math.floor,e=r(i*t.width),i=r(i*t.height),void 0===S&&(S=s(e,i)),n=n?s(e,i):S,n.width=e,n.height=i,n.getContext("2d").drawImage(t,0,0,e,i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+e+"x"+i+")."),n;"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+").")}return t}function c(t){return Vo.isPowerOfTwo(t.width)&&Vo.isPowerOfTwo(t.height)}function u(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function h(e,n,i,o){t.generateMipmap(e),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function p(n,r,i){if(!1===T)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}return n=r,6403===r&&(5126===i&&(n=33326),5131===i&&(n=33325),5121===i&&(n=33321)),6407===r&&(5126===i&&(n=34837),5131===i&&(n=34843),5121===i&&(n=32849)),6408===r&&(5126===i&&(n=34836),5131===i&&(n=34842),5121===i&&(n=32856)),33325!==n&&33326!==n&&34842!==n&&34836!==n||e.get("EXT_color_buffer_float"),n}function d(t){return 1003===t||1004===t||1005===t?9728:9729}function f(e){e=e.target,e.removeEventListener("dispose",f);var n=r.get(e);void 0!==n.__webglInit&&(t.deleteTexture(n.__webglTexture),r.remove(e)),e.isVideoTexture&&P.delete(e),a.memory.textures--}function m(e){e=e.target,e.removeEventListener("dispose",m);var n=r.get(e),i=r.get(e.texture);if(e){if(void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(i=0;6>i;i++)t.deleteFramebuffer(n.__webglFramebuffer[i]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[i]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(e.texture),r.remove(e)}a.memory.textures--}function g(t,e){var i=r.get(t);if(t.isVideoTexture){var o=a.render.frame;P.get(t)!==o&&(P.set(t,o),t.update())}if(0<t.version&&i.__version!==t.version)if(o=t.image,void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void b(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}n.activeTexture(33984+e),n.bindTexture(3553,i.__webglTexture)}function y(e,i){if(6===e.image.length){var a=r.get(e);if(0<e.version&&a.__version!==e.version){x(a,e),n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture),t.pixelStorei(37440,e.flipY);var s=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture);i=e.image[0]&&e.image[0].isDataTexture;for(var d=[],f=0;6>f;f++)d[f]=s||i?i?e.image[f].image:e.image[f]:l(e.image[f],!1,!0,C);var m=d[0],g=c(m)||T,y=o.convert(e.format),v=o.convert(e.type),b=p(e.internalFormat,y,v);if(_(34067,e,g),s){for(f=0;6>f;f++){var w=d[f].mipmaps;for(s=0;s<w.length;s++){var M=w[s];1023!==e.format&&1022!==e.format?null!==y?n.compressedTexImage2D(34069+f,s,b,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+f,s,b,M.width,M.height,0,y,v,M.data)}}a.__maxMipLevel=w.length-1}else{for(w=e.mipmaps,f=0;6>f;f++)if(i)for(n.texImage2D(34069+f,0,b,d[f].width,d[f].height,0,y,v,d[f].data),s=0;s<w.length;s++)M=w[s],M=M.image[f].image,n.texImage2D(34069+f,s+1,b,M.width,M.height,0,y,v,M.data);else for(n.texImage2D(34069+f,0,b,y,v,d[f]),s=0;s<w.length;s++)M=w[s],n.texImage2D(34069+f,s+1,b,y,v,M.image[f]);a.__maxMipLevel=w.length}u(e,g)&&h(34067,e,m.width,m.height),a.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture)}}function v(t,e){n.activeTexture(33984+e),n.bindTexture(34067,r.get(t).__webglTexture)}function _(n,o,a){a?(t.texParameteri(n,10242,D[o.wrapS]),t.texParameteri(n,10243,D[o.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,D[o.wrapR]),t.texParameteri(n,10240,N[o.magFilter]),t.texParameteri(n,10241,N[o.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),1001===o.wrapS&&1001===o.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,d(o.magFilter)),t.texParameteri(n,10241,d(o.minFilter)),1003!==o.minFilter&&1006!==o.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!(a=e.get("EXT_texture_filter_anisotropic"))||1015===o.type&&null===e.get("OES_texture_float_linear")||1016===o.type&&null===(T||e.get("OES_texture_half_float_linear"))||!(1<o.anisotropy||r.get(o).__currentAnisotropy)||(t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}function x(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",f),e.__webglTexture=t.createTexture(),a.memory.textures++)}function b(e,r,i){var a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),x(e,r),n.activeTexture(33984+i),n.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment),i=!T&&(1001!==r.wrapS||1001!==r.wrapT||1003!==r.minFilter&&1006!==r.minFilter),i=i&&!1===c(r.image),i=l(r.image,i,!1,L);var s=c(i)||T,d=o.convert(r.format),f=o.convert(r.type),m=p(r.internalFormat,d,f);_(a,r,s);var g=r.mipmaps;if(r.isDepthTexture)m=6402,T?m=1015===r.type?36012:1014===r.type?33190:1020===r.type?35056:33189:1015===r.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===r.format&&6402===m&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,f=o.convert(r.type)),1027===r.format&&6402===m&&(m=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,f=o.convert(r.type))),n.texImage2D(3553,0,m,i.width,i.height,0,d,f,null);else if(r.isDataTexture)if(0<g.length&&s){for(var y=0,v=g.length;y<v;y++){var b=g[y];n.texImage2D(3553,y,m,b.width,b.height,0,d,f,b.data)}r.generateMipmaps=!1,e.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,i.width,i.height,0,d,f,i.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(y=0,v=g.length;y<v;y++)b=g[y],1023!==r.format&&1022!==r.format?null!==d?n.compressedTexImage2D(3553,y,m,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,y,m,b.width,b.height,0,d,f,b.data);e.__maxMipLevel=g.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,i.width,i.height,i.depth,0,d,f,i.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,i.width,i.height,i.depth,0,d,f,i.data),e.__maxMipLevel=0;else if(0<g.length&&s){for(y=0,v=g.length;y<v;y++)b=g[y],n.texImage2D(3553,y,m,d,f,b);r.generateMipmaps=!1,e.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,d,f,i),e.__maxMipLevel=0;u(r,s)&&h(a,r,i.width,i.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function w(e,i,a,s){var l=o.convert(i.texture.format),c=o.convert(i.texture.type),u=p(i.texture.internalFormat,l,c);n.texImage2D(s,0,u,i.width,i.height,0,l,c,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,s,r.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function M(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){var i=33189;r?((r=n.depthTexture)&&r.isDepthTexture&&(1015===r.type?i=36012:1014===r.type&&(i=33190)),r=E(n),t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)):t.renderbufferStorage(36161,i,n.width,n.height),t.framebufferRenderbuffer(36160,36096,36161,e)}else n.depthBuffer&&n.stencilBuffer?(r?(r=E(n),t.renderbufferStorageMultisample(36161,r,35056,n.width,n.height)):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)):(e=o.convert(n.texture.format),i=o.convert(n.texture.type),i=p(n.texture.internalFormat,e,i),r?(r=E(n),t.renderbufferStorageMultisample(36161,r,i,n.width,n.height)):t.renderbufferStorage(36161,i,n.width,n.height));t.bindRenderbuffer(36161,null)}function E(t){return T&&t.isWebGLMultisampleRenderTarget?Math.min(I,t.samples):0}var S,T=i.isWebGL2,A=i.maxTextures,C=i.maxCubemapSize,L=i.maxTextureSize,I=i.maxSamples,P=new WeakMap,R=!1;try{R="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(z){}var O=0,D={1e3:10497,1001:33071,1002:33648},N={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987},k=!1,F=!1;this.allocateTextureUnit=function(){var t=O;return t>=A&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+A),O+=1,t},this.resetTextureUnits=function(){O=0},this.setTexture2D=g,this.setTexture2DArray=function(t,e){var i=r.get(t);0<t.version&&i.__version!==t.version?b(i,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){var i=r.get(t);0<t.version&&i.__version!==t.version?b(i,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=y,this.setTextureCubeDynamic=v,this.setupRenderTarget=function(e){var i=r.get(e),s=r.get(e.texture);e.addEventListener("dispose",m),s.__webglTexture=t.createTexture(),a.memory.textures++;var l=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultisampleRenderTarget,f=c(e)||T;if(!T||1022!==e.texture.format||1015!==e.texture.type&&1016!==e.texture.type||(e.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l)for(i.__webglFramebuffer=[],d=0;6>d;d++)i.__webglFramebuffer[d]=t.createFramebuffer();else if(i.__webglFramebuffer=t.createFramebuffer(),d)if(T){i.__webglMultisampledFramebuffer=t.createFramebuffer(),i.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,i.__webglColorRenderbuffer),d=o.convert(e.texture.format);var y=o.convert(e.texture.type);d=p(e.texture.internalFormat,d,y),y=E(e),t.renderbufferStorageMultisample(36161,y,d,e.width,e.height),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(i.__webglDepthRenderbuffer=t.createRenderbuffer(),M(i.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){for(n.bindTexture(34067,s.__webglTexture),_(34067,e.texture,f),d=0;6>d;d++)w(i.__webglFramebuffer[d],e,36064,34069+d);u(e.texture,f)&&h(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,s.__webglTexture),_(3553,e.texture,f),w(i.__webglFramebuffer,e,36064,3553),u(e.texture,f)&&h(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);if(e.depthBuffer){if(i=r.get(e),s=!0===e.isWebGLCubeRenderTarget,e.depthTexture){if(s)throw Error("target.depthTexture not supported in Cube render targets");if(e&&e.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,i.__webglFramebuffer),!e.depthTexture||!e.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(r.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),g(e.depthTexture,0),i=r.get(e.depthTexture).__webglTexture,1026===e.depthTexture.format)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(1027!==e.depthTexture.format)throw Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}else if(s)for(i.__webglDepthbuffer=[],s=0;6>s;s++)t.bindFramebuffer(36160,i.__webglFramebuffer[s]),i.__webglDepthbuffer[s]=t.createRenderbuffer(),M(i.__webglDepthbuffer[s],e,!1);else t.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),M(i.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}},this.updateRenderTargetMipmap=function(t){var e=t.texture,i=c(t)||T;if(u(e,i)){i=t.isWebGLCubeRenderTarget?34067:3553;var o=r.get(e).__webglTexture;n.bindTexture(i,o),h(i,e,t.width,t.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(T){var n=r.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);var i=e.width,o=e.height,a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),t=t.texture),g(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?y(t,e):v(t,e)}}function Be(t,e,n){var r=n.isWebGL2;return{convert:function(t){if(1009===t)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(1012===t)return 5123;if(1013===t)return 5124;if(1014===t)return 5125;if(1015===t)return 5126;if(1016===t){if(r)return 5131;var n=e.get("OES_texture_half_float");return null!==n?n.HALF_FLOAT_OES:null}if(1021===t)return 6406;if(1022===t)return 6407;if(1023===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(1026===t)return 6402;if(1027===t)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(33776===t||33777===t||33778===t||33779===t){if(n=e.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(33776===t)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(n=e.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(35840===t)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return n=e.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===t||37496===t)&&(n=e.get("WEBGL_compressed_texture_etc"),null!==n)){if(37492===t)return n.COMPRESSED_RGB8_ETC2;if(37496===t)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?(n=e.get("WEBGL_compressed_texture_astc"),null!==n?t:null):36492===t?(n=e.get("EXT_texture_compression_bptc"),null!==n?t:null):1020===t?r?34042:(n=e.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Ue(t){Y.call(this),this.cameras=t||[]}function je(){d.call(this),this.type="Group"}function Ge(){this._grip=this._targetRay=null}function Ve(t,e){function n(t){var e=g.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function r(){g.forEach((function(t,e){t.disconnect(e)})),g.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),T.stop(),l.isPresenting=!1,l.dispatchEvent({type:"sessionend"})}function i(t){p=t,T.setContext(u),T.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}function a(t){for(var e=u.inputSources,n=0;n<m.length;n++)g.set(e[n],m[n]);for(n=0;n<t.removed.length;n++){e=t.removed[n];var r=g.get(e);r&&(r.dispatchEvent({type:"disconnected",data:e}),g.delete(e))}for(n=0;n<t.added.length;n++)e=t.added[n],(r=g.get(e))&&r.dispatchEvent({type:"connected",data:e})}function s(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}var l=this,u=null,h=1,p=null,d="local-floor",f=null,m=[],g=new Map,y=new Y;y.layers.enable(1),y.viewport=new o;var v=new Y;v.layers.enable(2),v.viewport=new o;var _=[y,v],x=new Ue;x.layers.enable(1),x.layers.enable(2);var b=null,w=null;this.isPresenting=this.enabled=!1,this.getController=function(t){var e=m[t];return void 0===e&&(e=new Ge,m[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){var e=m[t];return void 0===e&&(e=new Ge,m[t]=e),e.getGripSpace()},this.setFramebufferScaleFactor=function(t){h=t,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){d=t,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p},this.getSession=function(){return u},this.setSession=function(t){u=t,null!==u&&(u.addEventListener("select",n),u.addEventListener("selectstart",n),u.addEventListener("selectend",n),u.addEventListener("squeeze",n),u.addEventListener("squeezestart",n),u.addEventListener("squeezeend",n),u.addEventListener("end",r),t=e.getContextAttributes(),!0!==t.xrCompatible&&e.makeXRCompatible(),t=new XRWebGLLayer(u,e,{antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:h}),u.updateRenderState({baseLayer:t}),u.requestReferenceSpace(d).then(i),u.addEventListener("inputsourceschange",a))};var M=new c,E=new c;this.getCamera=function(t){x.near=v.near=y.near=t.near,x.far=v.far=y.far=t.far,b===x.near&&w===x.far||(u.updateRenderState({depthNear:x.near,depthFar:x.far}),b=x.near,w=x.far);var e=t.parent,n=x.cameras;s(x,e);for(var r=0;r<n.length;r++)s(n[r],e);for(t.matrixWorld.copy(x.matrixWorld),t=t.children,r=0,e=t.length;r<e;r++)t[r].updateMatrixWorld(!0);if(2===n.length){M.setFromMatrixPosition(y.matrixWorld),E.setFromMatrixPosition(v.matrixWorld),n=M.distanceTo(E);var i=y.projectionMatrix.elements,o=v.projectionMatrix.elements,a=i[14]/(i[10]-1);r=i[14]/(i[10]+1),t=(i[9]+1)/i[5],e=(i[9]-1)/i[5];var l=(i[8]-1)/i[0],c=(o[8]+1)/o[0];o=a*l,i=a*c,c=n/(-l+c),l=c*-l,y.matrixWorld.decompose(x.position,x.quaternion,x.scale),x.translateX(l),x.translateZ(c),x.matrixWorld.compose(x.position,x.quaternion,x.scale),x.matrixWorldInverse.getInverse(x.matrixWorld),a+=c,c=r+c,x.projectionMatrix.makePerspective(o-l,i+(n-l),t*r/c*a,e*r/c*a,a,c)}else x.projectionMatrix.copy(y.projectionMatrix);return x};var S=null,T=new tt;T.setAnimationLoop((function(e,n){if(f=n.getViewerPose(p),null!==f){var r=f.views,i=u.renderState.baseLayer;t.setFramebuffer(i.framebuffer);var o=!1;r.length!==x.cameras.length&&(x.cameras.length=0,o=!0);for(var a=0;a<r.length;a++){var s=r[a],l=i.getViewport(s),c=_[a];c.matrix.fromArray(s.transform.matrix),c.projectionMatrix.fromArray(s.projectionMatrix),c.viewport.set(l.x,l.y,l.width,l.height),0===a&&x.matrix.copy(c.matrix),!0===o&&x.cameras.push(c)}}for(r=u.inputSources,a=0;a<m.length;a++)m[a].update(r[a],n,p);S&&S(e,n)})),this.setAnimationLoop=function(t){S=t},this.dispose=function(){}}function He(t){function e(e,n,r){if(e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap),(r=n.envMap||r)&&(e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio,e.maxMipLevel.value=t.get(r).__maxMipLevel),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map)var i=n.map;else n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap&&(i=n.emissiveMap);if(void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),n.aoMap)var o=n.aoMap;else n.lightMap&&(o=n.lightMap);void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function n(t,e,n){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||n)&&(t.envMapIntensity.value=e.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,o,a){if(r.isMeshBasicMaterial)e(t,r);else if(r.isMeshLambertMaterial)e(t,r),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap);else if(r.isMeshToonMaterial)e(t,r),t.specular.value.copy(r.specular),t.shininess.value=Math.max(r.shininess,1e-4),r.gradientMap&&(t.gradientMap.value=r.gradientMap),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isMeshPhongMaterial)e(t,r),t.specular.value.copy(r.specular),t.shininess.value=Math.max(r.shininess,1e-4),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isMeshStandardMaterial)e(t,r,i),r.isMeshPhysicalMaterial?(n(t,r,i),t.reflectivity.value=r.reflectivity,t.clearcoat.value=r.clearcoat,t.clearcoatRoughness.value=r.clearcoatRoughness,r.sheen&&t.sheen.value.copy(r.sheen),r.clearcoatMap&&(t.clearcoatMap.value=r.clearcoatMap),r.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=r.clearcoatRoughnessMap),r.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(r.clearcoatNormalScale),t.clearcoatNormalMap.value=r.clearcoatNormalMap,1===r.side&&t.clearcoatNormalScale.value.negate()),t.transparency.value=r.transparency):n(t,r,i);else if(r.isMeshMatcapMaterial)e(t,r),r.matcap&&(t.matcap.value=r.matcap),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isMeshDepthMaterial)e(t,r),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isMeshDistanceMaterial)e(t,r),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias),t.referencePosition.value.copy(r.referencePosition),t.nearDistance.value=r.nearDistance,t.farDistance.value=r.farDistance;else if(r.isMeshNormalMaterial)e(t,r),r.bumpMap&&(t.bumpMap.value=r.bumpMap,t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias);else if(r.isLineBasicMaterial)t.diffuse.value.copy(r.color),t.opacity.value=r.opacity,r.isLineDashedMaterial&&(t.dashSize.value=r.dashSize,t.totalSize.value=r.dashSize+r.gapSize,t.scale.value=r.scale);else if(r.isPointsMaterial){if(t.diffuse.value.copy(r.color),t.opacity.value=r.opacity,t.size.value=r.size*o,t.scale.value=.5*a,r.map&&(t.map.value=r.map),r.alphaMap&&(t.alphaMap.value=r.alphaMap),r.map)var s=r.map;else r.alphaMap&&(s=r.alphaMap);void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uvTransform.value.copy(s.matrix))}else if(r.isSpriteMaterial){if(t.diffuse.value.copy(r.color),t.opacity.value=r.opacity,t.rotation.value=r.rotation,r.map&&(t.map.value=r.map),r.alphaMap&&(t.alphaMap.value=r.alphaMap),r.map)var l=r.map;else r.alphaMap&&(l=r.alphaMap);void 0!==l&&(!0===l.matrixAutoUpdate&&l.updateMatrix(),t.uvTransform.value.copy(l.matrix))}else r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function We(t){var e;function r(){I=new lt(Ft),P=new at(Ft,I,t),!1===P.isWebGL2&&(I.get("WEBGL_depth_texture"),I.get("OES_texture_float"),I.get("OES_texture_half_float"),I.get("OES_texture_half_float_linear"),I.get("OES_standard_derivatives"),I.get("OES_element_index_uint"),I.get("ANGLE_instanced_arrays")),I.get("OES_texture_float_linear"),X=new Be(Ft,I,P),R=new Fe(Ft,I,P),R.scissor(bt.copy(Lt).multiplyScalar(St).floor()),R.viewport(xt.copy(Ct).multiplyScalar(St).floor()),O=new ht(Ft),D=new Me,N=new ze(Ft,I,R,D,P,X,O),k=new et(Ft,P),F=new ct(Ft,k,O),z=new ft(Ft,F,k,O),H=new dt(Ft),B=new we(Z,I,P),U=new He(D),j=new Ae,G=new Oe,V=new it(Z,R,z,E),W=new ot(Ft,I,O,P),q=new ut(Ft,I,O,P),O.programs=B.programs,Z.capabilities=P,Z.extensions=I,Z.properties=D,Z.renderLists=j,Z.state=R,Z.info=O}function i(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Y=!0}function a(){console.log("THREE.WebGLRenderer: Context Restored."),Y=!1,r()}function s(t){t=t.target,t.removeEventListener("dispose",s),l(t),D.remove(t)}function l(t){var e=D.get(t).program;t.program=void 0,void 0!==e&&B.releaseProgram(e)}function h(t,e){t.render((function(t){Z.renderBufferImmediate(t,e)}))}function p(t,e,n,r){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)L.pushLight(t),t.castShadow&&L.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Pt.intersectsSprite(t)){r&&kt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Nt);var i=z.update(t),o=t.material;o.visible&&C.push(t,i,o,n,kt.z,null)}}else if(t.isImmediateRenderObject)r&&kt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Nt),C.push(t,null,t.material,n,kt.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==O.render.frame&&(t.skeleton.update(),t.skeleton.frame=O.render.frame),!t.frustumCulled||Pt.intersectsObject(t)))if(r&&kt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Nt),i=z.update(t),o=t.material,Array.isArray(o))for(var a=i.groups,s=0,l=a.length;s<l;s++){var c=a[s],u=o[c.materialIndex];u&&u.visible&&C.push(t,i,u,n,kt.z,c)}else o.visible&&C.push(t,i,o,n,kt.z,null);for(t=t.children,s=0,l=t.length;s<l;s++)p(t[s],e,n,r)}}function d(t,e,n,r){for(var i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,l=a.geometry,c=void 0===r?a.material:r;if(a=a.group,n.isArrayCamera){_t=n;for(var u=n.cameras,h=0,p=u.length;h<p;h++){var d=u[h];s.layers.test(d.layers)&&(R.viewport(xt.copy(d.viewport)),L.setupLights(d),m(s,e,d,l,c,a))}}else _t=null,m(s,e,n,l,c,a)}}function m(t,n,r,i,o,a){if(t.onBeforeRender(Z,n,r,i,o,a),L=G.get(n,_t||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var s=y(r,n,o,t);R.setMaterial(o),gt=e=null,yt=!1,h(t,s)}else Z.renderBufferDirect(r,n,i,o,t,a);t.onAfterRender(Z,n,r,i,o,a),L=G.get(n,_t||r)}function g(t,e,n){var r=D.get(t),i=L.state.lights,o=i.state.version;n=B.getParameters(t,i.state,L.state.shadowsArray,e,Rt.numPlanes,Rt.numIntersection,n);var a=B.getProgramCacheKey(n),c=r.program,u=!0;if(void 0===c)t.addEventListener("dispose",s);else if(c.cacheKey!==a)l(t);else{if(r.lightsStateVersion!==o)r.lightsStateVersion=o;else if(void 0!==n.shaderID)return;u=!1}if(u&&(c=B.acquireProgram(n,a),r.program=c,r.uniforms=n.uniforms,r.outputEncoding=n.outputEncoding,t.program=c),n=c.getAttributes(),t.morphTargets)for(a=t.numSupportedMorphTargets=0;a<Z.maxMorphTargets;a++)0<=n["morphTarget"+a]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(a=t.numSupportedMorphNormals=0;a<Z.maxMorphNormals;a++)0<=n["morphNormal"+a]&&t.numSupportedMorphNormals++;n=r.uniforms,(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(r.numClippingPlanes=Rt.numPlanes,r.numIntersection=Rt.numIntersection,n.clippingPlanes=Rt.uniform),r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.needsLights=t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights,r.lightsStateVersion=o,r.needsLights&&(n.ambientLightColor.value=i.state.ambient,n.lightProbe.value=i.state.probe,n.directionalLights.value=i.state.directional,n.directionalLightShadows.value=i.state.directionalShadow,n.spotLights.value=i.state.spot,n.spotLightShadows.value=i.state.spotShadow,n.rectAreaLights.value=i.state.rectArea,n.pointLights.value=i.state.point,n.pointLightShadows.value=i.state.pointShadow,n.hemisphereLights.value=i.state.hemi,n.directionalShadowMap.value=i.state.directionalShadowMap,n.directionalShadowMatrix.value=i.state.directionalShadowMatrix,n.spotShadowMap.value=i.state.spotShadowMap,n.spotShadowMatrix.value=i.state.spotShadowMatrix,n.pointShadowMap.value=i.state.pointShadowMap,n.pointShadowMatrix.value=i.state.pointShadowMatrix),t=r.program.getUniforms(),t=ne.seqWithValue(t.seq,n),r.uniformsList=t}function y(t,e,n,r){N.resetTextureUnits();var i=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===rt?Z.outputEncoding:rt.texture.encoding,s=D.get(n),l=L.state.lights;Ot&&(Dt||t!==vt)&&Rt.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,s,t===vt&&n.id===mt),n.version===s.__version?void 0===s.program||n.fog&&s.fog!==i||s.environment!==o||s.needsLights&&s.lightsStateVersion!==l.state.version?g(n,e,r):void 0===s.numClippingPlanes||s.numClippingPlanes===Rt.numPlanes&&s.numIntersection===Rt.numIntersection?s.outputEncoding!==a&&g(n,e,r):g(n,e,r):(g(n,e,r),s.__version=n.version);var c=!1,u=!1,h=!1;if(e=s.program,a=e.getUniforms(),l=s.uniforms,R.useProgram(e.program)&&(h=u=c=!0),n.id!==mt&&(mt=n.id,u=!0),(c||vt!==t)&&(a.setValue(Ft,"projectionMatrix",t.projectionMatrix),P.logarithmicDepthBuffer&&a.setValue(Ft,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),vt!==t&&(vt=t,h=u=!0),(n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap)&&(c=a.map.cameraPosition,void 0!==c&&c.setValue(Ft,kt.setFromMatrixPosition(t.matrixWorld))),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&a.setValue(Ft,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&a.setValue(Ft,"viewMatrix",t.matrixWorldInverse)),n.skinning&&(a.setOptional(Ft,r,"bindMatrix"),a.setOptional(Ft,r,"bindMatrixInverse"),t=r.skeleton))if(c=t.bones,P.floatVertexTextures){if(void 0===t.boneTexture){c=Math.sqrt(4*c.length),c=Vo.ceilPowerOfTwo(c),c=Math.max(c,4);var p=new Float32Array(c*c*4);p.set(t.boneMatrices);var d=new K(p,c,c,1023,1015);t.boneMatrices=p,t.boneTexture=d,t.boneTextureSize=c}a.setValue(Ft,"boneTexture",t.boneTexture,N),a.setValue(Ft,"boneTextureSize",t.boneTextureSize)}else a.setOptional(Ft,t,"boneMatrices");return(u||s.receiveShadow!==r.receiveShadow)&&(s.receiveShadow=r.receiveShadow,a.setValue(Ft,"receiveShadow",r.receiveShadow)),u&&(a.setValue(Ft,"toneMappingExposure",Z.toneMappingExposure),a.setValue(Ft,"toneMappingWhitePoint",Z.toneMappingWhitePoint),s.needsLights&&(u=h,l.ambientLightColor.needsUpdate=u,l.lightProbe.needsUpdate=u,l.directionalLights.needsUpdate=u,l.directionalLightShadows.needsUpdate=u,l.pointLights.needsUpdate=u,l.pointLightShadows.needsUpdate=u,l.spotLights.needsUpdate=u,l.spotLightShadows.needsUpdate=u,l.rectAreaLights.needsUpdate=u,l.hemisphereLights.needsUpdate=u),i&&n.fog&&U.refreshFogUniforms(l,i),U.refreshMaterialUniforms(l,n,o,St,Et),void 0!==l.ltc_1&&(l.ltc_1.value=Ns.LTC_1),void 0!==l.ltc_2&&(l.ltc_2.value=Ns.LTC_2),ne.upload(Ft,s.uniformsList,l,N)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ne.upload(Ft,s.uniformsList,l,N),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&a.setValue(Ft,"center",r.center),a.setValue(Ft,"modelViewMatrix",r.modelViewMatrix),a.setValue(Ft,"normalMatrix",r.normalMatrix),a.setValue(Ft,"modelMatrix",r.matrixWorld),e}t=t||{};var v=void 0!==t.canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),_=void 0!==t.context?t.context:null,x=void 0!==t.alpha&&t.alpha,b=void 0===t.depth||t.depth,w=void 0===t.stencil||t.stencil,M=void 0!==t.antialias&&t.antialias,E=void 0===t.premultipliedAlpha||t.premultipliedAlpha,S=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,T=void 0!==t.powerPreference?t.powerPreference:"default",A=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,C=null,L=null;this.domElement=v,this.debug={checkShaderErrors:!0},this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingWhitePoint=this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var I,P,R,O,D,N,k,F,z,B,U,j,G,V,H,W,q,X,Z=this,Y=!1,$=null,J=0,nt=0,rt=null,pt=null,mt=-1,gt=e=null,yt=!1,vt=null,_t=null,xt=new o,bt=new o,wt=null,Mt=v.width,Et=v.height,St=1,Tt=null,At=null,Ct=new o(0,0,Mt,Et),Lt=new o(0,0,Mt,Et),It=!1,Pt=new Q,Rt=new st,Ot=!1,Dt=!1,Nt=new u,kt=new c;try{x={alpha:x,depth:b,stencil:w,antialias:M,premultipliedAlpha:E,preserveDrawingBuffer:S,powerPreference:T,failIfMajorPerformanceCaveat:A},v.addEventListener("webglcontextlost",i,!1),v.addEventListener("webglcontextrestored",a,!1);var Ft=_||v.getContext("webgl",x)||v.getContext("experimental-webgl",x);if(null===Ft){if(null!==v.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===Ft.getShaderPrecisionFormat&&(Ft.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Vt){throw console.error("THREE.WebGLRenderer: "+Vt.message),Vt}r();var zt=new Ve(Z,Ft);this.xr=zt;var Bt=new ke(Z,z,P.maxTextureSize);this.shadowMap=Bt,this.getContext=function(){return Ft},this.getContextAttributes=function(){return Ft.getContextAttributes()},this.forceContextLoss=function(){var t=I.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=I.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return St},this.setPixelRatio=function(t){void 0!==t&&(St=t,this.setSize(Mt,Et,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new n),t.set(Mt,Et)},this.setSize=function(t,e,n){zt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Mt=t,Et=e,v.width=Math.floor(t*St),v.height=Math.floor(e*St),!1!==n&&(v.style.width=t+"px",v.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new n),t.set(Mt*St,Et*St).floor()},this.setDrawingBufferSize=function(t,e,n){Mt=t,Et=e,St=n,v.width=Math.floor(t*n),v.height=Math.floor(e*n),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new o),t.copy(xt)},this.getViewport=function(t){return t.copy(Ct)},this.setViewport=function(t,e,n,r){t.isVector4?Ct.set(t.x,t.y,t.z,t.w):Ct.set(t,e,n,r),R.viewport(xt.copy(Ct).multiplyScalar(St).floor())},this.getScissor=function(t){return t.copy(Lt)},this.setScissor=function(t,e,n,r){t.isVector4?Lt.set(t.x,t.y,t.z,t.w):Lt.set(t,e,n,r),R.scissor(bt.copy(Lt).multiplyScalar(St).floor())},this.getScissorTest=function(){return It},this.setScissorTest=function(t){R.setScissorTest(It=t)},this.setOpaqueSort=function(t){Tt=t},this.setTransparentSort=function(t){At=t},this.getClearColor=function(){return V.getClearColor()},this.setClearColor=function(){V.setClearColor.apply(V,arguments)},this.getClearAlpha=function(){return V.getClearAlpha()},this.setClearAlpha=function(){V.setClearAlpha.apply(V,arguments)},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),Ft.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){v.removeEventListener("webglcontextlost",i,!1),v.removeEventListener("webglcontextrestored",a,!1),j.dispose(),G.dispose(),D.dispose(),z.dispose(),zt.dispose(),Gt.stop()},this.renderBufferImmediate=function(t,e){R.initAttributes();var n=D.get(t);t.hasPositions&&!n.position&&(n.position=Ft.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=Ft.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=Ft.createBuffer()),t.hasColors&&!n.color&&(n.color=Ft.createBuffer()),e=e.getAttributes(),t.hasPositions&&(Ft.bindBuffer(34962,n.position),Ft.bufferData(34962,t.positionArray,35048),R.enableAttribute(e.position),Ft.vertexAttribPointer(e.position,3,5126,!1,0,0)),t.hasNormals&&(Ft.bindBuffer(34962,n.normal),Ft.bufferData(34962,t.normalArray,35048),R.enableAttribute(e.normal),Ft.vertexAttribPointer(e.normal,3,5126,!1,0,0)),t.hasUvs&&(Ft.bindBuffer(34962,n.uv),Ft.bufferData(34962,t.uvArray,35048),R.enableAttribute(e.uv),Ft.vertexAttribPointer(e.uv,2,5126,!1,0,0)),t.hasColors&&(Ft.bindBuffer(34962,n.color),Ft.bufferData(34962,t.colorArray,35048),R.enableAttribute(e.color),Ft.vertexAttribPointer(e.color,3,5126,!1,0,0)),R.disableUnusedAttributes(),Ft.drawArrays(4,0,t.count),t.count=0};var Ut=new f;this.renderBufferDirect=function(t,n,r,i,o,a){null===n&&(n=Ut);var s=o.isMesh&&0>o.matrixWorld.determinant(),l=y(t,n,i,o);R.setMaterial(i,s);var c=!1;if(e===r.id&&gt===l.id&&yt===(!0===i.wireframe)||(e=r.id,gt=l.id,yt=!0===i.wireframe,c=!0),(i.morphTargets||i.morphNormals)&&(H.update(o,r,i,l),c=!0),!0===o.isInstancedMesh&&(c=!0),t=r.index,n=r.attributes.position,null===t){if(void 0===n||0===n.count)return}else if(0===t.count)return;var u=1;if(!0===i.wireframe&&(t=F.getWireframeAttribute(r),u=2),s=W,null!==t){var h=k.get(t);s=q,s.setIndex(h)}if(c){if(!1!==P.isWebGL2||!o.isInstancedMesh&&!r.isInstancedBufferGeometry||null!==I.get("ANGLE_instanced_arrays")){R.initAttributes(),c=r.attributes,l=l.getAttributes();var p=i.defaultAttributeValues;for(M in l){var d=l[M];if(0<=d){var f=c[M];if(void 0!==f){var m=f.normalized,g=f.itemSize,v=k.get(f);if(void 0!==v){var _=v.buffer,x=v.type;if(v=v.bytesPerElement,f.isInterleavedBufferAttribute){var b=f.data,w=b.stride;f=f.offset,b&&b.isInstancedInterleavedBuffer?(R.enableAttributeAndDivisor(d,b.meshPerAttribute),void 0===r._maxInstanceCount&&(r._maxInstanceCount=b.meshPerAttribute*b.count)):R.enableAttribute(d),Ft.bindBuffer(34962,_),R.vertexAttribPointer(d,g,x,m,w*v,f*v)}else f.isInstancedBufferAttribute?(R.enableAttributeAndDivisor(d,f.meshPerAttribute),void 0===r._maxInstanceCount&&(r._maxInstanceCount=f.meshPerAttribute*f.count)):R.enableAttribute(d),Ft.bindBuffer(34962,_),R.vertexAttribPointer(d,g,x,m,0,0)}}else if("instanceMatrix"===M)v=k.get(o.instanceMatrix),void 0!==v&&(_=v.buffer,x=v.type,R.enableAttributeAndDivisor(d+0,1),R.enableAttributeAndDivisor(d+1,1),R.enableAttributeAndDivisor(d+2,1),R.enableAttributeAndDivisor(d+3,1),Ft.bindBuffer(34962,_),Ft.vertexAttribPointer(d+0,4,x,!1,64,0),Ft.vertexAttribPointer(d+1,4,x,!1,64,16),Ft.vertexAttribPointer(d+2,4,x,!1,64,32),Ft.vertexAttribPointer(d+3,4,x,!1,64,48));else if(void 0!==p&&(m=p[M],void 0!==m))switch(m.length){case 2:Ft.vertexAttrib2fv(d,m);break;case 3:Ft.vertexAttrib3fv(d,m);break;case 4:Ft.vertexAttrib4fv(d,m);break;default:Ft.vertexAttrib1fv(d,m)}}}R.disableUnusedAttributes()}null!==t&&Ft.bindBuffer(34963,h.buffer)}var M=r.drawRange.start*u;c=null!==a?a.start*u:0,h=Math.max(M,c),a=Math.max(0,Math.min(null!==t?t.count:n.count,M+r.drawRange.count*u,c+(null!==a?a.count*u:1/0))-1-h+1),0!==a&&(o.isMesh?!0===i.wireframe?(R.setLineWidth(i.wireframeLinewidth*(null===rt?St:1)),s.setMode(1)):s.setMode(4):o.isLine?(i=i.linewidth,void 0===i&&(i=1),R.setLineWidth(i*(null===rt?St:1)),o.isLineSegments?s.setMode(1):o.isLineLoop?s.setMode(2):s.setMode(3)):o.isPoints?s.setMode(0):o.isSprite&&s.setMode(4),o.isInstancedMesh?s.renderInstances(r,h,a,o.count):r.isInstancedBufferGeometry?s.renderInstances(r,h,a,Math.min(r.instanceCount,r._maxInstanceCount)):s.render(h,a))},this.compile=function(t,e){L=G.get(t,e),L.init(),t.traverse((function(t){t.isLight&&(L.pushLight(t),t.castShadow&&L.pushShadow(t))})),L.setupLights(e);var n={};t.traverse((function(e){var r=e.material;if(r)if(Array.isArray(r))for(var i=0;i<r.length;i++){var o=r[i];!1===o.uuid in n&&(g(o,t,e),n[o.uuid]=!0)}else!1===r.uuid in n&&(g(r,t,e),n[r.uuid]=!0)}))};var jt=null,Gt=new tt;Gt.setAnimationLoop((function(t){zt.isPresenting||jt&&jt(t)})),"undefined"!==typeof window&&Gt.setContext(window),this.setAnimationLoop=function(t){jt=t,zt.setAnimationLoop(t),Gt.start()},this.render=function(t,n,r,i){if(void 0!==r){console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.");var o=r}if(void 0!==i){console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead.");var a=i}n&&n.isCamera?Y||(gt=e=null,yt=!1,mt=-1,vt=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),zt.enabled&&zt.isPresenting&&(n=zt.getCamera(n)),t.onBeforeRender(Z,t,n,o||rt),L=G.get(t,n),L.init(),Nt.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Pt.setFromProjectionMatrix(Nt),Dt=this.localClippingEnabled,Ot=Rt.init(this.clippingPlanes,Dt,n),C=j.get(t,n),C.init(),p(t,n,0,Z.sortObjects),C.finish(),!0===Z.sortObjects&&C.sort(Tt,At),Ot&&Rt.beginShadows(),Bt.render(L.state.shadowsArray,t,n),L.setupLights(n),Ot&&Rt.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==o&&this.setRenderTarget(o),V.render(C,t,n,a),r=C.opaque,i=C.transparent,t.overrideMaterial?(o=t.overrideMaterial,r.length&&d(r,t,n,o),i.length&&d(i,t,n,o)):(r.length&&d(r,t,n),i.length&&d(i,t,n)),t.onAfterRender(Z,t,n),null!==rt&&(N.updateRenderTargetMipmap(rt),N.updateMultisampleRenderTarget(rt)),R.buffers.depth.setTest(!0),R.buffers.depth.setMask(!0),R.buffers.color.setMask(!0),R.setPolygonOffset(!1),L=C=null):console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){$!==t&&null===rt&&Ft.bindFramebuffer(36160,t),$=t},this.getActiveCubeFace=function(){return J},this.getActiveMipmapLevel=function(){return nt},this.getRenderTarget=function(){return rt},this.setRenderTarget=function(t,e,n){rt=t,J=e,nt=n,t&&void 0===D.get(t).__webglFramebuffer&&N.setupRenderTarget(t);var r=$,i=!1;t?(r=D.get(t).__webglFramebuffer,t.isWebGLCubeRenderTarget?(r=r[e||0],i=!0):r=t.isWebGLMultisampleRenderTarget?D.get(t).__webglMultisampledFramebuffer:r,xt.copy(t.viewport),bt.copy(t.scissor),wt=t.scissorTest):(xt.copy(Ct).multiplyScalar(St).floor(),bt.copy(Lt).multiplyScalar(St).floor(),wt=It),pt!==r&&(Ft.bindFramebuffer(36160,r),pt=r),R.viewport(xt),R.scissor(bt),R.setScissorTest(wt),i&&(t=D.get(t.texture),Ft.framebufferTexture2D(36160,36064,34069+(e||0),t.__webglTexture,n||0))},this.readRenderTargetPixels=function(t,e,n,r,i,o,a){if(t&&t.isWebGLRenderTarget){var s=D.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){a=!1,s!==pt&&(Ft.bindFramebuffer(36160,s),a=!0);try{var l=t.texture,c=l.format,u=l.type;1023!==c&&X.convert(c)!==Ft.getParameter(35739)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===u||X.convert(u)===Ft.getParameter(35738)||1015===u&&(P.isWebGL2||I.get("OES_texture_float")||I.get("WEBGL_color_buffer_float"))||1016===u&&(P.isWebGL2?I.get("EXT_color_buffer_float"):I.get("EXT_color_buffer_half_float"))?36053===Ft.checkFramebufferStatus(36160)?0<=e&&e<=t.width-r&&0<=n&&n<=t.height-i&&Ft.readPixels(e,n,r,i,X.convert(c),X.convert(u),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{a&&Ft.bindFramebuffer(36160,pt)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(e.image.width*r);r=Math.floor(e.image.height*r);var o=X.convert(e.format);N.setTexture2D(e,0),Ft.copyTexImage2D(3553,n,o,t.x,t.y,i,r,0),R.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r){void 0===r&&(r=0);var i=e.image.width,o=e.image.height,a=X.convert(n.format),s=X.convert(n.type);N.setTexture2D(n,0),e.isDataTexture?Ft.texSubImage2D(3553,r,t.x,t.y,i,o,a,s,e.image.data):e.isCompressedTexture?Ft.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):Ft.texSubImage2D(3553,r,t.x,t.y,a,s,e.image),0===r&&n.generateMipmaps&&Ft.generateMipmap(3553),R.unbindTexture()},this.initTexture=function(t){N.setTexture2D(t,0),R.unbindTexture()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function qe(t,e){this.name="",this.color=new b(t),this.density=void 0!==e?e:25e-5}function Xe(t,e,n){this.name="",this.color=new b(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function Ze(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function Ye(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function $e(t){T.call(this),this.type="SpriteMaterial",this.color=new b(16777215),this.alphaMap=this.map=null,this.rotation=0,this.transparent=this.sizeAttenuation=!0,this.setValues(t)}function Je(t){if(d.call(this),this.type="Sprite",void 0===tl){tl=new U;var e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);e=new Ze(e,5),tl.setIndex([0,1,2,0,2,3]),tl.setAttribute("position",new Ye(e,3,0,!1)),tl.setAttribute("uv",new Ye(e,2,3,!1))}this.geometry=tl,this.material=void 0!==t?t:new $e,this.center=new n(.5,.5)}function Ke(t,e,n,r,i,o){il.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(ol.x=o*il.x-i*il.y,ol.y=i*il.x+o*il.y):ol.copy(il),t.copy(e),t.x+=ol.x,t.y+=ol.y,t.applyMatrix4(al)}function Qe(){d.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function tn(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),j.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new u,this.bindMatrixInverse=new u}function en(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new u)}function nn(){d.call(this),this.type="Bone"}function rn(t,e,n){j.call(this,t,e),this.instanceMatrix=new C(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function on(t){T.call(this),this.type="LineBasicMaterial",this.color=new b(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.morphTargets=!1,this.setValues(t)}function an(t,e,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),d.call(this),this.type="Line",this.geometry=void 0!==t?t:new U,this.material=void 0!==e?e:new on,this.updateMorphTargets()}function sn(t,e){an.call(this,t,e),this.type="LineSegments"}function ln(t,e){an.call(this,t,e),this.type="LineLoop"}function cn(t){T.call(this),this.type="PointsMaterial",this.color=new b(16777215),this.alphaMap=this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}function un(t,e){d.call(this),this.type="Points",this.geometry=void 0!==t?t:new U,this.material=void 0!==e?e:new cn,this.updateMorphTargets()}function hn(t,e,n,r,i,o,a){var s=Ll.distanceSqToPoint(t);s<n&&(n=new c,Ll.closestPointToPoint(t,n),n.applyMatrix4(r),t=i.ray.origin.distanceTo(n),t<i.near||t>i.far||o.push({distance:t,distanceToRay:Math.sqrt(s),point:n,index:e,face:null,object:a}))}function pn(t,e,n,r,o,a,s,l,c){i.call(this,t,e,n,r,o,a,s,l,c),this.format=void 0!==s?s:1022,this.minFilter=void 0!==a?a:1006,this.magFilter=void 0!==o?o:1006,this.generateMipmaps=!1}function dn(t,e,n,r,o,a,s,l,c,u,h,p){i.call(this,null,a,s,l,c,u,r,o,h,p),this.image={width:e,height:n},this.mipmaps=t,this.generateMipmaps=this.flipY=!1}function fn(t,e,n,r,o,a,s,l,c){i.call(this,t,e,n,r,o,a,s,l,c),this.needsUpdate=!0}function mn(t,e,n,r,o,a,s,l,c,u){if(u=void 0!==u?u:1026,1026!==u&&1027!==u)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===u&&(n=1012),void 0===n&&1027===u&&(n=1020),i.call(this,null,r,o,a,s,l,u,n,c),this.image={width:t,height:e},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==l?l:1003,this.generateMipmaps=this.flipY=!1}function gn(t){U.call(this),this.type="WireframeGeometry";var e,n,r,i=[],o=[0,0],a={},s=["a","b","c"];if(t&&t.isGeometry){var l=t.faces,u=0;for(n=l.length;u<n;u++){var h=l[u];for(e=0;3>e;e++){var p=h[s[e]],d=h[s[(e+1)%3]];o[0]=Math.min(p,d),o[1]=Math.max(p,d),p=o[0]+","+o[1],void 0===a[p]&&(a[p]={index1:o[0],index2:o[1]})}}for(p in a)u=a[p],s=t.vertices[u.index1],i.push(s.x,s.y,s.z),s=t.vertices[u.index2],i.push(s.x,s.y,s.z)}else if(t&&t.isBufferGeometry)if(s=new c,null!==t.index){l=t.attributes.position,h=t.index;var f=t.groups;for(0===f.length&&(f=[{start:0,count:h.count,materialIndex:0}]),t=0,r=f.length;t<r;++t)for(u=f[t],e=u.start,n=u.count,u=e,n=e+n;u<n;u+=3)for(e=0;3>e;e++)p=h.getX(u+e),d=h.getX(u+(e+1)%3),o[0]=Math.min(p,d),o[1]=Math.max(p,d),p=o[0]+","+o[1],void 0===a[p]&&(a[p]={index1:o[0],index2:o[1]});for(p in a)u=a[p],s.fromBufferAttribute(l,u.index1),i.push(s.x,s.y,s.z),s.fromBufferAttribute(l,u.index2),i.push(s.x,s.y,s.z)}else for(l=t.attributes.position,u=0,n=l.count/3;u<n;u++)for(e=0;3>e;e++)a=3*u+e,s.fromBufferAttribute(l,a),i.push(s.x,s.y,s.z),a=3*u+(e+1)%3,s.fromBufferAttribute(l,a),i.push(s.x,s.y,s.z);this.setAttribute("position",new k(i,3))}function yn(t,e,n){H.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new vn(t,e,n)),this.mergeVertices()}function vn(t,e,n){U.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};var r,i,o=[],a=[],s=[],l=[],u=new c,h=new c,p=new c,d=new c,f=new c;3>t.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=e+1;for(r=0;r<=n;r++){var g=r/n;for(i=0;i<=e;i++){var y=i/e;t(y,g,h),a.push(h.x,h.y,h.z),0<=y-1e-5?(t(y-1e-5,g,p),d.subVectors(h,p)):(t(y+1e-5,g,p),d.subVectors(p,h)),0<=g-1e-5?(t(y,g-1e-5,p),f.subVectors(h,p)):(t(y,g+1e-5,p),f.subVectors(p,h)),u.crossVectors(d,f).normalize(),s.push(u.x,u.y,u.z),l.push(y,g)}}for(r=0;r<n;r++)for(i=0;i<e;i++)t=r*m+i+1,u=(r+1)*m+i+1,h=(r+1)*m+i,o.push(r*m+i,t,h),o.push(t,u,h);this.setIndex(o),this.setAttribute("position",new k(a,3)),this.setAttribute("normal",new k(s,3)),this.setAttribute("uv",new k(l,2))}function _n(t,e,n,r){H.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new xn(t,e,n,r)),this.mergeVertices()}function xn(t,e,r,i){function o(t){l.push(t.x,t.y,t.z)}function a(e,n){e*=3,n.x=t[e+0],n.y=t[e+1],n.z=t[e+2]}function s(t,e,n,r){0>r&&1===t.x&&(u[e]=t.x-1),0===n.x&&0===n.z&&(u[e]=r/2/Math.PI+.5)}U.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:i},r=r||1,i=i||0;var l=[],u=[];(function(t){for(var n=new c,r=new c,i=new c,s=0;s<e.length;s+=3){a(e[s+0],n),a(e[s+1],r),a(e[s+2],i);var l,u,h=n,p=r,d=i,f=Math.pow(2,t),m=[];for(u=0;u<=f;u++){m[u]=[];var g=h.clone().lerp(d,u/f),y=p.clone().lerp(d,u/f),v=f-u;for(l=0;l<=v;l++)m[u][l]=0===l&&u===f?g:g.clone().lerp(y,l/v)}for(u=0;u<f;u++)for(l=0;l<2*(f-u)-1;l++)h=Math.floor(l/2),0===l%2?(o(m[u][h+1]),o(m[u+1][h]),o(m[u][h])):(o(m[u][h+1]),o(m[u+1][h+1]),o(m[u+1][h]))}})(i),function(t){for(var e=new c,n=0;n<l.length;n+=3)e.x=l[n+0],e.y=l[n+1],e.z=l[n+2],e.normalize().multiplyScalar(t),l[n+0]=e.x,l[n+1]=e.y,l[n+2]=e.z}(r),function(){for(var t=new c,e=0;e<l.length;e+=3)t.x=l[e+0],t.y=l[e+1],t.z=l[e+2],u.push(Math.atan2(t.z,-t.x)/2/Math.PI+.5,1-(Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5));t=new c,e=new c;for(var r=new c,i=new c,o=new n,a=new n,h=new n,p=0,d=0;p<l.length;p+=9,d+=6){t.set(l[p+0],l[p+1],l[p+2]),e.set(l[p+3],l[p+4],l[p+5]),r.set(l[p+6],l[p+7],l[p+8]),o.set(u[d+0],u[d+1]),a.set(u[d+2],u[d+3]),h.set(u[d+4],u[d+5]),i.copy(t).add(e).add(r).divideScalar(3);var f=Math.atan2(i.z,-i.x);s(o,d+0,t,f),s(a,d+2,e,f),s(h,d+4,r,f)}for(t=0;t<u.length;t+=6)e=u[t+0],r=u[t+2],i=u[t+4],o=Math.min(e,r,i),.9<Math.max(e,r,i)&&.1>o&&(.2>e&&(u[t+0]+=1),.2>r&&(u[t+2]+=1),.2>i&&(u[t+4]+=1))}(),this.setAttribute("position",new k(l,3)),this.setAttribute("normal",new k(l.slice(),3)),this.setAttribute("uv",new k(u,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}function bn(t,e){H.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new wn(t,e)),this.mergeVertices()}function wn(t,e){xn.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Mn(t,e){H.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new En(t,e)),this.mergeVertices()}function En(t,e){xn.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Sn(t,e){H.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Tn(t,e)),this.mergeVertices()}function Tn(t,e){var n=(1+Math.sqrt(5))/2;xn.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function An(t,e){H.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Cn(t,e)),this.mergeVertices()}function Cn(t,e){var n=(1+Math.sqrt(5))/2,r=1/n;xn.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ln(t,e,n,r,i,o){H.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed."),t=new In(t,e,n,r,i),this.tangents=t.tangents,this.normals=t.normals,this.binormals=t.binormals,this.fromBufferGeometry(t),this.mergeVertices()}function In(t,e,r,i,o){function a(n){f=t.getPointAt(n/e,f);var o=s.normals[n];for(n=s.binormals[n],u=0;u<=i;u++){var a=u/i*Math.PI*2,l=Math.sin(a);a=-Math.cos(a),p.x=a*o.x+l*n.x,p.y=a*o.y+l*n.y,p.z=a*o.z+l*n.z,p.normalize(),g.push(p.x,p.y,p.z),h.x=f.x+r*p.x,h.y=f.y+r*p.y,h.z=f.z+r*p.z,m.push(h.x,h.y,h.z)}}U.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:i,closed:o},e=e||64,r=r||1,i=i||8,o=o||!1;var s=t.computeFrenetFrames(e,o);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;var l,u,h=new c,p=new c,d=new n,f=new c,m=[],g=[],y=[],v=[];for(l=0;l<e;l++)a(l);for(a(!1===o?e:0),l=0;l<=e;l++)for(u=0;u<=i;u++)d.x=l/e,d.y=u/i,y.push(d.x,d.y);(function(){for(u=1;u<=e;u++)for(l=1;l<=i;l++){var t=(i+1)*u+(l-1),n=(i+1)*u+l,r=(i+1)*(u-1)+l;v.push((i+1)*(u-1)+(l-1),t,r),v.push(t,n,r)}})(),this.setIndex(v),this.setAttribute("position",new k(m,3)),this.setAttribute("normal",new k(g,3)),this.setAttribute("uv",new k(y,2))}function Pn(t,e,n,r,i,o,a){H.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Rn(t,e,n,r,i,o)),this.mergeVertices()}function Rn(t,e,n,r,i,o){function a(t,e,n,r,i){var o=Math.sin(t);e=n/e*t,n=Math.cos(e),i.x=r*(2+n)*.5*Math.cos(t),i.y=r*(2+n)*o*.5,i.z=r*Math.sin(e)*.5}U.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:i,q:o},t=t||1,e=e||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,o=o||3;var s,l=[],u=[],h=[],p=[],d=new c,f=new c,m=new c,g=new c,y=new c,v=new c,_=new c;for(s=0;s<=n;++s){var x=s/n*i*Math.PI*2;for(a(x,i,o,t,m),a(x+.01,i,o,t,g),v.subVectors(g,m),_.addVectors(g,m),y.crossVectors(v,_),_.crossVectors(y,v),y.normalize(),_.normalize(),x=0;x<=r;++x){var b=x/r*Math.PI*2,w=-e*Math.cos(b);b=e*Math.sin(b),d.x=m.x+(w*_.x+b*y.x),d.y=m.y+(w*_.y+b*y.y),d.z=m.z+(w*_.z+b*y.z),u.push(d.x,d.y,d.z),f.subVectors(d,m).normalize(),h.push(f.x,f.y,f.z),p.push(s/n),p.push(x/r)}}for(x=1;x<=n;x++)for(s=1;s<=r;s++)t=(r+1)*x+(s-1),e=(r+1)*x+s,i=(r+1)*(x-1)+s,l.push((r+1)*(x-1)+(s-1),t,i),l.push(t,e,i);this.setIndex(l),this.setAttribute("position",new k(u,3)),this.setAttribute("normal",new k(h,3)),this.setAttribute("uv",new k(p,2))}function On(t,e,n,r,i){H.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new Dn(t,e,n,r,i)),this.mergeVertices()}function Dn(t,e,n,r,i){U.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:i},t=t||1,e=e||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var o,a,s=[],l=[],u=[],h=[],p=new c,d=new c,f=new c;for(o=0;o<=n;o++)for(a=0;a<=r;a++){var m=a/r*i,g=o/n*Math.PI*2;d.x=(t+e*Math.cos(g))*Math.cos(m),d.y=(t+e*Math.cos(g))*Math.sin(m),d.z=e*Math.sin(g),l.push(d.x,d.y,d.z),p.x=t*Math.cos(m),p.y=t*Math.sin(m),f.subVectors(d,p).normalize(),u.push(f.x,f.y,f.z),h.push(a/r),h.push(o/n)}for(o=1;o<=n;o++)for(a=1;a<=r;a++)t=(r+1)*(o-1)+a-1,e=(r+1)*(o-1)+a,i=(r+1)*o+a,s.push((r+1)*o+a-1,t,i),s.push(t,e,i);this.setIndex(s),this.setAttribute("position",new k(l,3)),this.setAttribute("normal",new k(u,3)),this.setAttribute("uv",new k(h,2))}function Nn(t,e,n,r,i){for(var o,a=0,s=e,l=n-r;s<n;s+=r)a+=(t[l]-t[s])*(t[s+1]+t[l+1]),l=s;if(i===0<a)for(i=e;i<n;i+=r)o=Jn(i,t[i],t[i+1],o);else for(i=n-r;i>=e;i-=r)o=Jn(i,t[i],t[i+1],o);return o&&Wn(o,o.next)&&(Kn(o),o=o.next),o}function kn(t,e){if(!t)return t;e||(e=t);do{var n=!1;if(t.steiner||!Wn(t,t.next)&&0!==Hn(t.prev,t,t.next))t=t.next;else{if(Kn(t),t=e=t.prev,t===t.next)break;n=!0}}while(n||t!==e);return e}function Fn(t,e,n,r,i,o,a){if(t){if(!a&&o){var s=t,l=s;do{null===l.z&&(l.z=jn(l.x,l.y,r,i,o)),l.prevZ=l.prev,l=l.nextZ=l.next}while(l!==s);l.prevZ.nextZ=null,l.prevZ=null,s=l;var c,u,h,p,d=1;do{l=s;var f=s=null;for(u=0;l;){u++;var m=l;for(c=h=0;c<d&&(h++,m=m.nextZ,m);c++);for(p=d;0<h||0<p&&m;)0!==h&&(0===p||!m||l.z<=m.z)?(c=l,l=l.nextZ,h--):(c=m,m=m.nextZ,p--),f?f.nextZ=c:s=c,c.prevZ=f,f=c;l=m}f.nextZ=null,d*=2}while(1<u)}for(s=t;t.prev!==t.next;){if(l=t.prev,m=t.next,o)f=zn(t,r,i,o);else t:if(f=t,u=f.prev,h=f,d=f.next,0<=Hn(u,h,d))f=!1;else{for(c=f.next.next;c!==f.prev;){if(Vn(u.x,u.y,h.x,h.y,d.x,d.y,c.x,c.y)&&0<=Hn(c.prev,c,c.next)){f=!1;break t}c=c.next}f=!0}if(f)e.push(l.i/n),e.push(t.i/n),e.push(m.i/n),Kn(t),s=t=m.next;else if(t=m,t===s){if(a){if(1===a){t=kn(t),a=e,s=n,l=t;do{m=l.prev,f=l.next.next,!Wn(m,f)&&qn(m,l,l.next,f)&&Yn(m,f)&&Yn(f,m)&&(a.push(m.i/s),a.push(l.i/s),a.push(f.i/s),Kn(l),Kn(l.next),l=t=f),l=l.next}while(l!==t);t=kn(l),Fn(t,e,n,r,i,o,2)}else if(2===a)t:{a=t;do{for(s=a.next.next;s!==a.prev;){if(l=a.i!==s.i){if(l=a,m=s,f=l.next.i!==m.i&&l.prev.i!==m.i){e:{f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==m.i&&f.next.i!==m.i&&qn(f,f.next,l,m)){f=!0;break e}f=f.next}while(f!==l);f=!1}f=!f}if(f){if(f=Yn(l,m)&&Yn(m,l)){f=l,u=!1,h=(l.x+m.x)/2,d=(l.y+m.y)/2;do{f.y>d!==f.next.y>d&&f.next.y!==f.y&&h<(f.next.x-f.x)*(d-f.y)/(f.next.y-f.y)+f.x&&(u=!u),f=f.next}while(f!==l);f=u}f=f&&(Hn(l.prev,l,m.prev)||Hn(l,m.prev,m))||Wn(l,m)&&0<Hn(l.prev,l,l.next)&&0<Hn(m.prev,m,m.next)}l=f}if(l){t=$n(a,s),a=kn(a,a.next),t=kn(t,t.next),Fn(a,e,n,r,i,o),Fn(t,e,n,r,i,o);break t}s=s.next}a=a.next}while(a!==t)}}else Fn(kn(t),e,n,r,i,o,1);break}}}}function zn(t,e,n,r){var i=t.prev,o=t.next;if(0<=Hn(i,t,o))return!1;var a=i.x>t.x?i.x>o.x?i.x:o.x:t.x>o.x?t.x:o.x,s=i.y>t.y?i.y>o.y?i.y:o.y:t.y>o.y?t.y:o.y,l=jn(i.x<t.x?i.x<o.x?i.x:o.x:t.x<o.x?t.x:o.x,i.y<t.y?i.y<o.y?i.y:o.y:t.y<o.y?t.y:o.y,e,n,r);for(e=jn(a,s,e,n,r),n=t.prevZ,r=t.nextZ;n&&n.z>=l&&r&&r.z<=e;){if(n!==t.prev&&n!==t.next&&Vn(i.x,i.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=Hn(n.prev,n,n.next))return!1;if(n=n.prevZ,r!==t.prev&&r!==t.next&&Vn(i.x,i.y,t.x,t.y,o.x,o.y,r.x,r.y)&&0<=Hn(r.prev,r,r.next))return!1;r=r.nextZ}for(;n&&n.z>=l;){if(n!==t.prev&&n!==t.next&&Vn(i.x,i.y,t.x,t.y,o.x,o.y,n.x,n.y)&&0<=Hn(n.prev,n,n.next))return!1;n=n.prevZ}for(;r&&r.z<=e;){if(r!==t.prev&&r!==t.next&&Vn(i.x,i.y,t.x,t.y,o.x,o.y,r.x,r.y)&&0<=Hn(r.prev,r,r.next))return!1;r=r.nextZ}return!0}function Bn(t,e){return t.x-e.x}function Un(t,e){var n=e,r=t.x,i=t.y,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(i===n.y)return n;if(i===n.next.y)return n.next}var s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(r===o)return s;e=s,a=s.x;var l=s.y,c=1/0;n=s;do{if(r>=n.x&&n.x>=a&&r!==n.x&&Vn(i<l?r:o,i,a,l,i<l?o:r,i,n.x,n.y)){var u,h=Math.abs(i-n.y)/(r-n.x);if((u=Yn(n,t))&&!(u=h<c)&&(u=h===c)&&!(u=n.x>s.x)&&(u=n.x===s.x)){u=s;var p=n;u=0>Hn(u.prev,u,p.prev)&&0>Hn(p.next,u,u.next)}u&&(s=n,c=h)}n=n.next}while(n!==e);return s}function jn(t,e,n,r,i){return t=32767*(t-n)*i,e=32767*(e-r)*i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),1431655765&(t|t<<1)|(1431655765&(e|e<<1))<<1}function Gn(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Vn(t,e,n,r,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(r-s)-(n-a)*(e-s)&&0<=(n-a)*(o-s)-(i-a)*(r-s)}function Hn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Wn(t,e){return t.x===e.x&&t.y===e.y}function qn(t,e,n,r){var i=Zn(Hn(t,e,n)),o=Zn(Hn(t,e,r)),a=Zn(Hn(n,r,t)),s=Zn(Hn(n,r,e));return!!(i!==o&&a!==s||0===i&&Xn(t,n,e)||0===o&&Xn(t,r,e)||0===a&&Xn(n,t,r)||0===s&&Xn(n,e,r))}function Xn(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Zn(t){return 0<t?1:0>t?-1:0}function Yn(t,e){return 0>Hn(t.prev,t,t.next)?0<=Hn(t,e,t.next)&&0<=Hn(t,t.prev,e):0>Hn(t,e,t.prev)||0>Hn(t,t.next,e)}function $n(t,e){var n=new Qn(t.i,t.x,t.y),r=new Qn(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Jn(t,e,n,r){return t=new Qn(t,e,n),r?(t.next=r.next,t.prev=r,r.next.prev=t,r.next=t):(t.prev=t,t.next=t),t}function Kn(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Qn(t,e,n){this.i=t,this.x=e,this.y=n,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function tr(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function er(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function nr(t,e){H.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new rr(t,e)),this.mergeVertices()}function rr(t,e){function r(t){function r(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}function s(t,e,r){var i=t.x-e.x,o=t.y-e.y,a=r.x-t.x,s=r.y-t.y,l=i*i+o*o;if(Math.abs(i*s-o*a)>Number.EPSILON){var c=Math.sqrt(l),u=Math.sqrt(a*a+s*s);if(l=e.x-o/c,e=e.y+i/c,s=((r.x-s/u-l)*s-(r.y+a/u-e)*a)/(i*s-o*a),a=l+i*s-t.x,i=e+o*s-t.y,o=a*a+i*i,2>=o)return new n(a,i);o=Math.sqrt(o/2)}else t=!1,i>Number.EPSILON?a>Number.EPSILON&&(t=!0):i<-Number.EPSILON?a<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(s)&&(t=!0),t?(a=-o,o=Math.sqrt(l)):(a=i,i=o,o=Math.sqrt(l/2));return new n(a/o,i/o)}function l(t,e){for(j=t.length;0<=--j;){var n=j,r=j-1;0>r&&(r=t.length-1);var a,s=g+2*w;for(a=0;a<s;a++){var l=B*a,c=B*(a+1),u=e+r+l,h=e+r+c;c=e+n+c,p(e+n+l),p(u),p(c),p(u),p(h),p(c),l=o.length/3,l=E.generateSideWallUV(i,o,l-6,l-3,l-2,l-1),d(l[0]),d(l[1]),d(l[3]),d(l[1]),d(l[2]),d(l[3])}}}function u(t,e,n){f.push(t),f.push(e),f.push(n)}function h(t,e,n){p(t),p(e),p(n),t=o.length/3,t=E.generateTopUV(i,o,t-3,t-2,t-1),d(t[0]),d(t[1]),d(t[2])}function p(t){o.push(f[3*t]),o.push(f[3*t+1]),o.push(f[3*t+2])}function d(t){a.push(t.x),a.push(t.y)}var f=[],m=void 0!==e.curveSegments?e.curveSegments:12,g=void 0!==e.steps?e.steps:1,y=void 0!==e.depth?e.depth:100,v=void 0===e.bevelEnabled||e.bevelEnabled,_=void 0!==e.bevelThickness?e.bevelThickness:6,x=void 0!==e.bevelSize?e.bevelSize:_-2,b=void 0!==e.bevelOffset?e.bevelOffset:0,w=void 0!==e.bevelSegments?e.bevelSegments:3,M=e.extrudePath,E=void 0!==e.UVGenerator?e.UVGenerator:Dl;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),y=e.amount);var S,T=!1;if(M){var A=M.getSpacedPoints(g);T=!0,v=!1;var C=M.computeFrenetFrames(g,!1),L=new c,I=new c,P=new c}v||(b=x=_=w=0),m=t.extractPoints(m),t=m.shape;var R=m.holes;if(!Ol.isClockWise(t)){t=t.reverse();var O=0;for(S=R.length;O<S;O++){var D=R[O];Ol.isClockWise(D)&&(R[O]=D.reverse())}}var N=Ol.triangulateShape(t,R),k=t;for(O=0,S=R.length;O<S;O++)D=R[O],t=t.concat(D);var F,z,B=t.length,U=N.length;m=[];var j=0,G=k.length,V=G-1;for(F=j+1;j<G;j++,V++,F++)V===G&&(V=0),F===G&&(F=0),m[j]=s(k[j],k[V],k[F]);M=[];var H=m.concat();for(O=0,S=R.length;O<S;O++){D=R[O];var W=[];for(j=0,G=D.length,V=G-1,F=j+1;j<G;j++,V++,F++)V===G&&(V=0),F===G&&(F=0),W[j]=s(D[j],D[V],D[F]);M.push(W),H=H.concat(W)}for(V=0;V<w;V++){G=V/w;var q=_*Math.cos(G*Math.PI/2);for(F=x*Math.sin(G*Math.PI/2)+b,j=0,G=k.length;j<G;j++){var X=r(k[j],m[j],F);u(X.x,X.y,-q)}for(O=0,S=R.length;O<S;O++)for(D=R[O],W=M[O],j=0,G=D.length;j<G;j++)X=r(D[j],W[j],F),u(X.x,X.y,-q)}for(F=x+b,j=0;j<B;j++)X=v?r(t[j],H[j],F):t[j],T?(I.copy(C.normals[0]).multiplyScalar(X.x),L.copy(C.binormals[0]).multiplyScalar(X.y),P.copy(A[0]).add(I).add(L),u(P.x,P.y,P.z)):u(X.x,X.y,0);for(G=1;G<=g;G++)for(j=0;j<B;j++)X=v?r(t[j],H[j],F):t[j],T?(I.copy(C.normals[G]).multiplyScalar(X.x),L.copy(C.binormals[G]).multiplyScalar(X.y),P.copy(A[G]).add(I).add(L),u(P.x,P.y,P.z)):u(X.x,X.y,y/g*G);for(V=w-1;0<=V;V--){for(G=V/w,q=_*Math.cos(G*Math.PI/2),F=x*Math.sin(G*Math.PI/2)+b,j=0,G=k.length;j<G;j++)X=r(k[j],m[j],F),u(X.x,X.y,y+q);for(O=0,S=R.length;O<S;O++)for(D=R[O],W=M[O],j=0,G=D.length;j<G;j++)X=r(D[j],W[j],F),T?u(X.x,X.y+A[g-1].y,A[g-1].x+q):u(X.x,X.y,y+q)}(function(){var t=o.length/3;if(v){var e=0*B;for(j=0;j<U;j++)z=N[j],h(z[2]+e,z[1]+e,z[0]+e);for(e=B*(g+2*w),j=0;j<U;j++)z=N[j],h(z[0]+e,z[1]+e,z[2]+e)}else{for(j=0;j<U;j++)z=N[j],h(z[2],z[1],z[0]);for(j=0;j<U;j++)z=N[j],h(z[0]+B*g,z[1]+B*g,z[2]+B*g)}i.addGroup(t,o.length/3-t,0)})(),function(){var t=o.length/3,e=0;for(l(k,e),e+=k.length,O=0,S=R.length;O<S;O++)D=R[O],l(D,e),e+=D.length;i.addGroup(t,o.length/3-t,1)}()}U.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var i=this,o=[],a=[],s=0,l=t.length;s<l;s++)r(t[s]);this.setAttribute("position",new k(o,3)),this.setAttribute("uv",new k(a,2)),this.computeVertexNormals()}function ir(t,e,n){if(n.shapes=[],Array.isArray(t))for(var r=0,i=t.length;r<i;r++)n.shapes.push(t[r].uuid);else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}function or(t,e){H.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new ar(t,e)),this.mergeVertices()}function ar(t,e){e=e||{};var n=e.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new H;t=n.generateShapes(t,e.size),e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),rr.call(this,t,e),this.type="TextBufferGeometry"}function sr(t,e,n,r,i,o,a){H.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new lr(t,e,n,r,i,o,a)),this.mergeVertices()}function lr(t,e,n,r,i,o,a){U.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,u=Math.min(o+a,Math.PI),h=0,p=[],d=new c,f=new c,m=[],g=[],y=[],v=[];for(l=0;l<=n;l++){var _=[],x=l/n,b=0;for(0==l&&0==o?b=.5/e:l==n&&u==Math.PI&&(b=-.5/e),s=0;s<=e;s++){var w=s/e;d.x=-t*Math.cos(r+w*i)*Math.sin(o+x*a),d.y=t*Math.cos(o+x*a),d.z=t*Math.sin(r+w*i)*Math.sin(o+x*a),g.push(d.x,d.y,d.z),f.copy(d).normalize(),y.push(f.x,f.y,f.z),v.push(w+b,1-x),_.push(h++)}p.push(_)}for(l=0;l<n;l++)for(s=0;s<e;s++)t=p[l][s+1],r=p[l][s],i=p[l+1][s],a=p[l+1][s+1],(0!==l||0<o)&&m.push(t,r,a),(l!==n-1||u<Math.PI)&&m.push(r,i,a);this.setIndex(m),this.setAttribute("position",new k(g,3)),this.setAttribute("normal",new k(y,3)),this.setAttribute("uv",new k(v,2))}function cr(t,e,n,r,i,o){H.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new ur(t,e,n,r,i,o)),this.mergeVertices()}function ur(t,e,r,i,o,a){U.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:a},t=t||.5,e=e||1,o=void 0!==o?o:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(1,i):1;var s,l,u=[],h=[],p=[],d=[],f=t,m=(e-t)/i,g=new c,y=new n;for(s=0;s<=i;s++){for(l=0;l<=r;l++)t=o+l/r*a,g.x=f*Math.cos(t),g.y=f*Math.sin(t),h.push(g.x,g.y,g.z),p.push(0,0,1),y.x=(g.x/e+1)/2,y.y=(g.y/e+1)/2,d.push(y.x,y.y);f+=m}for(s=0;s<i;s++)for(e=s*(r+1),l=0;l<r;l++)t=l+e,o=t+r+1,a=t+r+2,f=t+1,u.push(t,o,f),u.push(o,a,f);this.setIndex(u),this.setAttribute("position",new k(h,3)),this.setAttribute("normal",new k(p,3)),this.setAttribute("uv",new k(d,2))}function hr(t,e,n,r){H.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new pr(t,e,n,r)),this.mergeVertices()}function pr(t,e,r,i){U.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:i},e=Math.floor(e)||12,r=r||0,i=i||2*Math.PI,i=Vo.clamp(i,0,2*Math.PI);var o,a=[],s=[],l=[],u=1/e,h=new c,p=new n;for(o=0;o<=e;o++){var d=r+o*u*i,f=Math.sin(d),m=Math.cos(d);for(d=0;d<=t.length-1;d++)h.x=t[d].x*f,h.y=t[d].y,h.z=t[d].x*m,s.push(h.x,h.y,h.z),p.x=o/e,p.y=d/(t.length-1),l.push(p.x,p.y)}for(o=0;o<e;o++)for(d=0;d<t.length-1;d++)r=d+o*t.length,u=r+t.length,h=r+t.length+1,p=r+1,a.push(r,u,p),a.push(u,h,p);if(this.setIndex(a),this.setAttribute("position",new k(s,3)),this.setAttribute("uv",new k(l,2)),this.computeVertexNormals(),i===2*Math.PI)for(i=this.attributes.normal.array,a=new c,s=new c,l=new c,r=e*t.length*3,d=o=0;o<t.length;o++,d+=3)a.x=i[d+0],a.y=i[d+1],a.z=i[d+2],s.x=i[r+d+0],s.y=i[r+d+1],s.z=i[r+d+2],l.addVectors(a,s).normalize(),i[d+0]=i[r+d+0]=l.x,i[d+1]=i[r+d+1]=l.y,i[d+2]=i[r+d+2]=l.z}function dr(t,e){H.call(this),this.type="ShapeGeometry","object"===typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new fr(t,e)),this.mergeVertices()}function fr(t,e){function n(t){var n,s=i.length/3;t=t.extractPoints(e);var c=t.shape,u=t.holes;for(!1===Ol.isClockWise(c)&&(c=c.reverse()),t=0,n=u.length;t<n;t++){var h=u[t];!0===Ol.isClockWise(h)&&(u[t]=h.reverse())}var p=Ol.triangulateShape(c,u);for(t=0,n=u.length;t<n;t++)h=u[t],c=c.concat(h);for(t=0,n=c.length;t<n;t++)h=c[t],i.push(h.x,h.y,0),o.push(0,0,1),a.push(h.x,h.y);for(t=0,n=p.length;t<n;t++)c=p[t],r.push(c[0]+s,c[1]+s,c[2]+s),l+=3}U.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],i=[],o=[],a=[],s=0,l=0;if(!1===Array.isArray(t))n(t);else for(var c=0;c<t.length;c++)n(t[c]),this.addGroup(s,l,c),s+=l,l=0;this.setIndex(r),this.setAttribute("position",new k(i,3)),this.setAttribute("normal",new k(o,3)),this.setAttribute("uv",new k(a,2))}function mr(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++)e.shapes.push(t[n].uuid);else e.shapes.push(t.uuid);return e}function gr(t,e){U.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e};var n=[];e=Math.cos(Vo.DEG2RAD*(void 0!==e?e:1));var r=[0,0],i={},o=["a","b","c"];if(t.isBufferGeometry){var a=new H;a.fromBufferGeometry(t)}else a=t.clone();a.mergeVertices(),a.computeFaceNormals(),t=a.vertices,a=a.faces;for(var s=0,l=a.length;s<l;s++)for(var c=a[s],u=0;3>u;u++){var h=c[o[u]],p=c[o[(u+1)%3]];r[0]=Math.min(h,p),r[1]=Math.max(h,p),h=r[0]+","+r[1],void 0===i[h]?i[h]={index1:r[0],index2:r[1],face1:s,face2:void 0}:i[h].face2=s}for(h in i)r=i[h],(void 0===r.face2||a[r.face1].normal.dot(a[r.face2].normal)<=e)&&(o=t[r.index1],n.push(o.x,o.y,o.z),o=t[r.index2],n.push(o.x,o.y,o.z));this.setAttribute("position",new k(n,3))}function yr(t,e,n,r,i,o,a,s){H.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new vr(t,e,n,r,i,o,a,s)),this.mergeVertices()}function vr(t,e,r,i,o,a,s,l){function u(r){var o,a=new n,u=new c,y=0,x=!0===r?t:e,b=!0===r?1:-1,w=g;for(o=1;o<=i;o++)d.push(0,v*b,0),f.push(0,b,0),m.push(.5,.5),g++;var M=g;for(o=0;o<=i;o++){var E=o/i*l+s,S=Math.cos(E);E=Math.sin(E),u.x=x*E,u.y=v*b,u.z=x*S,d.push(u.x,u.y,u.z),f.push(0,b,0),a.x=.5*S+.5,a.y=.5*E*b+.5,m.push(a.x,a.y),g++}for(o=0;o<i;o++)a=w+o,u=M+o,!0===r?p.push(u,u+1,a):p.push(u+1,u,a),y+=3;h.addGroup(_,y,!0===r?1:2),_+=y}U.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:l};var h=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,i=Math.floor(i)||8,o=Math.floor(o)||1,a=void 0!==a&&a,s=void 0!==s?s:0,l=void 0!==l?l:2*Math.PI;var p=[],d=[],f=[],m=[],g=0,y=[],v=r/2,_=0;(function(){var n,a,u=new c,x=new c,b=0,w=(e-t)/r;for(a=0;a<=o;a++){var M=[],E=a/o,S=E*(e-t)+t;for(n=0;n<=i;n++){var T=n/i,A=T*l+s,C=Math.sin(A);A=Math.cos(A),x.x=S*C,x.y=-E*r+v,x.z=S*A,d.push(x.x,x.y,x.z),u.set(C,w,A).normalize(),f.push(u.x,u.y,u.z),m.push(T,1-E),M.push(g++)}y.push(M)}for(n=0;n<i;n++)for(a=0;a<o;a++)u=y[a+1][n],x=y[a+1][n+1],w=y[a][n+1],p.push(y[a][n],u,w),p.push(u,x,w),b+=6;h.addGroup(_,b,0),_+=b})(),!1===a&&(0<t&&u(!0),0<e&&u(!1)),this.setIndex(p),this.setAttribute("position",new k(d,3)),this.setAttribute("normal",new k(f,3)),this.setAttribute("uv",new k(m,2))}function _r(t,e,n,r,i,o,a){yr.call(this,0,t,e,n,r,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function xr(t,e,n,r,i,o,a){vr.call(this,0,t,e,n,r,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:a}}function br(t,e,n,r){H.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new wr(t,e,n,r)),this.mergeVertices()}function wr(t,e,r,i){U.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:i},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var o,a=[],s=[],l=[],u=[],h=new c,p=new n;s.push(0,0,0),l.push(0,0,1),u.push(.5,.5);var d=0;for(o=3;d<=e;d++,o+=3){var f=r+d/e*i;h.x=t*Math.cos(f),h.y=t*Math.sin(f),s.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(s[o]/t+1)/2,p.y=(s[o+1]/t+1)/2,u.push(p.x,p.y)}for(o=1;o<=e;o++)a.push(o,o+1,0);this.setIndex(a),this.setAttribute("position",new k(s,3)),this.setAttribute("normal",new k(l,3)),this.setAttribute("uv",new k(u,2))}function Mr(t){T.call(this),this.type="ShadowMaterial",this.color=new b(0),this.transparent=!0,this.setValues(t)}function Er(t){X.call(this,t),this.type="RawShaderMaterial"}function Sr(t){T.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new b(16777215),this.roughness=1,this.metalness=0,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexTangents=this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Tr(t){Sr.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new n(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function Ar(t){T.call(this),this.type="MeshPhongMaterial",this.color=new b(16777215),this.specular=new b(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Cr(t){T.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new b(16777215),this.specular=new b(1118481),this.shininess=30,this.lightMap=this.gradientMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=this.specularMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Lr(t){T.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.fog=!1,this.setValues(t)}function Ir(t){T.call(this),this.type="MeshLambertMaterial",this.color=new b(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new b(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Pr(t){T.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new b(16777215),this.bumpMap=this.map=this.matcap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Rr(t){on.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function Or(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function Dr(t,e,n,r){Or.call(this,t,e,n,r),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Nr(t,e,n,r){Or.call(this,t,e,n,r)}function kr(t,e,n,r){Or.call(this,t,e,n,r)}function Fr(t,e,n,r){if(void 0===t)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Fl.convertArray(e,this.TimeBufferType),this.values=Fl.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function zr(t,e,n){Fr.call(this,t,e,n)}function Br(t,e,n,r){Fr.call(this,t,e,n,r)}function Ur(t,e,n,r){Fr.call(this,t,e,n,r)}function jr(t,e,n,r){Or.call(this,t,e,n,r)}function Gr(t,e,n,r){Fr.call(this,t,e,n,r)}function Vr(t,e,n,r){Fr.call(this,t,e,n,r)}function Hr(t,e,n,r){Fr.call(this,t,e,n,r)}function Wr(t,e,n,r){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==r?r:2500,this.uuid=Vo.generateUUID(),0>this.duration&&this.resetDuration()}function qr(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ur;case"vector":case"vector2":case"vector3":case"vector4":return Hr;case"color":return Br;case"quaternion":return Gr;case"bool":case"boolean":return zr;case"string":return Vr}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function Xr(t){if(void 0===t.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=qr(t.type);if(void 0===t.times){var n=[],r=[];Fl.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}function Zr(t,e,n){var r=this,i=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(i=!1,void 0!==r.onLoad)&&r.onLoad()},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){return t=l.indexOf(t),-1!==t&&l.splice(t,2),this},this.getHandler=function(t){for(var e=0,n=l.length;e<n;e+=2){var r=l[e],i=l[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return i}return null}}function Yr(t){this.manager=void 0!==t?t:Bl,this.crossOrigin="anonymous",this.resourcePath=this.path="",this.requestHeader={}}function $r(t){Yr.call(this,t)}function Jr(t){Yr.call(this,t)}function Kr(t){Yr.call(this,t)}function Qr(t){Yr.call(this,t)}function ti(t){Yr.call(this,t)}function ei(t){Yr.call(this,t)}function ni(t){Yr.call(this,t)}function ri(){this.type="Curve",this.arcLengthDivisions=200}function ii(t,e,n,r,i,o,a,s){ri.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function oi(t,e,n,r,i,o){ii.call(this,t,e,n,n,r,i,o),this.type="ArcCurve"}function ai(){var t=0,e=0,n=0,r=0;return{initCatmullRom:function(i,o,a,s,l){i=l*(a-i),s=l*(s-o),t=o,e=i,n=-3*o+3*a-2*i-s,r=2*o-2*a+i+s},initNonuniformCatmullRom:function(i,o,a,s,l,c,u){i=((o-i)/l-(a-i)/(l+c)+(a-o)/c)*c,s=((a-o)/c-(s-o)/(c+u)+(s-a)/u)*c,t=o,e=i,n=-3*o+3*a-2*i-s,r=2*o-2*a+i+s},calc:function(i){var o=i*i;return t+e*i+n*o+r*o*i}}}function si(t,e,n,r){ri.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=r||.5}function li(t,e,n,r,i){e=.5*(r-e),i=.5*(i-n);var o=t*t;return(2*n-2*r+e+i)*t*o+(-3*n+3*r-2*e-i)*o+e*t+n}function ci(t,e,n,r){var i=1-t;return i*i*e+2*(1-t)*t*n+t*t*r}function ui(t,e,n,r,i){var o=1-t,a=1-t;return o*o*o*e+3*a*a*t*n+3*(1-t)*t*t*r+t*t*t*i}function hi(t,e,r,i){ri.call(this),this.type="CubicBezierCurve",this.v0=t||new n,this.v1=e||new n,this.v2=r||new n,this.v3=i||new n}function pi(t,e,n,r){ri.call(this),this.type="CubicBezierCurve3",this.v0=t||new c,this.v1=e||new c,this.v2=n||new c,this.v3=r||new c}function di(t,e){ri.call(this),this.type="LineCurve",this.v1=t||new n,this.v2=e||new n}function fi(t,e){ri.call(this),this.type="LineCurve3",this.v1=t||new c,this.v2=e||new c}function mi(t,e,r){ri.call(this),this.type="QuadraticBezierCurve",this.v0=t||new n,this.v1=e||new n,this.v2=r||new n}function gi(t,e,n){ri.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new c,this.v1=e||new c,this.v2=n||new c}function yi(t){ri.call(this),this.type="SplineCurve",this.points=t||[]}function vi(){ri.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function _i(t){vi.call(this),this.type="Path",this.currentPoint=new n,t&&this.setFromPoints(t)}function xi(t){_i.call(this,t),this.uuid=Vo.generateUUID(),this.type="Shape",this.holes=[]}function bi(t,e){d.call(this),this.type="Light",this.color=new b(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function wi(t,e,n){bi.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(d.DefaultUp),this.updateMatrix(),this.groundColor=new b(e)}function Mi(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new n(512,512),this.mapPass=this.map=null,this.matrix=new u,this._frustum=new Q,this._frameExtents=new n(1,1),this._viewportCount=1,this._viewports=[new o(0,0,1,1)]}function Ei(){Mi.call(this,new Y(50,1,.5,500))}function Si(t,e,n,r,i,o){bi.call(this,t,e),this.type="SpotLight",this.position.copy(d.DefaultUp),this.updateMatrix(),this.target=new d,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Ei}function Ti(){Mi.call(this,new Y(90,1,.5,500)),this._frameExtents=new n(4,2),this._viewportCount=6,this._viewports=[new o(2,1,1,1),new o(0,1,1,1),new o(3,1,1,1),new o(1,1,1,1),new o(3,0,1,1),new o(1,0,1,1)],this._cubeDirections=[new c(1,0,0),new c(-1,0,0),new c(0,0,1),new c(0,0,-1),new c(0,1,0),new c(0,-1,0)],this._cubeUps=[new c(0,1,0),new c(0,1,0),new c(0,1,0),new c(0,1,0),new c(0,0,1),new c(0,0,-1)]}function Ai(t,e,n,r){bi.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new Ti}function Ci(t,e,n,r,i,o){Z.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Li(){Mi.call(this,new Ci(-5,5,5,-5,.5,500))}function Ii(t,e){bi.call(this,t,e),this.type="DirectionalLight",this.position.copy(d.DefaultUp),this.updateMatrix(),this.target=new d,this.shadow=new Li}function Pi(t,e){bi.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Ri(t,e,n,r){bi.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function Oi(){this.coefficients=[];for(var t=0;9>t;t++)this.coefficients.push(new c)}function Di(t,e){bi.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new Oi}function Ni(t){Yr.call(this,t),this.textures={}}function ki(){U.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Fi(t,e,n,r){"number"===typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),C.call(this,t,e,n),this.meshPerAttribute=r||1}function zi(t){Yr.call(this,t)}function Bi(t){Yr.call(this,t)}function Ui(t){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Yr.call(this,t),this.options=void 0}function ji(){this.type="ShapePath",this.color=new b,this.subPaths=[],this.currentPath=null}function Gi(t){this.type="Font",this.data=t}function Vi(t){Yr.call(this,t)}function Hi(t){Yr.call(this,t)}function Wi(t,e,n){Di.call(this,void 0,n),t=(new b).set(t),n=(new b).set(e),e=new c(t.r,t.g,t.b),t=new c(n.r,n.g,n.b),n=Math.sqrt(Math.PI);var r=n*Math.sqrt(.75);this.sh.coefficients[0].copy(e).add(t).multiplyScalar(n),this.sh.coefficients[1].copy(e).sub(t).multiplyScalar(r)}function qi(t,e){Di.call(this,void 0,e),t=(new b).set(t),this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}function Xi(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Y,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Y,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Zi(t){this.autoStart=void 0===t||t,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function Yi(){d.call(this),this.type="AudioListener",this.context=Kl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Zi}function $i(t){d.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.offset=this.loopEnd=this.loopStart=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._progress=this._startedAt=0,this.filters=[]}function Ji(t){$i.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function Ki(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function Qi(t,e,n){switch(this.binding=t,this.valueSize=n,e){case"quaternion":t=this._slerp,e=this._slerpAdditive;var r=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":e=t=this._select,r=this._setAdditiveIdentityOther,this.buffer=Array(5*n);break;default:t=this._lerp,e=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=t,this._mixBufferRegionAdditive=e,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.referenceCount=this.useCount=this.cumulativeWeightAdditive=this.cumulativeWeight=0}function to(t,e,n){n=n||eo.parseTrackName(e),this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function eo(t,e,n){this.path=e,this.parsedPath=n||eo.parseTrackName(e),this.node=eo.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function no(){this.uuid=Vo.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function ro(t,e,n,r){this._mixer=t,this._clip=e,this._localRoot=n||null,this.blendMode=r||e.blendMode,t=e.tracks,e=t.length,n=Array(e),r={endingStart:2400,endingEnd:2400};for(var i=0;i!==e;++i){var o=t[i].createInterpolant(null);n[i]=o,o.settings=r}this._interpolantSettings=r,this._interpolants=n,this._propertyBindings=Array(e),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function io(t){this._root=t,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function oo(t,e){"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=e),this.value=t}function ao(t,e,n){Ze.call(this,t,e),this.meshPerAttribute=n||1}function so(t,e,n,r){this.ray=new v(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new p,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function lo(t,e){return t.distance-e.distance}function co(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r){t=t.children,r=0;for(var i=t.length;r<i;r++)co(t[r],e,n,!0)}}function uo(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}function ho(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}function po(t,e){this.min=void 0!==t?t:new n(1/0,1/0),this.max=void 0!==e?e:new n(-1/0,-1/0)}function fo(t,e){this.start=void 0!==t?t:new c,this.end=void 0!==e?e:new c}function mo(t){d.call(this),this.material=t,this.render=function(){},this.hasUvs=this.hasColors=this.hasNormals=this.hasPositions=!1,this.uvArray=this.colorArray=this.normalArray=this.positionArray=null,this.count=0}function go(t,e){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,t=new U,e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var n=0,r=1;32>n;n++,r++){var i=n/32*Math.PI*2,o=r/32*Math.PI*2;e.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}t.setAttribute("position",new k(e,3)),e=new on({fog:!1,toneMapped:!1}),this.cone=new sn(t,e),this.add(this.cone),this.update()}function yo(t){var e=[];t&&t.isBone&&e.push(t);for(var n=0;n<t.children.length;n++)e.push.apply(e,yo(t.children[n]));return e}function vo(t){for(var e=yo(t),n=new U,r=[],i=[],o=new b(0,0,1),a=new b(0,1,0),s=0;s<e.length;s++){var l=e[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new k(r,3)),n.setAttribute("color",new k(i,3)),r=new on({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0}),sn.call(this,n,r),this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function _o(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n,t=new lr(e,4,2),e=new A({wireframe:!0,fog:!1,toneMapped:!1}),j.call(this,t,e),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function xo(t,e,n){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t=new En(e),t.rotateY(.5*Math.PI),this.material=new A({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0),e=t.getAttribute("position"),e=new Float32Array(3*e.count),t.setAttribute("color",new C(e,3)),this.add(new j(t,this.material)),this.update()}function bo(t,e,n,r){t=t||10,e=e||10,n=new b(void 0!==n?n:4473924),r=new b(void 0!==r?r:8947848);var i=e/2,o=t/e,a=t/2;t=[];for(var s=[],l=0,c=0,u=-a;l<=e;l++,u+=o){t.push(-a,0,u,a,0,u),t.push(u,0,-a,u,0,a);var h=l===i?n:r;h.toArray(s,c),c+=3,h.toArray(s,c),c+=3,h.toArray(s,c),c+=3,h.toArray(s,c),c+=3}e=new U,e.setAttribute("position",new k(t,3)),e.setAttribute("color",new k(s,3)),n=new on({vertexColors:!0,toneMapped:!1}),sn.call(this,e,n),this.type="GridHelper"}function wo(t,e,n,r,i,o){t=t||10,e=e||16,n=n||8,r=r||64,i=new b(void 0!==i?i:4473924),o=new b(void 0!==o?o:8947848);var a,s=[],l=[];for(a=0;a<=e;a++){var c=a/e*2*Math.PI,u=Math.sin(c)*t;c=Math.cos(c)*t,s.push(0,0,0),s.push(u,0,c);var h=1&a?i:o;l.push(h.r,h.g,h.b),l.push(h.r,h.g,h.b)}for(a=0;a<=n;a++){h=1&a?i:o;var p=t-t/n*a;for(e=0;e<r;e++)c=e/r*2*Math.PI,u=Math.sin(c)*p,c=Math.cos(c)*p,s.push(u,0,c),l.push(h.r,h.g,h.b),c=(e+1)/r*2*Math.PI,u=Math.sin(c)*p,c=Math.cos(c)*p,s.push(u,0,c),l.push(h.r,h.g,h.b)}t=new U,t.setAttribute("position",new k(s,3)),t.setAttribute("color",new k(l,3)),s=new on({vertexColors:!0,toneMapped:!1}),sn.call(this,t,s),this.type="PolarGridHelper"}function Mo(t,e,n){d.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1),t=new U,t.setAttribute("position",new k([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3)),e=new on({fog:!1,toneMapped:!1}),this.lightPlane=new an(t,e),this.add(this.lightPlane),t=new U,t.setAttribute("position",new k([0,0,0,0,0,1],3)),this.targetLine=new an(t,e),this.add(this.targetLine),this.update()}function Eo(t){function e(t,e,r){n(t,r),n(e,r)}function n(t,e){o.push(0,0,0),a.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(o.length/3-1)}var r=new U,i=new on({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],a=[],s={},l=new b(16755200),c=new b(16711680),u=new b(43775),h=new b(16777215),p=new b(3355443);e("n1","n2",l),e("n2","n4",l),e("n4","n3",l),e("n3","n1",l),e("f1","f2",l),e("f2","f4",l),e("f4","f3",l),e("f3","f1",l),e("n1","f1",l),e("n2","f2",l),e("n3","f3",l),e("n4","f4",l),e("p","n1",c),e("p","n2",c),e("p","n3",c),e("p","n4",c),e("u1","u2",u),e("u2","u3",u),e("u3","u1",u),e("c","t",h),e("p","c",p),e("cn1","cn2",p),e("cn3","cn4",p),e("cf1","cf2",p),e("cf3","cf4",p),r.setAttribute("position",new k(o,3)),r.setAttribute("color",new k(a,3)),sn.call(this,r,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function So(t,e,n,r,i,o,a){if(Ic.set(i,o,a).unproject(r),t=e[t],void 0!==t)for(n=n.getAttribute("position"),e=0,r=t.length;e<r;e++)n.setXYZ(t[e],Ic.x,Ic.y,Ic.z)}function To(t,e){this.object=t,void 0===e&&(e=16776960),t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var n=new Float32Array(24),r=new U;r.setIndex(new C(t,1)),r.setAttribute("position",new C(n,3)),sn.call(this,r,new on({color:e,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function Ao(t,e){this.type="Box3Helper",this.box=t,e=e||16776960,t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var n=new U;n.setIndex(new C(t,1)),n.setAttribute("position",new k([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),sn.call(this,n,new on({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function Co(t,e,n){this.plane=t,this.size=void 0===e?1:e,t=void 0!==n?n:16776960,e=new U,e.setAttribute("position",new k([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),e.computeBoundingSphere(),an.call(this,e,new on({color:t,toneMapped:!1})),this.type="PlaneHelper",e=new U,e.setAttribute("position",new k([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),e.computeBoundingSphere(),this.add(new j(e,new A({color:t,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}function Lo(t,e,n,r,i,o){d.call(this),this.type="ArrowHelper",void 0===t&&(t=new c(0,0,1)),void 0===e&&(e=new c(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===Oc&&(Oc=new U,Oc.setAttribute("position",new k([0,0,0,0,1,0],3)),Dc=new vr(0,.5,1,5,1),Dc.translate(0,-.5,0)),this.position.copy(e),this.line=new an(Oc,new on({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new j(Dc,new A({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,i,o)}function Io(t){t=t||1;var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t];t=new U,t.setAttribute("position",new k(e,3)),t.setAttribute("color",new k([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),e=new on({vertexColors:!0,toneMapped:!1}),sn.call(this,t,e),this.type="AxesHelper"}function Po(t){this._renderer=t,this._pingPongRenderTarget=null,t=new Float32Array(20);var e=new c(0,1,0);t=new Er({defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:e},inputEncoding:{value:Bc[3e3]},outputEncoding:{value:Bc[3e3]}},vertexShader:ko(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n"+Fo()+"\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1}),t.type="SphericalGaussianBlur",this._blurMaterial=t,this._cubemapShader=this._equirectShader=null,this._compileMaterial(this._blurMaterial)}function Ro(t){return t=new a(3*kc,3*kc,t),t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Oo(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function Do(){var t=new n(1,1);return t=new Er({uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:Bc[3e3]},outputEncoding:{value:Bc[3e3]}},vertexShader:ko(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n"+Fo()+"\n\n#include <common>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv = equirectUv( outputDirection );\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1}),t.type="EquirectangularToCubeUV",t}function No(){var t=new Er({uniforms:{envMap:{value:null},inputEncoding:{value:Bc[3e3]},outputEncoding:{value:Bc[3e3]}},vertexShader:ko(),fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n"+Fo()+"\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function ko(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function Fo(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function zo(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),si.call(this,t),this.type="catmullrom",this.closed=!0}function Bo(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),si.call(this,t),this.type="catmullrom"}function Uo(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),si.call(this,t),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"===typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return 0>t?-1:0<t?1:+t}),!1==="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}),Object.assign(e.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){void 0!==this._listeners&&(t=this._listeners[t],void 0!==t&&(e=t.indexOf(e),-1!==e&&t.splice(e,1)))},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this,e=e.slice(0);for(var n=0,r=e.length;n<r;n++)e[n].call(this,t)}}}});for(var jo=[],Go=0;256>Go;Go++)jo[Go]=(16>Go?"0":"")+Go.toString(16);var Vo={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(jo[255&t]+jo[t>>8&255]+jo[t>>16&255]+jo[t>>24&255]+"-"+jo[255&e]+jo[e>>8&255]+"-"+jo[e>>16&15|64]+jo[e>>24&255]+"-"+jo[63&n|128]+jo[n>>8&255]+"-"+jo[n>>16&255]+jo[n>>24&255]+jo[255&r]+jo[r>>8&255]+jo[r>>16&255]+jo[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(6*t-15)+10))},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Vo.DEG2RAD},radToDeg:function(t){return t*Vo.RAD2DEG},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){var o=Math.cos,a=Math.sin,s=o(n/2);n=a(n/2);var l=o((e+r)/2),c=a((e+r)/2),u=o((e-r)/2),h=a((e-r)/2);switch(o=o((r-e)/2),e=a((r-e)/2),i){case"XYX":t.set(s*c,n*u,n*h,s*l);break;case"YZY":t.set(n*h,s*c,n*u,s*l);break;case"ZXZ":t.set(n*u,n*h,s*c,s*l);break;case"XZX":t.set(s*c,n*e,n*o,s*l);break;case"YXY":t.set(n*o,s*c,n*e,s*l);break;case"ZYZ":t.set(n*e,n*o,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};Object.defineProperties(n.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(n.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y;return t=t.elements,this.x=t[0]*e+t[3]*n+t[6],this.y=t[1]*e+t[4]*n+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x;return t=this.y-t.y,e*e+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e);e=Math.sin(e);var r=this.x-t.x,i=this.y-t.y;return this.x=r*n-i*e+t.x,this.y=r*e+i*n+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(r.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,o,a,s,l){var c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements;return t=t.elements,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){return t=t.elements,this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements;e=this.elements,t=n[0];var i=n[3],o=n[6],a=n[1],s=n[4],l=n[7],c=n[2],u=n[5];n=n[8];var h=r[0],p=r[3],d=r[6],f=r[1],m=r[4],g=r[7],y=r[2],v=r[5];return r=r[8],e[0]=t*h+i*f+o*y,e[3]=t*p+i*m+o*v,e[6]=t*d+i*g+o*r,e[1]=a*h+s*f+l*y,e[4]=a*p+s*m+l*v,e[7]=a*d+s*g+l*r,e[2]=c*h+u*f+n*y,e[5]=c*p+u*m+n*v,e[8]=c*d+u*g+n*r,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7];return t=t[8],e*o*t-e*a*l-n*i*t+n*a*s+r*i*l-r*o*s},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=t.elements;t=this.elements,e=n[0];var r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],l=n[6],c=n[7];n=n[8];var u=n*a-s*c,h=s*l-n*o,p=c*o-a*l,d=e*u+r*h+i*p;return 0===d?this.set(0,0,0,0,0,0,0,0,0):(d=1/d,t[0]=u*d,t[1]=(i*c-n*r)*d,t[2]=(s*r-i*a)*d,t[3]=h*d,t[4]=(n*e-i*l)*d,t[5]=(i*o-s*e)*d,t[6]=p*d,t[7]=(r*l-c*e)*d,t[8]=(a*e-r*o)*d,this)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,o,a){var s=Math.cos(i);i=Math.sin(i),this.set(n*s,n*i,-n*(s*o+i*a)+o+t,-r*i,r*s,-r*(-i*o+s*a)+a+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t);t=Math.sin(t);var n=this.elements,r=n[0],i=n[3],o=n[6],a=n[1],s=n[4],l=n[7];return n[0]=e*r+t*a,n[3]=e*i+t*s,n[6]=e*o+t*l,n[1]=-t*r+e*a,n[4]=-t*i+e*s,n[7]=-t*o+e*l,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){var e=this.elements;t=t.elements;for(var n=0;9>n;n++)if(e[n]!==t[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;9>n;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var Ho,Wo={getDataURL:function(t){if("undefined"==typeof HTMLCanvasElement)return t.src;if(!(t instanceof HTMLCanvasElement)){void 0===Ho&&(Ho=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ho.width=t.width,Ho.height=t.height;var e=Ho.getContext("2d");t instanceof ImageData?e.putImageData(t,0,0):e.drawImage(t,0,0,t.width,t.height),t=Ho}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},qo=0;i.DEFAULT_IMAGE=void 0,i.DEFAULT_MAPPING=300,i.prototype=Object.assign(Object.create(e.prototype),{constructor:i,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Vo.generateUUID()),!e&&void 0===t.images[r.uuid]){if(Array.isArray(r))for(var i=[],o=0,a=r.length;o<a;o++)i.push(Wo.getDataURL(r[o]));else i=Wo.getDataURL(r);t.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),0>t.x||1<t.x)switch(this.wrapS){case 1e3:t.x-=Math.floor(t.x);break;case 1001:t.x=0>t.x?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(0>t.y||1<t.y)switch(this.wrapT){case 1e3:t.y-=Math.floor(t.y);break;case 1001:t.y=0>t.y?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(i.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(o.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(o.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.w=this.z=this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=this.w;return t=t.elements,this.x=t[0]*e+t[4]*n+t[8]*r+t[12]*i,this.y=t[1]*e+t[5]*n+t[9]*r+t[13]*i,this.z=t[2]*e+t[6]*n+t[10]*r+t[14]*i,this.w=t[3]*e+t[7]*n+t[11]*r+t[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return 1e-4>e?(this.x=1,this.z=this.y=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){t=t.elements;var e=t[0],n=t[4],r=t[8],i=t[1],o=t[5],a=t[9],s=t[2],l=t[6],c=t[10];return.01>Math.abs(n-i)&&.01>Math.abs(r-s)&&.01>Math.abs(a-l)?.1>Math.abs(n+i)&&.1>Math.abs(r+s)&&.1>Math.abs(a+l)&&.1>Math.abs(e+o+c-3)?(this.set(1,0,0,0),this):(t=Math.PI,e=(e+1)/2,o=(o+1)/2,c=(c+1)/2,n=(n+i)/4,r=(r+s)/4,a=(a+l)/4,e>o&&e>c?.01>e?(l=0,n=s=.707106781):(l=Math.sqrt(e),s=n/l,n=r/l):o>c?.01>o?(l=.707106781,s=0,n=.707106781):(s=Math.sqrt(o),l=n/s,n=a/s):.01>c?(s=l=.707106781,n=0):(n=Math.sqrt(c),l=r/n,s=a/n),this.set(l,s,n,t),this):(t=Math.sqrt((l-a)*(l-a)+(r-s)*(r-s)+(i-n)*(i-n)),.001>Math.abs(t)&&(t=1),this.x=(l-a)/t,this.y=(r-s)/t,this.z=(i-n)/t,this.w=Math.acos((e+o+c-1)/2),this)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),a.prototype=Object.assign(Object.create(e.prototype),{constructor:a,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),s.prototype=Object.assign(Object.create(a.prototype),{constructor:s,isWebGLMultisampleRenderTarget:!0,copy:function(t){return a.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(l,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,o,a){var s=n[r+0],l=n[r+1],c=n[r+2];n=n[r+3],r=i[o+0];var u=i[o+1],h=i[o+2];if(i=i[o+3],n!==i||s!==r||l!==u||c!==h){o=1-a;var p=s*r+l*u+c*h+n*i,d=0<=p?1:-1,f=1-p*p;f>Number.EPSILON&&(f=Math.sqrt(f),p=Math.atan2(f,p*d),o=Math.sin(o*p)/f,a=Math.sin(a*p)/f),d*=a,s=s*o+r*d,l=l*o+u*d,c=c*o+h*d,n=n*o+i*d,o===1-a&&(a=1/Math.sqrt(s*s+l*l+c*c+n*n),s*=a,l*=a,c*=a,n*=a)}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=n},multiplyQuaternionsFlat:function(t,e,n,r,i,o){var a=n[r],s=n[r+1],l=n[r+2];n=n[r+3],r=i[o];var c=i[o+1],u=i[o+2];return i=i[o+3],t[e]=a*i+n*r+s*u-l*c,t[e+1]=s*i+n*c+l*r-a*u,t[e+2]=l*i+n*u+a*c-s*r,t[e+3]=n*i-a*r-s*c-l*u,t}}),Object.defineProperties(l.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(l.prototype,{isQuaternion:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z;t=t.order;var o=Math.cos,a=Math.sin,s=o(n/2),l=o(r/2);switch(o=o(i/2),n=a(n/2),r=a(r/2),i=a(i/2),t){case"XYZ":this._x=n*l*o+s*r*i,this._y=s*r*o-n*l*i,this._z=s*l*i+n*r*o,this._w=s*l*o-n*r*i;break;case"YXZ":this._x=n*l*o+s*r*i,this._y=s*r*o-n*l*i,this._z=s*l*i-n*r*o,this._w=s*l*o+n*r*i;break;case"ZXY":this._x=n*l*o-s*r*i,this._y=s*r*o+n*l*i,this._z=s*l*i+n*r*o,this._w=s*l*o-n*r*i;break;case"ZYX":this._x=n*l*o-s*r*i,this._y=s*r*o+n*l*i,this._z=s*l*i-n*r*o,this._w=s*l*o+n*r*i;break;case"YZX":this._x=n*l*o+s*r*i,this._y=s*r*o+n*l*i,this._z=s*l*i-n*r*o,this._w=s*l*o-n*r*i;break;case"XZY":this._x=n*l*o-s*r*i,this._y=s*r*o-n*l*i,this._z=s*l*i+n*r*o,this._w=s*l*o+n*r*i;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+t)}return!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){e/=2;var n=Math.sin(e);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(e),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e=t.elements,n=e[0];t=e[4];var r=e[8],i=e[1],o=e[5],a=e[9],s=e[2],l=e[6];e=e[10];var c=n+o+e;return 0<c?(n=.5/Math.sqrt(c+1),this._w=.25/n,this._x=(l-a)*n,this._y=(r-s)*n,this._z=(i-t)*n):n>o&&n>e?(n=2*Math.sqrt(1+n-o-e),this._w=(l-a)/n,this._x=.25*n,this._y=(t+i)/n,this._z=(r+s)/n):o>e?(n=2*Math.sqrt(1+o-n-e),this._w=(r-s)/n,this._x=(t+i)/n,this._y=.25*n,this._z=(a+l)/n):(n=2*Math.sqrt(1+e-n-o),this._w=(i-t)/n,this._x=(r+s)/n,this._y=(a+l)/n,this._z=.25*n),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var n=t.dot(e)+1;return 1e-6>n?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0):(this._x=0,this._y=-t.z,this._z=t.y)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x),this._w=n,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Vo.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var n=this.angleTo(t);return 0===n||this.slerp(t,Math.min(1,e/n)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._z=this._y=this._x=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z;t=t._w;var o=e._x,a=e._y,s=e._z;return e=e._w,this._x=n*e+t*o+r*s-i*a,this._y=r*e+t*a+i*o-n*s,this._z=i*e+t*s+n*a-r*o,this._w=t*e-n*o-r*a-i*s,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(0>a?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),1<=a)return this._w=o,this._x=n,this._y=r,this._z=i,this;if(t=1-a*a,t<=Number.EPSILON)return a=1-e,this._w=a*o+e*this._w,this._x=a*n+e*this._x,this._y=a*r+e*this._y,this._z=a*i+e*this._z,this.normalize(),this._onChangeCallback(),this;t=Math.sqrt(t);var s=Math.atan2(t,a);return a=Math.sin((1-e)*s)/t,e=Math.sin(e*s)/t,this._w=o*a+this._w*e,this._x=n*a+this._x*e,this._y=r*a+this._y*e,this._z=i*a+this._z*e,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var Xo=new c,Zo=new l;Object.assign(c.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.z=this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Zo.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Zo.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[3]*n+t[6]*r,this.y=t[1]*e+t[4]*n+t[7]*r,this.z=t[2]*e+t[5]*n+t[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z;t=t.elements;var i=1/(t[3]*e+t[7]*n+t[11]*r+t[15]);return this.x=(t[0]*e+t[4]*n+t[8]*r+t[12])*i,this.y=(t[1]*e+t[5]*n+t[9]*r+t[13])*i,this.z=(t[2]*e+t[6]*n+t[10]*r+t[14])*i,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z;t=t.w;var s=t*e+o*r-a*n,l=t*n+a*e-i*r,c=t*r+i*n-o*e;return e=-i*e-o*n-a*r,this.x=s*t+e*-i+l*-a-c*-o,this.y=l*t+e*-o+c*-i-s*-a,this.z=c*t+e*-a+s*-o-l*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,n=this.y,r=this.z;return t=t.elements,this.x=t[0]*e+t[4]*n+t[8]*r,this.y=t[1]*e+t[5]*n+t[9]*r,this.z=t[2]*e+t[6]*n+t[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y;t=t.z;var i=e.x,o=e.y;return e=e.z,this.x=r*e-t*o,this.y=t*i-n*e,this.z=n*o-r*i,this},projectOnVector:function(t){var e=t.lengthSq();return 0===e?this.set(0,0,0):(e=t.dot(this)/e,this.copy(t).multiplyScalar(e))},projectOnPlane:function(t){return Xo.copy(this).projectOnVector(t),this.sub(Xo)},reflect:function(t){return this.sub(Xo.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===e?Math.PI/2:(t=this.dot(t)/e,Math.acos(Vo.clamp(t,-1,1)))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return t=this.z-t.z,e*e+n*n+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){return t=t.elements,this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length();return t=this.setFromMatrixColumn(t,2).length(),this.x=e,this.y=n,this.z=t,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});var Yo=new c,$o=new u,Jo=new c(0,0,0),Ko=new c(1,1,1),Qo=new c,ta=new c,ea=new c;Object.assign(u.prototype,{isMatrix4:!0,set:function(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new u).fromArray(this.elements)},copy:function(t){var e=this.elements;return t=t.elements,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},copyPosition:function(t){var e=this.elements;return t=t.elements,e[12]=t[12],e[13]=t[13],e[14]=t[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,n=t.elements,r=1/Yo.setFromMatrixColumn(t,0).length(),i=1/Yo.setFromMatrixColumn(t,1).length();return t=1/Yo.setFromMatrixColumn(t,2).length(),e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*t,e[9]=n[9]*t,e[10]=n[10]*t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n);n=Math.sin(n);var a=Math.cos(r);r=Math.sin(r);var s=Math.cos(i);if(i=Math.sin(i),"XYZ"===t.order){t=o*s;var l=o*i,c=n*s,u=n*i;e[0]=a*s,e[4]=-a*i,e[8]=r,e[1]=l+c*r,e[5]=t-u*r,e[9]=-n*a,e[2]=u-t*r,e[6]=c+l*r,e[10]=o*a}else"YXZ"===t.order?(t=a*s,l=a*i,c=r*s,u=r*i,e[0]=t+u*n,e[4]=c*n-l,e[8]=o*r,e[1]=o*i,e[5]=o*s,e[9]=-n,e[2]=l*n-c,e[6]=u+t*n,e[10]=o*a):"ZXY"===t.order?(t=a*s,l=a*i,c=r*s,u=r*i,e[0]=t-u*n,e[4]=-o*i,e[8]=c+l*n,e[1]=l+c*n,e[5]=o*s,e[9]=u-t*n,e[2]=-o*r,e[6]=n,e[10]=o*a):"ZYX"===t.order?(t=o*s,l=o*i,c=n*s,u=n*i,e[0]=a*s,e[4]=c*r-l,e[8]=t*r+u,e[1]=a*i,e[5]=u*r+t,e[9]=l*r-c,e[2]=-r,e[6]=n*a,e[10]=o*a):"YZX"===t.order?(t=o*a,l=o*r,c=n*a,u=n*r,e[0]=a*s,e[4]=u-t*i,e[8]=c*i+l,e[1]=i,e[5]=o*s,e[9]=-n*s,e[2]=-r*s,e[6]=l*i+c,e[10]=t-u*i):"XZY"===t.order&&(t=o*a,l=o*r,c=n*a,u=n*r,e[0]=a*s,e[4]=-i,e[8]=r*s,e[1]=t*i+u,e[5]=o*s,e[9]=l*i-c,e[2]=c*i-l,e[6]=n*s,e[10]=u*i+t);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Jo,t,Ko)},lookAt:function(t,e,n){var r=this.elements;return ea.subVectors(t,e),0===ea.lengthSq()&&(ea.z=1),ea.normalize(),Qo.crossVectors(n,ea),0===Qo.lengthSq()&&(1===Math.abs(n.z)?ea.x+=1e-4:ea.z+=1e-4,ea.normalize(),Qo.crossVectors(n,ea)),Qo.normalize(),ta.crossVectors(ea,Qo),r[0]=Qo.x,r[4]=ta.x,r[8]=ea.x,r[1]=Qo.y,r[5]=ta.y,r[9]=ea.y,r[2]=Qo.z,r[6]=ta.z,r[10]=ea.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements;e=this.elements,t=n[0];var i=n[4],o=n[8],a=n[12],s=n[1],l=n[5],c=n[9],u=n[13],h=n[2],p=n[6],d=n[10],f=n[14],m=n[3],g=n[7],y=n[11];n=n[15];var v=r[0],_=r[4],x=r[8],b=r[12],w=r[1],M=r[5],E=r[9],S=r[13],T=r[2],A=r[6],C=r[10],L=r[14],I=r[3],P=r[7],R=r[11];return r=r[15],e[0]=t*v+i*w+o*T+a*I,e[4]=t*_+i*M+o*A+a*P,e[8]=t*x+i*E+o*C+a*R,e[12]=t*b+i*S+o*L+a*r,e[1]=s*v+l*w+c*T+u*I,e[5]=s*_+l*M+c*A+u*P,e[9]=s*x+l*E+c*C+u*R,e[13]=s*b+l*S+c*L+u*r,e[2]=h*v+p*w+d*T+f*I,e[6]=h*_+p*M+d*A+f*P,e[10]=h*x+p*E+d*C+f*R,e[14]=h*b+p*S+d*L+f*r,e[3]=m*v+g*w+y*T+n*I,e[7]=m*_+g*M+y*A+n*P,e[11]=m*x+g*E+y*C+n*R,e[15]=m*b+g*S+y*L+n*r,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],p=t[14];return t[3]*(+i*s*u-r*l*u-i*a*h+n*l*h+r*a*p-n*s*p)+t[7]*(+e*s*p-e*l*h+i*o*h-r*o*p+r*l*c-i*s*c)+t[11]*(+e*l*u-e*a*p-i*o*u+n*o*p+i*a*c-n*l*c)+t[15]*(-r*a*c-e*s*u+e*a*h+r*o*u-n*o*h+n*s*c)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate."),e=this.elements;var n=t.elements;t=n[0];var r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],l=n[6],c=n[7],u=n[8],h=n[9],p=n[10],d=n[11],f=n[12],m=n[13],g=n[14];n=n[15];var y=h*g*c-m*p*c+m*l*d-s*g*d-h*l*n+s*p*n,v=f*p*c-u*g*c-f*l*d+a*g*d+u*l*n-a*p*n,_=u*m*c-f*h*c+f*s*d-a*m*d-u*s*n+a*h*n,x=f*h*l-u*m*l-f*s*p+a*m*p+u*s*g-a*h*g,b=t*y+r*v+i*_+o*x;return 0===b?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(b=1/b,e[0]=y*b,e[1]=(m*p*o-h*g*o-m*i*d+r*g*d+h*i*n-r*p*n)*b,e[2]=(s*g*o-m*l*o+m*i*c-r*g*c-s*i*n+r*l*n)*b,e[3]=(h*l*o-s*p*o-h*i*c+r*p*c+s*i*d-r*l*d)*b,e[4]=v*b,e[5]=(u*g*o-f*p*o+f*i*d-t*g*d-u*i*n+t*p*n)*b,e[6]=(f*l*o-a*g*o-f*i*c+t*g*c+a*i*n-t*l*n)*b,e[7]=(a*p*o-u*l*o+u*i*c-t*p*c-a*i*d+t*l*d)*b,e[8]=_*b,e[9]=(f*h*o-u*m*o-f*r*d+t*m*d+u*r*n-t*h*n)*b,e[10]=(a*m*o-f*s*o+f*r*c-t*m*c-a*r*n+t*s*n)*b,e[11]=(u*s*o-a*h*o-u*r*c+t*h*c+a*r*d-t*s*d)*b,e[12]=x*b,e[13]=(u*m*i-f*h*i+f*r*p-t*m*p-u*r*g+t*h*g)*b,e[14]=(f*s*i-a*m*i-f*r*l+t*m*l+a*r*g-t*s*g)*b,e[15]=(a*h*i-u*s*i+u*r*l-t*h*l-a*r*p+t*s*p)*b,this)},scale:function(t){var e=this.elements,n=t.x,r=t.y;return t=t.z,e[0]*=n,e[4]*=r,e[8]*=t,e[1]*=n,e[5]*=r,e[9]*=t,e[2]*=n,e[6]*=r,e[10]*=t,e[3]*=n,e[7]*=r,e[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e);e=Math.sin(e);var r=1-n,i=t.x,o=t.y;t=t.z;var a=r*i,s=r*o;return this.set(a*i+n,a*o-e*t,a*t+e*o,0,a*o+e*t,s*o+n,s*t-e*i,0,a*t-e*o,s*t+e*i,r*t*t+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){var r=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,l=i+i,c=o+o,u=a+a;e=i*l;var h=i*c;i*=u;var p=o*c;o*=u,a*=u,l*=s,c*=s,s*=u,u=n.x;var d=n.y;return n=n.z,r[0]=(1-(p+a))*u,r[1]=(h+s)*u,r[2]=(i-c)*u,r[3]=0,r[4]=(h-s)*d,r[5]=(1-(e+a))*d,r[6]=(o+l)*d,r[7]=0,r[8]=(i+c)*n,r[9]=(o-l)*n,r[10]=(1-(e+p))*n,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,n){var r=this.elements,i=Yo.set(r[0],r[1],r[2]).length(),o=Yo.set(r[4],r[5],r[6]).length(),a=Yo.set(r[8],r[9],r[10]).length();0>this.determinant()&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],$o.copy(this),t=1/i,r=1/o;var s=1/a;return $o.elements[0]*=t,$o.elements[1]*=t,$o.elements[2]*=t,$o.elements[4]*=r,$o.elements[5]*=r,$o.elements[6]*=r,$o.elements[8]*=s,$o.elements[9]*=s,$o.elements[10]*=s,e.setFromRotationMatrix($o),n.x=i,n.y=o,n.z=a,this},makePerspective:function(t,e,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements;return a[0]=2*i/(e-t),a[4]=0,a[8]=(e+t)/(e-t),a[12]=0,a[1]=0,a[5]=2*i/(n-r),a[9]=(n+r)/(n-r),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+i)/(o-i),a[14]=-2*o*i/(o-i),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,n,r,i,o){var a=this.elements,s=1/(e-t),l=1/(n-r),c=1/(o-i);return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-(e+t)*s,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-(n+r)*l,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-(o+i)*c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){var e=this.elements;t=t.elements;for(var n=0;16>n;n++)if(e[n]!==t[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;16>n;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});var na=new u,ra=new l;h.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),h.DefaultOrder="XYZ",Object.defineProperties(h.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(h.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=Vo.clamp,i=t.elements;t=i[0];var o=i[4],a=i[8],s=i[1],l=i[5],c=i[9],u=i[2],h=i[6];switch(i=i[10],e=e||this._order,e){case"XYZ":this._y=Math.asin(r(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(-c,i),this._z=Math.atan2(-o,t)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-r(c,-1,1)),.9999999>Math.abs(c)?(this._y=Math.atan2(a,i),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,t),this._z=0);break;case"ZXY":this._x=Math.asin(r(h,-1,1)),.9999999>Math.abs(h)?(this._y=Math.atan2(-u,i),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,t));break;case"ZYX":this._y=Math.asin(-r(u,-1,1)),.9999999>Math.abs(u)?(this._x=Math.atan2(h,i),this._z=Math.atan2(s,t)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(r(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,t)):(this._x=0,this._y=Math.atan2(a,i));break;case"XZY":this._z=Math.asin(-r(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,t)):(this._x=Math.atan2(-c,i),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return na.makeRotationFromQuaternion(t),this.setFromRotationMatrix(na,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return ra.setFromEuler(this),this.setFromQuaternion(ra,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new c(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(p.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask=this.mask|1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!==(this.mask&t.mask)}});var ia=0,oa=new c,aa=new l,sa=new u,la=new c,ca=new c,ua=new c,ha=new l,pa=new c(1,0,0),da=new c(0,1,0),fa=new c(0,0,1),ma={type:"added"},ga={type:"removed"};d.DefaultUp=new c(0,1,0),d.DefaultMatrixAutoUpdate=!0,d.prototype=Object.assign(Object.create(e.prototype),{constructor:d,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return aa.setFromAxisAngle(t,e),this.quaternion.multiply(aa),this},rotateOnWorldAxis:function(t,e){return aa.setFromAxisAngle(t,e),this.quaternion.premultiply(aa),this},rotateX:function(t){return this.rotateOnAxis(pa,t)},rotateY:function(t){return this.rotateOnAxis(da,t)},rotateZ:function(t){return this.rotateOnAxis(fa,t)},translateOnAxis:function(t,e){return oa.copy(t).applyQuaternion(this.quaternion),this.position.add(oa.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(pa,t)},translateY:function(t){return this.translateOnAxis(da,t)},translateZ:function(t){return this.translateOnAxis(fa,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(sa.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?la.copy(t):la.set(t,e,n),t=this.parent,this.updateWorldMatrix(!0,!1),ca.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?sa.lookAt(ca,la,this.up):sa.lookAt(la,ca,this.up),this.quaternion.setFromRotationMatrix(sa),t&&(sa.extractRotation(t.matrixWorld),aa.setFromRotationMatrix(sa),this.quaternion.premultiply(aa.inverse()))},add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ma)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}return e=this.children.indexOf(t),-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ga)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),sa.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),sa.multiply(t.parent.matrixWorld)),t.applyMatrix4(sa),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new c),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new l),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ca,t,ua),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new c),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ca,ha,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new c),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(t=this.children,e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)},toJSON:function(t){function e(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}function n(t){var e,n=[];for(e in t){var r=t[e];delete r.metadata,n.push(r)}return n}var r=void 0===t||"string"===typeof t,i={};r&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){o.geometry=e(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes)if(a=a.shapes,Array.isArray(a))for(var s=0,l=a.length;s<l;s++)e(t.shapes,a[s]);else e(t.shapes,a)}if(void 0!==this.material)if(Array.isArray(this.material)){for(a=[],s=0,l=this.material.length;s<l;s++)a.push(e(t.materials,this.material[s]));o.material=a}else o.material=e(t.materials,this.material);if(0<this.children.length)for(o.children=[],s=0;s<this.children.length;s++)o.children.push(this.children[s].toJSON(t).object);if(r){r=n(t.geometries),s=n(t.materials),l=n(t.textures);var c=n(t.images);a=n(t.shapes),0<r.length&&(i.geometries=r),0<s.length&&(i.materials=s),0<l.length&&(i.textures=l),0<c.length&&(i.images=c),0<a.length&&(i.shapes=a)}return i.object=o,i},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(e=0;e<t.children.length;e++)this.add(t.children[e].clone());return this}}),f.prototype=Object.assign(Object.create(d.prototype),{constructor:f,isScene:!0,copy:function(t,e){return d.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=d.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ya=[new c,new c,new c,new c,new c,new c,new c,new c],va=new c,_a=new m,xa=new c,ba=new c,wa=new c,Ma=new c,Ea=new c,Sa=new c,Ta=new c,Aa=new c,Ca=new c,La=new c;Object.assign(m.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;s<l;s+=3){var c=t[s],u=t[s+1],h=t[s+2];c<e&&(e=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.count;s<l;s++){var c=t.getX(s),u=t.getY(s),h=t.getZ(s);c<e&&(e=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){return e=va.copy(e).multiplyScalar(.5),this.min.copy(t).sub(e),this.max.copy(t).add(e),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new c),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new c),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),_a.copy(e.boundingBox),_a.applyMatrix4(t.matrixWorld),this.union(_a)),t=t.children,e=0;for(var n=t.length;e<n;e++)this.expandByObject(t[e]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new c),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,va),va.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){if(0<t.normal.x)var e=t.normal.x*this.min.x,n=t.normal.x*this.max.x;else e=t.normal.x*this.max.x,n=t.normal.x*this.min.x;return 0<t.normal.y?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){return!this.isEmpty()&&(this.getCenter(Ta),Aa.subVectors(this.max,Ta),xa.subVectors(t.a,Ta),ba.subVectors(t.b,Ta),wa.subVectors(t.c,Ta),Ma.subVectors(ba,xa),Ea.subVectors(wa,ba),Sa.subVectors(xa,wa),t=[0,-Ma.z,Ma.y,0,-Ea.z,Ea.y,0,-Sa.z,Sa.y,Ma.z,0,-Ma.x,Ea.z,0,-Ea.x,Sa.z,0,-Sa.x,-Ma.y,Ma.x,0,-Ea.y,Ea.x,0,-Sa.y,Sa.x,0],!!g(t,xa,ba,wa,Aa)&&(t=[1,0,0,0,1,0,0,0,1],!!g(t,xa,ba,wa,Aa)&&(Ca.crossVectors(Ma,Ea),t=[Ca.x,Ca.y,Ca.z],g(t,xa,ba,wa,Aa))))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new c),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return va.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(va).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(ya[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ya[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ya[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ya[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ya[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ya[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ya[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ya[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ya)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Ia=new m;Object.assign(y.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var n=this.center;void 0!==e?n.copy(e):Ia.setFromPoints(t).getCenter(n);for(var r=e=0,i=t.length;r<i;r++)e=Math.max(e,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return 0>this.radius},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new c),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new m),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius*=t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var Pa=new c,Ra=new c,Oa=new c,Da=new c,Na=new c,ka=new c,Fa=new c;Object.assign(v.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new c),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,Pa)),this},closestPointToPoint:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new c),e.subVectors(t,this.origin),t=e.dot(this.direction),0>t?e.copy(this.origin):e.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=Pa.subVectors(t,this.origin).dot(this.direction);return 0>e?this.origin.distanceToSquared(t):(Pa.copy(this.direction).multiplyScalar(e).add(this.origin),Pa.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,r){Ra.copy(t).add(e).multiplyScalar(.5),Oa.copy(e).sub(t).normalize(),Da.copy(this.origin).sub(Ra);var i=.5*t.distanceTo(e),o=-this.direction.dot(Oa),a=Da.dot(this.direction),s=-Da.dot(Oa),l=Da.lengthSq(),c=Math.abs(1-o*o);if(0<c){t=o*s-a,e=o*a-s;var u=i*c;0<=t?e>=-u?e<=u?(i=1/c,t*=i,e*=i,o=t*(t+o*e+2*a)+e*(o*t+e+2*s)+l):(e=i,t=Math.max(0,-(o*e+a)),o=-t*t+e*(e+2*s)+l):(e=-i,t=Math.max(0,-(o*e+a)),o=-t*t+e*(e+2*s)+l):e<=-u?(t=Math.max(0,-(-o*i+a)),e=0<t?-i:Math.min(Math.max(-i,-s),i),o=-t*t+e*(e+2*s)+l):e<=u?(t=0,e=Math.min(Math.max(-i,-s),i),o=e*(e+2*s)+l):(t=Math.max(0,-(o*i+a)),e=0<t?i:Math.min(Math.max(-i,-s),i),o=-t*t+e*(e+2*s)+l)}else e=0<o?-i:i,t=Math.max(0,-(o*e+a)),o=-t*t+e*(e+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(t).add(this.origin),r&&r.copy(Oa).multiplyScalar(e).add(Ra),o},intersectSphere:function(t,e){Pa.subVectors(t.center,this.origin);var n=Pa.dot(this.direction),r=Pa.dot(Pa)-n*n;return t=t.radius*t.radius,r>t?null:(t=Math.sqrt(t-r),r=n-t,n+=t,0>r&&0>n?null:0>r?this.at(n,e):this.at(r,e))},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);return 0===e?0===t.distanceToPoint(this.origin)?0:null:(t=-(this.origin.dot(t.normal)+t.constant)/e,0<=t?t:null)},intersectPlane:function(t,e){return t=this.distanceToPlane(t),null===t?null:this.at(t,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||0>t.normal.dot(this.direction)*e},intersectBox:function(t,e){var n=1/this.direction.x,r=1/this.direction.y,i=1/this.direction.z,o=this.origin;if(0<=n){var a=(t.min.x-o.x)*n;n*=t.max.x-o.x}else a=(t.max.x-o.x)*n,n*=t.min.x-o.x;if(0<=r){var s=(t.min.y-o.y)*r;r*=t.max.y-o.y}else s=(t.max.y-o.y)*r,r*=t.min.y-o.y;return a>r||s>n?null:((s>a||a!==a)&&(a=s),(r<n||n!==n)&&(n=r),0<=i?(s=(t.min.z-o.z)*i,t=(t.max.z-o.z)*i):(s=(t.max.z-o.z)*i,t=(t.min.z-o.z)*i),a>t||s>n?null:((s>a||a!==a)&&(a=s),(t<n||n!==n)&&(n=t),0>n?null:this.at(0<=a?a:n,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,Pa)},intersectTriangle:function(t,e,n,r,i){if(Na.subVectors(e,t),ka.subVectors(n,t),Fa.crossVectors(Na,ka),e=this.direction.dot(Fa),0<e){if(r)return null;r=1}else{if(!(0>e))return null;r=-1,e=-e}return Da.subVectors(this.origin,t),t=r*this.direction.dot(ka.crossVectors(Da,ka)),0>t?null:(n=r*this.direction.dot(Na.cross(Da)),0>n||t+n>e?null:(t=-r*Da.dot(Fa),0>t?null:this.at(t/e,i)))},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var za=new c,Ba=new c,Ua=new r;Object.assign(_.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){return e=za.subVectors(n,e).cross(Ba.subVectors(t,e)).normalize(),this.setFromNormalAndCoplanarPoint(e,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new c),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new c);var n=t.delta(za),r=this.normal.dot(n);if(0===r){if(0===this.distanceToPoint(t.start))return e.copy(t.start)}else if(r=-(t.start.dot(this.normal)+this.constant)/r,!(0>r||1<r))return e.copy(n).multiplyScalar(r).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start);return t=this.distanceToPoint(t.end),0>e&&0<t||0>t&&0<e},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new c),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){return e=e||Ua.getNormalMatrix(t),t=this.coplanarPoint(za).applyMatrix4(t),e=this.normal.applyMatrix3(e).normalize(),this.constant=-t.dot(e),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var ja=new c,Ga=new c,Va=new c,Ha=new c,Wa=new c,qa=new c,Xa=new c,Za=new c,Ya=new c,$a=new c;Object.assign(x,{getNormal:function(t,e,n,r){return void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new c),r.subVectors(n,e),ja.subVectors(t,e),r.cross(ja),t=r.lengthSq(),0<t?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)},getBarycoord:function(t,e,n,r,i){ja.subVectors(r,e),Ga.subVectors(n,e),Va.subVectors(t,e),t=ja.dot(ja),e=ja.dot(Ga),n=ja.dot(Va);var o=Ga.dot(Ga);r=Ga.dot(Va);var a=t*o-e*e;return void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new c),0===a?i.set(-2,-1,-1):(a=1/a,o=(o*n-e*r)*a,t=(t*r-e*n)*a,i.set(1-o-t,t,o))},containsPoint:function(t,e,n,r){return x.getBarycoord(t,e,n,r,Ha),0<=Ha.x&&0<=Ha.y&&1>=Ha.x+Ha.y},getUV:function(t,e,n,r,i,o,a,s){return this.getBarycoord(t,e,n,r,Ha),s.set(0,0),s.addScaledVector(i,Ha.x),s.addScaledVector(o,Ha.y),s.addScaledVector(a,Ha.z),s},isFrontFacing:function(t,e,n,r){return ja.subVectors(n,e),Ga.subVectors(t,e),0>ja.cross(Ga).dot(r)}}),Object.assign(x.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return ja.subVectors(this.c,this.b),Ga.subVectors(this.a,this.b),.5*ja.cross(Ga).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new c),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return x.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new _),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return x.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,r,i){return x.getUV(t,this.a,this.b,this.c,e,n,r,i)},containsPoint:function(t){return x.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return x.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new c);var n=this.a,r=this.b,i=this.c;Wa.subVectors(r,n),qa.subVectors(i,n),Za.subVectors(t,n);var o=Wa.dot(Za),a=qa.dot(Za);if(0>=o&&0>=a)return e.copy(n);Ya.subVectors(t,r);var s=Wa.dot(Ya),l=qa.dot(Ya);if(0<=s&&l<=s)return e.copy(r);var u=o*l-s*a;if(0>=u&&0<=o&&0>=s)return r=o/(o-s),e.copy(n).addScaledVector(Wa,r);$a.subVectors(t,i),t=Wa.dot($a);var h=qa.dot($a);return 0<=h&&t<=h?e.copy(i):(o=t*a-o*h,0>=o&&0<=a&&0>=h?(u=a/(a-h),e.copy(n).addScaledVector(qa,u)):(a=s*h-t*l,0>=a&&0<=l-s&&0<=t-h?(Xa.subVectors(i,r),u=(l-s)/(l-s+(t-h)),e.copy(r).addScaledVector(Xa,u)):(i=1/(a+o+u),r=o*i,u*=i,e.copy(n).addScaledVector(Wa,r).addScaledVector(qa,u))))},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var Ja={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ka={h:0,s:0,l:0},Qa={h:0,s:0,l:0};Object.assign(b.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t),this},setScalar:function(t){return this.b=this.g=this.r=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){return t=Vo.euclideanModulo(t,1),e=Vo.clamp(e,0,1),n=Vo.clamp(n,0,1),0===e?this.r=this.g=this.b=n:(e=.5>=n?n*(1+e):n+e-n*e,n=2*n-e,this.r=w(n,e,t+1/3),this.g=w(n,e,t),this.b=w(n,e,t-1/3)),this},setStyle:function(t){function e(e){void 0!==e&&1>parseFloat(e)&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r=n[2];switch(n[1]){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){r=parseFloat(n[1])/360;var i=parseInt(n[2],10)/100,o=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(r,i,o)}}}else if(n=/^#([A-Fa-f0-9]+)$/.exec(t)){if(n=n[1],r=n.length,3===r)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,this;if(6===r)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this},setColorName:function(t){var e=Ja[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){return void 0===e&&(e=2),e=0<e?1/e:1,this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=M(t.r),this.g=M(t.g),this.b=M(t.b),this},copyLinearToSRGB:function(t){return this.r=E(t.r),this.g=E(t.g),this.b=E(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,n=this.r,r=this.g,i=this.b,o=Math.max(n,r,i),a=Math.min(n,r,i),s=(a+o)/2;if(a===o)a=e=0;else{var l=o-a;switch(a=.5>=s?l/(o+a):l/(2-o-a),o){case n:e=(r-i)/l+(r<i?6:0);break;case r:e=(i-n)/l+2;break;case i:e=(n-r)/l+4}e/=6}return t.h=e,t.s=a,t.l=s,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){return this.getHSL(Ka),Ka.h+=t,Ka.s+=e,Ka.l+=n,this.setHSL(Ka.h,Ka.s,Ka.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(Ka),t.getHSL(Qa),t=Vo.lerp(Ka.h,Qa.h,e);var n=Vo.lerp(Ka.s,Qa.s,e);return e=Vo.lerp(Ka.l,Qa.l,e),this.setHSL(t,n,e),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),b.NAMES=Ja,Object.assign(S.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var ts=0;T.prototype=Object.assign(Object.create(e.prototype),{constructor:T,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0===n)console.warn("THREE.Material: '"+e+"' parameter is undefined.");else if("shading"===e)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else{var r=this[e];void 0===r?console.warn("THREE."+this.type+": '"+e+"' is not a property of this material."):r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n}}},toJSON:function(t){function e(t){var e,n=[];for(e in t){var r=t[e];delete r.metadata,n.push(r)}return n}var n=void 0===t||"string"===typeof t;n&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),0!==this.side&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),1>this.opacity&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),n&&(n=e(t.textures),t=e(t.images),0<n.length&&(r.textures=n),0<t.length&&(r.images=t)),r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(null!==e){var r=e.length;n=Array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(T.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),A.prototype=Object.create(T.prototype),A.prototype.constructor=A,A.prototype.isMeshBasicMaterial=!0,A.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var es=new c;Object.defineProperty(C.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(C.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new b),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,i=0,o=t.length;i<o;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new n),e[r++]=a.x,e[r++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new c),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new o),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z,e[n++]=a.w}return this},applyMatrix3:function(t){for(var e=0,n=this.count;e<n;e++)es.x=this.getX(e),es.y=this.getY(e),es.z=this.getZ(e),es.applyMatrix3(t),this.setXYZ(e,es.x,es.y,es.z);return this},applyMatrix4:function(t){for(var e=0,n=this.count;e<n;e++)es.x=this.getX(e),es.y=this.getY(e),es.z=this.getZ(e),es.applyMatrix4(t),this.setXYZ(e,es.x,es.y,es.z);return this},applyNormalMatrix:function(t){for(var e=0,n=this.count;e<n;e++)es.x=this.getX(e),es.y=this.getY(e),es.z=this.getZ(e),es.applyNormalMatrix(t),this.setXYZ(e,es.x,es.y,es.z);return this},transformDirection:function(t){for(var e=0,n=this.count;e<n;e++)es.x=this.getX(e),es.y=this.getY(e),es.z=this.getZ(e),es.transformDirection(t),this.setXYZ(e,es.x,es.y,es.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),L.prototype=Object.create(C.prototype),L.prototype.constructor=L,I.prototype=Object.create(C.prototype),I.prototype.constructor=I,P.prototype=Object.create(C.prototype),P.prototype.constructor=P,R.prototype=Object.create(C.prototype),R.prototype.constructor=R,O.prototype=Object.create(C.prototype),O.prototype.constructor=O,D.prototype=Object.create(C.prototype),D.prototype.constructor=D,N.prototype=Object.create(C.prototype),N.prototype.constructor=N,k.prototype=Object.create(C.prototype),k.prototype.constructor=k,F.prototype=Object.create(C.prototype),F.prototype.constructor=F,Object.assign(z.prototype,{computeGroups:function(t){var e=[],n=void 0;t=t.faces;for(var r=0;r<t.length;r++){var i=t[r];if(i.materialIndex!==n){n=i.materialIndex,void 0!==o&&(o.count=3*r-o.start,e.push(o));var o={start:3*r,materialIndex:n}}}void 0!==o&&(o.count=3*r-o.start,e.push(o)),this.groups=e},fromGeometry:function(t){var e=t.faces,r=t.vertices,i=t.faceVertexUvs,o=i[0]&&0<i[0].length,a=i[1]&&0<i[1].length,s=t.morphTargets,l=s.length;if(0<l){for(var c=[],u=0;u<l;u++)c[u]={name:s[u].name,data:[]};this.morphTargets.position=c}var h=t.morphNormals,p=h.length;if(0<p){var d=[];for(u=0;u<p;u++)d[u]={name:h[u].name,data:[]};this.morphTargets.normal=d}var f=t.skinIndices,m=t.skinWeights,g=f.length===r.length,y=m.length===r.length;for(0<r.length&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),u=0;u<e.length;u++){var v=e[u];this.vertices.push(r[v.a],r[v.b],r[v.c]);var _=v.vertexNormals;for(3===_.length?this.normals.push(_[0],_[1],_[2]):(_=v.normal,this.normals.push(_,_,_)),_=v.vertexColors,3===_.length?this.colors.push(_[0],_[1],_[2]):(_=v.color,this.colors.push(_,_,_)),!0===o&&(_=i[0][u],void 0!==_?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new n,new n,new n))),!0===a&&(_=i[1][u],void 0!==_?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new n,new n,new n))),_=0;_<l;_++){var x=s[_].vertices;c[_].data.push(x[v.a],x[v.b],x[v.c])}for(_=0;_<p;_++)x=h[_].vertexNormals[u],d[_].data.push(x.a,x.b,x.c);g&&this.skinIndices.push(f[v.a],f[v.b],f[v.c]),y&&this.skinWeights.push(m[v.a],m[v.b],m[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var ns=1,rs=new u,is=new d,os=new c,as=new m,ss=new m,ls=new c;U.prototype=Object.assign(Object.create(e.prototype),{constructor:U,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<B(t)?N:O)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position;if(void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0),e=this.attributes.normal,void 0!==e){var n=(new r).getNormalMatrix(t);e.applyNormalMatrix(n),e.needsUpdate=!0}return e=this.attributes.tangent,void 0!==e&&(e.transformDirection(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return rs.makeRotationX(t),this.applyMatrix4(rs),this},rotateY:function(t){return rs.makeRotationY(t),this.applyMatrix4(rs),this},rotateZ:function(t){return rs.makeRotationZ(t),this.applyMatrix4(rs),this},translate:function(t,e,n){return rs.makeTranslation(t,e,n),this.applyMatrix4(rs),this},scale:function(t,e,n){return rs.makeScale(t,e,n),this.applyMatrix4(rs),this},lookAt:function(t){return is.lookAt(t),is.updateMatrix(),this.applyMatrix4(is.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(os).negate(),this.translate(os.x,os.y,os.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){t=new k(3*e.vertices.length,3);var n=new k(3*e.colors.length,3);this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length&&(t=new k(e.lineDistances.length,1),this.setAttribute("lineDistance",t.copyArray(e.lineDistances))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new k(e,3)),this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var n=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(n=void 0,e.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(e);n.verticesNeedUpdate=e.verticesNeedUpdate,n.normalsNeedUpdate=e.normalsNeedUpdate,n.colorsNeedUpdate=e.colorsNeedUpdate,n.uvsNeedUpdate=e.uvsNeedUpdate,n.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=n}return!0===e.verticesNeedUpdate&&(n=this.attributes.position,void 0!==n&&(n.copyVector3sArray(e.vertices),n.needsUpdate=!0),e.verticesNeedUpdate=!1),!0===e.normalsNeedUpdate&&(n=this.attributes.normal,void 0!==n&&(n.copyVector3sArray(e.normals),n.needsUpdate=!0),e.normalsNeedUpdate=!1),!0===e.colorsNeedUpdate&&(n=this.attributes.color,void 0!==n&&(n.copyColorsArray(e.colors),n.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(n=this.attributes.uv,void 0!==n&&(n.copyVector2sArray(e.uvs),n.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(n=this.attributes.lineDistance,void 0!==n&&(n.copyArray(e.lineDistances),n.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new z).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);for(var n in this.setAttribute("position",new C(e,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(e=new Float32Array(3*t.normals.length),this.setAttribute("normal",new C(e,3).copyVector3sArray(t.normals))),0<t.colors.length&&(e=new Float32Array(3*t.colors.length),this.setAttribute("color",new C(e,3).copyColorsArray(t.colors))),0<t.uvs.length&&(e=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new C(e,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(e=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new C(e,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){e=[];for(var r=t.morphTargets[n],i=0,o=r.length;i<o;i++){var a=r[i],s=new k(3*a.data.length,3);s.name=a.name,e.push(s.copyVector3sArray(a.data))}this.morphAttributes[n]=e}return 0<t.skinIndices.length&&(n=new k(4*t.skinIndices.length,4),this.setAttribute("skinIndex",n.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(n=new k(4*t.skinWeights.length,4),this.setAttribute("skinWeight",n.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m);var t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e){t=0;for(var n=e.length;t<n;t++)as.setFromBufferAttribute(e[t]),this.morphTargetsRelative?(ls.addVectors(this.boundingBox.min,as.min),this.boundingBox.expandByPoint(ls),ls.addVectors(this.boundingBox.max,as.max),this.boundingBox.expandByPoint(ls)):(this.boundingBox.expandByPoint(as.min),this.boundingBox.expandByPoint(as.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new y);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(as.setFromBufferAttribute(t),e)for(var r=0,i=e.length;r<i;r++){var o=e[r];ss.setFromBufferAttribute(o),this.morphTargetsRelative?(ls.addVectors(as.min,ss.min),as.expandByPoint(ls),ls.addVectors(as.max,ss.max),as.expandByPoint(ls)):(as.expandByPoint(ss.min),as.expandByPoint(ss.max))}as.getCenter(n);var a=0;for(r=0,i=t.count;r<i;r++)ls.fromBufferAttribute(t,r),a=Math.max(a,n.distanceToSquared(ls));if(e)for(r=0,i=e.length;r<i;r++){o=e[r];for(var s=this.morphTargetsRelative,l=0,c=o.count;l<c;l++)ls.fromBufferAttribute(o,l),s&&(os.fromBufferAttribute(t,l),ls.add(os)),a=Math.max(a,n.distanceToSquared(ls))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var n=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new C(new Float32Array(n.length),3));else for(var r=e.normal.array,i=0,o=r.length;i<o;i++)r[i]=0;r=e.normal.array;var a=new c,s=new c,l=new c,u=new c,h=new c;if(t){var p=t.array;for(i=0,o=t.count;i<o;i+=3){t=3*p[i+0];var d=3*p[i+1],f=3*p[i+2];a.fromArray(n,t),s.fromArray(n,d),l.fromArray(n,f),u.subVectors(l,s),h.subVectors(a,s),u.cross(h),r[t]+=u.x,r[t+1]+=u.y,r[t+2]+=u.z,r[d]+=u.x,r[d+1]+=u.y,r[d+2]+=u.z,r[f]+=u.x,r[f+1]+=u.y,r[f+2]+=u.z}}else for(i=0,o=n.length;i<o;i+=9)a.fromArray(n,i),s.fromArray(n,i+3),l.fromArray(n,i+6),u.subVectors(l,s),h.subVectors(a,s),u.cross(h),r[i]=u.x,r[i+1]=u.y,r[i+2]=u.z,r[i+3]=u.x,r[i+4]=u.y,r[i+5]=u.z,r[i+6]=u.x,r[i+7]=u.y,r[i+8]=u.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n,r=this.attributes;for(n in r)if(void 0!==t.attributes[n]){var i=r[n].array,o=t.attributes[n],a=o.array,s=o.itemSize*e;o=Math.min(a.length,i.length-s);for(var l=0;l<o;l++,s++)i[s]=a[l]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)ls.x=t.getX(e),ls.y=t.getY(e),ls.z=t.getZ(e),ls.normalize(),t.setXYZ(e,ls.x,ls.y,ls.z)},toNonIndexed:function(){function t(t,e){var n=t.array,r=t.itemSize;t=t.normalized;for(var i,o=new n.constructor(e.length*r),a=0,s=0,l=e.length;s<l;s++){i=e[s]*r;for(var c=0;c<r;c++)o[a++]=n[i++]}return new C(o,r,t)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e,n=new U,r=this.index.array,i=this.attributes;for(e in i){var o=i[e];o=t(o,r),n.setAttribute(e,o)}var a=this.morphAttributes;for(e in a){var s=[],l=a[e];i=0;for(var c=l.length;i<c;i++)o=l[i],o=t(o,r),s.push(o);n.morphAttributes[e]=s}for(n.morphTargetsRelative=this.morphTargetsRelative,r=this.groups,i=0,e=r.length;i<e;i++)o=r[i],n.addGroup(o.start,o.count,o.materialIndex);return n},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),0<Object.keys(this.userData).length&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(c in e)void 0!==e[c]&&(t[c]=e[c]);return t}t.data={attributes:{}},e=this.index,null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});var n=this.attributes;for(c in n){e=n[c];var r=e.toJSON();""!==e.name&&(r.name=e.name),t.data.attributes[c]=r}n={};var i=!1;for(c in this.morphAttributes){for(var o=this.morphAttributes[c],a=[],s=0,l=o.length;s<l;s++)e=o[s],r=e.toJSON(),""!==e.name&&(r.name=e.name),a.push(r);0<a.length&&(n[c]=a,i=!0)}i&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);var c=this.groups;return 0<c.length&&(t.data.groups=JSON.parse(JSON.stringify(c))),c=this.boundingSphere,null!==c&&(t.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),t},clone:function(){return(new U).copy(this)},copy:function(t){var e;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var n=t.index;for(a in null!==n&&this.setIndex(n.clone()),n=t.attributes,n)this.setAttribute(a,n[a].clone());var r=t.morphAttributes;for(a in r){var i=[],o=r[a];for(n=0,e=o.length;n<e;n++)i.push(o[n].clone());this.morphAttributes[a]=i}this.morphTargetsRelative=t.morphTargetsRelative;var a=t.groups;for(n=0,e=a.length;n<e;n++)r=a[n],this.addGroup(r.start,r.count,r.materialIndex);return a=t.boundingBox,null!==a&&(this.boundingBox=a.clone()),a=t.boundingSphere,null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var cs=new u,us=new v,hs=new y,ps=new c,ds=new c,fs=new c,ms=new c,gs=new c,ys=new c,vs=new c,_s=new c,xs=new c,bs=new n,ws=new n,Ms=new n,Es=new c,Ss=new c;j.prototype=Object.assign(Object.create(d.prototype),{constructor:j,isMesh:!0,copy:function(t){return d.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var n=t[e[0]];if(void 0!==n)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}else t=t.morphTargets,void 0!==t&&0<t.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},raycast:function(t,e){var r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),hs.copy(r.boundingSphere),hs.applyMatrix4(o),!1!==t.ray.intersectsSphere(hs)&&(cs.getInverse(o),us.copy(t.ray).applyMatrix4(cs),null===r.boundingBox||!1!==us.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a=r.index;o=r.attributes.position;var s,l,c=r.morphAttributes.position,u=r.morphTargetsRelative,h=r.attributes.uv,p=r.attributes.uv2,d=r.groups,f=r.drawRange;if(null!==a)if(Array.isArray(i)){var m=0;for(s=d.length;m<s;m++){var g=d[m],y=i[g.materialIndex],v=Math.max(g.start,f.start);for(l=r=Math.min(g.start+g.count,f.start+f.count);v<l;v+=3){r=a.getX(v);var _=a.getX(v+1),b=a.getX(v+2);(r=V(this,y,t,us,o,c,u,h,p,r,_,b))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=g.materialIndex,e.push(r))}}}else for(v=Math.max(0,f.start),r=Math.min(a.count,f.start+f.count),m=v,s=r;m<s;m+=3)r=a.getX(m),_=a.getX(m+1),b=a.getX(m+2),(r=V(this,i,t,us,o,c,u,h,p,r,_,b))&&(r.faceIndex=Math.floor(m/3),e.push(r));else if(void 0!==o)if(Array.isArray(i))for(m=0,s=d.length;m<s;m++)for(g=d[m],y=i[g.materialIndex],v=Math.max(g.start,f.start),l=r=Math.min(g.start+g.count,f.start+f.count);v<l;v+=3)r=v,_=v+1,b=v+2,(r=V(this,y,t,us,o,c,u,h,p,r,_,b))&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=g.materialIndex,e.push(r));else for(v=Math.max(0,f.start),r=Math.min(o.count,f.start+f.count),m=v,s=r;m<s;m+=3)r=m,_=m+1,b=m+2,(r=V(this,i,t,us,o,c,u,h,p,r,_,b))&&(r.faceIndex=Math.floor(m/3),e.push(r))}else if(r.isGeometry)for(o=Array.isArray(i),c=r.vertices,u=r.faces,r=r.faceVertexUvs[0],0<r.length&&(a=r),f=0,m=u.length;f<m;f++)s=u[f],r=o?i[s.materialIndex]:i,void 0!==r&&(h=c[s.a],p=c[s.b],d=c[s.c],r=G(this,r,t,us,h,p,d,Es))&&(a&&a[f]&&(g=a[f],bs.copy(g[0]),ws.copy(g[1]),Ms.copy(g[2]),r.uv=x.getUV(Es,h,p,d,bs,ws,Ms,new n)),r.face=s,r.faceIndex=f,e.push(r))},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ts=0,As=new u,Cs=new d,Ls=new c;H.prototype=Object.assign(Object.create(e.prototype),{constructor:H,isGeometry:!0,applyMatrix4:function(t){for(var e=(new r).getNormalMatrix(t),n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(t);for(n=0,i=this.faces.length;n<i;n++){t=this.faces[n],t.normal.applyMatrix3(e).normalize();for(var o=0,a=t.vertexNormals.length;o<a;o++)t.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(t){return As.makeRotationX(t),this.applyMatrix4(As),this},rotateY:function(t){return As.makeRotationY(t),this.applyMatrix4(As),this},rotateZ:function(t){return As.makeRotationZ(t),this.applyMatrix4(As),this},translate:function(t,e,n){return As.makeTranslation(t,e,n),this.applyMatrix4(As),this},scale:function(t,e,n){return As.makeScale(t,e,n),this.applyMatrix4(As),this},lookAt:function(t){return Cs.lookAt(t),Cs.updateMatrix(),this.applyMatrix4(Cs.matrix),this},fromBufferGeometry:function(t){function e(t,e,i,o){var a=void 0===l?[]:[r.colors[t].clone(),r.colors[e].clone(),r.colors[i].clone()],p=void 0===s?[]:[(new c).fromArray(s,3*t),(new c).fromArray(s,3*e),(new c).fromArray(s,3*i)];o=new S(t,e,i,p,a,o),r.faces.push(o),void 0!==u&&r.faceVertexUvs[0].push([(new n).fromArray(u,2*t),(new n).fromArray(u,2*e),(new n).fromArray(u,2*i)]),void 0!==h&&r.faceVertexUvs[1].push([(new n).fromArray(h,2*t),(new n).fromArray(h,2*e),(new n).fromArray(h,2*i)])}var r=this,i=null!==t.index?t.index.array:void 0,o=t.attributes;if(void 0===o.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var a=o.position.array,s=void 0!==o.normal?o.normal.array:void 0,l=void 0!==o.color?o.color.array:void 0,u=void 0!==o.uv?o.uv.array:void 0,h=void 0!==o.uv2?o.uv2.array:void 0;for(void 0!==h&&(this.faceVertexUvs[1]=[]),o=0;o<a.length;o+=3)r.vertices.push((new c).fromArray(a,o)),void 0!==l&&r.colors.push((new b).fromArray(l,o));var p=t.groups;if(0<p.length)for(o=0;o<p.length;o++){a=p[o];var d=a.start,f=d;for(d+=a.count;f<d;f+=3)void 0!==i?e(i[f],i[f+1],i[f+2],a.materialIndex):e(f,f+1,f+2,a.materialIndex)}else if(void 0!==i)for(o=0;o<i.length;o+=3)e(i[o],i[o+1],i[o+2]);else for(o=0;o<a.length/3;o+=3)e(o,o+1,o+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ls).negate(),this.translate(Ls.x,Ls.y,Ls.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius;e=0===e?1:1/e;var n=new u;return n.set(e,0,0,-e*t.x,0,e,0,-e*t.y,0,0,e,-e*t.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){for(var t=new c,e=new c,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],a=this.vertices[i.b];t.subVectors(this.vertices[i.c],a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e;void 0===t&&(t=!0);var n=Array(this.vertices.length),r=0;for(e=this.vertices.length;r<e;r++)n[r]=new c;if(t){var i=new c,o=new c;for(t=0,r=this.faces.length;t<r;t++){e=this.faces[t];var a=this.vertices[e.a],s=this.vertices[e.b],l=this.vertices[e.c];i.subVectors(l,s),o.subVectors(a,s),i.cross(o),n[e.a].add(i),n[e.b].add(i),n[e.c].add(i)}}else for(this.computeFaceNormals(),t=0,r=this.faces.length;t<r;t++)e=this.faces[t],n[e.a].add(e.normal),n[e.b].add(e.normal),n[e.c].add(e.normal);for(r=0,e=this.vertices.length;r<e;r++)n[r].normalize();for(t=0,r=this.faces.length;t<r;t++)e=this.faces[t],a=e.vertexNormals,3===a.length?(a[0].copy(n[e.a]),a[1].copy(n[e.b]),a[2].copy(n[e.c])):(a[0]=n[e.a].clone(),a[1]=n[e.b].clone(),a[2]=n[e.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t;this.computeFaceNormals();var e=0;for(t=this.faces.length;e<t;e++){var n=this.faces[e],r=n.vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n=0;for(e=this.faces.length;n<e;n++){var r=this.faces[n];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);var i=0;for(t=r.vertexNormals.length;i<t;i++)r.__originalVertexNormals[i]?r.__originalVertexNormals[i].copy(r.vertexNormals[i]):r.__originalVertexNormals[i]=r.vertexNormals[i].clone()}var o=new H;for(o.faces=this.faces,i=0,t=this.morphTargets.length;i<t;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[],r=this.morphNormals[i].faceNormals;var a=this.morphNormals[i].vertexNormals;for(n=0,e=this.faces.length;n<e;n++){var s=new c,l={a:new c,b:new c,c:new c};r.push(s),a.push(l)}}for(a=this.morphNormals[i],o.vertices=this.morphTargets[i].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,e=this.faces.length;n<e;n++)r=this.faces[n],s=a.faceNormals[n],l=a.vertexNormals[n],s.copy(r.normal),l.a.copy(r.vertexNormals[0]),l.b.copy(r.vertexNormals[1]),l.c.copy(r.vertexNormals[2])}for(n=0,e=this.faces.length;n<e;n++)r=this.faces[n],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new m),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new y),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(t&&t.isGeometry){var i,o=this.vertices.length,a=this.vertices,s=t.vertices,l=this.faces,c=t.faces,u=this.colors,h=t.colors;void 0===n&&(n=0),void 0!==e&&(i=(new r).getNormalMatrix(e));for(var p=0,d=s.length;p<d;p++){var f=s[p].clone();void 0!==e&&f.applyMatrix4(e),a.push(f)}for(p=0,d=h.length;p<d;p++)u.push(h[p].clone());for(p=0,d=c.length;p<d;p++){s=c[p];var m=s.vertexNormals;for(h=s.vertexColors,u=new S(s.a+o,s.b+o,s.c+o),u.normal.copy(s.normal),void 0!==i&&u.normal.applyMatrix3(i).normalize(),e=0,a=m.length;e<a;e++)f=m[e].clone(),void 0!==i&&f.applyMatrix3(i).normalize(),u.vertexNormals.push(f);for(u.color.copy(s.color),e=0,a=h.length;e<a;e++)f=h[e],u.vertexColors.push(f.clone());u.materialIndex=s.materialIndex+n,l.push(u)}for(p=0,d=t.faceVertexUvs.length;p<d;p++)for(n=t.faceVertexUvs[p],void 0===this.faceVertexUvs[p]&&(this.faceVertexUvs[p]=[]),e=0,a=n.length;e<a;e++){for(i=n[e],o=[],l=0,c=i.length;l<c;l++)o.push(i[l].clone());this.faceVertexUvs[p].push(o)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e={},n=[],r=[],i=Math.pow(10,4),o=0;for(t=this.vertices.length;o<t;o++){var a=this.vertices[o];a=Math.round(a.x*i)+"_"+Math.round(a.y*i)+"_"+Math.round(a.z*i),void 0===e[a]?(e[a]=o,n.push(this.vertices[o]),r[o]=n.length-1):r[o]=r[e[a]]}for(e=[],o=0,t=this.faces.length;o<t;o++)for(i=this.faces[o],i.a=r[i.a],i.b=r[i.b],i.c=r[i.c],i=[i.a,i.b,i.c],a=0;3>a;a++)if(i[a]===i[(a+1)%3]){e.push(o);break}for(o=e.length-1;0<=o;o--)for(i=e[o],this.faces.splice(i,1),r=0,t=this.faceVertexUvs.length;r<t;r++)this.faceVertexUvs[r].splice(i,1);return o=this.vertices.length-n.length,this.vertices=n,o},setFromPoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var r=t[e];this.vertices.push(new c(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));var r,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===e&&(r=[]),a&&a.length===e&&(i=[]),n=0;n<e;n++){var s=t[n]._id;r&&r.push(o[s]),i&&i.push(a[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){function t(t,e,n){return n?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==c[e]||(c[e]=l.length/3,l.push(t.x,t.y,t.z)),c[e]}function n(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==h[e]||(h[e]=u.length,u.push(t.getHex())),h[e]}function r(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]||(d[e]=p.length/2,p.push(t.x,t.y)),d[e]}var i={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),void 0!==this.parameters){var o,a=this.parameters;for(o in a)void 0!==a[o]&&(i[o]=a[o]);return i}for(a=[],o=0;o<this.vertices.length;o++){var s=this.vertices[o];a.push(s.x,s.y,s.z)}s=[];var l=[],c={},u=[],h={},p=[],d={};for(o=0;o<this.faces.length;o++){var f=this.faces[o],m=void 0!==this.faceVertexUvs[0][o],g=0<f.normal.length(),y=0<f.vertexNormals.length,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,_=0<f.vertexColors.length,x=0;x=t(x,0,0),x=t(x,1,!0),x=t(x,2,!1),x=t(x,3,m),x=t(x,4,g),x=t(x,5,y),x=t(x,6,v),x=t(x,7,_),s.push(x),s.push(f.a,f.b,f.c),s.push(f.materialIndex),m&&(m=this.faceVertexUvs[0][o],s.push(r(m[0]),r(m[1]),r(m[2]))),g&&s.push(e(f.normal)),y&&(g=f.vertexNormals,s.push(e(g[0]),e(g[1]),e(g[2]))),v&&s.push(n(f.color)),_&&(f=f.vertexColors,s.push(n(f[0]),n(f[1]),n(f[2])))}return i.data={},i.data.vertices=a,i.data.normals=l,0<u.length&&(i.data.colors=u),0<p.length&&(i.data.uvs=[p]),i.data.faces=s,i},clone:function(){return(new H).copy(this)},copy:function(t){var e,n,r;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var i=t.vertices,o=0;for(e=i.length;o<e;o++)this.vertices.push(i[o].clone());for(i=t.colors,o=0,e=i.length;o<e;o++)this.colors.push(i[o].clone());for(i=t.faces,o=0,e=i.length;o<e;o++)this.faces.push(i[o].clone());for(o=0,e=t.faceVertexUvs.length;o<e;o++){var a=t.faceVertexUvs[o];for(void 0===this.faceVertexUvs[o]&&(this.faceVertexUvs[o]=[]),i=0,n=a.length;i<n;i++){var s=a[i],l=[],c=0;for(r=s.length;c<r;c++)l.push(s[c].clone());this.faceVertexUvs[o].push(l)}}for(c=t.morphTargets,o=0,e=c.length;o<e;o++){if(r={},r.name=c[o].name,void 0!==c[o].vertices)for(r.vertices=[],i=0,n=c[o].vertices.length;i<n;i++)r.vertices.push(c[o].vertices[i].clone());if(void 0!==c[o].normals)for(r.normals=[],i=0,n=c[o].normals.length;i<n;i++)r.normals.push(c[o].normals[i].clone());this.morphTargets.push(r)}for(c=t.morphNormals,o=0,e=c.length;o<e;o++){if(r={},void 0!==c[o].vertexNormals)for(r.vertexNormals=[],i=0,n=c[o].vertexNormals.length;i<n;i++)a=c[o].vertexNormals[i],s={},s.a=a.a.clone(),s.b=a.b.clone(),s.c=a.c.clone(),r.vertexNormals.push(s);if(void 0!==c[o].faceNormals)for(r.faceNormals=[],i=0,n=c[o].faceNormals.length;i<n;i++)r.faceNormals.push(c[o].faceNormals[i].clone());this.morphNormals.push(r)}for(i=t.skinWeights,o=0,e=i.length;o<e;o++)this.skinWeights.push(i[o].clone());for(i=t.skinIndices,o=0,e=i.length;o<e;o++)this.skinIndices.push(i[o].clone());for(i=t.lineDistances,o=0,e=i.length;o<e;o++)this.lineDistances.push(i[o]);return o=t.boundingBox,null!==o&&(this.boundingBox=o.clone()),o=t.boundingSphere,null!==o&&(this.boundingSphere=o.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Is=function(t){function e(e,n,r,i,o,a){t.call(this),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:o,depthSegments:a},this.fromBufferGeometry(new Ps(e,n,r,i,o,a)),this.mergeVertices()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e}(H),Ps=function(t){function e(e,n,r,i,o,a){function s(t,e,n,r,i,o,a,s,g,y,v){var _=o/g,x=a/y,b=o/2,w=a/2,M=s/2;a=g+1;for(var E=y+1,S=o=0,T=new c,A=0;A<E;A++)for(var C=A*x-w,L=0;L<a;L++)T[t]=(L*_-b)*r,T[e]=C*i,T[n]=M,h.push(T.x,T.y,T.z),T[t]=0,T[e]=0,T[n]=0<s?1:-1,p.push(T.x,T.y,T.z),d.push(L/g),d.push(1-A/y),o+=1;for(t=0;t<y;t++)for(e=0;e<g;e++)n=f+e+a*(t+1),r=f+(e+1)+a*(t+1),i=f+(e+1)+a*t,u.push(f+e+a*t,n,i),u.push(n,r,i),S+=6;l.addGroup(m,S,v),m+=S,f+=o}t.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:o,depthSegments:a};var l=this;e=e||1,n=n||1,r=r||1,i=Math.floor(i)||1,o=Math.floor(o)||1,a=Math.floor(a)||1;var u=[],h=[],p=[],d=[],f=0,m=0;s("z","y","x",-1,-1,r,n,e,a,o,0),s("z","y","x",1,-1,r,n,-e,a,o,1),s("x","z","y",1,1,e,r,n,i,a,2),s("x","z","y",1,-1,e,r,-n,i,a,3),s("x","y","z",1,-1,e,n,r,i,o,4),s("x","y","z",-1,-1,e,n,-r,i,o,5),this.setIndex(u),this.setAttribute("position",new k(h,3)),this.setAttribute("normal",new k(p,3)),this.setAttribute("uv",new k(d,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e}(U),Rs={clone:W,merge:q};X.prototype=Object.create(T.prototype),X.prototype.constructor=X,X.prototype.isShaderMaterial=!0,X.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=W(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this},X.prototype.toJSON=function(t){var e=T.prototype.toJSON.call(this,t);for(var n in e.uniforms={},this.uniforms){var r=this.uniforms[n].value;e.uniforms[n]=r&&r.isTexture?{type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}for(var i in 0<Object.keys(this.defines).length&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,t={},this.extensions)!0===this.extensions[i]&&(t[i]=!0);return 0<Object.keys(t).length&&(e.extensions=t),e},Z.prototype=Object.assign(Object.create(d.prototype),{constructor:Z,isCamera:!0,copy:function(t,e){return d.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new c),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){d.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){d.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Y.prototype=Object.assign(Object.create(Z.prototype),{constructor:Y,isPerspectiveCamera:!0,copy:function(t,e){return Z.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){t=.5*this.getFilmHeight()/t,this.fov=2*Vo.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Vo.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Vo.RAD2DEG*Math.atan(Math.tan(.5*Vo.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*Vo.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,e-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}o=this.filmOffset,0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){return t=d.prototype.toJSON.call(this,t),t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),$.prototype=Object.create(d.prototype),$.prototype.constructor=$,J.prototype=Object.create(a.prototype),J.prototype.constructor=J,J.prototype.isWebGLCubeRenderTarget=!0,J.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var n=new f,r=new X({type:"CubemapFromEquirect",uniforms:W({tEquirect:{value:null}}),vertexShader:"varying vec3 vWorldDirection;\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragmentShader:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}",side:1,blending:0});return r.uniforms.tEquirect.value=e,e=new j(new Ps(5,5,5),r),n.add(e),new $(1,10,this).update(t,n),e.geometry.dispose(),e.material.dispose(),this},K.prototype=Object.create(i.prototype),K.prototype.constructor=K,K.prototype.isDataTexture=!0;var Os=new y,Ds=new c;Object.assign(Q.prototype,{set:function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,n=0;6>n;n++)e[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){var e=this.planes,n=t.elements;t=n[0];var r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],l=n[6],c=n[7],u=n[8],h=n[9],p=n[10],d=n[11],f=n[12],m=n[13],g=n[14];return n=n[15],e[0].setComponents(o-t,c-a,d-u,n-f).normalize(),e[1].setComponents(o+t,c+a,d+u,n+f).normalize(),e[2].setComponents(o+r,c+s,d+h,n+m).normalize(),e[3].setComponents(o-r,c-s,d-h,n-m).normalize(),e[4].setComponents(o-i,c-l,d-p,n-g).normalize(),e[5].setComponents(o+i,c+l,d+p,n+g).normalize(),this},intersectsObject:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Os.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Os)},intersectsSprite:function(t){return Os.center.set(0,0,0),Os.radius=.7071067811865476,Os.applyMatrix4(t.matrixWorld),this.intersectsSphere(Os)},intersectsSphere:function(t){var e=this.planes,n=t.center;t=-t.radius;for(var r=0;6>r;r++)if(e[r].distanceToPoint(n)<t)return!1;return!0},intersectsBox:function(t){for(var e=this.planes,n=0;6>n;n++){var r=e[n];if(Ds.x=0<r.normal.x?t.max.x:t.min.x,Ds.y=0<r.normal.y?t.max.y:t.min.y,Ds.z=0<r.normal.z?t.max.z:t.min.z,0>r.distanceToPoint(Ds))return!1}return!0},containsPoint:function(t){for(var e=this.planes,n=0;6>n;n++)if(0>e[n].distanceToPoint(t))return!1;return!0}});var Ns={common:{diffuse:{value:new b(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new r},uv2Transform:{value:new r},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new n(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new b(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new b(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new r}},sprite:{diffuse:{value:new b(15658734)},opacity:{value:1},center:{value:new n(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new r}}};nt.prototype=Object.create(H.prototype),nt.prototype.constructor=nt,rt.prototype=Object.create(U.prototype),rt.prototype.constructor=rt;var ks={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Fs={basic:{uniforms:q([Ns.common,Ns.specularmap,Ns.envmap,Ns.aomap,Ns.lightmap,Ns.fog]),vertexShader:ks.meshbasic_vert,fragmentShader:ks.meshbasic_frag},lambert:{uniforms:q([Ns.common,Ns.specularmap,Ns.envmap,Ns.aomap,Ns.lightmap,Ns.emissivemap,Ns.fog,Ns.lights,{emissive:{value:new b(0)}}]),vertexShader:ks.meshlambert_vert,fragmentShader:ks.meshlambert_frag},phong:{uniforms:q([Ns.common,Ns.specularmap,Ns.envmap,Ns.aomap,Ns.lightmap,Ns.emissivemap,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,Ns.fog,Ns.lights,{emissive:{value:new b(0)},specular:{value:new b(1118481)},shininess:{value:30}}]),vertexShader:ks.meshphong_vert,fragmentShader:ks.meshphong_frag},standard:{uniforms:q([Ns.common,Ns.envmap,Ns.aomap,Ns.lightmap,Ns.emissivemap,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,Ns.roughnessmap,Ns.metalnessmap,Ns.fog,Ns.lights,{emissive:{value:new b(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ks.meshphysical_vert,fragmentShader:ks.meshphysical_frag},toon:{uniforms:q([Ns.common,Ns.specularmap,Ns.aomap,Ns.lightmap,Ns.emissivemap,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,Ns.gradientmap,Ns.fog,Ns.lights,{emissive:{value:new b(0)},specular:{value:new b(1118481)},shininess:{value:30}}]),vertexShader:ks.meshtoon_vert,fragmentShader:ks.meshtoon_frag},matcap:{uniforms:q([Ns.common,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,Ns.fog,{matcap:{value:null}}]),vertexShader:ks.meshmatcap_vert,fragmentShader:ks.meshmatcap_frag},points:{uniforms:q([Ns.points,Ns.fog]),vertexShader:ks.points_vert,fragmentShader:ks.points_frag},dashed:{uniforms:q([Ns.common,Ns.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ks.linedashed_vert,fragmentShader:ks.linedashed_frag},depth:{uniforms:q([Ns.common,Ns.displacementmap]),vertexShader:ks.depth_vert,fragmentShader:ks.depth_frag},normal:{uniforms:q([Ns.common,Ns.bumpmap,Ns.normalmap,Ns.displacementmap,{opacity:{value:1}}]),vertexShader:ks.normal_vert,fragmentShader:ks.normal_frag},sprite:{uniforms:q([Ns.sprite,Ns.fog]),vertexShader:ks.sprite_vert,fragmentShader:ks.sprite_frag},background:{uniforms:{uvTransform:{value:new r},t2D:{value:null}},vertexShader:ks.background_vert,fragmentShader:ks.background_frag},cube:{uniforms:q([Ns.envmap,{opacity:{value:1}}]),vertexShader:ks.cube_vert,fragmentShader:ks.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ks.equirect_vert,fragmentShader:ks.equirect_frag},distanceRGBA:{uniforms:q([Ns.common,Ns.displacementmap,{referencePosition:{value:new c},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ks.distanceRGBA_vert,fragmentShader:ks.distanceRGBA_frag},shadow:{uniforms:q([Ns.lights,Ns.fog,{color:{value:new b(0)},opacity:{value:1}}]),vertexShader:ks.shadow_vert,fragmentShader:ks.shadow_frag}};Fs.physical={uniforms:q([Fs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new n(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new b(0)},transparency:{value:0}}]),vertexShader:ks.meshphysical_vert,fragmentShader:ks.meshphysical_frag},mt.prototype=Object.create(i.prototype),mt.prototype.constructor=mt,mt.prototype.isCubeTexture=!0,Object.defineProperty(mt.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),gt.prototype=Object.create(i.prototype),gt.prototype.constructor=gt,gt.prototype.isDataTexture2DArray=!0,yt.prototype=Object.create(i.prototype),yt.prototype.constructor=yt,yt.prototype.isDataTexture3D=!0;var zs=new i,Bs=new gt,Us=new yt,js=new mt,Gs=[],Vs=[],Hs=new Float32Array(16),Ws=new Float32Array(9),qs=new Float32Array(4);te.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),xt(e,t)},ee.prototype.setValue=function(t,e,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(t,e[a.id],n)}};var Xs=/([\w\d_]+)(\])?(\[|\.)?/g;ne.prototype.setValue=function(t,e,n,r){e=this.map[e],void 0!==e&&e.setValue(t,n,r)},ne.prototype.setOptional=function(t,e,n){e=e[n],void 0!==e&&this.setValue(t,n,e)},ne.upload=function(t,e,n,r){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,r)}},ne.seqWithValue=function(t,e){for(var n=[],r=0,i=t.length;r!==i;++r){var o=t[r];o.id in e&&n.push(o)}return n};var Zs=0,Ys=/^[ \t]*#include +<([\w\d./]+)>/gm,$s=/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Js=/#pragma unroll_loop_start[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g,Ks=0;De.prototype=Object.create(T.prototype),De.prototype.constructor=De,De.prototype.isMeshDepthMaterial=!0,De.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Ne.prototype=Object.create(T.prototype),Ne.prototype.constructor=Ne,Ne.prototype.isMeshDistanceMaterial=!0,Ne.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},Ue.prototype=Object.assign(Object.create(Y.prototype),{constructor:Ue,isArrayCamera:!0}),je.prototype=Object.assign(Object.create(d.prototype),{constructor:je,isGroup:!0}),Object.assign(Ge.prototype,{constructor:Ge,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new je,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new je,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(t,e,n){var r=null,i=null,o=this._targetRay,a=this._grip;return t&&(null!==o&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)))),null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),this}}),Object.assign(Ve.prototype,e.prototype),Object.assign(qe.prototype,{isFogExp2:!0,clone:function(){return new qe(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Xe.prototype,{isFog:!0,clone:function(){return new Xe(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Ze.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Ze.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var Qs=new c;Object.defineProperties(Ye.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ye.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,n=this.data.count;e<n;e++)Qs.x=this.getX(e),Qs.y=this.getY(e),Qs.z=this.getZ(e),Qs.applyMatrix4(t),this.setXYZ(e,Qs.x,Qs.y,Qs.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var n=e*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[n+r]);return new C(new this.array.constructor(t),this.itemSize,this.normalized)},toJSON:function(){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var n=e*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[n+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}}),$e.prototype=Object.create(T.prototype),$e.prototype.constructor=$e,$e.prototype.isSpriteMaterial=!0,$e.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var tl,el=new c,nl=new c,rl=new c,il=new n,ol=new n,al=new u,sl=new c,ll=new c,cl=new c,ul=new n,hl=new n,pl=new n;Je.prototype=Object.assign(Object.create(d.prototype),{constructor:Je,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),nl.setFromMatrixScale(this.matrixWorld),al.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),rl.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&nl.multiplyScalar(-rl.z);var r=this.material.rotation;if(0!==r)var i=Math.cos(r),o=Math.sin(r);r=this.center,Ke(sl.set(-.5,-.5,0),rl,r,nl,o,i),Ke(ll.set(.5,-.5,0),rl,r,nl,o,i),Ke(cl.set(.5,.5,0),rl,r,nl,o,i),ul.set(0,0),hl.set(1,0),pl.set(1,1);var a=t.ray.intersectTriangle(sl,ll,cl,!1,el);null===a&&(Ke(ll.set(-.5,.5,0),rl,r,nl,o,i),hl.set(0,1),a=t.ray.intersectTriangle(sl,cl,ll,!1,el),null===a)||(o=t.ray.origin.distanceTo(el),o<t.near||o>t.far||e.push({distance:o,point:el.clone(),uv:x.getUV(el,sl,ll,cl,ul,hl,pl,new n),face:null,object:this}))},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return d.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var dl=new c,fl=new c;Qe.prototype=Object.assign(Object.create(d.prototype),{constructor:Qe,isLOD:!0,copy:function(t){d.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,r=e.length;n<r;n++){var i=e[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var n=this.levels,r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){var e=this.levels;if(0<e.length){for(var n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(0<this.levels.length){dl.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(dl);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){var e=this.levels;if(1<e.length){dl.setFromMatrixPosition(t.matrixWorld),fl.setFromMatrixPosition(this.matrixWorld),t=dl.distanceTo(fl)/t.zoom,e[0].object.visible=!0;for(var n=1,r=e.length;n<r;n++){if(!(t>=e[n].distance))break;e[n-1].object.visible=!1,e[n].object.visible=!0}for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}},toJSON:function(t){t=d.prototype.toJSON.call(this,t),!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var e=this.levels,n=0,r=e.length;n<r;n++){var i=e[n];t.object.levels.push({object:i.object.uuid,distance:i.distance})}return t}}),tn.prototype=Object.assign(Object.create(j.prototype),{constructor:tn,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new o,e=this.geometry.attributes.skinWeight,n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);var i=1/t.manhattanLength();1/0!==i?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){j.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},boneTransform:function(){var t=new c,e=new o,n=new o,r=new c,i=new u;return function(o,a){var s=this.skeleton,l=this.geometry;for(e.fromBufferAttribute(l.attributes.skinIndex,o),n.fromBufferAttribute(l.attributes.skinWeight,o),t.fromBufferAttribute(l.attributes.position,o).applyMatrix4(this.bindMatrix),a.set(0,0,0),o=0;4>o;o++)if(l=n.getComponent(o),0!==l){var c=e.getComponent(o);i.multiplyMatrices(s.bones[c].matrixWorld,s.boneInverses[c]),a.addScaledVector(r.copy(t).applyMatrix4(i),l)}return a.applyMatrix4(this.bindMatrixInverse)}}()});var ml=new u,gl=new u;Object.assign(en.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new u;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){var t,e,n=0;for(e=this.bones.length;n<e;n++)(t=this.bones[n])&&t.matrixWorld.getInverse(this.boneInverses[n]);for(n=0,e=this.bones.length;n<e;n++)(t=this.bones[n])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=t.length;i<o;i++)ml.multiplyMatrices(t[i]?t[i].matrixWorld:gl,e[i]),ml.toArray(n,16*i);void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new en(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),nn.prototype=Object.assign(Object.create(d.prototype),{constructor:nn,isBone:!0});var yl=new u,vl=new u,_l=[],xl=new j;rn.prototype=Object.assign(Object.create(j.prototype),{constructor:rn,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){var n=this.matrixWorld,r=this.count;if(xl.geometry=this.geometry,xl.material=this.material,void 0!==xl.material)for(var i=0;i<r;i++){this.getMatrixAt(i,yl),vl.multiplyMatrices(n,yl),xl.matrixWorld=vl,xl.raycast(t,_l);for(var o=0,a=_l.length;o<a;o++){var s=_l[o];s.instanceId=i,s.object=this,e.push(s)}_l.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),on.prototype=Object.create(T.prototype),on.prototype.constructor=on,on.prototype.isLineBasicMaterial=!0,on.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};var bl=new c,wl=new c,Ml=new u,El=new v,Sl=new y;an.prototype=Object.assign(Object.create(d.prototype),{constructor:an,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)bl.fromBufferAttribute(e,r-1),wl.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=bl.distanceTo(wl);t.setAttribute("lineDistance",new k(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(e=t.vertices,n=t.lineDistances,n[0]=0,r=1,i=e.length;r<i;r++)n[r]=n[r-1],n[r]+=e[r-1].distanceTo(e[r]);return this},raycast:function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Sl.copy(n.boundingSphere),Sl.applyMatrix4(r),Sl.radius+=i,!1!==t.ray.intersectsSphere(Sl)){Ml.getInverse(r),El.copy(t.ray).applyMatrix4(Ml),r=i/((this.scale.x+this.scale.y+this.scale.z)/3),r*=r;var o=new c,a=new c;i=new c;var s=new c,l=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var u=n.index,h=n.attributes.position.array;if(null!==u){u=u.array,n=0;for(var p=u.length-1;n<p;n+=l){var d=u[n+1];o.fromArray(h,3*u[n]),a.fromArray(h,3*d),d=El.distanceSqToSegment(o,a,s,i),d>r||(s.applyMatrix4(this.matrixWorld),d=t.ray.origin.distanceTo(s),d<t.near||d>t.far||e.push({distance:d,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}}else for(n=0,p=h.length/3-1;n<p;n+=l)o.fromArray(h,3*n),a.fromArray(h,3*n+3),d=El.distanceSqToSegment(o,a,s,i),d>r||(s.applyMatrix4(this.matrixWorld),d=t.ray.origin.distanceTo(s),d<t.near||d>t.far||e.push({distance:d,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}else if(n.isGeometry)for(o=n.vertices,a=o.length,n=0;n<a-1;n+=l)d=El.distanceSqToSegment(o[n],o[n+1],s,i),d>r||(s.applyMatrix4(this.matrixWorld),d=t.ray.origin.distanceTo(s),d<t.near||d>t.far||e.push({distance:d,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var n=t[e[0]];if(void 0!==n)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}else t=t.morphTargets,void 0!==t&&0<t.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Tl=new c,Al=new c;sn.prototype=Object.assign(Object.create(an.prototype),{constructor:sn,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,n=[],r=0,i=e.count;r<i;r+=2)Tl.fromBufferAttribute(e,r),Al.fromBufferAttribute(e,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+Tl.distanceTo(Al);t.setAttribute("lineDistance",new k(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(e=t.vertices,n=t.lineDistances,r=0,i=e.length;r<i;r+=2)Tl.copy(e[r]),Al.copy(e[r+1]),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+Tl.distanceTo(Al);return this}}),ln.prototype=Object.assign(Object.create(an.prototype),{constructor:ln,isLineLoop:!0}),cn.prototype=Object.create(T.prototype),cn.prototype.constructor=cn,cn.prototype.isPointsMaterial=!0,cn.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var Cl=new u,Ll=new v,Il=new y,Pl=new c;un.prototype=Object.assign(Object.create(d.prototype),{constructor:un,isPoints:!0,raycast:function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Il.copy(n.boundingSphere),Il.applyMatrix4(r),Il.radius+=i,!1!==t.ray.intersectsSphere(Il))if(Cl.getInverse(r),Ll.copy(t.ray).applyMatrix4(Cl),i/=(this.scale.x+this.scale.y+this.scale.z)/3,i*=i,n.isBufferGeometry){var o=n.index;if(n=n.attributes.position.array,null!==o){var a=o.array;o=0;for(var s=a.length;o<s;o++){var l=a[o];Pl.fromArray(n,3*l),hn(Pl,l,i,r,t,e,this)}}else for(o=0,a=n.length/3;o<a;o++)Pl.fromArray(n,3*o),hn(Pl,o,i,r,t,e,this)}else for(n=n.vertices,o=0,a=n.length;o<a;o++)hn(n[o],o,i,r,t,e,this)},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var n=t[e[0]];if(void 0!==n)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=n.length;t<e;t++){var r=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}else t=t.morphTargets,void 0!==t&&0<t.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),pn.prototype=Object.assign(Object.create(i.prototype),{constructor:pn,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),dn.prototype=Object.create(i.prototype),dn.prototype.constructor=dn,dn.prototype.isCompressedTexture=!0,fn.prototype=Object.create(i.prototype),fn.prototype.constructor=fn,fn.prototype.isCanvasTexture=!0,mn.prototype=Object.create(i.prototype),mn.prototype.constructor=mn,mn.prototype.isDepthTexture=!0,gn.prototype=Object.create(U.prototype),gn.prototype.constructor=gn,yn.prototype=Object.create(H.prototype),yn.prototype.constructor=yn,vn.prototype=Object.create(U.prototype),vn.prototype.constructor=vn,_n.prototype=Object.create(H.prototype),_n.prototype.constructor=_n,xn.prototype=Object.create(U.prototype),xn.prototype.constructor=xn,bn.prototype=Object.create(H.prototype),bn.prototype.constructor=bn,wn.prototype=Object.create(xn.prototype),wn.prototype.constructor=wn,Mn.prototype=Object.create(H.prototype),Mn.prototype.constructor=Mn,En.prototype=Object.create(xn.prototype),En.prototype.constructor=En,Sn.prototype=Object.create(H.prototype),Sn.prototype.constructor=Sn,Tn.prototype=Object.create(xn.prototype),Tn.prototype.constructor=Tn,An.prototype=Object.create(H.prototype),An.prototype.constructor=An,Cn.prototype=Object.create(xn.prototype),Cn.prototype.constructor=Cn,Ln.prototype=Object.create(H.prototype),Ln.prototype.constructor=Ln,In.prototype=Object.create(U.prototype),In.prototype.constructor=In,In.prototype.toJSON=function(){var t=U.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},Pn.prototype=Object.create(H.prototype),Pn.prototype.constructor=Pn,Rn.prototype=Object.create(U.prototype),Rn.prototype.constructor=Rn,On.prototype=Object.create(H.prototype),On.prototype.constructor=On,Dn.prototype=Object.create(U.prototype),Dn.prototype.constructor=Dn;var Rl={triangulate:function(t,e,n){n=n||2;var r,i=e&&e.length,o=i?e[0]*n:t.length,a=Nn(t,0,o,n,!0),s=[];if(!a||a.next===a.prev)return s;if(i){var l,c=n;i=[];var u=0;for(l=e.length;u<l;u++){var h=e[u]*c,p=u<l-1?e[u+1]*c:t.length;h=Nn(t,h,p,c,!1),h===h.next&&(h.steiner=!0),i.push(Gn(h))}for(i.sort(Bn),u=0;u<i.length;u++)c=i[u],e=a,(e=Un(c,e))&&(c=$n(e,c),kn(e,e.next),kn(c,c.next)),a=kn(a,a.next)}if(t.length>80*n){var d=r=t[0],f=i=t[1];for(c=n;c<o;c+=n)u=t[c],e=t[c+1],u<d&&(d=u),e<f&&(f=e),u>r&&(r=u),e>i&&(i=e);r=Math.max(r-d,i-f),r=0!==r?1/r:0}return Fn(a,s,n,d,f,r),s}},Ol={area:function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isClockWise:function(t){return 0>Ol.area(t)},triangulateShape:function(t,e){var n=[],r=[],i=[];tr(t),er(n,t);var o=t.length;for(e.forEach(tr),t=0;t<e.length;t++)r.push(o),o+=e[t].length,er(n,e[t]);for(e=Rl.triangulate(n,r),t=0;t<e.length;t+=3)i.push(e.slice(t,t+3));return i}};nr.prototype=Object.create(H.prototype),nr.prototype.constructor=nr,nr.prototype.toJSON=function(){var t=H.prototype.toJSON.call(this);return ir(this.parameters.shapes,this.parameters.options,t)},rr.prototype=Object.create(U.prototype),rr.prototype.constructor=rr,rr.prototype.toJSON=function(){var t=U.prototype.toJSON.call(this);return ir(this.parameters.shapes,this.parameters.options,t)};var Dl={generateTopUV:function(t,e,r,i,o){t=e[3*i],i=e[3*i+1];var a=e[3*o];return o=e[3*o+1],[new n(e[3*r],e[3*r+1]),new n(t,i),new n(a,o)]},generateSideWallUV:function(t,e,r,i,o,a){t=e[3*r];var s=e[3*r+1];r=e[3*r+2];var l=e[3*i],c=e[3*i+1];i=e[3*i+2];var u=e[3*o],h=e[3*o+1];o=e[3*o+2];var p=e[3*a],d=e[3*a+1];return e=e[3*a+2],.01>Math.abs(s-c)?[new n(t,1-r),new n(l,1-i),new n(u,1-o),new n(p,1-e)]:[new n(s,1-r),new n(c,1-i),new n(h,1-o),new n(d,1-e)]}};or.prototype=Object.create(H.prototype),or.prototype.constructor=or,ar.prototype=Object.create(rr.prototype),ar.prototype.constructor=ar,sr.prototype=Object.create(H.prototype),sr.prototype.constructor=sr,lr.prototype=Object.create(U.prototype),lr.prototype.constructor=lr,cr.prototype=Object.create(H.prototype),cr.prototype.constructor=cr,ur.prototype=Object.create(U.prototype),ur.prototype.constructor=ur,hr.prototype=Object.create(H.prototype),hr.prototype.constructor=hr,pr.prototype=Object.create(U.prototype),pr.prototype.constructor=pr,dr.prototype=Object.create(H.prototype),dr.prototype.constructor=dr,dr.prototype.toJSON=function(){var t=H.prototype.toJSON.call(this);return mr(this.parameters.shapes,t)},fr.prototype=Object.create(U.prototype),fr.prototype.constructor=fr,fr.prototype.toJSON=function(){var t=U.prototype.toJSON.call(this);return mr(this.parameters.shapes,t)},gr.prototype=Object.create(U.prototype),gr.prototype.constructor=gr,yr.prototype=Object.create(H.prototype),yr.prototype.constructor=yr,vr.prototype=Object.create(U.prototype),vr.prototype.constructor=vr,_r.prototype=Object.create(yr.prototype),_r.prototype.constructor=_r,xr.prototype=Object.create(vr.prototype),xr.prototype.constructor=xr,br.prototype=Object.create(H.prototype),br.prototype.constructor=br,wr.prototype=Object.create(U.prototype),wr.prototype.constructor=wr;var Nl=Object.freeze({__proto__:null,WireframeGeometry:gn,ParametricGeometry:yn,ParametricBufferGeometry:vn,TetrahedronGeometry:bn,TetrahedronBufferGeometry:wn,OctahedronGeometry:Mn,OctahedronBufferGeometry:En,IcosahedronGeometry:Sn,IcosahedronBufferGeometry:Tn,DodecahedronGeometry:An,DodecahedronBufferGeometry:Cn,PolyhedronGeometry:_n,PolyhedronBufferGeometry:xn,TubeGeometry:Ln,TubeBufferGeometry:In,TorusKnotGeometry:Pn,TorusKnotBufferGeometry:Rn,TorusGeometry:On,TorusBufferGeometry:Dn,TextGeometry:or,TextBufferGeometry:ar,SphereGeometry:sr,SphereBufferGeometry:lr,RingGeometry:cr,RingBufferGeometry:ur,PlaneGeometry:nt,PlaneBufferGeometry:rt,LatheGeometry:hr,LatheBufferGeometry:pr,ShapeGeometry:dr,ShapeBufferGeometry:fr,ExtrudeGeometry:nr,ExtrudeBufferGeometry:rr,EdgesGeometry:gr,ConeGeometry:_r,ConeBufferGeometry:xr,CylinderGeometry:yr,CylinderBufferGeometry:vr,CircleGeometry:br,CircleBufferGeometry:wr,BoxGeometry:Is,BoxBufferGeometry:Ps});Mr.prototype=Object.create(T.prototype),Mr.prototype.constructor=Mr,Mr.prototype.isShadowMaterial=!0,Mr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this},Er.prototype=Object.create(X.prototype),Er.prototype.constructor=Er,Er.prototype.isRawShaderMaterial=!0,Sr.prototype=Object.create(T.prototype),Sr.prototype.constructor=Sr,Sr.prototype.isMeshStandardMaterial=!0,Sr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},Tr.prototype=Object.create(Sr.prototype),Tr.prototype.constructor=Tr,Tr.prototype.isMeshPhysicalMaterial=!0,Tr.prototype.copy=function(t){return Sr.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,this.sheen=t.sheen?(this.sheen||new b).copy(t.sheen):null,this.transparency=t.transparency,this},Ar.prototype=Object.create(T.prototype),Ar.prototype.constructor=Ar,Ar.prototype.isMeshPhongMaterial=!0,Ar.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Cr.prototype=Object.create(T.prototype),Cr.prototype.constructor=Cr,Cr.prototype.isMeshToonMaterial=!0,Cr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Lr.prototype=Object.create(T.prototype),Lr.prototype.constructor=Lr,Lr.prototype.isMeshNormalMaterial=!0,Lr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Ir.prototype=Object.create(T.prototype),Ir.prototype.constructor=Ir,Ir.prototype.isMeshLambertMaterial=!0,Ir.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Pr.prototype=Object.create(T.prototype),Pr.prototype.constructor=Pr,Pr.prototype.isMeshMatcapMaterial=!0,Pr.prototype.copy=function(t){return T.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Rr.prototype=Object.create(on.prototype),Rr.prototype.constructor=Rr,Rr.prototype.isLineDashedMaterial=!0,Rr.prototype.copy=function(t){return on.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var kl=Object.freeze({__proto__:null,ShadowMaterial:Mr,SpriteMaterial:$e,RawShaderMaterial:Er,ShaderMaterial:X,PointsMaterial:cn,MeshPhysicalMaterial:Tr,MeshStandardMaterial:Sr,MeshPhongMaterial:Ar,MeshToonMaterial:Cr,MeshNormalMaterial:Lr,MeshLambertMaterial:Ir,MeshDepthMaterial:De,MeshDistanceMaterial:Ne,MeshBasicMaterial:A,MeshMatcapMaterial:Pr,LineDashedMaterial:Rr,LineBasicMaterial:on,Material:T}),Fl={arraySlice:function(t,e,n){return Fl.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=Array(e),r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*e,l=0;l!==e;++l)i[a++]=t[s+l];return i},flattenJSON:function(t,e,n,r){for(var i=1,o=t[0];void 0!==o&&void 0===o[r];)o=t[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{a=o[r],void 0!==a&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{a=o[r],void 0!==a&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{a=o[r],void 0!==a&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)}},subclip:function(t,e,n,r,i){i=i||30,t=t.clone(),t.name=e;var o=[];for(e=0;e<t.tracks.length;++e){for(var a=t.tracks[e],s=a.getValueSize(),l=[],c=[],u=0;u<a.times.length;++u){var h=a.times[u]*i;if(!(h<n||h>=r))for(l.push(a.times[u]),h=0;h<s;++h)c.push(a.values[u*s+h])}0!==l.length&&(a.times=Fl.convertArray(l,a.times.constructor),a.values=Fl.convertArray(c,a.values.constructor),o.push(a))}for(t.tracks=o,n=1/0,e=0;e<t.tracks.length;++e)n>t.tracks[e].times[0]&&(n=t.tracks[e].times[0]);for(e=0;e<t.tracks.length;++e)t.tracks[e].shift(-1*n);return t.resetDuration(),t},makeClipAdditive:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=t),(void 0===r||0>=r)&&(r=30);var i=t.tracks.length;for(e/=r,r=0;r<i;++r){var o=n.tracks[r],a=o.ValueTypeName;if("bool"!==a&&"string"!==a){var s=t.tracks.find((function(t){return t.name===o.name&&t.ValueTypeName===a}));if(void 0!==s){var c=o.getValueSize(),u=o.times.length-1;e<=o.times[0]?u=Fl.arraySlice(o.values,0,o.valueSize):e>=o.times[u]?u=Fl.arraySlice(o.values,u*c):(u=o.createInterpolant(),u.evaluate(e),u=u.resultBuffer),"quaternion"===a&&new l(u[0],u[1],u[2],u[3]).normalize().conjugate().toArray(u);for(var h=s.times.length,p=0;p<h;++p){var d=p*c;if("quaternion"===a)l.multiplyQuaternionsFlat(s.values,d,u,0,s.values,d);else for(var f=0;f<c;++f)s.values[d+f]-=u[f]}}}}return t.blendMode=2501,t}};Object.assign(Or.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{n:{r:if(!(t<r)){for(var o=n+2;;){if(void 0===r){if(t<i)break r;return this._cachedIndex=n=e.length,this.afterEnd_(n-1,t,i)}if(n===o)break;if(i=r,r=e[++n],t<r)break e}r=e.length;break n}if(t>=i)break t;for(o=e[1],t<o&&(n=2,i=o),o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===o)break;if(r=i,i=e[--n-1],t>=i)break e}r=n,n=0}for(;n<r;)i=n+r>>>1,t<e[i]?r=i:n=i+1;if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return this._cachedIndex=n=e.length,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize;t*=r;for(var i=0;i!==r;++i)e[i]=n[t+i];return e},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Or.prototype,{beforeStart_:Or.prototype.copySampleValue_,afterEnd_:Or.prototype.copySampleValue_}),Dr.prototype=Object.assign(Object.create(Or.prototype),{constructor:Dr,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,n){var r=this.parameterPositions,i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=t,a=2*e-n;break;case 2402:i=r.length-2,a=e+r[i]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=t,s=2*n-e;break;case 2402:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}t=.5*(n-e),r=this.valueSize,this._weightPrev=t/(e-a),this._weightNext=t/(s-n),this._offsetPrev=i*r,this._offsetNext=o*r},interpolate_:function(t,e,n,r){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;t*=a;var s=t-a,l=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,h=this._weightNext,p=(n-e)/(r-e);for(n=p*p,r=n*p,e=-u*r+2*u*n-u*p,u=(1+u)*r+(-1.5-2*u)*n+(-.5+u)*p+1,p=(-1-h)*r+(1.5+h)*n+.5*p,h=h*r-h*n,n=0;n!==a;++n)i[n]=e*o[l+n]+u*o[s+n]+p*o[t+n]+h*o[c+n];return i}}),Nr.prototype=Object.assign(Object.create(Or.prototype),{constructor:Nr,interpolate_:function(t,e,n,r){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;t*=a;var s=t-a;for(e=(n-e)/(r-e),n=1-e,r=0;r!==a;++r)i[r]=o[s+r]*n+o[t+r]*e;return i}}),kr.prototype=Object.assign(Object.create(Or.prototype),{constructor:kr,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Fr,{toJSON:function(t){var e=t.constructor;if(void 0!==e.toJSON)e=e.toJSON(t);else{e={name:t.name,times:Fl.convertArray(t.times,Array),values:Fl.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}}),Object.assign(Fr.prototype,{constructor:Fr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new kr(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Nr(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Dr(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){switch(t){case 2300:var e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){if(e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;return++o,0===i&&o===r||(i>=o&&(o=Math.max(o,1),i=o-1),t=this.getValueSize(),this.times=Fl.arraySlice(n,i,o),this.values=Fl.arraySlice(this.values,i*t,o*t)),this},validate:function(){var t=!0,e=this.getValueSize();0!==e-Math.floor(e)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times;e=this.values;var r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var i=null,o=0;o!==r;o++){var a=n[o];if("number"===typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),t=!1;break}if(null!==i&&i>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,i),t=!1;break}i=a}if(void 0!==e&&Fl.isTypedArray(e))for(o=0,n=e.length;o!==n;++o)if(r=e[o],isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,r),t=!1;break}return t},optimize:function(){for(var t=Fl.arraySlice(this.times),e=Fl.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),i=1,o=t.length-1,a=1;a<o;++a){var s=!1,l=t[a];if(l!==t[a+1]&&(1!==a||l!==l[0]))if(r)s=!0;else{var c=a*n,u=c-n,h=c+n;for(l=0;l!==n;++l){var p=e[c+l];if(p!==e[u+l]||p!==e[h+l]){s=!0;break}}}if(s){if(a!==i)for(t[i]=t[a],s=a*n,c=i*n,l=0;l!==n;++l)e[c+l]=e[s+l];++i}}if(0<o){for(t[i]=t[o],s=o*n,c=i*n,l=0;l!==n;++l)e[c+l]=e[s+l];++i}return i!==t.length?(this.times=Fl.arraySlice(t,0,i),this.values=Fl.arraySlice(e,0,i*n)):(this.times=t,this.values=e),this},clone:function(){var t=Fl.arraySlice(this.times,0),e=Fl.arraySlice(this.values,0);return t=new this.constructor(this.name,t,e),t.createInterpolant=this.createInterpolant,t}}),zr.prototype=Object.assign(Object.create(Fr.prototype),{constructor:zr,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Br.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Br,ValueTypeName:"color"}),Ur.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Ur,ValueTypeName:"number"}),jr.prototype=Object.assign(Object.create(Or.prototype),{constructor:jr,interpolate_:function(t,e,n,r){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;for(t*=a,e=(n-e)/(r-e),n=t+a;t!==n;t+=4)l.slerpFlat(i,0,o,t-a,o,t,e);return i}}),Gr.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Gr,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new jr(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Vr.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Vr,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Hr.prototype=Object.assign(Object.create(Fr.prototype),{constructor:Hr,ValueTypeName:"vector"}),Object.assign(Wr,{parse:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,o=n.length;i!==o;++i)e.push(Xr(n[i]).scale(r));return new Wr(t.name,t.duration,e,t.blendMode)},toJSON:function(t){var e=[],n=t.tracks;t={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(var r=0,i=n.length;r!==i;++r)e.push(Fr.toJSON(n[r]));return t},CreateFromMorphTargetSequence:function(t,e,n,r){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],l=[];s.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);var c=Fl.getKeyframeOrder(s);s=Fl.sortedArray(s,1,c),l=Fl.sortedArray(l,1,c),r||0!==s[0]||(s.push(i),l.push(l[0])),o.push(new Ur(".morphTargetInfluences["+e[a].name+"]",s,l).scale(1/n))}return new Wr(t,-1,o)},findByName:function(t,e){var n=t;for(Array.isArray(t)||(n=t.geometry&&t.geometry.animations||t.animations),t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],l=s.name.match(i);if(l&&1<l.length){var c=l[1];(l=r[c])||(r[c]=l=[]),l.push(s)}}for(c in t=[],r)t.push(Wr.CreateFromMorphTargetSequence(c,r[c],e,n));return t},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var n=function(t,e,n,r,i){if(0!==n.length){var o=[],a=[];Fl.flattenJSON(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.blendMode;t=t.hierarchy||[];for(var l=0;l<t.length;l++){var c=t[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){o={};for(var u=0;u<c.length;u++)if(c[u].morphTargets)for(var h=0;h<c[u].morphTargets.length;h++)o[c[u].morphTargets[h]]=-1;for(var p in o){var d=[],f=[];for(h=0;h!==c[u].morphTargets.length;++h){var m=c[u];d.push(m.time),f.push(m.morphTarget===p?1:0)}r.push(new Ur(".morphTargetInfluence["+p+"]",d,f))}o=o.length*(a||1)}else u=".bones["+e[l].name+"]",n(Hr,u+".position",c,"pos",r),n(Gr,u+".quaternion",c,"rot",r),n(Hr,u+".scale",c,"scl",r)}return 0===r.length?null:new Wr(i,o,r,s)}}),Object.assign(Wr.prototype,{resetDuration:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Wr(this.name,this.duration,t,this.blendMode)}});var zl={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Bl=new Zr;Object.assign(Yr.prototype,{load:function(){},loadAsync:function(t,e){var n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});var Ul={};$r.prototype=Object.assign(Object.create(Yr.prototype),{constructor:$r,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=zl.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0===Ul[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){n=a[1];var s=!!a[2];a=a[3],a=decodeURIComponent(a),s&&(a=atob(a));try{var l=(this.responseType||"").toLowerCase();switch(l){case"arraybuffer":case"blob":var c=new Uint8Array(a.length);for(s=0;s<a.length;s++)c[s]=a.charCodeAt(s);var u="blob"===l?new Blob([c.buffer],{type:n}):c.buffer;break;case"document":u=(new DOMParser).parseFromString(a,n);break;case"json":u=JSON.parse(a);break;default:u=a}setTimeout((function(){e&&e(u),i.manager.itemEnd(t)}),0)}catch(p){setTimeout((function(){r&&r(p),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{Ul[t]=[],Ul[t].push({onLoad:e,onProgress:n,onError:r});var h=new XMLHttpRequest;for(s in h.open("GET",t,!0),h.addEventListener("load",(function(e){var n=this.response,r=Ul[t];if(delete Ul[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),zl.add(t,n);for(var o=0,a=r.length;o<a;o++){var s=r[o];s.onLoad&&s.onLoad(n)}}else{for(o=0,a=r.length;o<a;o++)s=r[o],s.onError&&s.onError(e);i.manager.itemError(t)}i.manager.itemEnd(t)}),!1),h.addEventListener("progress",(function(e){for(var n=Ul[t],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(e)}}),!1),h.addEventListener("error",(function(e){var n=Ul[t];delete Ul[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),h.addEventListener("abort",(function(e){var n=Ul[t];delete Ul[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(h.responseType=this.responseType),void 0!==this.withCredentials&&(h.withCredentials=this.withCredentials),h.overrideMimeType&&h.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)h.setRequestHeader(s,this.requestHeader[s]);h.send(null)}return i.manager.itemStart(t),h}Ul[t].push({onLoad:e,onProgress:n,onError:r})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Jr.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Jr,load:function(t,e,n,r){var i=this,o=new $r(i.manager);o.setPath(i.path),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)},parse:function(t){for(var e=[],n=0;n<t.length;n++){var r=Wr.parse(t[n]);e.push(r)}return e}}),Kr.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Kr,load:function(t,e,n,r){function i(i){l.load(t[i],(function(t){t=o.parse(t,!0),a[i]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},c+=1,6===c&&(1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,e&&e(s))}),n,r)}var o=this,a=[],s=new dn;s.image=a;var l=new $r(this.manager);if(l.setPath(this.path),l.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,u=0,h=t.length;u<h;++u)i(u);else l.load(t,(function(t){if(t=o.parse(t,!0),t.isCubemap)for(var n=t.mipmaps.length/t.mipmapCount,r=0;r<n;r++){a[r]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)a[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+i]),a[r].format=t.format,a[r].width=t.width,a[r].height=t.height}else s.image.width=t.width,s.image.height=t.height,s.mipmaps=t.mipmaps;1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,e&&e(s)}),n,r);return s}}),Qr.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Qr,load:function(t,e,n,r){var i=this,o=new K,a=new $r(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(t,(function(t){(t=i.parse(t))&&(void 0!==t.image?o.image=t.image:void 0!==t.data&&(o.image.width=t.width,o.image.height=t.height,o.image.data=t.data),o.wrapS=void 0!==t.wrapS?t.wrapS:1001,o.wrapT=void 0!==t.wrapT?t.wrapT:1001,o.magFilter=void 0!==t.magFilter?t.magFilter:1006,o.minFilter=void 0!==t.minFilter?t.minFilter:1006,o.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(o.format=t.format),void 0!==t.type&&(o.type=t.type),void 0!==t.mipmaps&&(o.mipmaps=t.mipmaps,o.minFilter=1008),1===t.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,e&&e(o,t))}),n,r),o}}),ti.prototype=Object.assign(Object.create(Yr.prototype),{constructor:ti,load:function(t,e,n,r){function i(){l.removeEventListener("load",i,!1),l.removeEventListener("error",o,!1),zl.add(t,this),e&&e(this),a.manager.itemEnd(t)}function o(e){l.removeEventListener("load",i,!1),l.removeEventListener("error",o,!1),r&&r(e),a.manager.itemError(t),a.manager.itemEnd(t)}void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var a=this,s=zl.get(t);if(void 0!==s)return a.manager.itemStart(t),setTimeout((function(){e&&e(s),a.manager.itemEnd(t)}),0),s;var l=document.createElementNS("http://www.w3.org/1999/xhtml","img");return l.addEventListener("load",i,!1),l.addEventListener("error",o,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),a.manager.itemStart(t),l.src=t,l}}),ei.prototype=Object.assign(Object.create(Yr.prototype),{constructor:ei,load:function(t,e,n,r){function i(n){a.load(t[n],(function(t){o.images[n]=t,s++,6===s&&(o.needsUpdate=!0,e&&e(o))}),void 0,r)}var o=new mt,a=new ti(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var s=0;for(n=0;n<t.length;++n)i(n);return o}}),ni.prototype=Object.assign(Object.create(Yr.prototype),{constructor:ni,load:function(t,e,n,r){var o=new i,a=new ti(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(n){o.image=n,n=0<t.search(/\.jpe?g($|\?)/i)||0===t.search(/^data:image\/jpeg/),o.format=n?1022:1023,o.needsUpdate=!0,void 0!==e&&e(o)}),n,r),o}}),Object.assign(ri.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){return t=this.getUtoTmapping(t),this.getPoint(t,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n=[],r=this.getPoint(0),i=0;for(n.push(0),e=1;e<=t;e++){var o=this.getPoint(e/t);i+=o.distanceTo(r),n.push(i),r=o}return this.cacheArcLengths=n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n=this.getLengths(),r=n.length;e=e||t*n[r-1];for(var i,o=0,a=r-1;o<=a;)if(t=Math.floor(o+(a-o)/2),i=n[t]-e,0>i)o=t+1;else{if(!(0<i)){a=t;break}a=t-1}return t=a,n[t]===e?t/(r-1):(o=n[t],(t+(e-o)/(n[t+1]-o))/(r-1))},getTangent:function(t,e){var r=t-1e-4;return t+=1e-4,0>r&&(r=0),1<t&&(t=1),r=this.getPoint(r),t=this.getPoint(t),e=e||(r.isVector2?new n:new c),e.copy(t).sub(r).normalize(),e},getTangentAt:function(t,e){return t=this.getUtoTmapping(t),this.getTangent(t,e)},computeFrenetFrames:function(t,e){var n,r=new c,i=[],o=[],a=[],s=new c,l=new u;for(n=0;n<=t;n++){var h=n/t;i[n]=this.getTangentAt(h,new c),i[n].normalize()}o[0]=new c,a[0]=new c,n=Number.MAX_VALUE,h=Math.abs(i[0].x);var p=Math.abs(i[0].y),d=Math.abs(i[0].z);for(h<=n&&(n=h,r.set(1,0,0)),p<=n&&(n=p,r.set(0,1,0)),d<=n&&r.set(0,0,1),s.crossVectors(i[0],r).normalize(),o[0].crossVectors(i[0],s),a[0].crossVectors(i[0],o[0]),n=1;n<=t;n++)o[n]=o[n-1].clone(),a[n]=a[n-1].clone(),s.crossVectors(i[n-1],i[n]),s.length()>Number.EPSILON&&(s.normalize(),r=Math.acos(Vo.clamp(i[n-1].dot(i[n]),-1,1)),o[n].applyMatrix4(l.makeRotationAxis(s,r))),a[n].crossVectors(i[n],o[n]);if(!0===e)for(r=Math.acos(Vo.clamp(o[0].dot(o[t]),-1,1)),r/=t,0<i[0].dot(s.crossVectors(o[0],o[t]))&&(r=-r),n=1;n<=t;n++)o[n].applyMatrix4(l.makeRotationAxis(i[n],r*n)),a[n].crossVectors(i[n],o[n]);return{tangents:i,normals:o,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),ii.prototype=Object.create(ri.prototype),ii.prototype.constructor=ii,ii.prototype.isEllipseCurve=!0,ii.prototype.getPoint=function(t,e){e=e||new n;for(var r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;0>i;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i=i===r?-r:i-r),r=this.aStartAngle+t*i,t=this.aX+this.xRadius*Math.cos(r);var a=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(r=Math.cos(this.aRotation),i=Math.sin(this.aRotation),o=t-this.aX,a-=this.aY,t=o*r-a*i+this.aX,a=o*i+a*r+this.aY),e.set(t,a)},ii.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ii.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},ii.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},oi.prototype=Object.create(ii.prototype),oi.prototype.constructor=oi,oi.prototype.isArcCurve=!0;var jl=new c,Gl=new ai,Vl=new ai,Hl=new ai;si.prototype=Object.create(ri.prototype),si.prototype.constructor=si,si.prototype.isCatmullRomCurve3=!0,si.prototype.getPoint=function(t,e){e=e||new c;var n=this.points,r=n.length;t*=r-(this.closed?0:1);var i=Math.floor(t);if(t-=i,this.closed?i+=0<i?0:(Math.floor(Math.abs(i)/r)+1)*r:0===t&&i===r-1&&(i=r-2,t=1),this.closed||0<i)var o=n[(i-1)%r];else jl.subVectors(n[0],n[1]).add(n[0]),o=jl;var a=n[i%r],s=n[(i+1)%r];if(this.closed||i+2<r?n=n[(i+2)%r]:(jl.subVectors(n[r-1],n[r-2]).add(n[r-1]),n=jl),"centripetal"===this.curveType||"chordal"===this.curveType){var l="chordal"===this.curveType?.5:.25;r=Math.pow(o.distanceToSquared(a),l),i=Math.pow(a.distanceToSquared(s),l),l=Math.pow(s.distanceToSquared(n),l),1e-4>i&&(i=1),1e-4>r&&(r=i),1e-4>l&&(l=i),Gl.initNonuniformCatmullRom(o.x,a.x,s.x,n.x,r,i,l),Vl.initNonuniformCatmullRom(o.y,a.y,s.y,n.y,r,i,l),Hl.initNonuniformCatmullRom(o.z,a.z,s.z,n.z,r,i,l)}else"catmullrom"===this.curveType&&(Gl.initCatmullRom(o.x,a.x,s.x,n.x,this.tension),Vl.initCatmullRom(o.y,a.y,s.y,n.y,this.tension),Hl.initCatmullRom(o.z,a.z,s.z,n.z,this.tension));return e.set(Gl.calc(t),Vl.calc(t),Hl.calc(t)),e},si.prototype.copy=function(t){ri.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},si.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},si.prototype.fromJSON=function(t){ri.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push((new c).fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},hi.prototype=Object.create(ri.prototype),hi.prototype.constructor=hi,hi.prototype.isCubicBezierCurve=!0,hi.prototype.getPoint=function(t,e){e=e||new n;var r=this.v0,i=this.v1,o=this.v2,a=this.v3;return e.set(ui(t,r.x,i.x,o.x,a.x),ui(t,r.y,i.y,o.y,a.y)),e},hi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},hi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},hi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},pi.prototype=Object.create(ri.prototype),pi.prototype.constructor=pi,pi.prototype.isCubicBezierCurve3=!0,pi.prototype.getPoint=function(t,e){e=e||new c;var n=this.v0,r=this.v1,i=this.v2,o=this.v3;return e.set(ui(t,n.x,r.x,i.x,o.x),ui(t,n.y,r.y,i.y,o.y),ui(t,n.z,r.z,i.z,o.z)),e},pi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},pi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},pi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},di.prototype=Object.create(ri.prototype),di.prototype.constructor=di,di.prototype.isLineCurve=!0,di.prototype.getPoint=function(t,e){return e=e||new n,1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},di.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},di.prototype.getTangent=function(t,e){return t=e||new n,t.copy(this.v2).sub(this.v1).normalize()},di.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},di.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},di.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},fi.prototype=Object.create(ri.prototype),fi.prototype.constructor=fi,fi.prototype.isLineCurve3=!0,fi.prototype.getPoint=function(t,e){return e=e||new c,1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},fi.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},fi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},fi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},fi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},mi.prototype=Object.create(ri.prototype),mi.prototype.constructor=mi,mi.prototype.isQuadraticBezierCurve=!0,mi.prototype.getPoint=function(t,e){e=e||new n;var r=this.v0,i=this.v1,o=this.v2;return e.set(ci(t,r.x,i.x,o.x),ci(t,r.y,i.y,o.y)),e},mi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},mi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},mi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},gi.prototype=Object.create(ri.prototype),gi.prototype.constructor=gi,gi.prototype.isQuadraticBezierCurve3=!0,gi.prototype.getPoint=function(t,e){e=e||new c;var n=this.v0,r=this.v1,i=this.v2;return e.set(ci(t,n.x,r.x,i.x),ci(t,n.y,r.y,i.y),ci(t,n.z,r.z,i.z)),e},gi.prototype.copy=function(t){return ri.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},gi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},gi.prototype.fromJSON=function(t){return ri.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},yi.prototype=Object.create(ri.prototype),yi.prototype.constructor=yi,yi.prototype.isSplineCurve=!0,yi.prototype.getPoint=function(t,e){e=e||new n;var r=this.points,i=(r.length-1)*t;t=Math.floor(i),i-=t;var o=r[0===t?t:t-1],a=r[t],s=r[t>r.length-2?r.length-1:t+1];return r=r[t>r.length-3?r.length-1:t+2],e.set(li(i,o.x,a.x,s.x,r.x),li(i,o.y,a.y,s.y,r.y)),e},yi.prototype.copy=function(t){ri.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++)this.points.push(t.points[e].clone());return this},yi.prototype.toJSON=function(){var t=ri.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++)t.points.push(this.points[e].toArray());return t},yi.prototype.fromJSON=function(t){ri.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var i=t.points[e];this.points.push((new n).fromArray(i))}return this};var Wl=Object.freeze({__proto__:null,ArcCurve:oi,CatmullRomCurve3:si,CubicBezierCurve:hi,CubicBezierCurve3:pi,EllipseCurve:ii,LineCurve:di,LineCurve3:fi,QuadraticBezierCurve:mi,QuadraticBezierCurve3:gi,SplineCurve:yi});vi.prototype=Object.assign(Object.create(ri.prototype),{constructor:vi,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new di(e,t))},getPoint:function(t){var e=t*this.getLength(),n=this.getCurveLengths();for(t=0;t<n.length;){if(n[t]>=e)return e=n[t]-e,t=this.curves[t],n=t.getLength(),t.getPointAt(0===n?0:1-e/n);t++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,n=[],r=0,i=this.curves;r<i.length;r++){var o=i[r];o=o.getPoints(o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t);for(var a=0;a<o.length;a++){var s=o[a];e&&e.equals(s)||(n.push(s),e=s)}}return this.autoClose&&1<n.length&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(t){ri.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=ri.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){ri.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push((new Wl[r.type]).fromJSON(r))}return this}}),_i.prototype=Object.assign(Object.create(vi.prototype),{constructor:_i,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var r=new di(this.currentPoint.clone(),new n(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,r,i){return t=new mi(this.currentPoint.clone(),new n(t,e),new n(r,i)),this.curves.push(t),this.currentPoint.set(r,i),this},bezierCurveTo:function(t,e,r,i,o,a){return t=new hi(this.currentPoint.clone(),new n(t,e),new n(r,i),new n(o,a)),this.curves.push(t),this.currentPoint.set(o,a),this},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t);return e=new yi(e),this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,o){return this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,n,r,i,o),this},absarc:function(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this},ellipse:function(t,e,n,r,i,o,a,s){return this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,n,r,i,o,a,s),this},absellipse:function(t,e,n,r,i,o,a,s){return t=new ii(t,e,n,r,i,o,a,s),0<this.curves.length&&(e=t.getPoint(0),e.equals(this.currentPoint)||this.lineTo(e.x,e.y)),this.curves.push(t),t=t.getPoint(1),this.currentPoint.copy(t),this},copy:function(t){return vi.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=vi.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return vi.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),xi.prototype=Object.assign(Object.create(_i.prototype),{constructor:xi,getPointsHoles:function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){_i.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=_i.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){_i.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push((new _i).fromJSON(r))}return this}}),bi.prototype=Object.assign(Object.create(d.prototype),{constructor:bi,isLight:!0,copy:function(t){return d.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){return t=d.prototype.toJSON.call(this,t),t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),wi.prototype=Object.assign(Object.create(bi.prototype),{constructor:wi,isHemisphereLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Mi.prototype,{_projScreenMatrix:new u,_lightPositionWorld:new c,_lookTarget:new c,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Ei.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Ei,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,n=2*Vo.RAD2DEG*t.angle,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),Mi.prototype.updateMatrices.call(this,t)}}),Si.prototype=Object.assign(Object.create(bi.prototype),{constructor:Si,isSpotLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Ti.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Ti,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);var n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),Ai.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ai,isPointLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Ci.prototype=Object.assign(Object.create(Z.prototype),{constructor:Ci,isOrthographicCamera:!0,copy:function(t,e){return Z.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t;n+=t,t=r+e,e=r-e,null!==this.view&&this.view.enabled&&(r=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i+=r*this.view.offsetX,n=i+r*this.view.width,t-=e*this.view.offsetY,e=t-e*this.view.height),this.projectionMatrix.makeOrthographic(i,n,t,e,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){return t=d.prototype.toJSON.call(this,t),t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Li.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Li,isDirectionalLightShadow:!0,updateMatrices:function(t){Mi.prototype.updateMatrices.call(this,t)}}),Ii.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ii,isDirectionalLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Pi.prototype=Object.assign(Object.create(bi.prototype),{constructor:Pi,isAmbientLight:!0}),Ri.prototype=Object.assign(Object.create(bi.prototype),{constructor:Ri,isRectAreaLight:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){return t=bi.prototype.toJSON.call(this,t),t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(Oi.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;9>e;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;9>t;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var n=t.x,r=t.y;t=t.z;var i=this.coefficients;return e.copy(i[0]).multiplyScalar(.282095),e.addScaledVector(i[1],.488603*r),e.addScaledVector(i[2],.488603*t),e.addScaledVector(i[3],.488603*n),e.addScaledVector(i[4],1.092548*n*r),e.addScaledVector(i[5],1.092548*r*t),e.addScaledVector(i[6],.315392*(3*t*t-1)),e.addScaledVector(i[7],1.092548*n*t),e.addScaledVector(i[8],.546274*(n*n-r*r)),e},getIrradianceAt:function(t,e){var n=t.x,r=t.y;t=t.z;var i=this.coefficients;return e.copy(i[0]).multiplyScalar(.886227),e.addScaledVector(i[1],1.023328*r),e.addScaledVector(i[2],1.023328*t),e.addScaledVector(i[3],1.023328*n),e.addScaledVector(i[4],.858086*n*r),e.addScaledVector(i[5],.858086*r*t),e.addScaledVector(i[6],.743125*t*t-.247708),e.addScaledVector(i[7],.858086*n*t),e.addScaledVector(i[8],.429043*(n*n-r*r)),e},add:function(t){for(var e=0;9>e;e++)this.coefficients[e].add(t.coefficients[e]);return this},addScaledSH:function(t,e){for(var n=0;9>n;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},scale:function(t){for(var e=0;9>e;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var n=0;9>n;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},equals:function(t){for(var e=0;9>e;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);for(var n=this.coefficients,r=0;9>r;r++)n[r].fromArray(t,e+3*r);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var n=this.coefficients,r=0;9>r;r++)n[r].toArray(t,e+3*r);return t}}),Object.assign(Oi,{getBasisAt:function(t,e){var n=t.x,r=t.y;t=t.z,e[0]=.282095,e[1]=.488603*r,e[2]=.488603*t,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*t,e[6]=.315392*(3*t*t-1),e[7]=1.092548*n*t,e[8]=.546274*(n*n-r*r)}}),Di.prototype=Object.assign(Object.create(bi.prototype),{constructor:Di,isLightProbe:!0,copy:function(t){return bi.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){return t=bi.prototype.toJSON.call(this,t),t.object.sh=this.sh.toArray(),t}}),Ni.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Ni,load:function(t,e,n,r){var i=this,o=new $r(i.manager);o.setPath(i.path),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)},parse:function(t){function e(t){return void 0===i[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),i[t]}var i=this.textures,a=new kl[t.type];if(void 0!==t.uuid&&(a.uuid=t.uuid),void 0!==t.name&&(a.name=t.name),void 0!==t.color&&a.color.setHex(t.color),void 0!==t.roughness&&(a.roughness=t.roughness),void 0!==t.metalness&&(a.metalness=t.metalness),void 0!==t.sheen&&(a.sheen=(new b).setHex(t.sheen)),void 0!==t.emissive&&a.emissive.setHex(t.emissive),void 0!==t.specular&&a.specular.setHex(t.specular),void 0!==t.shininess&&(a.shininess=t.shininess),void 0!==t.clearcoat&&(a.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(a.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(a.fog=t.fog),void 0!==t.flatShading&&(a.flatShading=t.flatShading),void 0!==t.blending&&(a.blending=t.blending),void 0!==t.combine&&(a.combine=t.combine),void 0!==t.side&&(a.side=t.side),void 0!==t.opacity&&(a.opacity=t.opacity),void 0!==t.transparent&&(a.transparent=t.transparent),void 0!==t.alphaTest&&(a.alphaTest=t.alphaTest),void 0!==t.depthTest&&(a.depthTest=t.depthTest),void 0!==t.depthWrite&&(a.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(a.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(a.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(a.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(a.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(a.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(a.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(a.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(a.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(a.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(a.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(a.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(a.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(a.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(a.rotation=t.rotation),1!==t.linewidth&&(a.linewidth=t.linewidth),void 0!==t.dashSize&&(a.dashSize=t.dashSize),void 0!==t.gapSize&&(a.gapSize=t.gapSize),void 0!==t.scale&&(a.scale=t.scale),void 0!==t.polygonOffset&&(a.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(a.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(a.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(a.skinning=t.skinning),void 0!==t.morphTargets&&(a.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(a.morphNormals=t.morphNormals),void 0!==t.dithering&&(a.dithering=t.dithering),void 0!==t.vertexTangents&&(a.vertexTangents=t.vertexTangents),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.toneMapped&&(a.toneMapped=t.toneMapped),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.vertexColors&&(a.vertexColors="number"===typeof t.vertexColors?0<t.vertexColors:t.vertexColors),void 0!==t.uniforms)for(var s in t.uniforms){var l=t.uniforms[s];switch(a.uniforms[s]={},l.type){case"t":a.uniforms[s].value=e(l.value);break;case"c":a.uniforms[s].value=(new b).setHex(l.value);break;case"v2":a.uniforms[s].value=(new n).fromArray(l.value);break;case"v3":a.uniforms[s].value=(new c).fromArray(l.value);break;case"v4":a.uniforms[s].value=(new o).fromArray(l.value);break;case"m3":a.uniforms[s].value=(new r).fromArray(l.value);case"m4":a.uniforms[s].value=(new u).fromArray(l.value);break;default:a.uniforms[s].value=l.value}}if(void 0!==t.defines&&(a.defines=t.defines),void 0!==t.vertexShader&&(a.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(a.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var h in t.extensions)a.extensions[h]=t.extensions[h];return void 0!==t.shading&&(a.flatShading=1===t.shading),void 0!==t.size&&(a.size=t.size),void 0!==t.sizeAttenuation&&(a.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(a.map=e(t.map)),void 0!==t.matcap&&(a.matcap=e(t.matcap)),void 0!==t.alphaMap&&(a.alphaMap=e(t.alphaMap)),void 0!==t.bumpMap&&(a.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(a.bumpScale=t.bumpScale),void 0!==t.normalMap&&(a.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(a.normalMapType=t.normalMapType),void 0!==t.normalScale&&(s=t.normalScale,!1===Array.isArray(s)&&(s=[s,s]),a.normalScale=(new n).fromArray(s)),void 0!==t.displacementMap&&(a.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(a.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(a.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(a.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(a.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(a.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(a.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(a.specularMap=e(t.specularMap)),void 0!==t.envMap&&(a.envMap=e(t.envMap)),void 0!==t.envMapIntensity&&(a.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(a.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(a.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(a.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(a.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(a.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(a.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(a.gradientMap=e(t.gradientMap)),void 0!==t.clearcoatMap&&(a.clearcoatMap=e(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(a.clearcoatRoughnessMap=e(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(a.clearcoatNormalMap=e(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(a.clearcoatNormalScale=(new n).fromArray(t.clearcoatNormalScale)),a},setTextures:function(t){return this.textures=t,this}});var ql={decodeText:function(t){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(i){return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};ki.prototype=Object.assign(Object.create(U.prototype),{constructor:ki,isInstancedBufferGeometry:!0,copy:function(t){return U.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=U.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),Fi.prototype=Object.assign(Object.create(C.prototype),{constructor:Fi,isInstancedBufferAttribute:!0,copy:function(t){return C.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=C.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),zi.prototype=Object.assign(Object.create(Yr.prototype),{constructor:zi,load:function(t,e,n,r){var i=this,o=new $r(i.manager);o.setPath(i.path),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(t)}}),n,r)},parse:function(t){var e=t.isInstancedBufferGeometry?new ki:new U,n=t.data.index;if(void 0!==n){var r=new Xl[n.type](n.array);e.setIndex(new C(r,1))}for(var i in n=t.data.attributes,n){var o=n[i];r=new Xl[o.type](o.array),r=new(o.isInstancedBufferAttribute?Fi:C)(r,o.itemSize,o.normalized),void 0!==o.name&&(r.name=o.name),e.setAttribute(i,r)}var a=t.data.morphAttributes;if(a)for(i in a){var s=a[i],l=[];n=0;for(var u=s.length;n<u;n++)o=s[n],r=new Xl[o.type](o.array),r=new C(r,o.itemSize,o.normalized),void 0!==o.name&&(r.name=o.name),l.push(r);e.morphAttributes[i]=l}if(t.data.morphTargetsRelative&&(e.morphTargetsRelative=!0),i=t.data.groups||t.data.drawcalls||t.data.offsets,void 0!==i)for(n=0,o=i.length;n!==o;++n)r=i[n],e.addGroup(r.start,r.count,r.materialIndex);return n=t.data.boundingSphere,void 0!==n&&(i=new c,void 0!==n.center&&i.fromArray(n.center),e.boundingSphere=new y(i,n.radius)),t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var Xl={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Bi.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Bi,load:function(t,e,n,r){var i=this,o=""===this.path?ql.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o,o=new $r(i.manager),o.setPath(this.path),o.load(t,(function(n){var o=null;try{o=JSON.parse(n)}catch(a){return void 0!==r&&r(a),void console.error("THREE:ObjectLoader: Can't parse "+t+".",a.message)}n=o.metadata,void 0===n||void 0===n.type||"geometry"===n.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+t):i.parse(o,e)}),n,r)},parse:function(t,e){var n=this.parseShape(t.shapes);n=this.parseGeometries(t.geometries,n);var r=this.parseImages(t.images,(function(){void 0!==e&&e(i)}));r=this.parseTextures(t.textures,r),r=this.parseMaterials(t.materials,r);var i=this.parseObject(t.object,n,r);return t.animations&&(i.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0===e||e(i),i},parseShape:function(t){var e={};if(void 0!==t)for(var n=0,r=t.length;n<r;n++){var i=(new xi).fromJSON(t[n]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var n={};if(void 0!==t)for(var r=new zi,i=0,o=t.length;i<o;i++){var a=t[i];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":var s=new Nl[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Nl[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Nl[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Nl[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Nl[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Nl[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Nl[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Nl[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Nl[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Nl[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Nl[a.type]((new Wl[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Nl[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Nl[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":s=[];for(var l=0,c=a.shapes.length;l<c;l++){var u=e[a.shapes[l]];s.push(u)}s=new Nl[a.type](s,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(s=[],l=0,c=a.shapes.length;l<c;l++)u=e[a.shapes[l]],s.push(u);l=a.options.extrudePath,void 0!==l&&(a.options.extrudePath=(new Wl[l.type]).fromJSON(l)),s=new Nl[a.type](s,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}return n},parseMaterials:function(t,e){var n={},r={};if(void 0!==t){var i=new Ni;i.setTextures(e),e=0;for(var o=t.length;e<o;e++){var a=t[e];if("MultiMaterial"===a.type){for(var s=[],l=0;l<a.materials.length;l++){var c=a.materials[l];void 0===n[c.uuid]&&(n[c.uuid]=i.parse(c)),s.push(n[c.uuid])}r[a.uuid]=s}else void 0===n[a.uuid]&&(n[a.uuid]=i.parse(a)),r[a.uuid]=n[a.uuid]}}return r},parseAnimations:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=Wr.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),e.push(i)}return e},parseImages:function(t,e){function n(t){return r.manager.itemStart(t),o.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}var r=this,i={};if(void 0!==t&&0<t.length){e=new Zr(e);var o=new ti(e);o.setCrossOrigin(this.crossOrigin),e=0;for(var a=t.length;e<a;e++){var s=t[e],l=s.url;if(Array.isArray(l)){i[s.uuid]=[];for(var c=0,u=l.length;c<u;c++){var h=l[c];h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:r.resourcePath+h,i[s.uuid].push(n(h))}}else h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:r.resourcePath+s.url,i[s.uuid]=n(h)}}return i},parseTextures:function(t,e){function n(t,e){return"number"===typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var r={};if(void 0!==t)for(var o=0,a=t.length;o<a;o++){var s=t[o];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var l=Array.isArray(e[s.image])?new mt(e[s.image]):new i(e[s.image]);l.needsUpdate=!0,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,Zl)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Yl),l.wrapT=n(s.wrap[1],Yl)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,$l)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,$l)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),r[s.uuid]=l}return r},parseObject:function(t,e,n){function r(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function i(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,i=t.length;r<i;r++){var o=t[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(n[o])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(t.type){case"Scene":var o=new f;void 0!==t.background&&Number.isInteger(t.background)&&(o.background=new b(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?o.fog=new Xe(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(o.fog=new qe(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":o=new Y(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(o.focus=t.focus),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.filmGauge&&(o.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(o.filmOffset=t.filmOffset),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new Ci(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"AmbientLight":o=new Pi(t.color,t.intensity);break;case"DirectionalLight":o=new Ii(t.color,t.intensity);break;case"PointLight":o=new Ai(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new Ri(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new Si(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new wi(t.color,t.groundColor,t.intensity);break;case"LightProbe":o=(new Di).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":o=r(t.geometry);var a=i(t.material);o=new j(o,a);break;case"InstancedMesh":o=r(t.geometry),a=i(t.material);var s=t.instanceMatrix;o=new rn(o,a,t.count),o.instanceMatrix=new C(new Float32Array(s.array),16);break;case"LOD":o=new Qe;break;case"Line":o=new an(r(t.geometry),i(t.material),t.mode);break;case"LineLoop":o=new ln(r(t.geometry),i(t.material));break;case"LineSegments":o=new sn(r(t.geometry),i(t.material));break;case"PointCloud":case"Points":o=new un(r(t.geometry),i(t.material));break;case"Sprite":o=new Je(i(t.material));break;case"Group":o=new je;break;default:o=new d}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(o.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(o.matrixAutoUpdate=t.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.quaternion&&o.quaternion.fromArray(t.quaternion),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(o.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(o.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&o.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(o.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.frustumCulled&&(o.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(o.renderOrder=t.renderOrder),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.layers&&(o.layers.mask=t.layers),void 0!==t.children)for(s=t.children,a=0;a<s.length;a++)o.add(this.parseObject(s[a],e,n));if("LOD"===t.type)for(void 0!==t.autoUpdate&&(o.autoUpdate=t.autoUpdate),t=t.levels,s=0;s<t.length;s++){a=t[s];var l=o.getObjectByProperty("uuid",a.object);void 0!==l&&o.addLevel(l,a.distance)}return o}});var Zl={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Yl={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},$l={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};Ui.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Ui,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=zl.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;fetch(t).then((function(t){return t.blob()})).then((function(t){return void 0===i.options?createImageBitmap(t):createImageBitmap(t,i.options)})).then((function(n){zl.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(ji.prototype,{moveTo:function(t,e){return this.currentPath=new _i,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,i,o){return this.currentPath.bezierCurveTo(t,e,n,r,i,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],o=new xi;o.curves=i.curves,e.push(o)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=e[i],s=e[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(a=e[o],l=-l,s=e[i],c=-c),!(t.y<a.y||t.y>s.y))if(t.y===a.y){if(t.x===a.x)return!0}else{if(i=c*(t.x-a.x)-l*(t.y-a.y),0===i)return!0;0>i||(r=!r)}}else if(t.y===a.y&&(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x))return!0}return r}var i=Ol.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return n(o);if(e=[],1===o.length){var a=o[0],s=new xi;return s.curves=a.curves,e.push(s),e}var l=!i(o[0].getPoints());l=t?!l:l,s=[];var c=[],u=[],h=0;c[h]=void 0,u[h]=[];for(var p=0,d=o.length;p<d;p++){a=o[p];var f=a.getPoints(),m=i(f);(m=t?!m:m)?(!l&&c[h]&&h++,c[h]={s:new xi,p:f},c[h].s.curves=a.curves,l&&h++,u[h]=[]):u[h].push({h:a,p:f[0]})}if(!c[0])return n(o);if(1<c.length){for(p=!1,t=[],i=0,o=c.length;i<o;i++)s[i]=[];for(i=0,o=c.length;i<o;i++)for(a=u[i],m=0;m<a.length;m++){for(l=a[m],h=!0,f=0;f<c.length;f++)r(l.p,c[f].p)&&(i!==f&&t.push({froms:i,tos:f,hole:m}),h?(h=!1,s[f].push(l)):p=!0);h&&s[i].push(l)}0<t.length&&(p||(u=s))}for(p=0,i=c.length;p<i;p++)for(s=c[p].s,e.push(s),t=u[p],o=0,a=t.length;o<a;o++)s.holes.push(t[o].h);return e}}),Object.assign(Gi.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);var n=[],r=e;e=this.data;var i=Array.from?Array.from(t):String(t).split("");r/=e.resolution;var o=(e.boundingBox.yMax-e.boundingBox.yMin+e.underlineThickness)*r;t=[];for(var a=0,s=0,l=0;l<i.length;l++){var c=i[l];if("\n"===c)a=0,s-=o;else{var u=c;c=r;var h=a,p=s,d=e,f=d.glyphs[u]||d.glyphs["?"];if(f){if(u=new ji,f.o){d=f._cachedOutline||(f._cachedOutline=f.o.split(" "));for(var m=0,g=d.length;m<g;)switch(d[m++]){case"m":var y=d[m++]*c+h,v=d[m++]*c+p;u.moveTo(y,v);break;case"l":y=d[m++]*c+h,v=d[m++]*c+p,u.lineTo(y,v);break;case"q":var _=d[m++]*c+h,x=d[m++]*c+p,b=d[m++]*c+h,w=d[m++]*c+p;u.quadraticCurveTo(b,w,_,x);break;case"b":_=d[m++]*c+h,x=d[m++]*c+p,b=d[m++]*c+h,w=d[m++]*c+p,y=d[m++]*c+h,v=d[m++]*c+p,u.bezierCurveTo(b,w,y,v,_,x)}}c={offsetX:f.ha*c,path:u}}else console.error('THREE.Font: character "'+u+'" does not exists in font family '+d.familyName+"."),c=void 0;a+=c.offsetX,t.push(c.path)}}for(e=0,i=t.length;e<i;e++)Array.prototype.push.apply(n,t[e].toShapes());return n}}),Vi.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Vi,load:function(t,e,n,r){var i=this,o=new $r(this.manager);o.setPath(this.path),o.load(t,(function(t){try{var n=JSON.parse(t)}catch(r){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}t=i.parse(n),e&&e(t)}),n,r)},parse:function(t){return new Gi(t)}});var Jl,Kl={getContext:function(){return void 0===Jl&&(Jl=new(window.AudioContext||window.webkitAudioContext)),Jl},setContext:function(t){Jl=t}};Hi.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Hi,load:function(t,e,n,r){var i=this,o=new $r(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.load(t,(function(n){try{var o=n.slice(0);Kl.getContext().decodeAudioData(o,(function(t){e(t)}))}catch(a){r?r(a):console.error(a),i.manager.itemError(t)}}),n,r)}}),Wi.prototype=Object.assign(Object.create(Di.prototype),{constructor:Wi,isHemisphereLightProbe:!0,copy:function(t){return Di.prototype.copy.call(this,t),this},toJSON:function(t){return Di.prototype.toJSON.call(this,t)}}),qi.prototype=Object.assign(Object.create(Di.prototype),{constructor:qi,isAmbientLightProbe:!0,copy:function(t){return Di.prototype.copy.call(this,t),this},toJSON:function(t){return Di.prototype.toJSON.call(this,t)}});var Ql=new u,tc=new u;Object.assign(Xi.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var n=t.projectionMatrix.clone(),r=e.eyeSep/2,i=r*e.near/e.focus,o=e.near*Math.tan(Vo.DEG2RAD*e.fov*.5)/e.zoom;tc.elements[12]=-r,Ql.elements[12]=r,r=-o*e.aspect+i;var a=o*e.aspect+i;n.elements[0]=2*e.near/(a-r),n.elements[8]=(a+r)/(a-r),this.cameraL.projectionMatrix.copy(n),r=-o*e.aspect-i,a=o*e.aspect-i,n.elements[0]=2*e.near/(a-r),n.elements[8]=(a+r)/(a-r),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(tc),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Ql)}}),Object.assign(Zi.prototype,{start:function(){this.oldTime=this.startTime=("undefined"===typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"===typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var ec=new c,nc=new l,rc=new c,ic=new c;Yi.prototype=Object.assign(Object.create(d.prototype),{constructor:Yi,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){d.prototype.updateMatrixWorld.call(this,t),t=this.context.listener;var e=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ec,nc,rc),ic.set(0,0,-1).applyQuaternion(nc),t.positionX){var n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ec.x,n),t.positionY.linearRampToValueAtTime(ec.y,n),t.positionZ.linearRampToValueAtTime(ec.z,n),t.forwardX.linearRampToValueAtTime(ic.x,n),t.forwardY.linearRampToValueAtTime(ic.y,n),t.forwardZ.linearRampToValueAtTime(ic.z,n),t.upX.linearRampToValueAtTime(e.x,n),t.upY.linearRampToValueAtTime(e.y,n),t.upZ.linearRampToValueAtTime(e.z,n)}else t.setPosition(ec.x,ec.y,ec.z),t.setOrientation(ic.x,ic.y,ic.z,e.x,e.y,e.z)}}),$i.prototype=Object.assign(Object.create(d.prototype),{constructor:$i,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl)return this._startedAt=this.context.currentTime+t,t=this.context.createBufferSource(),t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect();console.warn("THREE.Audio: this Audio has no playback control.")}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress%=this.duration||this.buffer.duration),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var oc=new c,ac=new l,sc=new c,lc=new c;Ji.prototype=Object.assign(Object.create($i.prototype),{constructor:Ji,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(d.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying)if(this.matrixWorld.decompose(oc,ac,sc),lc.set(0,0,1).applyQuaternion(ac),t=this.panner,t.positionX){var e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(oc.x,e),t.positionY.linearRampToValueAtTime(oc.y,e),t.positionZ.linearRampToValueAtTime(oc.z,e),t.orientationX.linearRampToValueAtTime(lc.x,e),t.orientationY.linearRampToValueAtTime(lc.y,e),t.orientationZ.linearRampToValueAtTime(lc.z,e)}else t.setPosition(oc.x,oc.y,oc.z),t.setOrientation(lc.x,lc.y,lc.z)}}),Object.assign(Ki.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length}}),Object.assign(Qi.prototype,{accumulate:function(t,e){var n=this.buffer,r=this.valueSize;t=t*r+r;var i=this.cumulativeWeight;if(0===i){for(i=0;i!==r;++i)n[t+i]=n[i];i=e}else i+=e,this._mixBufferRegion(n,t,0,e/i,r);this.cumulativeWeight=i},accumulateAdditive:function(t){var e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){var e=this.valueSize,n=this.buffer;t=t*e+e;var r=this.cumulativeWeight,i=this.cumulativeWeightAdditive,o=this.binding;for(this.cumulativeWeightAdditive=this.cumulativeWeight=0,1>r&&this._mixBufferRegion(n,t,e*this._origIndex,1-r,e),0<i&&this._mixBufferRegionAdditive(n,t,this._addIndex*e,1,e),r=e,i=e+e;r!==i;++r)if(n[r]!==n[r+e]){o.setValue(n,t);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,n=e*this._origIndex;this.binding.getValue(t,n);for(var r=e;r!==n;++r)t[r]=t[n+r%e];this._setIdentity(),this.cumulativeWeightAdditive=this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_setAdditiveIdentityNumeric:function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize;t<e;t++)this.buffer[t]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,r,i){if(.5<=r)for(r=0;r!==i;++r)t[e+r]=t[n+r]},_slerp:function(t,e,n,r){l.slerpFlat(t,e,t,e,t,n,r)},_slerpAdditive:function(t,e,n,r,i){i*=this._workIndex,l.multiplyQuaternionsFlat(t,i,t,e,t,n),l.slerpFlat(t,e,t,e,t,i,r)},_lerp:function(t,e,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[n+a]*r}},_lerpAdditive:function(t,e,n,r,i){for(var o=0;o!==i;++o){var a=e+o;t[a]+=t[n+o]*r}}});var cc=/[\[\]\.:\/]/g,uc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",hc=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),pc=/(WCOD+)?/.source.replace("WCOD",uc),dc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),fc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),mc=new RegExp("^"+hc+pc+dc+fc+"$"),gc=["material","materials","bones"];Object.assign(to.prototype,{getValue:function(t,e){this.bind();var n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(eo,{Composite:to,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new eo.Composite(t,e,n):new eo(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(cc,"")},parseTrackName:function(t){var e=mc.exec(t);if(!e)throw Error("PropertyBinding: Cannot parse trackName: "+t);e={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]};var n=e.nodeName&&e.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var r=e.nodeName.substring(n+1);-1!==gc.indexOf(r)&&(e.nodeName=e.nodeName.substring(0,n),e.objectName=r)}if(null===e.propertyName||0===e.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+t);return e},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var r=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.name===e||i.uuid===e||(i=r(i.children)))return i}return null};if(t=r(t.children))return t}return null}}),Object.assign(eo.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,i=e.propertyIndex;if(t||(this.node=t=eo.findNode(this.rootNode,e.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var o=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(t=t.skeleton.bones,n=0;n<t.length;n++)if(t[n].name===o){o=n;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}if(o=t[r],void 0===o)console.error("THREE.PropertyBinding: Trying to update property for track: "+e.nodeName+"."+r+" but it wasn't found.",t);else{if(e=this.Versioning.None,this.targetObject=t,void 0!==t.needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate),n=this.BindingType.Direct,void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}n=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(n=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(n=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[n],this.setValue=this.SetterByBindingTypeAndVersioning[n][e]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(eo.prototype,{_getValue_unbound:eo.prototype.getValue,_setValue_unbound:eo.prototype.setValue}),Object.assign(no.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],p=h.uuid,d=r[p];if(void 0===d){d=e++,r[p]=d,t.push(h),p=0;for(var f=s;p!==f;++p)a[p].push(new eo(h,i[p],o[p]))}else if(d<n){l=t[d];var m=--n;for(f=t[m],r[f.uuid]=d,t[d]=f,r[p]=m,t[m]=h,p=0,f=s;p!==f;++p){var g=a[p],y=g[d];g[d]=g[m],void 0===y&&(y=new eo(h,i[p],o[p])),g[m]=y}}else t[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=n[l];if(void 0!==c&&c>=e){var u=e++,h=t[u];for(n[h.uuid]=c,t[c]=h,n[l]=u,t[u]=s,s=0,l=i;s!==l;++s){h=r[s];var p=h[c];h[c]=h[u],h[u]=p}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=r[l];if(void 0!==c)if(delete r[l],c<n){l=--n;var u=t[l],h=--e,p=t[h];for(r[u.uuid]=c,t[c]=u,r[p.uuid]=l,t[l]=p,t.pop(),u=0,p=o;u!==p;++u){var d=i[u],f=d[h];d[c]=d[l],d[l]=f,d.pop()}}else for(h=--e,p=t[h],r[p.uuid]=c,t[c]=p,t.pop(),u=0,p=o;u!==p;++u)d=i[u],d[c]=d[h],d.pop()}this.nCachedObjects_=n},subscribe_:function(t,e){var n=this._bindingsIndicesByPath,r=n[t],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=this.nCachedObjects_,c=Array(s.length);for(r=i.length,n[t]=r,o.push(t),a.push(e),i.push(c),n=l,r=s.length;n!==r;++n)c[n]=new eo(s[n],t,e);return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}}),Object.assign(ro.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){n=this._clip.duration;var r=t._clip.duration,i=n/r;t.warp(1,r/n,e),this.warp(i,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){var r=this._mixer,i=r.time,o=this._timeScaleInterpolant,a=this.timeScale;return null===o&&(this._timeScaleInterpolant=o=r._lendControlInterpolant()),r=o.parameterPositions,o=o.sampleValues,r[0]=i,r[1]=i+n,o[0]=t/a,o[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,r){if(this.enabled){var i=this._startTime;if(null!==i){if(e=(t-i)*n,0>e||0===n)return;this._startTime=null,e*=n}if(e*=this._updateTimeScale(t),n=this._updateTime(e),t=this._updateWeight(t),0<t)switch(e=this._interpolants,i=this._propertyBindings,this.blendMode){case 2501:for(var o=0,a=e.length;o!==a;++o)e[o].evaluate(n),i[o].accumulateAdditive(t);break;default:for(o=0,a=e.length;o!==a;++o)e[o].evaluate(n),i[o].accumulate(r,t)}}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e},_updateTime:function(t){var e=this.time+t,n=this._clip.duration,r=this.loop,i=this._loopCount,o=2202===r;if(0===t)return-1===i?e:o&&1===(1&i)?n-e:e;if(2200===r)t:{if(-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1)),e>=n)e=n;else{if(!(0>e)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>t?-1:1})}else{if(-1===i&&(0<=t?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=n||0>e){r=Math.floor(e/n),e-=n*r,i+=Math.abs(r);var a=this.repetitions-i;0>=a?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e=0<t?n:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1===a?(t=0>t,this._setEndings(t,!t,o)):this._setEndings(!1,!1,o),this._loopCount=i,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r}))}else this.time=e;if(o&&1===(1&i))return n-e}return e},_setEndings:function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,e,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;return null===o&&(this._weightInterpolant=o=r._lendControlInterpolant()),r=o.parameterPositions,o=o.sampleValues,r[0]=i,o[0]=e,r[1]=i+t,o[1]=n,this}}),io.prototype=Object.assign(Object.create(e.prototype),{constructor:io,_bindAction:function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings;t=t._interpolants;var a=n.uuid,s=this._bindingsByRootAndName,l=s[a];for(void 0===l&&(l={},s[a]=l),s=0;s!==i;++s){var c=r[s],u=c.name,h=l[u];if(void 0===h){if(h=o[s],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,u));continue}h=new Qi(eo.create(n,u,e&&e._propertyBindings[s].binding.parsedPath),c.ValueTypeName,c.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,u)}o[s]=h,t[s].resultBuffer=h.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){return t=t._cacheIndex,null!==t&&t<this._nActiveActions},_addInactiveAction:function(t,e,n){var r=this._actions,i=this._actionsByClip,o=i[e];void 0===o?(o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o):(e=o.knownActions,t._byClipCacheIndex=e.length,e.push(t)),t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null,e=t._clip.uuid,n=this._actionsByClip,r=n[e];var i=r.knownActions,o=i[i.length-1],a=t._byClipCacheIndex;o._byClipCacheIndex=a,i[a]=o,i.pop(),t._byClipCacheIndex=null,delete r.actionByRoot[(t._localRoot||this._root).uuid],0===i.length&&delete n[e],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){t=t._propertyBindings;for(var e=0,n=t.length;e!==n;++e){var r=t[e];0===--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){var r=this._bindingsByRootAndName,i=r[e],o=this._bindings;void 0===i&&(i={},r[e]=i),i[n]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid;n=n.path;var i=this._bindingsByRootAndName,o=i[r],a=e[e.length-1];t=t._cacheIndex,a._cacheIndex=t,e[t]=a,e.pop(),delete o[n],0===Object.keys(o).length&&delete i[r]},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&(n=new Nr(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){var r=e||this._root,i=r.uuid;r="string"===typeof t?Wr.findByName(r,t):t,t=null!==r?r.uuid:t;var o=this._actionsByClip[t],a=null;if(void 0===n&&(n=null!==r?r.blendMode:2500),void 0!==o){if(a=o.actionByRoot[i],void 0!==a&&a.blendMode===n)return a;a=o.knownActions[0],null===r&&(r=a._clip)}return null===r?null:(e=new ro(this,r,e,n),this._bindAction(e,a),this._addInactiveAction(e,t,i),e)},existingAction:function(t,e){var n=e||this._root;return e=n.uuid,n="string"===typeof t?Wr.findByName(n,t):t,t=this._actionsByClip[n?n.uuid:t],void 0!==t&&t.actionByRoot[e]||null},stopAllAction:function(){for(var t=this._actions,e=this._nActiveActions-1;0<=e;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==n;++a)e[a]._update(r,t,i,o);for(t=this._bindings,e=this._nActiveBindings,a=0;a!==e;++a)t[a].apply(o);return this},setTime:function(t){for(var e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions;t=t.uuid;var n=this._actionsByClip,r=n[t];if(void 0!==r){r=r.knownActions;for(var i=0,o=r.length;i!==o;++i){var a=r[i];this._deactivateAction(a);var s=a._cacheIndex,l=e[e.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,l._cacheIndex=s,e[s]=l,e.pop(),this._removeInactiveBindingsForAction(a)}delete n[t]}},uncacheRoot:function(t){t=t.uuid;var e=this._actionsByClip;for(r in e){var n=e[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var r=this._bindingsByRootAndName[t];if(void 0!==r)for(var i in r)t=r[i],t.restoreOriginalState(),this._removeInactiveBinding(t)},uncacheAction:function(t,e){t=this.existingAction(t,e),null!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}}),oo.prototype.clone=function(){return new oo(void 0===this.value.clone?this.value:this.value.clone())},ao.prototype=Object.assign(Object.create(Ze.prototype),{constructor:ao,isInstancedInterleavedBuffer:!0,copy:function(t){return Ze.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(so.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){return n=n||[],co(t,this,n,e),n.sort(lo),n},intersectObjects:function(t,e,n){if(n=n||[],!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var r=0,i=t.length;r<i;r++)co(t[r],this,n,e);return n.sort(lo),n}}),Object.assign(uo.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(t,n),this.phi=Math.acos(Vo.clamp(e/this.radius,-1,1))),this}}),Object.assign(ho.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});var yc=new n;Object.assign(po.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){return e=yc.copy(e).multiplyScalar(.5),this.min.copy(t).sub(e),this.max.copy(t).add(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new n),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new n),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new n),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new n),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return yc.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var vc=new c,_c=new c;Object.assign(fo.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new c),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new c),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new c),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){return vc.subVectors(t,this.start),_c.subVectors(this.end,this.start),t=_c.dot(_c),t=_c.dot(vc)/t,e&&(t=Vo.clamp(t,0,1)),t},closestPointToPoint:function(t,e,n){return t=this.closestPointToPointParameter(t,e),void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new c),this.delta(n).multiplyScalar(t).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),mo.prototype=Object.create(d.prototype),mo.prototype.constructor=mo,mo.prototype.isImmediateRenderObject=!0;var xc=new c;go.prototype=Object.create(d.prototype),go.prototype.constructor=go,go.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},go.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),xc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var bc=new c,wc=new u,Mc=new u;vo.prototype=Object.create(sn.prototype),vo.prototype.constructor=vo,vo.prototype.isSkeletonHelper=!0,vo.prototype.updateMatrixWorld=function(t){var e=this.bones,n=this.geometry,r=n.getAttribute("position");Mc.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<e.length;i++){var a=e[i];a.parent&&a.parent.isBone&&(wc.multiplyMatrices(Mc,a.matrixWorld),bc.setFromMatrixPosition(wc),r.setXYZ(o,bc.x,bc.y,bc.z),wc.multiplyMatrices(Mc,a.parent.matrixWorld),bc.setFromMatrixPosition(wc),r.setXYZ(o+1,bc.x,bc.y,bc.z),o+=2)}n.getAttribute("position").needsUpdate=!0,d.prototype.updateMatrixWorld.call(this,t)},_o.prototype=Object.create(j.prototype),_o.prototype.constructor=_o,_o.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},_o.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var Ec=new c,Sc=new b,Tc=new b;xo.prototype=Object.create(d.prototype),xo.prototype.constructor=xo,xo.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},xo.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");Sc.copy(this.light.color),Tc.copy(this.light.groundColor);for(var n=0,r=e.count;n<r;n++){var i=n<r/2?Sc:Tc;e.setXYZ(n,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(Ec.setFromMatrixPosition(this.light.matrixWorld).negate())},bo.prototype=Object.assign(Object.create(sn.prototype),{constructor:bo,copy:function(t){return sn.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),wo.prototype=Object.create(sn.prototype),wo.prototype.constructor=wo;var Ac=new c,Cc=new c,Lc=new c;Mo.prototype=Object.create(d.prototype),Mo.prototype.constructor=Mo,Mo.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Mo.prototype.update=function(){Ac.setFromMatrixPosition(this.light.matrixWorld),Cc.setFromMatrixPosition(this.light.target.matrixWorld),Lc.subVectors(Cc,Ac),this.lightPlane.lookAt(Cc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Cc),this.targetLine.scale.z=Lc.length()};var Ic=new c,Pc=new Z;Eo.prototype=Object.create(sn.prototype),Eo.prototype.constructor=Eo,Eo.prototype.update=function(){var t=this.geometry,e=this.pointMap;Pc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),So("c",e,t,Pc,0,0,-1),So("t",e,t,Pc,0,0,1),So("n1",e,t,Pc,-1,-1,-1),So("n2",e,t,Pc,1,-1,-1),So("n3",e,t,Pc,-1,1,-1),So("n4",e,t,Pc,1,1,-1),So("f1",e,t,Pc,-1,-1,1),So("f2",e,t,Pc,1,-1,1),So("f3",e,t,Pc,-1,1,1),So("f4",e,t,Pc,1,1,1),So("u1",e,t,Pc,.7,1.1,-1),So("u2",e,t,Pc,-.7,1.1,-1),So("u3",e,t,Pc,0,2,-1),So("cf1",e,t,Pc,-1,0,1),So("cf2",e,t,Pc,1,0,1),So("cf3",e,t,Pc,0,-1,1),So("cf4",e,t,Pc,0,1,1),So("cn1",e,t,Pc,-1,0,-1),So("cn2",e,t,Pc,1,0,-1),So("cn3",e,t,Pc,0,-1,-1),So("cn4",e,t,Pc,0,1,-1),t.getAttribute("position").needsUpdate=!0};var Rc=new m;To.prototype=Object.create(sn.prototype),To.prototype.constructor=To,To.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Rc.setFromObject(this.object),!Rc.isEmpty()){t=Rc.min;var e=Rc.max,n=this.geometry.attributes.position,r=n.array;r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t.x,r[4]=e.y,r[5]=e.z,r[6]=t.x,r[7]=t.y,r[8]=e.z,r[9]=e.x,r[10]=t.y,r[11]=e.z,r[12]=e.x,r[13]=e.y,r[14]=t.z,r[15]=t.x,r[16]=e.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=e.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},To.prototype.setFromObject=function(t){return this.object=t,this.update(),this},To.prototype.copy=function(t){return sn.prototype.copy.call(this,t),this.object=t.object,this},To.prototype.clone=function(){return(new this.constructor).copy(this)},Ao.prototype=Object.create(sn.prototype),Ao.prototype=Object.assign(Object.create(sn.prototype),{constructor:Ao,copy:function(t){return sn.prototype.copy.call(this,t),this.box=t.box.clone(),this}}),Ao.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),d.prototype.updateMatrixWorld.call(this,t))},Co.prototype=Object.create(an.prototype),Co.prototype.constructor=Co,Co.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;1e-8>Math.abs(e)&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=0>e?1:0,this.lookAt(this.plane.normal),d.prototype.updateMatrixWorld.call(this,t)};var Oc,Dc,Nc=new c;Lo.prototype=Object.create(d.prototype),Lo.prototype.constructor=Lo,Lo.prototype.setDirection=function(t){.99999<t.y?this.quaternion.set(0,0,0,1):-.99999>t.y?this.quaternion.set(1,0,0,0):(Nc.set(t.z,0,-t.x).normalize(),this.quaternion.setFromAxisAngle(Nc,Math.acos(t.y)))},Lo.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},Lo.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},Lo.prototype.copy=function(t){return d.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},Lo.prototype.clone=function(){return(new this.constructor).copy(this)},Io.prototype=Object.create(sn.prototype),Io.prototype.constructor=Io;var kc=Math.pow(2,8),Fc=[.125,.215,.35,.446,.526,.582],zc=5+Fc.length,Bc={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Uc=new Ci,jc=function(){for(var t=[],e=[],n=[],r=8,i=0;i<zc;i++){var o=Math.pow(2,r);e.push(o);var a=1/o;4<i?a=Fc[i-8+4-1]:0==i&&(a=0),n.push(a),a=1/(o-1),o=-a/2,a=1+a/2;var s=[o,o,a,o,a,a,o,o,a,a,o,a];o=new Float32Array(108),a=new Float32Array(72);for(var l=new Float32Array(36),c=0;6>c;c++){var u=c%3*2/3-1,h=2<c?0:-1;o.set([u,h,0,u+2/3,h,0,u+2/3,h+1,0,u,h,0,u+2/3,h+1,0,u,h+1,0],18*c),a.set(s,12*c),l.set([c,c,c,c,c,c],6*c)}s=new U,s.setAttribute("position",new C(o,3)),s.setAttribute("uv",new C(a,2)),s.setAttribute("faceIndex",new C(l,1)),t.push(s),4<r&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}(),Gc=jc._lodPlanes,Vc=jc._sizeLods,Hc=jc._sigmas,Wc=null,qc=(1+Math.sqrt(5))/2,Xc=1/qc,Zc=[new c(1,1,1),new c(-1,1,1),new c(1,1,-1),new c(-1,1,-1),new c(0,qc,Xc),new c(0,qc,-Xc),new c(Xc,0,qc),new c(-Xc,0,qc),new c(qc,Xc,0),new c(-qc,Xc,0)];Po.prototype={constructor:Po,fromScene:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=.1),void 0===r&&(r=100),Wc=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),0<e&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i},fromEquirectangular:function(t){return t.magFilter=1003,t.minFilter=1003,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){Wc=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=No(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=Do(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var t=0;t<Gc.length;t++)Gc[t].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Wc),t.scissorTest=!1,t.setSize(t.width,t.height)},_allocateTargets:function(t){var e=void 0!==t&&1009===t.type&&(3e3===t.encoding||3001===t.encoding||3007===t.encoding);e={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:e?t.encoding:3002,depthBuffer:!1,stencilBuffer:!1};var n=Ro(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Ro(e),n},_compileMaterial:function(t){t=new j(Gc[0],t),this._renderer.compile(t,Uc)},_sceneToCubeUV:function(t,e,n,r){e=new Y(90,1,e,n),n=[1,-1,1,1,1,1];var i=[1,1,1,-1,-1,-1],o=this._renderer,a=o.outputEncoding,s=o.toneMapping,l=o.toneMappingExposure,c=o.getClearColor(),u=o.getClearAlpha();o.toneMapping=1,o.toneMappingExposure=1,o.outputEncoding=3e3;var h=t.background;if(h&&h.isColor){h.convertSRGBToLinear();var p=Math.min(Math.max(Math.ceil(Math.log2(Math.max(h.r,h.g,h.b))),-128),127);h=h.multiplyScalar(Math.pow(2,-p)),o.setClearColor(h,(p+128)/255),t.background=null}for(h=0;6>h;h++)p=h%3,0==p?(e.up.set(0,n[h],0),e.lookAt(i[h],0,0)):1==p?(e.up.set(0,0,n[h]),e.lookAt(0,i[h],0)):(e.up.set(0,n[h],0),e.lookAt(0,0,i[h])),Oo(r,p*kc,2<h?kc:0,kc,kc),o.setRenderTarget(r),o.render(t,e);o.toneMapping=s,o.toneMappingExposure=l,o.outputEncoding=a,o.setClearColor(c,u)},_textureToCubeUV:function(t,e){var n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=No()):null==this._equirectShader&&(this._equirectShader=Do());var r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new j(Gc[0],r);r=r.uniforms,r.envMap.value=t,t.isCubeTexture||r.texelSize.value.set(1/t.image.width,1/t.image.height),r.inputEncoding.value=Bc[t.encoding],r.outputEncoding.value=Bc[e.texture.encoding],Oo(e,0,0,3*kc,2*kc),n.setRenderTarget(e),n.render(i,Uc)},_applyPMREM:function(t){var e=this._renderer,n=e.autoClear;e.autoClear=!1;for(var r=1;r<zc;r++)this._blur(t,r-1,r,Math.sqrt(Hc[r]*Hc[r]-Hc[r-1]*Hc[r-1]),Zc[(r-1)%Zc.length]);e.autoClear=n},_blur:function(t,e,n,r,i){var o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)},_halfBlur:function(t,e,n,r,i,o,a){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new j(Gc[r],l);l=l.uniforms;var u=Vc[n]-1;u=isFinite(i)?Math.PI/(2*u):2*Math.PI/39;var h=i/u,p=isFinite(i)?1+Math.floor(3*h):20;20<p&&console.warn("sigmaRadians, "+i+", is too large and will clip, as it requested "+p+" samples when the maximum is set to 20"),i=[];for(var d=0,f=0;20>f;++f){var m=f/h;m=Math.exp(-m*m/2),i.push(m),0==f?d+=m:f<p&&(d+=2*m)}for(f=0;f<i.length;f++)i[f]/=d;l.envMap.value=t.texture,l.samples.value=p,l.weights.value=i,l.latitudinal.value="latitudinal"===o,a&&(l.poleAxis.value=a),l.dTheta.value=u,l.mipInt.value=8-n,l.inputEncoding.value=Bc[t.texture.encoding],l.outputEncoding.value=Bc[t.texture.encoding],t=Vc[r],m=3*Math.max(0,kc-2*t),Oo(e,m,(0===r?0:2*kc)+2*t*(4<r?r-8+4:0),3*t,2*t),s.setRenderTarget(e),s.render(c,Uc)}},ri.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(ri.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(vi.prototype,{createPointsGeometry:function(t){return console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),t=this.getPoints(t),this.createGeometry(t)},createSpacedPointsGeometry:function(t){return console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),t=this.getSpacedPoints(t),this.createGeometry(t)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new H,n=0,r=t.length;n<r;n++){var i=t[n];e.vertices.push(new c(i.x,i.y,i.z||0))}return e}}),Object.assign(_i.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),zo.prototype=Object.create(si.prototype),Bo.prototype=Object.create(si.prototype),Uo.prototype=Object.create(si.prototype),Object.assign(Uo.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),bo.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},vo.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Yr.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ql.extractUrlBase(t)}}),Yr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Bi.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(po.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(m.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(y.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Q.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},fo.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Vo,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Vo.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Vo.ceilPowerOfTwo(t)}}),Object.assign(r.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(u.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new c).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,i,o)}}),_.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},l.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(v.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(x.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(x,{barycoordFromPoint:function(t,e,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),x.getBarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),x.getNormal(t,e,n,r)}}),Object.assign(xi.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new nr(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new dr(this,t)}}),Object.assign(n.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(c.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(o.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(H.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(d.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(d.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(j.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(j.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Qe.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(en.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),tn.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(ri.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Y.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(bi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(C.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(C.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(U.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e,n){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new C(e,n)))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(U.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ki.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(so.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Ze.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Ze.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(rr.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(oo.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(T.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new b}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Ar.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(X.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(We.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(We.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?3001:3e3}}}),Object.defineProperties(ke.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(a.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties($i.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new Hi).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Ki.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},$.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Wo.crossOrigin=void 0,Wo.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new ni;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,n,void 0,r),e&&(t.mapping=e),t},Wo.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new ei;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,n,void 0,r),e&&(t.mapping=e),t},Wo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Wo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"117"}})),t.ACESFilmicToneMapping=5,t.AddEquation=100,t.AddOperation=2,t.AdditiveAnimationBlendMode=2501,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=Pi,t.AmbientLightProbe=qi,t.AnimationClip=Wr,t.AnimationLoader=Jr,t.AnimationMixer=io,t.AnimationObjectGroup=no,t.AnimationUtils=Fl,t.ArcCurve=oi,t.ArrayCamera=Ue,t.ArrowHelper=Lo,t.Audio=$i,t.AudioAnalyser=Ki,t.AudioContext=Kl,t.AudioListener=Yi,t.AudioLoader=Hi,t.AxesHelper=Io,t.AxisHelper=function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Io(t)},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BinaryTextureLoader=function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Qr(t)},t.Bone=nn,t.BooleanKeyframeTrack=zr,t.BoundingBoxHelper=function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new To(t,e)},t.Box2=po,t.Box3=m,t.Box3Helper=Ao,t.BoxBufferGeometry=Ps,t.BoxGeometry=Is,t.BoxHelper=To,t.BufferAttribute=C,t.BufferGeometry=U,t.BufferGeometryLoader=zi,t.ByteType=1010,t.Cache=zl,t.Camera=Z,t.CameraHelper=Eo,t.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},t.CanvasTexture=fn,t.CatmullRomCurve3=si,t.CineonToneMapping=4,t.CircleBufferGeometry=wr,t.CircleGeometry=br,t.ClampToEdgeWrapping=1001,t.Clock=Zi,t.ClosedSplineCurve3=zo,t.Color=b,t.ColorKeyframeTrack=Br,t.CompressedTexture=dn,t.CompressedTextureLoader=Kr,t.ConeBufferGeometry=xr,t.ConeGeometry=_r,t.CubeCamera=$,t.CubeGeometry=Is,t.CubeReflectionMapping=301,t.CubeRefractionMapping=302,t.CubeTexture=mt,t.CubeTextureLoader=ei,t.CubeUVReflectionMapping=306,t.CubeUVRefractionMapping=307,t.CubicBezierCurve=hi,t.CubicBezierCurve3=pi,t.CubicInterpolant=Dr,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=ri,t.CurvePath=vi,t.CustomBlending=5,t.CylinderBufferGeometry=vr,t.CylinderGeometry=yr,t.Cylindrical=ho,t.DataTexture=K,t.DataTexture2DArray=gt,t.DataTexture3D=yt,t.DataTextureLoader=Qr,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=Bl,t.DepthFormat=1026,t.DepthStencilFormat=1027,t.DepthTexture=mn,t.DirectionalLight=Ii,t.DirectionalLightHelper=Mo,t.DirectionalLightShadow=Li,t.DiscreteInterpolant=kr,t.DodecahedronBufferGeometry=Cn,t.DodecahedronGeometry=An,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicBufferAttribute=function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new C(t,e).setUsage(35048)},t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=gr,t.EdgesHelper=function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new sn(new gr(t.geometry),new on({color:void 0!==e?e:16777215}))},t.EllipseCurve=ii,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=303,t.EquirectangularRefractionMapping=304,t.Euler=h,t.EventDispatcher=e,t.ExtrudeBufferGeometry=rr,t.ExtrudeGeometry=nr,t.Face3=S,t.Face4=function(t,e,n,r,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new S(t,e,n,i,o,a)},t.FaceColors=1,t.FileLoader=$r,t.FlatShading=1,t.Float32Attribute=function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new k(t,e)},t.Float32BufferAttribute=k,t.Float64Attribute=function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new F(t,e)},t.Float64BufferAttribute=F,t.FloatType=1015,t.Fog=Xe,t.FogExp2=qe,t.Font=Gi,t.FontLoader=Vi,t.FrontFaceDirectionCCW=1,t.FrontFaceDirectionCW=0,t.FrontSide=0,t.Frustum=Q,t.GammaEncoding=3007,t.Geometry=H,t.GeometryUtils={merge:function(t,e,n){if(console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh){e.matrixAutoUpdate&&e.updateMatrix();var r=e.matrix;e=e.geometry}t.merge(e,r,n)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=bo,t.Group=je,t.HalfFloatType=1016,t.HemisphereLight=wi,t.HemisphereLightHelper=xo,t.HemisphereLightProbe=Wi,t.IcosahedronBufferGeometry=Tn,t.IcosahedronGeometry=Sn,t.ImageBitmapLoader=Ui,t.ImageLoader=ti,t.ImageUtils=Wo,t.ImmediateRenderObject=mo,t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=Fi,t.InstancedBufferGeometry=ki,t.InstancedInterleavedBuffer=ao,t.InstancedMesh=rn,t.Int16Attribute=function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new R(t,e)},t.Int16BufferAttribute=R,t.Int32Attribute=function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new D(t,e)},t.Int32BufferAttribute=D,t.Int8Attribute=function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new L(t,e)},t.Int8BufferAttribute=L,t.IntType=1013,t.InterleavedBuffer=Ze,t.InterleavedBufferAttribute=Ye,t.Interpolant=Or,t.InterpolateDiscrete=2300,t.InterpolateLinear=2301,t.InterpolateSmooth=2302,t.InvertStencilOp=5386,t.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},t.KeepStencilOp=7680,t.KeyframeTrack=Fr,t.LOD=Qe,t.LatheBufferGeometry=pr,t.LatheGeometry=hr,t.Layers=p,t.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=bi,t.LightProbe=Di,t.LightShadow=Mi,t.Line=an,t.Line3=fo,t.LineBasicMaterial=on,t.LineCurve=di,t.LineCurve3=fi,t.LineDashedMaterial=Rr,t.LineLoop=ln,t.LinePieces=1,t.LineSegments=sn,t.LineStrip=0,t.LinearEncoding=3e3,t.LinearFilter=1006,t.LinearInterpolant=Nr,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=1008,t.LinearMipmapNearestFilter=1007,t.LinearToneMapping=1,t.Loader=Yr,t.LoaderUtils=ql,t.LoadingManager=Zr,t.LogLuvEncoding=3003,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=T,t.MaterialLoader=Ni,t.Math=Vo,t.MathUtils=Vo,t.Matrix3=r,t.Matrix4=u,t.MaxEquation=104,t.Mesh=j,t.MeshBasicMaterial=A,t.MeshDepthMaterial=De,t.MeshDistanceMaterial=Ne,t.MeshFaceMaterial=function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},t.MeshLambertMaterial=Ir,t.MeshMatcapMaterial=Pr,t.MeshNormalMaterial=Lr,t.MeshPhongMaterial=Ar,t.MeshPhysicalMaterial=Tr,t.MeshStandardMaterial=Sr,t.MeshToonMaterial=Cr,t.MinEquation=103,t.MirroredRepeatWrapping=1002,t.MixOperation=1,t.MultiMaterial=function(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=1003,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=1005,t.NearestMipmapNearestFilter=1004,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColors=0,t.NoToneMapping=0,t.NormalAnimationBlendMode=2500,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=Ur,t.Object3D=d,t.ObjectLoader=Bi,t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=En,t.OctahedronGeometry=Mn,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=Ci,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=Po,t.ParametricBufferGeometry=vn,t.ParametricGeometry=yn,t.Particle=function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Je(t)},t.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new cn(t)},t.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new un(t,e)},t.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new cn(t)},t.Path=_i,t.PerspectiveCamera=Y,t.Plane=_,t.PlaneBufferGeometry=rt,t.PlaneGeometry=nt,t.PlaneHelper=Co,t.PointCloud=function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new un(t,e)},t.PointCloudMaterial=function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new cn(t)},t.PointLight=Ai,t.PointLightHelper=_o,t.Points=un,t.PointsMaterial=cn,t.PolarGridHelper=wo,t.PolyhedronBufferGeometry=xn,t.PolyhedronGeometry=_n,t.PositionalAudio=Ji,t.PropertyBinding=eo,t.PropertyMixer=Qi,t.QuadraticBezierCurve=mi,t.QuadraticBezierCurve3=gi,t.Quaternion=l,t.QuaternionKeyframeTrack=Gr,t.QuaternionLinearInterpolant=jr,t.REVISION="117",t.RGBADepthPacking=3201,t.RGBAFormat=1023,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=37819,t.RGBA_ASTC_10x5_Format=37816,t.RGBA_ASTC_10x6_Format=37817,t.RGBA_ASTC_10x8_Format=37818,t.RGBA_ASTC_12x10_Format=37820,t.RGBA_ASTC_12x12_Format=37821,t.RGBA_ASTC_4x4_Format=37808,t.RGBA_ASTC_5x4_Format=37809,t.RGBA_ASTC_5x5_Format=37810,t.RGBA_ASTC_6x5_Format=37811,t.RGBA_ASTC_6x6_Format=37812,t.RGBA_ASTC_8x5_Format=37813,t.RGBA_ASTC_8x6_Format=37814,t.RGBA_ASTC_8x8_Format=37815,t.RGBA_BPTC_Format=36492,t.RGBA_ETC2_EAC_Format=37496,t.RGBA_PVRTC_2BPPV1_Format=35843,t.RGBA_PVRTC_4BPPV1_Format=35842,t.RGBA_S3TC_DXT1_Format=33777,t.RGBA_S3TC_DXT3_Format=33778,t.RGBA_S3TC_DXT5_Format=33779,t.RGBDEncoding=3006,t.RGBEEncoding=3002,t.RGBEFormat=1023,t.RGBFormat=1022,t.RGBIntegerFormat=1032,t.RGBM16Encoding=3005,t.RGBM7Encoding=3004,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=37492,t.RGB_PVRTC_2BPPV1_Format=35841,t.RGB_PVRTC_4BPPV1_Format=35840,t.RGB_S3TC_DXT1_Format=33776,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=Er,t.Ray=v,t.Raycaster=so,t.RectAreaLight=Ri,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RepeatWrapping=1e3,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=ur,t.RingGeometry=cr,t.SRGB8_ALPHA8_ASTC_10x10_Format=37851,t.SRGB8_ALPHA8_ASTC_10x5_Format=37848,t.SRGB8_ALPHA8_ASTC_10x6_Format=37849,t.SRGB8_ALPHA8_ASTC_10x8_Format=37850,t.SRGB8_ALPHA8_ASTC_12x10_Format=37852,t.SRGB8_ALPHA8_ASTC_12x12_Format=37853,t.SRGB8_ALPHA8_ASTC_4x4_Format=37840,t.SRGB8_ALPHA8_ASTC_5x4_Format=37841,t.SRGB8_ALPHA8_ASTC_5x5_Format=37842,t.SRGB8_ALPHA8_ASTC_6x5_Format=37843,t.SRGB8_ALPHA8_ASTC_6x6_Format=37844,t.SRGB8_ALPHA8_ASTC_8x5_Format=37845,t.SRGB8_ALPHA8_ASTC_8x6_Format=37846,t.SRGB8_ALPHA8_ASTC_8x8_Format=37847,t.Scene=f,t.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}},t.ShaderChunk=ks,t.ShaderLib=Fs,t.ShaderMaterial=X,t.ShadowMaterial=Mr,t.Shape=xi,t.ShapeBufferGeometry=fr,t.ShapeGeometry=dr,t.ShapePath=ji,t.ShapeUtils=Ol,t.ShortType=1011,t.Skeleton=en,t.SkeletonHelper=vo,t.SkinnedMesh=tn,t.SmoothShading=2,t.Sphere=y,t.SphereBufferGeometry=lr,t.SphereGeometry=sr,t.Spherical=uo,t.SphericalHarmonics3=Oi,t.SphericalReflectionMapping=305,t.Spline=Uo,t.SplineCurve=yi,t.SplineCurve3=Bo,t.SpotLight=Si,t.SpotLightHelper=go,t.SpotLightShadow=Ei,t.Sprite=Je,t.SpriteMaterial=$e,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=35044,t.StaticReadUsage=35045,t.StereoCamera=Xi,t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=Vr,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=wn,t.TetrahedronGeometry=bn,t.TextBufferGeometry=ar,t.TextGeometry=or,t.Texture=i,t.TextureLoader=ni,t.TorusBufferGeometry=Dn,t.TorusGeometry=On,t.TorusKnotBufferGeometry=Rn,t.TorusKnotGeometry=Pn,t.Triangle=x,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=In,t.TubeGeometry=Ln,t.UVMapping=300,t.Uint16Attribute=function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new O(t,e)},t.Uint16BufferAttribute=O,t.Uint32Attribute=function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new N(t,e)},t.Uint32BufferAttribute=N,t.Uint8Attribute=function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new I(t,e)},t.Uint8BufferAttribute=I,t.Uint8ClampedAttribute=function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new P(t,e)},t.Uint8ClampedBufferAttribute=P,t.Uncharted2ToneMapping=3,t.Uniform=oo,t.UniformsLib=Ns,t.UniformsUtils=Rs,t.UnsignedByteType=1009,t.UnsignedInt248Type=1020,t.UnsignedIntType=1014,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShort565Type=1019,t.UnsignedShortType=1012,t.VSMShadowMap=3,t.Vector2=n,t.Vector3=c,t.Vector4=o,t.VectorKeyframeTrack=Hr,t.Vertex=function(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new c(t,e,n)},t.VertexColors=2,t.VideoTexture=pn,t.WebGLCubeRenderTarget=J,t.WebGLMultisampleRenderTarget=s,t.WebGLRenderTarget=a,t.WebGLRenderTargetCube=function(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new J(t,n)},t.WebGLRenderer=We,t.WebGLUtils=Be,t.WireframeGeometry=gn,t.WireframeHelper=function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new sn(new gn(t.geometry),new on({color:void 0!==e?e:16777215}))},t.WrapAroundEnding=2402,t.XHRLoader=function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new $r(t)},t.ZeroCurvatureEnding=2400,t.ZeroFactor=200,t.ZeroSlopeEnding=2401,t.ZeroStencilOp=0,t.sRGBEncoding=3001,Object.defineProperty(t,"__esModule",{value:!0})}))},{}],24:[function(t,e,n){const r=1024e3,i=.1/180*Math.PI,o=Math.atan(3/4),a=6371008.8,s=40075017;e.exports={WORLD_SIZE:r,PROJECTION_WORLD_SIZE:r/(a*Math.PI*2),MERCATOR_A:a,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_RADIUS:a,EARTH_CIRCUMFERENCE:2*Math.PI*a,EARTH_CIRCUMFERENCE_EQUATOR:s,FOV_ORTHO:i,FOV:o,FOV_DEGREES:180*o/Math.PI,TILE_SIZE:512}},{}],25:[function(t,e,n){var r=t("../utils/utils.js"),i=t("../three.js"),o={material:"MeshBasicMaterial",color:"black",opacity:1};function a(t){var e;function n(){return new i[o.material]({color:o.color})}return t?(t=r._validate(t,o),e=t.material&&t.material.isMaterial?t.material:t.material||t.color||t.opacity?new i[t.material]({color:t.color,transparent:t.opacity<1}):n(),e.opacity=t.opacity):e=n(),e}e.exports=a},{"../three.js":23,"../utils/utils.js":27}],26:[function(t,e,n){(function(){"use strict";var t=Math.PI,n=Math.sin,r=Math.cos,i=Math.tan,o=Math.asin,a=Math.atan2,s=Math.acos,l=t/180,c=864e5,u=2440588,h=2451545;function p(t){return t.valueOf()/c-.5+u}function d(t){return new Date((t+.5-u)*c)}function f(t){return p(t)-h}var m=23.4397*l;function g(t,e){return a(n(t)*r(m)-i(e)*n(m),r(t))}function y(t,e){return o(n(e)*r(m)+r(e)*n(m)*n(t))}function v(t,e,o){return a(n(t),r(t)*n(e)-i(o)*r(e))}function _(t,e,i){return o(n(e)*n(i)+r(e)*r(i)*r(t))}function x(t,e){return l*(280.16+360.9856235*t)-e}function b(t){return t<0&&(t=0),2967e-7/Math.tan(t+.00312536/(t+.08901179))}function w(t){return l*(357.5291+.98560028*t)}function M(e){var r=l*(1.9148*n(e)+.02*n(2*e)+3e-4*n(3*e)),i=102.9372*l;return e+r+i+t}function E(t){var e=w(t),n=M(e);return{dec:y(n,0),ra:g(n,0)}}var S={getPosition:function(t,e,n){var r=l*-n,i=l*e,o=f(t),a=E(o),s=x(o,r)-a.ra;return{azimuth:v(s,i,a.dec),altitude:_(s,i,a.dec)}},toJulian:function(t){return p(t)}},T=S.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];S.addTime=function(t,e,n){T.push([t,e,n])};var A=9e-4;function C(e,n){return Math.round(e-A-n/(2*t))}function L(e,n,r){return A+(e+n)/(2*t)+r}function I(t,e,r){return h+t+.0053*n(e)-.0069*n(2*r)}function P(t,e,i){return s((n(t)-n(e)*n(i))/(r(e)*r(i)))}function R(t){return-2.076*Math.sqrt(t)/60}function O(t,e,n,r,i,o,a){var s=P(t,n,r),l=L(s,e,i);return I(l,o,a)}function D(t){var e=l*(218.316+13.176396*t),i=l*(134.963+13.064993*t),o=l*(93.272+13.22935*t),a=e+6.289*l*n(i),s=5.128*l*n(o),c=385001-20905*r(i);return{ra:g(a,s),dec:y(a,s),dist:c}}function N(t,e){return new Date(t.valueOf()+e*c/24)}S.getTimes=function(t,e,n,r){r=r||0;var i,o,a,s,c,u,h=l*-n,p=l*e,m=R(r),g=f(t),v=C(g,h),_=L(0,h,v),x=w(_),b=M(x),E=y(b,0),S=I(_,x,b),A={solarNoon:d(S),nadir:d(S-.5)};for(i=0,o=T.length;i<o;i+=1)a=T[i],s=(a[0]+m)*l,c=O(s,h,p,E,v,x,b),u=S-(c-S),A[a[1]]=d(u),A[a[2]]=d(c);return A},S.getMoonPosition=function(t,e,o){var s=l*-o,c=l*e,u=f(t),h=D(u),p=x(u,s)-h.ra,d=_(p,c,h.dec),m=a(n(p),i(c)*r(h.dec)-n(h.dec)*r(p));return d+=b(d),{azimuth:v(p,c,h.dec),altitude:d,distance:h.dist,parallacticAngle:m}},S.getMoonIllumination=function(t){var e=f(t||new Date),i=E(e),o=D(e),l=149598e3,c=s(n(i.dec)*n(o.dec)+r(i.dec)*r(o.dec)*r(i.ra-o.ra)),u=a(l*n(c),o.dist-l*r(c)),h=a(r(i.dec)*n(i.ra-o.ra),n(i.dec)*r(o.dec)-r(i.dec)*n(o.dec)*r(i.ra-o.ra));return{fraction:(1+r(u))/2,phase:.5+.5*u*(h<0?-1:1)/Math.PI,angle:h}},S.getMoonTimes=function(t,e,n,r){var i=new Date(t);r?i.setUTCHours(0,0,0,0):i.setHours(0,0,0,0);for(var o,a,s,c,u,h,p,d,f,m,g,y,v,_=.133*l,x=S.getMoonPosition(i,e,n).altitude-_,b=1;b<=24;b+=2){if(o=S.getMoonPosition(N(i,b),e,n).altitude-_,a=S.getMoonPosition(N(i,b+1),e,n).altitude-_,u=(x+a)/2-o,h=(a-x)/2,p=-h/(2*u),d=(u*p+h)*p+o,f=h*h-4*u*o,m=0,f>=0&&(v=Math.sqrt(f)/(2*Math.abs(u)),g=p-v,y=p+v,Math.abs(g)<=1&&m++,Math.abs(y)<=1&&m++,g<-1&&(g=y)),1===m?x<0?s=b+g:c=b+g:2===m&&(s=b+(d<0?y:g),c=b+(d<0?g:y)),s&&c)break;x=a}var w={};return s&&(w.rise=N(i,s)),c&&(w.set=N(i,c)),s||c||(w[d>0?"alwaysUp":"alwaysDown"]=!0),w},e.exports=S})()},{}],27:[function(t,e,n){var r=t("../three.js"),i=t("./constants.js"),o=t("./validate.js"),a={prettyPrintMatrix:function(t){for(var e=0;e<4;e++){var n=[t[e],t[e+4],t[e+8],t[e+12]];console.log(n.map((function(t){return t.toFixed(4)})))}},makePerspectiveMatrix:function(t,e,n,i){var o=new r.Matrix4,a=1/Math.tan(t/2),s=1/(n-i),l=[a/e,0,0,0,0,a,0,0,0,0,(i+n)*s,-1,0,0,2*i*n*s,0];return o.elements=l,o},makeOrthographicMatrix:function(t,e,n,i,o,a){var s=new r.Matrix4;const l=1/(e-t),c=1/(n-i),u=1/(a-o),h=(e+t)*l,p=(n+i)*c,d=o*u;var f=[2*l,0,0,0,0,2*c,0,0,0,0,-1*u,0,-h,-p,-d,1];return s.elements=f,s},radify:function(t){function e(t){return t=t||0,2*Math.PI*t/360}return"object"===typeof t?t.length>0?t.map((function(t){return e(t)})):[e(t.x),e(t.y),e(t.z)]:e(t)},degreeify:function(t){function e(t){return t=t||0,360*t/(2*Math.PI)}return"object"===typeof t?[e(t.x),e(t.y),e(t.z)]:e(t)},projectToWorld:function(t){var e=[-i.MERCATOR_A*i.DEG2RAD*t[0]*i.PROJECTION_WORLD_SIZE,-i.MERCATOR_A*Math.log(Math.tan(.25*Math.PI+.5*i.DEG2RAD*t[1]))*i.PROJECTION_WORLD_SIZE];if(t[2]){var n=this.projectedUnitsPerMeter(t[1]);e.push(t[2]*n)}else e.push(0);var o=new r.Vector3(e[0],e[1],e[2]);return o},projectedUnitsPerMeter:function(t){return Math.abs(i.WORLD_SIZE/Math.cos(i.DEG2RAD*t)/i.EARTH_CIRCUMFERENCE)},_circumferenceAtLatitude:function(t){return i.EARTH_CIRCUMFERENCE*Math.cos(t*Math.PI/180)},mercatorZfromAltitude:function(t,e){return t/this._circumferenceAtLatitude(e)},_scaleVerticesToMeters:function(t,e){for(var n=this.projectedUnitsPerMeter(t[1]),r=(this.projectToWorld(t),0);r<e.length;r++)e[r].multiplyScalar(n);return e},projectToScreen:function(t){console.log("WARNING: Projecting to screen coordinates is not yet implemented")},unprojectFromScreen:function(t){console.log("WARNING: unproject is not yet implemented")},unprojectFromWorld:function(t){var e=[-t.x/(i.MERCATOR_A*i.DEG2RAD*i.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(t.y/(i.PROJECTION_WORLD_SIZE*-i.MERCATOR_A)))-Math.PI/4)/i.DEG2RAD],n=this.projectedUnitsPerMeter(e[1]),r=t.z||0;return e.push(r/n),e},toScreenPosition:function(t,e){var n=new r.Vector3,i=.5*renderer.context.canvas.width,o=.5*renderer.context.canvas.height;return t.updateMatrixWorld(),n.setFromMatrixPosition(t.matrixWorld),n.project(e),n.x=n.x*i+i,n.y=-n.y*o+o,{x:n.x,y:n.y}},getFeatureCenter:function(t,e,n){let r=[],i=0,o=0,a=0,s=[...t.geometry.coordinates[0]];return"Point"===t.geometry.type?r=[...s[0]]:("MultiPolygon"===t.geometry.type&&(s=s[0]),s.splice(-1,1),s.forEach((function(t){i+=t[0],o+=t[1]})),r=[i/s.length,o/s.length]),a=this.getObjectHeightOnFloor(t,e,n),r.length<3?r.push(a):r[2]=a,r},getObjectHeightOnFloor:function(t,e,n=t.properties.level||0){let r=n*(t.properties.levelHeight||0),i=t.properties.base_height||t.properties.min_height||0,o=e&&e.model?0:t.properties.height-i,a=o+i,s=r+a;return s},_flipMaterialSides:function(t){},normalizeVertices(t){var e=new r.Geometry;for(let r of t)e.vertices.push(r);e.computeBoundingSphere();var n=e.boundingSphere.center,i=(e.boundingSphere.radius,t.map((function(t){var e=t.sub(n);return e})));return{vertices:i,position:n}},flattenVectors(t){var e=[];for(let n of t)e.push(n.x,n.y,n.z);return e},lnglatsToWorld:function(t){var e=t.map((function(t){var e=a.projectToWorld(t),n=new r.Vector3(e.x,e.y,e.z);return n}));return e},extend:function(t,e){for(let n in e)t[n]=e[n]},clone:function(t){var e={};for(let n in t)e[n]=t[n];return e},clamp:function(t,e,n){return Math.min(n,Math.max(e,t))},types:{rotation:function(t,e){t||(t=0),"number"===typeof t&&(t={z:t});var n=this.applyDefault([t.x,t.y,t.z],e),r=a.radify(n);return r},scale:function(t,e){return t||(t=1),"number"===typeof t?[t,t,t]:this.applyDefault([t.x,t.y,t.z],e)},applyDefault:function(t,e){var n=t.map((function(t,n){return t=t||e[n],t}));return n}},toDecimal:function(t,e){return Number(t.toFixed(e))},equal:function(t,e){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;if(0==n.length&&0==r.length&&n!==r)return!1;for(const i of n){const n=t[i],r=e[i],o=this.isObject(n)&&this.isObject(r);if(o&&!equal(n,r)||!o&&n!==r)return!1}return!0},isObject:function(t){return null!=t&&"object"===typeof t},curveToLine:(t,e)=>{let{width:n,color:i}=e,o=(new r.BufferGeometry).setFromPoints(t.getPoints(100)),a=new r.LineBasicMaterial({color:i,linewidth:n}),s=new r.Line(o,a);return s},curvesToLines:t=>{var e=[16711680,2031360,2490623],n=t.map((t,n)=>{let r={width:3,color:e[n]||"purple"},i=curveToLine(t,r);return i});return n},_validate:function(t,e){t=t||{};var n={};a.extend(n,t);for(let r of Object.keys(e))if(void 0===t[r]){if(null===e[r])return void console.error(r+" is required");n[r]=e[r]}else n[r]=t[r];return n},Validator:new o,exposedMethods:["projectToWorld","projectedUnitsPerMeter","extend","unprojectFromWorld"]};e.exports=a},{"../three.js":23,"./constants.js":24,"./validate.js":28}],28:[function(t,e,n){function r(){}r.prototype={Coords:function(t){if(t.constructor===Array)if(t.length<2)console.error("Coords length must be at least 2");else{for(const e of t)if(e.constructor!==Number)return void console.error("Coords values must be numbers");if(!(Math.abs(t[1])>90))return t;console.error("Latitude must be between -90 and 90")}else console.error("Coords must be an array")},Line:function(t){var e=this;if(t.constructor===Array){for(const n of t)if(!e.Coords(n))return void console.error("Each coordinate in a line must be a valid Coords type");return t}console.error("Line must be an array")},Rotation:function(t){if(t.constructor===Number)t={z:t};else{if(t.constructor!==Object)return void console.error("Rotation must be an object or a number");for(const e of Object.keys(t)){if(!["x","y","z"].includes(e))return void console.error("Rotation parameters must be x, y, or z");if(t[e].constructor!==Number)return void console.error("Individual rotation values must be numbers")}}return t},Scale:function(t){if(t.constructor===Number)t={x:t,y:t,z:t};else{if(t.constructor!==Object)return void console.error("Scale must be an object or a number");for(const e of Object.keys(t)){if(!["x","y","z"].includes(e))return void console.error("Scale parameters must be x, y, or z");if(t[e].constructor!==Number)return void console.error("Individual scale values must be numbers")}}return t}},e.exports=r},{}]},{},[1])}}]);
//# sourceMappingURL=chunk-vendors.8bd349b6.js.map