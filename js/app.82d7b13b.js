(function(e){function t(t){for(var o,i,s=t[0],l=t[1],c=t[2],d=0,p=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&p.push(r[i][0]),r[i]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);u&&u(t);while(p.length)p.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(o=!1)}o&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var o={},r={app:0},a=[];function i(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/site-divider/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"09a2":function(e,t,n){},1664:function(e,t,n){"use strict";n("7c60")},"40f3":function(e,t,n){"use strict";n("aa8d")},5490:function(e,t,n){"use strict";n("a6b6")},"56d7":function(e,t,n){"use strict";n.r(t);var o=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{attrs:{id:"app"}},[n("Map")],1),n("div",{attrs:{id:"area_box"}},[n("AreaBox")],1),n("div",{attrs:{id:"text_input"}},[n("TextInput")],1)])},a=[],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{attrs:{id:"map"},on:{draw:function(t){return e.generatePolygons()}}}),n("div",{attrs:{id:"vue-range-slider"}},[n("RangeSlider",{on:{changeValue:function(t){return e.generatePolygons()}}})],1)])},s=[],l=n("e192"),c=n.n(l),u=n("3680"),d=n("fa6d"),p=n.n(d),h=n("125a");function f(e,t,n,o){const r={radius:e||50,segments:t||8,thetaStart:n||0,thetaLength:o||2*Math.PI},a=new THREE.Geometry,i=(r.thetaStart+r.thetaLength-r.thetaStart)/r.segments;for(let s=0;s<=r.segments;s+=1){const e=r.thetaStart+i*s,t=r.radius*Math.cos(e),n=r.radius*Math.sin(e);a.vertices.push(new THREE.Vector3(t,n,0))}return a}function m(e,t=4e3,n=!0){THREE.Object3D.call(this),this.duration=t;const o=32,r="rgb(162, 28, 175)",a=r,i=new THREE.CircleGeometry(e,o),s=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:r,transparent:!0,opacity:.8});this.disc=new THREE.Mesh(i,s),this.add(this.disc);const l=new f(e,o),c=new THREE.LineBasicMaterial({color:a,linewidth:1,transparent:!0,opacity:1});this.line=new THREE.Line(l,c),this.add(this.line),n&&this.start()}m.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:m,start(){this.started=new Date},stop(){this.started=null},update(){if(!this.started)return;const e=new Date,t=e-this.started;let n=t/this.duration;n>=1&&(n-=Math.floor(n));const o=1-n;let r=n;r<=0&&(r=.001),this.scale.set(r,r,r),this.line.material.opacity=o,this.disc.material.opacity=.35*o}});var g=n("595b"),y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"vue-range-slider"},[n("vue-range-slider",{attrs:{min:e.min,max:e.max,formatter:e.formatter},on:{"slide-end":e.changeValue},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)},b=[],w=(n("e1b1"),n("b8c8")),x={data(){return{value:[6,10]}},components:{VueRangeSlider:w["a"]},created(){this.min=1,this.max=30,this.formatter=e=>e+"m"},methods:{changeValue(){this.$store.commit("setRange",this.value),this.$store.commit("generatePolygons")}}},v=x,S=(n("da36"),n("2877")),T=Object(S["a"])(v,y,b,!1,null,null,null),M=T.exports;let E=new m(400,4e3,!0);function L(e){const t=e.getAll(),n=document.getElementById("calculated-area");if(t.features.length>0){const e=g["area"](t),o=Math.round(100*e)/100;n.innerHTML=`<p><strong>${o}</strong> mÂ²</p>`}else n.innerHTML=""}function _(e,t){for(var n in e)if(e[n]["id"]==t)return!0}function j(e){const t=[];for(let n=0;n<e.features.length;n++){const o=g["lineString"](e.features[n]),r=g["centroid"](o["geometry"]["coordinates"]);t.push(r)}return t}function O(e,t=100){const n=g["lineChunk"](e,t,{units:"meters"});return j(n)}function R(e){const t=e.getAll();return g["polygon"](t.features[0]["geometry"]["coordinates"])}function k(e){const t=R(e),n=g["polygonToLine"](t),o=g["lineChunk"](n,.01),r=j(o),a={type:"FeatureCollection",features:r},i=g["voronoi"](a),s=[];for(let d=0;d<i.features.length;d++){const e=g["polygon"](i.features[d]["geometry"]["coordinates"]),n=g["polygonToLine"](e),o=g["lineSegment"](n);for(let r=0;r<o.features.length;r++){const e=g["centroid"](o.features[r]);g["booleanContains"](t,e)&&s.push(o.features[r])}}const l={type:"FeatureCollection",features:s},c=g["combine"](l),u=g["simplify"](c,{tolerance:5,mutate:!0});return u}function C(e){const t=[];for(let n=0;n<3;n++){const o=g["buffer"](e,30*(n+1),{units:"meters"}),r=g["dissolve"](o);t.push(g["lineString"](r.features[0]["geometry"]["coordinates"][0]))}return t}function $(e){const t={},n=k(e);t.skeleton=n.features;const o=g["buffer"](n,.1,{units:"meters"}).features[0],r=g["polygonToLine"](o),a=O(g["combine"](r)),i=C(n);t.voronoiSkeletonBuffers=i,t.perpendicularLines=[];for(let l=0;l<a.length;l++){var s=a[l];const e=[s["geometry"]["coordinates"]];for(let t=0;t<i.length;t++){const n=i[t],o=g["nearestPointOnLine"](n,g["point"](s["geometry"]["coordinates"]));e.push(o["geometry"]["coordinates"]),s=o}t.perpendicularLines.push(g["lineString"](e))}return t}function P(e,t){const n={units:"meters"},o=$(e),r=g["buffer"](o.skeleton[0],t[1]/2,n),a=g["buffer"](g["featureCollection"](o.perpendicularLines),(t[0]+t[1])/4,n),i=g["buffer"](g["featureCollection"](o.voronoiSkeletonBuffers),t[0]/2,n),s=a.features.concat(i.features,r),l=[];for(let d=0;d<s.length;d++){console.log(s[d]);const e=s[d].geometry.coordinates;l.push(e)}console.log(g["multiPolygon"](l));const c=g["difference"](R(e),g["multiPolygon"](l));console.log("Subtraction performed");const u=g["simplify"](c,{tolerance:1e-5});return console.log("Simplification completed"),u}function z(e){_(e.getStyle().layers,"outline")&&e.removeLayer("outline"),"draw"in e.getStyle().sources&&e.removeSource("draw")}function D(e,t,n){z(e),e.addSource("draw",{type:"geojson",data:P(t,n)}),e.addLayer({id:"outline",type:"fill",source:"draw",paint:{"fill-color":"#06be7f"}})}function I(e,t,n){e.addSource("draw",{type:"geojson",data:P(t,n)}),e.addLayer({id:"outline",type:"fill",source:"draw",paint:{"fill-color":"#06be7f"}})}p.a;var H={name:"ThreeboxExample",mounted(){this.$store.dispatch("loadMap"),this.$store.dispatch("setDraw"),this.generatePolygons()},computed:{accessToken(){return this.$store.state.accessToken},getDraw(){return this.$store.getters.draw},widthRange(){return this.$store.state.widthRange},getMap(){return this.$store.state.mapbox}},components:{RangeSlider:M},methods:{sphere(e,t){let n=[e,t,0];return window.tb.sphere({color:"red",material:"MeshToonMaterial"}).setCoords(n)},animatePulse(){E.update(),this.mapbox.triggerRepaint()},initMap(){c.a.accessToken=this.accessToken,this.mapbox=new c.a.Map({container:"map",interactive:!0,style:"mapbox://styles/mapbox/dark-v10",zoom:16,center:[-123.1068658,49.2626982],pitch:60,bearing:360,antialias:!0,attributionControl:!1}).on("style.load",()=>{window.tb=new h["Threebox"](this.mapbox,this.mapbox.getCanvas().getContext("webgl"),{defaultLights:!0}),null==this.mapbox.getLayer("custom_layer")&&this.mapbox.on("load",()=>{this.mapbox.addLayer({id:"add-3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:12,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],9,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],9,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.8}})})}),this.generatePolygons()},addDrawControls(){this.mapbox=this.$store.state.mapbox;const e=new u;this.mapbox.addControl(e,"top-right"),this.$store.commit("setDraw",this.draw),this.draw=e},generatePolygons(){this.mapbox=this.$store.state.mapbox,this.draw=this.$store.state.draw,console.log("Draw",this.draw),this.mapbox.on("draw.create",()=>{L(this.draw)}),this.mapbox.on("draw.delete",()=>{L(this.draw)}),this.mapbox.on("draw.update",()=>{L(this.draw)}),this.mapbox.on("draw.create",()=>{I(this.mapbox,this.draw,this.widthRange)}),this.mapbox.on("draw.delete",()=>{z(this.mapbox)}),this.mapbox.on("draw.update",()=>{D(this.mapbox,this.draw,this.widthRange)})}}},A=H,G=(n("5490"),Object(S["a"])(A,i,s,!1,null,null,null)),B=G.exports,V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"calculated-area"}})},J=[],Y=(n("1664"),{}),N=Object(S["a"])(Y,V,J,!1,null,null,null),W=N.exports,Z=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},F=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"filter-ctrl"},[n("input",{attrs:{id:"filter-input",type:"text",name:"filter",placeholder:"Iterations"}})])}],U={name:"TextInput",data(){return{}},mounted(){const e=document.getElementById("filter-input");e.addEventListener("keyup",e=>{console.log(e)})}},X=U,Q=(n("40f3"),Object(S["a"])(X,Z,F,!1,null,null,null)),q=Q.exports,K={name:"App",components:{Map:B,AreaBox:W,TextInput:q}},ee=K,te=(n("034f"),Object(S["a"])(ee,r,a,!1,null,null,null)),ne=te.exports,oe=n("2f62");o["a"].use(oe["a"]);const re=new oe["a"].Store({state:{accessToken:"pk.eyJ1IjoibmljaG9sYXNtYXJ0aW5vIiwiYSI6ImNrMjVhOGphOTAzZGUzbG8wNHJhdTZrMmYifQ.98uDMnGIvn1zrw4ZWUO35g",widthRange:[6,10],draw:null,mapbox:null,polygons:null},getters:{getDraw:e=>e.draw},mutations:{setRange:(e,t)=>{e.widthRange=t},setDraw:(e,t)=>{e.draw=t},loadMap:(e,t)=>{e.mapbox=t},generatePolygons:(e,t)=>{console.log(D(e.mapbox,e.draw,e.widthRange)),e.polygons=t}},actions:{loadMap(e){c.a.accessToken=this.state.accessToken;var t=new c.a.Map({container:"map",interactive:!0,style:"mapbox://styles/mapbox/dark-v10",zoom:16,center:[-123.1068658,49.2626982],pitch:60,bearing:360,antialias:!0,attributionControl:!1}).on("style.load",()=>{window.tb=new h["Threebox"](t,t.getCanvas().getContext("webgl"),{defaultLights:!0}),null==t.getLayer("custom_layer")&&t.on("load",()=>{t.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:20}),t.addSource("xyz-tile",{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:512}),t.addLayer({id:"wms-test-layer",type:"raster",source:"xyz-tile",paint:{"raster-opacity":.2}}),t.setTerrain({source:"mapbox-dem",exaggeration:1.5}),t.addSource("property-parcel-polygons",{type:"geojson",data:"https://raw.githubusercontent.com/nicholasmartino/vue-threebox/master/public/data/property-parcel-polygons.geojson"}),t.addLayer({id:"property-parcel-polygons-shp",type:"fill",source:"property-parcel-polygons",paint:{"fill-color":"#ffffff","fill-opacity":.2}}),t.addLayer({id:"add-3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:12,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],9,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],9,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.8}})})});e.commit("loadMap",t)},setDraw(e){console.log("Add draw");const t=new u;this.state.mapbox.addControl(t,"top-right"),e.commit("setDraw",t)}}});o["a"].config.productionTip=!1,new o["a"]({store:re,render:e=>e(ne)}).$mount("#app")},"7c60":function(e,t,n){},"85ec":function(e,t,n){},a6b6:function(e,t,n){},aa8d:function(e,t,n){},da36:function(e,t,n){"use strict";n("09a2")}});
//# sourceMappingURL=app.82d7b13b.js.map